(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
  typeof define === 'function' && define.amd ? define(factory) :
  (global = global || self, global.luckysheet = factory());
}(this, (function () { 'use strict';

  function _typeof(obj) {
    "@babel/helpers - typeof";

    if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") {
      _typeof = function (obj) {
        return typeof obj;
      };
    } else {
      _typeof = function (obj) {
        return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
      };
    }

    return _typeof(obj);
  }

  function _defineProperty(obj, key, value) {
    if (key in obj) {
      Object.defineProperty(obj, key, {
        value: value,
        enumerable: true,
        configurable: true,
        writable: true
      });
    } else {
      obj[key] = value;
    }

    return obj;
  }

  // import {
  //     isRealNum
  // } from './utils/util'
  var luckysheet={};//data:[["1","dd","haha", {d:"xyz", color:"#ffffff", bg:"#000000",fa:"宋体|微软雅黑|...",size:"20px",weight:"normal|bold",style:"normal|italic",decoration:"underline|line-through|overline"},"哈啊哈哈"],[],[],[]]
  var defaultSetting={container:"luckysheet",//容器的ID
  column:60,//空表格默认的列数量
  row:84,//空表格默认的行数据量
  allowCopy:true,//是否允许拷贝
  showtoolbar:true,//是否第二列显示工具栏
  showinfobar:true,//是否显示顶部名称栏
  showsheetbar:true,//是否显示底部表格名称区域
  showstatisticBar:true,//是否显示底部计数栏
  pointEdit:false,//是否是编辑器插入表格模式
  pointEditUpdate:null,//编辑器表格更新函数
  pointEditZoom:1,//编辑器表格编辑时缩放比例
  // menu: "undo|redo|freezenrow|freezencolumn|download|share|chart|pivot",
  data:[{"name":"Sheet1",color:"","status":"1","order":"0","data":[],"config":{},"index":0},{"name":"Sheet2",color:"","status":"0","order":"1","data":[],"config":{},"index":1},{"name":"Sheet3",color:"","status":"0","order":"2","data":[],"config":{},"index":2}],//客户端sheet数据[shee1, sheet2, sheet3]
  title:"Luckysheet Demo",//表格的名称
  userInfo:'<i style="font-size:16px;color:#ff6a00;" class="fa fa-taxi" aria-hidden="true"></i> rabbit',//右上角的用户信息展示样式
  userMenuItem:[{url:"www.baidu.com","icon":'<i class="fa fa-folder" aria-hidden="true"></i>',"name":"我的表格"},{url:"www.baidu.com","icon":'<i class="fa fa-sign-out" aria-hidden="true"></i>',"name":"退出登陆"}],//点击右上角的用户信息弹出的菜单
  myFolderUrl:"www.baidu.com",//左上角<返回按钮的链接
  config:{},//表格行高、列宽、合并单元格、公式等设置
  fullscreenmode:true,//是否全屏模式，非全屏模式下，标记框不会强制选中。
  devicePixelRatio:window.devicePixelRatio,//设备比例，比例越大表格分标率越高
  allowEdit:true,//是否允许前台编辑
  loadUrl:"",// 配置loadUrl的地址，luckysheet会通过ajax请求表格数据，默认载入status为1的sheet数据中的所有data，其余的sheet载入除data字段外的所有字段
  loadSheetUrl:"",//配置loadSheetUrl的地址，参数为gridKey（表格主键） 和 index（sheet主键合集，格式为[1,2,3]），返回的数据为sheet的data字段数据集合
  gridKey:"",// 表格唯一标识符
  updateUrl:"",//表格数据的更新地址
  updateImageUrl:"",//缩略图的更新地址
  allowUpdate:false,//是否允许编辑后的后台更新
  functionButton:"",//右上角功能按钮，例如'<button id="" class="btn btn-primary" style="padding:3px 6px;font-size: 12px;margin-right: 10px;">下载</button>    <button id="" class="btn btn-primary btn-danger" style="    padding:3px 6px;    font-size: 12px;    margin-right: 10px;">分享</button>    <button id="luckysheet-share-btn-title" class="btn btn-primary btn-danger" style="    padding:3px 6px;    font-size: 12px;    margin-right: 10px;">秀数据</button>'
  showConfigWindowResize:true,//图表和数据透视表的配置会在右侧弹出，设置弹出后表格是否会自动缩进
  enableAddRow:true,//允许增加行
  enableAddCol:true,//允许增加列
  enablePage:false,//允许加载下一页
  autoFormatw:false,//自动格式化超过4位数的数字为 亿万格式 例：true or "true" or "TRUE"
  accuracy:undefined,//设置传输来的数值的精确位数，小数点后n位 传参数为数字或数字字符串，例： "0" 或 0
  pageInfo:{// "allFront": [],
  // "isTpshow": "",
  // "pageSize": 5000,
  // "totalPage": 10,
  // "currentPage": 0,
  // "pageUrl": "",
  // "id": '',
  // "dfs": [],
  // "filter": [],
  // "sort": [],
  // "startDate": '',
  // "endDate": '',
  // 'isNow': "",
  // 'gdateNum': ""
  // rptapp
  'queryExps':'','reportId':'','fields':'','mobile':'','frezon':'','currentPage':'',"totalPage":10,"pageUrl":""},editMode:false,//是否为编辑模式
  chartConfigChange:null,//图表插件中图表更新触发的自定义方法
  beforeCreateDom:null,//表格创建之前的方法
  fireMousedown:null//单元格数据下钻
  };//dom变量
  var gridHTML='<div class="luckysheet">'+'<canvas id="luckysheetTableContentF" style="display:none;" class="luckysheetTableContent"></canvas>'+'<div class="luckysheet-work-area luckysheet-noselected-text">'+'<div class="luckysheet-share-logo" title="${logotitle}"></div>'+'<div id ="luckysheet_info_detail" class="luckysheet_info_detail">'+'<div data-tips="返回" id="luckysheet_info_detail_title" class="luckysheet_info_detail_title">'+'<i style="margin-left: -2px;" class="fa fa-chevron-left" aria-hidden="true"></i>'+'</div>'+'<div>'+'<input data-tips="表格重命名" id="luckysheet_info_detail_input" class="luckysheet_info_detail_input luckysheet-mousedown-cancel" value="无标题的电子表格" tabindex="0" dir="ltr" aria-label="重命名" style="visibility: visible; width: 149px;" data-tooltip="重命名">'+'</div>'+'<div id="luckysheet_info_detail_update" class="luckysheet_info_detail_update"> 新打开 </div>'+'<div id="luckysheet_info_detail_save" class="luckysheet_info_detail_save"> 待更新 </div>'+'<div class="luckysheet_info_detail_user"> ${functionButton} <span id="luckysheet_info_detail_user"></span> </div>'+'</div>'+'<div id="luckysheet-wa-editor" class="luckysheet-wa-editor"> ${menu} </div>'+'<div id="luckysheet-wa-calculate" class="luckysheet-wa-calculate">'+'<div class="luckysheet-wa-calculate-size" id="luckysheet-wa-calculate-size"></div>'+'<div class="luckysheet-wa-calculate-help">'+'<div class="luckysheet-wa-calculate-help-box">'+'<div spellcheck="false" aria-hidden="false" id="luckysheet-helpbox">'+'<div id="luckysheet-helpbox-cell" class="luckysheet-helpbox-cell-input luckysheet-mousedown-cancel" tabindex="0" contenteditable="true" dir="ltr" aria-autocomplete="list"></div>'+'</div>'+'</div>'+'<div class="luckysheet-wa-calculate-help-tool">'+'<i class="fa fa-caret-down" aria-hidden="true" style="margin-top: 7px;"></i>'+'</div>'+'</div>'+'<div id="luckysheet-wa-functionbox-cancel" class="luckysheet-wa-functionbox">'+'<span><i class="fa fa-remove" aria-hidden="true"></i></span>'+'</div>'+'<div id="luckysheet-wa-functionbox-confirm" class="luckysheet-wa-functionbox">'+'<span><i class="fa fa-check" aria-hidden="true"></i></span>'+'</div>'+'<div id="luckysheet-wa-functionbox-fx" class="luckysheet-wa-functionbox">'+'<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAHdElNRQfdBg4KFCeL2MAqAAACOUlEQVRYw+3Wy2+MURjH8U9Hp0VLVTTRUupWqfs9xEpE3ULSsLK0qVg0rJAgiD/A2kpCQkJC0rhEJMJampBSFYle0BYNMUNKTY+F0bi10zFjIZnvuzrPe57fc3mfnPeQI0eO/5+8tHaPVW22cn1aNYlnO5nlzmgzIAiazcm2/FoPBEHMY+2uKcqufKlGQcIt29RYYl6azU3JLh8E99VkuzHfKHZekHDw38hT5Zmg17L0XSMj2jVXGTq9+lcBZilAp1j6AfKHfVtmh1IDauWjQoPPIp64IpF+qD+xSKfw23PV6GxV0KdFHJWKJLwQR0SbgezkT1SFSivcE3SrM9U005WlIzF8Bf1eokAUMQ89T9oLjdWfPOwixssT1/9niZFMUakJ+Kg3uV7olKtOm4kx6jU6qzqTRq33VnBHIahy0z0dgmPy7NGjx23ThnIeSQUTlKA7OZrjNNvtHNaoc8hFm+33MpMK9giCU4PJFGKrz7o8dVnF8M6pK4iYDLoGh/MT2jw32TuHU+WeOkC+KQi/CPXqwA2PUueXigIz8UnnT9b5ZmF68sNnFKBEFbq9/sFW7bioLxYpzjzAamV4pAtElahwQtQRb1WaZ4rtxqVUGZLv/7IDyfVGl1zXbpOJmgTnXXBXZfrCk9RabKmTYoIWc5P2o2La1RslYr8OPe5a9zeZ7/TGMx0Sgvf2Dt4hamyxMnmCFVllgxl/15oGcUHwRYt9mdyBhrrdlFtgtkIvNGvN3vmfI0eO/5Ov+PeiZHME+tcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTYtMDktMTdUMTU6MTk6MDcrMDg6MDARPBuqAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDEzLTA2LTE0VDEwOjIwOjM5KzA4OjAw59f0jAAAAE10RVh0c29mdHdhcmUASW1hZ2VNYWdpY2sgNy4wLjEtNiBRMTYgeDg2XzY0IDIwMTYtMDktMTcgaHR0cDovL3d3dy5pbWFnZW1hZ2ljay5vcmfd2aVOAAAAGHRFWHRUaHVtYjo6RG9jdW1lbnQ6OlBhZ2VzADGn/7svAAAAF3RFWHRUaHVtYjo6SW1hZ2U6OkhlaWdodAA3Nkv1+ekAAAAWdEVYdFRodW1iOjpJbWFnZTo6V2lkdGgANzazWjlkAAAAGXRFWHRUaHVtYjo6TWltZXR5cGUAaW1hZ2UvcG5nP7JWTgAAABd0RVh0VGh1bWI6Ok1UaW1lADEzNzExNzY0MzntxStTAAAAEHRFWHRUaHVtYjo6U2l6ZQA5OTdClByG1AAAAF90RVh0VGh1bWI6OlVSSQBmaWxlOi8vL2hvbWUvd3d3cm9vdC9zaXRlL3d3dy5lYXN5aWNvbi5uZXQvY2RuLWltZy5lYXN5aWNvbi5jbi9zcmMvMTExNTkvMTExNTkzNy5wbmeOkn0GAAAAAElFTkSuQmCC" alt="" style="vertical-align:middle"/>'+'</div>'+'<div id="luckysheet-functionbox-container" class="luckysheet-mousedown-cancel">'+'<div class="luckysheet-mousedown-cancel" dir="ltr">'+'<div spellcheck="false" aria-hidden="false" id="luckysheet-functionbox">'+'<div id="luckysheet-functionbox-cell" class="luckysheet-functionbox-cell-input luckysheet-mousedown-cancel" tabindex="0" contenteditable="true" dir="ltr" aria-autocomplete="list" aria-label="D4"></div>'+'</div>'+'</div>'+'</div>'+'</div>'+'</div>'+'<div class="luckysheet-grid-container luckysheet-scrollbars-enabled">'+'<div class="luckysheet-grid-window">'+'<div class="luckysheet-help-sub"></div>'+'<div class="luckysheet-grid-window-1" id="luckysheet-grid-window-1">'+'<canvas id="luckysheetTableContent" class="luckysheetTableContent"></canvas>'+'<table class="luckysheet-grid-window-2" cellspacing="0" cellpadding="0" dir="ltr" tabindex="-1" >'+'<tbody>'+'<tr>'+'<td valign="top" class="luckysheet-paneswrapper">'+'<div class="luckysheet-left-top" id="luckysheet-left-top"> </div>'+'</td>'+'<td valign="top" class="luckysheet-paneswrapper">'+'<div id="luckysheet-cols-h-c" class="luckysheet-cols-h-c">'+'<div class="luckysheet-cols-change-size" id="luckysheet-cols-change-size"></div>'+'<div class="luckysheet-cols-menu-btn luckysheet-mousedown-cancel" id="luckysheet-cols-menu-btn"><i class="fa fa-caret-down luckysheet-mousedown-cancel" aria-hidden="true"></i></div>'+'<div class="luckysheet-cols-h-hover" id="luckysheet-cols-h-hover"></div>'+'<div id="luckysheet-cols-h-selected"></div>'+'<div class="luckysheet-grdusedrange"></div>'+'<div class="luckysheet-grdblkflowpush"></div>  ${columnHeader}'+'</div>'+'</td>'+'</tr>'+'<tr>'+'<td valign="top" class="luckysheet-paneswrapper">'+'<div class="luckysheet-rows-h" id="luckysheet-rows-h">'+'<div class="luckysheet-rows-change-size" id="luckysheet-rows-change-size"></div>'+'<div class="luckysheet-rows-h-hover" id="luckysheet-rows-h-hover"></div>'+'<div id="luckysheet-rows-h-selected"></div>'+'<div class="luckysheet-grdusedrange"></div>'+'<div class="luckysheet-grdblkflowpush"></div> ${rowHeader}'+'</div>'+'</td>'+'<td valign="top" class="luckysheet-paneswrapper">'+'<div class="luckysheet-cell-loading" id="luckysheet-cell-loading">'+'<div class="luckysheet-cell-loading-inner">'+'<i class="fa fa-circle-o-notch fa-spin"></i>'+'<span></span>'+'</div>'+'</div>'+'<div class="luckysheet-cell-freezen"></div>'+'<div class="luckysheet-scrollbars luckysheet-scrollbar-ltr luckysheet-scrollbar-x" id="luckysheet-scrollbar-x"><div></div></div>'+'<div class="luckysheet-scrollbars luckysheet-scrollbar-ltr luckysheet-scrollbar-y" id="luckysheet-scrollbar-y"><div></div></div>'+'<div class="luckysheet-cell-main " id="luckysheet-cell-main">'+'<div id="luckysheet-formula-functionrange"></div>'+'<div id="luckysheet-formula-functionrange-select" class="luckysheet-selection-copy luckysheet-formula-functionrange-select">'+'<div class="luckysheet-selection-copy-top luckysheet-copy"></div>'+'<div class="luckysheet-selection-copy-right luckysheet-copy"></div>'+'<div class="luckysheet-selection-copy-bottom luckysheet-copy"></div>'+'<div class="luckysheet-selection-copy-left luckysheet-copy"></div>'+'<div class="luckysheet-selection-copy-hc"></div>'+'</div>'+'<div class="luckysheet-row-count-show luckysheet-count-show" id="luckysheet-row-count-show"></div>'+'<div class="luckysheet-column-count-show luckysheet-count-show" id="luckysheet-column-count-show"></div>'+'<div class="luckysheet-change-size-line" id="luckysheet-change-size-line"></div>'+'<div class="luckysheet-cell-selected-focus" id="luckysheet-cell-selected-focus"></div>'+'<div id="luckysheet-selection-copy"></div>'+'<div id="luckysheet-chart-rangeShow"></div>'+'<div class="luckysheet-cell-selected-extend" id="luckysheet-cell-selected-extend"></div>'+'<div class="luckysheet-cell-selected-move" id="luckysheet-cell-selected-move"></div>'+'<div id="luckysheet-cell-selected-boxs">'+'<div id="luckysheet-cell-selected" class="luckysheet-cell-selected">'+'<div class="luckysheet-cs-inner-border"></div>'+'<div class="luckysheet-cs-fillhandle"></div>'+'<div class="luckysheet-cs-inner-border"></div>'+'<div class="luckysheet-cs-draghandle-top luckysheet-cs-draghandle"></div>'+'<div class="luckysheet-cs-draghandle-bottom luckysheet-cs-draghandle"></div>'+'<div class="luckysheet-cs-draghandle-left luckysheet-cs-draghandle"></div>'+'<div class="luckysheet-cs-draghandle-right luckysheet-cs-draghandle"></div>'+'<div class="luckysheet-cs-touchhandle luckysheet-cs-touchhandle-lt"><div class="luckysheet-cs-touchhandle-btn"></div></div>'+'<div class="luckysheet-cs-touchhandle luckysheet-cs-touchhandle-rb"><div class="luckysheet-cs-touchhandle-btn"></div></div>'+'</div>'+'</div>'+'<div id="luckysheet-postil-showBoxs"></div>'+'<div id="luckysheet-multipleRange-show"></div>'+'<div id="luckysheet-dynamicArray-hightShow"></div>'+'<div class="luckysheet-cell-copy"></div>'+'<div class="luckysheet-grdblkflowpush"></div>  ${flow}'+'</div>'+'</td>'+'</tr>'+'</tbody>'+'</table>'+'</div>'+'<div class="luckysheet-sheet-area luckysheet-noselected-text" id="luckysheet-sheet-area">'+'<div id="luckysheet-sheets-add" class="btn btn-default luckysheet-sheets-add"><i class="fa fa-plus"></i></div>'+'<div id="luckysheet-sheets-m" class="btn btn-default luckysheet-sheets-m"><i class="fa fa-bars"></i></div>'+'<div class="luckysheet-sheet-container" id="luckysheet-sheet-container">'+'<div class="docs-sheet-fade docs-sheet-fade-left" style="display: none;">'+'<div class="docs-sheet-fade3"></div>'+'<div class="docs-sheet-fade2"></div>'+'<div class="docs-sheet-fade1"></div>'+'</div>'+'<div class="docs-sheet-fade docs-sheet-fade-right" style="display: none;">'+'<div class="docs-sheet-fade1"></div>'+'<div class="docs-sheet-fade2"></div>'+'<div class="docs-sheet-fade3"></div>'+'</div>'+'<div class="luckysheet-sheet-container-c" id="luckysheet-sheet-container-c"></div>'+'</div>'+'<div id="luckysheet-sheets-leftscroll" class="btn btn-default luckysheet-sheets-scroll"><i class="fa fa-caret-left"></i></div>'+'<div id="luckysheet-sheets-rightscroll" class="btn btn-default luckysheet-sheets-scroll"><i class="fa fa-caret-right"></i></div>'+'</div>'+'</div>'+'<div class="luckysheet-stat-area">'+'<div class="luckysheet-sta-c">'+'<div class="luckysheet-sta-content" id="luckysheet-sta-content"></div>'+'<div class="luckysheet-bottom-content" id="luckysheet-bottom-content-show"></div>'+'</div>'+'</div>'+'</div>'+'<div id="luckysheet-copy-content" contenteditable="true"></div>'+'<input id="luckysheet-copy-btn" type="button" data-clipboard-target="luckysheet-copy-content">'+'<div id="testdpidiv" style="height: 1in; left: -100%; position: absolute; top: -100%; width: 1in;"></div>'+'</div>',columeHeader_word=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'],columeHeader_word_index={'A':0,'B':1,'C':2,'D':3,'E':4,'F':5,'G':6,'H':7,'I':8,'J':9,'K':10,'L':11,'M':12,'N':13,'O':14,'P':15,'Q':16,'R':17,'S':18,'T':19,'U':20,'V':21,'W':22,'X':23,'Y':24,'Z':25},flow='<div id="luckysheet-cell-flow_${index}" class="luckysheet-cell-flow luckysheetsheetchange" style="width:${width}px;"><div class="luckysheet-cell-flow-clip"><div class="luckysheet-grdblkpush"></div>${flow}</div></div>',colsmenuHTML='',rightclickHTML='<div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-mousedown-cancel" id="luckysheet-rightclick-menu"><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel luckysheet-copy-btn" id="luckysheet-copy-btn" data-clipboard-action="copy" data-clipboard-target="#luckysheet-copy-content"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">复制</div></div><div class="luckysheet-cols-menuitem luckysheet-cols-submenu luckysheet-mousedown-cancel" id="luckysheetcopyfor"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">复制为<span class="luckysheet-submenu-arrow" style="user-select: none;">►</span></div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" id="luckysheet-copy-paste"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">粘贴</div></div>            <div id="luckysheet-cols-rows-add"><div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div>    <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">向<span class="luckysheet-cols-rows-shift-left">左</span>增加<input type="text" class="luckysheet-mousedown-cancel" placeholder="数字" value="1" style="width:40px;height:18px;margin-left:5px;"/><span class="luckysheet-cols-rows-shift-word luckysheet-mousedown-cancel">列</span><button id="luckysheet-add-lefttop" class="btn btn-primary luckysheet-copy-btn luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;">确认</button></div></div>     <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">向<span class="luckysheet-cols-rows-shift-right">右</span>增加<input type="text" class="luckysheet-mousedown-cancel" placeholder="数字" value="1" style="width:40px;height:18px;margin-left:5px;"/><span class="luckysheet-cols-rows-shift-word luckysheet-mousedown-cancel">列</span><button id="luckysheet-add-rightbottom" class="btn btn-primary luckysheet-copy-btn luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;">确认</button></div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" id="luckysheet-del-selected"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">删除选中<span class="luckysheet-cols-rows-shift-word luckysheet-mousedown-cancel">列</span></div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"><span class="luckysheet-cols-rows-shift-word luckysheet-mousedown-cancel">列</span><span class="luckysheet-cols-rows-shift-size luckysheet-mousedown-cancel">宽</span><input type="number" class="luckysheet-mousedown-cancel rcsize" min="0" max="255" placeholder="数字" value="" style="width:40px;height:18px;margin-left:5px;">px<button id="luckysheet-rows-cols-changesize" class="btn btn-primary luckysheet-copy-btn luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;">确认</button></div></div></div>       <div id="luckysheet-cols-rows-shift"> <div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div><div id="luckysheetorderbyasc" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">A-Z顺序排列</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" id="luckysheetorderbydesc"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">Z-A降序排列</div></div></div>                <div id="luckysheet-cols-rows-data"><div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div><div id="luckysheet-delete-text" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">清除内容</div></div><div id="luckysheetmatrix" class="luckysheet-cols-menuitem luckysheet-cols-submenu luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">矩阵操作选区<span class="luckysheet-submenu-arrow" style="user-select: none;">►</span></div></div><div id="luckysheetorderby" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">排序选区</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" id="luckysheetfilter"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">筛选选区</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" id="luckysheetdatavisual"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">图表生成</div></div></div>      </div> <div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-rightgclick-menu-sub luckysheet-mousedown-cancel" id="luckysheetcopyfor_sub"><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">Json<button id="luckysheet-copy-json-head" data-clipboard-action="copy" data-clipboard-target="#luckysheet-copy-content" class="btn btn-primary luckysheet-copy-btn luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;">首行为标题</button><button id="luckysheet-copy-json-nohead" class="btn btn-primary luckysheet-copy-btn luckysheet-mousedown-cancel" data-clipboard-action="copy" data-clipboard-target="#luckysheet-copy-content" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;">无标题</button></div></div><div data-clipboard-action="copy" data-clipboard-target="#luckysheet-copy-content" class="luckysheet-cols-menuitem luckysheet-copy-btn luckysheet-mousedown-cancel" id="luckysheet-copy-array1"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">一维数组</div></div><div id="luckysheet-copy-array2" data-clipboard-action="copy" data-clipboard-target="#luckysheet-copy-content" class="luckysheet-cols-menuitem luckysheet-copy-btn luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">二维数组</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"><div class="luckysheet-mousedown-cancel">多维数组</div><div><input type="number" min="1" class="luckysheet-mousedown-cancel"placeholder="行" style="width:40px;height:18px;" id="luckysheet-copy-arraymore-row"/>×<input type="number" min="1" class="luckysheet-mousedown-cancel" placeholder="列" style="width:40px;height:18px;" id="luckysheet-copy-arraymore-col"/><button id="luckysheet-copy-arraymore-confirm" data-clipboard-action="copy" data-clipboard-target="#luckysheet-copy-content" class="btn btn-primary luckysheet-copy-btn luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;">确认</button></div></div></div><div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div><div id="luckysheet-copy-diagonal" data-clipboard-action="copy" data-clipboard-target="#luckysheet-copy-content" class="luckysheet-cols-menuitem luckysheet-copy-btn luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">对角线</div></div><div data-clipboard-action="copy" data-clipboard-target="#luckysheet-copy-content" id="luckysheet-copy-antidiagonal" class="luckysheet-cols-menuitem luckysheet-copy-btn luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">反对角线</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">对角偏移<input type="number" class="luckysheet-mousedown-cancel" placeholder="偏移量" id="luckysheet-copy-diagonaloffset-value" value="1" style="width:40px;height:18px;margin-left:5px;"/>列<button id="luckysheet-copy-diagonaloffset" class="btn btn-primary luckysheet-copy-btn luckysheet-mousedown-cancel" data-clipboard-action="copy" data-clipboard-target="#luckysheet-copy-content" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;">确认</button></div></div><div id="luckysheet-copy-boolvalue" data-clipboard-action="copy" data-clipboard-target="#luckysheet-copy-content" class="luckysheet-cols-menuitem luckysheet-copy-btn luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">布尔值</div></div></div><div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-rightgclick-menu-sub luckysheet-mousedown-cancel" id="luckysheetmatrix_sub"><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">翻转<button class="btn btn-primary luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;" id="luckysheet-matrix-turn-up">上下</button><button class="btn btn-primary luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;" id="luckysheet-matrix-turn-left">左右</button></div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">翻转<button class="btn btn-primary luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;" id="luckysheet-matrix-turn-cw">顺时针</button><button class="btn btn-primary luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;" id="luckysheet-matrix-turn-anticw">逆时针</button></div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" id="luckysheet-matrix-turn-trans">转置</div></div><div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"><div class="luckysheet-mousedown-cancel">矩阵计算</div><div  class="luckysheet-mousedown-cancel"><select class="luckysheet-mousedown-cancel" style="height:24px;" id="luckysheet-matrix-cal-type"><option value="plus">加</option><option value="minus">减</option><option value="multiply">乘</option><option value="divided">除</option><option value="power">次方</option><option value="root">次方根</option><option value="log">log</option></select><input type="number" id="luckysheet-matrix-cal-value" class="luckysheet-mousedown-cancel" placeholder="数值" value="2" style="width:40px;height:18px;margin-left:5px;"/><button id="luckysheet-matrix-cal-confirm" class="btn btn-primary luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;">确定</button></div></div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">删除两端0值<button class="btn btn-primary luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;" id="luckysheet-matrix-delezero-row">按行</button><button class="btn btn-primary luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;" id="luckysheet-matrix-delezero-column">按列</button></div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">删除重复值<button class="btn btn-primary luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;" id="luckysheet-matrix-delerpt-row">按行</button><button class="btn btn-primary luckysheet-mousedown-cancel" style="margin-left:5px;padding:2px 3px;line-height:12px;font-size:12px;" id="luckysheet-matrix-delerpt-column">按列</button></div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">生成新矩阵</div></div></div>',pivottableconfigHTML='<div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-mousedown-cancel" id="luckysheet-pivotTable-config-option"> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <div class="luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">排序</span> <select class="luckysheet-mousedown-cancel" style="height:24px;" id="luckysheet-pivotTable-config-option-order"> <option selected="selected" value="default">无排序</option> <option value="asc">升序</option> <option value="desc">降序</option> </select> </div> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <div class="luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">排序依据</span> <select class="luckysheet-mousedown-cancel" style="height:24px;" id="luckysheet-pivotTable-config-option-orderby"> </select> </div> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <div class="luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">显示总计</span> <select class="luckysheet-mousedown-cancel" style="height:24px;" id="luckysheet-pivotTable-config-option-stastic"> <option  value="0">否</option> <option value="1" selected="selected">是</option> </select> </div> </div> </div> </div>',pivottablesumHTML='<div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-mousedown-cancel" id="luckysheet-pivotTable-config-option-sumtype"> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" sumtype="SUM"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">求和</span> <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;"><i class="fa fa-check luckysheet-mousedown-cancel" aria-hidden="true"></i></span> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" sumtype="COUNT"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">数值计数</span> <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;"><i class="fa fa-check luckysheet-mousedown-cancel" aria-hidden="true"></i></span> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" sumtype="COUNTA"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">计数</span> <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;"><i class="fa fa-check luckysheet-mousedown-cancel" aria-hidden="true"></i></span> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" sumtype="COUNTUNIQUE"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">去重计数</span> <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;"><i class="fa fa-check luckysheet-mousedown-cancel" aria-hidden="true"></i></span> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" sumtype="AVERAGE"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">平均值</span> <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;"><i class="fa fa-check luckysheet-mousedown-cancel" aria-hidden="true"></i></span> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" sumtype="MAX"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">最大值</span> <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;"><i class="fa fa-check luckysheet-mousedown-cancel" aria-hidden="true"></i></span> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" sumtype="MIN"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">最小值</span> <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;"><i class="fa fa-check luckysheet-mousedown-cancel" aria-hidden="true"></i></span> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" sumtype="MEDIAN"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">中位数</span> <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;"><i class="fa fa-check luckysheet-mousedown-cancel" aria-hidden="true"></i></span> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" sumtype="PRODUCT"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">乘积</span> <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;"><i class="fa fa-check luckysheet-mousedown-cancel" aria-hidden="true"></i></span> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" sumtype="STDEV"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">标准差</span> <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;"><i class="fa fa-check luckysheet-mousedown-cancel" aria-hidden="true"></i></span> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" sumtype="STDEVP"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">整体标准差</span> <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;"><i class="fa fa-check luckysheet-mousedown-cancel" aria-hidden="true"></i></span> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" sumtype="VAR"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">方差</span> <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;"><i class="fa fa-check luckysheet-mousedown-cancel" aria-hidden="true"></i></span> </div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" sumtype="VARP"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> <span class="luckysheet-mousedown-cancel">整体方差</span> <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;"><i class="fa fa-check luckysheet-mousedown-cancel" aria-hidden="true"></i></span> </div> </div> </div>',sheetHTML='<div style="${style}" id="luckysheet-sheets-item${index}" data-index="${index}" class="luckysheet-sheets-item ${active}"><span class="luckysheet-sheets-item-name" spellcheck ="false" contenteditable="false">${name}</span> <span class="luckysheet-sheets-item-menu luckysheet-mousedown-cancel"><i class="fa fa-sort-desc luckysheet-mousedown-cancel"></i></span>${colorset}</div>',columnHeaderHTML='<div class="luckysheet-cols-h-cells luckysheetsheetchange"  id="luckysheet-cols-h-cells_${index}" style="width:${width}px;"> <div class="luckysheet-cols-h-cells-c"> <div class="luckysheet-grdblkpush"></div>${column}</div></div>',sheetselectlistHTML='<div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-mousedown-cancel" id="luckysheet-sheet-list">${item}</div>',sheetselectlistitemHTML='<div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"  id="luckysheet-sheet-btn${index}" data-index="${index}"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="${style}" ><span class="icon luckysheet-mousedown-cancel">${icon}</span>${name}</div></div>',inputHTML='<div dir="ltr"><div class="luckysheet-input-box-index" id="luckysheet-input-box-index"></div><div id="luckysheet-input-box" spellcheck="false" aria-hidden="false" class="luckysheet-input-box"><div class="luckysheet-cell-input editable" tabindex="0" role="combobox" contenteditable="true" id="luckysheet-rich-text-editor" dir="ltr" g_editable="true" aria-autocomplete="list"></div></div></div>',modelHTML='<div id="${id}" style="${style}" class="luckysheet-modal-dialog ${addclass}" tabindex="0" role="dialog" aria-labelledby=":41e" dir="ltr"> <div class="luckysheet-modal-dialog-title luckysheet-modal-dialog-title-draggable"> <span class="luckysheet-modal-dialog-title-text" role="heading">${title}</span>	 <span class="luckysheet-modal-dialog-title-close" role="button" tabindex="0" aria-label="关闭"><i class="fa fa-times" aria-hidden="true"></i></span> </div> <div class="luckysheet-modal-dialog-content">${content}</div> <div class="luckysheet-modal-dialog-buttons">	 ${botton} </div></div>',maskHTML='<div class="luckysheet-modal-dialog-mask" id="luckysheet-modal-dialog-mask"></div>',filtermenuHTML='<div class="luckysheet-cols-menu luckysheet-mousedown-cancel luckysheet-filter-menu" id="luckysheet-${menuid}-menu"><div id="luckysheet-${menuid}-orderby-asc" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">以A-Z升序排列</div></div><div id="luckysheet-${menuid}-orderby-desc" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"><div style="width:205px;" class="luckysheet-mousedown-cancel">以Z-A降序排列</div></div></div> <div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div><div id="luckysheet-${menuid}-orderby-color" class="luckysheet-cols-menuitem luckysheet-cols-submenu luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="position: relative;">按颜色筛选<span class="luckysheet-submenu-arrow" style="user-select: none;right: 0;">►</span></div></div><div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" id="luckysheet-${menuid}-bycondition" style="padding-top:0px;padding-bottom:0px;"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"><i class="fa fa-caret-right" aria-hidden="true"></i> 按条件过滤</div></div> <div class="luckysheet-${menuid}-bycondition" style="display:none;"><div class="luckysheet-flat-menu-button luckysheet-mousedown-cancel" id="luckysheet-${menuid}-selected"><span class="luckysheet-mousedown-cancel" data-value="null" data-type="0">无</span><div class="luckysheet-mousedown-cancel"><i class="fa fa-sort" aria-hidden="true"></i></div></div><div class="luckysheet-${menuid}-selected-input"><input type="text" placeholder="输入筛选值" class="luckysheet-mousedown-cancel" /></div><div class="luckysheet-${menuid}-selected-input luckysheet-${menuid}-selected-input2"><span>从</span><input type="text" placeholder="范围开始" class="luckysheet-mousedown-cancel" /><span>到</span><input type="text" placeholder="范围结束" class="luckysheet-mousedown-cancel" /></div></div> <div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" id="luckysheet-${menuid}-byvalue" style="padding-top:0px;padding-bottom:0px;"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"><i class="fa fa-caret-right" aria-hidden="true"></i> 按值过滤</div></div> <div class="luckysheet-${menuid}-byvalue"><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel luckysheet-mousedown-${menuid}-byvalue-btn"><span id="luckysheet-${menuid}-byvalue-btn-all" class="luckysheet-mousedown-cancel">全选</span> - <span id="luckysheet-${menuid}-byvalue-btn-clear" class="luckysheet-mousedown-cancel">清除</span> - <span id="luckysheet-${menuid}-byvalue-btn-contra" class="luckysheet-mousedown-cancel">反选</span> <div><i class="fa fa-${menuid} luckysheet-mousedown-cancel" aria-hidden="true"></i></div></div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="padding-left:3px; padding-right:3px;"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"><input type="text" placeholder="按照值进行筛选" class="luckysheet-mousedown-cancel" id="luckysheet-${menuid}-byvalue-input" /><div class="luckysheet-${menuid}-byvalue-input-icon luckysheet-mousedown-cancel"><i class="fa fa-search luckysheet-mousedown-cancel" aria-hidden="true"></i></div></div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div id="luckysheet-${menuid}-byvalue-select" class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"></div></div></div> <div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"><div class="btn btn-primary luckysheet-mousedown-cancel" id="luckysheet-${menuid}-confirm">确 认</div> <div class="btn btn-default luckysheet-mousedown-cancel" id="luckysheet-${menuid}-cancel">取 消</div> <div class="btn btn-danger luckysheet-mousedown-cancel" id="luckysheet-${menuid}-initial">清除筛选</div></div></div> </div>',filtersubmenuHTML='<div style="z-index:1004;overflow-y:auto;" class="luckysheet-filter-submenu luckysheet-cols-menu luckysheet-mousedown-cancel" id="luckysheet-${menuid}-submenu"><div data-value="null" data-type="0" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">无</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="cellnull"  data-type="0"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">单元格为空</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="cellnonull"  data-type="0"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">单元格有数据</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="textinclude"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">文本包含</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="textnotinclude"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">文本不包含</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="textstart"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">文本开头为</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="textend"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">文本结尾为</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="textequal"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">文本等于</div></div>  <div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div>  <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="dateequal"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">日期等于</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="datelessthan"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">日期早于</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="datemorethan"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">日期晚于</div></div> <div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="morethan"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">大于</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="moreequalthan"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">大于等于</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="lessthan"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">小于</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="lessequalthan"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">小于等于</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="equal"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">等于</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="noequal"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">不等于</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="include"  data-type="2"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">介于</div></div><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-value="noinclude" data-type="2"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">不在其中</div></div> </div>',sheetconfigHTML=' <div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-mousedown-cancel" id="luckysheet-rightclick-sheet-menu"> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" id="luckysheetsheetconfigdelete"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">删除</div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" id="luckysheetsheetconfigcopy"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">复制</div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" id="luckysheetsheetconfigrename"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">重命名</div> </div> <div class="luckysheet-cols-menuitem luckysheet-cols-submenu luckysheet-mousedown-cancel" id="luckysheetsheetconfigcolor"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel"> 更改颜色 <span class="luckysheet-submenu-arrow" style="user-select: none;">►</span> </div> </div> <div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" id="luckysheetsheetconfighide"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">隐藏</div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" id="luckysheetsheetconfigshow"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">取消隐藏</div> </div> <div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div> <div id="luckysheetsheetconfigmoveleft" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">向左移</div> </div> <div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" id="luckysheetsheetconfigmoveright"> <div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">向右移</div> </div> </div> <div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-rightgclick-menu-sub luckysheet-mousedown-cancel" id="luckysheetsheetconfigcolor_sub"><div id="luckysheetsheetconfigcolorreset" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">重置颜色</div></div> <div class="luckysheet-mousedown-cancel"> <div class="luckysheet-mousedown-cancel"> <input type="text" id="luckysheetsheetconfigcolorur" /> </div> </div> </div>';var luckysheetPivotTableHTML='<div id="luckysheet-modal-dialog-slider-pivot" class="luckysheet-modal-dialog-slider luckysheet-modal-dialog-slider-pivot"> <div class="luckysheet-modal-dialog-slider-title"> <span>数据透视表</span> <span id="luckysheet-modal-dialog-slider-close" title="关闭"><i class="fa fa-times" aria-hidden="true"></i></span> </div> <div class="luckysheet-modal-dialog-slider-content"> <div class="luckysheet-modal-dialog-slider-range"> <div id="luckysheet-dialog-pivotTable-range"></div> <div id="luckysheet-dialog-pivotTable-range-seleted">编辑范围</div> </div> <div class="luckysheet-modal-dialog-slider-list-title"> 选择需要添加到数据透视表的字段 <span title="清除所有已选字段" id="luckysheet-dialog-pivotTable-clearitem">清除</span></div> <div id="luckysheet-modal-dialog-pivotTable-list" class="luckysheet-modal-dialog-slider-list luckysheet-scrollbars"> </div> <div class="luckysheet-modal-dialog-slider-config-c"> <div class="luckysheet-modal-dialog-slider-config luckysheet-modal-dialog-config-filter"> <div> <span><i class="fa fa-filter luckysheet-mousedown-cancel" aria-hidden="true"></i> 筛选</span> </div> <div id="luckysheet-modal-dialog-config-filter" class="luckysheet-modal-dialog-slider-config-list luckysheet-scrollbars"> </div> </div> <div class="luckysheet-modal-dialog-slider-config luckysheet-modal-dialog-config-row"> <div> <span><i class="fa fa-list-alt" aria-hidden="true"></i> 行</span> </div> <div id="luckysheet-modal-dialog-config-row" class="luckysheet-modal-dialog-slider-config-list luckysheet-scrollbars"> </div> </div> <div class="luckysheet-modal-dialog-slider-config luckysheet-modal-dialog-config-column"> <div> <span><i class="fa fa-indent" aria-hidden="true"></i> 列</span> </div> <div id="luckysheet-modal-dialog-config-column" class="luckysheet-modal-dialog-slider-config-list luckysheet-scrollbars"> </div> </div> <div class="luckysheet-modal-dialog-slider-config luckysheet-modal-dialog-config-value"> <div> <span><i class="fa fa-cube" aria-hidden="true"></i> 数值</span> <span style="float: right;margin-right: 10px;display:none;" id="luckysheetpivottablevaluecolrowshow"><label style="padding:0px 5px;margin:0px;font-size:12px;height:15px;line-height:15px;" title="统计字段显示为列" for="luckysheetpivottablevaluecolrow">列</label> <input type="radio" checked="checked" value="1" name="luckysheetpivottablevaluecolrow" id="luckysheetpivottablevaluecolrow" /> <label style="padding:0px 5px;margin:0px;font-size:12px;height:15px;line-height:15px;" title="统计字段显示为行" for="luckysheetpivottablevaluecolrow1">行</label> <input type="radio" value="0" name="luckysheetpivottablevaluecolrow" id="luckysheetpivottablevaluecolrow1" /></span></div> <div id="luckysheet-modal-dialog-config-value" class="luckysheet-modal-dialog-slider-config-list luckysheet-scrollbars"> </div> </div> </div> </div> </div>';var luckysheetAlternateformatHtml='<div id="luckysheet-modal-dialog-slider-alternateformat" class="luckysheet-modal-dialog-slider luckysheet-modal-dialog-slider-alternateformat" style="display: block;">'+'<div class="luckysheet-modal-dialog-slider-title">'+'<span>交替颜色</span>'+'<span class="luckysheet-model-close-btn" title="关闭">'+'<i class="fa fa-times" aria-hidden="true"></i>'+'</span>'+'</div>'+'<div class="luckysheet-modal-dialog-slider-content">'+'<div class="textTitle">应用范围</div>'+'<div id="luckysheet-alternateformat-range">'+'<input class="formulaInputFocus" placeholder="请选择应用范围"/>'+'<i class="fa fa-table" aria-hidden="true"></i>'+'</div>'+'<div id="luckysheet-alternateformat-checkbox">'+'<div class="cf">'+'<input type="checkbox" id="luckysheet-alternateformat-rowHeader"/>'+'<label for="luckysheet-alternateformat-rowHeader">页眉</label>'+'</div>'+'<div class="cf">'+'<input type="checkbox" id="luckysheet-alternateformat-rowFooter"/>'+'<label for="luckysheet-alternateformat-rowFooter">页脚</label>'+'</div>'+'</div>'+'<div class="textTitle">格式样式</div>'+'<div id="luckysheet-alternateformat-modelList" class="cf"></div>'+'<div class="textTitle">自定义</div>'+'<div id="luckysheet-alternateformat-modelCustom" class="cf"></div>'+'<div id="luckysheet-alternateformat-modelToning">'+'<div class="toningbox header">'+'<div class="toningShow"> 页眉 </div>'+'<div class="luckysheet-color-menu-button-indicator" title="点击选择文本颜色" style="border-bottom-color: #000;margin-right: 10px;"> <div class="luckysheet-icon luckysheet-inline-block"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-text-color" style="user-select: none;"> </div> </div> </div>'+'<div class="luckysheet-color-menu-button-indicator" title="点击选择单元格颜色" style="border-bottom-color: #fff;"> <div class="luckysheet-icon luckysheet-inline-block"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-cell-color" style="user-select: none;"> </div> </div> </div>'+'</div>'+'<div class="toningbox ctOne">'+'<div class="toningShow"> 颜色1 </div>'+'<div class="luckysheet-color-menu-button-indicator" title="点击选择文本颜色" style="border-bottom-color: #000;margin-right: 10px;"> <div class="luckysheet-icon luckysheet-inline-block"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-text-color" style="user-select: none;"> </div> </div> </div>'+'<div class="luckysheet-color-menu-button-indicator" title="点击选择单元格颜色" style="border-bottom-color: #fff;"> <div class="luckysheet-icon luckysheet-inline-block"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-cell-color" style="user-select: none;"> </div> </div> </div>'+'</div>'+'<div class="toningbox ctTwo">'+'<div class="toningShow"> 颜色2 </div>'+'<div class="luckysheet-color-menu-button-indicator" title="点击选择文本颜色" style="border-bottom-color: #000;margin-right: 10px;"> <div class="luckysheet-icon luckysheet-inline-block"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-text-color" style="user-select: none;"> </div> </div> </div>'+'<div class="luckysheet-color-menu-button-indicator" title="点击选择单元格颜色" style="border-bottom-color: #fff;"> <div class="luckysheet-icon luckysheet-inline-block"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-cell-color" style="user-select: none;"> </div> </div> </div>'+'</div>'+'<div class="toningbox footer">'+'<div class="toningShow"> 页脚 </div>'+'<div class="luckysheet-color-menu-button-indicator" title="点击选择文本颜色" style="border-bottom-color: #000;margin-right: 10px;"> <div class="luckysheet-icon luckysheet-inline-block"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-text-color" style="user-select: none;"> </div> </div> </div>'+'<div class="luckysheet-color-menu-button-indicator" title="点击选择单元格颜色" style="border-bottom-color: #fff;"> <div class="luckysheet-icon luckysheet-inline-block"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-cell-color" style="user-select: none;"> </div> </div> </div>'+'</div>'+'</div>'+'<button id="luckysheet-alternateformat-remove" class="btn btn-default" style="margin: 10px;">移除交替颜色</button>'+'</div>'+'</div>';var luckysheetchartpointconfigHTML='<div class="luckysheet-chart-point-config"> <div class="luckysheet-chart-point-config-set"> <div class="luckysheet-chart-point-config-left"> <div class="luckysheet-chart-point-config-left-top"> <div class="luckysheet-chart-point-searchcondition"> <div class="luckysheet-datavisual-content-row" style="margin-bottom: 0px;margin-top: 0px;height: 30px;"> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-title luckysheet-datavisual-content-column-2x" style="width:10%;white-space:nowrap;">选择维度</div> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:80%;"> <select data-tips="维度选择" name="luckysheetpointconfigsearchdim" id="luckysheetpointconfigsearchdim"> </select> </div> </div> <div class="luckysheet-datavisual-content-row" style="margin-bottom: 0px;margin-top: 3px;height: 30px;"> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-title luckysheet-datavisual-content-column-2x" style="width:10%;">排序</div> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:80%;"> <label data-tips="无排序" for="luckysheetpointconfigsearchorderno">无排序</label> <input type="radio" checked="checked" value="0" name="luckysheetpointconfigsearchorder" id="luckysheetpointconfigsearchorderno"> <label data-tips="升序" for="luckysheetpointconfigsearchorderasc">升序</label> <input type="radio" value="1" name="luckysheetpointconfigsearchorder" id="luckysheetpointconfigsearchorderasc"> <label data-tips="降序" for="luckysheetpointconfigsearchorderdesc">降序</label> <input type="radio" value="2" name="luckysheetpointconfigsearchorder" id="luckysheetpointconfigsearchorderdesc"> </div> </div> <div class="luckysheet-datavisual-content-row" style="margin-bottom: 0px;margin-top: 5px;height: 30px;"> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:90%;text-align: left;"> <select data-width="70" data-tips="按照什么方式查询" name="luckysheetpointconfigsearchtype" id="luckysheetpointconfigsearchtype"> <option value="0" selected="selected">按照名称</option> <option value="1">按排序前%</option> </select> <input data-tips="查询关于点的关键字" id="luckysheetpointconfigsearchcontent" type="text" class="luckysheet-datavisual-config-input-no" style="width:40%;" placeholder="查询内容" /> <button id="luckysheetpointconfigsearchcomfirm" class="btn btn-primary luckysheet-model-conform-btn">查询</button> </div> </div> </div> </div> <div class="luckysheet-chart-point-config-left-mid"> <span id="luckysheet-chart-point-btn-all" class="luckysheet-mousedown-cancel">全选</span> - <span id="luckysheet-chart-point-btn-clear" class="luckysheet-mousedown-cancel">清除</span> - <span id="luckysheet-chart-point-btn-contra" class="luckysheet-mousedown-cancel">反选</span><span style="text-decoration:none;color:#8D8D8D;float:right;margin-right:40px;cursor:default;" class="luckysheet-mousedown-cancel">可以直接框选数据点</span> </div> <div class="luckysheet-chart-point-config-left-bottom"> <div class="luckysheet-chart-point-searchitem-c luckysheet-noselected-text">  </div> </div> </div> <div class="luckysheet-chart-point-config-right"> <div class="luckysheet-chart-point-itemconfig"> <div class="luckysheet-datavisual-content-row" style="font-size: 16px;font-weight: bold;"> 数据点设置 </div> <div class="luckysheet-datavisual-content-row"> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-title luckysheet-datavisual-content-column-2x" style="width:10%;white-space:nowrap;">图形颜色</div> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:80%;"> <input data-tips="颜色" class="luckysheet-datavisual-config-colorOpacity" id="scattersingleitemstylecolor" type="text" data-bigclass="scattersingle" data-attr="itemstyle" data-func="color" /> </div> </div> <div class="luckysheet-datavisual-content-row"> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-title luckysheet-datavisual-content-column-2x" style="width:10%;white-space:nowrap;">图形大小</div> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:80%;"> <select data-sliderdiy="scattersingleallsymbolsizeslider" data-tips="点大小设置" name="scattersingleallsymbolsize" id="scattersingleallsymbolsize" data-width="50" data-bigclass="scattersingle" data-attr="all" data-func="symbolsize"> <option value="4" selected="selected">4px</option> <option value="6">6px</option> <option value="8">8px</option> <option value="10">10px</option> <option value="12">12px</option> <option value="14">14px</option> <option value="16">16px</option> <option value="diy">自定义</option> </select> </div> </div> <div class="luckysheet-datavisual-content-row" style="display:none;"> <div data-tips="滑动修改点大小" id="scattersingleallsymbolsizeslider" data-bigclass="scattersingle" data-attr="all" data-func="symbolsize" class="luckysheet-datavisual-config-slider" style="width:70%;" data-min="1" data-max="50" data-step="1"></div> <input data-tips="自定义点大小" data-sliderid="scattersingleallsymbolsizeslider" id="scattersingleallsymbolsizesliderdiy" type="text" class="luckysheet-datavisual-config-input" data-bigclass="scattersingle" data-attr="all" data-func="symbolsize" placeholder="请输入" style="width:10%;margin-left:10px;text-align:center;margin-right: 2px;" /><label for="scattersingleallsymbolsizesliderdiy">px</label> </div> <div class="luckysheet-datavisual-content-row"> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-title luckysheet-datavisual-content-column-2x" style="width:10%;white-space:nowrap;">图形形状</div> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:80%;"> <select data-tips="点类型设置" data-width="70" name="scattersingleallsymboltype" id="scattersingleallsymboltype" data-bigclass="scattersingle" data-attr="all" data-func="symboltype"> <option value="emptyCircle" selected="selected">空心圆</option> <option value="circle">圆形</option> <option value="emptyRectangle">空心矩形</option> <option value="rect">矩形</option> <option value="roundRect">圆角矩形</option> <option value="emptyTriangle">空心三角</option> <option value="triangle">三角形</option> <option value="emptyDiamond">空心菱形</option> <option value="diamond">菱形</option> <option value="droplet">水滴</option> <option value="pin">标注</option> <option value="arrow">箭头</option> <option value="heart">心形</option> <option value="star">星星</option> </select> </div> </div> <div class="luckysheet-datavisual-content-rowsplit-sub"></div> <div class="luckysheet-datavisual-content-row"> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-title luckysheet-datavisual-content-column-2x" style="width:10%;white-space:nowrap;">边框粗细</div> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:80%;"> <select data-sliderdiy="scattersingleitemstyleborderwidthslider" data-tips="点边框粗细" name="scattersingleitemstyleborderwidth" id="scattersingleitemstyleborderwidth" data-width="50" data-bigclass="scattersingle" data-attr="itemstyle" data-func="borderwidth"><option value="0" selected="selected">无</option> <option value="1">1px</option> <option value="2">2px</option> <option value="3">3px</option> <option value="4">4px</option> <option value="5">5px</option> <option value="6">6px</option> <option value="7">7px</option> <option value="8">8px</option> <option value="diy">自定义</option> </select> </div> </div> <div class="luckysheet-datavisual-content-row" style="display:none;"> <div data-tips="滑动修改边框粗细" id="scattersingleitemstyleborderwidthslider" data-bigclass="scattersingle" data-attr="itemstyle" data-func="borderwidth" class="luckysheet-datavisual-config-slider" style="width:70%;" data-min="12" data-max="100" data-step="1"></div> <input data-tips="自定义边框粗细" data-sliderid="scattersingleitemstyleborderwidthslider" id="scattersingleitemstyleborderwidthsliderdiy" type="text" class="luckysheet-datavisual-config-input" data-bigclass="scattersingle" data-attr="itemstyle" data-func="borderwidth" placeholder="请输入" style="width:10%;margin-left:10px;text-align:center;margin-right: 2px;" /><label for="scattersingleitemstyleborderwidthsliderdiy">%</label> </div> <div class="luckysheet-datavisual-content-row"> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-title luckysheet-datavisual-content-column-2x" style="width:10%;white-space:nowrap;">边框样式</div> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:80%;"> <select data-tips="点边框类型设置" data-width="50" name="scattersingleitemstyleborderlinetype" id="scattersingleitemstyleborderlinetype" data-bigclass="scattersingle" data-attr="itemstyle" data-func="borderlinetype"> <option value="solid" selected="selected">实线</option> <option value="dashed">虚线</option> <option value="dotted">点线</option> </select> </div> </div> <div class="luckysheet-datavisual-content-row"> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-title luckysheet-datavisual-content-column-2x" style="width:10%;white-space:nowrap;">边框颜色</div> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:80%;"> <input data-tips="点边框颜色" class="luckysheet-datavisual-config-colorOpacity" id="scattersingleitemstyleborderlinecolor" type="text" data-bigclass="scattersingle" data-attr="itemstyle" data-func="borderlinecolor" /> </div> </div> <div class="luckysheet-datavisual-content-rowsplit-sub"></div> <div class="luckysheet-datavisual-content-row"> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-title luckysheet-datavisual-content-column-2x" style="width:10%;white-space:nowrap;"><i class="fa fa-th-large" aria-hidden="true"></i> 文字标签</div> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:80%;"> <label data-tips="显示数据点的标签" data-bigclass="scattersingle" data-attr="label" data-func="labelshow" for="scattersinglelabellabelshow">显示</label> <input type="radio" checked="checked" value="1" name="scattersinglelabellabelshow" id="scattersinglelabellabelshow" data-bigclass="scattersingle" data-attr="label" data-func="labelshow"> <label data-tips="隐藏数据点的标签" data-bigclass="scattersingle" data-attr="label" data-func="labelshow" for="scattersinglelabellabelshow1">隐藏</label> <input type="radio" value="0" name="scattersinglelabellabelshow" id="scattersinglelabellabelshow1" data-bigclass="scattersingle" data-attr="label" data-func="labelshow"> </div> </div> <div class="luckysheet-datavisual-content-row" style="height:auto;line-height: initial;margin-left:auto;" showfor="scattersinglelabellabelshow1" hidefor="scattersinglelabellabelshow"> <div class="luckysheet-datavisual-content-row"> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-title luckysheet-datavisual-content-column-2x" style="width:40%;">数值比例</div> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:50%;"> <select data-tips="刻度数值放大比例" name="scattersinglelabelformatratio" id="scattersinglelabelformatratio" data-bigclass="scattersingle" data-attr="label" data-func="formatratio"> <option value="0.01">乘以100</option> <option value="0.1">乘以10</option> <option value="1" selected="selected">默认</option> <option value="10">除以10</option> <option value="100">除以100</option> <option value="1000">除以1000</option> <option value="10000">除以1万</option> <option value="100000">除以10万</option> <option value="1000000">除以一百万</option> <option value="10000000">除以一千万</option> <option value="100000000">除以一亿</option> <option value="1000000000">除以十亿</option> </select> </div> </div> <div class="luckysheet-datavisual-content-row"> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-title luckysheet-datavisual-content-column-2x" style="width:40%;white-space: nowrap;">小数位数</div> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:50%;"> <select data-tips="数值小数点位数" name="scattersinglelabelfloatlen" id="scattersinglelabelfloatlen" data-bigclass="scattersingle" data-attr="label" data-func="floatlen"> <option value="auto" selected="selected">自动显示</option> <option value="0">整数</option> <option value="1">1位小数</option> <option value="2">2位小数</option> <option value="3">3位小数</option> <option value="4">4位小数</option> <option value="5">5位小数</option> <option value="6">6位小数</option> <option value="7">7位小数</option> <option value="8">8位小数</option> </select> </div> </div> <div class="luckysheet-datavisual-content-row"> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-title luckysheet-datavisual-content-column-2x" style="width:20%;">标签格式</div> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:70%;"> <select data-sliderdiy="scattersinglelabelcontentformatslider" data-tips="标签显示格式" name="scattersinglelabelcontentformat" id="scattersinglelabelcontentformat" data-bigclass="scattersingle" data-attr="label" data-func="contentformat"> <option value="default" selected="selected">默认</option> <option value="1">仅数据名</option> <option value="2">数据名+2维数值</option> <option value="5">数据名+全部数值</option> <option value="diy">自定义</option> </select> </div> </div> <div style="display:none;"> <div class="luckysheet-datavisual-content-row" id="scattersinglelabelcontentformatslider"> <div style="text-align:center; width:60px; display:inline-block;">数据名称</div> <label data-tips="是否显示数据名" data-bigclass="scattersingle" data-attr="label" data-func="scattersingledatalabelshow" for="scattersinglelabeldatalabelshow" style="font-weight:bold;"><i class="fa fa-eye" aria-hidden="true"></i></label> <input type="checkbox" checked="checked" name="scattersinglelabeldatalabelshow" id="scattersinglelabeldatalabelshow" data-bigclass="scattersingle" data-attr="label" data-func="scattersingledatalabelshow"> <input data-tips="显示在数据名前部文字" placeholder="前缀" id="scattersinglelabeldatalabelprefix" type="text" class="luckysheet-datavisual-config-input" style="width:60px;height:19px;" data-bigclass="scattersingle" data-attr="label" data-func="scattersingledatalabelprefix" /> <input data-tips="显示在数据名尾部文字" placeholder="后缀" id="scattersinglelabeldatalabelsuffix" type="text" class="luckysheet-datavisual-config-input" style="width:60px;height:19px;" data-bigclass="scattersingle" data-attr="label" data-func="scattersingledatalabelsuffix" /> <label data-tips="是否在数据名后换行" data-bigclass="scattersingle" data-attr="label" data-func="scattersingledatalabelline" for="scattersinglelabeldatalabelline" style="font-weight:bold;">换行</label> <input type="checkbox" checked="checked" name="scattersinglelabeldatalabelline" id="scattersinglelabeldatalabelline" data-bigclass="scattersingle" data-attr="label" data-func="scattersingledatalabelline"> </div> </div> <div class="luckysheet-datavisual-content-row" > <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-title luckysheet-datavisual-content-column-2x" style="width:10%;white-space:nowrap;">标签位置</div> <div class="luckysheet-datavisual-content-column luckysheet-datavisual-content-column-right luckysheet-datavisual-content-column-2x" style="width:80%;"> <select data-sliderdiy="scattersinglelabellabelplaceslider" data-tips="标签距离图形位置" data-width="70" name="scattersinglelabellabelplace" id="scattersinglelabellabelplace" data-bigclass="scattersingle" data-attr="label" data-func="labelplace"> <option value="top" selected="selected">顶端</option> <option value="left">左侧</option> <option value="right">右侧</option> <option value="bottom">底部</option> <option value="inside">内部居中</option> <option value="diy">自定义</option> <option value="insideLeft">内部左侧</option> <option value="insideRight">内部右侧</option> <option value="insideTop">内部顶端</option> <option value="insideBottom">内部底端</option> <option value="insideTopLeft">内部左上</option> <option value="insideBottomLeft">内部左下</option> <option value="insideTopRight">内部右上</option> <option value="insideBottomRight">内部右下</option> </select> </div> </div> <div class="luckysheet-datavisual-content-row" style="display:none;height:65px;"> <div data-tips="滑动修改点文本水平位置" id="scattersinglelabellabelplaceslider" data-bigclass="scattersingle" data-attr="label" data-func="labelplacediy" class="luckysheet-datavisual-config-slider" style="width:70%;" data-min="-100" data-max="100" data-step="1"></div> <input data-tips="自定义点文本水平位置" data-sliderid="scattersinglelabellabelplaceslider" id="scattersinglelabellabelplacesliderdiy" type="text" class="luckysheet-datavisual-config-input" data-bigclass="scattersingle" data-attr="label" data-func="labelplacediy" placeholder="请输入" style="width:10%;margin-left:10px;text-align:center;margin-right: 2px;" /><label for="scattersinglelabellabelplacesliderdiy">px</label> <br /> <div data-tips="滑动修改点文本垂直位置" id="scattersinglelabellabelplaceslider1" data-bigclass="scattersingle" data-attr="label" data-func="labelplacediy" class="luckysheet-datavisual-config-slider" style="width:70%;" data-min="-100" data-max="100" data-step="1"></div> <input data-tips="自定义点文本垂直位置" data-sliderid="scattersinglelabellabelplaceslider1" id="scattersinglelabellabelplaceslider1diy" type="text" class="luckysheet-datavisual-config-input" data-bigclass="scattersingle" data-attr="label" data-func="labelplacediy" placeholder="请输入" style="width:10%;margin-left:10px;text-align:center;margin-right: 2px;" /><label for="scattersinglelabellabelplaceslider1diy">px</label> </div> <div class="luckysheet-datavisual-content-row"> <label data-tips="加粗" data-bigclass="scattersingle" data-attr="label" data-func="labelbold" for="scattersinglelabellabelbold" style="font-weight:bold;"><i class="fa fa-bold" aria-hidden="true"></i></label> <input type="checkbox" name="scattersinglelabellabelbold" id="scattersinglelabellabelbold" data-bigclass="scattersingle" data-attr="label" data-func="labelbold"> <label data-tips="斜体" data-bigclass="scattersingle" data-attr="label" data-func="labelitalic" for="scattersinglelabellabelitalic" class="luckysheet-datavisual-content-column-italic"><i class="fa fa-italic" aria-hidden="true"></i></label> <input type="checkbox" name="scattersinglelabellabelitalic" id="scattersinglelabellabelitalic" data-bigclass="scattersingle" data-attr="label" data-func="labelitalic"> <select data-sliderdiy="scattersinglelabellabelfontsizeslider" data-width="50" data-tips="字体大小" name="scattersinglelabellabelfontsize" id="scattersinglelabellabelfontsize" data-bigclass="scattersingle" data-attr="label" data-func="labelfontsize"> <option value="12">12px</option> <option value="14">14px</option> <option value="16">16px</option> <option value="18">18px</option> <option value="20">20px</option> <option value="22">22px</option> <option value="24">24px</option> <option value="30">30px</option> <option value="36">36px</option> <option value="diy">自定义</option> </select> <input data-tips="字体颜色" class="luckysheet-datavisual-config-color" id="scattersinglelinelabelcolor" type="text" data-bigclass="scattersingle" data-attr="label" data-func="labelcolor" /> </div> <div class="luckysheet-datavisual-content-row" style="display:none;"> <div data-tips="滑动修改字体大小" id="scattersinglelabellabelfontsizeslider" data-bigclass="scattersingle" data-attr="label" data-func="labelfontsize" class="luckysheet-datavisual-config-slider" style="width:70%;" data-min="12" data-max="100" data-step="1"></div> <input data-tips="自定义字体大小" data-sliderid="scattersinglelabellabelfontsizeslider" id="scattersinglelabellabelfontsizesliderdiy" type="text" class="luckysheet-datavisual-config-input" data-bigclass="scattersingle" data-attr="label" data-func="labelfontsize" placeholder="请输入" style="width:10%;margin-left:10px;text-align:center;margin-right: 2px;" /><label for="scattersinglelabellabelfontsizesliderdiy">px</label> </div> </div> </div> </div> </div> <div class="luckysheet-chart-point-config-chart"> <div id="luckysheet-chart-point-config-chart-c" class="luckysheet-chart-point-config-chart-c"> </div> </div> </div>';var luckysheetToolHTML='<div id="luckysheet-tooltip-up" class="jfk-tooltip" role="tooltip" aria-hidden="true" style="left: 505px; top: 410px;"><div class="jfk-tooltip-contentId">组合图表</div><div class="jfk-tooltip-arrow jfk-tooltip-arrowup" style="left: 35.5px;"><div class="jfk-tooltip-arrowimplbefore"></div><div class="jfk-tooltip-arrowimplafter"></div></div></div>';var menuToolBar='<div class="luckysheet-toolbar-left-theme"> </div> <div class="luckysheet-toolbar-button luckysheet-inline-block" data-tips="撤销 (Ctrl+Z)" id="luckysheet-icon-undo" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-undo" style="user-select: none;"> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button luckysheet-inline-block" data-tips="重做 (Ctrl+Y)" id="luckysheet-icon-redo" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-redo" style="user-select: none;"> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button luckysheet-inline-block" data-tips="格式刷" id="luckysheet-icon-paintformat" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-paintformat" style="user-select: none;"> </div> </div> </div> </div> </div> <!--<div class="luckysheet-toolbar-separator luckysheet-inline-block" style="user-select: none;"> </div> <div class="luckysheet-toolbar-zoom-combobox luckysheet-toolbar-combo-button luckysheet-inline-block" data-tips="缩放" id="luckysheet-icon-zoom" style="user-select: none;"> <div class="luckysheet-toolbar-combo-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-combo-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div aria-posinset="4" aria-setsize="7" class="luckysheet-inline-block luckysheet-toolbar-combo-button-caption" style="user-select: none;"> <input aria-label="缩放比例" class="luckysheet-toolbar-combo-button-input luckysheet-toolbar-textinput luckysheet-mousedown-cancel" role="combobox" style="user-select: none;" tabindex="-1" type="text" value="100%"/> </div> <div class="luckysheet-toolbar-combo-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> --> <div class="luckysheet-toolbar-separator luckysheet-inline-block" style="user-select: none;"> </div> <div class="luckysheet-toolbar-button luckysheet-inline-block" data-tips="货币格式" id="luckysheet-icon-currency" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> ¥ </div> </div> </div> <div class="luckysheet-toolbar-button luckysheet-inline-block" data-tips="百分比格式" id="luckysheet-icon-percent" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> % </div> </div> </div> <div class="luckysheet-toolbar-button luckysheet-inline-block" data-tips="减少小数位数" id="luckysheet-icon-fmt-decimal-decrease" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block toolbar-decimal-icon" style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-decimal-decrease" style="user-select: none;"> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button luckysheet-inline-block" data-tips="增加小数位数" id="luckysheet-icon-fmt-decimal-increase" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block toolbar-decimal-icon" style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-decimal-increase" style="user-select: none;"> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="更多格式" id="luckysheet-icon-fmt-other" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;"> 123 </div> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-separator luckysheet-inline-block" style="user-select: none;"> </div> <div class="luckysheet-toolbar-select luckysheet-toolbar-menu-button luckysheet-inline-block" data-tooltip="字体样式" id="luckysheet-icon-font-family" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;"> 微软雅黑 </div> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-separator luckysheet-inline-block" style="user-select: none;"> </div> <div class="luckysheet-toolbar-zoom-combobox luckysheet-toolbar-combo-button luckysheet-inline-block" data-tips="字号大小" id="luckysheet-icon-font-size" style="user-select: none;"> <div class="luckysheet-toolbar-combo-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-combo-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div aria-posinset="4" aria-setsize="7" class="luckysheet-inline-block luckysheet-toolbar-combo-button-caption" style="user-select: none;"> <input aria-label="字号大小" class="luckysheet-toolbar-combo-button-input luckysheet-toolbar-textinput luckysheet-mousedown-cancel" role="combobox" style="user-select: none;" tabindex="-1" type="text" value="10"/> </div> <div class="luckysheet-toolbar-combo-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-separator luckysheet-inline-block" style="user-select: none;"> </div> <div class="luckysheet-toolbar-button luckysheet-inline-block" data-tips="粗体 (Ctrl+B)" id="luckysheet-icon-bold" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-bold" style="user-select: none;"> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button luckysheet-inline-block" data-tips="斜体 (Ctrl+I)" id="luckysheet-icon-italic" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-italic" style="user-select: none;"> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button luckysheet-inline-block" data-tips="删除线 (Alt+Shift+5)" id="luckysheet-icon-strikethrough" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-strikethrough" style="user-select: none;"> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-left luckysheet-toolbar-button luckysheet-inline-block" data-tips="文本颜色" id="luckysheet-icon-text-color" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-color-menu-button-indicator" style="border-bottom-color: rgb(0, 0, 0); user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-text-color" style="user-select: none;"> </div> </div> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-right luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="颜色选择..." id="luckysheet-icon-text-color-menu" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-separator luckysheet-inline-block" style="user-select: none;"> </div> <div class="luckysheet-toolbar-button-split-left luckysheet-toolbar-button luckysheet-inline-block" data-tips="单元格颜色" id="luckysheet-icon-cell-color" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-color-menu-button-indicator" style="border-bottom-color: rgb(255, 255, 255); user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-cell-color" style="user-select: none;"> </div> </div> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-right luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="颜色选择..." id="luckysheet-icon-cell-color-menu" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-left luckysheet-toolbar-button luckysheet-inline-block" data-tips="边框" id="luckysheet-icon-border-all" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-all" style="user-select: none;"> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-right luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="边框类型..." id="luckysheet-icon-border-menu" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-left luckysheet-toolbar-button luckysheet-inline-block" data-tips="合并单元格" id="luckysheet-icon-merge-button" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-merge" style="user-select: none;"> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-right luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="选择合并类型..." id="luckysheet-icon-merge-menu" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-separator luckysheet-inline-block" style="user-select: none;"> </div> <div class="luckysheet-toolbar-button-split-left luckysheet-toolbar-button luckysheet-inline-block" data-tips="水平对齐" id="luckysheet-icon-align" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-left" style="user-select: none;"> </div> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-right luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="对齐方式..." id="luckysheet-icon-align-menu" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-left luckysheet-toolbar-button luckysheet-inline-block" data-tips="垂直对齐" id="luckysheet-icon-valign" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-bottom" style="user-select: none;"> </div> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-right luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="对齐方式..." id="luckysheet-icon-valign-menu" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-left luckysheet-toolbar-button luckysheet-inline-block" data-tips="文本换行" id="luckysheet-icon-textwrap" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-overflow" style="user-select: none;"> </div> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-right luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="换行方式..." id="luckysheet-icon-textwrap-menu" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-left luckysheet-toolbar-button luckysheet-inline-block" data-tips="文本旋转" id="luckysheet-icon-rotation" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-none" style="user-select: none;"> </div> </div> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-right luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="旋转方式..." id="luckysheet-icon-rotation-menu" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-separator luckysheet-inline-block" style="user-select: none;"> </div> <div class="luckysheet-toolbar-button-split-left luckysheet-toolbar-button luckysheet-inline-block" data-tips="冻结首行" id="luckysheet-freezen-btn-horizontal" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;"> <i class="fa fa-list-alt"> </i> 冻结首行 </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-right luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="更多选项..." id="luckysheet-icon-freezen-menu" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-separator luckysheet-inline-block" style="user-select: none;"> </div> <div class="luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="排序和筛选" id="luckysheet-icon-autofilter" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-autofilter" style="user-select: none;"> </div> </div> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;margin-left: 0px;margin-right: 4px;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="查找替换" id="luckysheet-icon-seachmore" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;font-size: 14px;"> <i class="fa fa-search" aria-hidden="true"></i> </div> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block" style="user-select: none;margin-left: 0px;margin-right: 4px;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-left luckysheet-toolbar-button luckysheet-inline-block" data-tips="自动求和" id="luckysheet-icon-function" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-function" style="user-select: none;"> </div> </div> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;"> 求和 </div> </div> </div> </div> <div class="luckysheet-toolbar-button-split-right luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="更多函数..." id="luckysheet-icon-function-menu" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div><div class="luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="条件格式" id="luckysheet-icon-conditionformat" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;"> 条件格式 </div> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheet-toolbar-menu-button luckysheet-inline-block" data-tips="批注" id="luckysheet-icon-postil" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;"> 批注 </div> <div class="luckysheet-toolbar-menu-button-dropdown luckysheet-inline-block " style="user-select: none;"> </div> </div> </div> </div> <div class="luckysheetfulltoolbar" id="luckysheet-pivot-btn-title"> <i aria-hidden="true" class="fa fa-cube"> </i> 数据透视表 </div> <div class="luckysheetfulltoolbar" id="luckysheet-chart-btn-title"> <i class="fa fa-pie-chart"> </i> 图表 </div> <div class="luckysheetfulltoolbar" id="luckysheet-chart-btn-screenshot"> <i class="fa fa-object-group"> </i> 截图 </div> <div class="luckysheetfulltoolbar" id="luckysheet-splitColumn-btn-title"> <i class="fa fa-gg"> </i> 分列 </div>';var luckysheetlodingHTML='<div id="luckysheetloadingdata" style="width:100%;text-align:center;position:absolute;top:0px;height:100%;font-size: 16px;z-index:1000000000;background:#fff;"><div style="position:relative;top:45%;width:100%;"> <div class="luckysheetLoaderGif"></div>  <span>渲染中...</span></div></div>';// var menusetting = {
  //     menu_selectall: '<div id="luckysheet-selectall-btn-title"><i class="fa fa-i-cursor"></i> 全选</div>',
  //     menu_copy: '<div id="luckysheet-copy-btn-title"><i class="fa fa-copy"></i> 复制</div>',
  //     menu_undo: '<div id="luckysheet-redo-btn-title"><i class="fa fa-reply"></i> 撤销</div>',
  //     menu_redo: '<div id="luckysheet-undo-btn-title"><i class="fa fa-share"></i> 恢复</div>',
  //     menu_paste: '<div id="luckysheet-paste-btn-title"><i class="fa fa-clipboard"></i> 粘贴</div>',
  //     menu_download: '<div id="luckysheet-download-btn-title"><i class="fa fa-cloud-download"></i> 下载</div>',
  //     menu_share: '<div id="luckysheet-share-btn-title"><i class="fa fa-share-alt"></i> 分享</div>',
  //     menu_chart: '<div id="luckysheet-chart-btn-title"> <i class="fa fa-pie-chart"></i> 图表生成</div>',
  //     menu_pivot: '<div id="luckysheet-pivot-btn-title"> <i class="fa fa-cube" aria-hidden="true"></i> 数据透视表</div>',
  //     menu_freezenrow: '<div id="luckysheet-freezen-btn-horizontal"><i class="fa fa-list-alt"></i> 冻结首行</div>',
  //     menu_freezencolumn: '<div id="luckysheet-freezen-btn-vertical"><i class="fa fa-indent"></i> 冻结首列</div>',
  // };
  luckysheet.jfcolor=["#c1232b","#27727b","#fcce10","#e87c25","#b5c334","#fe8463","#9bca63","#fad860","#f3a43b","#60c0dd","#d7504b","#c6e579","#f4e001","#f0805a","#26c0c0","#c12e34","#e6b600","#0098d9","#2b821d","#005eaa","#339ca8","#cda819","#32a487","#3fb1e3","#6be6c1","#626c91","#a0a7e6","#c4ebad","#96dee8"];var keycode={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,PAUSE:19,CAPSLOCK:20,ESC:27,SPACE:33,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,WIN:91,WIN_R:92,MENU:93,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145};//动态表格
  var visibledatarow=[],visibledatacolumn=[],rowsplit=[],ch_width=0,rh_height=0;//各个部分高度设定
  var toolbarHeight=35,infobarHeight=30,calculatebarHeight=30,rowHeaderWidth=46,columeHeaderHeight=20,cellMainSrollBarSize=12,sheetBarHeight=27,statisticBarHeight=23,luckysheetTableContentHW=[0,0];var defaultcollen=73,defaultrowlen=19;luckysheet.defaultcollen=defaultcollen;luckysheet.defaultrowlen=defaultrowlen;var luckysheet_select_status=false,luckysheet_select_save=[{"row":[0,0],"column":[0,0]}],luckysheet_selection_range=[],luckysheet_copy_save={},luckysheet_paste_iscut=false,luckysheet_filter_save={"row":[],"column":[]};//条件格式规则
  var clearjfundo=true,config={},filterchage=true,luckysheetCellUpdate=[],luckysheetRightHeadClickIs="column";var luckysheet_sheet_move_status=false,luckysheet_sheet_move_data=[],luckysheet_scroll_status=false;var luckysheetcurrentisPivotTable=false;var devicePixelRatio=1;var luckysheetdefaultstyle=null;var luckysheet_shiftkeydown=false;luckysheet.flowdata=null;luckysheet.currentSheetIndex=0;luckysheet.luckysheet_shiftpositon=null;var jfcountfuncTimeout=null,jfautoscrollTimeout=null;luckysheet.jfredo=[];luckysheet.jfundo=[];luckysheet.modelHTML=modelHTML;var luckysheet_CFiconsImg=new Image();luckysheet_CFiconsImg.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZoAAAGACAYAAACUS6SeAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAHBbSURBVHja7J13mFxV+cc/M7OzLbvpjZBKQhISUgAhgAlVkADSRcDyky4iYAAhAmpQQtMIiqigYkV6FRHphgBBKSGBkB5IIb1sdrO72dmZ+f3xniGTzZR755a5s/t+nmefTGbuPec7Z8497ynveU9on5m3YJMuwNnAt4B9gA3A48CPgY0UyPxJUzN/MLMShxwDXAMcAmwGbgD+UlBKhzVn/+yqqwrVFwIuBL7tZnkyYwaK98yaNb/QW6uBk4DLgfHAduDfwI+ApYUmOnHiKC+0AowAfgh8EYgAvwF+AMTd1OlQ40nAtcB+QIMpzx8Cy70oT8U6YZvXn2x+tN8A44ByYE/gMmA18B9g7wB9v58AzwNfADoBA4A/m4c5KPwWuCdDef4X6KVVtF1yGPAx8IDpAFUBPYGvAguBucCRAdJ7CvAecA7QA+gKfB94DKgMiMargaeAQ0159gK+BrwNqLUoIUNzFPAw0C3L5+XmAXoZ6B+A7/ZNM3rJxDTgl2Y0UUwmAxdl+WwI8HOtou2OzwFP5+hERIAxwDPAhADoHQvcbxrvTB3PZ4HaImscDmSbmukO/F6rXWkYmgnAP4wxyUd/U/m6FPF7lQO35bnmMuCvQLSIOs/J8/npQIVW03bDPjaejWrgn8boFJPpRks2jgReKfLo+yygLMfnhwCDtPoF29CMMUam2ka6Y8wDVV2k73Uw0NvCdV9F1kOqiqQzX+WvQqfP2gsDkWlcO79nD/McFWuGoAJZk8nHAcBM8x2LwRAL1+ytVTC4hmawqeiFNHaHInPQkSJ8rxob156ILBp2LYLOkAu/kRJ8egEvFWgw+iPT0cXocJTnGSmkMxJ4zfxbDJ1WjKYSQEPTC3jBYW/qJODX+L8WMhuos3H9JDP876NVQnGZLsbIDHOQxt5mVqGTz9rrgTdtjtpmmhGOouQ1NF2MkRnmQh4XATf7/L02GyO3zcY944FZZhSnKG5QDfwLd9ZZJiBOBOU+f4evAAtsjt5eIVhec0oADU21qdDjXMxnKnCJz99tJuIpt97GPcOA14HRWjUUh5QDTyAL0W5xFPAn/J2OXoV4k75j455aZMr9ZK0GSiZDE0XWVQ7zIK+7kI2efvKO+S6f2LinnzFSB2v1UAokAvwNONaDtM82z5KfbDBG7lUb91Qi+2z+T6uDkm5oQsAfkSknrx6+P5kK6ycLkTWYj2zc0x14EYkqoCh2CCGbcL/sYR6XIDve/WQbsu/rKZvP/B+BKVotOjbpHiW/RNx9vZ5OeByZv32vwDQmG51DsOdJYne/TCdk09xXgUcdfN9DkE2urwGbXCjDLsDvEG+5rcCTSASENVqdA8HtwAU+5HOjGWn8psD7RxmDNRZ7TgZ2p+1CyMbjzkZzoR3izyGOSf8DVrrUFv0S2cvWgqyl3Qgs0SrsnaH5IfAdn/LsgrgTH2rzR031FC/ysXzKzSjsBex5sQGci2wa7ZXWIzzZ5vRDW6oR76NJ5v9VprE4wxie/2qVLirXIaFQ/OIu03l52OZ93wTuxd/NytOQdZv/2bzvGMRzNeWY1Aqch2y2djLqvK9Nx/prSKidc8wzprhI2PxoN/qcby/Tg7CzN+BbPhuZ9JHNWTbvmW4qcvr362xGH/sXqCOCrJ9NylKezwB9tUoXjfPM7+4nEdPg2pmOHoXE1itGRIyLbV7/VdNODGvTOXY6xf8rMs/e1AAPoc5Anhia64uU9zDsxSD6VhHL6ds2e2DX5RjNPYd9t/GQeThOymO8r9cqXTSKVfblyNRuZ4vXX4D/LtLpowarcdGGmPYhksXAPkhh671T8zzPVfi/HaNDGJo9LF77EWAlhvetNvK342s/oojlZGe387UWRnN2A4/ebNHQnqpVumhYfY5WIfu18vFzZO3ACt2QfWBW2KeIZVSB9ZhjV5A7MnQVst5rZ3PoNy0akckUL3xWuzU0b1h8OI5FNkLm4zc2jI2dDZUbi1hOG2xce6iFawYg61TdLVx7iemFWaGzVumi8YbFenQcsMLCtS8jrsxWz3tpKIHnCGCLxeusRK7ugkytWYl1dpIZIVmJUhLFXhgrxYKhud3Cw3GUMTZWuQ5ZuM/HEzbSfLqI5fSkjWuten+Nwto5GVNt5P2KVumike8EwTrEYeNDG2k+jkQZz8cyrHtxPlHEMnoLObfKTYPUC2ubYi/Cusfc+9jb6K1YMDTP5xhO1plh5GKb6SYRL7an8/Ss7Cye/gg5LMpvmhCPGatML9JvuQR/3GqVzLyU47dvBE6jMK/A35B9zS/1rH3X/GvV0DxVpDK6zsa1P8H61KHbsxdnaHV239CALGSex65TRNsQd793Ckw7bob+r2X5MU8E1tqsABOQHdfNPpbRbJvTDffZNExuPRyTsTfFp7jPDchO+LVtjMyZyFSYk9HS3VmesSuw546bRDaT3oi/02hbsrQF2XgT2SIQ91FjI/AldC+N66Rv2PwjcpLeoUjI/FkuVMTUD/d7Y1i24GyD4Xrg66bn3gfrIcwxUxDftZnfJxTmUn2jGdJf6sNvmBp16sMRDP6CuKEfjBzP/KbNDlWu+rsNcQqJIGGSbkKmo+wSM52hn5jnyM5xzIcj0+J2PNe2m05nzKbOvyPrML/24XdrQQKIvqVV2FtDkyrsVz1oCN0Ox7EDawuqIIt/PynAyHyALNyudtAwdMXbaAstZkrmHa3KgSJms/dudSRyHfamn6zMOnxq4/pTTaNvx8hsAk5w0ID/BnGaucnD3yuJzOg8o1XXG9r7oVoRJFyL3T0Os5BgnKtdqLxeOTHETfovazVWfOAi4BGbo5+V5jlyOkqYDvzCw+92HTKbo6ihsU3Kz/58m/c9jbhyb3FBQwvZ16mccpk+HIpP/BCJJmAnztl84PNY23tnhSke1fefYW/vn6KG5jO6IN50dsNU/AGZimpyUUtqnWqei2neSuHBFBXFKiHECcFuiKo3kVBJK13UkkQ2XLo5Q3A/cI3+zGpoCuVeYGIBw/ML8cbLpQ44GncW7H+Hu/P0ipKNb2Mv/BLIOscXsLa52y6tZobgPy6k9SIy9ZzUn1kNTaF80ca1CeByxDXVy0q3AZmSW+UgjaeRSAH6cCh+MNnm9X9CHAYaPdTUiERBn+sgjbdMGi36EwfT0Fhp4BIB+F5Wp75akLDgfp1YuBw4nsLOpXkDeyFJFMUp221ce5sZIbT6oKvOjJoKmSFYgkxlN+rPG1xDk8+luIlgbBq0Emaj3jT6D/msbR7i7tlo857j9eFoN6x04VnzAysRBJLIQv1Un0fahcwQrEK2LOjG5oAbmnxeH48he1yKzfQ8lWkdEjn6pSLpewtxVGix+HAcj/2D15Tg8mCekf/7uOs84kTnm3lmBL4G3FkkfXZmCOrMtUu1+vlPmc3r/4UsRl+Y5Ue/MiDfa7UZNfyT3Q9XW4as4RR7J/1LyE7k+5Aw722JmYf8Apyt6yjBYw4Su+8nGT7bioSxCQIJJAzVv9j9wL4G4HTEu7OYzEPWkv6BRDloS9xcc4mbxnvWrPmB+IEmThxVEhW+EGeAi82PNtf0aFYju4UPCtiQ9H/AOGT9ZRUyrfcY4tsflHAtTyIhzi/NUJ79kHAfi1HaIzchMdBmI7H7NpsRxEFmRBMU1iMenFORM6l2GM2HB8DIpD/rQ0x5vmnKcxMyA7M3sJ/RrJTIiAZkHva3WDsGoNisQTzKLg+wxjpjWH6t1bFDUY1sgEyav4TpfScCqLUJWey/LcDl2YRELnikBH77k5EDEsebkeG/KF50en8MzfxJU/WRd4MZM7QMFKschhy/nD6tW4XExTsL2U1/BR3wfKHUVFCxp6Y8nJK6po3BrgK+gawfTQIW6IimKI9kM4rSjvgcsh+qS5bPI8AYZOPjUbgYTXjixFFWGvAIsmbY3fzb9nWuz3Yga7h3k8VrzmEDPhwYbUYBb2L9VNFUg/4dY8hHmbZvCTKd/jNkbcxrRpL97K+eSJifw9XQKIrihH2AZ3MYmXSqEWeWI/HOA60PEl7mc0APYzScHAdebXrs1yBrjlchO/Cd0h/4K3BE2nv1yHTTneR3q+6OBJ8dl6Hhv96MJCfhvdPN2eSOF3cYMJBguLa7a2hGvVb8eHLtYvruqquCo0Wn8YLIQGTxvJeNe3oYw3SIB41gZyRK+TCPvu9Y4DkkUsA/HKTTAwlKO7jN+7XAz5HF/kvzGJvpGYxMOoMR54xvelwHBlu4ZkB7NDRhff4VxXN6Ie7s/Qvszb9s00BZ4bseGpkUEeTQw04O0rg+TwN9CRIMN9dIYYKFfD7nR8fewjWh9vgAhB1WgM3m73qUFF8CPkRCcSR9+ms1eZ6kxR84uhgj46RR39uMCjq5qOsMn75/byQieqGcbuGac5GTTbMZGysLvT20qgbP0HzJDDVTi4A3aSP3GX9GFhsjPuYZMXn+RYs/UFQjrqtjXEhrAuJEUO6StmE+lsP3HdxrdRR4DvBwlvKxEkm6m1bXYBma/mTe8zHDg+F9KfJQB81b2ZVyJObeIS6meRQSIdmNToyf+3VGOrjXztrUaYgXWUUBhqYC8UxTAmBouiCLk/2z9JAecrHHVapcgr1z2N3ieiRqg1J8IsDfkKCPbnM27kQb93OjipN1h6dsXn8iMs1Ynfae1dNydVTjEWU2H57780wDHImc7X2JawpnVgantKzv6TkTWcD1y+g+CNyi1TkQhJCoGV/2uDOzFvixgzQeBg70qUycbIb7MbKTfqCNe44xHeITkb02dgzNp1qFizuiuQsJVJmPb2H/VL72xuv4d3rf28D56GFoQeF2JBCq19zosEP3K5wdHmYHJxHdNxrDYfdY6FQsti42DI1Th4Awspb2JSRWoRuUIxs5601Z/AUY2l4NzVSblfpOZD7ZbWqR8A2fIHPMXnlxJUwet5k8C+F+vD9y+VO8P9FQsc51wNU+5neXGT0XOso4GtnJPx8JTPk8Mv39G2QH+/eQTZfFrl+LjOH42OZ9hyAef1an7pxMnU0GFiLBO59Gotmf5fB7p6ZgLwJqjCH8OhL9e3IpPRhWps5OQjY82SFqKuwhuBcpuRqYiQSi82P6YyCyw/lYJOJzIQ/brchu8G94NB1xGnqEQFA4r4DnxCkRZMf8RmSqtpDRwkU5Pu9sjE91AMp3ObJz/kUkFI1VDjDPoJeG5qtmpBFuMxL5i2k3nnbQkcg0BVuDxMo7gBKJjZZvRDMBeIDCvNN6Il43XVzSer1PRqYt43G2T+jCAhsBK+m+hRIUirWXrNw0Op1dTrcaibc2IUBlvBIJQ/NRAd/FK0OzN7JhNJylw/2AMZB2yTeLVF2Ejo0nhmYvdvfesMu+Zujnhjvm2UUsJyd5t5iRh5vxqm435aoEhz0sXrcKCf2Sj59j7QTWVAPpZiesCvH2mhTAcl6DTKPN8SDtQgzNVezuTt3WIDyNhOSxyiVkD76ZzomzZs0vD8ohbIUYmi7IoVxu7Is50WKh5WPPIpaT07zrkLUUNw6Gewbv134U+7xh4ZoNyJn1VmJZvWw6OHGL+Te49D1SI6QvBLisNyDrS28HwNAcYOGaLsiU3xAL156ETJmFLP5WnUrh4QhnEf847uxmTnENcra4E1YXsZzcyHsp4o3iZGH1Q1OOcZSgkc+9vM50uj60kebjwGUWrlsGvOfCdyhDXOWPd7ls6jwo783GGL7uYprdC7hnq8XremFt8+73sD4D9DbWPeoCZ2juxRuPsd/hbL73gSKWk1t5v2V6qYW4Im9Czm+vQwkiL5F9zrwRmT79bwHp/ibPCDaJBMh06t6e8nA6tYTKvM6MEP9TREPzQ6xPcbo9qju7VH6otoZmKvB/HuVVaXpo/Qu8fzrezMvmYw7uLro9jf2pr1bEjXUJSpC5wTw/a9sYmdQGXiejpbszvB9HTuL8h0PdISTK8lds3vc84tJbTBrMCOzfLqRVyNTZm/i3Zy69Tn2plNqDdEPzVdxZS8lFP2Nsqgss3MOQmGp+nNewAlmQPQz39xHcanqqVvku3niuKe7zF8Q1/jAzihmKHGDmlMuMwdkCbEPW6j6P83A0IVMXv2nzvv+Y0Y9fvfnO5rvOR6ahlwLvINNHM3FnDbdQ9+b7kdM7/aDFzGyUlMdpah/NocB9+HMWwoGIO+A5BfQC6pENcVdT+lyGnLORb+PVPVl6s0pwiSGHdblJ0oyE3XYE+Tn2Y+S9ifP1Rrsd4ieREFde4mTD5q+RdZhpHupLmtHTC6X2QKQMzSP4GwzzLMTdN/8I6rBm2ilxZI71NbI7XrwCXK7ttuIRl5vRsh3eMZ2jeh91nuaDkXFqaEDCAvVCTvz0gmvN6KnkCJthc78i5D0dCT7YkalD5pcz7e5fisyZt6Ao7lNlGkY7zAO+yK4OKVY2czvtLZ7uU5m40au9zCNjcCvw01KtbGG8jTJrZWTT0VlF5iCkV+LOvhtFycQEoKuN6z9C9q5savO+lViAOxxqHe5TmfzZhTRS01vPuKjLj7iJnhua85EFNj/3ZsRNnv+nzzsgXkM3ID75683rp7VYFA+xEyx2CRJBeUOBowCnbUvYpzL5lUvptJjZCDf2+PwT/73aXKcMCTXxlD53RWc6JRS7SCl5rG4c/QTZV5dt0/LLFkYcTj2kluB9nMMluOuq3Ygcq5JrDRYL5XYm7WD6vEyfN5eYMUPLQCklliFhUXKFmlllPs91FsxU05B+PsvnryOL2E54AjjDw7JIIjvy3R411CHR319DTiC2a/j89Ozz1tDMnzRVHzlF8Rcrh3j5sVfsXNMIDs6i8RjybwqsQ/YMnYl4h40w7y9FTvF8GDnfyQkPIftUDvGgDLYi3ndPelTGaxEvvVexvtdnFeJl127WaHVEoyj+86DpQWdbe3gfd6N952rQPocccfBlJGrHKmRT9XRkvdAKCfOdHvRIZxyZhrrNGLVo2mchcjs1VJM5uvJyxJPrYazHKyuUJcbYvEb+Y1NyeaKWrqEZ9dqtgRCiIyufuOqqYOnpmFOOc4AfAT/J0sP200lmE+LheGVQCidL2Pst5D6kzRMNEyeOcivJecg02jNkjorfYurFFW52MoJyhEDpjGhmVhY3//a7cVQpDjchi89XIgvdjUjssB8Ci7V42iX/RaYpT0M2dY4HtgP/An6A/aOqS2dEU8A9XZAd7d9CjkjdYIbaP0aOhu3YtF+DGEJO9fy2/u6uUI1ETE6avwQyRZTQonHEPsZYH2PK91dIWJigHK3RiETJLoWDC7+JbEAdbUa+T5myXG83IbuG5mTgj+waqmFPI+ZiYDZwgY89sj2Rk0ArkXnaKvOXel1ptKa/rmxzTRVyBvd7wJ3I/pXt+rzuxm/bTF2kfvcTkc1/urnUOocjYZ/Sp1CqkMC2ZyF7zK5AQhAp1jkN2dyY3tu7ARiFxFbc4VZGqSm1Yk9NuTi115Y7TR1M0Q85+fN4YCI215DsGJqjkIWzbDHRypGFupcR7xAvF7MipuE7H/cCgR4E/N00mBfizt6iEOLZc4Xpae1AFgSnYf9skqh5YHoCnwKLfOylTSb7/PgQJDDj17Wds8SBpm51yVG3xyBz+UfhfZTersjR4HYX2TtlaQuWIlGmH0GiTPvFOPP8VmQxQM8iUY/9iNE2wjyrDUgAUjunn1aZ9uJMk0YYcSZ4xDxnfpxHdVgbI5POIKPjTDsJWt1xOwHZvW4l8GZ/86N28bAgrjYjJy+iTfcCHjOF7dTI3IdEqh5rHuIa02i/bvRboQb4mTGAc5C9D/ONsbkO66fxOeGcPJ+fTu5z05Wd0zr/tPhsVJtrx3ioJ2Ke1QtN47hX2t8QMwOQ7S9bWzAUOdtmKd7ufWnLLXnq4FHI4XQ9PNTQ34xCFyDTys+b5/S7Fu/vaTqgtwD7me8TZed04DvAHj6UZb4D1U7B5hHSVgzNGGNk7JwhM8ZU4GqPHg6vPWQipnF32jh/M8dI8l5knSsX5UhI8KsyNE69ERfUe32oeIMs9MJ6qR3JW4bP2yynHuY56u+Rpq/gzd6UVKP5EOJp5TVVFvM50MwoeFGePUzaR7R5vxa4A1krytcxvhnYN8fnQ43B8ZoBFmZXbJVhPkMz2FT0QhqRQ5EjkN3uce9jGlk/pjic9B7yGZEQcoZFrgOTTgUOzpPOuRYqhlNCLtSljkxvMxItpIHrj0xHe2HIvT62OYwcVOg1lTbamX2AWbgfqPN6Mm98TXEpcrZUrufkIAv5HBSQOl1utyJko5fpTTux/ieZxtTNKa4ePhbmjx0aRCsN+C/JfubMEItpDEIJKl2MkRnmII29zaxCJ5e1DfXh++9rsR47YQty0qad0eVMZHrKLawcZXAhEiE6m1GMWUijWyk+BOEcD8cLDh+OFBfh7hHRW30sHyfHGFhdAAwBvyDzdGCTxTRqUYJINbJHwo11lgmIR6SbBxT6FRH4Uh/yOANxkLFKHyQszOEu5W+1Q/41xGkhmsVg5qN7ezE01aZCj3Mxn6mIa5wbzMe/0/2cjMRetHn9DHY/otpqQL1qlKBRjgSDdHMN5CjgT7g3Hb3Ip7I414c8PkEceN61cU9n0xH4kgv52/GyPZPMpxpbMTRd8McByFNDE0XWVQ7zIK+7yO/NYIUY8DufysdJ5NRbsO+K+FNjlFNY3c+jhiZYRJD9HF4shJ9tniU3eMyn8vBrF/M6JBjlf2zcU4V4iH3NYd52t0OcbO6psmlooASnz8Jteu9/RNZVvHr4/mR6ZU6ZhvinB9nQLEWm3pps3ncLO0/Ts7oPoUbb9sAQQhZ9vXTtvQR3vI8eR6aPvGaLj+W/DdlC8A8b95QBfyH7WqkVfoz9vYPHsatH76b2amjSN2z+EtmZ7PV0wuOm1/Geg3TqETfCVMTZHcYo1JmGvRHx5jrZhUrrhOcQn/MnbI46ppvfZpbF62td+F0OMRX4NRsVPt8Q/3dI5ICtSBj2nwBr2rmhuR3ZSOw1NyJ7q37jII2EeUamI8c0p/ah1LEzFE4lEoLECZsd3LsvEnVkLPacIexGPUmtldZQ2JryRuTsHrvehUcD/0aiU/s1ooki3qw9gTfMSNApnZGtFieZ+vOPdOOb+jF+SG43WzfpYgr2UPKfdZGLFjM9kYkfuWBkwJ1QNM+bwn/aprG5EXEtt4KTqbNzkfDrvdKM68kOe7rVpqJNSpueuMT08k/EflSEUuE6dl9n85K7TKfgYYedqcty/I5PFtHQnGdGh34G//0JslH2/QLuXcjO6CiDbdw30bQTj/hgaL6C7Ozvl9bGnWmjrcnWUX2CnbNVVYiH3anGgP43bH7MG31+IHshi3Be7A24HplacwO3Trd7yRS43fSO99jQTEeiF/Rq0zN5Eti/wDQjyDrfpCy/+zNA33ZoZM7D/6O4I8BfcWc6ui01pvE5xoW0Cpk6G10EIwOynODEcWk54slmtxM9AevbKQo1NNcgZwb1S3uvkzFwBzuog/dnqYM9U8972DTMxWAYEqrCTaYi4dfdws1jVF9F5o4bPGoU7HIMO9eCMo06n8O+e3sI2QF9Up5ORrHqnJcU6zuVA4+aDoKbsw7P457rbyGG5iKKd4zJN3G2Z2mFKbuPCpgJsEIhLs4HI+u/2fJ9jsLc8O8i93pkL+AHYazvfv8IcS3Oh52T1I50sXJcnaMgnUwruMlMY2zcds8uZI0m3znuvcwUgJ355pvJHxEBvN+RXgysPkersLb29nNkethqD3e8S9+juxmBu+mWXYih2aeIv2UFzjdBf4qsI8/1QF8hI5qryb1Bv5DOpdVtKyeHkcUgKw/HsViba/2NDWPjVkM+BXENdhsvjguYZYyNm1FYC5k6O9TCNQOQ9TQrPahL2NU1OxedaX9YeY42IJ5GKyxc+zLiymw1QrcbI+XeJt8DXC6bQgzNpiL/nm7kvx6ZUnrXZW3dPHre+yFLGr0tPu9WO/a9w4iXTL6H4yjsue5dh4Txz8cTLhT6Fab3ZwerD2+jR5X4ddPguGVsCjE0Vr2/Rpk/K70bq7THc1byPXR1iCPEhzbSfJzsC/XpLMOZF2dqRPYq7m7UdmJonijib/km7nhipQzWUbi7HaMQQ7PW4nXDkDiPVgyNVf4RRuZib87xcEzG/kFmScSL7ekc12zE+eLpZUhkVDvUYX0+vdHDyjzbjBK3upBWIWs004v0EC/B+hEJpcRLOcq0ETkTpRBvu9+QfS0t9ax9F2fhZAYaI2N3usrq81HI6OARZCG5GHzf5fTqgC8iWweKZWhuxr+QQ+ksBS5Pzdldj3jNpJ+SuA3ZA/JOgRnEzdD/tSyjpBNtWNlsFvUX2AsTU4csgltdpHM6tRdBDgSbgUwnXofENLsI2czZz7zvtAIUskZzH+5551llg+m4tNfTOG8A/q9NvW5E3EdfdjhaujvLM3YF9jYntmUIspPebjTj/2F902ghI5qkMc434e802mbTCXSbejOL8aILaRViaB5Fjhvx+3k/Dlid7tXxR8RN7VDkZL1ZOD8LvhGJI/R7Y1i24M7GvQvMg2fXyBxnHpBzLN7jZI0mjIT4ONmHH7RQ9+YbkUV/P4IepkbHS2jf/AVx705tiHvTYYcqffS+DXG2iCCOJTfh7ATO4abhs3vMxCzzPFsdmRY6ao8BPzAdoj7YC2VzpBkNRm3csx3nRz53ZvcNsFvTOpNuhOMp1L35DvO8f9+H5yDV9i+B3d0HW3A/JEUdsoPfLQ4yFciOkalH9qTMtjkCcDJ19nWfjIwTQ5NqwLribVSIFtM7fYeOQczFaZL0Hv515J5Gs0NPJEK7XSPzimlAttto8JyGoIkjXlxWOcN0RO0YmU3IXjcnhjuMxC87wuP65eSolOvM836Jx8/7yellWYqHVV2PPf/6BmNk3iigYXZiaM7zsUycxDpLGq1Pe6QtbtJ/GSVI/ABZm7HDv81IJjXSt7qfw89YZ99GNiXaOVr8E2R3/lsO8z7NByPjZEST3rl80CNtqfbkxbYWuNSws/em0fRSZhU4AnCyRrOfj2VS5UIP5GwPeuGpSn2/tuuB4xSb1z+NbMRN73wFzdDcaEYydsLofwB8HljgQv6n+/Q9dzi8P46sJb7ggbZrMz3vpWhorM5xNpqRzEwHIwAnazRVPpbJHBfSSM2pznNR1604C/qoeEc/G9c+ikx/txTQs64HWj3+LqmI2XYjWs9CYpOtdknHCJ9+u/tcSKPFdDbecvl5z7ifsRQNjZWGsNH0vv7j0Ag4MTQrfSwTt85lr0MWMd1YsP8d7q0nKO5jdc3jfsRDMlOUAiuGxg+PscsRT067I7RjXR5thXz67e52KZ1UZ9yNzuX9uZ73UjQ0v87zeZOx1C/luMbK5rbN2Ntc15YXfSqPjTiLvNqWDeYBXOUgjaeRxcYkSlCxcujZH5AplmwbnK0cK+3HtJndEzL/gKynNLmsww+Pyg+Aj11Mb7MxNssdpPFPZF0m6ZahsdJwJHwYNv4xxzD9FPLPPf6N3HsPms0D5sQZ4Kd4u+ET0wCcj/uBOpebyldIb/QN7IVOUYrD9DwN1m+QUO+5fkcr0y7/8+G71Nn83hd6VD+9jmaQwJu9MKkQY4Xsb3sL2SeWMy6fXUOTL0ZTE95vxkuaxvUbSCiXTUbXn5AF+OctNtCnGGPyH2Og4ubBuxeJYup0V/Ji0+Bu9qgc3jaVwytvsXnYP9pgnjFQjSi5WOnCs+aUTchRDq9m6KxdieytytexvN70sLOxDH+OILHSwCeQKbYbPBxpP4Q3mz1TMxdnWmzfCh2NfcGm0V5iRpN5n3e7YbjvJ/d+i8dw7hFh1dj81fw56R38xfx5xdPIPoXhyL6FSmR9qFva667m39TrSsQrLv11F/N5Ajnk6gfY21dQKG8ha13PWpgmWWWMTB1KPh4Evpejo/c+7jpl5PrNjjT1c7QZGb9pY4S8EdnXdoVpBEchHl9LTFvwM9wJsZSPBxC35mwRp1tMx/QhH2YYjkcOEjyMXffxhMwznY1OWZ6xpUhkiEdwP5p8W+aa5/1f5PfMTdUdSwMLu4bmX8gi74VZpluu7LBNx8ysznCNuOMVZl3HYc1upvgScirffWRe/I2ZxukCnK3r7MpVVwXr950xw83U5iCnwP4kw2dbzUjbTxaZv0JoQryNbi3irxNHNmlmOlOlHjmW4iWftGzBvmNCoFoyxMPw76aDm+l5fxuZVbL8vBdysNDFSNjrS4CRxqI9ZR6cjZ59fXcbT8UeTyI7wr9qfn//fvf2y03I0b9XImfJNJppkR9iP4itIiP8CWZ09Q1gr7R26n0tHls8i5xDdZYZKY5GplqfMbMptiNbF2JoUmeJJNv0KIo1YvAH7w3dMchRq4cg6zo34O20nl3qEI+/Xwf8IQmZEfe3kWjEG5Bw+z8OoEF8BOvnxLvCxImjaMf4Prpqx+XZgMSodOUUZLuG5mTE4yt9CmVPZPf3xchC2AXaI7PNT4xhSdEJ+DMSWdfdxdTUFFD7Ndy/bTN1kaqfJ5oer6vOKu284VZKnKDUTzuG5ihkITrbonA5sgD2sumVr/JB/56mMU5fVK80hjD9db5F+Bpkb82diNtzg4+/wTfbGJl0piEB9K7A2z0pIeBck88+iEPHayZ/u2eoRJFF4Z5mOmMR/rk6Tyb7/PgQ5IC8r2vzo42jEkxDM8E0wFY2aPVH5vgm4Z0HUgj4pZkecWvT6UHIAthGMyp7yofyL0c8VHJxGRJT6lxkIc6LsrzPGLx0YzEZmc67xOLwucYYpgvYdRFxPXJu0G0+GJx8xz+cbvTt0EdfUfzDSiM9xhgZO6HoxxhjU+2R7suREzy9iGzQE3HNPMyH8j8Ya+dzfxVZZ/Aifto5bYxM247IvcgZKPkM5gvIZrK2niq9kU1y9/pQnoPyfF6FnMehKEqADM1gYzAKeTgPRfzbIy5rDgFXe1wuEWQPgNfYCe9/IhKmvavLGr5lobx/bQx7Nk41RjMX52L/7JNC6oYbnStFUXwyNL1ML7W/g/RPMo2Um8HmhjrUZJUDgT08zmM29qYXJyFuxn1c1GDlnPjUVOXlWT4fYjGNQfrIKYoamhRdjJEZ5kIeFwE3u6i5t4/l82OP099sjLGdHb/jkfDmg13SYNXxIYSstWTalGs1OGGtPnKKooYGZF3laWCci/lMxb2jQ/3cC3GWD3nMRDz61tu4ZxgS5220C/nbjTI9g92nLq3GNqvWR05R1NBEkXUVLxbC70KCTDplCf6ccZHqxfvBO6bMP7FxTz9jpA52mPct2PcO/KnpPKSwem6PGhpF6eCGJoRsxjzJo7wiSITloxymk0A25fmBn1GIFyJrMB/ZuKe7GZEc4yDfpWbkZvdsjlvYedCR1am/Gn3kFKXjkb6P5pfkjszsBuWIm+6RWDt8LBs3mxHApAAbmsmmPIcAFTbui9rMpxMSg+iryJG7hfAccmzCEzZHHdNNHZpl8fpaF+rPIcjG29dcGtl2QQLFnogEtHwSidSwRpsHRXHX0PyQ3O6rbtIFcdM9lMJPpGtEjhz+MuIyu8O8V4ccWrYdWRM6zaHWQsJyh9g9DIrXlJvR4gsUvkn2eTOafdqmsbkR6yd8Opk6OxfZ9Nkr7bc5md3PU7FDNbJHLNVhqTL15gxjeP6rTYSiuGNozsOfw4nS6YUcOXAohceeiiE7+TPxfReMDFhfe0jnWxQnTHgnZArsHgdpvIQcdvZPm0bheI8NzXR2P4+8sxl9HIVE6bVLBFmPnJSlfj4DjAXWajOhKM4II6fkFYNhuBQZtA3fwz136kKmzr5VxN/z2y6k8Soy7edFvLdC1miOyWBk0kfHz2HfDT8E/Irc65G9ivhsKEq7MzRWNyV+BMy3cJ2dEN1Huvx9pgC3u5heIYZmRBF/z5EupTPTGJt6l/UVskYz1cLo+GXsbeK92WKH4FRtIhTFHUPzhoXrViHn02+2cO1vbBgbN48mvQKJzusmhegr5pknbobAn2WMjZuBUQuZOjvEwjUDkHW/7hauvcSC8UrRWZsIRXHH0OQbAWxA5sHthP2/DmsuyE+49D2+A9zhQfkUskbzdBF/zyddTu914DgXjU0hhsaq99co8+d0hJTOK9pEKIo7huZ5sq9p1Jlerd2DzJKm8X86T89/ugvf4RLENTtkU58VCpk6+xHwcRF+yyYkTL/bzDaj2a0upFXIGs30Ij0bS5AjBRRFcUjKvfl682C1dR89Bdm1XghxJBLAc+zu2bMB+BLOPXouBO62aWTqTONlZS2nEEOzATm/ZwbiJuvXUZazKXzaLoIcFzAe8ebbhriJN6S9vhXZpOkkWkIhazT3IVNj03x8LjaYDtYGbSIUxT1DAxIV4H7E5bgrMkfvdL2h0RiU3yP7Erbg3oa48xBXXrtGZjLW5vJTxrYQ1iMnOV6ARFq2c5LpZcB3beb3CYW7VIeR83dO9qG+FerefKPpAF3qg8ZUHVmizYOiuG9oAFpwtgEu24P7ZZfT/Bqym9uOkalH9nu8ifWYa9sd6twBrLB4bcgYYLtG5gNkHWV1gRq/7pORcWJoUga4K95Gr2hB9l+9o02DonhnaEqB/YE/YO8Aq+3GyLxhs8HzK9ZZxIzOzrd53yxkL8gWhyNDv3AS6yxptNbiTTy+uEn/ZW0WFMVdSvG0weuQkCtWaTRGZlYBPWs/DE0VEv/NrpF5Glmk3+Iw//18/O2cHkXdYkajr3mg7TJk6lhRFDU0tgJpNiJrQzPbvN/J4v3bPP4uXdgZY8wOf0CmeJpc0FDl4283x4U0Uut+81zUdSuy/0tRFDU0toxEI+I1l2kvhNWNeNs9/i73AhNt3jMd8baLu6RhpY+/3QyX0qlDgqq6sWD/O7KHuFEUpYMamrkWrmk2Pf4XsnxudW3Ka0PzRRvXJoDLgRuwvg/ICi/69LttxHqUZytsQKYOVzlI42lkH1ZSmwJFCY6hsfJAJjzWfFeez1uQGFX/znGNlbNwNgMfevxdrE59tSD7XO7yQMNP8X4tKo6sQbkdqHM5sv5WyLk0byDrPXFtBhQlWIYmn6tuE95vcnsAme7IRIMxMs/lSeNhcoe/aQb+z4cG2EoInpRb9kMeaVhsGtzNHqX/thl5eBWaZx5ytEGjzXuOx98TVBWlw2LXvfl+cu9jeAzZO+I1FyFuqJcAo02D8Qqyc32BxR72Gch+nHMRl+lOyHrF86aX78eGvelGR68sn68zjajX+zqeRnbfDwd6ItEMqpCTLFOvu5p/U68rEe+99NddzOcJY8x/AHzqQzm+hThUPEt+j8RVxsjU6eOvKME0NP8yo4kLs0xjXOm6wplZI7g8aP4KJQH8xfxZ03FYc/bPnypo0/pqTr47ddBYW2OzDPgiT11q3+AdVlB5NOKOV1ixeAn4ChKypluGz2PIZt0LcLauo3jMxRdfHBgt99xzj/4gRTA0ABcjJxpegpx/sgF4CgkmuVGL1CZPXfo/Tr57HHIq6KlAD9Mz/w5PXaqnO9rjSTOy/aqpp57Xz1JpFLXxVkrF0NQg0zhHIsEX+yLOAT2R6Z8DTI/4FdNDbyjSd2qrcwgypQMyXbI8cDqfurStzkmm0fROZ67RWWlTB/za/BWDPZCp3QPwbo9SEzKdei+FxwwsFZ19kaC/JyKH25UhzjG5PEIbzAg2E0l2j0QeQyKuP4Ksm6oXYhEMzTDgWmTBONselt7mb4LpSW5HFu1vw8Jax/xJU934Lp7rdIlS0VlcZswoRdWnIFOxtT7k9SXgKiRW3VPtVOcYxP2+d5v3y8m9FtetAJ0HA2eZTt2ZqKOIq+TyOqtEdkx/iMxrd7KRbidzz4emcfQyVL7qVILAvsiaYa2PedYi3oj7tkOd5WZ00dvn3/EE3NtYrOQxNEORhdNrsRdXLFNlucakNcwD/apTCQo/ACqKkG+Fybu96TzJPDfF4EJkmk7x0NDsjxzhO97FfMYjQS33dzFN1emuTsUZRxUx7yPboc4Di6gzQqG+m0pG2q7RDEM2O/byIK8+Ju1Dcb7OoDrd1ak4p6edi+NlYbb0q6KuTyVNtVGSYQgloKo+Rpd1zXT7tIlIq+UgG7280llR1srofqsZ0WctvWrqiYQTxBNhNjTUsnBdXz78dE92tJZ5odPW1F6nUIgxkQj7lpWxRzhMp1CIeDJJXTLJikSCD1pbmR+P2wlb0kWrtDeGpgp41KNGMb2iPYYsvBUaeVh1uqtT8ZGWqggrxnRl3dBaEpHdz+3bQhWfjuhMOJ6kz9J6Bs7bSnmT/1FyOlc1ccK+7/P5oUuIRjLnf8TwBcTiEV5fOox/fjCObU1VvuvsFApxXHk5R0ajRNt+GArRExgaiXBkNMrmZJJnW1qYFYupW5nPpE+dTQPG+ZDnWJyd/6463dWp+MSGwZ14++T+rBneOaORSScRCbFmeGfePrk/GwZ38lXngYOWc9NJj3PE8IVZjUyKaCTOEcMXctNJj3PgoOW+6hwdiXBjdTXHZjIyGegeCvG1igqmVFXRORTSClkEQzMUmOJjvlMobDFbdbqrU/GJT8Z1Y8HE3sTL7IUXjJeFWTCxN5+M6+aLzi+NncP5E2dSUdZq676KslbOnziTk8bO8ccYlpXxnaoqagswGCMiEa6tqqKbGhvfDc1UsNQpcIuoydMuqtNdnYoPrN6nCyvGdHWUxooxXVm9j7fLBl8YOZ8Tx7xPoc1vCDhhzPt8YeR8N+RkXfjZOxLhm5WVjs446RkOc1lVVS4XUJ1dc9nQ1CKbB/3mLOwt+KlOd3UqPrC9WznL93NnNLJ8v25s71buic7+3TZz6n7uxG49db93GNDNcTDwjPOFFaEQ51VWFhQ7qy17hsOcWpHV03ub1l53Dc3x2Ns86BadTN5WUZ3u6lR8YNkB3UmG3ZmiSYZDLDuguyc6v7z/25SF3TlKqiyc4Iz93/ZE59HRKN1dnPI6IhqldzisFdUHQ3N0EfM/2qNrVadSdBq6l7O1r7ueWFv7VtHQ3d1RzYBumxnZd42raY7su8aNUc1ujdWR0Wjg01Qyl/PYIuY/1qNrVadSdDYMqimJdA8c7I23mNvpDotEPPEW26+sTCurD4ZmaBHzH+rRtapTKTp1fSpLIt29e6/zRKfb6Q6NRDzR2S0Uood6oHluaDoXMf/OHl2rOpWi01xbVhLp9q71Zt3b7XR7e2gMdJ3Ge0OjKIoHxMq96YHHKtxNt1N5iyc6O1U4OtV9t8WtMg8NTYa0m7UGu2toiunGt82ja1WnUnQicW+2YkRa3U23Je6NQWxpdTTy2s3jwctAPK3J3cp0h9Zgdw3N0iLmv9Sja1WnUnQqtreWRLqbt3vjje92uhsTCc9+q01J3Z/ptaGZW8T853p0repUik7N5h0lke6KzT080el2usvj3oxp6pNJNnhoxBQxNC8VMf+XPLpWdSpFp8dKb04D7rHK3XTnrBroic73Vw1wNb2F8TjbPRh5zGlt1XgzPhiaZ5Ez6f2m0eRtFdXprk7Fa0OzqtH1EP/lTXHXDdjcVQPY2lTtappbm6p532UD1grMisVcTTMJvOpymkpmQ1OPnCHuNw+YvC2PcFWnqzoVjwklkgx6f4uraQ56fwuhhLv979ZEmGfmunuixTNzx9GacN+p9d+xGPUujmr+29rKKp0288XQANwK+GnWY8BtBdynOt3VqXhM3yX1dPvUnTPpun3aRN+l3vQlZi0Zzodr+rmS1odr+jFr6d5Ok8kYIHZ7Mslfd+xwZaprUzLJQzuyrnepB6cHhmYJcIeP+d4JLC7gPtXprk7FB0a+tp5OW5ztVem0pYWRr633LHh9Evjda4ezaquzSNOrtnbjd68dTjLpeM9L1uHQ+62tPObQ2NQnk/yqqSnXmo8u23hgaEBOafTDa2kuzk+uVJ3u6VQ8piyWYOwLa+i6rrA9gF3XNTP2hTWUxbyd4mmKlfPzF77IwnV9C7p/4bq+/PyFL9IUK/e8TF+IxfhTczOFmO9PEwlub2riU50yK4qhaQJOBzZ4mN8Gk4eT1UzV6a5OxQ9j05Jg3xfXsNc7mylrSVi+Z693NrPvi2ss3+OU7S0V3PnSsTzyzoE0tlgzGI0t5TzyzoHc+dKxbG+p8K1MZ7e2cmNjI/+z6DXWnEzyj5YWbm5sZL0aGX/rf5v/LwGOQ7yX+ric1zrkvJQlLqSlOt3VqTinGcgZ7TKUhD0/qqPvknrW7VXDpv7V1PesIB7d2d+LxBLUbtxBj1WN9FnWQMTaKKbZTZ2JZIgXF4xi1tK9OXjIUsYPWMGQHhupjO5cdmyORVm+qSdzVg5k9vKhNMeibuu0tEayMZHg983NPB0Os19ZGaMjEXqGQnQxscu2JhKsTCT4MB7n7dZWmqw7EmzXKu2doQF4F5gIPIZ7Yefnmp63m42i6lQjEyTmAAdbuTASS9Bv4Tb6LZS2NFYZIV4WItKaJNocLzRv13U2x6K8umgkry4aCUBtZTMVZTF2tEapb670Wucb2DjIb30iwb9bWvi3O79lE7BQq7R7hHP0xCcAt+PMeypm0pjgUaOoOpWgcG+hN0ab41Q2tBZqZOzmXbDO+uZKNjbUFmpk7OZ9D7C5SL/lfeh0tC+GJjXMvRYYDfzeZsE3AX8w916Lt5FQVWdbrrpKa7b//Am4vwj53m/ybm86NwKnAVt91vkOMFWrs7tYCa+6GLgQmAKcCBwJjAeGAF3NNVuB5WZo/ArwDNDghsBRoWlWL10MXDg/Oc2WzlGhaZZ1znenzItanopnJIFvAP8Fvmt+Ty9ZjrjQ3409V9xg69y1k/QfYIx5Vo5G9tZUA7k8DroChfhWrzYjmVutdAJnzZofmIo3ceKodmFo2lbS9L9ElveLhjEcD1Kc3fl2SNc5wlTwY035zQKuBpZp+11SJIBfmr8eQJe2F8Sj4fDy/bqNbexafmhrNDwyGQ7tmQzJdaEkdaFEcnVZLLGgemvszSHvbX4/EsvoHlUHbPJSZ2U0Fj51/Dtj9+y69dDKaGxkWTixZziU7AKQSIbqWhPh1c2x6II1dV3ffOy9A95vjkW90AmwCsg6RL+npiYMHGgM0ThgEJDaDLQF+AR4H3j5rqam9z6IxzPF2on50JGzrNN0AtqVW5wVQzPMTNecDWSL+93b/E0ALkY8Nh5AdqsXey3hOGTaqRm4FHguYL/B54Dn0yodwKnAJOAY7C2gKsFhU3oj+9rXhnQz9e9CIFcQsPHACXW9K1kzvHYF8Dvg7kl/W77FD533fPXPtnTu3Xsdh+298DOdF9//f1v8KNx7amqs6pwAnAlwWVXVTp0NDVt8qge2dQKf6TRGqOQJ7TPzlmyfVSIbAaeQ4RAii7Qgu9Z/RI51hfmTsk+JjnrtViffr4cZFaSOON5mpgoKWmTMpbPAdZHPAS+wc8qsLRsLNjYzZmhT78cIOn/9DAHfBm7K8TvnYyvwA+DXuXq6OevnzMrA6OSwZifPkX86czxDFqbOfNNZClNn2ZwBhgJvmpGMk22+5cA1Jq1hRfh+J6UZGczrEwM0knkhTyXsaa4Zr016SVIDPAH8ykFjg7n3LuBxk6bqVJ0lRSZDsz/wusuN23hk3WF/H79b1Bi5tlxOYYuFfhsZNTalzWDTwTrZxTRPNmkOVp2qs5QNzTBkDaOPB3n1MWn7NbK5FBiZ4f0DgHNKxMiosSlNepnfa18P0t7XpN1LdarOUjQ0VcCjHn+RXsgO+SqPv1dPZF0oG9PJ7SIZJCOjxqa0iJg67mWHahgynVKmOlVnqRmaaYjbndeMxftowz/O05gPAr5TQkZGjU3pcC3iMeg1E8k8Naw6VWdgDc1QxLvML6Z4aPn3RVwJ83E90L2EjIwam+DT39Qrv7je5Kk6VWdJGJqpyOK5X0TxLszDnRaHlt2AG0rMyKixCTZXIzvX/aLa5Kk6VWfgDU0tshnTb84iy3GtDjgF2XlrlW/jrSeHF0ZGjU0wqQTOLUK+52JvzVN1dkydRTc0x5N9x7+XdMJGGHALVCCRje3ec3MJGhk1NsFjMrvu2fKLziZv1ak6A21oji5i/m7mfRmwd4EjqwNL0MiosQkWXyiR50h1dkydRTc0Y4uYv1t590FCNRRCqICRUC729tHIpBub54G9tL0vGsU09ONUp+oMuqEZWsT83cr7JofD1yNwLzTNz3w2Mil6IRGgleKwdxHzHq46VWfQDU3nIubvRt7jgfNcSOc23NkIVcyh9LHa3pd0XfYjb9XZMXUW3dCUOne69D1GuWSwikkcpSM+S2HVqTqD/nBsK2L+TvP+MnC4i3puxLkH3vNFLM8Xtb0v2brsV96qs2PqLLqhWVrE/J3kXYlMd7lJX5xvhLoa2FCEstxACYamaEcsL2Ley1Sn6gy6oZlbxPyd5H0l3px3frUxOE6M57E4P8LWrpE5EjkOVim9uuxn3qqzY+osuqF5qYj5F5r3HsD3PdJUg0yhOWEO4hTgh7FJGZkPta0vKi8XMe9XVKfqDLqheRbYXoS8G03ehXAL3p44dx6wTwkYGzUyweEfQFMR8m0GnlGdqjPohqYeeLAIeT9g8rbL54BveKytDHf2pHhpbNTIBIttwMNFyPchoE51qs6gGxpMoxrzMd8YhS3kh4Bf4M9RzCfhjkebF8ZGjUwwuQVo9TG/1gI7RKqzY+osuqFZAtzhY753AosLuO8s4FAfdf7UJaPmprFRIxNcFgJ3+ZjfXcAC1ak6S8XQgJx66YcXw1wKP2Fzms/lcyBwpktpuWFs1MgEnxuA+T7kMx9n5ympzo6ps+iGpgk4HW/3gGwweTQWcO9eFCe2z624F6zSibFRI1MaNAIn+/AcnVzgc6Q6O7bOohsakCm044B1HuS1zqS9pMD77y1SGQ0G7nMxvUKMzXo1MiXFEuSsEC8anQ0m7SWqU3WWqqEBeBeYiLvTaHNNmu86SGNCEcvpEJfTs2Ns1gNHqZEpOd4BPg984GKaH5g031GdqrPUDU3KMk9Azmlx4o0WM2lMcMES/7eI5TTbgzStGBs1MqXNYlP3Z+DMK6kV+LlJa7HqVJ2lRq6w+M3AtcDvkRha5wDVFtNtAv6OuDC7VUAXAn82lj3kU/kkgdfx7kzwlLF5EejR5rN1yAl6rhqZiy++ODCV75577ukIxqYRCWt0DzAVOBvrZ703IfvNbvWhoVGdHVNn0Q1NunW+EJiCHA52JHIGzBB2HvC1FQkuNwcJi/AM0OCy1mXApHbYEM0BDjIjv6ONcXsOuA74WAcF7Wp0cz7wXeAEM1Idl+U5eh8JbfIs/kfoVZ0dU2fRDU3bHn76XyLL+0Vj/pMbaswPmm4Qu5iP69oYxH+OOqVXQzF0zjr1/Ew6Uz2eo5FoDZ/pnPjEHxqKVKS2ytODDkZ7IxWJ40HVqTo7CqF9Zt6S75phyBTa2Vg/q2W7GfrdhoW1mfmTpmb/8KqrrH4Xz3UyY4ZjnbNOPd+RzolP/MHaWlcWrTamzjwvzw4ydaYoHZ5cI5pKZIPkFKDcZrqdgAuQmGR3Aj9C1ny8IBA6Z516vi86Z516fl6dEyeOKvnyVBSl/ZDN62wo8Kbp0ZY7SL8ccSR40/SQ3UZ1dkydiqKUuKHZH/G0Gu9iPuOBWSZtt1CdHVOnoiglbmiGIR5PfTzIq49J240erursmDoVRSlxQ1MFPAr08jC/XsBjWPcnz4Tq7Jg6FUVpB4ZmGuLf7TVjcRaFWXV2TJ2KopS4oRmKeBn5xRQKm0pRnR1Tp6Io7cDQTAWiPuYbNXnaRXV2TJ2KopS4oalFNuX5zVkmb6uozo6pU1GUdmBojsf6zm836WTytorq7Jg6FUVpB4bm6CLmf7RH16rO9qNTUZR2YGjGFjH/sR5dqzrbj05FUdqBoRlaxPyHenSt6mw/OhVFaQeGpnMR8+/s0bWqs/3oVBSlHRgaRVEURfHU0BTzJLdtHl2rOtuPTkVR2oGhWVrE/Jd6dK3qbD86FUVpB4ZmbhHzn+vRtaqz/ehUFKUdGJqXipj/Sx5dqzrbj05FUdqBoXkWOevdbxpN3lZRnR1Tp6Io7cDQ1AMPFiHvB0zeVlGdHVOnoijtwNAA3ArEfMw3BtxWwH2qs2PqVBSlHRiaJcAdPuZ7J7C4gPtUZ8fUqShKOzA0IKcf+uENNBfnJ0Kqzo6nU1GUdmBomoDTgQ0e5rfB5NHoIA3V2TF1KorSDgwNyFTKccA6D/JaZ9Je4kJaqrNj6lQUpR0YGoB3gYm4O50y16T5rotpqs6OqVNRlHZgaFI93AnA7TjzSoqZNCZ41KNVnR1Tp6IoJURon5m35Ltmb+Aa4Byg2mK6TcDfEVdWS15G8ydNzfzBzEprOT51qTOdJ99tzRvqsObM7191laXbZ516viOdE5/4gzWdM2ZkfPviiy+2Wjc8/93vuecefQKVgp4j38jyHCn2KLNwzWLgQmAKcCJwJDAeGAJ0NddsBZYDc4BXgGeABl+/iRiKC3nqUns6T77bV53GUFw469Tzbemc+MQfGnyuG6XxuyveYLWDZ7UjpqihaVecfHdJyJz4xB9KpUQbkAgCD+rj0mEZCnwPmAz0BdYD/7YzY1EghwJTgdHARuBfyF6srS6lvwdwHXAS0AP4ELgBeEF/cv8NzTDgWnJPofQyfwcBFyFTKPcj8/R+bdBTnRbQ6SrFJieYTkZN2nv9gfNNHf4G8KgH+U5Cgq9Gzf/3Ms/DhcBpwFsO0z8GeDhtdI5J/1/A4cDr+tP7Y2gqgRuB7wLl5r1VSEDE2cBCYLN5vzswAjgYON5UxAtMJbwT+BHg1Zi6ves8AdjTR52KDUa9dmug9GRd6yyM4aYxztYhqjIdoI/MaMBNbkwzMun0A140z+9rBaZ9LPCk0d+WiOkInqS123tDMwx4DBhr/j8LuNkMlxNZ7nkD+CPiyfZFMySdiCwoH4ds2HPbAymfzu7AZaaHAvAf4K4A6gxKeSpKOt8nvyNIOXC9Gd24ybgcn9WYkcfxwEyb6X4BeCKLkUmxj/707pLJvXl/0xCOReZCv2aGsf/K0SimkzDXHmbu3WrSmmXSdot8Oochi9TTkIXsI83rOeazoOgMSnkqweeL5ndvMqPfv5hRuVcca6Pxdpu6PJ93Ms/FUTbSPBJ4yoLx3KRVzVtDMwx4DugDLAIOMEPjQkiaew8w00J9TNrDXBoh5NP5B2BAhnsHmM+CorOQ8lzksk4l+HwbmWb9PDIN2w34OvBfZGrVC/aweF0vD/J+0cI11cA/LBq6wxGvSCuu+s9rdfPO0FQhi3q9zJTMJGCZC3ksM73xJSbtx/IMW/NhRedgk2c2DkPcdIuhM4TsUdnHvM5HCBiFeN6ETRqTXNSpBJ9LgV9lmYHYA++OXggV8Tv/FGixaGyeMqO9XM/7sxaNzFZkel3xyNBMQ+ZF65A1gPUu5rPeVIStyLTPNAdpWdFppZc/tAg6RyELp4uA+UholiE50hgCvI0stH5g/kaZtCabtJ3qVILNd0zDl6vRP6Edfu/FwHlmJG/F2DxpnrO2TLJhZFqBr+JtgNkObWiGIhvzUhV7qYt5VCOLd8uQhXlMXoVM+VjVWWEhrYocIzAvdIaQRcgRadeNRxYzh2ZJYya7rsPsY0ZJITOi+Y5DnUqwuRz4pYWRRXU7/f73I1OGVoxNpTE2x6e9N9EYmU4W7o8jDg16zLiHhmYq4ko4i8LXENrSHXgE2Gb+/o3sHp9l8irED/P7HujMVsHd1jkMcRdtS39TLkPbGJlXybzQu0+aUXGqUwkuVyCu7Famr95qx+XwW+Bii8amwnTmvoSsZT3Lrvt/8hmZR7TaeWdoaoGzzf9vtviDWjEyLwBnIH7pIcSD5QkgFVztbJO3VbzQmY2kyQPgLJd0xnPcMyDN2Aw1r/vneTDa6rRbnkpw+S5y8qkVIxNH9py0Z36H7COz4qVZbkb9z1p8HuKIN+fDWu28NTTHm6HlajPqcMvIZHK9PRBYaf6qkRhaVjnB3OOWznz82+js1GY4XqjOZYhrdT5j8wqZveVSvMeuzg//LrA8Fe/oCQwke3T0XEyxYWSSprf/Ugco0/uQNZu4RWPT2aKR+QYaXskXQ3O0ef2MxR5DoUYmvRKk5kGPtJH2US7qtEIiTefRLuk8A4kGkMvY5DIyq4Azc+g8Uqt0UdkfeBNZTP4EWMPOdTQrXAn83Eb9vIBdXfXbO38GzrVobKwYmW8i0cYVHwxNarf6bB+MzErkMKw3zf/H2UjfLZ12eLNN3k51LgWOyGNschmZI8gcDaCQ8lTcZTQSEuXgtPd6Ix5j+bzGAK4GrMakTxmZ+zpgOf/VjEKcGJu4GR39Tautf4YmtQi9oM1nZWSONVSokakHvowcirXIvLeXDa3ZdBaKlTWeRW3ydkNnIcYmZWSW5tG5l1bponET2b2/voPsg8lmbL6H7Bux2khegIQn8ppkQMv674gbciHGJlV+f9Eq66+hSc1lpkI+9EHcBOuQEPF/IfeimhUjsw3Z95Hyjtli/u1sQ2tbnblYa+EaK/uEvNJpx9iszGNkCtWpuEu+UCjfBu7OYGyuQaJyW20kz/fJyIBM/VmhGPtOHkIcYOycBJtAoj//Saur/4amLY8CJ5veWTkS5uJ5oIsDI3M8/obdnpun8m8E3g9A+Sddvk4JNpcAv04zNlOxvqs/Nd3zZx/1Wg3F8mKRynMJsN3m85bQalgcQ7PNvO6C7DqfmOG6g5G4Wl1cMjLd0j63SrrOfMTIva/kWos9Ia90plyYB1hIbwCyp2Yvl3Uq7vKyxeu+hewNuY6drv5WjMy5+D/dcyv5j6NoYaeLvZ+MN+1PVxv3RBDniXO1uvpvaFJTMiPIvYM23dg4Hcnsbf61E0stXacV7jOjsfTpqVXmPauLqHu3ydsNnanNmANspJkyNkPz6FymVbpoXA80Wrz2ImC6DSPzf8giuN8sRDYyZhs1NCFrJR/4rGucaX96FHBvythcoFXWX0Mz17w+BJlOWm3B2DidLjvU/DvXhtZ0nVb5GzDINPojzGs7niZu6xxG9h3/VozNK1mMTSE6FXeZj+yhanQxzdQ+j/uL+L2eMKOHe5H1wphpI+4z7z/qs56xpv3p6SCNkPk+F2m19c/QpDZ7ncjOoHKNeYyNEyOT2iRqZ7oB08imdFrdCNcJ8fi5xfx9B2txj9rqfMklnY/kMTIryb/P5mGXylNxn1fNb+GGsYmb0XcQ9nksQTaGDkTWbVNHOS/yWce+yHqQG8cShJApzG9rtfXH0DxrhsZ7IpGL/2MayUIeFisL/8eaBrMR2dRolWfMPSmd+egPvAP8Ajlj/DTz+h2LI4p0nc+6oHMv0wPMZWRSB7TlMjb7s+t6TaHlqXjDfxAPy+0O0oibDt8DAflOIeTMl5+ZGYGfI5GS/TxGYLTpSFkxMklgh8Xv9SvsbapVCjQ09ewMwXBdWq/c7jSAVe+y682/D5i8rVKf9uBdZ+H635N5nWSE+QyfdUZy3LPKGJilpveYz9hEXNCpeMdMY2waCjQyZyPuu0FgD2M8XwCuMgZwCnK65evYW2sslFE2jcwUJLCmlfYrhETIvkKrrbeGBsS7JIZ4nH0tbRrAqrGxamS+avKIUdhhTZl0ZhvN5Br1fDHPA+KFziXI4momI3MEuzocLCH7PpuF7IwO4FSn4h2vmWfCjrFpNUYmKFGEOyGx9CZl+fwQYwC83L+1j8mjt8XrrzQzFy/YNDZ3mnsVDw3NEiSQH0i4jCE2jI1VIzPEDFMxP+riAvRm05kpr3wM8llnEpm++yjtuneR0/8yebUtRY6fndPGyJxm0trLBZ2K98ZmssWRZixgRgYkivSYPNcMQyIbeMEAY2T62DAyd6b9/2XTflmdxpyB7HVSPDI0IKc0zkX80p9P60HkMjapHf/5jExv0zPqavKY5kBzNp3prLSQzuoi6JyPzDUPN9MBnwOW50hjGbImsy8y5TfKpOGmTsVbZplnZJsFI/NowLSfbfG6r3iQdwiZ0u9r8fqr0zp36byKvWnMu9CYgZ4amibgdGRH/TAkKOS+aT/W8ey62z517PEbefLYFwn6uLe5/3SceeXk0pniY9ObzPXwLy+SzqQZfXyEtR3/SeQo50XIruYxJq1hLulUvOd18/xkCku0wzTojwVQt9VTW4d4kPcX2Om2n49ryB2Q1M7IMoIcXKh4ZGhSUz7HAetM5XkDWQcAWRAchoSnOdZ8ni+S8tdMGnuZNI8jc/Rhu+TSmeK8LCObley+M7iYOu3wNdNoDXFZp+KPsZmA7EupM9M5LyDrH48FVPMmi9dt8SDvYy1eNxVrAUlnmefFSqzEL2h19dbQgKwbTDRTMrWIO2O6F83T5gFpzJHmZHPPX00ac02a77qoPZfOsGmA90OmlV41f9PMe0sCpNPKb+SHTsV7UmtsXZEjho8F/hdgvcWMdWZlQ+Z12HOCecOisemiVdVdynL0xCcgR8ROMb2uScAKJDLAG2b6J9Xj6Y6sOxxiGsWB5v0YMm/6I/LHTCp0xJBP5wvsdN/ujuwRCqLOTOV5qNE5wCedipLOrchR5pU5rvEq1tlHeT6/Aeux4tKZDRxjjGjXLNdohA2XCe0zM+9vtTcyB3oO2c/baEsTsqP5Nix6Q82flCUG5sxKq9/FF50clqV9v+qqYOmcMUNrt1I4O5+7U81IulOWevkN0p0YDnPY/9n5HPVAYqi1dQZIkH9NxgrjgKfY3fs0DpxEapO2PkeejmjSWYyc4TDFjAaORHa4D0nrEWxFFtfnIJs9n6GwzWpOUJ2K4j6pWGffQ6ad+iKOQM+bjo9XYWg2Ia7/M8wz0oJMH9+GO6fsvo8451yBeNX2Mc/mT7EXckqxYWgms/Ps8fORXb9nmh+5GtkA9QQyBfVgEfWqTkXxn1SsM79ZbEYXXtGARNGerj+xt6Smzj5FQk2AnKrXD9jMznNOUryKrDO86rYQi1NnRddpceqs+Dp1yK+UItanoP1BnyNXDU3b/Rwhcu/xmGkaSMfRgrMamMzGpmg6Lc0973xIiqdTHwxFUQJGuMD7DkPmMV9DPDiCiupUFEUpUUOTYiKyKPg6slAYVFSnoihKiRqaFIciC96z2XkIVxBRnYqiKCVqaFJMAP4J/Bdx3Q0F9HurTkVRlBI1NCkOBP6BhNc4KcANpOpUFEUpUUOT4gBk9+07wCkBbiBVp6IoSokamhT7IRsU30PC2tcEtDxUp6IoSokamhTjkLhI64BLA1wuqlNRFMUHQxP3MN9qJAKxG6hOd3UqiqL4Zmi8DOIYY9ezvZ2gOt3VqSiK4iplPuc3F7gdOSNmfYDLRXUqiqKUmKF5Azmk6J/kjvlVbFSnoihKiRma55BT+v4T8HJQnYqiKCVkaBLA48jxru8F+LurTkVRlBIzNC3A3/D21D3VqSiK0gENzXbg98jpkSsD/F1Vp6IoSokZmi3A3cixxBsD/B1Vp6IoSokZmrXAz4HfAvUB/m6qU1EUJeCGZivQJe3/y4CfAn8CmgP0HVSnoihKgMkVGeAyZI2gHnGpHWF63UFrFFWnoihKiY5o/mH+go7qVBRFKdERjaIoiqKooVEURVHU0CiKoihqaBRFURRFDY2iKIqihkZRFEVRdiWU/E8Fo0LTPgX2MO+tnZ+ctofvSg7Lsp1kZmX6/3bRmfY6WDqfunRXnSffHRydiqIoRRrRXGAa7tXA+QHWqzoVRVFKcUTjwEg9D4SAY5BzU7we0ahOHdEEkilXrPUzu0OQI7yHAzOBKXf8ou+qYuls2B5mwIAYx03eSjwO8Xgo9VE34FFgLHLc+LkTJ47a4YXObdsijB7dxJFHb6OxMUzS3rmzruls2RGiulOCE760lepOCVp2hNws6oJ1Fhsn0ZvPAI42r78MPBTQ76g6lfZEGXAHMMH8/xRgA/DtYgmKhGFHc4jWVohEIB7/7KOngEnm9dmmE3V2AMtUdXqME2eAi7O8DhqqU2lP7JVmZFKGp6iNTUV5gk2byti4sYyqqs8G4kPTGsUUpwWwPFVngA1NH+DwtP8fZt4LGqpTaW/0zvBe16I2ImXQ3BxmyeJKQjtblJ4ZLo0HsDxVZ4ANzalABJgPLDCvTw3g91OdSqnRBTgPuBQYk+HzUIC0HgGcQhKqq+OsXFHBpo0RKisTIEeRt6XVSzGhUB6dmfFdZ97yDL5O3wzNmebfR4CHzesvB/D7qU6llKgBbgamAz8BbkMW/NNJBkTrr4FXgCeAuRUVyZ5btkRYtqySikr/JaYW/8Ph3DqzjAwCV54B1umboRmITO2AeEA8Yl4fDgwI0HdTnUqpMQlZ1O+LeBhNBs4NoM7jgEvS/j8GmBEOw7o1UVpjoVyjC08oiyTZVh8mFttlZJNRZ6mUZ0c3NNciUztzgA/N33vmvakB+m5tdX5QAjo/CLBOxXsOyfDeoQHUeUSG9yaEw5BIiNeZ34amsirBmk/LWbMmSk1NPDXCyaizVMqzIxuak4Bvmdc/Ar5o/m40733LXFNsMumkBHQSUJ2Ku0SyvF9u49piEsvw3g6QqatQEVaRysqguSnM4oVVhMPJlIasOkulPDuiobkQmdYJA38GnjY97qmIf/efzGePmGuLRTadlIBOAqhTcdfA7Ad8BTgggxHJtLhRrDWZPoj77OAMn8UtvuebzmSSwTU1cZYvq2Dt2ijV1Ymi6QyF5C9ZmuVZFENTARwPvAzca3pczyD7PA5B1hEON68vNp+Vm2tfNvdW+PA9rOhMEVSdbSmmTsUbJpvf9PfIsd4nBlTnocBi4DHz7wmloLO8InnCtvoIixdWEo0W32ciVHrl6d2I01T+84D+QNS838181jdtOB8DbjXTOnF2XT+4FnHLO8VMAU0FjjR/LUjcr1ZgS1paq4A/As/aeEid6sToCaJOfNapeDNiCZtRSCbX0+lAP/O6CvEqeyZgvdcw8CBQm9ZGPAp0B5qCrDOZ5NFoWbL7+g3RpuYdIVJrRr5WgDLYvj3M9u0hunZN0LIjUirl6bmheRhxq8zGZuBxxAtigXlvFPCltGtOMu/NB34I/B24ygwVuyOeVZk4Lu0HyEchOke30Zk+LA2Szmx4qVNxl1rgeuBgYDnwY/Nvih5IjKp0RiBurOt81noVEu5oBXA5u+7R6Mfu3o6VwEjESSXQOiPh5MhkkvcS8RChUBKfth19pjMSSV5eXx9p+eTjCgYMaAlaeRbV0PwWuNr8f7lp2NaZXtla4CPT4NUi88rDgYva/IIh4G4zxbPI/F2ILGbvY3ryIWSe8sfAEHPfvTa02tH5OaPzwjw1bUERddrBC52Ku0xBNlnWABOR3fqnszM4aqcs91X6rPNaM5JOsTc7Y+xBZoeE1Ggt8DqTEPHZIWE3nRXlyaM/Xl7JmLFNRKPJ8lgsFITyLLqhuQbxcLjONFiXmQdklRkRPG96XnvmSesIdnXTWw0sND2RF41Vv8nkkUQ2pv3AhlYrOkemTU3YIc5O12IvdTrFTZ2Ku1ycNpKNINOeg9JGNdmaPr8XE65r8/+jzEhrblody1b3VKcFndHy5NimpvDchoYwvXu3xrMYmnhHejhS88k3INGD64GDgHeRRfQPjZHYs4C09wReMmkcArxj0q43ed1g8yGzorOfw/LwWqdbuKFTcZd+ed4Lym9TleG9/gEsz5LVmUzSPxIRF+ukPpGfGZoUjyObhBYAvUzDvR9wCzCtgLSnmV7255CzE3qZEc4Ek1ehuK0zhV86neK2TsWf5ysoZNqf0aI63dcZCukDkO1B+Mj0lucA1ciZKFWIZ9R0G+nebO6pBh5A5qffRxZKP3JBdyad1QXoTO+V/N3onOODTie9Jy90Kt6QLBFNqrP96wxcj2srspN+PbIAd5l5/wbgLgtp/grxvsHcO8ykdaxJ2y3a6vyOTZ3pXG7SWG/S9ENnIXipU1EUxdeh/Xp2hkH5Ttp1cyyk+V5a2pea1zeaNN3GiU4CoJOA6VQURfHN0AD8BdlQNAA40Ly3j4U0U9ccaO5tMml5RaE6CYBOAqhTURTFN0PTAMw2rw8y/46ykOaoNvfMNml5RaE6CYBOAqhTURTFN0MD8LH5d2CGBnwJslP9NPO6raEZ2CYNL7GiMxupe5YXQacd/NSpKIrim6HZbv6NIJ5Og4CNyCL/aOQ0uCfM68vMZ4PMtZG0nrzXWNGZjUibNPzSaRc/dSqKovhmaIaaf9eYxvs2xOvpV+zq095i3tsbuN30vteYz/by4XtY1ZmJlM5hPuu0i586FUVRXKMsx2flyNGyAP9FAmZ+HwmzcQayZtDHfL7OXPMcO6Ml9zb/TkSiGMc8+g6F6mxIuweThp86U9QgwTCDolNRFMU3Q/N50wjWAW8gmwW/j+zl6JLlnjrgl8gu/TfM/7sYY/OKR99BdSqKopSooUkdzvM8srj+ADvdhj9FwqCkFqaHAMcgsZ1+YEYSZ5l7v2zS8qphVJ1KUAlleY2F93HpekUpCUPTF3GprUQW2K8G/sbu0UcjwNeAn5kG9C12TvecwM7Q+V414KpTCRrpoUiyRetNtPnN8z2jTsObRPO8V2bhvvJsn6fF94rabG981Zknn/aos6hkcwYYhITcB1kTqDQ96PHI+fbZzrj+s7nmFXPPYeazkSZNt1GdSlCoy/DehrTX29oYlZTRSPfKzHQA2uY2/88UEWKrDZ2ZjFlDG52ZSH8/li3dROKziMV1DhtGT3Xm+d3ao87ijmhmhd/d7c2Jif3T96G0IscJ3zor/K6Vg1FXT0zs/wVk/WFaWmGMmhV+95MMeTnRn1Fnhgc6o04go07gE5fLuVR0lhyzZs13dP/EiaPckvIAcEHa7/MWsLRNw/I0cDI7p7+eZedx3CDHaqxjp1PIduDJNvksM2lPSKtPD9jQ+ZAZKadYC/yvjXF8AZm6TfEBu54G+whyoF86fw2FksQTIRKJEKFQciGE5rLrqaIvBkFnm/8vRM64ae86AzmiWWJ6Uq8Ch84Kv3uzRSMjD3/43cSs8LvTgUNNGpvZdVOnW+yiE4kabeeU8AQS7Vl1Kk6ZbozCemAWcKUxAulch6yzrTdG5Zo2n8811yw0HYzfAfe3uaYVOc1zlknnSVOfrHIBsq9ss8nvKHYPdf8Vo3OzyWdym88/AM5BNiBvRE7XvSUUgkQilH4Gy5dMo7sZ+HebBrloOjPk1RF0FndEk8VQLEbOOP+MjRsX1SBrA0ea6Zwh7PSWqkMWsueYaZ5/9uw5vGFW+N3/mesd8+TmBzO9vYvOUChEMpm0pdMMc/PqPKX7Wa7pNNjSGQ6HGxKJhHs6n3wy62emHAmHwyQSiULKMy+nnHKKqxW5kPrp8rO0CnHUyMVHiCt7rg7FfebPK3aQO1IGZpT1RQsjuAcAGraHGTAgxtlf3UQ8DmknStabv4RpHLd7pXPbtgijRzdx5NHbaGwM09IS2k1nDlzT2bIjRHWnBCd8aSvVnRI0NYVtl6cXOp2O/G1yCLKfcjgwE5hSZuEBHgZcC6Gzy8urO0WjnYhGKwmHo4RCMiBKJhO9E4lY71iseUIstv3ilpbG7Rs3LnoAuK1nz+F+9byHAddWVFSe06NH7+q+ffegS5daKisriETCvPnmgow6IfkAssHTV53ZyvOQQ0YSjyd6Nzfv6F1XVz9h/fp1F69fv6axtTX2oOnl+Knz+2Vl0bN69uxd3bt3b7p160KnTtU0NcVYtmwd9fXbfSnPjz7aeeROeXk54XCY1tZWamtr2bhx0bBIJPL9aLT8rJ49U797Z6qrqygrk/rZ2pro3djY1LuubtuEtWvXXLxx4/rGLVuWPhiPx29Zu7b7kvr6esrKykgkErS07Nzfu88++xBAyoA70qbOTjHTM98ulqBIGHY0h2hthUgE4jtXHJ9i596xs82U4dkBLFPV6XH9LMthYCqBaaFQeEpVVbfyysquhMORLD3gCOFwhLKySqqqupJIxDs1N2+9oKlpyzc2blx0J/Cjnj2HN2e8+bDm3LJTn2fvgVcC02pqaq8cOHCv6MCB/ams3NVBI5lMEgqFcupMJhN3ImsnnurMV56RSJiysggVFVG6dKlh4MA9iMX2rV6x4tPzPv54ydfr67fd4UhnfiqBH1dVVX934MDB0UGD+lNdvetZbS0tccLhEOGwg/J0yIcfflgJTKuu7nTlgAGDo4MGDaCyspxQKLzbyYbl5WHKy2vp0qWWAQP2oLm5pfqTT1aet3Llx1+fPXv2HcCPxo0b10xpsFfaQ5x6sM8upqGpKE+waVMZGzeWMXhwC7FYBCQKxqQ2l54WwPJUnT7Uz7IsRmYo8GhFRe34Tp16EQ7bc24IhyNUV/egsrJL+fbtG67ZsaP+2I0bF33Zg9HN0HA4/NigQUPHDR8+jKqqCsc6zfTHEg8qScHlGY2WMXToQAYO7BddtGjpNR9/vGRyLBY7zQud4XD48X79BowdOXI4NTWdAlme77///tBQKPTYnnsOHDdy5AiqqysJh/Mf8RMKQSgUprq6khEjhjJgwJ7RBQsWXrN69Yovvv/++2eMGTOmFNa9emd4r2sxBYXLoHlbmCWLKxmy12cjwp4ZLo0HsDxVpw/1M5zByOwPvF5T03t8be0ethvFXRueMmpr96Cmpvd4YJZJ2y32j0ajb4wf/7lx48aNtm1kcukEXNXpVnlGo2WMHj2C/fc/aExlZeUbbuuMRqNvjho1Zuz48WNsGxm/ynPevHn7R6PRN0ePHjduzJjR1NRUWzIyu2sMU1NTzZgxoxk9ety4aDT6xrx58/YPwIPaBTgPOeRuTCZ7GaBG5QjgFJJQXR1n5YoKNm2MUFmZgMwxBlu9FBMK5dGZGd915i3PYOssqH6G2xiZYcBztbV79KmsdK+TVFnZldraPfoAz5k8nDIsGo3+e7/9Duo9cGA/T3TiTvBKT8pzjz16cdBBh/SqrKx83i2d0Wj0hX33HddryJBBlJWVBbI8Fy5cOCwajT6/777jew0e3J+KinLn0z4V5Qwe3J999x3fKxqNPr9w4cJiBi2tQTzIpgM/Qda6hre5Jijn0f8acax4AphbUZHsuWVLhGXLKqmo9F9iytMtQ59jF51ZRgaBK8+A6iy4fobTjEwV8GhNTe9eFRW1riusqKilpqZ3L+Axk1ehVIXD4cf23Xe/nv369fJUJxKPrGCdXpZn9+5dOOCAg3qUlZU94VRnOBx+bMSIUd3799+DSCQcyPJcuHBhFfDoyJH79thzzz6uGUOAsrIy9tyzLyNH7tsDeMzkVQwmIWstfYFuiBvsuQFscI4DLkn7/xhgRjgM69ZEaY2Fco0uPKEskmRbfZhYbJeRTUadpVKeAdRZcP1Mb1WmVVTUjnOz552ph1tRUTsW2XhYKNMGDRo6duDAPQKv0+vy7NWrO3vvPXLfcDj848KnG0I37rnnwLEDB/YnEokEsjzLy8sBpvXvP2jcgAH9XDUyO41NhAED+tG//6CxwDSTp98ckuG9QwPY4ByR4b0J4bBEBojH8d3QVFYlWPNpOWvWRKmpiadGOBl1lkp5BlBnwfUzbEYzQ0Oh8JROnXp5rrRTp96EQuEpBU6hDa2pqb1y+PBhhDyuySmdBU75+Faew4btRW1t5+8WqrOysmrKiBF7U14eDWx5zps3b2hVVdWVw4cP91RneXmU4cOHU1VVfeW8efO8nELLZtHLbVxbTDKFTNkBMnUVKsIqUlkZNDeFWbywinA4mdKQVWeplGeRcL1+pkY0U6uqukWdLFRbJRyOUFXVLcrOc2vs9L6nDhy4V5mThX8/dPpZnpFImOHD9ymLRCLX2f+O4esHDBhUVlVVGfTf/bqBA/cqq6mp9lxnTU01AwcOKQuFQtd59ADvh+wUPyDDQ5ppfrtYazJ9EPfZwRk+i1t8zzedySSDa2riLF9Wwdq1UaqrE0XTKd6Nu/1wpVCentXP8MaNi2ohdLaXUzyZplIgdJbkbZna8vKKcwYO3NN3nYAtnX6X5x579Ka8vOIrdnVGImVfGTx4oGdTZm6U55NPPlkbiZSdNXjwQMJh77vK4XAIKZOyrzz55JNuL65NBp4Bfg/8AziRYHIoEs3iMfPvCaWgs7wiecK2+giLF1YSjRbfZyJUeuXpWf0MA8eXl1d3yrYZ06vebXl5dSfgeBu3Hd+zZ+/qysrywOv0vzxD9OvXv9quzl69eldXVlYEvjx79epT7ccodqdBrKBXrz52yzPVI4ySParudOSMoSpgD8RrJ2hTY2HgwbTOQBnwKM4cTnzRmUzyaLQsWbV+Q5TmHSHCYf9FRcpg+/Yw27eHqChPBK08i1Y/w8DR0Wgn37+xyfNoG7cc3afPHiWhsxjl2atXb9s6e/fu7flalxvl2bdvX397oiEwedrRWWse1BeQYJhD2nzeg10j7wKMoDhurFchkaN/y+7z7v2AAW1tLzuPuQi0zkg4OTKZhEQ8RCiU9F1nJJIsb2wM88nHFYTDySCVZ1HrZxkwtqyswvcaZPIca+OWsZ0715aEzmKUZ21tp3Zbnl27dvFdp8nTjs4pyCa2GuSo7a7A6eyM0p2t91Hp81e7FjmiIsXebQxqeY7ecOB1JiHis0PCbjorypNHf7y8kjFjm4hGk+VpQUaLWZ5FrZ9hYGgk4r8rp8lzqI1bhlZXV5SEzmKUp9m8aLM8q30f0RRSnlVV/s8ymDzt6LzYPMSpRuQUdj2cLltB+72Y0NbJ4ag2BjXbInRcdVrTGS1Pjm1qCtPQECYaTQZFZ1HrZxjoHC7CZKbJs7ONWzqHw2GSyaTtv0Qi6bvOUijPaLRwr7iUgZJgpdb/jOOBLZ2pKMz+jrxsl2e/PO8FZUd/Jqvdn+BRsjqTSfpHIuJinUwGRmdR62fJHAUKMHv2AoIV6ik4JBIJ3/KqqalizJjCTpKOx+M888yijvKzhAOoaQe7nz/fojrd1xkKaf1Mz2ibn41Um4Zxm41bVGcOWlpitnXGYoXH5LM7kkn9tbbGbetsbfW/PE2e2xwmkwxg45JUnR1SZ1HrZxhYGo/731EweS61cYvqzEF9faNtnY2NjSR9HNsnk0kaG+3rbGpq8r08TZ5LURTFFUMzt7XV/2gH8fgOkCilVlGdOdi8eYttndu21fuu0+RpS+fWrXW+6zR5ztUmQlHcMTQvxWLbfc+4pWU7wEs2blGdWUgkkqxZ86ltnevXr/d9RLN+/XrbOteuXevromoyCWvXrrWrU1GUHIbm2ZaWxu2JhH/edolEnJaWxkZkk5NVVGcW1q/fSkPDVts6N2xY39jc7N/oq7l5Bxs2rG+yr3NdEXSus6tTUZRshqZnz+H1kHywuXmrjw/yViD5gORtmaLplLyDqTMeT7Bs2XISibhtnfF468OffLKSeDzug844klfrQ3Z0nnLKKfXxeOtDH3+8wpGbup3R4ccfryAeb33wlFNOqdcmQlHcGdEA3NrUtCXmRy88kYjT1LQlhsTRsYvqbMOKFevZuHF1QToTicT0FSs+bm1qavZcZ1NTMytXftyaSCRutntvMpm8ecWK5a0NDY2e69y+vZEVK5a3JpPJW7R5UBQXDU3PnsOXJJOJO7ZvX+/Dg7yeZDJxZ8+ewxcXcLvvOpFoq4HUuWlTPYsXLyCRiBess7m56Y6FCxen3KM9oaUlxsKFi2lsbLyjEJ1jxoxZ0tTU+PNFixb5orOpqfGOMWPGLNbmQVHcHdEATNuxo36ul1M+zc1b2bGjfi4OT65UnbB163bmz19IY+NWRzqTyeSPVq9eMW/FilWeTKHF43FWrFjF6tUr5hWqs6WlBWDaqlWfzF258tPUXhxXaW1tZeXKT1m9+pN5wDSTp6Iobhqanj2HNwGnNzSs37Bjh/tT0zt21NPQsH4DcHrPnsOdzIH4phMIpM716+v44IOFbNq0yhWdiUTitIUL529etWoN8bh7myPj8QSrVq1h4cL5mxOJxGlOdI4YMaIJOH3Bgg82rV691lVj09oaZ/XqdSxY8MGmZDJ52ogRIxq1aVAUb0Y09Ow5fAlwXH39mnVu9sSbm7dSX79mHXCcycMpnus0eQRKZyzWytKla5g/fwEbN65wVWcsFjvmgw/e37h8+Se0trY6TrC1tZXlyz/hgw/e3xiLxY5xQ+eIESOWxGKxYz/4YM6Gjz9eyY4dzkcdO3a08PHHK/nggzkbYrHYsSNGjFji4vMVyvIaC+/j0vWKUvT6uVusm549h78LTGxoWD+3vn4NiUThjU4iEae+fg0NDevnAhNN2m7hmU6TdmB0xmJxVqzYwJw5y1i0aD5bt67xRGcsFjtk/vx5H8yZM4+GhsL3AjU0bGfOnHnMnz/vg1gsdoibOseMGfNuLBY7dP78ufPmzfuQhobGguK8JRIJGhoamTfvQ+bPnzsvFosdOmbMmHddfpDT3eSyDcHSxWcKHV+WI81CiOZ5r8zCfeXZPk+L7xW18F2KpjNPPu1RZ1HrZ8agambUMWHHjvrbt2z5ONbYuAk7HlSJRJzGxk1s2bI8tmNH/e3ABJdGMplGDK7qdGmEULDOeDxJS0sr27Y18umnm5k/fyVvv72QhQsX8umnCzzXmUgkDly9esXPXn/99daPPlqUChljicbGRj76aBGvv/566+rVK36WSCQO9ELnuHHjliQSiYNWrfrk9jfeeL114cKlNDY2k0gkcm7sTCbFwDQ2NrNw4VLeeOP11lWrPrk9kUgcNG7cOKc6M4Uv2JD2elubhzb1UDak/X9dhjQ2t/l/Jg8TO8PlTI1FQxudmUh/P5Yt3UTis4jFdQ4bRk915vnd2qPOotbPrEJ79hzeDFy7ceOi3zc2brqmsXHzOeXl1dXRaCei0UrC4WgqND2JRIJEIkYs1kwstp2WlsYmSP4duK1A7zJbM17AtclkwpFOCvPacl3n7NkfBUHn95qaGu9dvHjB1KVLF5/ds2fvqt69e9OtWxeqq6soKyv7bHqssbGJLVvqWL9+PRs3rm9OJOIPJBKJW0KhkKc6R48e3VxbW3vt7Nmzf79kyYKpy5aJzr59+9K1axeqqqooK4sYnXGamprYurWOtWvXfqYzHo/fcvDBBy+ur3dlDe0B4IK0h/8tdo2Vtg14Gjg5bXrhWWBL2jUvmYe5j/n/duDJNvksM2lPSM1Smryt8hDwtbT/rwX+16bxeQE4Ju29D4AFaf9/BPhhm3T/GgoliSdCJBIhQqHkQgjNZdczZF4Mgs42/1+IhBpq7zqLWj9Dr732oSWVGzcuqgFOBI4ExiNHgXZN61EtB+YArwDP9Ow5vMFKuo890p07fpH9qN4pV6wF4PAjZ1stUFs621js7K1vUwVnnT056+cPPvAvACqrdpS8zlAoRDKZJBwOk0gkbOkMh8MNiUTiszSc6sxH/wGDHNXPVSs/yZtHLp1p9bQ/cAdwGLAIOXnxjTaX7WOu2Q+YB1wOzG8zw/BN4BpTPx4Brmd3J4pDgNuB4cBMYModv+i7ykp5TblibYVpdA4HVgFnAR+1uawbcs7954y+s8216ZwN3Gx0PgR8Z/v2MHv2j3Hc5K0kEhCPhwYCjyIHyP0POGfixFGbvdS5vSG8qv/AFo6bXEc8DvF4aDedGbJzVWcsFvooGk0y+YSt9OjRSlNTuKDydFPnrFnzi1o/Q9+9fE034H7gWKwdL9oCPAycf/qXN7cYY1GJnEP9lSxziW1pNVb+bKDOiqExlaognUDLhIPfAzmWtGCdFhtGRzrNe6rTBZ39BwxqMcbEM52KouQnDPwCmIz1M6zLzVDx+sce6c5jj3QH+IF5L2oxjTKT5502tBasM+091dmBdK5a+UlqxOKHTkVRchiaQrtr6fcd50Iabl6rOlWn3zoVRclhaHoWeG+ftNdupJEP1ak6g6xTUZQchkZRlCzo+oyiqKFRFEVR1NAoiqIoamgURVEURQ2NoiiKooZGURRFUdTQKIqiKGpoFEVRlHZlaOoKvDc9mJsbaeRDdarOIOtUFCWHoXm0wHsfS3vtRhr5UJ2qM8g6FUXJQhlwFVALfAFrx3a2mgfw9rT3bgX6IefXWwl+mEDOUvieDa2qU3UGWaeiKDkMTR0SPt0JLcC3zJ9XqE7VGWSdiqLkMDQdgrdm7+c4jbPO9jZ9t/BDpznfR1EUxZKh6QLci/WpiTgyNXE5Ow/AKgfuAk6zODWRRA6WuhjrC7WqU3UGWaeiKDkMzQzgTJv3XYwcRXqT+f9U4CKbaXwFOafa6n2qU3UGWaeiKFkIA2cUeO/paa/dSCMfqlN1Blmnoig5DE2XAu/t3mZ6w2ka+VCdqjPIOhVFyWFoFEVRFEUNjaIoiqKGRlEURVHU0CiKoihqaBRFURQ1NIqiKIqihkZRFEVRQ6MoiqJ0BEOzscB716W9diONfKhO1RlknYqi5DA0/yrw3mfTXj/nQhr5UJ2qM8g6FUXJYWguNw9zq8V7WoC/Ajenvfdj4G/sjJabj1bzEE+xoVV1qs4g61QUJQv/PwAlukJhy2ScjQAAAABJRU5ErkJggg==";luckysheet.getluckysheet_select_save=function(){return luckysheet_select_save;};luckysheet.setluckysheet_select_save=function(v){luckysheet_select_save=v;};luckysheet.getluckysheet_scroll_status=function(){return luckysheet_scroll_status;};luckysheet.setluckysheet_scroll_status=function(v){luckysheet_scroll_status=v;};var luckysheetConfigsetting={allowCopy:true,showtoolbar:true,showinfobar:true,showsheetbar:true,showstatisticBar:true,pointEdit:false,pointEditUpdate:null,pointEditZoom:1,showConfigWindowResize:true,enableAddRow:true,enableAddCol:true,enablePage:true,pageInfo:null,autoFormatw:false,accuracy:undefined,editMode:false,chartConfigChange:null,beforeCreateDom:null,total:0};luckysheet.luckysheetConfigsetting=luckysheetConfigsetting;var luckysheetdefaultstyle={font:'normal '+Math.ceil(10*window.devicePixelRatio)+'pt 微软雅黑, "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Heiti SC", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif',fillStyle:"#000000",textBaseline:"middle",strokeStyle:"#dfdfdf",rowFillStyle:"#5e5e5e",textAlign:'center'};luckysheet.luckysheetdefaultstyle=luckysheetdefaultstyle;//编辑器qksheet表格编辑所需一些方法
  luckysheet.setluckysheet_pointEditZoom=function(v){luckysheetConfigsetting.pointEditZoom=v;};// 替换temp中的${xxx}为指定内容 ,temp:字符串，这里指html代码，dataarry：一个对象{"xxx":"替换的内容"}
  // 例：luckysheet.replaceHtml("${image}",{"image":"abc","jskdjslf":"abc"})   ==>  abc
  luckysheet.replaceHtml=function(temp,dataarry){return temp.replace(/\$\{([\w]+)\}/g,function(s1,s2){var s=dataarry[s2];if(typeof s!="undefined"){return s;}else {return s1;}});};//是否为非编辑模式
  luckysheet.isEditMode=function(){if(luckysheet.luckysheetConfigsetting.editMode){return true;}else {return false;}};//太平秀编辑器 数据初始化（针对 合并单元格）
  luckysheet.flowdataInit=function(flowdata){var data=[];var cfg_merge={},mclist={};for(var r=0;r<flowdata.length;r++){var dataRow=[];for(var c=0;c<flowdata[r].length;c++){if(flowdata[r][c]!=null&&flowdata[r][c].mc!=null){var cell=$.extend(true,{},flowdata[r][c]);if(cell.mc.rs!=null){mclist[cell.mc.r+"_"+cell.mc.c]=[r,c];cell.mc.r=r;cell.mc.c=c;cfg_merge[r+"_"+c]=cell.mc;}else {if(cell.mc.r+"_"+cell.mc.c in mclist){var mcArr=mclist[cell.mc.r+"_"+cell.mc.c];cell.mc.r=mcArr[0];cell.mc.c=mcArr[1];}}dataRow.push(cell);}else {dataRow.push(flowdata[r][c]);}}data.push(dataRow);}if(JSON.stringify(cfg_merge).length>2){return {"data":data,"config":{"merge":cfg_merge}};}else {return {"data":data};}};//判断数据类型
  luckysheet.getObjType=function(obj){var toString=Object.prototype.toString;var map={'[object Boolean]':'boolean','[object Number]':'number','[object String]':'string','[object Function]':'function','[object Array]':'array','[object Date]':'date','[object RegExp]':'regExp','[object Undefined]':'undefined','[object Null]':'null','[object Object]':'object'};// if(obj instanceof Element){
  //     return 'element';
  // }
  return map[toString.call(obj)];};luckysheet.func_methods={//单元格数据生成一维数组
  getCellDataArr:function getCellDataArr(rangeObj,nullCellType,isNeglectNullCell){var dataArr=[];if(rangeObj.data==null){if(!isNeglectNullCell){if(nullCellType=="number"){dataArr.push(0);}else if(nullCellType=="text"){dataArr.push("");}}}else {if(luckysheet.getObjType(rangeObj.data)=="array"){for(var i=0;i<rangeObj.data.length;i++){for(var j=0;j<rangeObj.data[i].length;j++){if(rangeObj.data[i][j]!=null&&!luckysheet.func_methods.isRealNull(rangeObj.data[i][j].v)){dataArr.push(rangeObj.data[i][j].v);}else {if(!isNeglectNullCell){if(nullCellType=="number"){dataArr.push(0);}else if(nullCellType=="text"){dataArr.push("");}}}}}}else {if(luckysheet.func_methods.isRealNull(rangeObj.data.v)){if(!isNeglectNullCell){if(nullCellType=="number"){dataArr.push(0);}else if(nullCellType=="text"){dataArr.push("");}}}else {dataArr.push(rangeObj.data.v);}}}return dataArr;},//单元格数据生成二维数组
  getCellDataDyadicArr:function getCellDataDyadicArr(rangeObj,nullCellType){var dataArr=[];if(rangeObj.data==null){var rowArr=[];if(nullCellType=="number"){rowArr.push(0);}else if(nullCellType=="text"){rowArr.push("");}dataArr.push(rowArr);}else {if(luckysheet.getObjType(rangeObj.data)=="array"){for(var i=0;i<rangeObj.data.length;i++){var rowArr=[];for(var j=0;j<rangeObj.data[i].length;j++){var value;if(rangeObj.data[i][j]!=null&&!luckysheet.func_methods.isRealNull(rangeObj.data[i][j].v)){value=rangeObj.data[i][j].v;}else {if(nullCellType=="number"){value=0;}else if(nullCellType=="text"){value="";}}rowArr.push(value);}dataArr.push(rowArr);}}else {var rowArr=[];var value=rangeObj.data.v;if(luckysheet.func_methods.isRealNull(value)){if(nullCellType=="number"){value=0;}else if(nullCellType=="text"){value="";}}rowArr.push(value);dataArr.push(rowArr);}}return dataArr;},//数组数据生成一维数组
  getDataArr:function getDataArr(arr,isNeglectNaN){var dataArr=[];if(isNeglectNaN==null){isNeglectNaN=false;}if(luckysheet.getObjType(arr[0])=="array"){for(var i=0;i<arr.length;i++){for(var j=0;j<arr[i].length;j++){if(isNeglectNaN&&!luckysheet.func_methods.isRealNum(arr[i][j])){continue;}dataArr.push(arr[i][j]);}}}else {for(var i=0;i<arr.length;i++){if(isNeglectNaN&&!luckysheet.func_methods.isRealNum(arr[i])){continue;}dataArr.push(arr[i]);}}return dataArr;},getDataDyadicArr:function getDataDyadicArr(arr){var dataArr=[];if(luckysheet.getObjType(arr[0])=="array"){for(var i=0;i<arr.length;i++){var rowArr=[];for(var j=0;j<arr[i].length;j++){rowArr.push(arr[i][j]);}dataArr.push(rowArr);}}else {var rowArr=[];for(var i=0;i<arr.length;i++){rowArr.push(arr[i]);}dataArr.push(rowArr);}return dataArr;},//是否是规则二维数组
  isDyadicArr:function isDyadicArr(arr){var isDyadic=true;if(arr.length>1){var collen=arr[0].length;for(var i=1;i<arr.length;i++){if(arr[i].length!=collen){isDyadic=false;break;}}}return isDyadic;},//获取单个单元格数据，数组第一个值
  getFirstValue:function getFirstValue(data,nullCellType){if(nullCellType==null){nullCellType="number";}var value;if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}value=data[0][0];}else {value=data[0];}}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){if(data.data==null){if(nullCellType=="number"){value=0;}else if(nullCellType=="text"){value="";}}else {var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;if(data.rowl==1&&data.coll==1){value=data.data;if(value==null||luckysheet.func_methods.isRealNull(value.v)){if(nullCellType=="number"){value=0;}else if(nullCellType=="text"){value="";}}else {value=value.v;}}else {if(data.data[0][0].mc!=null&&data.data[0][0].mc.rs==data.rowl&&data.data[0][0].mc.cs==data.coll){value=data.data[0][0];if(value==null||luckysheet.func_methods.isRealNull(value.v)){if(nullCellType=="number"){value=0;}else if(nullCellType=="text"){value="";}}else {value=value.v;}}else if(data.rowl==1||data.coll==1){var cellrange=luckysheet.formula.getcellrange(data.startCell);var str=cellrange.row[0],edr=str+data.rowl-1,stc=cellrange.column[0],edc=stc+data.coll-1;if(data.rowl==1){if(cell_c<stc||cell_c>edc){return luckysheet.formula.error.v;}value=data.data[0][cell_c-stc];}else if(data.coll==1){if(cell_r<str||cell_r>edr){return luckysheet.formula.error.v;}value=data.data[cell_r-str][0];}if(value==null||luckysheet.func_methods.isRealNull(value.v)||value.mc!=null){if(nullCellType=="number"){value=0;}else if(nullCellType=="text"){value="";}}else {value=value.v;}}else {return luckysheet.formula.error.v;}}}}else {value=data;}return value;},//获取单元格的逻辑值
  getCellBoolen:function getCellBoolen(data){var cumulative=luckysheet.func_methods.getFirstValue(data);if(luckysheet.func_methods.valueIsError(cumulative)){return cumulative;}if(luckysheet.getObjType(cumulative)=="boolean");else if(luckysheet.getObjType(cumulative)=="string"&&(cumulative.toLowerCase()=="true"||cumulative.toLowerCase()=="false")){if(cumulative.toLowerCase()=="true"){cumulative=true;}else if(cumulative.toLowerCase()=="false"){cumulative=false;}}else if(luckysheet.func_methods.isRealNum(cumulative)){cumulative=parseFloat(cumulative);cumulative=cumulative==0?false:true;}else {return luckysheet.formula.error.v;}return cumulative;},//获取单元格的日期
  getCellDate:function getCellDate(data){var date_text;if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}date_text=data[0][0];}else {date_text=data[0];}}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){if(data.data==null||luckysheet.getObjType(data.data)=="array"||luckysheet.func_methods.isRealNull(data.data.v)){return luckysheet.formula.error.v;}date_text=data.data.v;if(data.data.ct!=null&&data.data.ct.t=="d"){date_text=luckysheet.mask.update("YYYY-MM-DD h:mm:ss",date_text);}}else {date_text=data;}return date_text;},getCellrangeDate:function getCellrangeDate(data){var date=[];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}date=date.concat(luckysheet.func_methods.getDataArr(data,false));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){if(data.data==null){date.push(0);}else {if(luckysheet.getObjType(data.data)=="array"){for(var i=0;i<data.data.length;i++){for(var j=0;j<data.data[i].length;j++){if(data.data[i][j]!=null&&!luckysheet.func_methods.isRealNull(data.data[i][j].v)){var value=data.data[i][j].v;if(data.data[i][j].ct!=null&&data.data[i][j].ct.t=="d"){value=luckysheet.mask.update("YYYY-MM-DD h:mm:ss",value);}date.push(value);}else {date.push(0);}}}}else {var value=data.data.v;if(data.data.ct!=null&&data.data.ct.t=="d"){value=luckysheet.mask.update("YYYY-MM-DD h:mm:ss",value);}date.push(value);}}}else {date.push(data);}return date;},//是否是纯数字
  isRealNum:function isRealNum(val){if(val==null||val.toString().replace(/\s/g,"")===""){return false;}if(typeof val=="boolean"){return false;}if(!isNaN(val)){return true;}else {return false;}},//是否是空值
  isRealNull:function isRealNull(val){if(val==null||val.toString().replace(/\s/g,"")==""){return true;}else {return false;}},//是否是错误类型
  valueIsError:function valueIsError(value){var isError=false;for(var _x in luckysheet.formula.error){if(value==luckysheet.formula.error[_x]){isError=true;break;}}return isError;},//获取正则字符串（处理 . * ? ~* ~?）
  getRegExpStr:function getRegExpStr(str){return str.replace("~*","\\*").replace("~?","\\?").replace(".","\\.").replace("*",".*").replace("?",".");},//阶乘
  factorial:function factorial(num){if(num==0||num==1){return 1;}else {return num*luckysheet.func_methods.factorial(num-1);}},//双阶乘
  factorialDouble:function factorialDouble(num){if(num<=0){return 1;}else {return num*luckysheet.func_methods.factorialDouble(num-2);}},//总体方差
  variance:function variance(num_arr){var sum=0,count=0;for(var i=0;i<num_arr.length;i++){var number=num_arr[i];sum+=number;count++;}var avg=sum/count;var sum_variance=0;for(var j=0;j<num_arr.length;j++){var number=num_arr[j];sum_variance+=(number-avg)*(number-avg);}return sum_variance/count;},//样本方差
  variance_s:function variance_s(num_arr){var sum=0,count=0;for(var i=0;i<num_arr.length;i++){var number=num_arr[i];sum+=number;count++;}var avg=sum/count;var sum_variance=0;for(var j=0;j<num_arr.length;j++){var number=num_arr[j];sum_variance+=(number-avg)*(number-avg);}return sum_variance/(count-1);},//总体标准偏差
  standardDeviation:function standardDeviation(num_arr){var sum=0,count=0;for(var i=0;i<num_arr.length;i++){var number=num_arr[i];sum+=number;count++;}var avg=sum/count;var sum_variance=0;for(var j=0;j<num_arr.length;j++){var number=num_arr[j];sum_variance+=(number-avg)*(number-avg);}return Math.sqrt(sum_variance/count);},//样本标准偏差
  standardDeviation_s:function standardDeviation_s(num_arr){var sum=0,count=0;for(var i=0;i<num_arr.length;i++){var number=num_arr[i];sum+=number;count++;}var avg=sum/count;var sum_variance=0;for(var j=0;j<num_arr.length;j++){var number=num_arr[j];sum_variance+=(number-avg)*(number-avg);}return Math.sqrt(sum_variance/(count-1));},//是否是闰年
  isLeapYear:function isLeapYear(year){return new Date(year,1,29).getMonth()===1;},//2月是否有29
  feb29Between:function feb29Between(date1,date2){var year1=moment(date1).year();var mar1year1=moment().set({'year':year1,'month':2,'date':1});if(luckysheet.func_methods.isLeapYear(year1)&&moment(date1)<moment(mar1year1)&&moment(date2)>=moment(mar1year1)){return true;}var year2=moment(date2).year();var mar1year2=moment().set({'year':year2,'month':2,'date':1});return luckysheet.func_methods.isLeapYear(year2)&&moment(date2)>=moment(mar1year2)&&moment(date1)<moment(mar1year2);},//SQL 查询
  findResultIndex:function findResultIndex(database,criterias){var matches={};for(var i=1;i<database[0].length;++i){matches[i]=true;}var maxCriteriaLength=criterias[0].length;for(i=1;i<criterias.length;++i){if(criterias[i].length>maxCriteriaLength){maxCriteriaLength=criterias[i].length;}}for(var k=1;k<database.length;++k){for(var l=1;l<database[k].length;++l){var currentCriteriaResult=false;var hasMatchingCriteria=false;for(var j=0;j<criterias.length;++j){var criteria=criterias[j];if(criteria.length<maxCriteriaLength){continue;}var criteriaField=criteria[0];if(database[k][0]!==criteriaField){continue;}hasMatchingCriteria=true;for(var p=1;p<criteria.length;++p){currentCriteriaResult=currentCriteriaResult||eval(database[k][l]+criteria[p]);// jshint ignore:line
  }}if(hasMatchingCriteria){matches[l]=matches[l]&&currentCriteriaResult;}}}var result=[];for(var n=0;n<database[0].length;++n){if(matches[n]){result.push(n-1);}}return result;},findField:function findField(database,title){var index=null;for(var i=0;i<database.length;i++){if(database[i][0]==title){index=i;break;}}if(index==null){return luckysheet.formula.error.v;}return index;},rest:function rest(array,idx){idx=idx||1;if(!array||typeof array.slice!=='function'){return array;}return array.slice(idx);},compact:function compact(array){if(!array){return array;}var result=[];for(var i=0;i<array.length;++i){if(!array[i]){continue;}result.push(array[i]);}return result;}};//颜色 16进制转rgb
  luckysheet.hexToRgb=function(hex){var color=[],rgb=[];hex=hex.replace(/#/,"");if(hex.length==3){// 处理 "#abc" 成 "#aabbcc"
  var tmp=[];for(var i=0;i<3;i++){tmp.push(hex.charAt(i)+hex.charAt(i));}hex=tmp.join("");}for(var i=0;i<3;i++){color[i]="0x"+hex.substr(i+2,2);rgb.push(parseInt(Number(color[i])));}return 'rgb('+rgb.join(",")+')';};//颜色 rgb转16进制
  luckysheet.rgbTohex=function(color){if(color.indexOf("rgba")>-1){var rgb=color.replace("rgba(","").replace(")","").split(',');}else {var rgb=color.replace("rgb(","").replace(")","").split(',');}var r=parseInt(rgb[0]);var g=parseInt(rgb[1]);var b=parseInt(rgb[2]);var hex="#"+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1);return hex;};//列下标  字母转数字
  luckysheet.luckysheetABCatNum=function(abc){abc=abc.toUpperCase();var abc_len=abc.length;if(abc_len==0){return NaN;}var abc_array=abc.split("");var wordlen=columeHeader_word.length;var ret=0;for(var i=abc_len-1;i>=0;i--){if(i==abc_len-1){ret+=columeHeader_word_index[abc_array[i]];}else {ret+=Math.pow(wordlen,abc_len-i-1)*(columeHeader_word_index[abc_array[i]]+1);}}return ret;};//列下标  数字转字母
  luckysheet.luckysheetchatatABC=function(index){var wordlen=columeHeader_word.length;if(index<wordlen){return columeHeader_word[index];}else {var last=0,ret="";var i=1,n=0;while(index>=wordlen/(wordlen-1)*(Math.pow(wordlen,i++)-1)){n=i;}var index_ab=index-wordlen/(wordlen-1)*(Math.pow(wordlen,n-1)-1);//970
  last=index_ab+1;for(var x=n;x>0;x--){var last1=last;//-702=268, 3
  if(x==1){last1=last1%wordlen;if(last1==0){last1=26;}return ret+columeHeader_word[last1-1];}last1=Math.ceil(last1/Math.pow(wordlen,x-1));//last1 = last1 % wordlen;
  ret+=columeHeader_word[last1-1];if(x>1){last=last-(last1-1)*wordlen;}}}};//计算字符串字节长度
  luckysheet.getByteLen=function(val){if(val==null){return 0;}var len=0;for(var i=0;i<val.length;i++){var a=val.charAt(i);if(a.match(/[^\x00-\xff]/ig)!=null){len+=2;}else {len+=1;}}return len;};luckysheet.ceateABC=function(index){var wordlen=columeHeader_word.length;if(index<wordlen){return columeHeader_word;}else {var relist=[];var i=2,n=0;while(index<wordlen/(wordlen-1)*(Math.pow(wordlen,i)-1)){n=i;i++;}for(var x=0;x<n;x++){if(x==0){relist=relist.concat(columeHeader_word);}else {relist=relist.concat(luckysheet.createABCdim(x),index);}}}};luckysheet.convertRowColumn=function(a){if(a.length==0){return [];}var b=[];for(var j=0;j<a[0].length;j++){b[j]=[];for(var i=0;i<a.length;i++){b[j][i]=a[i][j];}}return b;};luckysheet.createABCdim=function(x,count){var chwl=columeHeader_word.length;if(x==1){var ret=[];var c=0;for(var i=0;i<chwl;i++){var b=columeHeader_word[i];for(var n=0;n<chwl;n++){var bq=b+columeHeader_word[n];ret.push(bq);c++;if(c>index){return ret;}}}}else if(x==2){var ret=[];var c=0;for(var i=0;i<chwl;i++){var bb=columeHeader_word[i];for(var w=0;w<chwl;w++){var aa=columeHeader_word[w];for(var n=0;n<chwl;n++){var bqa=bb+aa+columeHeader_word[n];ret.push(bqa);c++;if(c>index){return ret;}}}}}};luckysheet.jfshowloading=function(txt){$("#luckysheet-cell-loading").find("span").text(txt).end().show();};luckysheet.jfhideloading=function(){$("#luckysheet-cell-loading").hide();};luckysheet.browser={mobilecheck:function mobilecheck(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0);}(navigator.userAgent||navigator.vendor||window.opera),document.body&&document.body.clientWidth&&document.body.clientHeight&&document.body.clientWidth<350&&document.body.clientHeight<500&&(a=!0),a;},iphoneCheck:function iphoneCheck(){var a=!1;return /iPhone/i.test(navigator.userAgent)&&(a=!0),!0;},isWeixin:function isWeixin(){var a=navigator.userAgent.toLowerCase();return "micromessenger"==a.match(/MicroMessenger/i)?!0:!1;},isAndroid:function isAndroid(){var a=navigator.userAgent,b=(a.indexOf("Android")>-1||a.indexOf("Linux")>-1);return b;},tabletCheck:function tabletCheck(){var a=/ipad|android|android 3.0|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent.toLowerCase());return a;},BrowserType:function BrowserType(){var userAgent=navigator.userAgent;//取得浏览器的userAgent字符串
  var isOpera=userAgent.indexOf("Opera")>-1;//判断是否Opera浏览器
  var isIE=userAgent.indexOf("compatible")>-1&&userAgent.indexOf("MSIE")>-1&&!isOpera;//判断是否IE浏览器
  var isIE11=userAgent.indexOf('Trident')>-1&&userAgent.indexOf("rv:11.0")>-1;var isEdge=userAgent.indexOf("Edge")>-1;//判断是否IE的Edge浏览器
  var isFF=userAgent.indexOf("Firefox")>-1;//判断是否Firefox浏览器
  var isSafari=userAgent.indexOf("Safari")>-1&&userAgent.indexOf("Chrome")==-1;//判断是否Safari浏览器
  var isChrome=userAgent.indexOf("Chrome")>-1&&userAgent.indexOf("Safari")>-1;//判断Chrome浏览器
  if(isIE){var reIE=new RegExp("MSIE (\\d+\\.\\d+);");reIE.test(userAgent);var fIEVersion=parseFloat(RegExp["$1"]);if(fIEVersion==7){return "IE7";}else if(fIEVersion==8){return "IE8";}else if(fIEVersion==9){return "IE9";}else if(fIEVersion==10){return "IE10";// } else if (fIEVersion == 11) {
  //     return "IE11";
  }else {return "0";}//IE版本过低
  }//isIE end
  if(isFF){return "FF";}if(isOpera){return "Opera";}if(isSafari){return "Safari";}if(isChrome){return "Chrome";}if(isEdge){return "Edge";}if(isIE11){return "IE11";}},//myBrowser() end
  //判断是否是IE浏览器
  isIE:function isIE(){var userAgent=navigator.userAgent;//取得浏览器的userAgent字符串
  var isOpera=userAgent.indexOf("Opera")>-1;//判断是否Opera浏览器
  var isIE=userAgent.indexOf("compatible")>-1&&userAgent.indexOf("MSIE")>-1&&!isOpera;//判断是否IE浏览器
  var isIE11=userAgent.indexOf('Trident')>-1&&userAgent.indexOf("rv:11.0")>-1;if(isIE||isIE11){return "1";}else {return "-1";}},//判断是否是IE浏览器，包括Edge浏览器
  IEVersion:function IEVersion(){var userAgent=navigator.userAgent;//取得浏览器的userAgent字符串
  var isOpera=userAgent.indexOf("Opera")>-1;//判断是否Opera浏览器
  var isIE=userAgent.indexOf("compatible")>-1&&userAgent.indexOf("MSIE")>-1&&!isOpera;//判断是否IE浏览器
  var isIE11=userAgent.indexOf('Trident')>-1&&userAgent.indexOf("rv:11.0")>-1;var isEdge=userAgent.indexOf("Windows NT 6.1; Trident/7.0;")>-1&&!isIE;//判断是否IE的Edge浏览器
  if(isIE){var reIE=new RegExp("MSIE (\\d+\\.\\d+);");reIE.test(userAgent);var fIEVersion=parseFloat(RegExp["$1"]);if(fIEVersion==7){return "IE7";}else if(fIEVersion==8){return "IE8";}else if(fIEVersion==9){return "IE9";}else if(fIEVersion==10){return "IE10";// } else if (fIEVersion == 11) {
  //     return "IE11";
  }else {return "0";}//IE版本过低
  }else if(isEdge){return "Edge";}else if(isIE11){return "IE11";}else {return "-1";//非IE
  }},luckysheetrefreshfixednum:null,luckysheetrefreshfixed:function luckysheetrefreshfixed(){var _this=this;if(_this.luckysheetrefreshfixednum==null){if(_this.BrowserType()=="FF"){_this.luckysheetrefreshfixednum=5;}else {_this.luckysheetrefreshfixednum=0;}}return _this.luckysheetrefreshfixednum;}};//设备是移动端
  var mobilecheck=luckysheet.browser.mobilecheck();if(mobilecheck){//去除滚动条
  cellMainSrollBarSize=0;//滑动滚动表格
  var luckysheet_touchmove_status=false,luckysheet_touchmove_startPos={},luckysheet_touchhandle_status=false;$(document).on("touchstart","#luckysheet-grid-window-1",function(event){luckysheet_touchmove_status=true;var touch=event.originalEvent.targetTouches[0];luckysheet_touchmove_startPos={x:touch.pageX,y:touch.pageY};});$(document).on("touchmove","#luckysheet-grid-window-1",function(event){if(event.originalEvent.targetTouches.length>1||event.scale&&event.scale!==1){return;}var touch=event.originalEvent.targetTouches[0];if(luckysheet_touchmove_status){//滚动
  var slideX=touch.pageX-luckysheet_touchmove_startPos.x;var slideY=touch.pageY-luckysheet_touchmove_startPos.y;luckysheet_touchmove_startPos={x:touch.pageX,y:touch.pageY};var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var scrollTop=$("#luckysheet-cell-main").scrollTop();scrollLeft-=slideX;scrollTop-=slideY;if(scrollLeft<0){scrollLeft=0;}if(scrollTop<0){scrollTop=0;}if(Math.abs(slideX)<Math.abs(slideY)){$("#luckysheet-scrollbar-y").scrollTop(scrollTop);}else {$("#luckysheet-scrollbar-x").scrollLeft(scrollLeft);}}else if(luckysheet_touchhandle_status){//选区
  var mouse=luckysheet.mouseposition(touch.pageX,touch.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];var last=$.extend(true,{},luckysheet_select_save[luckysheet_select_save.length-1]);var top=0,height=0,rowseleted=[];if(last.top>row_pre){top=row_pre;height=last.top+last.height-row_pre;if(last.row[1]>last.row_focus){last.row[1]=last.row_focus;}rowseleted=[row_index,last.row[1]];}else if(last.top==row_pre){top=row_pre;height=last.top+last.height-row_pre;rowseleted=[row_index,last.row[0]];}else {top=last.top;height=row-last.top-1;if(last.row[0]<last.row_focus){last.row[0]=last.row_focus;}rowseleted=[last.row[0],row_index];}var left=0,width=0,columnseleted=[];if(last.left>col_pre){left=col_pre;width=last.left+last.width-col_pre;if(last.column[1]>last.column_focus){last.column[1]=last.column_focus;}columnseleted=[col_index,last.column[1]];}else if(last.left==col_pre){left=col_pre;width=last.left+last.width-col_pre;columnseleted=[col_index,last.column[0]];}else {left=last.left;width=col-last.left-1;if(last.column[0]<last.column_focus){last.column[0]=last.column_focus;}columnseleted=[last.column[0],col_index];}var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,rowseleted,last,top,height,left,width);if(changeparam!=null){columnseleted=changeparam[0];rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];left=changeparam[4];width=changeparam[5];}last["row"]=rowseleted;last["column"]=columnseleted;last["left_move"]=left;last["width_move"]=width;last["top_move"]=top;last["height_move"]=height;luckysheet_select_save[luckysheet_select_save.length-1]=last;luckysheet.selectHightlightShow();luckysheet.freezen.scrollFreezen();}event.stopPropagation();});$(document).on("touchend",function(event){luckysheet_touchmove_status=false;luckysheet_touchmove_startPos={};luckysheet_touchhandle_status=false;});//滑动选择选区
  $(document).on("touchstart",".luckysheet-cs-touchhandle",function(event){luckysheet_touchhandle_status=true;event.stopPropagation();});//禁止微信下拉拖出微信背景
  document.addEventListener("touchmove",function(event){event.preventDefault();},{passive:false});}luckysheet.controlHistory={redo:function redo(e){if(luckysheet.jfredo.length==0){return;}var ctr=luckysheet.jfredo.pop();luckysheet.jfundo.push(ctr);clearjfundo=false;if(luckysheet.sheetmanage.hasSheet(ctr.sheetIndex)&&luckysheet.currentSheetIndex!=ctr.sheetIndex){luckysheet.sheetmanage.changeSheetExec(ctr.sheetIndex);}if(ctr.type=="datachange"){//如果有单元格为null,则对应公式应该删除
  for(var s=0;s<ctr.range.length;s++){var st_r=ctr.range[s].row[0];var ed_r=ctr.range[s].row[1];var st_c=ctr.range[s].column[0];var ed_c=ctr.range[s].column[1];for(var r=st_r;r<ed_r+1;r++){for(var c=st_c;c<ed_c+1;c++){if(ctr.data[r][c]==null){luckysheet.formula.delFunctionGroup(r,c);}}}}luckysheet.formula.execFunctionGroup(null,null,null,null,ctr.data);//取之前的数据
  luckysheet.jfrefreshgrid(ctr.data,ctr.range,ctr.config,ctr.cdformat,ctr.RowlChange);}else if(ctr.type=="pasteCut"){var s={"sheetIndex":ctr.source["sheetIndex"],"data":ctr.source["curData"],"curData":ctr.source["data"],"config":ctr.source["curConfig"],"curConfig":ctr.source["config"],"cdformat":ctr.source["curCdformat"],"curCdformat":ctr.source["cdformat"],"range":ctr.source["range"]};var t={"sheetIndex":ctr.target["sheetIndex"],"data":ctr.target["curData"],"curData":ctr.target["data"],"config":ctr.target["curConfig"],"curConfig":ctr.target["config"],"cdformat":ctr.target["curCdformat"],"curCdformat":ctr.target["cdformat"],"range":ctr.target["range"]};luckysheet.jfrefreshgrid_pastcut(s,t,ctr.RowlChange);}else if(ctr.type=="cellchange"){luckysheet.formula.execFunctionGroup(ctr.uprow,ctr.upcolumn,ctr.value);luckysheet.jfrefreshcell(ctr.value,ctr.uprow,ctr.upcolumn);}else if(ctr.type=="rangechange"){//如果有单元格为null,则对应公式应该删除
  for(var s=0;s<ctr.range.length;s++){var st_r=ctr.range[s].row[0];var ed_r=ctr.range[s].row[1];var st_c=ctr.range[s].column[0];var ed_c=ctr.range[s].column[1];for(var r=st_r;r<ed_r+1;r++){for(var c=st_c;c<ed_c+1;c++){if(ctr.data[r][c]==null){luckysheet.formula.delFunctionGroup(r,c);}}}}luckysheet.formula.execFunctionGroup(null,null,null,null,ctr.data);//取之前的数据
  luckysheet.jfrefreshrange(ctr.data,ctr.range,ctr.cdformat);}else if(ctr.type=="resize"){config=ctr.config;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(ctr.sheetIndex)].config=config;if(ctr.ctrlType=="resizeR"){luckysheet.server.saveParam("cg",ctr.sheetIndex,ctr.config["rowlen"],{"k":"rowlen"});}else if(ctr.ctrlType=="resizeC"){luckysheet.server.saveParam("cg",ctr.sheetIndex,ctr.config["columlen"],{"k":"columlen"});}luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);}else if(ctr.type=="cellRowChange"){luckysheet.jfrefreshgridall(ctr.data[0].length,ctr.data.length,ctr.data,ctr.config,ctr.range,ctr.ctrlType,ctr.ctrlValue,ctr.cdformat);}else if(ctr.type=="extend"){luckysheet.jfrefreshgridall(ctr.data[0].length,ctr.data.length,ctr.data,ctr.config,ctr.range,"dele",ctr.ctrlValue);}else if(ctr.type=="dele"){var ctrlValue1=$.extend(true,{},ctr.ctrlValue);ctrlValue1.restore=true;luckysheet.jfrefreshgridall(ctr.data[0].length,ctr.data.length,ctr.data,ctr.config,ctr.range,"extend",ctrlValue1);}else if(ctr.type=="addRC"){//增加行列撤销操作
  var ctrlValue=$.extend(true,{},ctr.ctrlValue);if(ctrlValue.direction=="rightbottom"){ctrlValue.index=ctrlValue.index+1;}luckysheet.jfrefreshgrid_adRC(ctr.data,ctr.config,"delRC",ctrlValue,ctr.calc,ctr.filterObj,ctr.cf,ctr.af,ctr.freezen);}else if(ctr.type=="delRC"){//删除行列撤销操作
  var ctrlValue=$.extend(true,{},ctr.ctrlValue);ctrlValue.restore=true;ctrlValue.direction="lefttop";luckysheet.jfrefreshgrid_adRC(ctr.data,ctr.config,"addRC",ctrlValue,ctr.calc,ctr.filterObj,ctr.cf,ctr.af,ctr.freezen);}else if(ctr.type=="datachangeAll"){luckysheet.formula.execFunctionGroup();luckysheet.jfrefreshgridall(ctr.data[0].length,ctr.data.length,ctr.data,null,ctr.range,"datachangeAll",ctr.ctrlValue);}else if(ctr.type=="datachangeAll_filter_clear"){luckysheet.createFilterOptions(ctr.filter_save);$("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").each(function(i){var $top=$(this);var item=ctr.optiongroups[i];luckysheet.labelFilterOptionState($top,item.optionstate,item.rowhidden,item.caljs,false,item.st_r,item.ed_r,item.cindex,item.st_c,item.ed_c);});luckysheet.server.saveParam("fsr",luckysheet.currentSheetIndex,{"filter":ctr.optiongroups,"filter_select":ctr.filter_save});//config
  config=ctr.config;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;if(config["rowhidden"]==null){config["rowhidden"]={};}luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,config["rowhidden"],{"k":"rowhidden"});//行高、列宽 刷新  
  luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);// var $t = $("#luckysheet-filter-options-sheet" + luckysheet.currentSheetIndex + " .luckysheet-filter-options").eq(0);
  // luckysheet.filterseletedbyindex($t.data("str"), $t.data("edr"), $t.data("stc"), $t.data("edc"));
  $("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide();}else if(ctr.type=="datachangeAll_filter"){var $top=$("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").eq(ctr["optionsindex"]);var st_r=$top.data("str"),ed_r=$top.data("edr"),cindex=$top.data("cindex"),st_c=$top.data("stc"),ed_c=$top.data("edc");luckysheet.labelFilterOptionState($top,luckysheet.json.hasKey(ctr.rowhidenPre),ctr.rowhidenPre,ctr.caljs,true,st_r,ed_r,cindex,st_c,ed_c);//config
  config=ctr.config;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;if(config["rowhidden"]==null){config["rowhidden"]={};}luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,config["rowhidden"],{"k":"rowhidden"});//行高、列宽 刷新  
  luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);// luckysheet.filterseletedbyindex(st_r, ed_r, st_c, ed_c);
  $("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide();}else if(ctr.type=="filtershow"){$('#luckysheet-filter-selected-sheet'+ctr.sheetIndex+', #luckysheet-filter-options-sheet'+ctr.sheetIndex).remove();if(luckysheet.server.allowUpdate){luckysheet.server.saveParam("all",ctr.sheetIndex,null,{"k":"filter_select"});}}else if(ctr.type=="pivotTable_change"){luckysheetfile[luckysheet.sheetmanage.getSheetIndex(ctr.sheetIndex)].pivotTable=ctr.pivotTable;luckysheet.pivotTable.getCellData(ctr.sheetIndex);luckysheet.pivotTable.initialPivotManage(true);luckysheet.pivotTable.refreshPivotTable();}else if(ctr.type=="addSheet"){luckysheet.sheetmanage.deleteSheet(ctr.index);luckysheet.sheetmanage.changeSheetExec(ctr.currentSheetIndex);$("#luckysheet-input-box").removeAttr("style");$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();}else if(ctr.type=="copySheet"){luckysheet.sheetmanage.deleteSheet(ctr.index);luckysheet.sheetmanage.changeSheetExec(ctr.copyindex);}else if(ctr.type=="deleteSheet"){var isDupName=false;for(var i=0;i<luckysheetfile.length;i++){if(luckysheetfile[i].name==ctr.name){isDupName=true;}}if(!isDupName){luckysheet.sheetmanage.createSheetbydata(ctr,"isrenew");$("#luckysheet-input-box").removeAttr("style");$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();}}else if(ctr.type=="sheetName"){luckysheetfile[luckysheet.sheetmanage.getSheetIndex(ctr.sheetIndex)].name=ctr.oldtxt;$("#luckysheet-sheets-item"+ctr.sheetIndex).find(".luckysheet-sheets-item-name").html(ctr.oldtxt);luckysheet.server.saveParam("all",ctr.sheetIndex,ctr.oldtxt,{"k":"name"});}else if(ctr.type=="sheetColor"){luckysheetfile[luckysheet.sheetmanage.getSheetIndex(ctr.sheetIndex)].color=ctr.oldcolor;var luckysheetcurrentSheetitem=$("#luckysheet-sheets-item"+ctr.sheetIndex);luckysheetcurrentSheetitem.find(".luckysheet-sheets-item-color").remove();if(ctr.oldcolor!=null){luckysheetcurrentSheetitem.append('<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+ctr.oldcolor+';"></div>');}luckysheet.server.saveParam("all",ctr.sheetIndex,ctr.oldcolor,{"k":"color"});}else if(ctr.type=="insertChart"){//chartMix
  luckysheet.chartparam.luckysheetInsertChartTosheetChange=false;!!window.store&&store.commit("deleteChart",ctr.chart_json.chart_id);//同步store中数据
  luckysheet.chartparam.luckysheetInsertChartTosheetChange=true;}else if(ctr.type=="moveChart"){//回到上一次的状态
  $("#"+ctr.chart_id+"_c").css({"top":ctr.y,"left":ctr.x});$("#luckysheet-scrollbar-y").scrollTop(ctr.scrollTop1);$("#luckysheet-scrollbar-x").scrollLeft(ctr.scrollLeft1);!!window.store&&store.commit({type:"updateChartItem",key:"left",value:ctr.x,chartId:ctr.chart_id});!!window.store&&store.commit({type:"updateChartItem",key:"top",value:ctr.y,chartId:ctr.chart_id});luckysheet.server.saveParam("c",ctr.sheetIndex,{"left":ctr.x,"top":ctr.y,"scrollTop":ctr.scrollTop1,"scrollLeft":ctr.scrollLeft1},{"op":"xy","cid":ctr.chart_id});// luckysheet.server.saveParam("c", ctr.sheetIndex, { "left":ctr.x, "top":ctr.y }, { "op":"xy", "cid": ctr.chart_id });
  }else if(ctr.type=="resizeChart"){//chartMix,增加位置x，y
  $("#"+ctr.chart_id+"_c").css({"height":ctr.myHeight1,"width":ctr.myWidth1,"top":ctr.y,"left":ctr.x});$("#luckysheet-scrollbar-y").scrollTop(ctr.scrollTop1);$("#luckysheet-scrollbar-x").scrollLeft(ctr.scrollLeft1);!!window.store&&store.commit({type:"updateChartItem",key:"height",value:ctr.myHeight1,chartId:ctr.chart_id});!!window.store&&store.commit({type:"updateChartItem",key:"width",value:ctr.myWidth1,chartId:ctr.chart_id});!!window.store&&store.commit({type:"updateChartItem",key:"left",value:ctr.x,chartId:ctr.chart_id});!!window.store&&store.commit({type:"updateChartItem",key:"top",value:ctr.y,chartId:ctr.chart_id});//resize
  !!window.generator&&generator.resize(ctr.chart_id);luckysheet.server.saveParam("c",ctr.sheetIndex,{"width":ctr.myWidth1,"height":ctr.myHeight1,"top":ctr.y,"left":ctr.x,"scrollTop":ctr.scrollTop1,"scrollLeft":ctr.scrollLeft1},{"op":"wh","cid":ctr.chart_id});}else if(ctr.type=="updateChartRange"){//console.log(ctr.p_chart_id);
  luckysheet.chartparam.luckysheet_chart_redo_click=true;luckysheet.chartparam.luckysheetInsertChartTosheetChange=false;luckysheet.updateChartTosheet("updateChartRange",ctr.p_sheetIndex,ctr.p_dataSheetIndex,ctr.p_option,ctr.p_chartType,ctr.p_selfOption,ctr.p_defaultOption,ctr["p_row"],ctr["p_column"],ctr.p_chart_selection_color,ctr.p_chart_id,ctr.p_chart_selection_id,ctr.p_chartStyle,ctr.p_rangeConfigCheck,ctr.p_rangeRowCheck,ctr.p_rangeColCheck,ctr.p_chartMarkConfig,ctr.p_chartTitleConfig,ctr.p_chartTheme);luckysheet.chartparam.luckysheetInsertChartTosheetChange=true;luckysheet.chartparam.luckysheet_chart_redo_click=false;luckysheet.chartrangechange(ctr["p_row"],ctr["p_column"],ctr.p_sheetIndex,ctr.p_dataSheetIndex,ctr.p_chart_selection_id,ctr.p_rangeConfigCheck,ctr.p_rangeRowCheck,ctr.p_rangeColCheck,ctr.p_chart_id);if(!luckysheet.isEditMode()){// $("#luckysheet-data-visualization").hide();
  // luckysheet.luckysheetsizeauto();
  !!window.generator&&generator.hideChartSettingComponent();}}else if(ctr.type=="updateChartType"){//console.log(ctr.p_chart_id);
  luckysheet.chartparam.luckysheet_chart_redo_click=true;luckysheet.chartparam.luckysheetInsertChartTosheetChange=false;luckysheet.updateChartTosheet("updateChartType",ctr.p_sheetIndex,ctr.p_dataSheetIndex,ctr.p_option,ctr.p_chartType,ctr.p_selfOption,ctr.p_defaultOption,ctr["p_row"],ctr["p_column"],ctr.p_chart_selection_color,ctr.p_chart_id,ctr.p_chart_selection_id,ctr.p_chartStyle,ctr.p_rangeConfigCheck,ctr.p_rangeRowCheck,ctr.p_rangeColCheck,ctr.p_chartMarkConfig,ctr.p_chartTitleConfig,ctr.p_chartTheme);luckysheet.chartparam.luckysheetInsertChartTosheetChange=true;luckysheet.chartparam.luckysheet_chart_redo_click=false;//luckysheet.chartrangechange(ctr["p_row"], ctr["p_column"], ctr.p_sheetIndex, ctr.p_dataSheetIndex, ctr.p_chart_selection_id,ctr.p_rangeConfigCheck, ctr.p_rangeRowCheck, ctr.p_rangeColCheck );
  luckysheet.chartTypeChange(ctr.p_chartType,ctr.p_selfOption,ctr.p_defaultOption,ctr.p_chartStyle,ctr.p_chartMarkConfig,ctr.p_chartTitleConfig,ctr.p_chart_id);if(!luckysheet.isEditMode()){// $("#luckysheet-data-visualization").hide();
  // luckysheet.luckysheetsizeauto();
  !!window.generator&&generator.hideChartSettingComponent();}}else if(ctr.type=="updateChartTheme"){if(luckysheet.chartparam.luckysheetcurrentChart!=null){luckysheet.chartparam.luckysheetcurrentChart.dispose();}var chartTheme="default0000";if(ctr.p_chartTheme!=null&&ctr.p_chartTheme.length>0&&luckysheet.getObjType(ctr.p_chartTheme)!="object"&&ctr.p_chartTheme!="default0000"){chartTheme=eval('('+ctr.p_chartTheme+')');}luckysheet.chartparam.luckysheetcurrentChart=jgridChart=echarts.init($("#"+ctr.p_chart_id).find(".luckysheet-modal-dialog-content").get(0),chartTheme);luckysheet.chartparam.luckysheet_chart_default_config=eval('('+ctr.p_defaultOption+')');luckysheet.chartparam.luckysheet_chart_self_config=eval('('+ctr.p_selfOption+')');var $t=$("#"+ctr.p_chart_id);luckysheet.chartparam.luckysheet_chart_redo_click=true;$t.mousedown();luckysheet.chartparam.luckysheetCurrentChartMove=false;$t.mouseup();luckysheet.chartparam.luckysheet_chart_redo_click=false;luckysheet.chartparam.luckysheetcurrentChart.setOption(luckysheet.chartparam.luckysheet_chart_default_config);luckysheet.chartparam.luckysheetcurrentChart.setOption(luckysheet.luckysheetChartConfigHanddle(ctr.p_chartType,"theme",luckysheet.chartparam.luckysheet_chart_self_config));// luckysheet.chartparam.luckysheetcurrentChart.setOption(luckysheet.chartparam.luckysheet_chart_default_config);
  // luckysheet.chartparam.luckysheetcurrentChart.setOption(luckysheet.luckysheetChartConfigHanddle(jgridCurrentChartType.data("type"), "theme", luckysheet.chartparam.luckysheet_chart_self_config));
  $t.attr("chartTheme",ctr.p_chartTheme);if(luckysheet.server.allowUpdate){luckysheet.server.saveParam("c",ctr.p_sheetIndex,{"chartTheme":ctr.p_chartTheme},{"op":"update","cid":ctr.p_chart_id});}if(!luckysheet.isEditMode()){// $("#luckysheet-data-visualization").hide();
  // luckysheet.luckysheetsizeauto();
  !!window.generator&&generator.hideChartSettingComponent();}}else if(ctr.type=="updateChart"){//console.log(ctr.p_chart_id);
  luckysheet.chartparam.luckysheetInsertChartTosheetChange=false;luckysheet.updateChartTosheet(ctr.p_sheetIndex,ctr.p_dataSheetIndex,ctr.p_option,ctr.p_chartType,ctr.p_selfOption,ctr.p_defaultOption,ctr["p_row"],ctr["p_column"],ctr.p_chart_selection_color,ctr.p_chart_id,ctr.p_chart_selection_id,ctr.p_chartStyle,ctr.p_rangeConfigCheck,ctr.p_rangeRowCheck,ctr.p_rangeColCheck,ctr.p_chartMarkConfig,ctr.p_chartTitleConfig,ctr.p_chartTheme);luckysheet.chartparam.luckysheetInsertChartTosheetChange=true;if(!luckysheet.isEditMode()){// $("#luckysheet-data-visualization").hide();
  // luckysheet.luckysheetsizeauto();
  !!window.generator&&generator.hideChartSettingComponent();}}else if(ctr.type=="updateChartAll"){//console.log(ctr.p_chart_id);
  var chart_json=ctr.pre_Chart_json;//取上一次的数据
  luckysheet.chartparam.luckysheetInsertChartTosheetChange=false;!!window.generator&&generator.patchVueSet(chart_json);!!window.generator&&generator.generateChart(chart_json.defaultOption,chart_json.chartTheme,chart_json.chartAllType,$("#"+chart_json.chart_id).get(0));// !!window.store && store.commit("showNeedRangeShow",chart_json.chart_id);
  luckysheet.chartparam.luckysheetInsertChartTosheetChange=true;}else if(ctr.type=="deleteChart"){//chartMix
  luckysheet.chartparam.luckysheetInsertChartTosheetChange=false;!!window.store&&store.commit("insertChart",ctr.chart_json);luckysheet.chartparam.luckysheetInsertChartTosheetChange=true;}else if(ctr.type=="mergeChange"){luckysheet.jfrefreshgrid(ctr.data,ctr.range,ctr.config);}else if(ctr.type=="updateCF"){var historyRules=ctr["data"]["historyRules"];for(var i=0;i<historyRules.length;i++){//条件规则
  var sheetIndex=historyRules[i]["sheetIndex"];luckysheetfile[luckysheet.sheetmanage.getSheetIndex(sheetIndex)]["luckysheet_conditionformat_save"]=historyRules[i]["luckysheet_conditionformat_save"];if(luckysheet.server.allowUpdate){luckysheet.server.saveParam("all",sheetIndex,historyRules[i]["luckysheet_conditionformat_save"],{"k":"luckysheet_conditionformat_save"});}}//刷新一次表格
  luckysheet.conditionformat.ref();}else if(ctr.type=="updateAF"){var historyRules=ctr["data"]["historyRules"];var index=luckysheet.sheetmanage.getSheetIndex(ctr["sheetIndex"]);luckysheetfile[index]["luckysheet_alternateformat_save"]=$.extend(true,[],historyRules);setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}else if(ctr.type=="borderChange"){if(ctr.config["borderInfo"]==null){luckysheet.server.saveParam("cg",ctr.sheetIndex,[],{"k":"borderInfo"});}else {luckysheet.server.saveParam("cg",ctr.sheetIndex,ctr.config["borderInfo"],{"k":"borderInfo"});}config=ctr.config;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(ctr.sheetIndex)].config=config;setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}else if(ctr.type=="postil"){luckysheet.postil.ref(ctr.data,ctr.rc);for(var i=0;i<ctr.rc.length;i++){var r=ctr.rc[i].split("_")[0];var c=ctr.rc[i].split("_")[1];if(ctr.data[r][c]!=null&&ctr.data[r][c].ps!=null){luckysheet.postil.buildPs(r,c,ctr.data[r][c].ps);}else {luckysheet.postil.buildPs(r,c,null);}}}luckysheet.cleargridelement(e);clearjfundo=true;},undo:function undo(){if(luckysheet.jfundo.length==0){return;}var ctr=luckysheet.jfundo.pop();luckysheet.jfredo.push(ctr);clearjfundo=false;if(luckysheet.sheetmanage.hasSheet(ctr.sheetIndex)&&luckysheet.currentSheetIndex!=ctr.sheetIndex){luckysheet.sheetmanage.changeSheetExec(ctr.sheetIndex);}if(ctr.type=="datachange"){luckysheet.formula.execFunctionGroup();luckysheet.jfrefreshgrid(ctr.curdata,ctr.range,ctr.curConfig,ctr.curCdformat,ctr.RowlChange);}else if(ctr.type=="pasteCut"){luckysheet.jfrefreshgrid_pastcut(ctr.source,ctr.target,ctr.RowlChange);}else if(ctr.type=="cellchange"){luckysheet.formula.execFunctionGroup(ctr.uprow,ctr.upcolumn,ctr.curvalue);luckysheet.jfrefreshcell(ctr.curvalue,ctr.uprow,ctr.upcolumn);}else if(ctr.type=="rangechange"){luckysheet.formula.execFunctionGroup();luckysheet.jfrefreshrange(ctr.curdata,ctr.range,ctr.curCdformat);}else if(ctr.type=="resize"){config=ctr.curconfig;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(ctr.sheetIndex)].config=config;if(ctr.ctrlType=="resizeR"){luckysheet.server.saveParam("cg",ctr.sheetIndex,ctr.curconfig["rowlen"],{"k":"rowlen"});}else if(ctr.ctrlType=="resizeC"){luckysheet.server.saveParam("cg",ctr.sheetIndex,ctr.curconfig["columlen"],{"k":"columlen"});}luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);}else if(ctr.type=="cellRowChange"){luckysheet.jfrefreshgridall(ctr.curdata[0].length,ctr.curdata.length,ctr.curdata,ctr.curconfig,ctr.currange,ctr.ctrlType,ctr.ctrlValue,ctr.curCdformat);}else if(ctr.type=="extend"){luckysheet.jfrefreshgridall(ctr.curdata[0].length,ctr.curdata.length,ctr.curdata,ctr.curconfig,ctr.currange,ctr.ctrlType,ctr.ctrlValue);}else if(ctr.type=="dele"){var ctrlValue1=$.extend(true,{},ctr.ctrlValue);ctrlValue1.restore=true;luckysheet.jfrefreshgridall(ctr.curdata[0].length,ctr.curdata.length,ctr.curdata,ctr.curconfig,ctr.currange,ctr.ctrlType,ctr.ctrlValue);}else if(ctr.type=="addRC"){//增加行列重做操作
  luckysheet.jfrefreshgrid_adRC(ctr.curData,ctr.curConfig,"addRC",ctr.ctrlValue,ctr.curCalc,ctr.curFilterObj,ctr.curCf,ctr.curAf,ctr.curFreezen);}else if(ctr.type=="delRC"){//删除行列重做操作
  luckysheet.jfrefreshgrid_adRC(ctr.curData,ctr.curConfig,"delRC",ctr.ctrlValue,ctr.curCalc,ctr.curFilterObj,ctr.curCf,ctr.curAf,ctr.curFreezen);}else if(ctr.type=="datachangeAll"){luckysheet.formula.execFunctionGroup();luckysheet.jfrefreshgridall(ctr.curdata[0].length,ctr.curdata.length,ctr.curdata,null,ctr.currange,"datachangeAll",ctr.ctrlValue);}else if(ctr.type=="datachangeAll_filter_clear"){luckysheet.server.saveParam("fsc",luckysheet.currentSheetIndex,null);//config
  config=ctr.curconfig;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,{},{"k":"rowhidden"});//行高、列宽 刷新  
  luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);$("#luckysheet-filter-menu .luckysheet-filter-selected-input").hide().find("input").val();$("#luckysheet-filter-selected span").data("type","0").data("type",null).text("无");$('#luckysheet-filter-selected-sheet'+luckysheet.currentSheetIndex+', #luckysheet-filter-options-sheet'+luckysheet.currentSheetIndex).remove();$("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide();}else if(ctr.type=="datachangeAll_filter"){var $top=$("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").eq(ctr["optionsindex"]);var st_r=$top.data("str"),ed_r=$top.data("edr"),cindex=$top.data("cindex"),st_c=$top.data("stc"),ed_c=$top.data("edc");luckysheet.labelFilterOptionState($top,luckysheet.json.hasKey(ctr.rowhidden),ctr.rowhidden,ctr.caljs,true,st_r,ed_r,cindex,st_c,ed_c);//config
  config=ctr.curconfig;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,config["rowhidden"],{"k":"rowhidden"});//行高、列宽 刷新  
  luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);// luckysheet.filterseletedbyindex(st_r, ed_r, st_c, ed_c);
  $("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide();}else if(ctr.type=="filtershow"){luckysheet_select_save=[ctr.filter_save];filterchage=false;luckysheet.createFilter();filterchage=true;luckysheet.server.saveParam("all",ctr.sheetIndex,ctr.filter_save,{"k":"filter_select"});}else if(ctr.type=="pivotTable_change"){luckysheetfile[luckysheet.sheetmanage.getSheetIndex(ctr.sheetIndex)].pivotTable=ctr.pivotTablecur;//console.log(ctr.pivotTablecur);
  luckysheet.pivotTable.getCellData(ctr.sheetIndex);luckysheet.pivotTable.initialPivotManage(true);luckysheet.pivotTable.refreshPivotTable();}else if(ctr.type=="addSheet"){luckysheet.sheetmanage.createSheetbydata(ctr.sheetconfig);$("#luckysheet-input-box").removeAttr("style");$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();}else if(ctr.type=="copySheet"){luckysheet.sheetmanage.copySheet(ctr.copyindex);}else if(ctr.type=="deleteSheet"){luckysheet.sheetmanage.deleteSheet(ctr.index);if(ctr.order==0){luckysheet.sheetmanage.changeSheetExec(luckysheetfile[0].index);}else {luckysheet.sheetmanage.changeSheetExec(luckysheetfile[ctr.order-1].index);}$("#luckysheet-input-box").removeAttr("style");$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();}else if(ctr.type=="sheetName"){luckysheetfile[luckysheet.sheetmanage.getSheetIndex(ctr.sheetIndex)].name=ctr.txt;$("#luckysheet-sheets-item"+ctr.sheetIndex).find(".luckysheet-sheets-item-name").html(ctr.txt);luckysheet.server.saveParam("all",ctr.sheetIndex,ctr.txt,{"k":"name"});}else if(ctr.type=="sheetColor"){luckysheetfile[luckysheet.sheetmanage.getSheetIndex(ctr.sheetIndex)].color=ctr.color;var luckysheetcurrentSheetitem=$("#luckysheet-sheets-item"+ctr.sheetIndex);luckysheetcurrentSheetitem.find(".luckysheet-sheets-item-color").remove();if(ctr.color!=null){luckysheetcurrentSheetitem.append('<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+ctr.color+';"></div>');}luckysheet.server.saveParam("all",ctr.sheetIndex,ctr.color,{"k":"color"});}else if(ctr.type=="insertChart"){//chartMix
  luckysheet.chartparam.luckysheetInsertChartTosheetChange=false;!!window.store&&store.commit("insertChart",ctr.chart_json);luckysheet.chartparam.luckysheetInsertChartTosheetChange=true;}else if(ctr.type=="moveChart"){var _luckysheet$server$sa;$("#"+ctr.chart_id+"_c").css({"top":ctr.myTop,"left":ctr.myLeft});$("#luckysheet-scrollbar-y").scrollTop(ctr.scrollTop);$("#luckysheet-scrollbar-x").scrollLeft(ctr.scrollLeft);!!window.store&&store.commit({type:"updateChartItem",key:"left",value:ctr.myLeft,chartId:ctr.chart_id});!!window.store&&store.commit({type:"updateChartItem",key:"top",value:ctr.myTop,chartId:ctr.chart_id});luckysheet.server.saveParam("c",ctr.sheetIndex,(_luckysheet$server$sa={"left":ctr.myLeft},_defineProperty(_luckysheet$server$sa,"left",ctr.myTop),_defineProperty(_luckysheet$server$sa,"scrollTop",ctr.scrollTop),_defineProperty(_luckysheet$server$sa,"scrollLeft",ctr.scrollLeft),_luckysheet$server$sa),{"op":"xy","cid":ctr.chart_id});// luckysheet.server.saveParam("c", ctr.sheetIndex, { "left":ctr.myLeft, "top":ctr.myTop }, { "op":"xy", "cid": ctr.chart_id});
  }else if(ctr.type=="resizeChart"){$("#"+ctr.chart_id+"_c").css({"height":ctr.myHeight,"width":ctr.myWidth,"top":ctr.myTop,"left":ctr.myLeft});$("#luckysheet-scrollbar-y").scrollTop(ctr.scrollTop);$("#luckysheet-scrollbar-x").scrollLeft(ctr.scrollLeft);!!window.store&&store.commit({type:"updateChartItem",key:"height",value:ctr.myHeight,chartId:ctr.chart_id});!!window.store&&store.commit({type:"updateChartItem",key:"width",value:ctr.myWidth,chartId:ctr.chart_id});!!window.store&&store.commit({type:"updateChartItem",key:"left",value:ctr.myLeft,chartId:ctr.chart_id});!!window.store&&store.commit({type:"updateChartItem",key:"top",value:ctr.myTop,chartId:ctr.chart_id});!!window.generator&&generator.resize(ctr.chart_id);luckysheet.server.saveParam("c",ctr.sheetIndex,{"width":ctr.myWidth,"height":ctr.myHeight,"top":ctr.myTop,"left":ctr.myLeft,"scrollTop":ctr.scrollTop,"scrollLeft":ctr.scrollLeft},{"op":"wh","cid":ctr.chart_id});}else if(ctr.type=="updateChartRange"){//console.log(ctr.p_chart_id);
  luckysheet.chartparam.luckysheet_chart_redo_click=true;luckysheet.chartparam.luckysheetInsertChartTosheetChange=false;luckysheet.updateChartTosheet("updateChartRange",ctr.sheetIndex,ctr.dataSheetIndex,ctr.option,ctr.chartType,ctr.selfOption,ctr.defaultOption,ctr["row"],ctr["column"],ctr.chart_selection_color,ctr.chart_id,ctr.chart_selection_id,ctr.chartStyle,ctr.rangeConfigCheck,ctr.rangeRowCheck,ctr.rangeColCheck,ctr.chartMarkConfig,ctr.chartTitleConfig,ctr.chartTheme);luckysheet.chartparam.luckysheetInsertChartTosheetChange=true;luckysheet.chartparam.luckysheet_chart_redo_click=false;luckysheet.chartrangechange(ctr["row"],ctr["column"],ctr.sheetIndex,ctr.dataSheetIndex,ctr.chart_selection_id,ctr.rangeConfigCheck,ctr.rangeRowCheck,ctr.rangeColCheck,ctr.chart_id);// $("#luckysheet-data-visualization").hide();
  // luckysheet.luckysheetsizeauto();
  !!window.generator&&generator.hideChartSettingComponent();}else if(ctr.type=="updateChartType"){//console.log(ctr.p_chart_id);
  luckysheet.chartparam.luckysheet_chart_redo_click=true;luckysheet.chartparam.luckysheetInsertChartTosheetChange=false;luckysheet.updateChartTosheet("updateChartType",ctr.sheetIndex,ctr.dataSheetIndex,ctr.option,ctr.chartType,ctr.selfOption,ctr.defaultOption,ctr["row"],ctr["column"],ctr.chart_selection_color,ctr.chart_id,ctr.chart_selection_id,ctr.chartStyle,ctr.rangeConfigCheck,ctr.rangeRowCheck,ctr.rangeColCheck,ctr.chartMarkConfig,ctr.chartTitleConfig,ctr.chartTheme);luckysheet.chartparam.luckysheetInsertChartTosheetChange=true;luckysheet.chartparam.luckysheet_chart_redo_click=false;//luckysheet.chartrangechange(ctr["p_row"], ctr["p_column"], ctr.p_sheetIndex, ctr.p_dataSheetIndex, ctr.p_chart_selection_id,ctr.p_rangeConfigCheck, ctr.p_rangeRowCheck, ctr.p_rangeColCheck );
  luckysheet.chartTypeChange(ctr.chartType,ctr.selfOption,ctr.defaultOption,ctr.chartStyle,ctr.chartMarkConfig,ctr.chartTitleConfig,ctr.chart_id);// $("#luckysheet-data-visualization").hide();
  // luckysheet.luckysheetsizeauto();
  !!window.generator&&generator.hideChartSettingComponent();}else if(ctr.type=="updateChartTheme"){if(luckysheet.chartparam.luckysheetcurrentChart!=null){luckysheet.chartparam.luckysheetcurrentChart.dispose();}var chartTheme="default0000";if(ctr.chartTheme!=null&&ctr.chartTheme.length>0&&luckysheet.getObjType(ctr.chartTheme)!="object"&&ctr.chartTheme!="default0000"){chartTheme=eval('('+ctr.chartTheme+')');}luckysheet.chartparam.luckysheetcurrentChart=jgridChart=echarts.init($("#"+ctr.chart_id).find(".luckysheet-modal-dialog-content").get(0),chartTheme);luckysheet.chartparam.luckysheet_chart_default_config=eval('('+ctr.defaultOption+')');luckysheet.chartparam.luckysheet_chart_self_config=eval('('+ctr.selfOption+')');var $t=$("#"+ctr.chart_id);luckysheet.chartparam.luckysheet_chart_redo_click=true;$t.mousedown();luckysheet.chartparam.luckysheetCurrentChartMove=false;$t.mouseup();luckysheet.chartparam.luckysheet_chart_redo_click=false;luckysheet.chartparam.luckysheetcurrentChart.setOption(luckysheet.chartparam.luckysheet_chart_default_config);luckysheet.chartparam.luckysheetcurrentChart.setOption(luckysheet.luckysheetChartConfigHanddle(ctr.chartType,"theme",luckysheet.chartparam.luckysheet_chart_self_config));// luckysheet.chartparam.luckysheetcurrentChart.setOption(luckysheet.chartparam.luckysheet_chart_default_config);
  // luckysheet.chartparam.luckysheetcurrentChart.setOption(luckysheet.luckysheetChartConfigHanddle(jgridCurrentChartType.data("type"), "theme", luckysheet.chartparam.luckysheet_chart_self_config));
  $t.attr("chartTheme",ctr.chartTheme);luckysheet.server.saveParam("c",ctr.sheetIndex,{"chartTheme":ctr.chartTheme},{"op":"update","cid":ctr.chart_id});// $("#luckysheet-data-visualization").hide();
  // luckysheet.luckysheetsizeauto();
  !!window.generator&&generator.hideChartSettingComponent();}else if(ctr.type=="updateChart"){luckysheet.chartparam.luckysheetInsertChartTosheetChange=false;luckysheet.updateChartTosheet(ctr.sheetIndex,ctr.dataSheetIndex,ctr.option,ctr.chartType,ctr.selfOption,ctr.defaultOption,ctr["row"],ctr["column"],ctr.chart_selection_color,ctr.chart_id,ctr.chart_selection_id,ctr.chartStyle,ctr.rangeConfigCheck,ctr.rangeRowCheck,ctr.rangeColCheck,ctr.chartMarkConfig,ctr.chartTitleConfig,ctr.chartTheme);luckysheet.chartparam.luckysheetInsertChartTosheetChange=true;// $("#luckysheet-data-visualization").hide();
  // luckysheet.luckysheetsizeauto();
  !!window.generator&&generator.hideChartSettingComponent();}else if(ctr.type=="updateChartAll"){//console.log(ctr.p_chart_id);
  var chart_json=ctr.chart_json;//取下一次的数据
  luckysheet.chartparam.luckysheetInsertChartTosheetChange=false;!!window.generator&&generator.patchVueSet(chart_json);!!window.generator&&generator.generateChart(chart_json.defaultOption,chart_json.chartTheme,chart_json.chartAllType,$("#"+chart_json.chart_id).get(0));// !!window.store && store.commit("showNeedRangeShow",chart_json.chart_id);
  luckysheet.chartparam.luckysheetInsertChartTosheetChange=true;}else if(ctr.type=="deleteChart"){//chartMix
  luckysheet.chartparam.luckysheetInsertChartTosheetChange=false;!!window.store&&store.commit("deleteChart",ctr.chart_json.chart_id);//同步store中数据
  luckysheet.chartparam.luckysheetInsertChartTosheetChange=true;}else if(ctr.type=="mergeChange"){luckysheet.jfrefreshgrid(ctr.curData,ctr.range,ctr.curConfig);}else if(ctr.type=="updateCF"){var currentRules=ctr["data"]["currentRules"];for(var i=0;i<currentRules.length;i++){//条件规则
  var sheetIndex=currentRules[i]["sheetIndex"];luckysheetfile[luckysheet.sheetmanage.getSheetIndex(sheetIndex)]["luckysheet_conditionformat_save"]=currentRules[i]["luckysheet_conditionformat_save"];if(luckysheet.server.allowUpdate){luckysheet.server.saveParam("all",sheetIndex,currentRules[i]["luckysheet_conditionformat_save"],{"k":"luckysheet_conditionformat_save"});}}//刷新一次表格
  luckysheet.conditionformat.ref();}else if(ctr.type=="updateAF"){var currentRules=ctr["data"]["currentRules"];var index=luckysheet.sheetmanage.getSheetIndex(ctr["sheetIndex"]);luckysheetfile[index]["luckysheet_alternateformat_save"]=$.extend(true,[],currentRules);setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}else if(ctr.type=="borderChange"){luckysheet.server.saveParam("cg",ctr.sheetIndex,ctr.curconfig["borderInfo"],{"k":"borderInfo"});config=ctr.curconfig;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(ctr.sheetIndex)].config=config;setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}else if(ctr.type=="postil"){luckysheet.postil.ref(ctr.curdata,ctr.rc);for(var i=0;i<ctr.rc.length;i++){var r=ctr.rc[i].split("_")[0];var c=ctr.rc[i].split("_")[1];if(ctr.curdata[r][c]!=null&&ctr.curdata[r][c].ps!=null){luckysheet.postil.buildPs(r,c,ctr.curdata[r][c].ps);}else {luckysheet.postil.buildPs(r,c,null);}}}clearjfundo=true;}};luckysheet.editor={//worker+blob实现深拷贝替换extend
  deepCopyFlowDataState:false,deepCopyFlowDataCache:"",deepCopyFlowDataWorker:null,deepCopyFlowData:function deepCopyFlowData(flowData){var _this=this;if(_this.deepCopyFlowDataState){if(_this.deepCopyFlowDataWorker!=null){_this.deepCopyFlowDataWorker.terminate();}return _this.deepCopyFlowDataCache;}else {if(flowData==null){flowData=luckysheet.flowdata;}return $.extend(true,[],flowData);}},webWorkerFlowDataCache:function webWorkerFlowDataCache(flowData){var _this=this;try{if(_this.deepCopyFlowDataWorker!=null){//存新的webwork前先销毁以前的
  _this.deepCopyFlowDataWorker.terminate();}var funcTxt='data:text/javascript;chartset=US-ASCII,onmessage = function (e) { postMessage(e.data); };';_this.deepCopyFlowDataState=false;//var worker_blob = new Blob([funcTxt]);
  //适配IE
  if(luckysheet.browser.isIE()==1){var response="self.onmessage=function(e){postMessage(e.data);}";var worker=new Worker('./plugins/Worker-helper.js');worker.postMessage(response);}else {var worker=new Worker(funcTxt);}_this.deepCopyFlowDataWorker=worker;worker.postMessage(flowData);worker.onmessage=function(e){_this.deepCopyFlowDataCache=e.data;_this.deepCopyFlowDataState=true;};}catch(e){_this.deepCopyFlowDataCache=$.extend(true,[],flowData);}},// webWorkerFlowDataCache:function(flowData){
  //     var _this = this;
  //     _this.deepCopyFlowDataState = false;
  //     var funcTxt = 'data:text/javascript;chartset=US-ASCII,onmessage = function (e) { postMessage(e.data); };';
  //     //var worker_blob = new Blob([funcTxt]); 
  //     var worker = new Worker(funcTxt);
  //     _this.deepCopyFlowDataWorker = worker;
  //     worker.postMessage(flowData);
  //     worker.onmessage = function(e) { 
  //         _this.deepCopyFlowDataCache = e.data;
  //         console.log("onmessage: e.data",e.data);
  //         _this.deepCopyFlowDataState = true;
  //         //_this.deepCopyFlowDataWorker = null;
  //         worker.terminate();
  //     };
  // },
  controlHandler:function controlHandler(dataChe){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  var last=luckysheet_select_save[luckysheet_select_save.length-1];var curR=last["row"]==null?0:last["row"][0];var curC=last["column"]==null?0:last["column"][0];var rlen=dataChe.length,clen=dataChe[0].length;var addr=curR+rlen-d.length,addc=curC+clen-d[0].length;if(addr>0||addc>0){d=luckysheet.datagridgrowth([].concat(d),addr,addc,true);}for(var r=0;r<rlen;r++){var x=[].concat(d[r+curR]);for(var c=0;c<clen;c++){var value="";if(dataChe[r]!=null&&dataChe[r][c]!=null){value=dataChe[r][c];}x[c+curC]=value;}d[r+curR]=x;}if(addr>0||addc>0){luckysheet.jfrefreshgridall(d[0].length,d.length,d,null,luckysheet_select_save,"datachangeAll");}else {luckysheet.jfrefreshrange(d,luckysheet_select_save);}},clearRangeByindex:function clearRangeByindex(st_r,ed_r,st_c,ed_c,sheetIndex){var index=luckysheet.sheetmanage.getSheetIndex(sheetIndex);var d=$.extend(true,[],luckysheetfile[index]["data"]);for(var r=st_r;r<=ed_r;r++){var x=[].concat(d[r]);for(var c=st_c;c<=ed_c;c++){luckysheet.formula.delFunctionGroup(r,c);luckysheet.formula.execFunctionGroup(r,c,"");//var value = "";
  //if (dataChe[r] != null && dataChe[r][c] != null) {
  //    value = dataChe[r][c];
  //}
  x[c]=null;}d[r]=x;}//luckysheet.flowdata = flowdata_new = data;
  if(sheetIndex==luckysheet.currentSheetIndex){var rlen=ed_r-st_r+1;if(rlen>5000){luckysheet.jfrefreshgrid(d,st_r,ed_r,st_c,ed_c);}else {luckysheet.jfrefreshrange(d,{"row":[st_r,ed_r],"column":[st_c,ed_c]});}}else {luckysheetfile[index]["data"]=d;}},controlHandlerD:function controlHandlerD(dataChe){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  var last=luckysheet_select_save[luckysheet_select_save.length-1];var r1=last["row"][0],r2=last["row"][1];var c1=last["column"][0],c2=last["column"][1];var rlen=dataChe.length,clen=dataChe[0].length;var addr=r1+rlen-d.length,addc=c1+clen-d[0].length;if(addr>0||addc>0){d=luckysheet.datagridgrowth([].concat(d),addr,addc,true);}for(var r=r1;r<=r2;r++){for(var c=c1;c<=c2;c++){d[r][c]=null;}}for(var i=0;i<rlen;i++){for(var j=0;j<clen;j++){d[r1+i][c1+j]=dataChe[i][j];}}var range=[{"row":[r1,r2],"column":[c1,c2]},{"row":[r1,r1+rlen-1],"column":[c1,c1+clen-1]}];luckysheet.jfrefreshgrid(d,range);}};luckysheet.selection={clearcopy:function clearcopy(e){var clipboardData=window.clipboardData;//for IE
  if(!clipboardData){// for chrome
  if(!!e){clipboardData=e.originalEvent.clipboardData;}}var cpdata=" ";luckysheet_selection_range=[];luckysheet.selectionCopyShow();luckysheet_copy_save={};if(!clipboardData){var textarea=$("#luckysheet-copy-content").css("visibility","hidden");textarea.val(cpdata);textarea.focus();textarea.select();// 等50毫秒，keyPress事件发生了再去处理数据
  setTimeout(function(){textarea.blur().css("visibility","visible");},10);}else {//e.clipboardData.getData('text');//可以获取用户选中复制的数据
  clipboardData.setData('Text',cpdata);return false;//否则设不生效
  }},getHtmlBorderStyle:function getHtmlBorderStyle(type,color){var style="";var borderType={"0":"none","1":"Thin","2":"Hair","3":"Dotted","4":"Dashed","5":"DashDot","6":"DashDotDot","7":"Double","8":"Medium","9":"MediumDashed","10":"MediumDashDot","11":"MediumDashDotDot","12":"SlantedDashDot","13":"Thick"};type=borderType[type.toString()];if(type.indexOf("Medium")>-1){style+="1pt ";}else if(type=="Thick"){style+="1.5pt ";}else {style+="0.5pt ";}if(type=="Hair"){style+="double ";}else if(type.indexOf("DashDotDot")>-1){style+="dotted ";}else if(type.indexOf("DashDot")>-1){style+="dashed ";}else if(type.indexOf("Dotted")>-1){style+="dotted ";}else if(type.indexOf("Dashed")>-1){style+="dashed ";}else {style+="solid ";}return style+color+";";},copy:function copy(e){//copy事件
  var clipboardData=window.clipboardData;//for IE
  if(!clipboardData){// for chrome
  clipboardData=e.originalEvent.clipboardData;}luckysheet_selection_range=[];//copy范围
  var minR=luckysheet_select_save[0].row[0],maxR=luckysheet_select_save[0].row[1];var minC=luckysheet_select_save[0].column[0],maxC=luckysheet_select_save[0].column[1];var copyRange=[],RowlChange=false,HasMC=false;for(var s=0;s<luckysheet_select_save.length;s++){if(luckysheet_select_save[s].row[0]<minR){minR=luckysheet_select_save[s].row[0];}if(luckysheet_select_save[s].row[1]>maxR){maxR=luckysheet_select_save[s].row[1];}if(luckysheet_select_save[s].column[0]<minC){minC=luckysheet_select_save[s].column[0];}if(luckysheet_select_save[s].column[1]>maxC){maxC=luckysheet_select_save[s].column[1];}for(var copyR=luckysheet_select_save[s].row[0];copyR<=luckysheet_select_save[s].row[1];copyR++){if(config["rowhidden"]!=null&&config["rowhidden"][copyR]!=null){continue;}if(config["rowlen"]!=null&&copyR in config["rowlen"]){RowlChange=true;}for(var copyC=luckysheet_select_save[s].column[0];copyC<=luckysheet_select_save[s].column[1];copyC++){var cell=luckysheet.flowdata[copyR][copyC];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell&&cell.mc.rs!=null){HasMC=true;}}}luckysheet_selection_range.push({"row":luckysheet_select_save[s].row,"column":luckysheet_select_save[s].column});copyRange.push({"row":luckysheet_select_save[s].row,"column":luckysheet_select_save[s].column});}luckysheet.selectionCopyShow();//qksheet内copy保存
  luckysheet_copy_save={"dataSheetIndex":luckysheet.currentSheetIndex,"copyRange":copyRange,"RowlChange":RowlChange,"HasMC":HasMC};//copy范围数据拼接成table 赋给剪贴板
  var _this=this;if(config["borderInfo"]&&config["borderInfo"].length>0){//边框
  var borderInfoCompute=luckysheet.getBorderInfoCompute();}var cpdata="",d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var colgroup="";for(var r=minR;r<=maxR;r++){if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null){continue;}cpdata+='<tr>';for(var c=minC;c<=maxC;c++){var column='<td ${span} style="${style}">';if(d[r]!=null&&d[r][c]!=null){var style="",span="";if(r==minR){if(config==null||config["columlen"]==null||config["columlen"][c.toString()]==null){colgroup+='<colgroup width="72px"></colgroup>';}else {colgroup+='<colgroup width="'+config["columlen"][c.toString()]+'px"></colgroup>';}}if(c==minC){if(config==null||config["rowlen"]==null||config["rowlen"][r.toString()]==null){style+='height:19px;';}else {style+='height:'+config["rowlen"][r.toString()]+'px;';}}var reg=/^(w|W)((0?)|(0\.0+))$/;var c_value;if(d[r][c].ct!=null&&d[r][c].ct.fa!=null&&d[r][c].ct.fa.match(reg)){c_value=luckysheet.getcellvalue(r,c,d);}else {c_value=luckysheet.getcellvalue(r,c,d,"m");}style+=luckysheet.menuButton.getStyleByCell(d,r,c);if(luckysheet.getObjType(d[r][c])=="object"&&"mc"in d[r][c]){if("rs"in d[r][c]["mc"]){span='rowspan="'+d[r][c]["mc"].rs+'" colspan="'+d[r][c]["mc"].cs+'"';//边框
  if(borderInfoCompute&&borderInfoCompute[r+"_"+c]){var bl_obj={"color":{},"style":{}},br_obj={"color":{},"style":{}},bt_obj={"color":{},"style":{}},bb_obj={"color":{},"style":{}};for(var bd_r=r;bd_r<r+d[r][c]["mc"].rs;bd_r++){for(var bd_c=c;bd_c<c+d[r][c]["mc"].cs;bd_c++){if(bd_r==r&&borderInfoCompute[bd_r+"_"+bd_c]&&borderInfoCompute[bd_r+"_"+bd_c].t){var linetype=borderInfoCompute[bd_r+"_"+bd_c].t.style;var bcolor=borderInfoCompute[bd_r+"_"+bd_c].t.color;if(bt_obj["style"][linetype]==null){bt_obj["style"][linetype]=1;}else {bt_obj["style"][linetype]=bt_obj["style"][linetype]+1;}if(bt_obj["color"][bcolor]==null){bt_obj["color"][bcolor]=1;}else {bt_obj["color"][bcolor]=bt_obj["color"][bcolor]+1;}}if(bd_r==r+d[r][c]["mc"].rs-1&&borderInfoCompute[bd_r+"_"+bd_c]&&borderInfoCompute[bd_r+"_"+bd_c].b){var linetype=borderInfoCompute[bd_r+"_"+bd_c].b.style;var bcolor=borderInfoCompute[bd_r+"_"+bd_c].b.color;if(bb_obj["style"][linetype]==null){bb_obj["style"][linetype]=1;}else {bb_obj["style"][linetype]=bb_obj["style"][linetype]+1;}if(bb_obj["color"][bcolor]==null){bb_obj["color"][bcolor]=1;}else {bb_obj["color"][bcolor]=bb_obj["color"][bcolor]+1;}}if(bd_c==c&&borderInfoCompute[bd_r+"_"+bd_c]&&borderInfoCompute[bd_r+"_"+bd_c].l){var linetype=borderInfoCompute[r+"_"+c].l.style;var bcolor=borderInfoCompute[bd_r+"_"+bd_c].l.color;if(bl_obj["style"][linetype]==null){bl_obj["style"][linetype]=1;}else {bl_obj["style"][linetype]=bl_obj["style"][linetype]+1;}if(bl_obj["color"][bcolor]==null){bl_obj["color"][bcolor]=1;}else {bl_obj["color"][bcolor]=bl_obj["color"][bcolor]+1;}}if(bd_c==c+d[r][c]["mc"].cs-1&&borderInfoCompute[bd_r+"_"+bd_c]&&borderInfoCompute[bd_r+"_"+bd_c].r){var linetype=borderInfoCompute[bd_r+"_"+bd_c].r.style;var bcolor=borderInfoCompute[bd_r+"_"+bd_c].r.color;if(br_obj["style"][linetype]==null){br_obj["style"][linetype]=1;}else {br_obj["style"][linetype]=br_obj["style"][linetype]+1;}if(br_obj["color"][bcolor]==null){br_obj["color"][bcolor]=1;}else {br_obj["color"][bcolor]=br_obj["color"][bcolor]+1;}}}}var rowlen=d[r][c]["mc"].rs,collen=d[r][c]["mc"].cs;if(JSON.stringify(bl_obj).length>23){var bl_color=null,bl_style=null;for(x in bl_obj.color){if(bl_obj.color[x]>=rowlen/2){bl_color=x;}}for(x in bl_obj.style){if(bl_obj.style[x]>=rowlen/2){bl_style=x;}}if(bl_color!=null&&bl_style!=null){style+="border-left:"+_this.getHtmlBorderStyle(bl_style,bl_color);}}if(JSON.stringify(br_obj).length>23){var br_color=null,br_style=null;for(x in br_obj.color){if(br_obj.color[x]>=rowlen/2){br_color=x;}}for(x in br_obj.style){if(br_obj.style[x]>=rowlen/2){br_style=x;}}if(br_color!=null&&br_style!=null){style+="border-right:"+_this.getHtmlBorderStyle(br_style,br_color);}}if(JSON.stringify(bt_obj).length>23){var bt_color=null,bt_style=null;for(x in bt_obj.color){if(bt_obj.color[x]>=collen/2){bt_color=x;}}for(x in bt_obj.style){if(bt_obj.style[x]>=collen/2){bt_style=x;}}if(bt_color!=null&&bt_style!=null){style+="border-top:"+_this.getHtmlBorderStyle(bt_style,bt_color);}}if(JSON.stringify(bb_obj).length>23){var bb_color=null,bb_style=null;for(x in bb_obj.color){if(bb_obj.color[x]>=collen/2){bb_color=x;}}for(x in bb_obj.style){if(bb_obj.style[x]>=collen/2){bb_style=x;}}if(bb_color!=null&&bb_style!=null){style+="border-bottom:"+_this.getHtmlBorderStyle(bb_style,bb_color);}}}}else {continue;}}else {//边框
  if(borderInfoCompute&&borderInfoCompute[r+"_"+c]){//左边框
  if(borderInfoCompute[r+"_"+c].l){var linetype=borderInfoCompute[r+"_"+c].l.style;var bcolor=borderInfoCompute[r+"_"+c].l.color;style+="border-left:"+_this.getHtmlBorderStyle(linetype,bcolor);}//右边框
  if(borderInfoCompute[r+"_"+c].r){var linetype=borderInfoCompute[r+"_"+c].r.style;var bcolor=borderInfoCompute[r+"_"+c].r.color;style+="border-right:"+_this.getHtmlBorderStyle(linetype,bcolor);}//下边框
  if(borderInfoCompute[r+"_"+c].b){var linetype=borderInfoCompute[r+"_"+c].b.style;var bcolor=borderInfoCompute[r+"_"+c].b.color;style+="border-bottom:"+_this.getHtmlBorderStyle(linetype,bcolor);}//上边框
  if(borderInfoCompute[r+"_"+c].t){var linetype=borderInfoCompute[r+"_"+c].t.style;var bcolor=borderInfoCompute[r+"_"+c].t.color;style+="border-top:"+_this.getHtmlBorderStyle(linetype,bcolor);}}}column=luckysheet.replaceHtml(column,{"style":style,"span":span});if(c_value==null){c_value=luckysheet.getcellvalue(r,c,d);}if(c_value==null){c_value="";}column+=c_value;}else {var style="";//边框
  if(borderInfoCompute&&borderInfoCompute[r+"_"+c]){//左边框
  if(borderInfoCompute[r+"_"+c].l){var linetype=borderInfoCompute[r+"_"+c].l.style;var bcolor=borderInfoCompute[r+"_"+c].l.color;style+="border-left:"+_this.getHtmlBorderStyle(linetype,bcolor);}//右边框
  if(borderInfoCompute[r+"_"+c].r){var linetype=borderInfoCompute[r+"_"+c].r.style;var bcolor=borderInfoCompute[r+"_"+c].r.color;style+="border-right:"+_this.getHtmlBorderStyle(linetype,bcolor);}//下边框
  if(borderInfoCompute[r+"_"+c].b){var linetype=borderInfoCompute[r+"_"+c].b.style;var bcolor=borderInfoCompute[r+"_"+c].b.color;style+="border-bottom:"+_this.getHtmlBorderStyle(linetype,bcolor);}//上边框
  if(borderInfoCompute[r+"_"+c].t){var linetype=borderInfoCompute[r+"_"+c].t.style;var bcolor=borderInfoCompute[r+"_"+c].t.color;style+="border-top:"+_this.getHtmlBorderStyle(linetype,bcolor);}}column+="";if(r==minR){if(config==null||config["columlen"]==null||config["columlen"][c.toString()]==null){colgroup+='<colgroup width="72px"></colgroup>';}else {colgroup+='<colgroup width="'+config["columlen"][c.toString()]+'px"></colgroup>';}}if(c==minC){if(config==null||config["rowlen"]==null||config["rowlen"][r.toString()]==null){style+='height:19px;';}else {style+='height:'+config["rowlen"][r.toString()]+'px;';}}column=luckysheet.replaceHtml(column,{"style":style,"span":""});}column+='</td>';cpdata+=column;}cpdata+="</tr>";}cpdata='<table data-type="luckysheet_copy_action_table">'+colgroup+cpdata+'</table>';//console.log(luckysheet_selection_range, luckysheet_select_save);
  // cpdata = cpdata.substring(0, cpdata.length - 1);
  if(!clipboardData){var textarea=$("#luckysheet-copy-content");textarea.html(cpdata);textarea.focus();textarea.select();document.execCommand("selectAll");document.execCommand("Copy");// 等50毫秒，keyPress事件发生了再去处理数据
  setTimeout(function(){$("#luckysheet-copy-content").blur();},10);}else {//e.clipboardData.getData('text');//可以获取用户选中复制的数据
  clipboardData.setData('Text',cpdata);return false;//否则设不生效
  }},copybyformat:function copybyformat(e,txt){//copy事件
  var clipboardData=window.clipboardData;//for IE
  if(!clipboardData){// for chrome
  clipboardData=e.originalEvent.clipboardData;}luckysheet_selection_range=[{"row":luckysheet_select_save[0].row,"column":luckysheet_select_save[0].column}];luckysheet.selectionCopyShow();var cpdata=txt;if(!clipboardData){var textarea=$("#luckysheet-copy-content");textarea.text(cpdata);textarea.focus();textarea.select();document.execCommand("selectAll");document.execCommand("Copy");// 等50毫秒，keyPress事件发生了再去处理数据
  setTimeout(function(){textarea.blur();},10);}else {//e.clipboardData.getData('text');//可以获取用户选中复制的数据
  clipboardData.setData('Text',cpdata);return false;//否则设不生效
  }},isPasteAction:false,paste:function paste(e,triggerType){//paste事件
  var textarea=$("#luckysheet-copy-content");var $t=this;textarea.focus();textarea.select();// 等50毫秒，keyPress事件发生了再去处理数据
  setTimeout(function(){var data=textarea.html();if(data.indexOf("luckysheet_copy_action_table")>-1&&luckysheet_copy_save["copyRange"]!=null&&luckysheet_copy_save["copyRange"].length>0){if(luckysheet_paste_iscut){luckysheet_paste_iscut=false;luckysheet.selection.pasteHandlerOfCutPaste(luckysheet_copy_save);luckysheet.selection.clearcopy(e);}else {luckysheet.selection.pasteHandlerOfCopyPaste(luckysheet_copy_save);}// textarea.html("");
  // textarea.blur();
  }else if(triggerType!="btn"){$t.pasteHandler(data);// textarea.html("");
  // textarea.blur();
  }else {if(luckysheet.isEditMode()){alert("在表格中进行复制粘贴: Ctrl + C 进行复制, Ctrl + V 进行粘贴, Ctrl + X 进行剪切");}else {luckysheet.tooltip.info("在表格中进行复制粘贴","<span style='line-height: 1.0;font-size:36px;font-weight: bold;color:#666;'>Ctrl + C</span>&nbsp;&nbsp;进行复制<br/><span style='line-height: 1.0;font-size:36px;font-weight: bold;color:#666;'>Ctrl + V</span>&nbsp;&nbsp;进行粘贴<br/><span style='line-height: 1.0;font-size:36px;font-weight: bold;color:#666;'>Ctrl + X</span>&nbsp;&nbsp;进行剪切");}}},10);},pasteHandler:function pasteHandler(data,borderInfo){if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对多重选择区域执行此操作，请选择单个区域，然后再试");}}if(_typeof(data)=="object"){if(data.length==0){return;}var cfg=$.extend(true,{},config);if(cfg["merge"]==null){cfg["merge"]={};}if(JSON.stringify(borderInfo).length>2&&cfg["borderInfo"]==null){cfg["borderInfo"]=[];}var copyh=data.length,copyc=data[0].length;var minh=luckysheet_select_save[0].row[0],maxh=minh+copyh-1;//应用范围首尾行
  var minc=luckysheet_select_save[0].column[0],maxc=minc+copyc-1;//应用范围首尾列
  //应用范围包含部分合并单元格，则return提示
  var hasPartMC=false;if(cfg["merge"]!=null){hasPartMC=luckysheet.hasPartMC(cfg,minh,maxh,minc,maxc);}if(hasPartMC){if(luckysheet.isEditMode()){alert("不能对合并单元格做部分更改");}else {luckysheet.tooltip.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改");}return;}var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  var rowMaxLength=d.length;var cellMaxLength=d[0].length;//若应用范围超过最大行或最大列，增加行列
  var addr=maxh-rowMaxLength+1,addc=maxc-cellMaxLength+1;if(addr>0||addc>0){d=luckysheet.datagridgrowth([].concat(d),addr,addc,true);}if(cfg["rowlen"]==null){cfg["rowlen"]={};}var RowlChange=false;var offsetMC={};for(var h=minh;h<=maxh;h++){var x=[].concat(d[h]);var currentRowLen=defaultrowlen;if(cfg["rowlen"][h]!=null){currentRowLen=cfg["rowlen"][h];}for(var c=minc;c<=maxc;c++){if(luckysheet.getObjType(x[c])=="object"&&"mc"in x[c]){if("rs"in x[c].mc){delete cfg["merge"][x[c]["mc"].r+"_"+x[c]["mc"].c];}delete x[c].mc;}var value=null;if(data[h-minh]!=null&&data[h-minh][c-minc]!=null){value=data[h-minh][c-minc];}x[c]=$.extend(true,{},value);if(value!=null&&"mc"in x[c]){if(x[c]["mc"].rs!=null){x[c]["mc"].r=h;x[c]["mc"].c=c;cfg["merge"][x[c]["mc"].r+"_"+x[c]["mc"].c]=x[c]["mc"];offsetMC[value["mc"].r+"_"+value["mc"].c]=[x[c]["mc"].r,x[c]["mc"].c];}else {x[c]={"mc":{r:offsetMC[value["mc"].r+"_"+value["mc"].c][0],c:offsetMC[value["mc"].r+"_"+value["mc"].c][1]}};}}if(borderInfo[h-minh+"_"+(c-minc)]){var bd_obj={"rangeType":"cell","value":{"row_index":h,"col_index":c,"l":borderInfo[h-minh+"_"+(c-minc)].l,"r":borderInfo[h-minh+"_"+(c-minc)].r,"t":borderInfo[h-minh+"_"+(c-minc)].t,"b":borderInfo[h-minh+"_"+(c-minc)].b}};cfg["borderInfo"].push(bd_obj);}var fontset=luckysheetfontformat(x[c]);var oneLineTextHeight=luckysheet.menuButton.getTextSize("田",fontset)[1];//比较计算高度和当前高度取最大高度
  if(oneLineTextHeight>currentRowLen){currentRowLen=oneLineTextHeight;RowlChange=true;}}d[h]=x;if(currentRowLen!=defaultrowlen){cfg["rowlen"][h]=currentRowLen;}}luckysheet_select_save=[{"row":[minh,maxh],"column":[minc,maxc]}];if(addr>0||addc>0||RowlChange){luckysheet.jfrefreshgrid(d,luckysheet_select_save,cfg,null,true);}else {luckysheet.jfrefreshgrid(d,luckysheet_select_save,cfg);luckysheet.selectHightlightShow();}}else {data=data.replace(/\r/g,"");var dataChe=[];var che=data.split("\n"),colchelen=che[0].split("\t").length;for(var i=0;i<che.length;i++){if(che[i].split("\t").length<colchelen){continue;}dataChe.push(che[i].split("\t"));}var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  var last=luckysheet_select_save[luckysheet_select_save.length-1];var curR=last["row"]==null?0:last["row"][0];var curC=last["column"]==null?0:last["column"][0];var rlen=dataChe.length,clen=dataChe[0].length;//应用范围包含部分合并单元格，则return提示
  var hasPartMC=false;if(config["merge"]!=null){hasPartMC=luckysheet.hasPartMC(config,curR,curR+rlen-1,curC,curC+clen-1);}if(hasPartMC){if(luckysheet.isEditMode()){alert("不能对合并单元格做部分更改");}else {luckysheet.tooltip.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改");}return;}var addr=curR+rlen-d.length,addc=curC+clen-d[0].length;if(addr>0||addc>0){d=luckysheet.datagridgrowth([].concat(d),addr,addc,true);}for(var r=0;r<rlen;r++){var x=[].concat(d[r+curR]);for(var c=0;c<clen;c++){var cell={};var mask=luckysheet.mask.genarate(dataChe[r][c]);cell.v=mask[2];cell.ct=mask[1];cell.m=mask[0];x[c+curC]=cell;}d[r+curR]=x;}last["row"]=[curR,curR+rlen-1];last["column"]=[curC,curC+clen-1];if(addr>0||addc>0){luckysheet.jfrefreshgrid(d,luckysheet_select_save,null,null,true);}else {luckysheet.jfrefreshgrid(d,luckysheet_select_save);luckysheet.selectHightlightShow();}}},pasteHandlerOfCutPaste:function pasteHandlerOfCutPaste(copyRange){var cfg=$.extend(true,{},config);if(cfg["merge"]==null){cfg["merge"]={};}//复制范围
  var copyHasMC=copyRange["HasMC"];var copyRowlChange=copyRange["RowlChange"];var copySheetIndex=copyRange["dataSheetIndex"];var copyData=$.extend(true,[],luckysheet.getdatabyselection({"row":copyRange["copyRange"][0].row,"column":copyRange["copyRange"][0].column},copySheetIndex));var copyh=copyData.length,copyc=copyData[0].length;//应用范围
  var last=luckysheet_select_save[luckysheet_select_save.length-1];var minh=last["row_focus"],maxh=minh+copyh-1;//应用范围首尾行
  var minc=last["column_focus"],maxc=minc+copyc-1;//应用范围首尾列
  //应用范围包含部分合并单元格，则提示
  var hasPartMC=false;if(cfg["merge"]!=null){hasPartMC=luckysheet.hasPartMC(cfg,minh,maxh,minc,maxc);}if(hasPartMC){if(luckysheet.isEditMode()){alert("不能对合并单元格做部分更改");}else {luckysheet.tooltip.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改");}return;}var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  var rowMaxLength=d.length;var cellMaxLength=d[0].length;var addr=copyh+minh-rowMaxLength,addc=copyc+minc-cellMaxLength;if(addr>0||addc>0){d=luckysheet.datagridgrowth([].concat(d),addr,addc,true);}var borderInfoCompute=luckysheet.getBorderInfoCompute(copySheetIndex);//剪切粘贴在当前表操作，删除剪切范围内数据和合并单元格
  if(luckysheet.currentSheetIndex==copySheetIndex){for(var i=copyRange["copyRange"][0].row[0];i<=copyRange["copyRange"][0].row[1];i++){for(var j=copyRange["copyRange"][0].column[0];j<=copyRange["copyRange"][0].column[1];j++){var cell=d[i][j];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell){if("rs"in cell["mc"]){delete cfg["merge"][cell["mc"].r+"_"+cell["mc"].c];}delete cell["mc"];}d[i][j]=null;}}//边框
  if(cfg["borderInfo"]&&cfg["borderInfo"].length>0){var source_borderInfo=[];for(var i=0;i<cfg["borderInfo"].length;i++){var bd_rangeType=cfg["borderInfo"][i].rangeType;if(bd_rangeType=="range"){var bd_range=cfg["borderInfo"][i].range;var bd_emptyRange=[];for(var j=0;j<bd_range.length;j++){bd_emptyRange=bd_emptyRange.concat(luckysheet.conditionformat.CFSplitRange(bd_range[j],{"row":copyRange["copyRange"][0].row,"column":copyRange["copyRange"][0].column},{"row":[minh,maxh],"column":[minc,maxc]},"restPart"));}cfg["borderInfo"][i].range=bd_emptyRange;source_borderInfo.push(cfg["borderInfo"][i]);}else if(bd_rangeType=="cell"){var bd_r=cfg["borderInfo"][i].value.row_index;var bd_c=cfg["borderInfo"][i].value.col_index;if(!(bd_r>=copyRange["copyRange"][0].row[0]&&bd_r<=copyRange["copyRange"][0].row[1]&&bd_c>=copyRange["copyRange"][0].column[0]&&bd_c<=copyRange["copyRange"][0].column[1])){source_borderInfo.push(cfg["borderInfo"][i]);}}}cfg["borderInfo"]=source_borderInfo;}}var offsetMC={};for(var h=minh;h<=maxh;h++){var x=[].concat(d[h]);for(var c=minc;c<=maxc;c++){if(borderInfoCompute[copyRange["copyRange"][0].row[0]+h-minh+"_"+(copyRange["copyRange"][0].column[0]+c-minc)]){var bd_obj={"rangeType":"cell","value":{"row_index":h,"col_index":c,"l":borderInfoCompute[copyRange["copyRange"][0].row[0]+h-minh+"_"+(copyRange["copyRange"][0].column[0]+c-minc)].l,"r":borderInfoCompute[copyRange["copyRange"][0].row[0]+h-minh+"_"+(copyRange["copyRange"][0].column[0]+c-minc)].r,"t":borderInfoCompute[copyRange["copyRange"][0].row[0]+h-minh+"_"+(copyRange["copyRange"][0].column[0]+c-minc)].t,"b":borderInfoCompute[copyRange["copyRange"][0].row[0]+h-minh+"_"+(copyRange["copyRange"][0].column[0]+c-minc)].b}};if(cfg["borderInfo"]==null){cfg["borderInfo"]=[];}cfg["borderInfo"].push(bd_obj);}else if(borderInfoCompute[h+"_"+c]){var bd_obj={"rangeType":"cell","value":{"row_index":h,"col_index":c,"l":null,"r":null,"t":null,"b":null}};if(cfg["borderInfo"]==null){cfg["borderInfo"]=[];}cfg["borderInfo"].push(bd_obj);}if(luckysheet.getObjType(x[c])=="object"&&"mc"in x[c]){if("rs"in x[c].mc){delete cfg["merge"][x[c]["mc"].r+"_"+x[c]["mc"].c];}delete x[c].mc;}var value=null;if(copyData[h-minh]!=null&&copyData[h-minh][c-minc]!=null){value=copyData[h-minh][c-minc];}x[c]=$.extend(true,{},value);if(value!=null&&copyHasMC&&"mc"in x[c]){if(x[c]["mc"].rs!=null){x[c]["mc"].r=h;x[c]["mc"].c=c;cfg["merge"][x[c]["mc"].r+"_"+x[c]["mc"].c]=x[c]["mc"];offsetMC[value["mc"].r+"_"+value["mc"].c]=[x[c]["mc"].r,x[c]["mc"].c];}else {x[c]={"mc":{r:offsetMC[value["mc"].r+"_"+value["mc"].c][0],c:offsetMC[value["mc"].r+"_"+value["mc"].c][1]}};}}}d[h]=x;}last["row"]=[minh,maxh];last["column"]=[minc,maxc];//若有行高改变，重新计算行高改变
  if(copyRowlChange){if(luckysheet.currentSheetIndex!=copySheetIndex){cfg=luckysheet.rowlenByRange(d,minh,maxh,cfg);}else {cfg=luckysheet.rowlenByRange(d,copyRange["copyRange"][0].row[0],copyRange["copyRange"][0].row[1],cfg);cfg=luckysheet.rowlenByRange(d,minh,maxh,cfg);}}if(luckysheet.currentSheetIndex!=copySheetIndex){//跨表操作
  var sourceData=$.extend(true,[],luckysheetfile[luckysheet.sheetmanage.getSheetIndex(copySheetIndex)]["data"]);var sourceConfig=$.extend(true,{},luckysheetfile[luckysheet.sheetmanage.getSheetIndex(copySheetIndex)]["config"]);var sourceCurData=$.extend(true,[],sourceData);var sourceCurConfig=$.extend(true,{},sourceConfig);if(sourceCurConfig["merge"]==null){sourceCurConfig["merge"]={};}var source_r1=copyRange["copyRange"][0].row[0],source_r2=copyRange["copyRange"][0].row[1];var source_c1=copyRange["copyRange"][0].column[0],source_c2=copyRange["copyRange"][0].column[1];for(var source_r=source_r1;source_r<=source_r2;source_r++){for(var source_c=source_c1;source_c<=source_c2;source_c++){var cell=sourceCurData[source_r][source_c];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell){if("rs"in cell["mc"]){delete sourceCurConfig["merge"][cell["mc"].r+"_"+cell["mc"].c];}delete cell["mc"];}sourceCurData[source_r][source_c]=null;}}if(copyRowlChange){sourceCurConfig=luckysheet.rowlenByRange(sourceCurData,source_r1,source_r2,sourceCurConfig);}//边框
  if(sourceCurConfig["borderInfo"]&&sourceCurConfig["borderInfo"].length>0){var source_borderInfo=[];for(var i=0;i<sourceCurConfig["borderInfo"].length;i++){var bd_rangeType=sourceCurConfig["borderInfo"][i].rangeType;if(bd_rangeType=="range"){var bd_range=sourceCurConfig["borderInfo"][i].range;var bd_emptyRange=[];for(var j=0;j<bd_range.length;j++){bd_emptyRange=bd_emptyRange.concat(luckysheet.conditionformat.CFSplitRange(bd_range[j],{"row":copyRange["copyRange"][0].row,"column":copyRange["copyRange"][0].column},{"row":[minh,maxh],"column":[minc,maxc]},"restPart"));}sourceCurConfig["borderInfo"][i].range=bd_emptyRange;source_borderInfo.push(sourceCurConfig["borderInfo"][i]);}else if(bd_rangeType=="cell"){var bd_r=sourceCurConfig["borderInfo"][i].value.row_index;var bd_c=sourceCurConfig["borderInfo"][i].value.col_index;if(!(bd_r>=copyRange["copyRange"][0].row[0]&&bd_r<=copyRange["copyRange"][0].row[1]&&bd_c>=copyRange["copyRange"][0].column[0]&&bd_c<=copyRange["copyRange"][0].column[1])){source_borderInfo.push(sourceCurConfig["borderInfo"][i]);}}}sourceCurConfig["borderInfo"]=source_borderInfo;}//条件格式
  var source_cdformat=$.extend(true,[],luckysheetfile[luckysheet.sheetmanage.getSheetIndex(copySheetIndex)]["luckysheet_conditionformat_save"]);var source_curCdformat=$.extend(true,[],source_cdformat);var ruleArr=[];if(source_curCdformat!=null&&source_curCdformat.length>0){for(var i=0;i<source_curCdformat.length;i++){var source_curCdformat_cellrange=source_curCdformat[i].cellrange;var emptyRange=[];var emptyRange2=[];for(var j=0;j<source_curCdformat_cellrange.length;j++){var range=luckysheet.conditionformat.CFSplitRange(source_curCdformat_cellrange[j],{"row":copyRange["copyRange"][0].row,"column":copyRange["copyRange"][0].column},{"row":[minh,maxh],"column":[minc,maxc]},"restPart");emptyRange=emptyRange.concat(range);var range2=luckysheet.conditionformat.CFSplitRange(source_curCdformat_cellrange[j],{"row":copyRange["copyRange"][0].row,"column":copyRange["copyRange"][0].column},{"row":[minh,maxh],"column":[minc,maxc]},"operatePart");if(range2.length>0){emptyRange2=emptyRange2.concat(range2);}}source_curCdformat[i].cellrange=emptyRange;if(emptyRange2.length>0){var ruleObj=$.extend(true,{},source_curCdformat[i]);ruleObj.cellrange=emptyRange2;ruleArr.push(ruleObj);}}}var target_cdformat=$.extend(true,[],luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]);var target_curCdformat=$.extend(true,[],target_cdformat);if(ruleArr.length>0){target_curCdformat=target_curCdformat.concat(ruleArr);}var source={"sheetIndex":copySheetIndex,"data":sourceData,"curData":sourceCurData,"config":sourceConfig,"curConfig":sourceCurConfig,"cdformat":source_cdformat,"curCdformat":source_curCdformat,"range":{"row":copyRange["copyRange"][0].row,"column":copyRange["copyRange"][0].column}};var target={"sheetIndex":luckysheet.currentSheetIndex,"data":luckysheet.flowdata,"curData":d,"config":$.extend(true,{},config),"curConfig":cfg,"cdformat":target_cdformat,"curCdformat":target_curCdformat,"range":{"row":[minh,maxh],"column":[minc,maxc]}};}else {//条件格式
  var cdformat=$.extend(true,[],luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]);var curCdformat=$.extend(true,[],cdformat);if(curCdformat!=null&&curCdformat.length>0){for(var i=0;i<curCdformat.length;i++){var cellrange=curCdformat[i].cellrange;var emptyRange=[];for(var j=0;j<cellrange.length;j++){var range=luckysheet.conditionformat.CFSplitRange(cellrange[j],{"row":copyRange["copyRange"][0].row,"column":copyRange["copyRange"][0].column},{"row":[minh,maxh],"column":[minc,maxc]},"allPart");emptyRange=emptyRange.concat(range);}curCdformat[i].cellrange=emptyRange;}}//当前表操作
  var source={"sheetIndex":luckysheet.currentSheetIndex,"data":luckysheet.flowdata,"curData":d,"config":$.extend(true,{},config),"curConfig":cfg,"cdformat":cdformat,"curCdformat":curCdformat,"range":{"row":copyRange["copyRange"][0].row,"column":copyRange["copyRange"][0].column}};var target={"sheetIndex":luckysheet.currentSheetIndex,"data":luckysheet.flowdata,"curData":d,"config":$.extend(true,{},config),"curConfig":cfg,"cdformat":cdformat,"curCdformat":curCdformat,"range":{"row":[minh,maxh],"column":[minc,maxc]}};}if(addr>0||addc>0){luckysheet.jfrefreshgrid_pastcut(source,target,true);}else {luckysheet.jfrefreshgrid_pastcut(source,target,copyRowlChange);}},pasteHandlerOfCopyPaste:function pasteHandlerOfCopyPaste(copyRange){var cfg=$.extend(true,{},config);if(cfg["merge"]==null){cfg["merge"]={};}//复制范围
  var copyHasMC=copyRange["HasMC"];var copyRowlChange=copyRange["RowlChange"];var copySheetIndex=copyRange["dataSheetIndex"];var arr=[],isSameRow=false;for(var i=0;i<copyRange["copyRange"].length;i++){var arrData=luckysheet.getdatabyselection({"row":copyRange["copyRange"][i].row,"column":copyRange["copyRange"][i].column},copySheetIndex);if(copyRange["copyRange"].length>1){if(copyRange["copyRange"][0].row[0]==copyRange["copyRange"][1].row[0]&&copyRange["copyRange"][0].row[1]==copyRange["copyRange"][1].row[1]){arrData=arrData[0].map(function(col,a){return arrData.map(function(row){return row[a];});});arr=arr.concat(arrData);isSameRow=true;}else if(copyRange["copyRange"][0].column[0]==copyRange["copyRange"][1].column[0]&&copyRange["copyRange"][0].column[1]==copyRange["copyRange"][1].column[1]){arr=arr.concat(arrData);}}else {arr=arrData;}}if(isSameRow){arr=arr[0].map(function(col,b){return arr.map(function(row){return row[b];});});}var copyData=$.extend(true,[],arr);//多重选择选择区域 单元格如果有函数 则只取值 不取函数
  if(copyRange["copyRange"].length>1){for(var i=0;i<copyData.length;i++){for(var j=0;j<copyData[i].length;j++){if(copyData[i][j]!=null&&copyData[i][j].f!=null){delete copyData[i][j].f;delete copyData[i][j].spl;}}}}var copyh=copyData.length,copyc=copyData[0].length;//应用范围
  var last=luckysheet_select_save[luckysheet_select_save.length-1];var minh=last["row"][0],maxh=last["row"][1];//应用范围首尾行
  var minc=last["column"][0],maxc=last["column"][1];//应用范围首尾列
  var mh=(maxh-minh+1)%copyh;var mc=(maxc-minc+1)%copyc;if(mh!=0||mc!=0){//若应用范围不是copydata行列数的整数倍，则取copydata的行列数
  maxh=minh+copyh-1;maxc=minc+copyc-1;}//应用范围包含部分合并单元格，则提示
  var hasPartMC=false;if(cfg["merge"]!=null){hasPartMC=luckysheet.hasPartMC(cfg,minh,maxh,minc,maxc);}if(hasPartMC){if(luckysheet.isEditMode()){alert("不能对合并单元格做部分更改");}else {luckysheet.tooltip.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改");}return;}var timesH=(maxh-minh+1)/copyh;var timesC=(maxc-minc+1)/copyc;var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  var rowMaxLength=d.length;var cellMaxLength=d[0].length;//若应用范围超过最大行或最大列，增加行列
  var addr=copyh+minh-rowMaxLength,addc=copyc+minc-cellMaxLength;if(addr>0||addc>0){d=luckysheet.datagridgrowth([].concat(d),addr,addc,true);}var borderInfoCompute=luckysheet.getBorderInfoCompute(copySheetIndex);var mth=0,mtc=0,maxcellCahe=0,maxrowCache=0;for(var th=1;th<=timesH;th++){for(var tc=1;tc<=timesC;tc++){mth=minh+(th-1)*copyh;mtc=minc+(tc-1)*copyc;maxrowCache=minh+th*copyh;maxcellCahe=minc+tc*copyc;//行列位移值 用于单元格有函数
  var offsetRow=mth-copyRange["copyRange"][0].row[0];var offsetCol=mtc-copyRange["copyRange"][0].column[0];var offsetMC={};for(var h=mth;h<maxrowCache;h++){var x=[].concat(d[h]);for(var c=mtc;c<maxcellCahe;c++){if(borderInfoCompute[copyRange["copyRange"][0].row[0]+h-mth+"_"+(copyRange["copyRange"][0].column[0]+c-mtc)]){var bd_obj={"rangeType":"cell","value":{"row_index":h,"col_index":c,"l":borderInfoCompute[copyRange["copyRange"][0].row[0]+h-mth+"_"+(copyRange["copyRange"][0].column[0]+c-mtc)].l,"r":borderInfoCompute[copyRange["copyRange"][0].row[0]+h-mth+"_"+(copyRange["copyRange"][0].column[0]+c-mtc)].r,"t":borderInfoCompute[copyRange["copyRange"][0].row[0]+h-mth+"_"+(copyRange["copyRange"][0].column[0]+c-mtc)].t,"b":borderInfoCompute[copyRange["copyRange"][0].row[0]+h-mth+"_"+(copyRange["copyRange"][0].column[0]+c-mtc)].b}};if(cfg["borderInfo"]==null){cfg["borderInfo"]=[];}cfg["borderInfo"].push(bd_obj);}else if(borderInfoCompute[h+"_"+c]){var bd_obj={"rangeType":"cell","value":{"row_index":h,"col_index":c,"l":null,"r":null,"t":null,"b":null}};if(cfg["borderInfo"]==null){cfg["borderInfo"]=[];}cfg["borderInfo"].push(bd_obj);}if(luckysheet.getObjType(x[c])=="object"&&"mc"in x[c]){if("rs"in x[c].mc){delete cfg["merge"][x[c]["mc"].r+"_"+x[c]["mc"].c];}delete x[c].mc;}var value=null;if(copyData[h-mth]!=null&&copyData[h-mth][c-mtc]!=null){value=$.extend(true,{},copyData[h-mth][c-mtc]);}if(value!=null&&value.f!=null){var func=value.f;if(offsetRow>0){func="="+luckysheet.formula.functionCopy(func,"down",offsetRow);}if(offsetRow<0){func="="+luckysheet.formula.functionCopy(func,"up",Math.abs(offsetRow));}if(offsetCol>0){func="="+luckysheet.formula.functionCopy(func,"right",offsetCol);}if(offsetCol<0){func="="+luckysheet.formula.functionCopy(func,"left",Math.abs(offsetCol));}var funcV=luckysheet.formula.execfunction(func,h,c,true);if(value.spl!=null){value.f=funcV[2];value.v=funcV[1];value.spl=funcV[3].data;}else {value.f=funcV[2];value.v=funcV[1];if(value.ct!=null&&value.ct["fa"]!=null){value.m=luckysheet.mask.update(value.ct["fa"],funcV[1]);}}}x[c]=$.extend(true,{},value);if(value!=null&&copyHasMC&&"mc"in x[c]){if(x[c]["mc"].rs!=null){x[c]["mc"].r=h;x[c]["mc"].c=c;cfg["merge"][x[c]["mc"].r+"_"+x[c]["mc"].c]=x[c]["mc"];offsetMC[value["mc"].r+"_"+value["mc"].c]=[x[c]["mc"].r,x[c]["mc"].c];}else {x[c]={"mc":{r:offsetMC[value["mc"].r+"_"+value["mc"].c][0],c:offsetMC[value["mc"].r+"_"+value["mc"].c][1]}};}}}d[h]=x;}}}//复制范围 是否有 条件格式
  if(copyRange["copyRange"].length==1){var c_file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(copySheetIndex)];var a_file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];var c_r1=copyRange["copyRange"][0].row[0],c_r2=copyRange["copyRange"][0].row[1],c_c1=copyRange["copyRange"][0].column[0],c_c2=copyRange["copyRange"][0].column[1];var ruleArr_cf=$.extend(true,[],c_file["luckysheet_conditionformat_save"]);var cdformat=$.extend(true,[],a_file["luckysheet_conditionformat_save"]);if(ruleArr_cf!=null&&ruleArr_cf.length>0){for(var i=0;i<ruleArr_cf.length;i++){var cf_range=ruleArr_cf[i].cellrange;var emptyRange=[];for(var th=1;th<=timesH;th++){for(var tc=1;tc<=timesC;tc++){mth=minh+(th-1)*copyh;mtc=minc+(tc-1)*copyc;maxrowCache=minh+th*copyh;maxcellCahe=minc+tc*copyc;for(var j=0;j<cf_range.length;j++){var range=luckysheet.conditionformat.CFSplitRange(cf_range[j],{"row":[c_r1,c_r2],"column":[c_c1,c_c2]},{"row":[mth,maxrowCache-1],"column":[mtc,maxcellCahe-1]},"operatePart");if(range.length>0){emptyRange=emptyRange.concat(range);}}}}if(emptyRange.length>0){ruleArr_cf[i].cellrange=emptyRange;cdformat.push(ruleArr_cf[i]);}}}}last["row"]=[minh,maxh];last["column"]=[minc,maxc];if(copyRowlChange||addr>0||addc>0){cfg=luckysheet.rowlenByRange(d,minh,maxh,cfg);if(copyRange["copyRange"].length==1&&ruleArr_cf!=null&&ruleArr_cf.length>0){luckysheet.jfrefreshgrid(d,luckysheet_select_save,cfg,cdformat,true);}else {luckysheet.jfrefreshgrid(d,luckysheet_select_save,cfg,null,true);}}else {if(copyRange["copyRange"].length==1&&ruleArr_cf!=null&&ruleArr_cf.length>0){luckysheet.jfrefreshgrid(d,luckysheet_select_save,cfg,cdformat);}else {luckysheet.jfrefreshgrid(d,luckysheet_select_save,cfg);}luckysheet.selectHightlightShow();}},pasteHandlerOfPaintModel:function pasteHandlerOfPaintModel(copyRange){var cfg=$.extend(true,{},config);if(cfg["merge"]==null){cfg["merge"]={};}//复制范围
  var copyHasMC=copyRange["HasMC"];var copyRowlChange=copyRange["RowlChange"];var copySheetIndex=copyRange["dataSheetIndex"];var copyData=$.extend(true,[],luckysheet.getdatabyselection({"row":copyRange["copyRange"][0].row,"column":copyRange["copyRange"][0].column},copySheetIndex));//应用范围
  var last=luckysheet_select_save[luckysheet_select_save.length-1];var minh=last["row"][0],maxh=last["row"][1];//应用范围首尾行
  var minc=last["column"][0],maxc=last["column"][1];//应用范围首尾列
  var copyh=copyData.length,copyc=copyData[0].length;if(minh==maxh&&minc==maxc){//应用范围是一个单元格，自动增加到复制范围大小 (若自动增加的范围包含部分合并单元格，则提示)
  var hasPartMC=false;if(cfg["merge"]!=null){hasPartMC=luckysheet.hasPartMC(cfg,minh,minh+copyh-1,minc,minc+copyc-1);}if(hasPartMC){if(luckysheet.isEditMode()){alert("不能对合并单元格做部分更改");}else {luckysheet.tooltip.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改");}return;}maxh=minh+copyh-1;maxc=minc+copyc-1;}var timesH=Math.ceil((maxh-minh+1)/copyh);//复制行 组数
  var timesC=Math.ceil((maxc-minc+1)/copyc);//复制列 组数
  var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  var cellMaxLength=d[0].length;var rowMaxLength=d.length;var borderInfoCompute=luckysheet.getBorderInfoCompute(copySheetIndex);var mth=0,mtc=0,maxcellCahe=0,maxrowCache=0;for(var th=1;th<=timesH;th++){for(var tc=1;tc<=timesC;tc++){mth=minh+(th-1)*copyh;mtc=minc+(tc-1)*copyc;maxrowCache=minh+th*copyh>rowMaxLength?rowMaxLength:minh+th*copyh;if(maxrowCache>maxh+1){maxrowCache=maxh+1;}maxcellCahe=minc+tc*copyc>cellMaxLength?cellMaxLength:minc+tc*copyc;if(maxcellCahe>maxc+1){maxcellCahe=maxc+1;}var offsetMC={};for(var h=mth;h<maxrowCache;h++){var x=[].concat(d[h]);for(var c=mtc;c<maxcellCahe;c++){if(borderInfoCompute[copyRange["copyRange"][0].row[0]+h-mth+"_"+(copyRange["copyRange"][0].column[0]+c-mtc)]){var bd_obj={"rangeType":"cell","value":{"row_index":h,"col_index":c,"l":borderInfoCompute[copyRange["copyRange"][0].row[0]+h-mth+"_"+(copyRange["copyRange"][0].column[0]+c-mtc)].l,"r":borderInfoCompute[copyRange["copyRange"][0].row[0]+h-mth+"_"+(copyRange["copyRange"][0].column[0]+c-mtc)].r,"t":borderInfoCompute[copyRange["copyRange"][0].row[0]+h-mth+"_"+(copyRange["copyRange"][0].column[0]+c-mtc)].t,"b":borderInfoCompute[copyRange["copyRange"][0].row[0]+h-mth+"_"+(copyRange["copyRange"][0].column[0]+c-mtc)].b}};if(cfg["borderInfo"]==null){cfg["borderInfo"]=[];}cfg["borderInfo"].push(bd_obj);}else if(borderInfoCompute[h+"_"+c]){var bd_obj={"rangeType":"cell","value":{"row_index":h,"col_index":c,"l":null,"r":null,"t":null,"b":null}};if(cfg["borderInfo"]==null){cfg["borderInfo"]=[];}cfg["borderInfo"].push(bd_obj);}if(luckysheet.getObjType(x[c])=="object"&&"mc"in x[c]){if("rs"in x[c].mc){delete cfg["merge"][x[c]["mc"].r+"_"+x[c]["mc"].c];}delete x[c].mc;}var value=null;if(copyData[h-mth]!=null&&copyData[h-mth][c-mtc]!=null){value=copyData[h-mth][c-mtc];}if(value!=null){delete value["v"];delete value["m"];delete value["f"];delete value["spl"];if(luckysheet.getObjType(x[c])=="object");else {x[c]={"v":x[c]};}x[c]=$.extend(true,x[c],value);if(copyHasMC&&"mc"in x[c]){if(x[c]["mc"].rs!=null){x[c]["mc"].r=h;if(x[c]["mc"].rs+h>=maxrowCache){x[c]["mc"].rs=maxrowCache-h;}x[c]["mc"].c=c;if(x[c]["mc"].cs+c>=maxcellCahe){x[c]["mc"].cs=maxcellCahe-c;}cfg["merge"][x[c]["mc"].r+"_"+x[c]["mc"].c]=x[c]["mc"];offsetMC[value["mc"].r+"_"+value["mc"].c]=[x[c]["mc"].r,x[c]["mc"].c];}else {x[c]={"mc":{r:offsetMC[value["mc"].r+"_"+value["mc"].c][0],c:offsetMC[value["mc"].r+"_"+value["mc"].c][1]}};}}if(x[c].v!=null){if(value["ct"]!=null&&value["ct"]["fa"]!=null){var mask=luckysheet.mask.update(value["ct"]["fa"],x[c].v);x[c].m=mask;}}}}d[h]=x;}}}//复制范围 是否有 条件格式
  var ruleArr=$.extend(true,[],luckysheetfile[luckysheet.sheetmanage.getSheetIndex(copySheetIndex)]["luckysheet_conditionformat_save"]);var cdformat=$.extend(true,[],luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]);if(ruleArr!=null&&ruleArr.length>0){for(var i=0;i<ruleArr.length;i++){var cdformat_cellrange=ruleArr[i].cellrange;var emptyRange=[];for(var j=0;j<cdformat_cellrange.length;j++){var range=luckysheet.conditionformat.CFSplitRange(cdformat_cellrange[j],{"row":copyRange["copyRange"][0]["row"],"column":copyRange["copyRange"][0]["column"]},{"row":[minh,maxh],"column":[minc,maxc]},"operatePart");if(range.length>0){emptyRange=emptyRange.concat(range);}}if(emptyRange.length>0){ruleArr[i].cellrange=[{"row":[minh,maxh],"column":[minc,maxc]}];cdformat.push(ruleArr[i]);}}}last["row"]=[minh,maxh];last["column"]=[minc,maxc];if(copyRowlChange){cfg=luckysheet.rowlenByRange(d,minh,maxh,cfg);if(ruleArr!=null&&ruleArr.length>0){luckysheet.jfrefreshgrid(d,luckysheet_select_save,cfg,cdformat,true);}else {luckysheet.jfrefreshgrid(d,luckysheet_select_save,cfg,null,true);}}else {if(ruleArr!=null&&ruleArr.length>0){luckysheet.jfrefreshgrid(d,luckysheet_select_save,cfg,cdformat);}else {luckysheet.jfrefreshgrid(d,luckysheet_select_save,cfg);}luckysheet.selectHightlightShow();}},matchcopy:function matchcopy(data1,data2){var data1cache=[],data2cache=[],data1len,data2len;if(_typeof(data1)=="object"){data1cache=data1;}else {data1cache=data1.split("\n");for(var i=0;i<data1cache.length;i++){data1cache[i]=data1cache[i].split("\t");}}data1len=data1cache.length;if(_typeof(data2)=="object"){data2cache=data2;}else {data2cache=data2.split("\n");for(var i=0;i<data2cache.length;i++){data2cache[i]=data2cache[i].split("\t");}}data2len=data2cache.length;if(data1len!=data2len){return false;}for(var r1=0;r1<data1len;r1++){if(config["rowhidden"]!=null&&config["rowhidden"][r1]!=null){continue;}for(var r2=0;r2<data2len;r2++){if(data1cache[r1].length!=data2cache[r2].length){return false;}}}for(var r=0;r<data1len;r++){if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null){continue;}for(var c=0;c<data1cache[0].length;c++){if(luckysheet.getcellvalue(r,c,data1cache)!=luckysheet.getcellvalue(r,c,data2cache)){return false;}}}return true;}};luckysheet.datecontroll={isdatetime:function isdatetime(s){if(s==null||s.toString().length<5){return false;}else if(checkDateTime(s)){return true;}else {return false;}function checkDateTime(str){var reg1=/^(\d{4})-(\d{1,2})-(\d{1,2})(\s(\d{1,2}):(\d{1,2})(:(\d{1,2}))?)?$/;var reg2=/^(\d{4})\/(\d{1,2})\/(\d{1,2})(\s(\d{1,2}):(\d{1,2})(:(\d{1,2}))?)?$/;if(!reg1.test(str)&&!reg2.test(str)){return false;}var year=RegExp.$1,month=RegExp.$2,day=RegExp.$3;if(year<1900){return false;}if(month>12){return false;}if(day>31){return false;}if(month==2){if(new Date(year,1,29).getDate()==29&&day>29){return false;}else if(new Date(year,1,29).getDate()!=29&&day>28){return false;}}return true;}},diff:function diff(now,then){return moment(now).diff(moment(then));}};luckysheet.isdatatype=function(s){var type="string";if(luckysheet.datecontroll.isdatetime(s)){type="date";}else if(!isNaN(parseFloat(s))&&!luckysheet.hasChinaword(s)){type="num";}return type;};luckysheet.isdatatypemulti=function(s){var type={};if(luckysheet.datecontroll.isdatetime(s)){type["date"]=true;}if(!isNaN(parseFloat(s))&&!luckysheet.hasChinaword(s)){type["num"]=true;}return type;};luckysheet.numfloatlen=function(n){if(n!=null&&!isNaN(parseFloat(n))&&!luckysheet.hasChinaword(n)){var value=numeral(n).value();var lens=value.toString().split(".");if(lens.length==1){lens=0;}else {lens=lens[1].length;}return lens;}else {return null;}};luckysheet.range_config=function(rangeConfigCheck,rangeRowCheck,rangeColCheck){if(rangeConfigCheck){luckysheet.chartparam.jgridCurrentChartData=luckysheet.jgfridturntrans(luckysheet.chartparam.jgridCurrentChartData);}if(rangeRowCheck);else {var addrow=[];//旧图表转置功能和设置列行配合
  var c_st,c_length;if(rangeConfigCheck){c_st=luckysheet.chartparam.jgridCurrentChartSelection["row"][0];c_length=luckysheet.chartparam.jgridCurrentChartSelection["row"][1];}else {c_st=luckysheet.chartparam.jgridCurrentChartSelection["column"][0];c_length=luckysheet.chartparam.jgridCurrentChartSelection["column"][1];}for(var i=c_st;i<=c_length;i++){if(rangeColCheck&&i==c_st){//选中列为标签列时，先添加标题
  addrow.push("");}else {addrow.push(luckysheet.luckysheetchatatABC(i));}}luckysheet.chartparam.jgridCurrentChartData.unshift(addrow);}if(rangeColCheck);else {//console.log(luckysheet.chartparam.jgridCurrentChartData, luckysheet.chartparam.jgridCurrentChartSelection);
  var curlen=luckysheet.chartparam.jgridCurrentChartData.length;//var $rowcheck = $("#luckysheet-datavisual-range-config-row");
  luckysheet.chartparam.jgridCurrentChartData[0].unshift("");//无论rangeRowCheck为何值都添加
  for(var i=1;i<curlen;i++){// if(rangeRowCheck && i==0 || ){
  //     luckysheet.chartparam.jgridCurrentChartData[i].unshift("");
  // }
  // else{
  var fix=0;if(rangeRowCheck){fix=1;}luckysheet.chartparam.jgridCurrentChartData[i].unshift(luckysheet.luckysheetchatatABC(luckysheet.chartparam.jgridCurrentChartSelection["column"][0])+(i+luckysheet.chartparam.jgridCurrentChartSelection["row"][0]+fix));// }
  }//luckysheet.chartparam.jgridCurrentChartData.unshift(addrow);
  }};luckysheet.numFormat=function(num,type){if(num==null||isNaN(parseFloat(num))||luckysheet.hasChinaword(num)||num==-Infinity||num==Infinity){return null;}var floatlen=6,ismustfloat=false;if(type==null||type=="auto"){if(num<1){floatlen=6;}else {floatlen=1;}}else {if(luckysheet.isdatatype(type)=="num"){floatlen=parseInt(type);ismustfloat=true;}else {floatlen=6;}}var format="",value=null;for(var i=0;i<floatlen;i++){format+="0";}if(!ismustfloat){format="["+format+"]";}if(num>=1e+21){value=parseFloat(numeral(num).value());}else {value=parseFloat(numeral(num).format("0."+format));}return value;};luckysheet.array={transpose:function transpose(getdata){var arr=[];//console.log(getdata);
  if(getdata.length==0){return [];}if(getdata[0].length==0){return [];}for(var c=0;c<getdata[0].length;c++){var a=[];for(var r=0;r<getdata.length;r++){var value="";if(getdata[r]!=null&&getdata[r][c]!=null){value=luckysheet.getcellvalue(r,c,getdata);}//console.log(value);
  a.push(value);}arr.push(a);}return arr;},minusClear:function minusClear(p,m){if(m.row[0]>p.row[1]||m.row[1]<p.row[0]||m.column[0]>p.column[1]||m.column[1]<p.column[0]){return null;}if(m.row[0]==p.row[0]&&m.row[1]<p.row[1]&&m.column[0]>p.column[0]&&m.column[1]<p.column[1]){return [];}var ret=[];var row=null,column=[p.column[0],p.column[1]];if(m.row[1]>p.row[0]&&m.row[1]<p.row[1]){row=[m.row[1]+1,p.row[1]];}else if(m.row[0]>p.row[0]&&m.row[0]<p.row[1]){row=[p.row[0],m.row[0]-1];}if(row!=null){ret.push({"row":row,"column":column});}var row=[p.row[0],p.row[1]],column=null;if(m.column[1]>p.column[0]&&m.column[1]<p.column[1]){column=[m.column[1]+1,p.column[1]];}else if(m.column[0]>p.column[0]&&m.column[0]<p.column[1]){column=[p.column[0],m.column[0]-1];}if(column!=null){ret.push({"row":row,"column":column});}//console.log(ret);
  return ret;// for(var r =p.row[0];r<=p.row[1];r++){
  //     var 
  //     for(var c =p.column[0];c<=p.column[1];c++){
  //     }
  // }
  }};luckysheet.analysis={"STDEVP":function STDEVP(mean,array1d){var cov=0;for(var i=0;i<array1d.length;i++){var xi=array1d[i];cov+=Math.pow(xi-mean,2);}return luckysheet.numFormat(Math.sqrt(cov/array1d.length));},"STDEV":function STDEV(mean,array1d){var cov=0;for(var i=0;i<array1d.length;i++){var xi=array1d[i];cov+=Math.pow(xi-mean,2);}return luckysheet.numFormat(Math.sqrt(cov/(array1d.length-1)));},"VARP":function VARP(mean,array1d){var cov=0;for(var i=0;i<array1d.length;i++){var xi=array1d[i];cov+=Math.pow(xi-mean,2);}return luckysheet.numFormat(cov/array1d.length);},"VAR":function VAR(mean,array1d){var cov=0;for(var i=0;i<array1d.length;i++){var xi=array1d[i];cov+=Math.pow(xi-mean,2);}return luckysheet.numFormat(cov/(array1d.length-1));}};luckysheet.tooltip={info:function info(title,content){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-info").remove();$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-info","addclass":"","title":title,"content":content,"botton":'<button class="btn btn-default luckysheet-model-close-btn">&nbsp;&nbsp;关闭&nbsp;&nbsp;</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-info").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-info").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();},confirm:function confirm(title,content,func1,func2,name1,name2){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-confirm").remove();if(name1==null){name1="确定";}if(name2==null){name2="取消";}$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-confirm","addclass":"","style":"z-index:100003","title":title,"content":content,"botton":'<button class="btn btn-primary luckysheet-model-conform-btn">&nbsp;&nbsp;'+name1+'&nbsp;&nbsp;</button><button class="btn btn-default luckysheet-model-cancel-btn">&nbsp;&nbsp;'+name2+'&nbsp;&nbsp;</button>'}));var $t=$("#luckysheet-confirm").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-confirm").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();$t.find(".luckysheet-model-conform-btn").click(function(){if(typeof func1=='function'){func1();}$("#luckysheet-confirm").hide();$("#luckysheet-modal-dialog-mask").hide();});$t.find(".luckysheet-model-cancel-btn").click(function(){if(typeof func2=='function'){func2();}$("#luckysheet-confirm").hide();$("#luckysheet-modal-dialog-mask").hide();});},screenshot:function screenshot(title,content,imgurl){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-confirm").remove();$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-confirm","addclass":"","style":"z-index:100003","title":title,"content":content,"botton":'<a style="text-decoration:none;color:#fff;" class="download btn btn-primary luckysheet-model-conform-btn">&nbsp;&nbsp;下载&nbsp;&nbsp;</a>&nbsp;&nbsp;<button class="btn btn-primary luckysheet-model-copy-btn">&nbsp;&nbsp;复制到剪切板&nbsp;&nbsp;</button><button class="btn btn-default luckysheet-model-cancel-btn">&nbsp;&nbsp;关闭&nbsp;&nbsp;</button>'}));var $t=$("#luckysheet-confirm").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-confirm").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();$t.find(".luckysheet-model-conform-btn").click(function(){if(luckysheet.browser.isIE()=="1"){alert("下载功能IE浏览器不支持！");}else {if(!!window.ActiveXObject||"ActiveXObject"in window){if($("#IframeReportImg").length===0){$('<iframe style="display:none;" id="IframeReportImg" name="IframeReportImg" onload="downloadImg();" width="0" height="0" src="about:blank"></iframe>').appendTo("body");}if($('#IframeReportImg').attr("src")!=imgurl){$('#IframeReportImg').attr("src",imgurl);}else {if($('#IframeReportImg').src!="about:blank"){window.frames["IframeReportImg"].document.execCommand("SaveAs");}}}}});$t.find(".luckysheet-model-cancel-btn").click(function(){$("#luckysheet-confirm").hide();$("#luckysheet-modal-dialog-mask").hide();});$('#luckysheet-confirm .luckysheet-model-copy-btn').click(function(){var dt=new clipboard.DT();dt.setData("text/html","<img src='"+imgurl+"'>");if(luckysheet.browser.isIE()=="1"){alert("请在图片上右键点击'复制'");}else {clipboard.write(dt);alert("已成功复制（如果粘贴失败，请在图片上右键点击'复制图片'）");}});},chartPointConfig:function chartPointConfig(id,savefunc1,closefunc2){$("body").append(luckysheet.replaceHtml(modelHTML,{"id":id,"addclass":"luckysheet-chart-point-config-c","title":"数据点批量设置","content":luckysheetchartpointconfigHTML,"botton":'<button class="btn btn-danger luckysheet-model-save-btn">&nbsp;&nbsp;保存设置&nbsp;&nbsp;</button><button class="btn btn-default luckysheet-model-close-btn">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>',"style":"z-index:100003;height:80%;width:80%;top:10%;left:10%;"}));$("#luckysheet-modal-dialog-mask").show();var winw=$(window).width(),winh=$(window).height();$("#"+id).find(".luckysheet-chart-point-config").css("height",winh-160);$("#"+id).css({"height":winh-90,width:winw-100,"left":7,"top":14}).show().find(".luckysheet-model-save-btn").click(function(){if(typeof savefunc1=='function'){savefunc1();}$("#"+id).hide();$("#luckysheet-modal-dialog-mask").hide();});$("#"+id).find(".luckysheet-model-save-btn").click(function(){if(typeof closefunc2=='function'){closefunc2();}$("#"+id).hide();$("#luckysheet-modal-dialog-mask").hide();});},sheetConfig:function sheetConfig(){},hoverTipshowState:false,hoverTipshowTimeOut:null,createHoverTip:function createHoverTip(obj,to){$(obj).on("mouseover",to,function(e){if(luckysheet.tooltip.hoverTipshowState){return;}clearTimeout(luckysheet.tooltip.hoverTipshowTimeOut);luckysheet.tooltip.hoverTipshowTimeOut=setTimeout(function(){var $t=$(e.currentTarget),toffset=$t.offset(),$toolup=$("#luckysheet-tooltip-up");var tips=$t.data("tips");if(tips==null||tips.length==0){tips=$t.prev().data("tips");if(tips==null||tips.length==0){return;}}if($toolup.length==0){$("body").append(luckysheetToolHTML);$toolup=$("#luckysheet-tooltip-up");}$toolup.removeClass("jfk-tooltip-hide").find("div.jfk-tooltip-contentId").html(tips);var toolwidth=$toolup.outerWidth();$toolup.find("div.jfk-tooltip-arrow").css("left",toolwidth/2);var toolleft=toffset.left+($t.outerWidth()-toolwidth)/2;if(toolleft<2){toolleft=2;$toolup.find("div.jfk-tooltip-arrow").css("left",$t.outerWidth()/2);}$toolup.css({"top":toffset.top+$t.outerHeight()+1,"left":toolleft});},300);}).on("mouseout",to,function(e){luckysheet.tooltip.hoverTipshowState=false;clearTimeout(luckysheet.tooltip.hoverTipshowTimeOut);$("#luckysheet-tooltip-up").addClass("jfk-tooltip-hide");}).on("click",to,function(e){luckysheet.tooltip.hoverTipshowState=true;clearTimeout(luckysheet.tooltip.hoverTipshowTimeOut);$("#luckysheet-tooltip-up").addClass("jfk-tooltip-hide");});},popover:function popover(content,position,close,style,btntxt,exitsFuc){if(btntxt==null){btntxt="关闭";}var htmldiv='<div id="luckysheetpopover" class="luckysheetpopover"><div class="luckysheetpopover-content">格式刷开启</div><div class="luckysheetpopover-btn">'+btntxt+'</div></div>';$("#luckysheetpopover").remove();$("body").append(htmldiv);//var winW = $(window).width(),winH = $(window).height();
  $("#luckysheetpopover .luckysheetpopover-content").html(content);var w=$("#luckysheetpopover").outerWidth(),h=$("#luckysheetpopover").outerHeight();var pcss={};if(position=='topLeft'){pcss.top="20px";pcss.left="20px";}else if(position=='topCenter'){pcss.top="20px";pcss.left="50%";pcss["margin-left"]=-w/2;}else if(position=='topRight'){pcss.top="20px";pcss.right="20px";}else if(position=='midLeft'){pcss.top="50%";pcss["margin-top"]=-h/2;pcss.left="20px";}else if(position=='center'){pcss.top="50%";pcss["margin-top"]=-h/2;pcss.left="50%";pcss["margin-left"]=-w/2;}else if(position=='midRight'){pcss.top="50%";pcss["margin-top"]=-h/2;pcss.right="20px";}else if(position=='bottomLeft'){pcss.bottom="20px";pcss.left="20px";}else if(position=='bottomCenter'){pcss.bottom="20px";pcss.left="50%";pcss["margin-left"]=-w/2;}else if(position=='bottomRight'){pcss.bottom="20px";pcss.right="20px";}else {pcss.top="20px";pcss.left="50%";pcss["margin-left"]=-w/2;}if(style=="white"){pcss.background="rgba(255,255,255,0.65)";pcss.color="#000";$("#luckysheetpopover .luckysheetpopover-btn").css({"border":"1px solid #000"});}setTimeout(function(){$("#luckysheetpopover .luckysheetpopover-content").css({"margin-left":-$("#luckysheetpopover .luckysheetpopover-btn").outerWidth()/2});},1);$("#luckysheetpopover").css(pcss).fadeIn();$("#luckysheetpopover .luckysheetpopover-btn").click(function(){if(typeof exitsFuc=="function"){exitsFuc();}});if(close!=null&&typeof close=="number"){setTimeout(function(){$("#luckysheetpopover").fadeOut().remove();if(typeof exitsFuc=="function"){exitsFuc();}},close);}}};luckysheet.mask=function(){var SSF={};var make_ssf=function make_ssf(SSF){SSF.version='0.10.2';function _strrev(x){var o="",i=x.length-1;while(i>=0){o+=x.charAt(i--);}return o;}function fill(c,l){var o="";while(o.length<l){o+=c;}return o;}function pad0(v,d){var t=""+v;return t.length>=d?t:fill('0',d-t.length)+t;}function pad_(v,d){var t=""+v;return t.length>=d?t:fill(' ',d-t.length)+t;}function rpad_(v,d){var t=""+v;return t.length>=d?t:t+fill(' ',d-t.length);}function pad0r1(v,d){var t=""+Math.round(v);return t.length>=d?t:fill('0',d-t.length)+t;}function pad0r2(v,d){var t=""+v;return t.length>=d?t:fill('0',d-t.length)+t;}var p2_32=Math.pow(2,32);function pad0r(v,d){if(v>p2_32||v<-p2_32)return pad0r1(v,d);var i=Math.round(v);return pad0r2(i,d);}function isgeneral(s,i){i=i||0;return s.length>=7+i&&(s.charCodeAt(i)|32)===103&&(s.charCodeAt(i+1)|32)===101&&(s.charCodeAt(i+2)|32)===110&&(s.charCodeAt(i+3)|32)===101&&(s.charCodeAt(i+4)|32)===114&&(s.charCodeAt(i+5)|32)===97&&(s.charCodeAt(i+6)|32)===108;}var days=[['Sun','Sunday'],['Mon','Monday'],['Tue','Tuesday'],['Wed','Wednesday'],['Thu','Thursday'],['Fri','Friday'],['Sat','Saturday']];var months=[['J','Jan','January'],['F','Feb','February'],['M','Mar','March'],['A','Apr','April'],['M','May','May'],['J','Jun','June'],['J','Jul','July'],['A','Aug','August'],['S','Sep','September'],['O','Oct','October'],['N','Nov','November'],['D','Dec','December']];function init_table(t){t[0]='General';t[1]='0';t[2]='0.00';t[3]='#,##0';t[4]='#,##0.00';t[9]='0%';t[10]='0.00%';t[11]='0.00E+00';t[12]='# ?/?';t[13]='# ??/??';t[14]='m/d/yy';t[15]='d-mmm-yy';t[16]='d-mmm';t[17]='mmm-yy';t[18]='h:mm AM/PM';t[19]='h:mm:ss AM/PM';t[20]='h:mm';t[21]='h:mm:ss';t[22]='m/d/yy h:mm';t[37]='#,##0 ;(#,##0)';t[38]='#,##0 ;[Red](#,##0)';t[39]='#,##0.00;(#,##0.00)';t[40]='#,##0.00;[Red](#,##0.00)';t[45]='mm:ss';t[46]='[h]:mm:ss';t[47]='mmss.0';t[48]='##0.0E+0';t[49]='@';t[56]='"上午/下午 "hh"時"mm"分"ss"秒 "';t[65535]='General';}var table_fmt={};init_table(table_fmt);function frac(x,D,mixed){var sgn=x<0?-1:1;var B=x*sgn;var P_2=0,P_1=1,P=0;var Q_2=1,Q_1=0,Q=0;var A=Math.floor(B);while(Q_1<D){A=Math.floor(B);P=A*P_1+P_2;Q=A*Q_1+Q_2;if(B-A<0.00000005)break;B=1/(B-A);P_2=P_1;P_1=P;Q_2=Q_1;Q_1=Q;}if(Q>D){if(Q_1>D){Q=Q_2;P=P_2;}else {Q=Q_1;P=P_1;}}if(!mixed)return [0,sgn*P,Q];var q=Math.floor(sgn*P/Q);return [q,sgn*P-q*Q,Q];}function parse_date_code(v,opts,b2){if(v>2958465||v<0)return null;var date=v|0,time=Math.floor(86400*(v-date)),dow=0;var dout=[];var out={D:date,T:time,u:86400*(v-date)-time,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(out.u)<1e-6)out.u=0;if(opts&&opts.date1904)date+=1462;if(out.u>0.9999){out.u=0;if(++time==86400){out.T=time=0;++date;++out.D;}}if(date===60){dout=b2?[1317,10,29]:[1900,2,29];dow=3;}else if(date===0){dout=b2?[1317,8,29]:[1900,1,0];dow=6;}else {if(date>60)--date;/* 1 = Jan 1 1900 in Gregorian */var d=new Date(1900,0,1);d.setDate(d.getDate()+date-1);dout=[d.getFullYear(),d.getMonth()+1,d.getDate()];dow=d.getDay();if(date<60)dow=(dow+6)%7;if(b2)dow=fix_hijri();}out.y=dout[0];out.m=dout[1];out.d=dout[2];out.S=time%60;time=Math.floor(time/60);out.M=time%60;time=Math.floor(time/60);out.H=time;out.q=dow;return out;}SSF.parse_date_code=parse_date_code;var basedate=new Date(1899,11,31,0,0,0);var dnthresh=basedate.getTime();var base1904=new Date(1900,2,1,0,0,0);function datenum_local(v,date1904){var epoch=v.getTime();if(date1904)epoch-=1461*24*60*60*1000;else if(v>=base1904)epoch+=24*60*60*1000;return (epoch-(dnthresh+(v.getTimezoneOffset()-basedate.getTimezoneOffset())*60000))/(24*60*60*1000);}function general_fmt_int(v){return v.toString(10);}SSF._general_int=general_fmt_int;var general_fmt_num=function make_general_fmt_num(){var gnr1=/\.(\d*[1-9])0+$/,gnr2=/\.0*$/,gnr4=/\.(\d*[1-9])0+/,gnr5=/\.0*[Ee]/,gnr6=/(E[+-])(\d)$/;function gfn2(v){var w=v<0?12:11;var o=gfn5(v.toFixed(12));if(o.length<=w)return o;o=v.toPrecision(10);if(o.length<=w)return o;return v.toExponential(5);}function gfn3(v){var o=v.toFixed(11).replace(gnr1,".$1");if(o.length>(v<0?12:11))o=v.toPrecision(6);return o;}function gfn4(o){for(var i=0;i!=o.length;++i){if((o.charCodeAt(i)|0x20)===101)return o.replace(gnr4,".$1").replace(gnr5,"E").replace("e","E").replace(gnr6,"$10$2");}return o;}function gfn5(o){return o.indexOf(".")>-1?o.replace(gnr2,"").replace(gnr1,".$1"):o;}return function general_fmt_num(v){var V=Math.floor(Math.log(Math.abs(v))*Math.LOG10E),o;if(V>=-4&&V<=-1)o=v.toPrecision(10+V);else if(Math.abs(V)<=9)o=gfn2(v);else if(V===10)o=v.toFixed(10).substr(0,12);else o=gfn3(v);return gfn5(gfn4(o));};}();SSF._general_num=general_fmt_num;function general_fmt(v,opts){switch(_typeof(v)){case'string':return v;case'boolean':return v?"TRUE":"FALSE";case'number':return (v|0)===v?general_fmt_int(v):general_fmt_num(v);case'undefined':return "";case'object':if(v==null)return "";if(v instanceof Date)return format(14,datenum_local(v,opts&&opts.date1904),opts);}throw new Error("unsupported value in General format: "+v);}SSF._general=general_fmt;function fix_hijri(){return 0;}/*jshint -W086 */function write_date(type,fmt,val,ss0){var o="",ss=0,tt=0,y=val.y,out,outl=0;switch(type){case 98:/* 'b' buddhist year */y=val.y+543;/* falls through */case 121:/* 'y' year */switch(fmt.length){case 1:case 2:out=y%100;outl=2;break;default:out=y%10000;outl=4;break;}break;case 109:/* 'm' month */switch(fmt.length){case 1:case 2:out=val.m;outl=fmt.length;break;case 3:return months[val.m-1][1];case 5:return months[val.m-1][0];default:return months[val.m-1][2];}break;case 100:/* 'd' day */switch(fmt.length){case 1:case 2:out=val.d;outl=fmt.length;break;case 3:return days[val.q][0];default:return days[val.q][1];}break;case 104:/* 'h' 12-hour */switch(fmt.length){case 1:case 2:out=1+(val.H+11)%12;outl=fmt.length;break;default:throw 'bad hour format: '+fmt;}break;case 72:/* 'H' 24-hour */switch(fmt.length){case 1:case 2:out=val.H;outl=fmt.length;break;default:throw 'bad hour format: '+fmt;}break;case 77:/* 'M' minutes */switch(fmt.length){case 1:case 2:out=val.M;outl=fmt.length;break;default:throw 'bad minute format: '+fmt;}break;case 115:/* 's' seconds */if(fmt!='s'&&fmt!='ss'&&fmt!='.0'&&fmt!='.00'&&fmt!='.000')throw 'bad second format: '+fmt;if(val.u===0&&(fmt=="s"||fmt=="ss"))return pad0(val.S,fmt.length);if(ss0>=2)tt=ss0===3?1000:100;else tt=ss0===1?10:1;ss=Math.round(tt*(val.S+val.u));if(ss>=60*tt)ss=0;if(fmt==='s')return ss===0?"0":""+ss/tt;o=pad0(ss,2+ss0);if(fmt==='ss')return o.substr(0,2);return "."+o.substr(2,fmt.length-1);case 90:/* 'Z' absolute time */switch(fmt){case'[h]':case'[hh]':out=val.D*24+val.H;break;case'[m]':case'[mm]':out=(val.D*24+val.H)*60+val.M;break;case'[s]':case'[ss]':out=((val.D*24+val.H)*60+val.M)*60+Math.round(val.S+val.u);break;default:throw 'bad abstime format: '+fmt;}outl=fmt.length===3?1:2;break;case 101:/* 'e' era */out=y;outl=1;}if(outl>0)return pad0(out,outl);else return "";}/*jshint +W086 */function commaify(s){var w=3;if(s.length<=w)return s;var j=s.length%w,o=s.substr(0,j);for(;j!=s.length;j+=w){o+=(o.length>0?",":"")+s.substr(j,w);}return o;}var write_num=function make_write_num(){var pct1=/%/g;function write_num_pct(type,fmt,val){var sfmt=fmt.replace(pct1,""),mul=fmt.length-sfmt.length;return write_num(type,sfmt,val*Math.pow(10,2*mul))+fill("%",mul);}function write_num_cm(type,fmt,val){var idx=fmt.length-1;while(fmt.charCodeAt(idx-1)===44){--idx;}return write_num(type,fmt.substr(0,idx),val/Math.pow(10,3*(fmt.length-idx)));}function write_num_exp(fmt,val){var o;var idx=fmt.indexOf("E")-fmt.indexOf(".")-1;if(fmt.match(/^#+0.0E\+0$/)){if(val==0)return "0.0E+0";else if(val<0)return "-"+write_num_exp(fmt,-val);var period=fmt.indexOf(".");if(period===-1)period=fmt.indexOf('E');var ee=Math.floor(Math.log(val)*Math.LOG10E)%period;if(ee<0)ee+=period;o=(val/Math.pow(10,ee)).toPrecision(idx+1+(period+ee)%period);if(o.indexOf("e")===-1){var fakee=Math.floor(Math.log(val)*Math.LOG10E);if(o.indexOf(".")===-1)o=o.charAt(0)+"."+o.substr(1)+"E+"+(fakee-o.length+ee);else o+="E+"+(fakee-ee);while(o.substr(0,2)==="0."){o=o.charAt(0)+o.substr(2,period)+"."+o.substr(2+period);o=o.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");}o=o.replace(/\+-/,"-");}o=o.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function($$,$1,$2,$3){return $1+$2+$3.substr(0,(period+ee)%period)+"."+$3.substr(ee)+"E";});}else o=val.toExponential(idx);if(fmt.match(/E\+00$/)&&o.match(/e[+-]\d$/))o=o.substr(0,o.length-1)+"0"+o.charAt(o.length-1);if(fmt.match(/E\-/)&&o.match(/e\+/))o=o.replace(/e\+/,"e");return o.replace("e","E");}var frac1=/# (\?+)( ?)\/( ?)(\d+)/;function write_num_f1(r,aval,sign){var den=parseInt(r[4],10),rr=Math.round(aval*den),base=Math.floor(rr/den);var myn=rr-base*den,myd=den;return sign+(base===0?"":""+base)+" "+(myn===0?fill(" ",r[1].length+1+r[4].length):pad_(myn,r[1].length)+r[2]+"/"+r[3]+pad0(myd,r[4].length));}function write_num_f2(r,aval,sign){return sign+(aval===0?"":""+aval)+fill(" ",r[1].length+2+r[4].length);}var dec1=/^#*0*\.([0#]+)/;var closeparen=/\).*[0#]/;var phone=/\(###\) ###\\?-####/;function hashq(str){var o="",cc;for(var i=0;i!=str.length;++i){switch(cc=str.charCodeAt(i)){case 35:break;case 63:o+=" ";break;case 48:o+="0";break;default:o+=String.fromCharCode(cc);}}return o;}function rnd(val,d){var dd=Math.pow(10,d);return ""+Math.round(val*dd)/dd;}function dec(val,d){if(d<(''+Math.round((val-Math.floor(val))*Math.pow(10,d))).length){return 0;}return Math.round((val-Math.floor(val))*Math.pow(10,d));}function carry(val,d){if(d<(''+Math.round((val-Math.floor(val))*Math.pow(10,d))).length){return 1;}return 0;}function flr(val){if(val<2147483647&&val>-2147483648)return ""+(val>=0?val|0:val-1|0);return ""+Math.floor(val);}function write_num_flt(type,fmt,val){if(type.charCodeAt(0)===40&&!fmt.match(closeparen)){var ffmt=fmt.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");if(val>=0)return write_num_flt('n',ffmt,val);return '('+write_num_flt('n',ffmt,-val)+')';}if(fmt.charCodeAt(fmt.length-1)===44)return write_num_cm(type,fmt,val);if(fmt.indexOf('%')!==-1)return write_num_pct(type,fmt,val);if(fmt.indexOf('E')!==-1)return write_num_exp(fmt,val);if(fmt.charCodeAt(0)===36)return "$"+write_num_flt(type,fmt.substr(fmt.charAt(1)==' '?2:1),val);var o;var r,ri,ff,aval=Math.abs(val),sign=val<0?"-":"";if(fmt.match(/^00+$/))return sign+pad0r(aval,fmt.length);if(fmt.match(/^[#?]+$/)){o=pad0r(val,0);if(o==="0")o="";return o.length>fmt.length?o:hashq(fmt.substr(0,fmt.length-o.length))+o;}if(r=fmt.match(frac1))return write_num_f1(r,aval,sign);if(fmt.match(/^#+0+$/))return sign+pad0r(aval,fmt.length-fmt.indexOf("0"));if(r=fmt.match(dec1)){o=rnd(val,r[1].length).replace(/^([^\.]+)$/,"$1."+hashq(r[1])).replace(/\.$/,"."+hashq(r[1])).replace(/\.(\d*)$/,function($$,$1){return "."+$1+fill("0",hashq(r[1]).length-$1.length);});return fmt.indexOf("0.")!==-1?o:o.replace(/^0\./,".");}fmt=fmt.replace(/^#+([0.])/,"$1");if(r=fmt.match(/^(0*)\.(#*)$/)){return sign+rnd(aval,r[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,r[1].length?"0.":".");}if(r=fmt.match(/^#{1,3},##0(\.?)$/))return sign+commaify(pad0r(aval,0));if(r=fmt.match(/^#,##0\.([#0]*0)$/)){return val<0?"-"+write_num_flt(type,fmt,-val):commaify(""+(Math.floor(val)+carry(val,r[1].length)))+"."+pad0(dec(val,r[1].length),r[1].length);}if(r=fmt.match(/^#,#*,#0/))return write_num_flt(type,fmt.replace(/^#,#*,/,""),val);if(r=fmt.match(/^([0#]+)(\\?-([0#]+))+$/)){o=_strrev(write_num_flt(type,fmt.replace(/[\\-]/g,""),val));ri=0;return _strrev(_strrev(fmt.replace(/\\/g,"")).replace(/[0#]/g,function(x){return ri<o.length?o.charAt(ri++):x==='0'?'0':"";}));}if(fmt.match(phone)){o=write_num_flt(type,"##########",val);return "("+o.substr(0,3)+") "+o.substr(3,3)+"-"+o.substr(6);}var oa="";if(r=fmt.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/)){ri=Math.min(r[4].length,7);ff=frac(aval,Math.pow(10,ri)-1,false);o=""+sign;oa=write_num("n",r[1],ff[1]);if(oa.charAt(oa.length-1)==" ")oa=oa.substr(0,oa.length-1)+"0";o+=oa+r[2]+"/"+r[3];oa=rpad_(ff[2],ri);if(oa.length<r[4].length)oa=hashq(r[4].substr(r[4].length-oa.length))+oa;o+=oa;return o;}if(r=fmt.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/)){ri=Math.min(Math.max(r[1].length,r[4].length),7);ff=frac(aval,Math.pow(10,ri)-1,true);return sign+(ff[0]||(ff[1]?"":"0"))+" "+(ff[1]?pad_(ff[1],ri)+r[2]+"/"+r[3]+rpad_(ff[2],ri):fill(" ",2*ri+1+r[2].length+r[3].length));}if(r=fmt.match(/^[#0?]+$/)){o=pad0r(val,0);if(fmt.length<=o.length)return o;return hashq(fmt.substr(0,fmt.length-o.length))+o;}if(r=fmt.match(/^([#0?]+)\.([#0]+)$/)){o=""+val.toFixed(Math.min(r[2].length,10)).replace(/([^0])0+$/,"$1");ri=o.indexOf(".");var lres=fmt.indexOf(".")-ri,rres=fmt.length-o.length-lres;return hashq(fmt.substr(0,lres)+o+fmt.substr(fmt.length-rres));}if(r=fmt.match(/^00,000\.([#0]*0)$/)){ri=dec(val,r[1].length);return val<0?"-"+write_num_flt(type,fmt,-val):commaify(flr(val)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function($$){return "00,"+($$.length<3?pad0(0,3-$$.length):"")+$$;})+"."+pad0(ri,r[1].length);}switch(fmt){case"###,##0.00":return write_num_flt(type,"#,##0.00",val);case"###,###":case"##,###":case"#,###":var x=commaify(pad0r(aval,0));return x!=="0"?sign+x:"";case"###,###.00":return write_num_flt(type,"###,##0.00",val).replace(/^0\./,".");case"#,###.00":return write_num_flt(type,"#,##0.00",val).replace(/^0\./,".");}throw new Error("unsupported format |"+fmt+"|");}function write_num_cm2(type,fmt,val){var idx=fmt.length-1;while(fmt.charCodeAt(idx-1)===44){--idx;}return write_num(type,fmt.substr(0,idx),val/Math.pow(10,3*(fmt.length-idx)));}function write_num_pct2(type,fmt,val){var sfmt=fmt.replace(pct1,""),mul=fmt.length-sfmt.length;return write_num(type,sfmt,val*Math.pow(10,2*mul))+fill("%",mul);}function write_num_exp2(fmt,val){var o;var idx=fmt.indexOf("E")-fmt.indexOf(".")-1;if(fmt.match(/^#+0.0E\+0$/)){if(val==0)return "0.0E+0";else if(val<0)return "-"+write_num_exp2(fmt,-val);var period=fmt.indexOf(".");if(period===-1)period=fmt.indexOf('E');var ee=Math.floor(Math.log(val)*Math.LOG10E)%period;if(ee<0)ee+=period;o=(val/Math.pow(10,ee)).toPrecision(idx+1+(period+ee)%period);if(!o.match(/[Ee]/)){var fakee=Math.floor(Math.log(val)*Math.LOG10E);if(o.indexOf(".")===-1)o=o.charAt(0)+"."+o.substr(1)+"E+"+(fakee-o.length+ee);else o+="E+"+(fakee-ee);o=o.replace(/\+-/,"-");}o=o.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function($$,$1,$2,$3){return $1+$2+$3.substr(0,(period+ee)%period)+"."+$3.substr(ee)+"E";});}else o=val.toExponential(idx);if(fmt.match(/E\+00$/)&&o.match(/e[+-]\d$/))o=o.substr(0,o.length-1)+"0"+o.charAt(o.length-1);if(fmt.match(/E\-/)&&o.match(/e\+/))o=o.replace(/e\+/,"e");return o.replace("e","E");}function write_num_int(type,fmt,val){if(type.charCodeAt(0)===40&&!fmt.match(closeparen)){var ffmt=fmt.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");if(val>=0)return write_num_int('n',ffmt,val);return '('+write_num_int('n',ffmt,-val)+')';}if(fmt.charCodeAt(fmt.length-1)===44)return write_num_cm2(type,fmt,val);if(fmt.indexOf('%')!==-1)return write_num_pct2(type,fmt,val);if(fmt.indexOf('E')!==-1)return write_num_exp2(fmt,val);if(fmt.charCodeAt(0)===36)return "$"+write_num_int(type,fmt.substr(fmt.charAt(1)==' '?2:1),val);var o;var r,ri,ff,aval=Math.abs(val),sign=val<0?"-":"";if(fmt.match(/^00+$/))return sign+pad0(aval,fmt.length);if(fmt.match(/^[#?]+$/)){o=""+val;if(val===0)o="";return o.length>fmt.length?o:hashq(fmt.substr(0,fmt.length-o.length))+o;}if(r=fmt.match(frac1))return write_num_f2(r,aval,sign);if(fmt.match(/^#+0+$/))return sign+pad0(aval,fmt.length-fmt.indexOf("0"));if(r=fmt.match(dec1)){o=(""+val).replace(/^([^\.]+)$/,"$1."+hashq(r[1])).replace(/\.$/,"."+hashq(r[1]));o=o.replace(/\.(\d*)$/,function($$,$1){return "."+$1+fill("0",hashq(r[1]).length-$1.length);});return fmt.indexOf("0.")!==-1?o:o.replace(/^0\./,".");}fmt=fmt.replace(/^#+([0.])/,"$1");if(r=fmt.match(/^(0*)\.(#*)$/)){return sign+(""+aval).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,r[1].length?"0.":".");}if(r=fmt.match(/^#{1,3},##0(\.?)$/))return sign+commaify(""+aval);if(r=fmt.match(/^#,##0\.([#0]*0)$/)){return val<0?"-"+write_num_int(type,fmt,-val):commaify(""+val)+"."+fill('0',r[1].length);}if(r=fmt.match(/^#,#*,#0/))return write_num_int(type,fmt.replace(/^#,#*,/,""),val);if(r=fmt.match(/^([0#]+)(\\?-([0#]+))+$/)){o=_strrev(write_num_int(type,fmt.replace(/[\\-]/g,""),val));ri=0;return _strrev(_strrev(fmt.replace(/\\/g,"")).replace(/[0#]/g,function(x){return ri<o.length?o.charAt(ri++):x==='0'?'0':"";}));}if(fmt.match(phone)){o=write_num_int(type,"##########",val);return "("+o.substr(0,3)+") "+o.substr(3,3)+"-"+o.substr(6);}var oa="";if(r=fmt.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/)){ri=Math.min(r[4].length,7);ff=frac(aval,Math.pow(10,ri)-1,false);o=""+sign;oa=write_num("n",r[1],ff[1]);if(oa.charAt(oa.length-1)==" ")oa=oa.substr(0,oa.length-1)+"0";o+=oa+r[2]+"/"+r[3];oa=rpad_(ff[2],ri);if(oa.length<r[4].length)oa=hashq(r[4].substr(r[4].length-oa.length))+oa;o+=oa;return o;}if(r=fmt.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/)){ri=Math.min(Math.max(r[1].length,r[4].length),7);ff=frac(aval,Math.pow(10,ri)-1,true);return sign+(ff[0]||(ff[1]?"":"0"))+" "+(ff[1]?pad_(ff[1],ri)+r[2]+"/"+r[3]+rpad_(ff[2],ri):fill(" ",2*ri+1+r[2].length+r[3].length));}if(r=fmt.match(/^[#0?]+$/)){o=""+val;if(fmt.length<=o.length)return o;return hashq(fmt.substr(0,fmt.length-o.length))+o;}if(r=fmt.match(/^([#0]+)\.([#0]+)$/)){o=""+val.toFixed(Math.min(r[2].length,10)).replace(/([^0])0+$/,"$1");ri=o.indexOf(".");var lres=fmt.indexOf(".")-ri,rres=fmt.length-o.length-lres;return hashq(fmt.substr(0,lres)+o+fmt.substr(fmt.length-rres));}if(r=fmt.match(/^00,000\.([#0]*0)$/)){return val<0?"-"+write_num_int(type,fmt,-val):commaify(""+val).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function($$){return "00,"+($$.length<3?pad0(0,3-$$.length):"")+$$;})+"."+pad0(0,r[1].length);}switch(fmt){case"###,###":case"##,###":case"#,###":var x=commaify(""+aval);return x!=="0"?sign+x:"";default:if(fmt.match(/\.[0#?]*$/))return write_num_int(type,fmt.slice(0,fmt.lastIndexOf(".")),val)+hashq(fmt.slice(fmt.lastIndexOf(".")));}throw new Error("unsupported format |"+fmt+"|");}return function write_num(type,fmt,val){return (val|0)===val?write_num_int(type,fmt,val):write_num_flt(type,fmt,val);};}();function split_fmt(fmt){var out=[];var in_str=false/*, cc*/;for(var i=0,j=0;i<fmt.length;++i){switch(/*cc=*/fmt.charCodeAt(i)){case 34:/* '"' */in_str=!in_str;break;case 95:case 42:case 92:/* '_' '*' '\\' */++i;break;case 59:/* ';' */out[out.length]=fmt.substr(j,i-j);j=i+1;}}out[out.length]=fmt.substr(j);if(in_str===true)throw new Error("Format |"+fmt+"| unterminated string ");return out;}SSF._split=split_fmt;var abstime=/\[[HhMmSs]*\]/;function fmt_is_date(fmt){var i=0,/*cc = 0,*/c="",o="";while(i<fmt.length){switch(c=fmt.charAt(i)){case'G':if(isgeneral(fmt,i))i+=6;i++;break;case'"':for(;/*cc=*/fmt.charCodeAt(++i)!==34&&i<fmt.length;){++i;}++i;break;case'\\':i+=2;break;case'_':i+=2;break;case'@':++i;break;case'B':case'b':if(fmt.charAt(i+1)==="1"||fmt.charAt(i+1)==="2")return true;/* falls through */case'M':case'D':case'Y':case'H':case'S':case'E':/* falls through */case'm':case'd':case'y':case'h':case's':case'e':case'g':return true;case'A':case'a':if(fmt.substr(i,3).toUpperCase()==="A/P")return true;if(fmt.substr(i,5).toUpperCase()==="AM/PM")return true;++i;break;case'[':o=c;while(fmt.charAt(i++)!==']'&&i<fmt.length){o+=fmt.charAt(i);}if(o.match(abstime))return true;break;case'.':/* falls through */case'0':case'#':while(i<fmt.length&&("0#?.,E+-%".indexOf(c=fmt.charAt(++i))>-1||c=='\\'&&fmt.charAt(i+1)=="-"&&"0#".indexOf(fmt.charAt(i+2))>-1)){/* empty */}break;case'?':while(fmt.charAt(++i)===c){/* empty */}break;case'*':++i;if(fmt.charAt(i)==' '||fmt.charAt(i)=='*')++i;break;case'(':case')':++i;break;case'1':case'2':case'3':case'4':case'5':case'6':case'7':case'8':case'9':while(i<fmt.length&&"0123456789".indexOf(fmt.charAt(++i))>-1){/* empty */}break;case' ':++i;break;default:++i;break;}}return false;}SSF.is_date=fmt_is_date;function eval_fmt(fmt,v,opts,flen){var out=[],o="",i=0,c="",lst='t',dt,j,cc;var hr='H';/* Tokenize */while(i<fmt.length){switch(c=fmt.charAt(i)){case'G':/* General */if(!isgeneral(fmt,i))throw new Error('unrecognized character '+c+' in '+fmt);out[out.length]={t:'G',v:'General'};i+=7;break;case'"':/* Literal text */for(o="";(cc=fmt.charCodeAt(++i))!==34&&i<fmt.length;){o+=String.fromCharCode(cc);}out[out.length]={t:'t',v:o};++i;break;case'\\':var w=fmt.charAt(++i),t=w==="("||w===")"?w:'t';out[out.length]={t:t,v:w};++i;break;case'_':out[out.length]={t:'t',v:" "};i+=2;break;case'@':/* Text Placeholder */out[out.length]={t:'T',v:v};++i;break;case'B':case'b':if(fmt.charAt(i+1)==="1"||fmt.charAt(i+1)==="2"){if(dt==null){dt=parse_date_code(v,opts,fmt.charAt(i+1)==="2");if(dt==null)return "";}out[out.length]={t:'X',v:fmt.substr(i,2)};lst=c;i+=2;break;}/* falls through */case'M':case'D':case'Y':case'H':case'S':case'E':c=c.toLowerCase();/* falls through */case'm':case'd':case'y':case'h':case's':case'e':case'g':if(v<0)return "";if(dt==null){dt=parse_date_code(v,opts);if(dt==null)return "######";}o=c;while(++i<fmt.length&&fmt.charAt(i).toLowerCase()===c){o+=c;}if(c==='m'&&lst.toLowerCase()==='h')c='M';if(c==='h')c=hr;out[out.length]={t:c,v:o};lst=c;break;case'A':case'a':var q={t:c,v:c};if(dt==null)dt=parse_date_code(v,opts);if(fmt.substr(i,3).toUpperCase()==="A/P"){if(dt!=null)q.v=dt.H>=12?"P":"A";q.t='T';hr='h';i+=3;}else if(fmt.substr(i,5).toUpperCase()==="AM/PM"){if(dt!=null)q.v=dt.H>=12?"PM":"AM";q.t='T';i+=5;hr='h';}else {q.t="t";++i;}if(dt==null&&q.t==='T')return "";out[out.length]=q;lst=c;break;case'[':o=c;while(fmt.charAt(i++)!==']'&&i<fmt.length){o+=fmt.charAt(i);}if(o.slice(-1)!==']')throw 'unterminated "[" block: |'+o+'|';if(o.match(abstime)){if(dt==null){dt=parse_date_code(v,opts);if(dt==null)return "";}out[out.length]={t:'Z',v:o.toLowerCase()};lst=o.charAt(1);}else if(o.indexOf("$")>-1){o=(o.match(/\$([^-\[\]]*)/)||[])[1]||"$";if(!fmt_is_date(fmt))out[out.length]={t:'t',v:o};}break;/* Numbers */case'.':if(dt!=null){o=c;while(++i<fmt.length&&(c=fmt.charAt(i))==="0"){o+=c;}out[out.length]={t:'s',v:o};break;}/* falls through */case'0':case'#':o=c;while(++i<fmt.length&&"0#?.,E+-%".indexOf(c=fmt.charAt(i))>-1||c=='\\'&&fmt.charAt(i+1)=="-"&&i<fmt.length-2&&"0#".indexOf(fmt.charAt(i+2))>-1){o+=c;}out[out.length]={t:'n',v:o};break;case'?':o=c;while(fmt.charAt(++i)===c){o+=c;}out[out.length]={t:c,v:o};lst=c;break;case'*':++i;if(fmt.charAt(i)==' '||fmt.charAt(i)=='*')++i;break;// **
  case'(':case')':out[out.length]={t:flen===1?'t':c,v:c};++i;break;case'1':case'2':case'3':case'4':case'5':case'6':case'7':case'8':case'9':o=c;while(i<fmt.length&&"0123456789".indexOf(fmt.charAt(++i))>-1){o+=fmt.charAt(i);}out[out.length]={t:'D',v:o};break;case' ':out[out.length]={t:c,v:c};++i;break;default:// if ("¤฿BsBr₵₡₫ƒFtRs.₭kr£₤Lm₥₦₱PQRSkRp৲৳R$S/.〒₮₩¥NT￥zł₴₪៛руб€＄,$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(c) === -1) throw new Error('unrecognized character ' + c + ' in ' + fmt);
  if("¤฿BsBr₵₡₫ƒFtRs.₭kr£₤Lm₥₦₱PQRSkRp৲৳R$S/.〒₮₩¥NT￥zł₴₪៛руб€＄,$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP$￥LekdinAf$dhAflRial?￡BirrKzMOPPGKRsGsB/R$ррlevkrKMzBsPNuFBuKPkrRD$NfkCFA?CVEGMDFrCDHTGNAfLFdjKGSFGGHSRielKCFknKshLSLL￡LtRFRONArRfMWKRMMURsMROS/KMDLMTnRC$kr€GELCHFSLLSCRDbSZLSDGSOSSomFCFPTShT$VUVQUGXгрнsomWSTNT$FtDramRpZMWFCFA".indexOf(c)===-1)throw new Error('unrecognized character '+c+' in '+fmt);out[out.length]={t:'t',v:c};++i;break;}}var bt=0,ss0=0,ssm;for(i=out.length-1,lst='t';i>=0;--i){switch(out[i].t){case'h':case'H':out[i].t=hr;lst='h';if(bt<1)bt=1;break;case's':if(ssm=out[i].v.match(/\.0+$/))ss0=Math.max(ss0,ssm[0].length-1);if(bt<3)bt=3;/* falls through */case'd':case'y':case'M':case'e':lst=out[i].t;break;case'm':if(lst==='s'){out[i].t='M';if(bt<2)bt=2;}break;case'X':/*if(out[i].v === "B2");*/break;case'Z':if(bt<1&&out[i].v.match(/[Hh]/))bt=1;if(bt<2&&out[i].v.match(/[Mm]/))bt=2;if(bt<3&&out[i].v.match(/[Ss]/))bt=3;}}switch(bt){case 0:break;case 1:if(dt.u>=0.5){dt.u=0;++dt.S;}if(dt.S>=60){dt.S=0;++dt.M;}if(dt.M>=60){dt.M=0;++dt.H;}break;case 2:if(dt.u>=0.5){dt.u=0;++dt.S;}if(dt.S>=60){dt.S=0;++dt.M;}break;}/* replace fields */var nstr="",jj;for(i=0;i<out.length;++i){switch(out[i].t){case't':case'T':case' ':case'D':break;case'X':out[i].v="";out[i].t=";";break;case'd':case'm':case'y':case'h':case'H':case'M':case's':case'e':case'b':case'Z':out[i].v=write_date(out[i].t.charCodeAt(0),out[i].v,dt,ss0);out[i].t='t';break;case'n':case'(':case'?':jj=i+1;while(out[jj]!=null&&((c=out[jj].t)==="?"||c==="D"||(c===" "||c==="t")&&out[jj+1]!=null&&(out[jj+1].t==='?'||out[jj+1].t==="t"&&out[jj+1].v==='/')||out[i].t==='('&&(c===' '||c==='n'||c===')')||c==='t'&&(out[jj].v==='/'||out[jj].v===' '&&out[jj+1]!=null&&out[jj+1].t=='?'))){out[i].v+=out[jj].v;out[jj]={v:"",t:";"};++jj;}nstr+=out[i].v;i=jj-1;break;case'G':out[i].t='t';out[i].v=general_fmt(v,opts);break;}}var vv="",myv,ostr;if(nstr.length>0){if(nstr.charCodeAt(0)==40)/* '(' */{myv=v<0&&nstr.charCodeAt(0)===45?-v:v;ostr=write_num('(',nstr,myv);}else {myv=v<0&&flen>1?-v:v;ostr=write_num('n',nstr,myv);if(myv<0&&out[0]&&out[0].t=='t'){ostr=ostr.substr(1);out[0].v="-"+out[0].v;}}jj=ostr.length-1;var decpt=out.length;for(i=0;i<out.length;++i){if(out[i]!=null&&out[i].t!='t'&&out[i].v.indexOf(".")>-1){decpt=i;break;}}var lasti=out.length;if(decpt===out.length&&ostr.toUpperCase().indexOf("E")===-1){for(i=out.length-1;i>=0;--i){if(out[i]==null||'n?('.indexOf(out[i].t)===-1)continue;if(jj>=out[i].v.length-1){jj-=out[i].v.length;out[i].v=ostr.substr(jj+1,out[i].v.length);}else if(jj<0)out[i].v="";else {out[i].v=ostr.substr(0,jj+1);jj=-1;}out[i].t='t';lasti=i;}if(jj>=0&&lasti<out.length)out[lasti].v=ostr.substr(0,jj+1)+out[lasti].v;}else if(decpt!==out.length&&ostr.toUpperCase().indexOf("E")===-1){jj=ostr.indexOf(".")-1;for(i=decpt;i>=0;--i){if(out[i]==null||'n?('.indexOf(out[i].t)===-1)continue;j=out[i].v.indexOf(".")>-1&&i===decpt?out[i].v.indexOf(".")-1:out[i].v.length-1;vv=out[i].v.substr(j+1);for(;j>=0;--j){if(jj>=0&&(out[i].v.charAt(j)==="0"||out[i].v.charAt(j)==="#"))vv=ostr.charAt(jj--)+vv;}out[i].v=vv;out[i].t='t';lasti=i;}if(jj>=0&&lasti<out.length)out[lasti].v=ostr.substr(0,jj+1)+out[lasti].v;jj=ostr.indexOf(".")+1;for(i=decpt;i<out.length;++i){if(out[i]==null||'n?('.indexOf(out[i].t)===-1&&i!==decpt)continue;j=out[i].v.indexOf(".")>-1&&i===decpt?out[i].v.indexOf(".")+1:0;vv=out[i].v.substr(0,j);for(;j<out[i].v.length;++j){if(jj<ostr.length)vv+=ostr.charAt(jj++);}out[i].v=vv;out[i].t='t';lasti=i;}}}for(i=0;i<out.length;++i){if(out[i]!=null&&'n(?'.indexOf(out[i].t)>-1){myv=flen>1&&v<0&&i>0&&out[i-1].v==="-"?-v:v;out[i].v=write_num(out[i].t,out[i].v,myv);out[i].t='t';}}var retval="";for(i=0;i!==out.length;++i){if(out[i]!=null)retval+=out[i].v;}return retval;}SSF._eval=eval_fmt;var cfregex=/\[[=<>]/;var cfregex2=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function chkcond(v,rr){if(rr==null)return false;var thresh=parseFloat(rr[2]);switch(rr[1]){case"=":if(v==thresh)return true;break;case">":if(v>thresh)return true;break;case"<":if(v<thresh)return true;break;case"<>":if(v!=thresh)return true;break;case">=":if(v>=thresh)return true;break;case"<=":if(v<=thresh)return true;break;}return false;}function choose_fmt(f,v){var fmt=split_fmt(f);var l=fmt.length,lat=fmt[l-1].indexOf("@");if(l<4&&lat>-1)--l;if(fmt.length>4)throw new Error("cannot find right format for |"+fmt.join("|")+"|");if(typeof v!=="number")return [4,fmt.length===4||lat>-1?fmt[fmt.length-1]:"@"];switch(fmt.length){case 1:fmt=lat>-1?["General","General","General",fmt[0]]:[fmt[0],fmt[0],fmt[0],"@"];break;case 2:fmt=lat>-1?[fmt[0],fmt[0],fmt[0],fmt[1]]:[fmt[0],fmt[1],fmt[0],"@"];break;case 3:fmt=lat>-1?[fmt[0],fmt[1],fmt[0],fmt[2]]:[fmt[0],fmt[1],fmt[2],"@"];break;}var ff=v>0?fmt[0]:v<0?fmt[1]:fmt[2];if(fmt[0].indexOf("[")===-1&&fmt[1].indexOf("[")===-1)return [l,ff];if(fmt[0].match(cfregex)!=null||fmt[1].match(cfregex)!=null){var m1=fmt[0].match(cfregex2);var m2=fmt[1].match(cfregex2);return chkcond(v,m1)?[l,fmt[0]]:chkcond(v,m2)?[l,fmt[1]]:[l,fmt[m1!=null&&m2!=null?2:1]];}return [l,ff];}function format(fmt,v,o){if(o==null)o={};var sfmt="";switch(_typeof(fmt)){case"string":if(fmt=="m/d/yy"&&o.dateNF)sfmt=o.dateNF;else sfmt=fmt;break;case"number":if(fmt==14&&o.dateNF)sfmt=o.dateNF;else sfmt=(o.table!=null?o.table:table_fmt)[fmt];break;}//new runze 增加万 亿 格式  
  //注："w":2万2500  "w0":2万2500  "w0.0":2万2500.2  "w0.00":2万2500.23......自定义精确度
  var reg=/^(w|W)((0?)|(0\.0+))$/;if(!!sfmt.match(reg)){if(isNaN(v)){return v;}//var v =300101886.436;
  var acc=sfmt.slice(1);//取得0/0.0/0.00
  var isNegative=false;if(!isNaN(v)&&Number(v)<0){isNegative=true;v=Math.abs(v);}var vInt=parseInt(v);var vlength=vInt.toString().length;if(vlength>4){if(vlength>8){var y=parseInt(v/100000000);//亿
  var w=parseInt(luckysheet.floatTool.subtract(v,y*100000000)/10000);//万
  var q=luckysheet.floatTool.subtract(v,y*100000000+w*10000);//千以后
  if(acc!=""){q=numeral(q).format(acc);//处理精确度
  }v=y+"亿"+w+"万"+q;}else {var w=parseInt(v/10000);//万
  var q=luckysheet.floatTool.subtract(v,w*10000);//千以后
  if(acc!=""){q=numeral(q).format(acc);//处理精确度
  }v=w+"万"+q;}if(v.indexOf("亿0万0")!=-1){v=v.replace("0万0","");}else if(v.indexOf("亿0万")!=-1){v=v.replace("0万","");}else if(v.indexOf("万0")!=-1){v=v.replace("万0","万");}//舍弃正则后顾断言写法，旧浏览器不识别（360 V9）
  if(v.indexOf("亿")!=-1&&v.indexOf("万")==-1){//1亿/1亿111 => 1亿/1亿0111
  var afterYi=v.substring(v.indexOf("亿")+1);if(afterYi.substring(0,1)!=="."&&afterYi!=""){switch((parseInt(afterYi)+"").length){case 1:afterYi="000"+afterYi;break;case 2:afterYi="00"+afterYi;break;case 3:afterYi="0"+afterYi;break;}v=v.substring(0,v.indexOf("亿")+1)+afterYi;}}else if(v.indexOf("亿")==-1&&v.indexOf("万")!=-1){//3万0011
  var afterWan=v.substring(v.indexOf("万")+1);if(afterWan.substring(0,1)!=="."&&afterWan!=""){switch((parseInt(afterWan)+"").length){case 1:afterWan="000"+afterWan;break;case 2:afterWan="00"+afterWan;break;case 3:afterWan="0"+afterWan;break;}v=v.substring(0,v.indexOf("万")+1)+afterWan;}}else if(v.indexOf("亿")!=-1&&v.indexOf("万")!=-1){//1亿0053万0611
  var afterYi=v.substring(v.indexOf("亿")+1,v.indexOf("万")),afterWan=v.substring(v.indexOf("万")+1);switch((parseInt(afterYi)+"").length){case 1:afterYi="000"+afterYi;break;case 2:afterYi="00"+afterYi;break;case 3:afterYi="0"+afterYi;break;}v=v.substring(0,v.indexOf("亿")+1)+afterYi+v.substring(v.indexOf("万"));if(afterWan.substring(0,1)!=="."&&afterWan!=""){switch((parseInt(afterWan)+"").length){case 1:afterWan="000"+afterWan;break;case 2:afterWan="00"+afterWan;break;case 3:afterWan="0"+afterWan;break;}v=v.substring(0,v.indexOf("万")+1)+afterWan;}}}else {if(acc!=""){v=numeral(v).format(acc);//处理精确度
  }}if(isNegative){return '-'+v;}else {return v;}}if(isgeneral(sfmt,0))return general_fmt(v,o);if(v instanceof Date)v=datenum_local(v,o.date1904);var f=choose_fmt(sfmt,v);if(isgeneral(f[1]))return general_fmt(v,o);if(v===true)v="TRUE";else if(v===false)v="FALSE";else if(v===""||v==null)return "";return eval_fmt(f[1],v,o,f[0]);}function load_entry(fmt,idx){if(typeof idx!='number'){idx=+idx||-1;for(var i=0;i<0x0188;++i){if(table_fmt[i]==undefined){if(idx<0)idx=i;continue;}if(table_fmt[i]==fmt){idx=i;break;}}if(idx<0)idx=0x187;}table_fmt[idx]=fmt;return idx;}SSF.load=load_entry;SSF._table=table_fmt;SSF.get_table=function get_table(){return table_fmt;};SSF.load_table=function load_table(tbl){for(var i=0;i!=0x0188;++i){if(tbl[i]!==undefined)load_entry(tbl[i],i);}};SSF.init_table=init_table;SSF.format=format;};make_ssf(SSF);var XLMLFormatMap/*{[string]:string}*/={"General Number":"General","General Date":SSF._table[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":SSF._table[15],"Short Date":SSF._table[14],"Long Time":SSF._table[19],"Medium Time":SSF._table[18],"Short Time":SSF._table[20],"Currency":'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',"Fixed":SSF._table[2],"Standard":SSF._table[4],"Percent":SSF._table[10],"Scientific":SSF._table[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var unescapexml=function(){/* 22.4.2.4 bstr (Basic String) */var encregex=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/g,coderegex=/_x([\da-fA-F]{4})_/g;return function unescapexml(text){var s=text+'',i=s.indexOf("<![CDATA[");if(i==-1)return s.replace(encregex,function($$,$1){return encodings[$$]||String.fromCharCode(parseInt($1,$$.indexOf("x")>-1?16:10))||$$;}).replace(coderegex,function(m,c){return String.fromCharCode(parseInt(c,16));});var j=s.indexOf("]]>");return unescapexml(s.slice(0,i))+s.slice(i+9,j)+unescapexml(s.slice(j+3));};}();function xlml_format(format,value){var fmt=XLMLFormatMap[format]||unescapexml(format);if(fmt==="General")return SSF._general(value);return SSF.format(fmt,value);}luckysheet.xlml_format=xlml_format;luckysheet.SSF=SSF;var basedate=new Date(1899,11,31,0,0,0);var dnthresh=basedate.getTime();var base1904=new Date(1900,2,1,0,0,0);function datenum_local(v,date1904){var epoch=Date.UTC(v.getFullYear(),v.getMonth(),v.getDate(),v.getHours(),v.getMinutes(),v.getSeconds());var dnthresh_utc=Date.UTC(1899,11,31,0,0,0);if(date1904)epoch-=1461*24*60*60*1000;else if(v>=base1904)epoch+=24*60*60*1000;return (epoch-dnthresh_utc)/(24*60*60*1000);}var good_pd_date=new Date('2017-02-19T19:06:09.000Z');if(isNaN(good_pd_date.getFullYear()))good_pd_date=new Date('2/19/17');var good_pd=good_pd_date.getFullYear()==2017;/* parses a date as a local date */function parseDate(str,fixdate){var d=new Date(str);//console.log(d);
  if(good_pd){if(fixdate>0)d.setTime(d.getTime()+d.getTimezoneOffset()*60*1000);else if(fixdate<0)d.setTime(d.getTime()-d.getTimezoneOffset()*60*1000);return d;}if(str instanceof Date)return str;if(good_pd_date.getFullYear()==1917&&!isNaN(d.getFullYear())){var s=d.getFullYear();if(str.indexOf(""+s)>-1)return d;d.setFullYear(d.getFullYear()+100);return d;}var n=str.match(/\d+/g)||["2017","2","19","0","0","0"];var out=new Date(+n[0],+n[1]-1,+n[2],+n[3]||0,+n[4]||0,+n[5]||0);if(str.indexOf("Z")>-1)out=new Date(out.getTime()-out.getTimezoneOffset()*60*1000);return out;}luckysheet.parseDate=parseDate;/* TODO: stress test */function fuzzynum(s){var v=Number(s);if(typeof s=="number"){return s;}if(!isNaN(v))return v;var wt=1;var ss=s.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){wt*=100;return "";});if(!isNaN(v=Number(ss)))return v/wt;ss=ss.replace(/[(](.*)[)]/,function($$,$1){wt=-wt;return $1;});if(!isNaN(v=Number(ss)))return v/wt;return v;}luckysheet.fuzzynum=fuzzynum;function fuzzydate(s){var o=new Date(s),n=new Date(NaN);var y=o.getYear(),m=o.getMonth(),d=o.getDate();if(isNaN(d))return n;if(y<0||y>8099)return n;if((m>0||d>1)&&y!=101)return o;if(s.toLowerCase().match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/))return o;if(s.match(/[^-0-9:,\/\\]/))return n;return o;}luckysheet.fuzzydate=fuzzydate;return {//万 单位格式增加！！！
  genarate:function genarate(value){var m=null,ct={},v=value;if(value==null){return null;}if(value.toString().substr(0,1)==="'"){m=value.toString().substr(1);ct={"fa":"@","t":"s"};}else if(value.toString().toUpperCase()==="TRUE"){m="TRUE";ct={"fa":"General","t":"b"};v=true;}else if(value.toString().toUpperCase()==="FALSE"){m="FALSE";ct={"fa":"General","t":"b"};v=false;}else if(luckysheet.func_methods.valueIsError(value)){m=value.toString();ct={"fa":"General","t":"e"};}else if(/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(value)){m=value.toString();ct={"fa":"@","t":"s"};}else if(luckysheet.func_methods.isRealNum(value)&&Math.abs(parseFloat(value))>0&&(Math.abs(parseFloat(value))>=1e+11||Math.abs(parseFloat(value))<1e-9)){v=numeral(value).value();var str=v.toExponential();if(str.indexOf(".")>-1){var strlen=str.split(".")[1].split("e")[0].length;if(strlen>5){strlen=5;}ct={"fa":"#0."+new Array(strlen+1).join("0")+"E+00","t":"n"};}else {ct={"fa":"#0.E+00","t":"n"};}m=SSF.format(ct.fa,v);}else if(value.toString().indexOf("%")>-1){var index=value.toString().indexOf("%");var value2=value.toString().substr(0,index);var value3=value2.replace(/,/g,"");if(index==value.toString().length-1&&luckysheet.func_methods.isRealNum(value3)){if(value2.indexOf(".")>-1){if(value2.indexOf(".")==value2.lastIndexOf(".")){var value4=value2.split(".")[0];var value5=value2.split(".")[1];var len=value5.length;if(len>9){len=9;}if(value4.indexOf(",")>-1){var isThousands=true;var ThousandsArr=value4.split(",");for(var i=1;i<ThousandsArr.length;i++){if(ThousandsArr[i].length<3){isThousands=false;break;}}if(isThousands){ct={"fa":"#,##0."+new Array(len+1).join("0")+"%","t":"n"};v=numeral(value).value();m=SSF.format(ct.fa,v);}else {m=value.toString();ct={"fa":"@","t":"s"};}}else {ct={"fa":"0."+new Array(len+1).join("0")+"%","t":"n"};v=numeral(value).value();m=SSF.format(ct.fa,v);}}else {m=value.toString();ct={"fa":"@","t":"s"};}}else if(value2.indexOf(",")>-1){var isThousands=true;var ThousandsArr=value2.split(",");for(var i=1;i<ThousandsArr.length;i++){if(ThousandsArr[i].length<3){isThousands=false;break;}}if(isThousands){ct={"fa":"#,##0%","t":"n"};v=numeral(value).value();m=SSF.format(ct.fa,v);}else {m=value.toString();ct={"fa":"@","t":"s"};}}else {ct={"fa":"0%","t":"n"};v=numeral(value).value();m=SSF.format(ct.fa,v);}}else {m=value.toString();ct={"fa":"@","t":"s"};}}else if(value.toString().indexOf(".")>-1){if(value.toString().indexOf(".")==value.toString().lastIndexOf(".")){var value1=value.toString().split(".")[0];var value2=value.toString().split(".")[1];var len=value2.length;if(len>9){len=9;}if(value1.indexOf(",")>-1){var isThousands=true;var ThousandsArr=value1.split(",");for(var i=1;i<ThousandsArr.length;i++){if(!luckysheet.func_methods.isRealNum(ThousandsArr[i])||ThousandsArr[i].length<3){isThousands=false;break;}}if(isThousands){ct={"fa":"#,##0."+new Array(len+1).join("0"),"t":"n"};v=numeral(value).value();m=SSF.format(ct.fa,v);}else {m=value.toString();ct={"fa":"@","t":"s"};}}else {if(luckysheet.func_methods.isRealNum(value1)&&luckysheet.func_methods.isRealNum(value2)){ct={"fa":"0."+new Array(len+1).join("0"),"t":"n"};v=numeral(value).value();m=SSF.format(ct.fa,v);}else {m=value.toString();ct={"fa":"@","t":"s"};}}}else {m=value.toString();ct={"fa":"@","t":"s"};}}else if(luckysheet.func_methods.isRealNum(value)){m=value.toString();ct={"fa":"General","t":"n"};v=parseFloat(value);}else if(luckysheet.datecontroll.isdatetime(value)&&(value.toString().indexOf(".")>-1||value.toString().indexOf(":")>-1||value.toString().length<16)){v=datenum_local(parseDate(value.toString().replace(/-/g,"/")));if(v.toString().indexOf(".")>-1){if(value.toString().length>18){ct.fa="yyyy-MM-dd hh:mm:ss";}else if(value.toString().length>11){ct.fa="yyyy-MM-dd hh:mm";}else {ct.fa="yyyy-MM-dd";}}else {ct.fa="yyyy-MM-dd";}ct.t="d";m=SSF.format(ct.fa,v);}else {m=value;ct.fa="General";ct.t="g";}return [m,ct,v];},update:function update(fmt,v){return SSF.format(fmt,v);},is_date:function is_date(fmt,v){return SSF.is_date(fmt,v);},valueShowEs:function valueShowEs(r,c,d){var value=luckysheet.getcellvalue(r,c,d,"m");if(value==null){value=luckysheet.getcellvalue(r,c,d,"v");}else {if(!isNaN(fuzzynum(value))){if(typeof value=="string"&&value.indexOf("%")>-1);else {value=luckysheet.getcellvalue(r,c,d,"v");}}// else if (!isNaN(parseDate(value).getDate())){
  else if(d[r][c].ct!=null&&d[r][c].ct.t=="d");else if(d[r][c].ct!=null&&d[r][c].ct.t=="b");else {value=luckysheet.getcellvalue(r,c,d,"v");}}return value;}};}();luckysheet.pivotTable={pivotDatas:null,pivotSheetIndex:0,pivotDataSheetIndex:0,// getpivotdata:function(getid){
  //     for (var i = 0; i < this.pivotDatas;i++){
  //         if (this.pivotDatas[i].id == getid) {
  //             return this.pivotDatas[i];
  //         }
  //     }
  //     return null;
  // },
  // setpivotdata:function(data){
  //     pivotDatas.push(data);
  // },
  celldata:null,origindata:null,getCellData:function getCellData(cursheetindex,datasheetindex,data_select_save){var sheetIndex;if(cursheetindex!=null){sheetIndex=cursheetindex;}else {sheetIndex=luckysheet.currentSheetIndex;}var realIndex=luckysheet.sheetmanage.getSheetIndex(sheetIndex);if(luckysheet.getObjType(luckysheetfile[realIndex].pivotTable)!="object"){luckysheetfile[realIndex].pivotTable=eval('('+luckysheetfile[realIndex].pivotTable+')');}if(luckysheetfile[realIndex].pivotTable!=null){this.column=luckysheetfile[realIndex].pivotTable.column;this.row=luckysheetfile[realIndex].pivotTable.row;this.values=luckysheetfile[realIndex].pivotTable.values;this.filter=luckysheetfile[realIndex].pivotTable.filter;this.showType=luckysheetfile[realIndex].pivotTable.showType;this.filterparm=luckysheetfile[realIndex].pivotTable.filterparm;if(luckysheetfile[realIndex].pivotTable.drawPivotTable!=null){this.drawPivotTable=luckysheetfile[realIndex].pivotTable.drawPivotTable;}else {this.drawPivotTable=true;}if(luckysheetfile[realIndex].pivotTable.pivotTableBoundary!=null){this.pivotTableBoundary=luckysheetfile[realIndex].pivotTable.pivotTableBoundary;}else {this.pivotTableBoundary=[12,6];}if(data_select_save!=null){this.pivot_select_save=data_select_save;}else {this.pivot_select_save=luckysheetfile[realIndex].pivotTable.pivot_select_save;}if(datasheetindex!=null){this.pivotDataSheetIndex=datasheetindex;}else {this.pivotDataSheetIndex=luckysheetfile[realIndex].pivotTable.pivotDataSheetIndex;}}else {this.column=null;this.row=null;this.values=null;this.filter=null;this.showType=null;this.filterparm=null;this.drawPivotTable=true;this.pivotTableBoundary=[12,6];if(data_select_save!=null){this.pivot_select_save=data_select_save;}else {this.pivot_select_save=luckysheet_select_save;}if(datasheetindex!=null){this.pivotDataSheetIndex=datasheetindex;}else {this.pivotDataSheetIndex=sheetIndex;}}var pivotrealIndex=luckysheet.sheetmanage.getSheetIndex(this.pivotDataSheetIndex);var otherfile=luckysheetfile[pivotrealIndex];if(otherfile["data"]==null){otherfile["data"]=luckysheet.sheetmanage.buildGridData(otherfile);}this.origindata=luckysheet.getdatabyselectionD(otherfile.data,this.pivot_select_save);var rowhidden={};if(this.filterparm!=null){for(var f in this.filterparm){for(h in this.filterparm[f]){if(h.rowhidden!=null){rowhidden=$.extend(true,rowhidden,h.rowhidden);}}}}this.rowhidden=rowhidden;//this.pivot_select_save = $.extend(true, {}, this.pivot_select_save);
  this.pivotSheetIndex=sheetIndex;var newdata=[];for(var i=0;i<this.origindata.length;i++){if(this.rowhidden!=null&&this.rowhidden[i]!=null){continue;}newdata.push([].concat(this.origindata[i]));}this.celldata=newdata;this.pivot_data_type={};for(var c=0;c<this.celldata[1].length;c++){var type=luckysheet.isdatatype(this.celldata[1][c]);this.pivot_data_type[c.toString()]=type;}},pivot_data_type:{},pivot_select_save:null,column:null,row:null,values:null,filter:null,showType:null,rowhidden:null,selected:null,caljs:null,initial:true,filterparm:null,luckysheet_pivotTable_select_state:false,jgridCurrentPivotInput:null,movestate:false,moveitemposition:[],movesave:{},showvaluecolrow:function showvaluecolrow(){if($("#luckysheet-modal-dialog-config-value .luckysheet-modal-dialog-slider-config-item").length>=2){$("#luckysheetpivottablevaluecolrowshow").show();if(this.showType=="column"){$("#luckysheetpivottablevaluecolrow").prop("checked",true);$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow']").addClass("ui-state-active");$("#luckysheetpivottablevaluecolrow1").prop("checked",false);$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow1']").removeClass("ui-state-active");}else {$("#luckysheetpivottablevaluecolrow1").prop("checked",true);$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow1']").addClass("ui-state-active");$("#luckysheetpivottablevaluecolrow").prop("checked",false);$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow']").removeClass("ui-state-active");}}else {$("#luckysheetpivottablevaluecolrowshow").hide();}},resetOrderby:function resetOrderby(obj){var orderby=$("#luckysheet-modal-dialog-config-value .luckysheet-modal-dialog-slider-config-item").index(obj);$("#luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column").find(".luckysheet-modal-dialog-slider-config-item").each(function(){if($(this).data("orderby")==orderby){$(this).data("orderby","self");}});},luckysheetsliderlistclearfilter:function luckysheetsliderlistclearfilter($filter){var $t=$filter.parent();var cindex=$t.data("index");var rowhidden={},d=luckysheet.pivotTable.origindata;$t.data("rowhidden","").find(".luckysheet-slider-list-item-filtered").hide();luckysheet.pivotTable.setDatatojsfile("selected",{},cindex);luckysheet.pivotTable.setDatatojsfile("rowhidden",null,cindex);var newdata=[];for(var i=0;i<d.length;i++){if(rowhidden[i]!=null){continue;}newdata.push([].concat(d[i]));}luckysheet.pivotTable.celldata=newdata;luckysheet.pivotTable.refreshPivotTable();$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide();},luckysheetsliderlistitemfilter:function luckysheetsliderlistitemfilter($filter){var $t=$filter.parent(),toffset=$t.offset(),$menu=$("#luckysheet-pivotTableFilter-menu"),winH=$(window).height(),winW=$(window).width();var cindex=$t.data("index");var rowhidden=$t.data("rowhidden");if(rowhidden==null||rowhidden==""){rowhidden={};}else if(luckysheet.getObjType(rowhidden)=="string"){rowhidden=JSON.parse(rowhidden);}$("body .luckysheet-cols-menu").hide();$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide();$("#luckysheet-pivotTableFilter-byvalue-input").val("");$("#luckysheet-pivotTableFilter-bycondition").next().hide();$("#luckysheet-pivotTableFilter-byvalue").next().show();$menu.data("index",cindex);$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").hide().find("input").val();$("#luckysheet-pivotTableFilter-selected span").data("type","0").data("type",null).text("无");var byconditiontype=$t.data("byconditiontype");$("#luckysheet-pivotTableFilter-selected span").data("value",$t.data("byconditionvalue")).data("type",byconditiontype).text($t.data("byconditiontext"));if(byconditiontype=="2"){var $input=$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input2").show().find("input");$input.eq(0).val($t.data("byconditionvalue1"));$input.eq(1).val($t.data("byconditionvalue2"));}else if(byconditiontype=="1"){$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").eq(0).show().find("input").val($t.data("byconditionvalue1"));}$("#luckysheet-pivotTableFilter-byvalue-select").empty().html('<div style="width:100%;text-align:center;position:relative;top:45%;font-size: 14px;"> <div class="luckysheetLoaderGif"> </div> <span>数据量大！请稍后</span></div>');var rowhiddenother={};//其它筛选列的隐藏行
  $("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").not($t.get(0)).each(function(){var $t=$(this),rh=$t.data("rowhidden");if(rh==null||rh==""){return true;}if(luckysheet.getObjType(rh)=="string"){rh=JSON.parse(rh);}for(var r in rh){rowhiddenother[r]=0;}});var data=luckysheet.pivotTable.origindata;setTimeout(function(){//日期值
  var dvmap={};var dvmap_uncheck={};//除日期以外的值
  var vmap={};var vmap_uncheck={};for(var r=1;r<data.length;r++){if(r in rowhiddenother){continue;}if(data[r]==null){continue;}var cell=data[r][cindex];if(cell!=null&&cell.ct!=null&&cell.ct.t=="d"){//单元格是日期
  var v=luckysheet.mask.update("YYYY-MM-DD",cell.v);var y=v.split("-")[0];var m=v.split("-")[1];var d=v.split("-")[2];if(!(y in dvmap)){dvmap[y]={};}if(!(m in dvmap[y])){dvmap[y][m]={};}if(!(d in dvmap[y][m])){dvmap[y][m][d]=0;}dvmap[y][m][d]++;if(r in rowhidden){dvmap_uncheck[y]=0;dvmap_uncheck[m]=0;dvmap_uncheck[d]=0;}}else {if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){var v=null;var m=null;}else {var v=cell.v;var m=cell.m;}if(!(v in vmap)){vmap[v]={};}if(!(m in vmap[v])){vmap[v][m]=0;}vmap[v][m]++;if(r in rowhidden){vmap_uncheck[v+"#$$$#"+m]=0;}}}//遍历数据加到页面
  var item=[];if(JSON.stringify(dvmap).length>2){for(y in dvmap){var ysum=0;var monthHtml='';for(m in dvmap[y]){var msum=0;var dayHtml='';for(d in dvmap[y][m]){var dayL=dvmap[y][m][d];msum+=dayL;//月 小于 10
  if(Number(m)<10){var mT="0"+Number(m);}else {var mT=m;}//日 小于 10
  if(Number(d)<10){var dT="0"+Number(d);}else {var dT=d;}//日是否选中状态
  if(y in dvmap_uncheck&&m in dvmap_uncheck&&d in dvmap_uncheck){dayHtml+='<div class="day luckysheet-mousedown-cancel cf" data-check="false" title="'+y+'-'+mT+'-'+dT+'">'+'<input class="luckysheet-mousedown-cancel" type="checkbox"/>'+'<label class="luckysheet-mousedown-cancel">'+d+'</label>'+'<span class="count luckysheet-mousedown-cancel">( '+dayL+' )</span>'+'</div>';}else {dayHtml+='<div class="day luckysheet-mousedown-cancel cf" data-check="true" title="'+y+'-'+mT+'-'+dT+'">'+'<input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/>'+'<label class="luckysheet-mousedown-cancel">'+d+'</label>'+'<span class="count luckysheet-mousedown-cancel">( '+dayL+' )</span>'+'</div>';}}ysum+=msum;//月 小于 10
  if(Number(m)<10){var mT2="0"+Number(m);}else {var mT2=m;}//月是否选中状态
  if(y in dvmap_uncheck&&m in dvmap_uncheck){monthHtml+='<div class="monthBox luckysheet-mousedown-cancel">'+'<div class="month luckysheet-mousedown-cancel cf" data-check="false" title="'+y+'-'+mT2+'">'+'<i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i>'+'<input class="luckysheet-mousedown-cancel" type="checkbox"/>'+'<label class="luckysheet-mousedown-cancel">'+m+'月</label>'+'<span class="count luckysheet-mousedown-cancel">( '+msum+' )</span>'+'</div>'+'<div class="dayList luckysheet-mousedown-cancel">'+dayHtml+'</div>'+'</div>';}else {monthHtml+='<div class="monthBox luckysheet-mousedown-cancel">'+'<div class="month luckysheet-mousedown-cancel cf" data-check="true" title="'+y+'-'+mT2+'">'+'<i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i>'+'<input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/>'+'<label class="luckysheet-mousedown-cancel">'+m+'月</label>'+'<span class="count luckysheet-mousedown-cancel">( '+msum+' )</span>'+'</div>'+'<div class="dayList luckysheet-mousedown-cancel">'+dayHtml+'</div>'+'</div>';}}//年是否选中状态
  if(y in dvmap_uncheck){var yearHtml='<div class="yearBox luckysheet-mousedown-cancel">'+'<div class="year luckysheet-mousedown-cancel cf" data-check="false" title="'+y+'">'+'<i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i>'+'<input class="luckysheet-mousedown-cancel" type="checkbox"/>'+'<label class="luckysheet-mousedown-cancel">'+y+'年</label>'+'<span class="count luckysheet-mousedown-cancel">( '+ysum+' )</span>'+'</div>'+'<div class="monthList luckysheet-mousedown-cancel">'+monthHtml+'</div>'+'</div>';}else {var yearHtml='<div class="yearBox luckysheet-mousedown-cancel">'+'<div class="year luckysheet-mousedown-cancel cf" data-check="true" title="'+y+'">'+'<i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i>'+'<input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/>'+'<label class="luckysheet-mousedown-cancel">'+y+'年</label>'+'<span class="count luckysheet-mousedown-cancel">( '+ysum+' )</span>'+'</div>'+'<div class="monthList luckysheet-mousedown-cancel">'+monthHtml+'</div>'+'</div>';}item.unshift(yearHtml);}}if(JSON.stringify(vmap).length>2){var vmapKeys=Object.keys(vmap);vmapKeys=luckysheet.orderbydata1D(vmapKeys,true);for(var i=0;i<vmapKeys.length;i++){var v=vmapKeys[i];for(x in vmap[v]){if(v+"#$$$#"+x=="null#$$$#null"){var text="(空白)";}else {var text=x;}//是否选中状态
  if(v+"#$$$#"+x in vmap_uncheck){var dataHtml='<div class="textBox luckysheet-mousedown-cancel cf" data-check="false" data-filter="'+(v+"#$$$#"+x)+'" title="'+x+'">'+'<input class="luckysheet-mousedown-cancel" type="checkbox"/>'+'<label class="luckysheet-mousedown-cancel">'+text+'</label>'+'<span class="luckysheet-mousedown-cancel count">( '+vmap[v][x]+' )</span>'+'</div>';}else {var dataHtml='<div class="textBox luckysheet-mousedown-cancel cf" data-check="true" data-filter="'+(v+"#$$$#"+x)+'" title="'+x+'">'+'<input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/>'+'<label class="luckysheet-mousedown-cancel">'+text+'</label>'+'<span class="luckysheet-mousedown-cancel count">( '+vmap[v][x]+' )</span>'+'</div>';}item.push(dataHtml);}}}$("#luckysheet-pivotTableFilter-byvalue-select").html("<div class='ListBox luckysheet-mousedown-cancel' style='max-height:"+(winH-toffset.top-350)+"px;overflow-y:auto;overflow-x:hidden;'>"+item.join("")+"</div>");},1);showrightclickmenu($menu,toffset.left-250,toffset.top);},getSumTypeName:function getSumTypeName(type){var name="";if(type=="SUM"){name="求和";}else if(type=="COUNT"){name="数值计数";}else if(type=="COUNTA"){name="计数";}else if(type=="COUNTUNIQUE"){name="去重计数";}else if(type=="AVERAGE"){name="平均值";}else if(type=="MAX"){name="最大值";}else if(type=="MIN"){name="最小值";}else if(type=="MEDIAN"){name="中位数";}else if(type=="PRODUCT"){name="乘积";}else if(type=="STDEV"){name="标准差";}else if(type=="STDEVP"){name="整体标准差";}else if(type=="VAR"){name="方差";}else if(type=="VARP"){name="整体方差";}return name;},setDatatojsfile:function setDatatojsfile(attr,value,cindex){var index=luckysheet.sheetmanage.getSheetIndex(this.pivotSheetIndex);if(luckysheetfile[index]["pivotTable"]==null){luckysheetfile[index]["pivotTable"]={};}if(cindex==null){luckysheetfile[index]["pivotTable"][attr]=value;this[attr]=value;}else {if(luckysheetfile[index]["pivotTable"]["filterparm"]==null){luckysheetfile[index]["pivotTable"]["filterparm"]={};}if(luckysheetfile[index]["pivotTable"]["filterparm"][cindex.toString()]==null){luckysheetfile[index]["pivotTable"]["filterparm"][cindex.toString()]={};}luckysheetfile[index]["pivotTable"]["filterparm"][cindex.toString()][attr]=value;if(this["filterparm"]==null){this["filterparm"]={};}if(this["filterparm"][cindex.toString()]==null){this["filterparm"][cindex.toString()]={};}this["filterparm"][cindex.toString()][attr]=value;}},createPivotTable:function createPivotTable(e){var datasheetindex=luckysheet.currentSheetIndex;if(luckysheet.isEditMode()){alert("非编辑模式下禁止该操作！");return;}if(luckysheet_select_save.length>1){luckysheet.tooltip.info("提示","不能对多重选择区域执行此操作，请选择单个区域，然后再试");return;}if(luckysheet_select_save.length==0||luckysheet_select_save[0].row[0]==luckysheet_select_save[0].row[1]||luckysheet_select_save[0].column[0]==luckysheet_select_save[0].column[1]){luckysheet.tooltip.info("提示","请选择新建透视表的区域");return;}var select_save=$.extend(true,{},luckysheet_select_save[0]);luckysheet.sheetmanage.addNewSheet(e,true);this.getCellData(luckysheet.currentSheetIndex,datasheetindex,select_save);this.setDatatojsfile("pivot_select_save",select_save);this.setDatatojsfile("pivotDataSheetIndex",datasheetindex);this.initialPivotManage();//this.drawPivotTable();
  },changePivotTable:function changePivotTable(index){var pivotDataSheetIndex=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(index)].pivotTable.pivotDataSheetIndex;var real_pivotDataSheetIndex=luckysheet.sheetmanage.getSheetIndex(pivotDataSheetIndex);if(real_pivotDataSheetIndex==null){luckysheet.tooltip.info("此数据透视表的源数据已损坏！","");return;}this.getCellData(index);this.initialPivotManage(true);},refreshPivotTable:function refreshPivotTable(){var redo={};var pivotTable=this.getPivotTableData();redo["pivotTable"]=pivotTable;redo["data"]=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  this.storePivotTableParam();var ret=this.dataHandler(this.column,this.row,this.values,this.showType,this.celldata);this.setDatatojsfile("pivotDatas",ret);var d=$.extend(true,[],luckysheet.sheetmanage.nulldata);var data=d;if(ret.length==0){//this.drawPivotTable =true;
  //this.pivotTableBoundary = [12, 6];
  this.setDatatojsfile("drawPivotTable",true);this.setDatatojsfile("pivotTableBoundary",[12,6]);}else {//this.drawPivotTable = false;
  //this.pivotTableBoundary = [ret.length, ret[0].length];
  this.setDatatojsfile("drawPivotTable",false);this.setDatatojsfile("pivotTableBoundary",[ret.length,ret[0].length]);var rlen=ret.length,clen=ret[0].length;var addr=rlen-d.length,addc=clen-d[0].length;data=luckysheet.datagridgrowth(d,addr+20,addc+10,true);for(var r=0;r<rlen;r++){var x=[].concat(data[r]);for(var c=0;c<clen;c++){var value="";if(ret[r]!=null&&ret[r][c]!=null){value=luckysheet.getcellvalue(r,c,ret);}x[c]=value;}data[r]=x;}}redo["type"]="pivotTable_change";redo["curdata"]=$.extend(true,[],data);redo["sheetIndex"]=luckysheet.currentSheetIndex;var pivotTable=this.getPivotTableData();redo["pivotTablecur"]=pivotTable;if(clearjfundo){luckysheet.jfundo=[];luckysheet.jfredo.push(redo);}//luckysheet.flowdata = flowdata_new = data;
  luckysheet.cleargridelement();clearjfundo=false;if(addr>0||addc>0){luckysheet.jfrefreshgridall(data[0].length,data.length,data,null,luckysheet_select_save,"datachangeAll");}else {luckysheet.jfrefreshgrid(data,luckysheet_select_save);luckysheet.selectHightlightShow();}clearjfundo=true;},drawPivotTable:true,pivotTableBoundary:[12,6],pivotclick:function pivotclick(row_index,col_index,index){if(index==null){index=luckysheet.currentSheetIndex;}var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(index)];if(!file.isPivotTable){return;}var pivotDataSheetIndex=file.pivotTable.pivotDataSheetIndex;var real_pivotDataSheetIndex=luckysheet.sheetmanage.getSheetIndex(pivotDataSheetIndex);if(real_pivotDataSheetIndex==null){return;}if(this.isPivotRange(row_index,col_index)){$("#luckysheet-modal-dialog-slider-pivot").show();luckysheet.luckysheetsizeauto();$("#luckysheet-sta-content").css("padding-right",260);}else {$("#luckysheet-modal-dialog-slider-pivot").hide();luckysheet.luckysheetsizeauto();$("#luckysheet-sta-content").css("padding-right",10);}},isPivotRange:function isPivotRange(row_index,col_index){if(!!luckysheetcurrentisPivotTable){if(row_index<this.pivotTableBoundary[0]&&col_index<this.pivotTableBoundary[1]){return true;}else {return false;}}},storePivotTableParam:function storePivotTableParam(){var columnarr=[],rowarr=[],filterarr=[],valuesarr=[];$("#luckysheet-modal-dialog-config-filter .luckysheet-modal-dialog-slider-config-item").each(function(){var item={};item["index"]=$(this).data("index");item["name"]=$(this).data("name");item["fullname"]=$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text();// item["order"] = $(this).data("order");
  // item["orderby"] = $(this).data("orderby");
  // item["stastic"] = $(this).data("stastic");
  filterarr.push(item);});$("#luckysheet-modal-dialog-config-row .luckysheet-modal-dialog-slider-config-item").each(function(){var item={};item["index"]=$(this).data("index");item["name"]=$(this).data("name");item["fullname"]=$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text();item["order"]=$(this).data("order");item["orderby"]=$(this).data("orderby");item["stastic"]=$(this).data("stastic");rowarr.push(item);});$("#luckysheet-modal-dialog-config-column .luckysheet-modal-dialog-slider-config-item").each(function(){var item={};item["index"]=$(this).data("index");item["name"]=$(this).data("name");item["fullname"]=$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text();item["order"]=$(this).data("order");item["orderby"]=$(this).data("orderby");item["stastic"]=$(this).data("stastic");columnarr.push(item);});$("#luckysheet-modal-dialog-config-value .luckysheet-modal-dialog-slider-config-item").each(function(){var item={};item["index"]=$(this).data("index");item["name"]=$(this).data("name");item["fullname"]=$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text();item["sumtype"]=$(this).data("sumtype");item["nameindex"]=$(this).data("nameindex");valuesarr.push(item);});this.setDatatojsfile("column",columnarr);this.setDatatojsfile("row",rowarr);this.setDatatojsfile("filter",filterarr);this.setDatatojsfile("values",valuesarr);var showtype=$("#luckysheetpivottablevaluecolrow:checked, #luckysheetpivottablevaluecolrow1:checked").val();this.setDatatojsfile("showType",showtype=="0"?"row":"column");var pivotTable=this.getPivotTableData();delete pivotTable.pivotDatas;luckysheet.server.saveParam("all",this.pivotSheetIndex,pivotTable,{"k":"pivotTable"});},getPivotTableData:function getPivotTableData(dataindex){if(dataindex==null){dataindex=this.pivotSheetIndex;}var index=luckysheet.sheetmanage.getSheetIndex(dataindex);var pivotTable=luckysheetfile[index]["pivotTable"];if(luckysheet.getObjType(pivotTable)=="object"){pivotTable=$.extend(true,{},luckysheetfile[index]["pivotTable"]);}else {pivotTable=eval('('+pivotTable+')');}//var pivotTable = $.extend(true, {}, luckysheetfile[index]["pivotTable"]);
  return pivotTable;},addValuesToTitle:function addValuesToTitle(titles,values){var rowLen=titles.length*values.length,colLen=titles[0].length+1;var retdata=[];if(titles.length==0&&values.length>0){for(var v=0;v<values.length;v++){retdata.push(values[v].fullname);}return retdata;}if(values.length==0&&titles.length>0){return titles;}for(var r=0;r<rowLen;r++){retdata[r]=new Array(colLen);for(var c=0;c<colLen-1;c++){retdata[r][c]=titles[Math.floor(r/values.length)][c];}retdata[r][colLen-1]=values[r%values.length].fullname;}return retdata;},initialPivotManage:function initialPivotManage(restore){//this.getCellData();
  if(this.initial){this.initial=false;$("body").append(luckysheetPivotTableHTML);$("#luckysheet-modal-dialog-slider-close").click(function(){$("#luckysheet-modal-dialog-slider-pivot").hide();luckysheet.luckysheetsizeauto();});$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-data-pivotTable-selection","addclass":"luckysheet-data-pivotTable-selection","title":"选取数据范围","content":'<input id="luckysheet-pivotTable-range-selection-input" class="luckysheet-datavisual-range-container" style="font-size: 14px;padding:5px;max-width:none;" spellcheck="false" aria-label="数据范围" placeholder="数据范围">',"botton":'<button id="luckysheet-pivotTable-selection-confirm" class="btn btn-primary">确认选取</button><button class="btn btn-default luckysheet-model-close-btn">取消</button>'}));$("body").append(luckysheet.replaceHtml(filtermenuHTML,{"menuid":"pivotTableFilter"}));$("body").append(luckysheet.replaceHtml(filtersubmenuHTML,{"menuid":"pivotTableFilter"}));$("body").append(pivottableconfigHTML);$("body").append(pivottablesumHTML);$("#luckysheet-pivotTableFilter-orderby-asc").remove();$("#luckysheet-pivotTableFilter-orderby-desc").next().remove();$("#luckysheet-pivotTableFilter-orderby-desc").remove();$("#luckysheet-pivotTableFilter-orderby-color").next().remove();$("#luckysheet-pivotTableFilter-orderby-color").remove();$("#luckysheetpivottablevaluecolrow, #luckysheetpivottablevaluecolrow1").checkboxradio({icon:false}).change(function(){luckysheet.pivotTable.refreshPivotTable();});var hidefilersubmenu=null;$("#luckysheet-pivotTableFilter-menu").mouseover(function(){clearTimeout(hidefilersubmenu);hidefilersubmenu=setTimeout(function(){$("#luckysheet-pivotTableFilter-submenu").hide();},500);});//点击复选框
  $(document).off("click.ptFilterCheckbox1").on("click.ptFilterCheckbox1","#luckysheet-pivotTableFilter-byvalue-select .textBox",function(){if($(this).attr("data-check")=="true"){$(this).attr("data-check","false");$(this).find("input[type='checkbox']").removeAttr("checked");}else {$(this).attr("data-check","true");$(this).find("input[type='checkbox']").prop("checked",true);}});$(document).off("click.ptFilterCheckbox2").on("click.ptFilterCheckbox2","#luckysheet-pivotTableFilter-byvalue-select .year",function(){if($(this).attr("data-check")=="true"){$(this).attr("data-check","false");$(this).parents(".yearBox").find(".month").attr("data-check","false");$(this).parents(".yearBox").find(".day").attr("data-check","false");$(this).parents(".yearBox").find("input[type='checkbox']").removeAttr("checked");}else {$(this).attr("data-check","true");$(this).parents(".yearBox").find(".month").attr("data-check","true");$(this).parents(".yearBox").find(".day").attr("data-check","true");$(this).parents(".yearBox").find("input[type='checkbox']").prop("checked",true);}});$(document).off("click.ptFilterCheckbox3").on("click.ptFilterCheckbox3","#luckysheet-pivotTableFilter-byvalue-select .month",function(){//月份 对应的 天
  if($(this).attr("data-check")=="true"){$(this).attr("data-check","false");$(this).parents(".monthBox").find(".day").attr("data-check","false");$(this).parents(".monthBox").find("input[type='checkbox']").removeAttr("checked");}else {$(this).attr("data-check","true");$(this).parents(".monthBox").find(".day").attr("data-check","true");$(this).parents(".monthBox").find("input[type='checkbox']").prop("checked",true);}//月份 对应的 年份
  var yearDayAllCheck=true;var $yearDay=$(this).parents(".yearBox").find(".day");$yearDay.each(function(i,e){if($(e).attr("data-check")=="true");else {yearDayAllCheck=false;}});if(yearDayAllCheck){$(this).parents(".yearBox").find(".year").attr("data-check","true");$(this).parents(".yearBox").find(".year input[type='checkbox']").prop("checked",true);}else {$(this).parents(".yearBox").find(".year").attr("data-check","false");$(this).parents(".yearBox").find(".year input[type='checkbox']").removeAttr("checked");}});$(document).off("click.ptFilterCheckbox4").on("click.ptFilterCheckbox4","#luckysheet-pivotTableFilter-byvalue-select .day",function(){if($(this).attr("data-check")=="true"){$(this).attr("data-check","false");$(this).find("input[type='checkbox']").removeAttr("checked");}else {$(this).attr("data-check","true");$(this).find("input[type='checkbox']").prop("checked",true);}//天 对应的 月份
  var monthDayAllCheck=true;var $monthDay=$(this).parents(".monthBox").find(".day");$monthDay.each(function(i,e){if($(e).attr("data-check")=="true");else {monthDayAllCheck=false;}});if(monthDayAllCheck){$(this).parents(".monthBox").find(".month").attr("data-check","true");$(this).parents(".monthBox").find(".month input[type='checkbox']").prop("checked",true);}else {$(this).parents(".monthBox").find(".month").attr("data-check","false");$(this).parents(".monthBox").find(".month input[type='checkbox']").removeAttr("checked");}//天 对应的 年份
  var yearDayAllCheck=true;var $yearDay=$(this).parents(".yearBox").find(".day");$yearDay.each(function(i,e){if($(e).attr("data-check")=="true");else {yearDayAllCheck=false;}});if(yearDayAllCheck){$(this).parents(".yearBox").find(".year").attr("data-check","true");$(this).parents(".yearBox").find(".year input[type='checkbox']").prop("checked",true);}else {$(this).parents(".yearBox").find(".year").attr("data-check","false");$(this).parents(".yearBox").find(".year input[type='checkbox']").removeAttr("checked");}});//日期 三级下拉显示
  $(document).off("click.ptFilterYearDropdown").on("click.ptFilterYearDropdown","#luckysheet-pivotTableFilter-byvalue-select .yearBox .fa-caret-right",function(){var $p=$(this).parents(".luckysheet-mousedown-cancel");if($p.hasClass("year")){$(this).parents(".yearBox").find(".monthList").slideToggle();}if($p.hasClass("month")){$(this).parents(".monthBox").find(".dayList").slideToggle();}});//全选
  $("#luckysheet-pivotTableFilter-byvalue-btn-all").click(function(){$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").prop("checked",true);$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").parents(".luckysheet-mousedown-cancel").attr("data-check","true");});//反选
  $("#luckysheet-pivotTableFilter-byvalue-btn-contra").click(function(){var $input=$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']");$input.each(function(i,e){if($(e).is(":checked")){$(e).removeAttr("checked");$(e).parents(".luckysheet-mousedown-cancel").attr("data-check","false");}else {$(e).prop("checked",true);$(e).parents(".luckysheet-mousedown-cancel").attr("data-check","true");}});//天 对应的 月份
  var $month=$("#luckysheet-pivotTableFilter-byvalue-select .ListBox .monthBox");$month.each(function(index,event){var monthDayAllCheck=true;var $monthDay=$(event).find(".day input[type='checkbox']");$monthDay.each(function(i,e){if($(e).is(":checked"));else {monthDayAllCheck=false;}});if(monthDayAllCheck){$(event).find(".month input[type='checkbox']").prop("checked",true);$(event).attr("data-check","true");}else {$(event).find(".month input[type='checkbox']").removeAttr("checked");$(event).attr("data-check","false");}});//天 对应的 年份
  var $year=$("#luckysheet-pivotTableFilter-byvalue-select .ListBox .yearBox");$year.each(function(index,event){var yearDayAllCheck=true;var $yearDay=$(event).find(".day input[type='checkbox']");$yearDay.each(function(i,e){if($(e).is(":checked"));else {yearDayAllCheck=false;}});if(yearDayAllCheck){$(event).find(".year input[type='checkbox']").prop("checked",true);$(event).attr("data-check","true");}else {$(event).find(".year input[type='checkbox']").removeAttr("checked");$(event).attr("data-check","false");}});});//清除
  $("#luckysheet-pivotTableFilter-byvalue-btn-clear").click(function(){$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").removeAttr("checked");$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").parents(".luckysheet-mousedown-cancel").attr("data-check","false");});//按照值进行筛选
  $("#luckysheet-pivotTableFilter-byvalue-input").on('input propertychange',function(){var v=$(this).val().toString();$("#luckysheet-pivotTableFilter-byvalue-select .ListBox .luckysheet-mousedown-cancel").show();if(v!=""){var $check=$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']");$check.each(function(i,e){var $p=$(e).parents(".luckysheet-mousedown-cancel");if($p.hasClass("day")){//日期
  var day=$(e).siblings("label").text().toString();var month=$(e).parents(".monthBox").find(".month label").text().toString();var year=$(e).parents(".yearBox").find(".year label").text().toString();var itemV=year+"-"+month+"-"+day;if(itemV.indexOf(v)==-1){$(e).parents(".day").hide();//天 对应的 月份
  var $monthDay=$(e).parents(".dayList").find(".day:visible");if($monthDay.length==0){$(e).parents(".monthBox").find(".month").hide();}//天 对应的 年份
  var $yearDay=$(e).parents(".monthList").find(".day:visible");if($yearDay.length==0){$(e).parents(".yearBox").find(".year").hide();}}}if($p.hasClass("textBox")){//其它
  var itemV=$(e).siblings("label").text().toString();if(itemV.indexOf(v)==-1){$(e).parents(".textBox").hide();}}});}});$("#luckysheet-pivotTableFilter-bycondition, #luckysheet-pivotTableFilter-byvalue").click(function(){var $t=$(this);$t.next().slideToggle(200);setTimeout(function(){if($t.attr("id")=="luckysheet-pivotTableFilter-bycondition"&&$("#luckysheet-pivotTableFilter-bycondition").next().is(":visible")){if($("#luckysheet-pivotTableFilter-selected span").text()!="无"){$("#luckysheet-pivotTableFilter-byvalue").next().slideUp(200);}}if($t.is($("#luckysheet-pivotTableFilter-bycondition"))){if($("#luckysheet-pivotTableFilter-bycondition").next().is(":hidden")&&$("#luckysheet-pivotTableFilter-byvalue").next().is(":hidden")){$("#luckysheet-pivotTableFilter-byvalue").next().slideDown(200);}}},300);});//取消按钮
  $("#luckysheet-pivotTableFilter-cancel").click(function(){$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide();});$("#luckysheet-pivotTableFilter-selected").click(function(){var $t=$(this),toffset=$t.offset(),$menu=$("#luckysheet-pivotTableFilter-submenu");$menu.hide();var winH=$(window).height(),winW=$(window).width();var menuW=$menu.width(),menuH=$menu.height();var top=toffset.top,left=toffset.left,mheight=winH-toffset.top-20;if(toffset.left+menuW>winW){left=toffset.left-menuW;}if(toffset.top>winH/2){top=winH-toffset.top;if(top<0){top=0;}mheight=toffset.top-20;}$menu.css({"top":top,"left":left,"height":mheight}).show();clearTimeout(hidefilersubmenu);});//按条件过滤
  $("#luckysheet-pivotTableFilter-submenu").mouseover(function(){clearTimeout(hidefilersubmenu);}).find(".luckysheet-cols-menuitem").click(function(e){$("#luckysheet-pivotTableFilter-selected span").html($(this).find(".luckysheet-cols-menuitem-content").text()).data("value",$(this).data("value"));$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").hide();if($(this).data("type")=="2"){$("#luckysheet-pivotTableFilter-selected span").data("type","2");$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input2").show();}else if($(this).data("type")=="0"){$("#luckysheet-pivotTableFilter-selected span").data("type","0");}else {$("#luckysheet-pivotTableFilter-selected span").data("type","1");$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").eq(0).show();//若是日期 改变input type类型为date
  if($(this).attr("data-value")=="dateequal"||$(this).attr("data-value")=="datelessthan"||$(this).attr("data-value")=="datemorethan"){$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input input").prop("type","date");}else {$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input input").prop("type","text");}}$("#luckysheet-pivotTableFilter-byvalue").next().slideUp();$("#luckysheet-pivotTableFilter-submenu").hide();});$("#luckysheet-modal-dialog-pivotTable-list").on("click"," .luckysheet-slider-list-item-filter",function(e){//var $t = $(this).parent(),$filter = $(this), toffset = $t.offset(), $menu = $("#luckysheet-pivotTableFilter-menu"), winH = $(window).height(), winW = $(window).width();
  luckysheet.pivotTable.luckysheetsliderlistitemfilter($(this));e.stopPropagation();return false;});//.on("mousedown dblclick mouseup", function (e) { e.stopPropagation(); return false; });
  $("#luckysheet-modal-dialog-pivotTable-list").on("click"," .luckysheet-slider-list-item-filtered",function(e){luckysheet.pivotTable.luckysheetsliderlistclearfilter($(this).next());e.stopPropagation();return false;});$("#luckysheet-dialog-pivotTable-range-seleted").click(function(){$("#luckysheet-modal-dialog-slider-pivot").hide();luckysheet.luckysheetsizeauto();var $t=$("#luckysheet-data-pivotTable-selection"),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-data-pivotTable-selection").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/4}).show();luckysheet.pivotTable.jgridCurrentPivotInput=$("#luckysheet-dialog-pivotTable-range").html();$("#luckysheet-pivotTable-range-selection-input").val(luckysheet.pivotTable.jgridCurrentPivotInput);luckysheet.pivotTable.luckysheet_pivotTable_select_state=true;//luckysheet.pivotTable.pivotSheetIndex = luckysheet.currentSheetIndex;
  });//清除筛选按钮
  $("#luckysheet-pivotTableFilter-initial").click(function(){$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-slider-list-item-filtered").hide();$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").data("rowhidden","");$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide();$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").hide().find("input").val();$("#luckysheet-pivotTableFilter-selected span").data("type","0").data("type",null).text("无");luckysheet.pivotTable.setDatatojsfile("filterparm",null);luckysheet.pivotTable.celldata=luckysheet.pivotTable.origindata;luckysheet.pivotTable.refreshPivotTable();});$("#luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column").on("click",".luckysheet-modal-dialog-slider-config-item-icon",function(e){var $t=$(e.target),$item=$t.closest(".luckysheet-modal-dialog-slider-config-item"),cindex=$item.data("index"),toffset=$item.offset();var order=$item.data("order"),orderby=$item.data("orderby"),stastic=$item.data("stastic");if(order==null){order="default";}var option='<option value="self">'+$item.find(".luckysheet-modal-dialog-slider-config-item-txt").data("name")+'</option>';$("#luckysheet-modal-dialog-config-value .luckysheet-modal-dialog-slider-config-item").each(function(i){option+='<option value="'+i+'">'+$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text()+'</option>';});$("#luckysheet-pivotTable-config-option-orderby").empty().html(option);if(orderby==null){orderby="self";}if(stastic==null){stastic="1";}$("#luckysheet-pivotTable-config-option-order").val(order).data("index",cindex);$("#luckysheet-pivotTable-config-option-orderby").val(orderby).data("index",cindex);$("#luckysheet-pivotTable-config-option-stastic").val(stastic).data("index",cindex);mouseclickposition($("#luckysheet-pivotTable-config-option"),toffset.left+$item.outerWidth(),toffset.top-13,"rightbottom");e.stopPropagation();return false;});$("#luckysheet-pivotTable-config-option-order,#luckysheet-pivotTable-config-option-orderby,#luckysheet-pivotTable-config-option-stastic").change(function(){var $t=$(this),cindex=$t.data("index");$("#luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column").find(".luckysheet-modal-dialog-slider-config-item").each(function(){if($(this).data("index")==cindex){$(this).data($t.attr("id").replace("luckysheet-pivotTable-config-option-",""),$t.val());}});luckysheet.pivotTable.refreshPivotTable();});$("#luckysheet-modal-dialog-config-value").on("click",".luckysheet-modal-dialog-slider-config-item-icon",function(e){var $t=$(e.target),$item=$t.closest(".luckysheet-modal-dialog-slider-config-item"),cindex=$item.data("index"),toffset=$item.offset(),sumtype=$item.data("sumtype");var type=luckysheet.pivotTable.pivot_data_type[cindex.toString()];if(sumtype==null){if(type=="num"){sumtype="SUM";}else {sumtype="COUNTA";}}var $menu=$("#luckysheet-pivotTable-config-option-sumtype");$menu.find(".luckysheet-submenu-arrow").hide();$menu.find(".luckysheet-cols-menuitem[sumtype='"+sumtype+"'] .luckysheet-submenu-arrow").css("display","inline");$menu.data("item",$item);mouseclickposition($menu,toffset.left+$item.outerWidth(),toffset.top-13,"rightbottom");e.stopPropagation();return false;});$("#luckysheet-pivotTable-config-option-sumtype .luckysheet-cols-menuitem").click(function(){var $item=$("#luckysheet-pivotTable-config-option-sumtype").data("item");var sumtype=$(this).attr("sumtype");$item.data("sumtype",$(this).attr("sumtype"));var name=luckysheet.pivotTable.getSumTypeName(sumtype)+":"+$item.data("name");$item.attr("title",name).find(".luckysheet-modal-dialog-slider-config-item-txt").html(name);$("#luckysheet-pivotTable-config-option-sumtype").hide();luckysheet.pivotTable.refreshPivotTable();});$("#luckysheet-modal-dialog-config-filter").on("click",".luckysheet-modal-dialog-slider-config-item-icon",function(e){var $t=$(e.target),cindex=$t.closest(".luckysheet-modal-dialog-slider-config-item").data("index");//console.log($("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(cindex).find(".luckysheet-slider-list-item-filter"));
  luckysheet.pivotTable.luckysheetsliderlistitemfilter($("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(cindex).find(".luckysheet-slider-list-item-filter"));e.stopPropagation();return false;});//确认按钮
  $("#luckysheet-pivotTableFilter-confirm").click(function(){var $menu=$("#luckysheet-pivotTableFilter-menu");var cindex=$menu.data("index");var rowhiddenother={};//其它筛选列的隐藏行
  $("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").each(function(){var $t=$(this),rh=$t.data("rowhidden");if($t.data("index")!=cindex){if(rh==null||rh==""){return true;}if(luckysheet.getObjType(rh)=="string"){rh=JSON.parse(rh);}for(var r in rh){rowhiddenother[r]=0;}}});var d=luckysheet.pivotTable.origindata;var filterdata={};var rowhidden={};var caljs={};if($("#luckysheet-pivotTableFilter-bycondition").next().is(":visible")&&$("#luckysheet-pivotTableFilter-byvalue").next().is(":hidden")&&$("#luckysheet-pivotTableFilter-selected span").data("value")!="null"){var $t=$("#luckysheet-pivotTableFilter-selected span");var type=$t.data("type"),value=$t.data("value");caljs["value"]=value;caljs["text"]=$t.text();if(type=="0"){caljs["type"]="0";}else if(type=="2"){var $input=$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input2 input");caljs["type"]="2";caljs["value1"]=$input.eq(0).val();caljs["value2"]=$input.eq(1).val();}else {caljs["type"]="1";caljs["value1"]=$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").eq(0).find("input").val();}for(var r=1;r<d.length;r++){if(r in rowhiddenother){continue;}if(d[r]==null){continue;}var cell=d[r][cindex];if(value=="cellnull"){//单元格为空
  if(cell!=null&&!luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}}else if(value=="cellnonull"){//单元格有数据
  if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}}else if(value=="textinclude"){//文本包含 
  var value1=caljs["value1"];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else {if(cell.m.indexOf(value1)==-1){rowhidden[r]=0;}}}else if(value=="textnotinclude"){//文本不包含
  var value1=caljs["value1"];if(cell==null||luckysheet.func_methods.isRealNull(cell.v));else {if(cell.m.indexOf(value1)>-1){rowhidden[r]=0;}}}else if(value=="textstart"){//文本开头为
  var value1=caljs["value1"],valuelen=value1.length;if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else {if(cell.m.substr(0,valuelen)!=value1){rowhidden[r]=0;}}}else if(value=="textend"){//文本结尾为
  var value1=caljs["value1"],valuelen=value1.length;if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else {if(valuelen>cell.m.length||cell.m.substr(cell.m.length-valuelen,valuelen)!=value1){rowhidden[r]=0;}}}else if(value=="textequal"){//文本等于
  var value1=caljs["value1"];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else {if(cell.m!=value1){rowhidden[r]=0;}}}else if(value=="dateequal"){//日期等于
  var value1=luckysheet.mask.genarate(caljs["value1"])[2];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="d"){if(parseInt(cell.v)!=value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="datelessthan"){//日期早于
  var value1=luckysheet.mask.genarate(caljs["value1"])[2];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="d"){if(parseInt(cell.v)>=value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="datemorethan"){//日期晚于
  var value1=luckysheet.mask.genarate(caljs["value1"])[2];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="d"){if(parseInt(cell.v)<=value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="morethan"){//大于
  var value1=parseFloat(caljs["value1"]);if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v<=value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="moreequalthan"){//大于等于
  var value1=parseFloat(caljs["value1"]);if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v<value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="lessthan"){//小于
  var value1=parseFloat(caljs["value1"]);if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v>=value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="lessequalthan"){//小于等于
  var value1=parseFloat(caljs["value1"]);if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v>value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="equal"){//等于
  var value1=parseFloat(caljs["value1"]);if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v!=value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="noequal"){//不等于
  var value1=parseFloat(caljs["value1"]);if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v==value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="include"){//介于
  var value1=parseFloat(caljs["value1"]),value2=parseFloat(caljs["value2"]);if(value1<value2){var min=value1;var max=value2;}else {var max=value1;var min=value2;}if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v<min||cell.v>max){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="noinclude"){//不在其中
  var value1=parseFloat(caljs["value1"]),value2=parseFloat(caljs["value2"]);if(value1<value2){var min=value1;var max=value2;}else {var max=value1;var min=value2;}if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v>=min&&cell.v<=max){rowhidden[r]=0;}}else {rowhidden[r]=0;}}}}else {$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").each(function(i,e){if($(e).is(":visible")&&$(e).is(":checked")){return true;}if($(e).closest(".day").length>0){var day=$(e).siblings("label").text();if(Number(day)<10){day="0"+day;}var month=$(e).closest(".monthBox").find(".month label").text().replace("月","");if(Number(month)<10){month="0"+month;}var year=$(e).closest(".yearBox").find(".year label").text().replace("年","");var itemV="日期格式#$$$#"+year+"-"+month+"-"+day;filterdata[itemV]="1";}if($(e).closest(".textBox").length>0){var itemV=$(e).closest(".textBox").data("filter");filterdata[itemV]="1";}});for(var r=1;r<d.length;r++){if(r in rowhiddenother){continue;}if(d[r]==null){continue;}var cell=d[r][cindex];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){var value="null#$$$#null";}else if(cell.ct!=null&&cell.ct.t=="d"){var fmt=luckysheet.mask.update("YYYY-MM-DD",cell.v);var value="日期格式#$$$#"+fmt;}else {var value=cell.v+"#$$$#"+cell.m;}if(value in filterdata){rowhidden[r]=0;}}}var $top=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(cindex);if($("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']:visible:checked").length<$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']:visible").length||$("#luckysheet-pivotTableFilter-byvalue-input").val().length>0||$("#luckysheet-pivotTableFilter-bycondition").next().is(":visible")&&$("#luckysheet-pivotTableFilter-byvalue").next().is(":hidden")&&$("#luckysheet-pivotTableFilter-selected span").data("value")!="null"){$top.data("rowhidden",JSON.stringify(rowhidden)).find(".luckysheet-slider-list-item-filtered").show();luckysheet.pivotTable.setDatatojsfile("rowhidden",rowhidden,cindex);if(caljs!=null){$top.data("byconditionvalue",caljs["value"]).data("byconditiontype",caljs["type"]).data("byconditiontext",caljs["text"]);if(caljs["value1"]!=null){$top.data("byconditionvalue1",caljs["value1"]);}if(caljs["value2"]!=null){$top.data("byconditionvalue2",caljs["value2"]);}luckysheet.pivotTable.setDatatojsfile("caljs",caljs,cindex);}}else {$top.data("rowhidden","").find(".luckysheet-slider-list-item-filtered").hide();luckysheet.pivotTable.setDatatojsfile("rowhidden",null,cindex);}var newdata=[];for(var i=0;i<d.length;i++){if(i in rowhidden||i in rowhiddenother){continue;}newdata.push([].concat(d[i]));}luckysheet.pivotTable.celldata=newdata;luckysheet.pivotTable.refreshPivotTable();$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide();luckysheet.cleargridelement();});$("#luckysheet-data-pivotTable-selection .luckysheet-model-close-btn, #luckysheet-data-pivotTable-selection .luckysheet-modal-dialog-title-close").click(function(){$("#luckysheet-modal-dialog-slider-pivot").show();luckysheet.luckysheetsizeauto();$("#luckysheet-cell-main .luckysheet-pivotTable-selection-set div").show();$("#luckysheet-data-pivotTable-selection").hide();luckysheet.sheetmanage.changeSheetExec(luckysheet.pivotTable.pivotSheetIndex);luckysheet.pivotTable.luckysheet_pivotTable_select_state=false;luckysheet.cleargridelement();});$("#luckysheet-pivotTable-selection-confirm").click(function(){var $input=$("#luckysheet-pivotTable-range-selection-input"),val=$input.val();if($.trim(val).length==0||$.trim(val).toUpperCase()==luckysheet.pivotTable.jgridCurrentPivotInput.toUpperCase()){$input.val(luckysheet.pivotTable.jgridCurrentPivotInput);$("#luckysheet-data-pivotTable-selection .luckysheet-model-close-btn").click();return;}else {var val1=val.split("!");var sheettxt="",rangetxt="",sheetIndex=-1;if(val1.length>1){sheettxt=val1[0];rangetxt=val1[1];for(var i in luckysheetfile){if(sheettxt==luckysheetfile[i].name){sheetIndex=luckysheetfile[i].index;break;}}if(sheetIndex==-1){sheetIndex=0;}}else {var index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);sheettxt=luckysheetfile[index].name;sheetIndex=luckysheetfile[index].index;rangetxt=val1[0];}if(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(sheetIndex)].isPivotTable){if(luckysheet.isEditMode()){alert("不可选择数据透视表为源数据！");}else {luckysheet.tooltip.info("选择失败","不可选择数据透视表为源数据！");}$input.val(luckysheet.pivotTable.jgridCurrentPivotInput);return;}if(rangetxt.indexOf(":")==-1){if(luckysheet.isEditMode()){alert("选择失败, 输入范围错误！");}else {luckysheet.tooltip.info("选择失败","输入范围错误！");}$input.val(luckysheet.pivotTable.jgridCurrentPivotInput);return;}rangetxt=rangetxt.split(":");var row=[],col=[];row[0]=parseInt(rangetxt[0].replace(/[^0-9]/g,""))-1;row[1]=parseInt(rangetxt[1].replace(/[^0-9]/g,""))-1;if(row[0]>row[1]){if(luckysheet.isEditMode()){alert("选择失败, 输入范围错误！");}else {luckysheet.tooltip.info("选择失败","输入范围错误！");}$input.val(luckysheet.pivotTable.jgridCurrentPivotInput);return;}col[0]=luckysheet.luckysheetABCatNum(rangetxt[0].replace(/[^A-Za-z]/g,""));col[1]=luckysheet.luckysheetABCatNum(rangetxt[1].replace(/[^A-Za-z]/g,""));if(col[0]>col[1]){if(luckysheet.isEditMode()){alert("选择失败, 输入范围错误！");}else {luckysheet.tooltip.info("选择失败","输入范围错误！");}$input.val(luckysheet.pivotTable.jgridCurrentPivotInput);return;}luckysheet.sheetmanage.changeSheetExec(luckysheet.pivotTable.pivotSheetIndex);luckysheet.pivotTable.setDatatojsfile("pivot_select_save",{"row":row,"column":col});luckysheet.pivotTable.setDatatojsfile("pivotDataSheetIndex",sheetIndex);luckysheet.pivotTable.getCellData(luckysheet.pivotTable.pivotSheetIndex,sheetIndex,{"row":row,"column":col});luckysheet.pivotTable.initialPivotManage();$("#luckysheet-dialog-pivotTable-range").html(val);$("#luckysheet-modal-dialog-slider-pivot").show();$("#luckysheet-data-pivotTable-selection").hide();luckysheet.pivotTable.luckysheet_pivotTable_select_state=false;luckysheet.pivotTable.refreshPivotTable();luckysheet.luckysheetsizeauto();luckysheet.cleargridelement();}});$("#luckysheet-modal-dialog-slider-pivot").on("mousedown",".luckysheet-slider-list-item-name, .luckysheet-modal-dialog-slider-config-item-txt",function(e){//console.log("1111111111111111111111111111");
  var $cur=$(e.target);luckysheet.pivotTable.movestate=true;luckysheet.pivotTable.movesave.obj=$cur.parent();luckysheet.pivotTable.movesave.name=$cur.data("name");luckysheet.pivotTable.movesave.containerid=$cur.parent().parent().attr("id");luckysheet.pivotTable.movesave.index=$cur.data("index");if($("#luckysheet-modal-dialog-slider-pivot-move").length==0){$("body").append('<div id="luckysheet-modal-dialog-slider-pivot-move">'+luckysheet.pivotTable.movesave.name+'</div>');}luckysheet.pivotTable.movesave.width=$("#luckysheet-modal-dialog-slider-pivot-move").outerWidth();luckysheet.pivotTable.movesave.height=$("#luckysheet-modal-dialog-slider-pivot-move").outerHeight();$("#luckysheet-modal-dialog-pivotTable-list, #luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").css("cursor","default");});$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").mousemove(function(e){if(!!luckysheet.pivotTable&&luckysheet.pivotTable.movestate){if(luckysheet.pivotTable.moveitemposition.length==0){luckysheet.pivotTable.moveitemposition=[0];$(this).find(".luckysheet-modal-dialog-slider-config-item").each(function(i){var $t=$(this),h=$t.outerHeight();luckysheet.pivotTable.moveitemposition.push(luckysheet.pivotTable.moveitemposition[i]+h+2);});//luckysheet.pivotTable.moveitemposition.push($(this).outerHeight());
  $(this).append('<div id="luckysheet-modal-dialog-config-order-help" style="position:absolute;height:3px;width:100%;background:#007ACC;z-index:1;pointer-events: none;user-select:none;"></div>');//console.log(luckysheet.pivotTable.moveitemposition);
  }$("#luckysheet-modal-dialog-slider-pivot-move").css({"background":"#FD8585","color":"#fff","border":"1px solid #FD7070"});var x=event.pageX,y=event.pageY,$container=$(this);var curtop=y-$container.offset().top+$container.scrollTop();var position=luckysheet.pivotTable.moveitemposition;var row_index=luckysheet_searcharray(position,curtop);if(row_index==-1){$("#luckysheet-modal-dialog-config-order-help").css({"top":position[position.length-1]});}else if(curtop-position[row_index-1]>(position[row_index]-position[row_index-1])/2){$("#luckysheet-modal-dialog-config-order-help").css({"top":position[row_index]});}else {$("#luckysheet-modal-dialog-config-order-help").css({"top":position[row_index-1]});}}}).mouseleave(function(){if(!!luckysheet.pivotTable&&luckysheet.pivotTable.movestate){$("#luckysheet-modal-dialog-slider-pivot-move").css({"background":"#fff","color":"#000","border":"1px dotted #000"});luckysheet.pivotTable.moveitemposition=[];console.log("leave");$("#luckysheet-modal-dialog-config-order-help").remove();}}).mouseup(function(e){if(!!luckysheet.pivotTable&&luckysheet.pivotTable.movestate){var $t=$(this);var itemHTML;if(luckysheet.pivotTable.movesave.containerid==$t.attr("id")){itemHTML=luckysheet.pivotTable.movesave.obj.clone();}else {var name=luckysheet.pivotTable.movesave.name,sumtype="",nameindex="";if($t.attr("id")=="luckysheet-modal-dialog-config-value"){var type=luckysheet.pivotTable.pivot_data_type[luckysheet.pivotTable.movesave.index.toString()];if(type=="num"){name="求和:"+name;sumtype="data-sumtype='SUM'";nameindex="data-nameindex='0'";}else {name="计数:"+name;sumtype="data-sumtype='COUNTA'";nameindex="data-nameindex='0'";}$("#luckysheet-modal-dialog-config-value").find(".luckysheet-modal-dialog-slider-config-item").each(function(){if($(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text()==name){var ni=parseFloat($(this).data("nameindex"))+1;console.log($(this).data("nameindex"));name=name+ni.toString();$(this).data("nameindex",ni);return false;}});}itemHTML='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" '+nameindex+' '+sumtype+' data-index="'+luckysheet.pivotTable.movesave.index+'" data-name="'+luckysheet.pivotTable.movesave.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" '+nameindex+' '+sumtype+' data-index="'+luckysheet.pivotTable.movesave.index+'" data-name="'+luckysheet.pivotTable.movesave.name+'">'+name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';}var x=event.pageX,y=event.pageY,$container=$(this);var curtop=y-$container.offset().top+$container.scrollTop();var position=luckysheet.pivotTable.moveitemposition;var row_index=luckysheet_searcharray(position,curtop);//console.log(position, curtop, row_index);
  if(luckysheet.pivotTable.movesave.containerid=="luckysheet-modal-dialog-pivotTable-list"||luckysheet.pivotTable.movesave.containerid=="luckysheet-modal-dialog-config-value"&&luckysheet.pivotTable.movesave.containerid!=$t.attr("id")){$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column").find(".luckysheet-modal-dialog-slider-config-item").each(function(){if($(this).data("index")==luckysheet.pivotTable.movesave.index){$(this).remove();}});}if(row_index==-1){//$("#luckysheet-modal-dialog-config-order-help").css({ "top": position[position.length - 1] });
  if($t.find(".luckysheet-modal-dialog-slider-config-item").length==0){$t.append(itemHTML);}else {$t.find(".luckysheet-modal-dialog-slider-config-item").last().after(itemHTML);}}else if(curtop-position[row_index-1]>(position[row_index]-position[row_index-1])/2){//$("#luckysheet-modal-dialog-config-order-help").css({ "top": position[row_index] });
  $t.find(".luckysheet-modal-dialog-slider-config-item").eq(row_index-1).after(itemHTML);}else {//$("#luckysheet-modal-dialog-config-order-help").css({ "top": position[row_index - 1] });
  $t.find(".luckysheet-modal-dialog-slider-config-item").eq(row_index-1).before(itemHTML);}if(luckysheet.pivotTable.movesave.containerid=="luckysheet-modal-dialog-pivotTable-list");else if(luckysheet.pivotTable.movesave.containerid=="luckysheet-modal-dialog-config-value"&&luckysheet.pivotTable.movesave.containerid!=$t.attr("id"));else {luckysheet.pivotTable.movesave.obj.remove();}$("#luckysheet-modal-dialog-pivotTable-list").find(".luckysheet-modal-dialog-slider-list-item").each(function(){var $seleted=$(this).find(".luckysheet-slider-list-item-selected");if($(this).data("index")==luckysheet.pivotTable.movesave.index&&$seleted.find("i").length==0){$seleted.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>');}});luckysheet.pivotTable.refreshPivotTable();$("#luckysheet-modal-dialog-slider-pivot-move").remove();luckysheet.pivotTable.movestate=false;$("#luckysheet-modal-dialog-pivotTable-list, #luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").css("cursor","default");luckysheet.pivotTable.moveitemposition=[];$("#luckysheet-modal-dialog-config-order-help").remove();luckysheet.pivotTable.showvaluecolrow();e.stopPropagation();}});$("#luckysheet-modal-dialog-pivotTable-list").on("click",".luckysheet-slider-list-item-selected",function(){var $t=$(this),$item=$t.parent(),index=$item.data("index"),name=$item.data("name");if($t.find("i").length==0){$t.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>');var type=luckysheet.pivotTable.pivot_data_type[index.toString()],itemHTML;if(type=="num"){itemHTML='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" data-nameindex="0" data-sumtype="SUM" data-index="'+index+'" data-name="'+name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" data-nameindex="0" data-sumtype="SUM" data-index="'+index+'" data-name="'+name+'">求和:'+name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';$("#luckysheet-modal-dialog-config-value").append(itemHTML);}else {itemHTML='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" data-index="'+index+'" data-name="'+name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" data-index="'+index+'" data-name="'+name+'">'+name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';var $column=$("#luckysheet-modal-dialog-config-column"),$row=$("#luckysheet-modal-dialog-config-row");var columnitem=$column.find(".luckysheet-modal-dialog-slider-config-item"),rowitem=$row.find(".luckysheet-modal-dialog-slider-config-item");if(columnitem.length<2){$column.append(itemHTML);}else if(rowitem.length<2){$row.append(itemHTML);}else {$column.append(itemHTML);}}}else {$t.find("i").remove();$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").find(".luckysheet-modal-dialog-slider-config-item").each(function(){if($(this).data("index")==index){if($(this).parent().attr("id")=="luckysheet-modal-dialog-config-value"){luckysheet.pivotTable.resetOrderby($(this));}$(this).remove();}});}luckysheet.pivotTable.refreshPivotTable();luckysheet.pivotTable.showvaluecolrow();});$("#luckysheet-dialog-pivotTable-clearitem").click(function(){$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").find(".luckysheet-modal-dialog-slider-config-item").each(function(){$(this).remove();});$("#luckysheet-modal-dialog-pivotTable-list").find(".luckysheet-modal-dialog-slider-list-item").each(function(){$(this).find(".luckysheet-slider-list-item-selected").find("i").remove();});luckysheet.pivotTable.refreshPivotTable();luckysheet.pivotTable.showvaluecolrow();});}if(restore==null){restore=false;}if(this.celldata.length<=1&&this.celldata[0].length<=1){if(luckysheet.isEditMode()){alert("请扩大选择的数据范围!");}else {luckysheet.tooltip.info("提示","请扩大选择的数据范围!");}}var selecteditem="",selecteditemIndex=1,selecteditemtest={},selecteditemNullIndex=1;for(var i=0;i<this.celldata[0].length;i++){if(!!this.celldata[0][i]&&!!this.celldata[0][i]["m"]){// var name = this.celldata[0][i]["m"].toString();
  var name=this.celldata[0][i]["m"];}else {// var name = luckysheet.getcellvalue(0, i, this.celldata).toString();    
  var name=luckysheet.getcellvalue(0,i,this.celldata);}if(name!=null){name=name.toString();}if(name==null||$.trim(name.toString()).length==0){name="列 "+selecteditemNullIndex;}selecteditemNullIndex++;if(name in selecteditemtest){name=name+selecteditemIndex++;if(name in selecteditemtest){name=name+selecteditemIndex++;if(name in selecteditemtest){name=name+selecteditemIndex++;}}}selecteditemtest[name]=1;var dataother="",style="";//console.log(restore);
  if(restore&&this.filterparm!=null){if(this.filterparm[i.toString()]!=null){var itemset=this.filterparm[i.toString()];if(itemset.rowhidden!=null){dataother+="data-rowhidden='"+JSON.stringify(itemset.rowhidden)+"'";}if(itemset.selected!=null){dataother+="data-selected='"+JSON.stringify(itemset.selected)+"'";}if(itemset.caljs!=null){var caljsset=itemset.caljs;if(caljsset.value!=null){dataother+="data-byconditionvalue='"+caljsset.value+"'";}if(caljsset.type!=null){dataother+="data-byconditiontype='"+caljsset.type+"'";}if(caljsset.text!=null){dataother+="data-byconditiontext='"+caljsset.text+"'";}if(caljsset.value1!=null){dataother+="data-byconditionvalue1='"+caljsset.value1+"'";}if(caljsset.value2!=null){dataother+="data-byconditionvalue2='"+caljsset.value2+"'";}}}}if(dataother.length>0){style="display:block;";}selecteditem+='<div class="luckysheet-modal-dialog-slider-list-item" '+dataother+' data-index="'+i+'" data-name="'+name+'"><div title="添加列到数据透视表" class="luckysheet-slider-list-item-selected"><div></div></div><div title="移动该列到下方白框" class="luckysheet-slider-list-item-name" '+dataother+' data-index="'+i+'" data-name="'+name+'">'+name+'</div><div title="清除该列的筛选条件" class="luckysheet-slider-list-item-filtered" style="'+style+'"><i class="fa fa-filter luckysheet-mousedown-cancel" aria-hidden="true"></i><i class="fa fa-times" aria-hidden="true"></i></div><div title="筛选该列" class="luckysheet-slider-list-item-filter"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';}$("#luckysheet-modal-dialog-pivotTable-list").html(selecteditem);$("#luckysheetpivottablevaluecolrowshow").hide();$("#luckysheetpivottablevaluecolrow").prop("checked",true);$("#luckysheetpivottablevaluecolrow1").prop("checked",false);$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").empty();if(restore){if(this.filter!=null&&this.filter.length>0){for(var i=0;i<this.filter.length;i++){var item=this.filter[i];var itemHTML='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" data-index="'+item.index+'" data-name="'+item.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" data-index="'+item.index+'" data-name="'+item.name+'">'+item.name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';$("#luckysheet-modal-dialog-config-filter").append(itemHTML);var $seleted=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(item.index).find(".luckysheet-slider-list-item-selected");if($seleted.find("i").length==0){$seleted.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>');}}}if(this.row!=null&&this.row.length>0){for(var i=0;i<this.row.length;i++){var item=this.row[i];var otherset="";if(item.order!=null){otherset+="data-order = '"+item.order+"'";}if(item.orderby!=null){otherset+="data-orderby = '"+item.orderby+"'";}if(item.order!=null){otherset+="data-stastic = '"+item.stastic+"'";}var itemHTML='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" '+otherset+' data-index="'+item.index+'" data-name="'+item.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" '+otherset+' data-index="'+item.index+'" data-name="'+item.name+'">'+item.name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';$("#luckysheet-modal-dialog-config-row").append(itemHTML);var $seleted=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(item.index).find(".luckysheet-slider-list-item-selected");if($seleted.find("i").length==0){$seleted.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>');}}}if(this.column!=null&&this.column.length>0){for(var i=0;i<this.column.length;i++){var item=this.column[i];var otherset="";if(item.order!=null){otherset+="data-order = '"+item.order+"'";}if(item.orderby!=null){otherset+="data-orderby = '"+item.orderby+"'";}if(item.order!=null){otherset+="data-stastic = '"+item.stastic+"'";}var itemHTML='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" '+otherset+' data-index="'+item.index+'" data-name="'+item.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" '+otherset+' data-index="'+item.index+'" data-name="'+item.name+'">'+item.name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';$("#luckysheet-modal-dialog-config-column").append(itemHTML);var $seleted=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(item.index).find(".luckysheet-slider-list-item-selected");if($seleted.find("i").length==0){$seleted.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>');}}}if(this.values!=null&&this.values.length>0){for(var i=0;i<this.values.length;i++){var item=this.values[i];var otherset="";if(item.sumtype!=null){otherset+="data-sumtype = '"+item.sumtype+"'";}if(item.nameindex!=null){otherset+="data-nameindex = '"+item.nameindex+"'";}var itemHTML='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" '+otherset+' data-index="'+item.index+'" data-name="'+item.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" '+otherset+' data-index="'+item.index+'" data-name="'+item.name+'">'+luckysheet.pivotTable.getSumTypeName(item.sumtype)+":"+item.name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';$("#luckysheet-modal-dialog-config-value").append(itemHTML);var $seleted=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(item.index).find(".luckysheet-slider-list-item-selected");if($seleted.find("i").length==0){$seleted.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>');}}if(this.values.length>=2){$("#luckysheetpivottablevaluecolrowshow").show();if(this.showType=="column"){$("#luckysheetpivottablevaluecolrow").prop("checked",true);$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow']").addClass("ui-state-active");$("#luckysheetpivottablevaluecolrow1").prop("checked",false);$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow1']").removeClass("ui-state-active");}else {$("#luckysheetpivottablevaluecolrow1").prop("checked",true);$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow1']").addClass("ui-state-active");$("#luckysheetpivottablevaluecolrow").prop("checked",false);$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow']").removeClass("ui-state-active");}}}}$("#luckysheet-dialog-pivotTable-range").html(luckysheet.sheetmanage.getRangetxt(this.pivotDataSheetIndex,this.pivot_select_save));$("#luckysheet-modal-dialog-slider-pivot").show();luckysheet.luckysheetsizeauto();},//generatePivotTable:function(column1, row1, values1, filter1, showType1){
  //  this.column = column1;
  //    this.row = row1;
  //    this.values = values1;
  //    this.filter = filter1;
  //    this.showType = showType1;
  //  this.dataHandler(column1, row1, values1, filter1, showType1, this.celldata);
  //},
  getComposeArray:function getComposeArray(data){if(data.length==0){return [];}var ret=[];for(var i=0;i<data.length;i++){//var c_value = data[i];
  var name="";for(var x=0;x<=i;x++){if(!!data[x]&&!!data[x]["m"]){name+=data[x]["m"];}else {name+=luckysheet.getcellvalue(x,null,data);}}ret.push(name);}return ret;},getnameArray:function getnameArray(data,field){if(data.length==0){return [];}if(field.length==0){return [];}var ret=[];for(var i=0;i<field.length;i++){if(!!data[field[i].index]&&!!data[field[i].index]["m"]){var c_value=data[field[i].index]["m"];}else {var c_value=luckysheet.getcellvalue(field[i].index,null,data);}ret.push(c_value);}return ret;},getTitleFromGroup:function getTitleFromGroup(group,config,dataposition){var children=group.children;var orderbygroup=this.orderbygroup(group,config,dataposition);//console.log(orderbygroup);
  return this.generategrouparraymain(orderbygroup,config);},orderbygroup:function orderbygroup(group,config,dataposition){var stackset=[];if(group.length==0){return [];}stackset=group;var d=null,alllength=stackset.length,alllengthInital=stackset.length,a=0;while(alllength!=0){//console.log(alllength, a);
  d=stackset[a++];alllength--;if(d.children!=null&&d.children.length>0){//console.log(JSON.stringify(d.children));
  d.children=this.orderbygroupchildren(d.children,config[d.index].orderby,config[d.index].order,dataposition);//console.log(JSON.stringify(d.children));
  for(var i=0;i<d.children.length;i++){stackset.push(d.children[i]);alllength++;}}//console.log(stackset, stackset.length, stackset.length == 0);
  }return group.splice(0,alllengthInital);},orderbygroupchildren:function orderbygroupchildren(childrens,orderby,order,dataposition){if(childrens.length==0){return [];}var isAsc=false;if(order==null||order=="asc"){isAsc=true;}var a=function a(x,y){var f=null,s=null;if(orderby=="self"||orderby==null){if(x.name==null){f="(空白)";}else {f=x.name.toString();}if(y.name==null){s="(空白)";}else {s=y.name.toString();}if(luckysheet.datecontroll.isdatetime(f)&&luckysheet.datecontroll.isdatetime(s)){return luckysheet.datecontroll.diff(f,s);}//return f.localeCompare(s);
  }else {f=parseFloat(dataposition[x.orderby].result);s=parseFloat(dataposition[y.orderby].result);}if(!isNaN(f)&&!isNaN(s)){return numeral(f).value()-numeral(s).value();}else if(isNaN(f)&&isNaN(s)){return f.localeCompare(s);}else if(isNaN(f)){return 1;}else if(isNaN(s)){return -1;}};var d=function d(x,y){var f=null,s=null;if(orderby=="self"||orderby==null){if(x.name==null){f="(空白)";}else {f=x.name.toString();}if(y.name==null){s="(空白)";}else {s=y.name.toString();}if(luckysheet.datecontroll.isdatetime(f)&&luckysheet.datecontroll.isdatetime(s)){return luckysheet.datecontroll.diff(f,s);}//return s.localeCompare(f);
  }else {f=parseFloat(dataposition[x.orderby].result);s=parseFloat(dataposition[y.orderby].result);}if(!isNaN(f)&&!isNaN(s)){return numeral(s).value()-numeral(f).value();}else if(isNaN(f)&&isNaN(s)){return s.localeCompare(f);}else if(isNaN(f)){return -1;}else if(isNaN(s)){return 1;}};if(isAsc){return childrens.sort(a);}else {return childrens.sort(d);}},generategroupaddstatic:function generategroupaddstatic(arr,name){var stasticarr=[];for(var a=0;a<arr[0].length;a++){if(a==0){if(name=="总计"){stasticarr.push(name);}else {stasticarr.push({"name":name,"issum":true});}}else {stasticarr.push("");}}return stasticarr;},generategrouparraymain:function generategrouparraymain(group,config){//生成数组
  var ret=[];for(var i=0;i<group.length;i++){var name=group[i].name;var arr=this.generategrouparray(group[i].children,config,1);if(config[0].stastic=="1"||config[0].stastic==null){arr.push(this.generategroupaddstatic(arr,name));}ret=ret.concat(arr);}return ret;},generategrouparray:function generategrouparray(group,config,level){var ret=[];for(var i=0;i<group.length;i++){var name=group[i].name;var arr;if(group[i].children==0||group[i].children.length==0){arr=[name];ret.push(arr);}else {arr=this.generategrouparray(group[i].children,config,level+1);for(var a=0;a<arr.length;a++){arr[a].unshift(name);}if(config[level].stastic=="1"||config[level].stastic==null){arr.push(this.generategroupaddstatic(arr,name));}ret=ret.concat(arr);}}//console.log(JSON.stringify(ret));
  return ret;},addStatisticsData:function addStatisticsData(dataposition,valueobj,indicator,d_value){if(dataposition[indicator]==null){dataposition[indicator]={"data":[],"count":0,"max":-Infinity,"min":Infinity,"counta":0,"countunique":0,"countuniquedata":{},"sum":0,digitaldata:[],"sumtype":valueobj.sumtype,"index":valueobj.index,"name":valueobj.fullname,"acc":0};}if(luckysheet.isdatatypemulti(d_value)["num"]===true){var num=luckysheet.numFormat(d_value);dataposition[indicator]["digitaldata"].push(num);dataposition[indicator]["count"]+=1;dataposition[indicator]["sum"]+=num;if(num>dataposition[indicator]["max"]){dataposition[indicator]["max"]=num;}if(num<dataposition[indicator]["min"]){dataposition[indicator]["min"]=num;}var newAcc=luckysheet.numfloatlen(num);if(newAcc>dataposition[indicator]["acc"]){dataposition[indicator]["acc"]=newAcc;}}if(d_value!=""){dataposition[indicator]["data"].push(d_value);dataposition[indicator]["counta"]+=1;if(!(d_value in dataposition[indicator]["countuniquedata"])){dataposition[indicator]["countuniquedata"][d_value]=1;dataposition[indicator]["countunique"]+=1;}}},dataHandler:function dataHandler(column,row,values,showType,celldata){//column:[{"index":1, name:"列1", "order":"asc", "orderby":"self/0/1/2", "stastic":"0/1"}]
  //row:[{"index":1, name:"列3", "order":"asc", "orderby":"self/0/1/2", "stastic":"0/1"}]
  //values:[{"index":1, "sumtype":"SUM/COUNT/COUNTA/COUNTUNIQUE/AVERAGE/MAX/MIN/MEDIAN/PRODUCT/STDEV/STDEVP/VAR/VARP", "name":"求和:fyc"}]
  if(showType==null){showType="column";}if(column.length==0&&row.length==0&&values.length==0||celldata.length==0){this.pivotDatas=[];return [];}//生成透视表值及定位
  var dataposition={},data=celldata,datarowtitle=[],datarowtitlegroup=[],datarowposition={},datacoltitle=[],datacoltitlegroup=[],datacolposition={};for(var i=1;i<data.length;i++){var d=data[i];var rowtitle=[],rowtitlename=[],coltitle=[],coltitlename=[];//for (var r = 0; r < row.length; r++) {
  //       var c_value = d[row[r].index];
  //       groupbyrowtxt += "|row" + c_value.toString();
  //       rowtxt += c_value.toString();
  //       rowtitle.push(c_value);
  //   }
  //   if (rowtxt!="" && datarowposition[rowtxt] == null) {
  //       datarowposition[rowtxt] = datarowposition_i++;
  //       datarowtitle.push(rowtitle);
  //   }
  //   for (var c = 0; c < column.length; c++) {
  //       var c_value = d[column[c].index];
  //       groupbycoltxt += "|col" + c_value.toString();
  //       coltxt += c_value.toString();
  //       coltitle.push(c_value);
  //   }
  //   if (coltxt != "" && datacolposition[coltxt] == null) {
  //       datacolposition[coltxt] = datacolposition_i++;
  //       datacoltitle.push(coltitle);
  //   }
  //["四川", "成都", "邛崃"] 转换为 ["四川", "四川成都", "四川成都邛崃"]
  rowtitlename=this.getnameArray(d,row);coltitlename=this.getnameArray(d,column);rowtitle=this.getComposeArray(rowtitlename);coltitle=this.getComposeArray(coltitlename);if(rowtitle.length>0){rowtitle.unshift("总计");}if(coltitle.length>0){coltitle.unshift("总计");}var curentLevelobj=datarowposition,curentLevelarr=datarowtitlegroup;for(var r=0;r<rowtitle.length;r++){var item=rowtitle[r],name=r==0?"总计":rowtitlename[r-1];//修改
  if(curentLevelobj[r.toString()]!=null&&curentLevelobj[r.toString()][item]!=null){//修改
  curentLevelarr=curentLevelarr[curentLevelobj[r.toString()][item]].children;}else {var orderby=r==0?"self":row[r-1].orderby=="self"||row[r-1].orderby==null?item:showType=="column"?item+values[parseInt(row[r-1].orderby)].fullname:item+"合计";if(name==null){name="(空白)";}curentLevelarr.push({"name":name,"fullname":item,"index":r,"orderby":orderby,"children":[]});if(curentLevelobj[r.toString()]==null){curentLevelobj[r.toString()]={};}if(curentLevelobj[r.toString()][item]==null){curentLevelobj[r.toString()][item]=curentLevelarr.length-1;}curentLevelarr=curentLevelarr[curentLevelarr.length-1].children;}}var curentLevelobj=datacolposition,curentLevelarr=datacoltitlegroup;for(var r=0;r<coltitle.length;r++){var item=coltitle[r],name=r==0?"总计":coltitlename[r-1];if(curentLevelobj[r.toString()]!=null&&curentLevelobj[r.toString()][item]!=null){curentLevelarr=curentLevelarr[curentLevelobj[r.toString()][item]].children;}else {var orderby=r==0?"self":column[r-1].orderby=="self"||column[r-1].orderby==null?item:showType=="column"?"合计"+item:values[parseInt(column[r-1].orderby)].fullname+item;if(name==null){name="(空白)";}curentLevelarr.push({"name":name,"fullname":item,"index":r,"orderby":orderby,"children":[]});if(curentLevelobj[r.toString()]==null){curentLevelobj[r.toString()]={};}if(curentLevelobj[r.toString()][item]==null){curentLevelobj[r.toString()][item]=curentLevelarr.length-1;}curentLevelarr=curentLevelarr[curentLevelarr.length-1].children;}}for(var v=0;v<values.length;v++){var d_value=luckysheet.getcellvalue(values[v].index,null,d);//      var indicator = "";
  //      if (showType=="column"){
  //          indicator = groupbyrowtxt + groupbycoltxt;
  //          if (indicator != "") {
  //              indicator = indicator.substr(1) + "|col" + values[v].fullname;
  //          }
  //          else {
  //              indicator = "col" + values[v].fullname;
  //          }
  //}
  //else{
  //          if (groupbyrowtxt != "") {
  //              indicator = groupbyrowtxt.substr(1) + "|row" + values[v].fullname + groupbycoltxt;
  //          }
  //          else {
  //              indicator = "row" + values[v].fullname + groupbycoltxt;
  //          }
  //}
  var coltitle_c=[].concat(coltitle),rowtitle_c=[].concat(rowtitle);if(showType=="column"){if(coltitle_c.length>0){coltitle_c.push("");coltitle_c=coltitle_c.join(values[v].fullname+"|||").split("|||").slice(0,coltitle_c.length-1);}else {coltitle_c.push(values[v].fullname);}}else {if(rowtitle_c.length>0){//rowtitle_c.push(rowtitle_c[rowtitle_c.length-1] + values[v].fullname);
  //rowtitle_c = (values[v].fullname + rowtitle_c.join("|||" + values[v].fullname)).split("|||");
  rowtitle_c.push("");rowtitle_c=rowtitle_c.join(values[v].fullname+"|||").split("|||").slice(0,rowtitle_c.length-1);}else {rowtitle_c.push(values[v].fullname);}}if(coltitle_c.length==0){coltitle_c.push("");}if(rowtitle_c.length==0){rowtitle_c.push("");}for(var r=0;r<rowtitle_c.length;r++){for(var c=0;c<coltitle_c.length;c++){indicator=rowtitle_c[r]+coltitle_c[c];this.addStatisticsData(dataposition,values[v],indicator,d_value);}}//if (dataposition[indicator] == null) {
  //    dataposition[indicator] = { "data": [], "count": 0, "max": -Infinity, "min": Infinity, "counta": 0, "countunique": 0, "countuniquedata": {}, "sum": 0, digitaldata:[], "sumtype": values[v].sumtype, "index": values[v].index, "name": values[v].fullname };
  //}
  //if (luckysheet.isdatatypemulti(d_value)["num"] === true ) {
  //    var num = luckysheet.numFormat(d_value);
  //    dataposition[indicator]["digitaldata"].push(num);
  //    dataposition[indicator]["count"] += 1;
  //    dataposition[indicator]["sum"] += num;
  //    if (num > dataposition[indicator]["max"]) {
  //        dataposition[indicator]["max"] = num;
  //    }
  //    if (num < dataposition[indicator]["min"]) {
  //        dataposition[indicator]["min"] = num;
  //    }
  //}
  //if (d_value != "") {
  //    dataposition[indicator]["data"].push(d_value);
  //    dataposition[indicator]["counta"] += 1;
  //    if (!(d_value in dataposition[indicator]["countuniquedata"])){
  //        dataposition[indicator]["countuniquedata"]["d_value"] = 1;
  //        dataposition[indicator]["countunique"] += 1;
  //    }
  //}
  }}//计算值列
  //SUM/COUNT/COUNTA/COUNTUNIQUE/AVERAGE/MAX/MIN/MEDIAN/PRODUCT/STDEV/STDEVP/VAR/VARP
  for(indicator in dataposition){var json=dataposition[indicator];if(json.sumtype=="SUM"){json.result=json.sum;}else if(json.sumtype=="COUNT"){json.result=json.count;}else if(json.sumtype=="COUNTA"){json.result=json.counta;}else if(json.sumtype=="COUNTUNIQUE"){json.result=json.countunique;}else if(json.sumtype=="AVERAGE"){json.result=luckysheet.numFormat(json.sum/json.count);}else if(json.sumtype=="MAX"){json.result=json.max;}else if(json.sumtype=="MIN"){json.result=json.min;}else if(json.sumtype=="MEDIAN"){var numArr=json.digitaldata.sort(function(a,b){return a-b;});var numLen=numArr.length;var numindex=parseInt(numLen/2);if(numLen%2==0){json.result=(numArr[numindex-1]+numArr[numindex])/2;}else {json.result=numArr[numindex];}}else if(json.sumtype=="PRODUCT"){json.result=eval(json.digitaldata.join("*"));}else if(json.sumtype=="STDEV"){var mean=json.sum/json.count;json.result=luckysheet.analysis.STDEV(mean,json.digitaldata);}else if(json.sumtype=="STDEVP"){var mean=json.sum/json.count;json.result=luckysheet.analysis.STDEVP(mean,json.digitaldata);}else if(json.sumtype=="VAR"){var mean=json.sum/json.count;json.result=luckysheet.analysis.VAR(mean,json.digitaldata);}else if(json.sumtype=="VARP"){var mean=json.sum/json.count;json.result=luckysheet.analysis.VARP(mean,json.digitaldata);}var newAcc=luckysheet.numfloatlen(json.result);if(newAcc>json.acc){json.acc=newAcc;}json.result=luckysheet.numFormat(json.result,json.acc);}datarowtitle=this.getTitleFromGroup(datarowtitlegroup,row,dataposition);datacoltitle=this.getTitleFromGroup(datacoltitlegroup,column,dataposition);//加入值到列/行形成新的表头
  if(showType=="column"){if(datacoltitle.length>0&&datacoltitle[0].length>0){datacoltitle=this.addValuesToTitle(datacoltitle,values);}else {for(var v=0;v<values.length;v++){datacoltitle.push([values[v].fullname]);}}}else {if(datarowtitle.length>0&&datarowtitle[0].length>0){datarowtitle=this.addValuesToTitle(datarowtitle,values);}else {for(var v=0;v<values.length;v++){datarowtitle.push([values[v].fullname]);}}}var datacoltitle_index=datacoltitle;datacoltitle=luckysheet.array.transpose(datacoltitle);var valuenslen=values.length==0?0:1;var rowLen=(datacoltitle.length==0?valuenslen:datacoltitle.length)+(datarowtitle.length==0?valuenslen:datarowtitle.length),colLen=(datacoltitle.length==0?valuenslen:datacoltitle[0].length)+(datarowtitle.length==0?valuenslen:datarowtitle[0].length);var rowOver=datacoltitle.length,colOver=datarowtitle.length==0?0:datarowtitle[0].length;var retdata=[];for(var r=0;r<rowLen;r++){retdata[r]=new Array(colLen);for(var c=0;c<colLen;c++){var drt=datarowtitle[r-rowOver];if(r<rowOver&&c<colOver){//空白列头
  retdata[r][c]="";}else if(r<rowOver&&c>=colOver){//列标题
  if(datacoltitle[r]!=null){if(luckysheet.getObjType(datacoltitle[r][c-colOver])=="object"){retdata[r][c]=datacoltitle[r][c-colOver].name+"总计";}else {retdata[r][c]=datacoltitle[r][c-colOver];}}else {retdata[r][c]="";}}else if(r>=rowOver&&c<colOver){//行标题
  if(drt!=null){//retdata[r][c] = datarowtitle[r - rowOver][c];
  if(luckysheet.getObjType(drt[c])=="object"){retdata[r][c]=drt[c].name+"总计";}else {retdata[r][c]=drt[c];}}else {retdata[r][c]="";}}else {//单元格内容
  var prefix="";if(drt!=null){if(!(drt instanceof Array)||drt.length==1){if(drt instanceof Array){prefix=drt[0];}else {prefix=drt;}}else {for(var x=0;x<drt.length;x++){if(luckysheet.getObjType(drt[x])=="object"){prefix+=drt[x].name;}else {prefix+=drt[x];}}}}var suffix="";var dct=datacoltitle_index[c-colOver];if(dct!=null){if(!(dct instanceof Array)||dct.length==1){if(dct instanceof Array){suffix=dct[0];}else {suffix=dct;}}else {for(var x=0;x<dct.length;x++){if(luckysheet.getObjType(dct[x])=="object"){suffix+=dct[x].name;}else {suffix+=dct[x];}}//suffix = dct.join("");
  }}var indicator=prefix;if(prefix!=""&&suffix!=""){indicator=prefix+suffix;}else if(prefix==""){indicator=suffix;}if(dataposition[indicator]==null){retdata[r][c]="";}else {retdata[r][c]=dataposition[indicator].result;}}}}if(values.length==1&&column.length>0){retdata[0][0]=values[0].fullname;retdata.splice(column.length,1);}this.pivotDatas=retdata;return retdata;},drillDown:function drillDown(row_index,col_index){var cell=this.pivotDatas[row_index][col_index];var d=$.extend(true,[],luckysheet.sheetmanage.nulldata);var selecteditemNullIndex=1;for(var i=0;i<this.celldata[0].length;i++){if(!!this.celldata[0][i]&&!!this.celldata[0][i]["m"]){var name=this.celldata[0][i]["m"];}else {var name=luckysheet.getcellvalue(0,i,this.celldata);}if(name!=null){name=name.toString();}if(name==null||$.trim(name.toString()).length==0){name="列 "+selecteditemNullIndex;}selecteditemNullIndex++;d[0][i]=name;}// if(cell == null || cell == ""){
  //     luckysheet_select_save = [{ "row": [0, 1], "column": [0, this.celldata[0].length - 1] }];
  // }
  // else{
  var obj={};//行
  if(this.row!=null&&this.row.length>0){for(var a=0;a<this.row.length;a++){obj[this.row[a]["index"]]=this.pivotDatas[row_index][a];}}//列
  if(this.column!=null&&this.column.length>0){for(var b=0;b<this.column.length;b++){obj[this.column[b]["index"]]=this.pivotDatas[b][col_index];}}var rowArr=[];for(var j=1;j<this.celldata.length;j++){var isEqual=true;for(x in obj){if(!!this.celldata[j][x]&&!!this.celldata[j][x]["m"]){var value=this.celldata[j][x]["m"];}else {var value=luckysheet.getcellvalue(j,x,this.celldata);}if(value!=null){value=value.toString();}else {value="(空白)";}if(value!=obj[x]){isEqual=false;break;}}if(isEqual){rowArr.push(j);}}for(var r=0;r<rowArr.length;r++){for(var c=0;c<this.celldata[0].length;c++){if(!!this.celldata[rowArr[r]][c]&&!!this.celldata[rowArr[r]][c]["m"]){var value=this.celldata[rowArr[r]][c]["m"];}else {var value=luckysheet.getcellvalue(rowArr[r],c,this.celldata);}if(value!=null){value=value.toString();}else {value="";}d[r+1][c]=value;}}luckysheet_select_save=[{"row":[0,rowArr.length],"column":[0,this.celldata[0].length-1]}];// }
  clearjfundo=false;luckysheet.jfrefreshgrid(d,luckysheet_select_save);luckysheet.selectHightlightShow();clearjfundo=true;}};luckysheet.freezen={freezenHorizontalHTML:'<div id="luckysheet-freezebar-horizontal" class="luckysheet-freezebar" tabindex="0"><div class="luckysheet-freezebar-handle luckysheet-freezebar-horizontal-handle" ><div class="luckysheet-freezebar-handle-bar luckysheet-freezebar-horizontal-handle-title" ></div><div class="luckysheet-freezebar-handle-bar luckysheet-freezebar-horizontal-handle-bar" ></div></div><div class="luckysheet-freezebar-drop luckysheet-freezebar-horizontal-drop" ><div class="luckysheet-freezebar-drop-bar luckysheet-freezebar-horizontal-drop-title" ></div><div class="luckysheet-freezebar-drop-bar luckysheet-freezebar-horizontal-drop-bar" >&nbsp;</div></div></div>',freezenVerticalHTML:'<div id="luckysheet-freezebar-vertical" class="luckysheet-freezebar" tabindex="0"><div class="luckysheet-freezebar-handle luckysheet-freezebar-vertical-handle" ><div class="luckysheet-freezebar-handle-bar luckysheet-freezebar-vertical-handle-title" ></div><div class="luckysheet-freezebar-handle-bar luckysheet-freezebar-vertical-handle-bar" ></div></div><div class="luckysheet-freezebar-drop luckysheet-freezebar-vertical-drop" ><div class="luckysheet-freezebar-drop-bar luckysheet-freezebar-vertical-drop-title" ></div><div class="luckysheet-freezebar-drop-bar luckysheet-freezebar-vertical-drop-bar" >&nbsp;</div></div></div>',initialHorizontal:true,initialVertical:true,horizontalmovestate:false,horizontalmoveposition:null,verticalmovestate:false,verticalmoveposition:null,windowHeight:null,windowWidth:null,freezenhorizontaldata:null,freezenverticaldata:null,cutVolumn:function cutVolumn(arr,cutindex){if(cutindex<=0){return arr;}var pre=arr.slice(0,cutindex);var premax=pre[pre.length-1];var ret=arr.slice(cutindex);for(var i=0;i<ret.length;i++){ret[i]-=premax;}return ret;},cancelFreezenVertical:function cancelFreezenVertical(sheetIndex){$("#luckysheet-freezen-btn-vertical").html('<i class="fa fa-indent"></i> 冻结首列');luckysheet.freezen.freezenverticaldata=null;var isvertical=$("#luckysheet-freezebar-vertical").is(":visible");$("#luckysheet-freezebar-vertical").hide();if(sheetIndex==null){sheetIndex=luckysheet.currentSheetIndex;}var currentSheet=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(sheetIndex)];if(currentSheet.freezen!=null){currentSheet.freezen.vertical=null;}if(currentSheet.freezen!=null&&isvertical){luckysheet.server.saveParam("all",sheetIndex,currentSheet.freezen,{"k":"freezen"});}},createFreezenVertical:function createFreezenVertical(freezenverticaldata,left){if(this.initialVertical){this.initialVertical=false;$("#luckysheet-grid-window-1").append(this.freezenVerticalHTML);$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-drop").hover(function(){$(this).parent().addClass("luckysheet-freezebar-hover");},function(){$(this).parent().removeClass("luckysheet-freezebar-hover");});$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-drop").mousedown(function(){luckysheet.freezen.verticalmovestate=true;luckysheet.freezen.verticalmoveposition=$(this).position().left;luckysheet.freezen.windowWidth=$("#luckysheet-grid-window-1").width();$(this).parent().addClass("luckysheet-freezebar-active");$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-handle").css("cursor","-webkit-grabbing");});var gridheight=$("#luckysheet-grid-window-1").height();$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-handle").css({"height":gridheight-10,"width":"4px","cursor":"-webkit-grab","top":"0px"}).end().find(".luckysheet-freezebar-vertical-drop").css({"height":gridheight-10,"width":"4px","top":"0px","cursor":"-webkit-grab"});}if(freezenverticaldata==null){var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var dataset_col_st=luckysheet_searcharray(visibledatacolumn,scrollLeft);if(dataset_col_st==-1){dataset_col_st=0;}left=visibledatacolumn[dataset_col_st]-2-scrollLeft+rowHeaderWidth;freezenverticaldata=[visibledatacolumn[dataset_col_st],dataset_col_st+1,scrollLeft,luckysheet.freezen.cutVolumn(visibledatacolumn,dataset_col_st+1),left];luckysheet.freezen.saveFreezen(null,null,freezenverticaldata,left);}luckysheet.freezen.freezenverticaldata=freezenverticaldata;$("#luckysheet-freezen-btn-horizontal").html('<i class="fa fa-indent"></i> 取消冻结');$("#luckysheet-freezebar-vertical").show().find(".luckysheet-freezebar-vertical-handle").css({"left":left}).end().find(".luckysheet-freezebar-vertical-drop").css({"left":left});},saveFreezen:function saveFreezen(freezenhorizontaldata,top,freezenverticaldata,left){var currentSheet=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];if(currentSheet.freezen==null){currentSheet.freezen={};}if(freezenhorizontaldata!=null){if(currentSheet.freezen.horizontal==null){currentSheet.freezen.horizontal={};}currentSheet.freezen.horizontal.freezenhorizontaldata=freezenhorizontaldata;currentSheet.freezen.horizontal.top=top;}if(freezenverticaldata!=null){if(currentSheet.freezen.vertical==null){currentSheet.freezen.vertical={};}currentSheet.freezen.vertical.freezenverticaldata=freezenverticaldata;currentSheet.freezen.vertical.left=left;}if(currentSheet.freezen!=null){luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,currentSheet.freezen,{"k":"freezen"});}},initialFreezen:function initialFreezen(sheetIndex){var currentSheet=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(sheetIndex)];if(currentSheet.freezen!=null&&currentSheet.freezen.horizontal!=null&&currentSheet.freezen.horizontal.freezenhorizontaldata!=null){this.createFreezenHorizontal(currentSheet.freezen.horizontal.freezenhorizontaldata,currentSheet.freezen.horizontal.top);}else {this.cancelFreezenHorizontal(sheetIndex);}if(currentSheet.freezen!=null&&currentSheet.freezen.vertical!=null&&currentSheet.freezen.vertical.freezenverticaldata!=null){this.createFreezenVertical(currentSheet.freezen.vertical.freezenverticaldata,currentSheet.freezen.vertical.left);}else {this.cancelFreezenVertical(sheetIndex);}this.createAssistCanvas();},changeFreezenIndex:function changeFreezenIndex(originindex,type){if(type=="v"&&this.freezenverticaldata!=null){var freezen_colindex=this.freezenverticaldata[1];var offset=luckysheet_searcharray(visibledatacolumn,$("#luckysheet-cell-main").scrollLeft());if(originindex-offset<freezen_colindex){originindex=originindex-offset;}}else if(type=="h"&&this.freezenhorizontaldata!=null){var freezen_rowindex=this.freezenhorizontaldata[1];var offset=luckysheet_searcharray(visibledatarow,$("#luckysheet-cell-main").scrollTop());if(originindex-offset<freezen_rowindex){originindex=originindex-offset;}}return originindex;},scrollFreezen:function scrollFreezen(){var row_focus=luckysheet_select_save[0]["row_focus"];if(row_focus==luckysheet_select_save[0]["row"][0]){var row=luckysheet_select_save[0]["row"][1];}else if(row_focus==luckysheet_select_save[0]["row"][1]){var row=luckysheet_select_save[0]["row"][0];}var column_focus=luckysheet_select_save[0]["column_focus"];if(column_focus==luckysheet_select_save[0]["column"][0]){var column=luckysheet_select_save[0]["column"][1];}else if(column_focus==luckysheet_select_save[0]["column"][1]){var column=luckysheet_select_save[0]["column"][0];}if(this.freezenverticaldata!=null){var freezen_colindex=this.freezenverticaldata[1];var offset=luckysheet_searcharray(this.freezenverticaldata[3],$("#luckysheet-cell-main").scrollLeft());freezen_colindex+=offset;if(column<=freezen_colindex){setTimeout(function(){$("#luckysheet-scrollbar-x").scrollLeft(0);},10);}}if(this.freezenhorizontaldata!=null){var freezen_rowindex=this.freezenhorizontaldata[1];var offset=luckysheet_searcharray(this.freezenhorizontaldata[3],$("#luckysheet-cell-main").scrollTop());freezen_rowindex+=offset;if(row<=freezen_rowindex){setTimeout(function(){$("#luckysheet-scrollbar-y").scrollTop(0);},10);}}},cancelFreezenHorizontal:function cancelFreezenHorizontal(sheetIndex){$("#luckysheet-freezen-btn-horizontal").html('<i class="fa fa-list-alt"></i> 冻结首行');luckysheet.freezen.freezenhorizontaldata=null;var ishorizontal=$("#luckysheet-freezebar-horizontal").is(":visible");$("#luckysheet-freezebar-horizontal").hide();if(sheetIndex==null){sheetIndex=luckysheet.currentSheetIndex;}var currentSheet=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(sheetIndex)];if(currentSheet.freezen!=null){currentSheet.freezen.horizontal=null;}if(currentSheet.freezen!=null&&ishorizontal){luckysheet.server.saveParam("all",sheetIndex,currentSheet.freezen,{"k":"freezen"});}},createFreezenHorizontal:function createFreezenHorizontal(freezenhorizontaldata,top){if(this.initialHorizontal){this.initialHorizontal=false;$("#luckysheet-grid-window-1").append(this.freezenHorizontalHTML);$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-drop").hover(function(){$(this).parent().addClass("luckysheet-freezebar-hover");},function(){$(this).parent().removeClass("luckysheet-freezebar-hover");});$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-drop").mousedown(function(){luckysheet.freezen.horizontalmovestate=true;luckysheet.freezen.horizontalmoveposition=$(this).position().top;luckysheet.freezen.windowHeight=$("#luckysheet-grid-window-1").height();$(this).parent().addClass("luckysheet-freezebar-active");$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-handle").css("cursor","-webkit-grabbing");});var gridwidth=$("#luckysheet-grid-window-1").width();$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-handle").css({"width":gridwidth-10,"height":"4px","cursor":"-webkit-grab","left":"0px"}).end().find(".luckysheet-freezebar-horizontal-drop").css({"width":gridwidth-10,"height":"4px","left":"0px","cursor":"-webkit-grab"});}if(freezenhorizontaldata==null){var scrollTop=$("#luckysheet-cell-main").scrollTop();var dataset_row_st=luckysheet_searcharray(visibledatarow,scrollTop);if(dataset_row_st==-1){dataset_row_st=0;}top=visibledatarow[dataset_row_st]-2-scrollTop+columeHeaderHeight;freezenhorizontaldata=[visibledatarow[dataset_row_st],dataset_row_st+1,scrollTop,luckysheet.freezen.cutVolumn(visibledatarow,dataset_row_st+1),top];luckysheet.freezen.saveFreezen(freezenhorizontaldata,top,null,null);}luckysheet.freezen.freezenhorizontaldata=freezenhorizontaldata;$("#luckysheet-freezen-btn-horizontal").html('<i class="fa fa-list-alt"></i> 取消冻结');$("#luckysheet-freezebar-horizontal").show().find(".luckysheet-freezebar-horizontal-handle").css({"top":top}).end().find(".luckysheet-freezebar-horizontal-drop").css({"top":top});},createAssistCanvas:function createAssistCanvas(){var _this=this;_this.removeAssistCanvas();if(_this.freezenverticaldata!=null||_this.freezenhorizontaldata!=null){var freezen_horizon_px,freezen_horizon_ed,freezen_horizon_scrollTop;var freezen_vertical_px,freezen_vertical_ed,freezen_vertical_scrollTop;var drawWidth=luckysheetTableContentHW[0],drawHeight=luckysheetTableContentHW[1];//双向freezen开始
  if(_this.freezenverticaldata!=null&&_this.freezenhorizontaldata!=null){freezen_horizon_px=_this.freezenhorizontaldata[0];freezen_horizon_ed=_this.freezenhorizontaldata[1];freezen_horizon_scrollTop=_this.freezenhorizontaldata[2];freezen_vertical_px=_this.freezenverticaldata[0];freezen_vertical_ed=_this.freezenverticaldata[1];freezen_vertical_scrollTop=_this.freezenverticaldata[2];//3
  // _this.createCanvas("freezen_3",freezen_vertical_px - freezen_vertical_scrollTop, freezen_horizon_px-freezen_horizon_scrollTop+1, rowHeaderWidth, columeHeaderHeight);
  _this.createCanvas("freezen_3",freezen_vertical_px-freezen_vertical_scrollTop,freezen_horizon_px-freezen_horizon_scrollTop+1,rowHeaderWidth-1,columeHeaderHeight-1);//4
  // _this.createCanvas("freezen_4",drawWidth - freezen_vertical_px + freezen_vertical_scrollTop, freezen_horizon_px-freezen_horizon_scrollTop+1, freezen_vertical_px - freezen_vertical_scrollTop + rowHeaderWidth,columeHeaderHeight);
  _this.createCanvas("freezen_4",drawWidth-freezen_vertical_px+freezen_vertical_scrollTop,freezen_horizon_px-freezen_horizon_scrollTop+1,freezen_vertical_px-freezen_vertical_scrollTop+rowHeaderWidth-1,columeHeaderHeight-1);//7
  // _this.createCanvas("freezen_7",freezen_vertical_px - freezen_vertical_scrollTop, drawHeight - freezen_horizon_px + freezen_horizon_scrollTop-columeHeaderHeight, rowHeaderWidth, freezen_horizon_px - freezen_horizon_scrollTop + columeHeaderHeight);
  _this.createCanvas("freezen_7",freezen_vertical_px-freezen_vertical_scrollTop,drawHeight-freezen_horizon_px+freezen_horizon_scrollTop-columeHeaderHeight,rowHeaderWidth-1,freezen_horizon_px-freezen_horizon_scrollTop+columeHeaderHeight-1);}//水平freezen开始
  else if(_this.freezenhorizontaldata!=null){freezen_horizon_px=_this.freezenhorizontaldata[0];freezen_horizon_ed=_this.freezenhorizontaldata[1];freezen_horizon_scrollTop=_this.freezenhorizontaldata[2];// _this.createCanvas("freezen_h", drawWidth, freezen_horizon_px - freezen_horizon_scrollTop + 1, rowHeaderWidth, columeHeaderHeight);
  _this.createCanvas("freezen_h",drawWidth,freezen_horizon_px-freezen_horizon_scrollTop+1,rowHeaderWidth-1,columeHeaderHeight-1);}//水平freezon结束
  //垂直freezen开始
  else if(_this.freezenverticaldata!=null){freezen_vertical_px=_this.freezenverticaldata[0];freezen_vertical_ed=_this.freezenverticaldata[1];freezen_vertical_scrollTop=_this.freezenverticaldata[2];// _this.createCanvas("freezen_v", freezen_vertical_px - freezen_vertical_scrollTop, drawHeight, rowHeaderWidth, columeHeaderHeight);
  _this.createCanvas("freezen_v",freezen_vertical_px-freezen_vertical_scrollTop,drawHeight,rowHeaderWidth-1,columeHeaderHeight-1);}//垂直freezen结束
  // $("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").css("z-index", 10001);
  // setTimeout(function(){
  //     luckysheet.luckysheetsizeauto();
  // },0);
  luckysheet.freezen.scrollAdapt();}},createCanvas:function createCanvas(id,width,height,left,top){var c=$("<canvas/>").appendTo("#luckysheet-grid-window-1").attr({"id":id,"width":Math.ceil(width*devicePixelRatio),"height":Math.ceil(height*devicePixelRatio)}).css({"user-select":"none","postion":"absolute","left":left,"top":top,"width":width,"height":height,"z-index":10,"pointer-events":"none"});},removeAssistCanvas:function removeAssistCanvas(){$("#luckysheet-grid-window-1 > canvas").not($("#luckysheetTableContent")).remove();$("#luckysheet-cell-selected").css("z-index",15);},scrollAdapt:function scrollAdapt(){//有冻结时 选区框 滚动适应
  if(luckysheet_select_save!=null&&luckysheet_select_save.length>0){luckysheet.freezen.scrollAdaptOfselect();}//有冻结时 图表框 滚动适应
  if($("#luckysheet-cell-main .luckysheet-data-visualization-chart").length>0){luckysheet.freezen.scrollAdaptOfchart();}//有冻结时 批注框 滚动适应
  if($("#luckysheet-postil-showBoxs .luckysheet-postil-show").length>0){luckysheet.freezen.scrollAdaptOfpostil();}//有冻结时 下拉选区图标 滚动适应
  if($("#luckysheet-dropCell-icon").length>0){luckysheet.freezen.scrollAdaptOfdpicon();}//有冻结时 筛选下拉按钮 滚动适应
  if($("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").length>0){luckysheet.freezen.scrollAdaptOffilteroptions();}},scrollAdaptOfselect:function scrollAdaptOfselect(){if($("#luckysheet-row-count-show").is(":visible")){$("#luckysheet-row-count-show").hide();}if($("#luckysheet-column-count-show").is(":visible")){$("#luckysheet-column-count-show").hide();}$("#luckysheet-rows-h-selected").empty();$("#luckysheet-cols-h-selected").empty();var scrollTop=$("#luckysheet-cell-main").scrollTop();var scrollLeft=$("#luckysheet-cell-main").scrollLeft();if(luckysheet.freezen.freezenhorizontaldata!=null&&luckysheet.freezen.freezenverticaldata!=null){var freezenTop=luckysheet.freezen.freezenhorizontaldata[0];var freezen_rowindex=luckysheet.freezen.freezenhorizontaldata[1];var offTop=scrollTop-luckysheet.freezen.freezenhorizontaldata[2];var freezenLeft=luckysheet.freezen.freezenverticaldata[0];var freezen_colindex=luckysheet.freezen.freezenverticaldata[1];var offLeft=scrollLeft-luckysheet.freezen.freezenverticaldata[2];for(var s=0;s<luckysheet_select_save.length;s++){var obj=$.extend(true,{},luckysheet_select_save[s]);var r1=obj.row[0],r2=obj.row[1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var top_move=row_pre;var height_move=row-row_pre-1;var rangeshow=true;if(r1>=freezen_rowindex){//原选区在冻结区外
  if(top_move+height_move<freezenTop+offTop){rangeshow=false;}else if(top_move<freezenTop+offTop){$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"top":freezenTop+offTop,"height":height_move-(freezenTop+offTop-top_move)});}else {$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"top":top_move,"height":height_move});}}else if(r2>=freezen_rowindex){//原选区有一部分在冻结区内
  if(top_move+height_move<freezenTop+offTop){$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"top":top_move+offTop,"height":freezenTop-top_move});}else {$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"top":top_move+offTop,"height":height_move-offTop});}}else {//原选区在冻结区内
  $("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css("top",top_move+offTop);}var c1=obj.column[0],c2=obj.column[1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];var left_move=col_pre;var width_move=col-col_pre-1;if(c1>=freezen_colindex){//原选区在冻结区外
  if(left_move+width_move<freezenLeft+offLeft){rangeshow=false;}else if(left_move<freezenLeft+offLeft){$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"left":freezenLeft+offLeft,"width":width_move-(freezenLeft+offLeft-left_move)});}else {$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"left":left_move,"width":width_move});}}else if(c2>=freezen_colindex){//原选区有一部分在冻结区内
  if(left_move+width_move<freezenLeft+offLeft){$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"left":left_move+offLeft,"width":freezenLeft-left_move});}else {$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"left":left_move+offLeft,"width":width_move-offLeft});}}else {//原选区在冻结区内
  $("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css("left",left_move+offLeft);}if(!rangeshow){$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).hide();}if(s==luckysheet_select_save.length-1){var rf=obj.row_focus==null?r1:obj.row_focus;var cf=obj.column_focus==null?c1:obj.column_focus;var row_f=visibledatarow[rf],row_pre_f=rf-1==-1?0:visibledatarow[rf-1];var col_f=visibledatacolumn[cf],col_pre_f=cf-1==-1?0:visibledatacolumn[cf-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,rf,cf);if(!!margeset){row_f=margeset.row[1];row_pre_f=margeset.row[0];col_f=margeset.column[1];col_pre_f=margeset.column[0];}var top=row_pre_f;var height=row_f-row_pre_f-1;var left=col_pre_f;var width=col_f-col_pre_f-1;var focuscell=true;if(top>=freezenTop){if(top+height<freezenTop+offTop){focuscell=false;}else if(top<freezenTop+offTop){$("#luckysheet-cell-selected-focus").show().css({"top":freezenTop+offTop,"height":height-(freezenTop+offTop-top)});}else {$("#luckysheet-cell-selected-focus").show().css({"top":top,"height":height});}}else if(top+height>=freezenTop){if(top+height<freezenTop+offTop){$("#luckysheet-cell-selected-focus").show().css({"top":top+offTop,"height":freezenTop-top});}else {$("#luckysheet-cell-selected-focus").show().css({"top":top+offTop,"height":height-offTop});}}else {$("#luckysheet-cell-selected-focus").show().css("top",top+offTop);}if(left>=freezenLeft){if(left+width<freezenLeft+offLeft){focuscell=false;}else if(left<freezenLeft+offLeft){$("#luckysheet-cell-selected-focus").show().css({"left":freezenLeft+offLeft,"width":width-(freezenLeft+offLeft-left)});}else {$("#luckysheet-cell-selected-focus").show().css({"left":left,"width":width});}}else if(left+width>=freezenLeft){if(left+width<freezenLeft+offLeft){$("#luckysheet-cell-selected-focus").show().css({"left":left+offLeft,"width":freezenLeft-left});}else {$("#luckysheet-cell-selected-focus").show().css({"left":left+offLeft,"width":width-offLeft});}}else {$("#luckysheet-cell-selected-focus").show().css("left",left+offLeft);}if(!focuscell){$("#luckysheet-cell-selected-focus").hide();}}}}else if(luckysheet.freezen.freezenhorizontaldata!=null){var freezenTop=luckysheet.freezen.freezenhorizontaldata[0];var freezen_rowindex=luckysheet.freezen.freezenhorizontaldata[1];var offTop=scrollTop-luckysheet.freezen.freezenhorizontaldata[2];for(var s=0;s<luckysheet_select_save.length;s++){var obj=$.extend(true,{},luckysheet_select_save[s]);var r1=obj.row[0],r2=obj.row[1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var top_move=row_pre;var height_move=row-row_pre-1;if(r1>=freezen_rowindex){//原选区在冻结区外
  if(top_move+height_move<freezenTop+offTop){$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).hide();}else if(top_move<freezenTop+offTop){$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"top":freezenTop+offTop,"height":height_move-(freezenTop+offTop-top_move)});}else {$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"top":top_move,"height":height_move});}}else if(r2>=freezen_rowindex){//原选区有一部分在冻结区内
  if(top_move+height_move<freezenTop+offTop){$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"top":top_move+offTop,"height":freezenTop-top_move});}else {$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"top":top_move+offTop,"height":height_move-offTop});}}else {//原选区在冻结区内
  $("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css("top",top_move+offTop);}if(s==luckysheet_select_save.length-1){var rf=obj.row_focus==null?r1:obj.row_focus;var cf=obj.column_focus==null?obj.column[0]:obj.column_focus;var row_f=visibledatarow[rf],row_pre_f=rf-1==-1?0:visibledatarow[rf-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,rf,cf);if(!!margeset){row_f=margeset.row[1];row_pre_f=margeset.row[0];}var top=row_pre_f;var height=row_f-row_pre_f-1;if(top>=freezenTop){if(top+height<freezenTop+offTop){$("#luckysheet-cell-selected-focus").hide();}else if(top<freezenTop+offTop){$("#luckysheet-cell-selected-focus").show().css({"top":freezenTop+offTop,"height":height-(freezenTop+offTop-top)});}else {$("#luckysheet-cell-selected-focus").show().css({"top":top,"height":height});}}else if(top+height>=freezenTop){if(top+height<freezenTop+offTop){$("#luckysheet-cell-selected-focus").show().css({"top":top+offTop,"height":freezenTop-top});}else {$("#luckysheet-cell-selected-focus").show().css({"top":top+offTop,"height":height-offTop});}}else {$("#luckysheet-cell-selected-focus").show().css("top",top+offTop);}}}}else if(luckysheet.freezen.freezenverticaldata!=null){var freezenLeft=luckysheet.freezen.freezenverticaldata[0];var freezen_colindex=luckysheet.freezen.freezenverticaldata[1];var offLeft=scrollLeft-luckysheet.freezen.freezenverticaldata[2];for(var s=0;s<luckysheet_select_save.length;s++){var obj=$.extend(true,{},luckysheet_select_save[s]);var c1=obj.column[0],c2=obj.column[1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];var left_move=col_pre;var width_move=col-col_pre-1;if(c1>=freezen_colindex){//原选区在冻结区外
  if(left_move+width_move<freezenLeft+offLeft){$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).hide();}else if(left_move<freezenLeft+offLeft){$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"left":freezenLeft+offLeft,"width":width_move-(freezenLeft+offLeft-left_move)});}else {$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"left":left_move,"width":width_move});}}else if(c2>=freezen_colindex){//原选区有一部分在冻结区内
  if(left_move+width_move<freezenLeft+offLeft){$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"left":left_move+offLeft,"width":freezenLeft-left_move});}else {$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css({"left":left_move+offLeft,"width":width_move-offLeft});}}else {//原选区在冻结区内
  $("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(s).show().css("left",left_move+offLeft);}if(s==luckysheet_select_save.length-1){var rf=obj.row_focus==null?obj.row[0]:obj.row_focus;var cf=obj.column_focus==null?c1:obj.column_focus;var col_f=visibledatacolumn[cf],col_pre_f=cf-1==-1?0:visibledatacolumn[cf-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,rf,cf);if(!!margeset){col_f=margeset.column[1];col_pre_f=margeset.column[0];}var left=col_pre_f;var width=col_f-col_pre_f-1;if(left>=freezenLeft){if(left+width<freezenLeft+offLeft){$("#luckysheet-cell-selected-focus").hide();}else if(left<freezenLeft+offLeft){$("#luckysheet-cell-selected-focus").show().css({"left":freezenLeft+offLeft,"width":width-(freezenLeft+offLeft-left)});}else {$("#luckysheet-cell-selected-focus").show().css({"left":left,"width":width});}}else if(left+width>=freezenLeft){if(left+width<freezenLeft+offLeft){$("#luckysheet-cell-selected-focus").show().css({"left":left+offLeft,"width":freezenLeft-left});}else {$("#luckysheet-cell-selected-focus").show().css({"left":left+offLeft,"width":width-offLeft});}}else {$("#luckysheet-cell-selected-focus").show().css("left",left+offLeft);}}}}else {luckysheet.selectHightlightShow();}},scrollAdaptOfchart:function scrollAdaptOfchart(){var scrollTop=$("#luckysheet-cell-main").scrollTop();var scrollLeft=$("#luckysheet-cell-main").scrollLeft();if(luckysheet.freezen.freezenhorizontaldata!=null&&luckysheet.freezen.freezenverticaldata!=null){var freezenTop=luckysheet.freezen.freezenhorizontaldata[0]-luckysheet.freezen.freezenhorizontaldata[2];var freezenLeft=luckysheet.freezen.freezenverticaldata[0]-luckysheet.freezen.freezenverticaldata[2];$("#luckysheet-cell-main .luckysheet-data-visualization-chart").each(function(i,e){var x=$(e).position();var width=$(e).width();var height=$(e).height();var $canvas_width=$(e).find("canvas").width();var $canvas_height=$(e).find("canvas").height();var height_diff=$canvas_height-height;var width_diff=$canvas_width-width;if(x.top-height_diff<freezenTop){var size=freezenTop-(x.top-height_diff);if(size>$canvas_height+40+2){$(e).css("visibility","hidden");}else {$(e).css({"top":freezenTop+scrollTop,"height":$canvas_height-size,"visibility":"visible"});$(e).find("canvas").css("top",-size);}}else {$(e).css({"top":x.top-height_diff+scrollTop,"height":$canvas_height,"visibility":"visible"});$(e).find("canvas").css("top",0);}if(x.left-width_diff<freezenLeft){var size=freezenLeft-(x.left-width_diff);if(size>$canvas_width+20+2){$(e).css("visibility","hidden");}else {$(e).css({"left":freezenLeft+scrollLeft,"width":$canvas_width-size,"visibility":"visible"});$(e).find("canvas").css("left",-size);}}else {$(e).css({"left":x.left-width_diff+scrollLeft,"width":$canvas_width,"visibility":"visible"});$(e).find("canvas").css("left",0);}});}else if(luckysheet.freezen.freezenhorizontaldata!=null){var freezenTop=luckysheet.freezen.freezenhorizontaldata[0]-luckysheet.freezen.freezenhorizontaldata[2];$("#luckysheet-cell-main .luckysheet-data-visualization-chart").each(function(i,e){var x=$(e).position();var height=$(e).height();var $canvas_height=$(e).find("canvas").height();var height_diff=$canvas_height-height;if(x.top-height_diff<freezenTop){var size=freezenTop-(x.top-height_diff);if(size>$canvas_height+40+2){$(e).css("visibility","hidden");}else {$(e).css({"top":freezenTop+scrollTop,"height":$canvas_height-size,"visibility":"visible"});$(e).find("canvas").css("top",-size);}}else {$(e).css({"top":x.top-height_diff+scrollTop,"height":$canvas_height,"visibility":"visible"});$(e).find("canvas").css("top",0);}});}else if(luckysheet.freezen.freezenverticaldata!=null){var freezenLeft=luckysheet.freezen.freezenverticaldata[0]-luckysheet.freezen.freezenverticaldata[2];$("#luckysheet-cell-main .luckysheet-data-visualization-chart").each(function(i,e){var x=$(e).position();var width=$(e).width();var $canvas_width=$(e).find("canvas").width();var width_diff=$canvas_width-width;if(x.left-width_diff<freezenLeft){var size=freezenLeft-(x.left-width_diff);if(size>$canvas_width+20+2){$(e).css("visibility","hidden");}else {$(e).css({"left":freezenLeft+scrollLeft,"width":$canvas_width-size,"visibility":"visible"});$(e).find("canvas").css("left",-size);}}else {$(e).css({"left":x.left-width_diff+scrollLeft,"width":$canvas_width,"visibility":"visible"});$(e).find("canvas").css("left",0);}});}else {$("#luckysheet-cell-main .luckysheet-data-visualization-chart").each(function(i,e){var x=$(e).position();var width=$(e).width();var height=$(e).height();var $canvas_width=$(e).find("canvas").width();var $canvas_height=$(e).find("canvas").height();var height_diff=$canvas_height-height;var width_diff=$canvas_width-width;$(e).css({"top":x.top-height_diff+scrollTop,"height":$canvas_height,"left":x.left-width_diff+scrollLeft,"width":$canvas_width,"visibility":"visible"});$(e).find("canvas").css({"top":0,"left":0});});}},scrollAdaptOfpostil:function scrollAdaptOfpostil(){var scrollTop=$("#luckysheet-cell-main").scrollTop();var scrollLeft=$("#luckysheet-cell-main").scrollLeft();if(luckysheet.freezen.freezenhorizontaldata!=null&&luckysheet.freezen.freezenverticaldata!=null){var freezenTop=luckysheet.freezen.freezenhorizontaldata[0];var freezenLeft=luckysheet.freezen.freezenverticaldata[0];var offTop=scrollTop-luckysheet.freezen.freezenhorizontaldata[2];var offLeft=scrollLeft-luckysheet.freezen.freezenverticaldata[2];$("#luckysheet-postil-showBoxs .luckysheet-postil-show").each(function(i,e){var id=$(e).attr("id");var r=id.split("luckysheet-postil-show_")[1].split("_")[0];var c=id.split("luckysheet-postil-show_")[1].split("_")[1];var postil=luckysheet.flowdata[r][c].ps;var row=visibledatarow[r],row_pre=r-1==-1?0:visibledatarow[r-1];var col=visibledatacolumn[c],col_pre=c-1==-1?0:visibledatacolumn[c-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,r,c);if(!!margeset){row=margeset.row[1];row_pre=margeset.row[0];col=margeset.column[1];col_pre=margeset.column[0];}var toX=col;var toY=row_pre;var postil_left=postil["left"]==null?toX+18:postil["left"];var postil_top=postil["top"]==null?toY-18:postil["top"];var postil_width=postil["width"]==null?luckysheet.postil.defaultWidth:postil["width"];var postil_height=postil["height"]==null?luckysheet.postil.defaultHeight:postil["height"];if(postil_top<0){postil_top=2;}var size=luckysheet.postil.getArrowCanvasSize(postil_left,postil_top,toX,toY);var show=true;var show2=true;if(postil_top+postil_height<freezenTop){$(e).show().find(".luckysheet-postil-show-main").css("top",postil_top+offTop);$(e).show().find(".arrowCanvas").css("top",size[1]+offTop);}else {if(postil_top<freezenTop+offTop){if(postil_top+postil_height<=freezenTop+offTop){show=false;}else {$(e).show().find(".luckysheet-postil-show-main").css({"top":freezenTop+offTop,"height":postil_height-(freezenTop+offTop-postil_top)});$(e).show().find(".formulaInputFocus").css("margin-top",-(freezenTop+offTop-postil_top));$(e).show().find(".arrowCanvas").hide();show2=false;}}else {$(e).show().find(".luckysheet-postil-show-main").css({"top":postil_top,"height":postil_height});$(e).show().find(".formulaInputFocus").css("margin-top",0);$(e).show().find(".arrowCanvas").css("top",size[1]);// luckysheet.postil.buildPs(r, c, postil);
  }}if(postil_left+postil_width<freezenLeft){$(e).show().find(".luckysheet-postil-show-main").css("left",postil_left+offLeft);$(e).show().find(".arrowCanvas").css("left",size[0]+offLeft);}else {if(postil_left<freezenLeft+offLeft){if(postil_left+postil_width<=freezenLeft+offLeft){show=false;}else {$(e).show().find(".luckysheet-postil-show-main").css({"left":freezenLeft+offLeft,"width":postil_width-(freezenLeft+offLeft-postil_left)});$(e).show().find(".formulaInputFocus").css("margin-left",-(freezenLeft+offLeft-postil_left));$(e).show().find(".arrowCanvas").hide();show2=false;}}else {$(e).show().find(".luckysheet-postil-show-main").css({"left":postil_left,"width":postil_width});$(e).show().find(".formulaInputFocus").css("margin-left",0);$(e).show().find(".arrowCanvas").css("left",size[0]);// luckysheet.postil.buildPs(r, c, postil);
  }}if(!show){$(e).hide();}if(show&&show2){$(e).show().find(".arrowCanvas").show();}});}else if(luckysheet.freezen.freezenhorizontaldata!=null){var freezenTop=luckysheet.freezen.freezenhorizontaldata[0];var offTop=scrollTop-luckysheet.freezen.freezenhorizontaldata[2];$("#luckysheet-postil-showBoxs .luckysheet-postil-show").each(function(i,e){var id=$(e).attr("id");var r=id.split("luckysheet-postil-show_")[1].split("_")[0];var c=id.split("luckysheet-postil-show_")[1].split("_")[1];var postil=luckysheet.flowdata[r][c].ps;var row=visibledatarow[r],row_pre=r-1==-1?0:visibledatarow[r-1];var col=visibledatacolumn[c],col_pre=c-1==-1?0:visibledatacolumn[c-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,r,c);if(!!margeset){row=margeset.row[1];row_pre=margeset.row[0];col=margeset.column[1];col_pre=margeset.column[0];}var toX=col;var toY=row_pre;var postil_left=postil["left"]==null?toX+18:postil["left"];var postil_top=postil["top"]==null?toY-18:postil["top"];var postil_width=postil["width"]==null?luckysheet.postil.defaultWidth:postil["width"];var postil_height=postil["height"]==null?luckysheet.postil.defaultHeight:postil["height"];if(postil_top<0){postil_top=2;}var size=luckysheet.postil.getArrowCanvasSize(postil_left,postil_top,toX,toY);if(postil_top+postil_height<freezenTop){$(e).show().find(".luckysheet-postil-show-main").css("top",postil_top+offTop);$(e).show().find(".arrowCanvas").css("top",size[1]+offTop);}else {if(postil_top<freezenTop+offTop){if(postil_top+postil_height<=freezenTop+offTop){$(e).hide();}else {$(e).show().find(".luckysheet-postil-show-main").css({"top":freezenTop+offTop,"height":postil_height-(freezenTop+offTop-postil_top)});$(e).show().find(".formulaInputFocus").css("margin-top",-(freezenTop+offTop-postil_top));$(e).show().find(".arrowCanvas").hide();}}else {luckysheet.postil.buildPs(r,c,postil);}}});}else if(luckysheet.freezen.freezenverticaldata!=null){var freezenLeft=luckysheet.freezen.freezenverticaldata[0];var offLeft=scrollLeft-luckysheet.freezen.freezenverticaldata[2];$("#luckysheet-postil-showBoxs .luckysheet-postil-show").each(function(i,e){var id=$(e).attr("id");var r=id.split("luckysheet-postil-show_")[1].split("_")[0];var c=id.split("luckysheet-postil-show_")[1].split("_")[1];var postil=luckysheet.flowdata[r][c].ps;var row=visibledatarow[r],row_pre=r-1==-1?0:visibledatarow[r-1];var col=visibledatacolumn[c],col_pre=c-1==-1?0:visibledatacolumn[c-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,r,c);if(!!margeset){row=margeset.row[1];row_pre=margeset.row[0];col=margeset.column[1];col_pre=margeset.column[0];}var toX=col;var toY=row_pre;var postil_left=postil["left"]==null?toX+18:postil["left"];var postil_top=postil["top"]==null?toY-18:postil["top"];var postil_width=postil["width"]==null?luckysheet.postil.defaultWidth:postil["width"];var postil_height=postil["height"]==null?luckysheet.postil.defaultHeight:postil["height"];if(postil_top<0){postil_top=2;}var size=luckysheet.postil.getArrowCanvasSize(postil_left,postil_top,toX,toY);if(postil_left+postil_width<freezenLeft){$(e).show().find(".luckysheet-postil-show-main").css("left",postil_left+offLeft);$(e).show().find(".arrowCanvas").css("left",size[0]+offLeft);}else {if(postil_left<freezenLeft+offLeft){if(postil_left+postil_width<=freezenLeft+offLeft){$(e).hide();}else {$(e).show().find(".luckysheet-postil-show-main").css({"left":freezenLeft+offLeft,"width":postil_width-(freezenLeft+offLeft-postil_left)});$(e).show().find(".formulaInputFocus").css("margin-left",-(freezenLeft+offLeft-postil_left));$(e).show().find(".arrowCanvas").hide();}}else {luckysheet.postil.buildPs(r,c,postil);}}});}else {$("#luckysheet-postil-showBoxs .luckysheet-postil-show").each(function(i,e){var id=$(e).attr("id");var r=id.split("luckysheet-postil-show_")[1].split("_")[0];var c=id.split("luckysheet-postil-show_")[1].split("_")[1];var postil=luckysheet.flowdata[r][c].ps;luckysheet.postil.buildPs(r,c,postil);});}},scrollAdaptOfdpicon:function scrollAdaptOfdpicon(){var copy_r=luckysheet.dropCell.copyRange["row"][1],copy_c=luckysheet.dropCell.copyRange["column"][1];var apply_r=luckysheet.dropCell.applyRange["row"][1],apply_c=luckysheet.dropCell.applyRange["column"][1];if(apply_r>=copy_r&&apply_c>=copy_c){var row_index=apply_r;var col_index=apply_c;}else {var row_index=copy_r;var col_index=copy_c;}if(luckysheet.freezen.freezenhorizontaldata!=null&&luckysheet.freezen.freezenverticaldata!=null){var freezen_rowindex=luckysheet.freezen.freezenhorizontaldata[1];var offsetRow=luckysheet_searcharray(luckysheet.freezen.freezenhorizontaldata[3],$("#luckysheet-cell-main").scrollTop()-luckysheet.freezen.freezenhorizontaldata[2]);var freezen_colindex=luckysheet.freezen.freezenverticaldata[1];var offsetColumn=luckysheet_searcharray(luckysheet.freezen.freezenverticaldata[3],$("#luckysheet-cell-main").scrollLeft()-luckysheet.freezen.freezenverticaldata[2]);if(row_index>=freezen_rowindex&&col_index>=freezen_colindex){if(row_index<freezen_rowindex+offsetRow-1||col_index<freezen_colindex+offsetColumn-1){$("#luckysheet-dropCell-icon").hide();}else {$("#luckysheet-dropCell-icon").show();}}else if(row_index>=freezen_rowindex){if(row_index<freezen_rowindex+offsetRow-1){$("#luckysheet-dropCell-icon").hide();}else {var col=luckysheet.colLocationByIndex(col_index+offsetColumn)[1];$("#luckysheet-dropCell-icon").show().css("left",col);}}else if(col_index>=freezen_colindex){if(col_index<freezen_colindex+offsetColumn-1){$("#luckysheet-dropCell-icon").hide();}else {var row=luckysheet.rowLocationByIndex(row_index+offsetRow)[1];$("#luckysheet-dropCell-icon").show().css("top",row);}}else {var row=luckysheet.rowLocationByIndex(row_index+offsetRow)[1],col=luckysheet.colLocationByIndex(col_index+offsetColumn)[1];$("#luckysheet-dropCell-icon").show().css({"left":col,"top":row});}}else if(luckysheet.freezen.freezenhorizontaldata!=null){var freezen_rowindex=luckysheet.freezen.freezenhorizontaldata[1];var offsetRow=luckysheet_searcharray(luckysheet.freezen.freezenhorizontaldata[3],$("#luckysheet-cell-main").scrollTop()-luckysheet.freezen.freezenhorizontaldata[2]);if(row_index>=freezen_rowindex){if(row_index<freezen_rowindex+offsetRow-1){$("#luckysheet-dropCell-icon").hide();}else {$("#luckysheet-dropCell-icon").show();}}else {var row=luckysheet.rowLocationByIndex(row_index+offsetRow)[1];$("#luckysheet-dropCell-icon").show().css("top",row);}}else if(luckysheet.freezen.freezenverticaldata!=null){var freezen_colindex=luckysheet.freezen.freezenverticaldata[1];var offsetColumn=luckysheet_searcharray(luckysheet.freezen.freezenverticaldata[3],$("#luckysheet-cell-main").scrollLeft()-luckysheet.freezen.freezenverticaldata[2]);if(col_index>=freezen_colindex){if(col_index<freezen_colindex+offsetColumn-1){$("#luckysheet-dropCell-icon").hide();}else {$("#luckysheet-dropCell-icon").show();}}else {var col=luckysheet.colLocationByIndex(col_index+offsetColumn)[1];$("#luckysheet-dropCell-icon").show().css("left",col);}}else {var row=luckysheet.rowLocationByIndex(row_index)[1],col=luckysheet.colLocationByIndex(col_index)[1];$("#luckysheet-dropCell-icon").show().css({"left":col,"top":row});}},scrollAdaptOffilteroptions:function scrollAdaptOffilteroptions(){if(luckysheet.freezen.freezenhorizontaldata!=null&&luckysheet.freezen.freezenverticaldata!=null){var freezen_rowindex=luckysheet.freezen.freezenhorizontaldata[1];var freezen_top=luckysheet.freezen.freezenhorizontaldata[0]+$("#luckysheet-cell-main").scrollTop();var freezen_colindex=luckysheet.freezen.freezenverticaldata[1];var offsetColumn=luckysheet_searcharray(luckysheet.freezen.freezenverticaldata[3],$("#luckysheet-cell-main").scrollLeft()-luckysheet.freezen.freezenverticaldata[2]);$("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").each(function(i,e){var row_index=$(e).data("str");var top=row_index-1==-1?0:visibledatarow[row_index-1];var col_index=$(e).data("cindex");if(row_index>=freezen_rowindex&&col_index>=freezen_colindex){if(top<freezen_top||col_index<freezen_colindex+offsetColumn){$(e).hide();}else {$(e).show();}}else if(row_index>=freezen_rowindex){if(top<freezen_top){$(e).hide();}else {var left=visibledatacolumn[col_index+offsetColumn]-20;$(e).show().css("left",left);}}else if(col_index>=freezen_colindex){if(col_index<freezen_colindex+offsetColumn){$(e).hide();}else {$(e).show().css("top",top+$("#luckysheet-cell-main").scrollTop());}}else {var left=visibledatacolumn[col_index+offsetColumn]-20;$(e).show().css({"left":left,"top":top+$("#luckysheet-cell-main").scrollTop()});}});}else if(luckysheet.freezen.freezenhorizontaldata!=null){var freezen_rowindex=luckysheet.freezen.freezenhorizontaldata[1];var freezen_top=luckysheet.freezen.freezenhorizontaldata[0]+$("#luckysheet-cell-main").scrollTop();$("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").each(function(i,e){var row_index=$(e).data("str");var top=row_index-1==-1?0:visibledatarow[row_index-1];if(row_index>=freezen_rowindex){if(top<freezen_top){$(e).hide();}else {$(e).show();}}else {$(e).show().css("top",top+$("#luckysheet-cell-main").scrollTop());}});}else if(luckysheet.freezen.freezenverticaldata!=null){var freezen_colindex=luckysheet.freezen.freezenverticaldata[1];var offsetColumn=luckysheet_searcharray(luckysheet.freezen.freezenverticaldata[3],$("#luckysheet-cell-main").scrollLeft()-luckysheet.freezen.freezenverticaldata[2]);$("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").each(function(i,e){var col_index=$(e).data("cindex");if(col_index>=freezen_colindex){if(col_index<freezen_colindex+offsetColumn){$(e).hide();}else {$(e).show();}}else {var left=visibledatacolumn[col_index+offsetColumn]-20;$(e).show().css("left",left);}});}else {$("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex).empty();luckysheet.createFilterOptions(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].filter_select);}}};//条件格式
  luckysheet.conditionformat={fileClone:[],editorRule:null,//{"sheetIndex": sheetIndex,"itemIndex": itemIndex,"data": luckysheetfile[sheetIndex].luckysheet_conditionformat_save[itemIndex]}
  ruleTypeHtml:'<div class="ruleTypeBox"><div class="ruleTypeItem"><span class="icon">► </span><span>基于各自值设置所有单元格的格式</span></div><div class="ruleTypeItem"><span class="icon">► </span><span>只为包含以下内容的单元格设置格式</span></div><div class="ruleTypeItem"><span class="icon">► </span><span>仅对排名靠前或靠后的数值设置格式</span></div><div class="ruleTypeItem"><span class="icon">► </span><span>仅对高于或低于平均值的数值设置格式</span></div><div class="ruleTypeItem"><span class="icon">► </span><span>仅对唯一值或重复值设置格式</span></div></div>',textCellColorHtml:'<div id="textCellColor"><div class="colorbox"><input id="checkTextColor" type="checkbox" checked="checked"><label for="checkTextColor">文本颜色：</label><input id="textcolorshow" data-tips="文本颜色" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="#9c0006" style="display: none;"></div><div class="colorbox"><input id="checkCellColor" type="checkbox" checked="checked"><label for="checkCellColor">单元格颜色：</label><input id="cellcolorshow" data-tips="单元格颜色" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="#ffc7ce" style="display: none;"></div></div>',selectRange:[],selectStatus:false,dataBarList:[{"format":["#638ec6","#ffffff"]},//蓝-白渐变 数据条
  {"format":["#63c384","#ffffff"]},//绿-白渐变 数据条
  {"format":["#ff555a","#ffffff"]},//红-白渐变 数据条
  {"format":["#ffb628","#ffffff"]},//橙-白渐变 数据条
  {"format":["#008aef","#ffffff"]},//浅蓝-白渐变 数据条
  {"format":["#d6007b","#ffffff"]},//紫-白渐变 数据条
  {"format":["#638ec6"]},//蓝色 数据条
  {"format":["#63c384"]},//绿色 数据条
  {"format":["#ff555a"]},//红色 数据条
  {"format":["#ffb628"]},//橙色 数据条
  {"format":["#008aef"]},//浅蓝色 数据条
  {"format":["#d6007b"]}//紫色 数据条
  ],colorGradationList:[{"format":["rgb(99, 190, 123)","rgb(255, 235, 132)","rgb(248, 105, 107)"]},//绿-黄-红色阶
  {"format":["rgb(248, 105, 107)","rgb(255, 235, 132)","rgb(99, 190, 123)"]},//红-黄-绿色阶
  {"format":["rgb(99, 190, 123)","rgb(252, 252, 255)","rgb(248, 105, 107)"]},//绿-白-红色阶
  {"format":["rgb(248, 105, 107)","rgb(252, 252, 255)","rgb(99, 190, 123)"]},//红-白-绿色阶
  {"format":["rgb(90, 138, 198)","rgb(252, 252, 255)","rgb(248, 105, 107)"]},//蓝-白-红色阶
  {"format":["rgb(248, 105, 107)","rgb(252, 252, 255)","rgb(90, 138, 198)"]},//红-白-蓝色阶
  {"format":["rgb(252, 252, 255)","rgb(248, 105, 107)"]},//白-红色阶
  {"format":["rgb(248, 105, 107)","rgb(252, 252, 255)"]},//红-白色阶
  {"format":["rgb(99, 190, 123)","rgb(252, 252, 255)"]},//绿-白色阶
  {"format":["rgb(252, 252, 255)","rgb(99, 190, 123)"]},//白-绿色阶
  {"format":["rgb(99, 190, 123)","rgb(255, 235, 132)"]},//绿-黄色阶
  {"format":["rgb(255, 235, 132)","rgb(99, 190, 123)"]}//黄-绿色阶
  ],init:function init(){// 管理规则
  $(document).off("change.CFchooseSheet").on("change.CFchooseSheet","#luckysheet-administerRule-dialog .chooseSheet",function(){var index=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();luckysheet.conditionformat.getConditionRuleList(index);});$(document).off("click.CFadministerRuleItem").on("click.CFadministerRuleItem","#luckysheet-administerRule-dialog .ruleList .listBox .item",function(){$(this).addClass("on").siblings().removeClass("on");});$(document).off("click.CFadministerRuleConfirm").on("click.CFadministerRuleConfirm","#luckysheet-administerRule-dialog-confirm",function(){//保存之前的规则
  var fileH=$.extend(true,[],luckysheet.getluckysheetfile());var historyRules=luckysheet.conditionformat.getHistoryRules(fileH);//保存当前的规则
  var fileClone=$.extend(true,[],luckysheet.conditionformat.fileClone);for(var c=0;c<fileClone.length;c++){var sheetIndex=fileClone[c]["index"];luckysheetfile[luckysheet.sheetmanage.getSheetIndex(sheetIndex)]["luckysheet_conditionformat_save"]=fileClone[luckysheet.sheetmanage.getSheetIndex(sheetIndex)]["luckysheet_conditionformat_save"];}var fileC=$.extend(true,[],luckysheet.getluckysheetfile());var currentRules=luckysheet.conditionformat.getCurrentRules(fileC);//刷新一次表格
  luckysheet.conditionformat.ref(historyRules,currentRules);//隐藏一些dom
  $("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-administerRule-dialog").hide();//发送给后台
  if(luckysheet.server.allowUpdate){var files=$.extend(true,[],luckysheet.getluckysheetfile());for(var i=0;i<files.length;i++){luckysheet.server.saveParam("all",files[i]["index"],files[i]["luckysheet_conditionformat_save"],{"k":"luckysheet_conditionformat_save"});}}});$(document).off("click.CFadministerRuleClose").on("click.CFadministerRuleClose","#luckysheet-administerRule-dialog-close",function(){$("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-administerRule-dialog").hide();luckysheet.conditionformat.fileClone=[];});$(document).off("click.CFadministerRuleFa").on("click.CFadministerRuleFa","#luckysheet-administerRule-dialog .item .fa-table",function(){$(this).parents("#luckysheet-administerRule-dialog").hide();var sheetIndex=$("#luckysheet-administerRule-dialog .chooseSheet select option:selected").val();if(sheetIndex!=luckysheet.currentSheetIndex){luckysheet.sheetmanage.changeSheetExec(sheetIndex);}var txt=$(this).siblings("input").val().trim();var dataItem=$(this).parents(".item").attr("data-item");luckysheet.conditionformat.multiRangeDialog(dataItem,txt);luckysheet.conditionformat.selectRange=[];var range=luckysheet.conditionformat.getRangeByTxt(txt);if(range.length>0){for(var s=0;s<range.length;s++){var r1=range[s].row[0],r2=range[s].row[1];var c1=range[s].column[0],c2=range[s].column[1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.conditionformat.selectRange.push({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1});}}luckysheet.selectionCopyShow(luckysheet.conditionformat.selectRange);});$(document).off("click.CFmultiRangeConfirm").on("click.CFmultiRangeConfirm","#luckysheet-multiRange-dialog-confirm",function(){$(this).parents("#luckysheet-multiRange-dialog").hide();var dataItem=$(this).attr("data-item");var v=$(this).parents("#luckysheet-multiRange-dialog").find("input").val();$("#luckysheet-administerRule-dialog .item[data-item="+dataItem+"] input").val(v);var sheetIndex=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();luckysheet.conditionformat.fileClone[luckysheet.sheetmanage.getSheetIndex(sheetIndex)]["luckysheet_conditionformat_save"][dataItem].cellrange=luckysheet.conditionformat.getRangeByTxt(v);$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-administerRule-dialog").show();var range=[];luckysheet.selectionCopyShow(range);});$(document).off("click.CFmultiRangeClose").on("click.CFmultiRangeClose","#luckysheet-multiRange-dialog-close",function(){$(this).parents("#luckysheet-multiRange-dialog").hide();$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-administerRule-dialog").show();$("#luckysheet-formula-functionrange-select").hide();$("#luckysheet-row-count-show").hide();$("#luckysheet-column-count-show").hide();var range=[];luckysheet.selectionCopyShow(range);});// 新建规则
  $(document).off("click.CFnewConditionRule").on("click.CFnewConditionRule","#newConditionRule",function(){if(luckysheet_select_save.length==0){if(luckysheet.isEditMode()){alert("请选择应用范围");}else {luckysheet.tooltip.info("请选择应用范围","");}return;}luckysheet.conditionformat.newConditionRuleDialog(1);});$(document).off("click.CFnewConditionRuleConfirm").on("click.CFnewConditionRuleConfirm","#luckysheet-newConditionRule-dialog-confirm",function(){var index=$("#luckysheet-newConditionRule-dialog .ruleTypeItem.on").index();var type1=$("#luckysheet-newConditionRule-dialog #type1 option:selected").val();var type2=$("#luckysheet-newConditionRule-dialog ."+type1+"Box #type2 option:selected").val();var format;if(index==0){if(type1=="dataBar"){//数据条
  var color=$(this).parents("#luckysheet-newConditionRule-dialog").find(".dataBarBox .luckysheet-conditionformat-config-color").spectrum("get").toHexString();if(type2=="gradient"){//渐变填充
  format=[color,"#ffffff"];}else if(type2=="solid"){//实心填充
  format=[color];}var rule={"type":"dataBar","cellrange":$.extend(true,[],luckysheet_select_save),"format":format};}else if(type1=="colorGradation"){//色阶
  var maxcolor=$(this).parents("#luckysheet-newConditionRule-dialog").find(".colorGradationBox .maxVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString();var midcolor=$(this).parents("#luckysheet-newConditionRule-dialog").find(".colorGradationBox .midVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString();var mincolor=$(this).parents("#luckysheet-newConditionRule-dialog").find(".colorGradationBox .minVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString();if(type2=="threeColor"){//三色
  format=[maxcolor,midcolor,mincolor];}else if(type2=="twoColor"){//双色
  format=[maxcolor,mincolor];}var rule={"type":"colorGradation","cellrange":$.extend(true,[],luckysheet_select_save),"format":format};}else if(type1=="icons"){//图标集
  var len=$(this).parents("#luckysheet-newConditionRule-dialog").find(".iconsBox .model").attr("data-len");var leftMin=$(this).parents("#luckysheet-newConditionRule-dialog").find(".iconsBox .model").attr("data-leftmin");var top=$(this).parents("#luckysheet-newConditionRule-dialog").find(".iconsBox .model").attr("data-top");format={"len":len,"leftMin":leftMin,"top":top};var rule={"type":"icons","cellrange":$.extend(true,[],luckysheet_select_save),"format":format};}}else {var conditionName="",conditionRange=[],conditionValue=[];if(index==1){if(type1=="number"){//单元格值
  conditionName=type2;if(type2=="betweenness"){var v1=$("#luckysheet-newConditionRule-dialog #conditionVal input").val().trim();var v2=$("#luckysheet-newConditionRule-dialog #conditionVal2 input").val().trim();//条件值是否是选区
  var rangeArr1=luckysheet.conditionformat.getRangeByTxt(v1);if(rangeArr1.length>1){luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}else if(rangeArr1.length==1){var r1=rangeArr1[0].row[0],r2=rangeArr1[0].row[1];var c1=rangeArr1[0].column[0],c2=rangeArr1[0].column[1];if(r1==r2&&c1==c2){v1=luckysheet.getcellvalue(r1,c1,luckysheet.flowdata);conditionRange.push({"row":rangeArr1[0].row,"column":rangeArr1[0].column});conditionValue.push(v1);}else {luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}}else if(rangeArr1.length==0){if(isNaN(v1)||v1==""){luckysheet.conditionformat.infoDialog("条件值只能是数字或者单个单元格","");return;}else {conditionValue.push(v1);}}var rangeArr2=luckysheet.conditionformat.getRangeByTxt(v2);if(rangeArr2.length>1){luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}else if(rangeArr2.length==1){var r1=rangeArr2[0].row[0],r2=rangeArr2[0].row[1];var c1=rangeArr2[0].column[0],c2=rangeArr2[0].column[1];if(r1==r2&&c1==c2){v2=luckysheet.getcellvalue(r1,c1,luckysheet.flowdata);conditionRange.push({"row":rangeArr2[0].row,"column":rangeArr2[0].column});conditionValue.push(v2);}else {luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}}else if(rangeArr2.length==0){if(isNaN(v2)||v2==""){luckysheet.conditionformat.infoDialog("条件值只能是数字或者单个单元格","");return;}else {conditionValue.push(v2);}}}else {//条件值
  var v=$("#luckysheet-newConditionRule-dialog #conditionVal input").val().trim();//条件值是否是选区
  var rangeArr=luckysheet.conditionformat.getRangeByTxt(v);if(rangeArr.length>1){luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}else if(rangeArr.length==1){var r1=rangeArr[0].row[0],r2=rangeArr[0].row[1];var c1=rangeArr[0].column[0],c2=rangeArr[0].column[1];if(r1==r2&&c1==c2){v=luckysheet.getcellvalue(r1,c1,luckysheet.flowdata);conditionRange.push({"row":rangeArr[0].row,"column":rangeArr[0].column});conditionValue.push(v);}else {luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}}else if(rangeArr.length==0){if(isNaN(v)||v==""){luckysheet.conditionformat.infoDialog("条件值只能是数字或者单个单元格","");return;}else {conditionValue.push(v);}}}}else if(type1=="text"){//特定文本
  conditionName="textContains";//条件值
  var v=$("#luckysheet-newConditionRule-dialog #conditionVal input").val().trim();//条件值是否是选区
  var rangeArr=luckysheet.conditionformat.getRangeByTxt(v);if(rangeArr.length>1){luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}else if(rangeArr.length==1){var r1=rangeArr[0].row[0],r2=rangeArr[0].row[1];var c1=rangeArr[0].column[0],c2=rangeArr[0].column[1];if(r1==r2&&c1==c2){v=luckysheet.getcellvalue(r1,c1,luckysheet.flowdata);conditionRange.push({"row":rangeArr[0].row,"column":rangeArr[0].column});conditionValue.push(v);}else {luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}}else if(rangeArr.length==0){if(isNaN(v)||v==""){luckysheet.conditionformat.infoDialog("条件值只能是数字或者单个单元格","");return;}else {conditionValue.push(v);}}}else if(type1=="date"){//发生日期
  conditionName="occurrenceDate";//条件值
  var v=$("#luckysheet-newConditionRule-dialog #daterange-btn").val();if(v==""||v==null){luckysheet.conditionformat.infoDialog("请选择日期","");return;}conditionValue.push(v);}}else if(index==2){//排名靠前靠后
  //条件名称
  if(type1=="top"){if($("#luckysheet-newConditionRule-dialog #isPercent").is(":selected")){var conditionName="top10%";}else {var conditionName="top10";}}else if(type1=="last"){if($("#luckysheet-newConditionRule-dialog #isPercent").is(":selected")){var conditionName="last10%";}else {var conditionName="last10";}}//条件值
  var v=$("#luckysheet-newConditionRule-dialog #conditionVal input").val().trim();if(parseInt(v)!=v||parseInt(v)<1||parseInt(v)>1000){luckysheet.conditionformat.infoDialog("请输入一个介于 1 和 1000 之间的整数","");return;}conditionValue.push(v);}else if(index==3){//平均值
  if(type1=="AboveAverage"){conditionName="AboveAverage";conditionValue.push("AboveAverage");}else if(type1=="SubAverage"){conditionName="SubAverage";conditionValue.push("SubAverage");}}else if(index==4){//重复值
  conditionName="duplicateValue";conditionValue.push(type1);}//格式颜色
  if($("#luckysheet-newConditionRule-dialog #checkTextColor").is(":checked")){var textcolor=$("#luckysheet-newConditionRule-dialog #textcolorshow").spectrum("get").toHexString();}else {var textcolor=null;}if($("#luckysheet-newConditionRule-dialog #checkCellColor").is(":checked")){var cellcolor=$("#luckysheet-newConditionRule-dialog #cellcolorshow").spectrum("get").toHexString();}else {var cellcolor=null;}format={"textColor":textcolor,"cellColor":cellcolor};var rule={"type":"default","cellrange":$.extend(true,[],luckysheet_select_save),"format":format,"conditionName":conditionName,"conditionRange":conditionRange,"conditionValue":conditionValue};}$("#luckysheet-newConditionRule-dialog").hide();//新建规则的入口
  var source=$(this).attr("data-source");if(source==0){$("#luckysheet-modal-dialog-mask").hide();//保存之前的规则
  var fileH=$.extend(true,[],luckysheet.getluckysheetfile());var historyRules=luckysheet.conditionformat.getHistoryRules(fileH);//保存当前的规则
  var ruleArr=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]==undefined?[]:luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"];ruleArr.push(rule);luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]=ruleArr;var fileC=$.extend(true,[],luckysheet.getluckysheetfile());var currentRules=luckysheet.conditionformat.getCurrentRules(fileC);//刷新一次表格
  luckysheet.conditionformat.ref(historyRules,currentRules);//发送给后台
  if(luckysheet.server.allowUpdate){luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,ruleArr,{"k":"luckysheet_conditionformat_save"});}}else if(source==1){//临时存储新规则
  var ruleArr=!!luckysheet.conditionformat.fileClone[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]?luckysheet.conditionformat.fileClone[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]:[];ruleArr.push(rule);luckysheet.conditionformat.fileClone[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]=ruleArr;//新建规则隐藏，管理规则显示
  luckysheet.conditionformat.administerRuleDialog();}});$(document).off("click.CFnewConditionRuleClose").on("click.CFnewConditionRuleClose","#luckysheet-newConditionRule-dialog-close",function(){//新建规则的入口
  var source=$(this).attr("data-source");if(source==0){$("#luckysheet-modal-dialog-mask").hide();}if(source==1){$("#luckysheet-administerRule-dialog").show();}//新建规则隐藏
  $("#luckysheet-newConditionRule-dialog").hide();//隐藏虚线框
  $("#luckysheet-formula-functionrange-select").hide();$("#luckysheet-row-count-show").hide();$("#luckysheet-column-count-show").hide();});// 编辑规则
  $(document).off("click.CFeditorConditionRule").on("click.CFeditorConditionRule","#editorConditionRule",function(){var sheetIndex=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();var itemIndex=$("#luckysheet-administerRule-dialog .ruleList .listBox .item.on").attr("data-item");var rule={"sheetIndex":sheetIndex,"itemIndex":itemIndex,"data":luckysheet.conditionformat.fileClone[luckysheet.sheetmanage.getSheetIndex(sheetIndex)]["luckysheet_conditionformat_save"][itemIndex]};luckysheet.conditionformat.editorRule=rule;luckysheet.conditionformat.editorConditionRuleDialog();});$(document).off("click.CFeditorConditionRuleConfirm").on("click.CFeditorConditionRuleConfirm","#luckysheet-editorConditionRule-dialog-confirm",function(){var index=$("#luckysheet-editorConditionRule-dialog .ruleTypeItem.on").index();var type1=$("#luckysheet-editorConditionRule-dialog #type1 option:selected").val();var type2=$("#luckysheet-editorConditionRule-dialog ."+type1+"Box #type2 option:selected").val();var cellrange=luckysheet.conditionformat.editorRule["data"].cellrange;var format;if(index==0){if(type1=="dataBar"){//数据条
  var color=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".dataBarBox .luckysheet-conditionformat-config-color").spectrum("get").toHexString();if(type2=="gradient"){//渐变填充
  format=[color,"#ffffff"];}else if(type2=="solid"){//实心填充
  format=[color];}var rule={"type":"dataBar","cellrange":cellrange,"format":format};}else if(type1=="colorGradation"){//色阶
  var maxcolor=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".colorGradationBox .maxVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString();var midcolor=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".colorGradationBox .midVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString();var mincolor=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".colorGradationBox .minVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString();if(type2=="threeColor"){//三色
  format=[maxcolor,midcolor,mincolor];}else if(type2=="twoColor"){//双色
  format=[maxcolor,mincolor];}var rule={"type":"colorGradation","cellrange":cellrange,"format":format};}else if(type1=="icons"){//图标集
  var len=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".iconsBox .model").attr("data-len");var leftMin=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".iconsBox .model").attr("data-leftmin");var top=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".iconsBox .model").attr("data-top");format={"len":len,"leftMin":leftMin,"top":top};var rule={"type":"icons","cellrange":cellrange,"format":format};}}else {var conditionName="",conditionRange=[],conditionValue=[];if(index==1){if(type1=="number"){//单元格值
  conditionName=type2;if(type2=="betweenness"){var v1=$("#luckysheet-editorConditionRule-dialog #conditionVal input").val().trim();var v2=$("#luckysheet-editorConditionRule-dialog #conditionVal2 input").val().trim();//条件值是否是选区
  var rangeArr1=luckysheet.conditionformat.getRangeByTxt(v1);if(rangeArr1.length>1){luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}else if(rangeArr1.length==1){var r1=rangeArr1[0].row[0],r2=rangeArr1[0].row[1];var c1=rangeArr1[0].column[0],c2=rangeArr1[0].column[1];if(r1==r2&&c1==c2){v1=luckysheet.getcellvalue(r1,c1,luckysheet.flowdata);conditionRange.push({"row":rangeArr1[0].row,"column":rangeArr1[0].column});conditionValue.push(v1);}else {luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}}else if(rangeArr1.length==0){if(isNaN(v1)||v1==""){luckysheet.conditionformat.infoDialog("条件值只能是数字或者单个单元格","");return;}else {conditionValue.push(v1);}}var rangeArr2=luckysheet.conditionformat.getRangeByTxt(v2);if(rangeArr2.length>1){luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}else if(rangeArr2.length==1){var r1=rangeArr2[0].row[0],r2=rangeArr2[0].row[1];var c1=rangeArr2[0].column[0],c2=rangeArr2[0].column[1];if(r1==r2&&c1==c2){v2=luckysheet.getcellvalue(r1,c1,luckysheet.flowdata);conditionRange.push({"row":rangeArr2[0].row,"column":rangeArr2[0].column});conditionValue.push(v2);}else {luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}}else if(rangeArr2.length==0){if(isNaN(v2)||v2==""){luckysheet.conditionformat.infoDialog("条件值只能是数字或者单个单元格","");return;}else {conditionValue.push(v2);}}}else {//条件值
  var v=$("#luckysheet-editorConditionRule-dialog #conditionVal input").val().trim();//条件值是否是选区
  var rangeArr=luckysheet.conditionformat.getRangeByTxt(v);if(rangeArr.length>1){luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}else if(rangeArr.length==1){var r1=rangeArr[0].row[0],r2=rangeArr[0].row[1];var c1=rangeArr[0].column[0],c2=rangeArr[0].column[1];if(r1==r2&&c1==c2){v=luckysheet.getcellvalue(r1,c1,luckysheet.flowdata);conditionRange.push({"row":rangeArr[0].row,"column":rangeArr[0].column});conditionValue.push(v);}else {luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}}else if(rangeArr.length==0){if(isNaN(v)||v==""){luckysheet.conditionformat.infoDialog("条件值只能是数字或者单个单元格","");return;}else {conditionValue.push(v);}}}}else if(type1=="text"){//特定文本
  conditionName="textContains";//条件值
  var v=$("#luckysheet-editorConditionRule-dialog #conditionVal input").val().trim();//条件值是否是选区
  var rangeArr=luckysheet.conditionformat.getRangeByTxt(v);if(rangeArr.length>1){luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}else if(rangeArr.length==1){var r1=rangeArr[0].row[0],r2=rangeArr[0].row[1];var c1=rangeArr[0].column[0],c2=rangeArr[0].column[1];if(r1==r2&&c1==c2){v=luckysheet.getcellvalue(r1,c1,luckysheet.flowdata);conditionRange.push({"row":rangeArr[0].row,"column":rangeArr[0].column});conditionValue.push(v);}else {luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}}else if(rangeArr.length==0){if(isNaN(v)||v==""){luckysheet.conditionformat.infoDialog("条件值只能是数字或者单个单元格","");return;}else {conditionValue.push(v);}}}else if(type1=="date"){//发生日期
  conditionName="occurrenceDate";//条件值
  var v=$("#luckysheet-editorConditionRule-dialog #daterange-btn").val();if(v==""||v==null){luckysheet.conditionformat.infoDialog("请选择日期","");return;}conditionValue.push(v);}}else if(index==2){//排名靠前靠后
  //条件名称
  if(type1=="top"){if($("#luckysheet-editorConditionRule-dialog #isPercent").is(":selected")){var conditionName="top10%";}else {var conditionName="top10";}}else if(type1=="last"){if($("#luckysheet-editorConditionRule-dialog #isPercent").is(":selected")){var conditionName="last10%";}else {var conditionName="last10";}}//条件值
  var v=$("#luckysheet-editorConditionRule-dialog #conditionVal input").val().trim();if(parseInt(v)!=v||parseInt(v)<1||parseInt(v)>1000){luckysheet.conditionformat.infoDialog("请输入一个介于 1 和 1000 之间的整数","");return;}conditionValue.push(v);}else if(index==3){//平均值
  if(type1=="AboveAverage"){conditionName="AboveAverage";conditionValue.push("AboveAverage");}else if(type1=="SubAverage"){conditionName="SubAverage";conditionValue.push("SubAverage");}}else if(index==4){//重复值
  conditionName="duplicateValue";conditionValue.push(type1);}//格式颜色
  if($("#luckysheet-editorConditionRule-dialog #checkTextColor").is(":checked")){var textcolor=$("#luckysheet-editorConditionRule-dialog #textcolorshow").spectrum("get").toHexString();}else {var textcolor=null;}if($("#luckysheet-editorConditionRule-dialog #checkCellColor").is(":checked")){var cellcolor=$("#luckysheet-editorConditionRule-dialog #cellcolorshow").spectrum("get").toHexString();}else {var cellcolor=null;}format={"textColor":textcolor,"cellColor":cellcolor};var rule={"type":"default","cellrange":cellrange,"format":format,"conditionName":conditionName,"conditionRange":conditionRange,"conditionValue":conditionValue};}//修改编辑的规则
  var sheetIndex=luckysheet.conditionformat.editorRule["sheetIndex"];var itemIndex=luckysheet.conditionformat.editorRule["itemIndex"];luckysheet.conditionformat.fileClone[luckysheet.sheetmanage.getSheetIndex(sheetIndex)]["luckysheet_conditionformat_save"][itemIndex]=rule;//编辑规则隐藏，管理规则显示
  $("#luckysheet-editorConditionRule-dialog").hide();luckysheet.conditionformat.administerRuleDialog();});$(document).off("click.CFeditorConditionRuleClose").on("click.CFeditorConditionRuleClose","#luckysheet-editorConditionRule-dialog-close",function(){//编辑规则隐藏，管理规则显示
  $("#luckysheet-editorConditionRule-dialog").hide();$("#luckysheet-administerRule-dialog").show();//隐藏虚线框
  $("#luckysheet-formula-functionrange-select").hide();$("#luckysheet-row-count-show").hide();$("#luckysheet-column-count-show").hide();});// 新建规则、编辑规则 类型切换
  $(document).off("click.CFnewEditorRuleItem").on("click.CFnewEditorRuleItem",".luckysheet-newEditorRule-dialog .ruleTypeItem",function(){$(this).addClass("on").siblings().removeClass("on");var index=$(this).index();$(this).parents(".luckysheet-newEditorRule-dialog").find(".ruleExplainBox").html(luckysheet.conditionformat.getRuleExplain(index));luckysheet.conditionformat.colorSelectInit();});$(document).off("change.CFnewEditorRuleType1").on("change.CFnewEditorRuleType1",".luckysheet-newEditorRule-dialog #type1",function(){var optionVal=$(this).find("option:selected").val();if(optionVal=="dataBar"||optionVal=="colorGradation"||optionVal=="icons"||optionVal=="number"||optionVal=="text"||optionVal=="date"){$(this).parents(".luckysheet-newEditorRule-dialog").find("."+optionVal+"Box").show().siblings().hide();}if(optionVal=="date"){luckysheet.conditionformat.daterangeInit($(this).parents(".luckysheet-newEditorRule-dialog").attr("id"));}});$(document).off("change.CFnewEditorRuleType2").on("change.CFnewEditorRuleType2",".luckysheet-newEditorRule-dialog #type2",function(){var type1=$(this).parents(".luckysheet-newEditorRule-dialog").find("#type1 option:selected").val();if(type1=="colorGradation"){var type2=$(this).find("option:selected").val();if(type2=="threeColor"){$(this).parents(".luckysheet-newEditorRule-dialog").find(".midVal").show();}else {$(this).parents(".luckysheet-newEditorRule-dialog").find(".midVal").hide();}}else if(type1=="number"){var type2=$(this).find("option:selected").val();if(type2=="betweenness"){$(this).parents(".luckysheet-newEditorRule-dialog").find(".txt").show();$(this).parents(".luckysheet-newEditorRule-dialog").find("#conditionVal2").show();}else {$(this).parents(".luckysheet-newEditorRule-dialog").find(".txt").hide();$(this).parents(".luckysheet-newEditorRule-dialog").find("#conditionVal2").hide();}}});$(document).off("click.CFiconsShowbox").on("click.CFiconsShowbox",".luckysheet-newEditorRule-dialog .iconsBox .showbox",function(){$(this).parents(".iconsBox").find("ul").toggle();});$(document).off("click.CFiconsLi").on("click.CFiconsLi",".luckysheet-newEditorRule-dialog .iconsBox li",function(){var len=$(this).find("div").attr("data-len");var leftmin=$(this).find("div").attr("data-leftmin");var top=$(this).find("div").attr("data-top");var title=$(this).find("div").attr("title");var position=$(this).find("div").css("background-position");$(this).parents(".iconsBox").find(".showbox .model").css("background-position",position);$(this).parents(".iconsBox").find(".showbox .model").attr("data-len",len);$(this).parents(".iconsBox").find(".showbox .model").attr("data-leftmin",leftmin);$(this).parents(".iconsBox").find(".showbox .model").attr("data-top",top);$(this).parents(".iconsBox").find(".showbox .model").attr("title",title);$(this).parents("ul").hide();});// 删除规则
  $(document).off("click.CFdeleteConditionRule").on("click.CFdeleteConditionRule","#deleteConditionRule",function(){var sheetIndex=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();var itemIndex=$("#luckysheet-administerRule-dialog .ruleList .listBox .item.on").attr("data-item");luckysheet.conditionformat.fileClone[luckysheet.sheetmanage.getSheetIndex(sheetIndex)]["luckysheet_conditionformat_save"].splice(itemIndex,1);luckysheet.conditionformat.administerRuleDialog();});// 规则子菜单弹出层 点击确定修改样式
  $(document).off("click.CFdefault").on("click.CFdefault","#luckysheet-conditionformat-dialog-confirm",function(){//条件名称
  var conditionName=$("#luckysheet-conditionformat-dialog .box").attr("data-itemvalue");//条件单元格
  var conditionRange=[];//条件值
  var conditionValue=[];if(conditionName=="greaterThan"||conditionName=="lessThan"||conditionName=="equal"||conditionName=="textContains"){var v=$("#luckysheet-conditionformat-dialog #conditionVal").val().trim();//条件值是否是选区
  var rangeArr=luckysheet.conditionformat.getRangeByTxt(v);if(rangeArr.length>1){luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}else if(rangeArr.length==1){var r1=rangeArr[0].row[0],r2=rangeArr[0].row[1];var c1=rangeArr[0].column[0],c2=rangeArr[0].column[1];if(r1==r2&&c1==c2){v=luckysheet.getcellvalue(r1,c1,luckysheet.flowdata);conditionRange.push({"row":rangeArr[0].row,"column":rangeArr[0].column});conditionValue.push(v);}else {luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}}else if(rangeArr.length==0){if(isNaN(v)||v==""){luckysheet.conditionformat.infoDialog("条件值只能是数字或者单个单元格","");return;}else {conditionValue.push(v);}}}else if(conditionName=="betweenness"){//介于
  var v1=$("#luckysheet-conditionformat-dialog #conditionVal").val().trim();var v2=$("#luckysheet-conditionformat-dialog #conditionVal2").val().trim();//条件值是否是选区
  var rangeArr1=luckysheet.conditionformat.getRangeByTxt(v1);if(rangeArr1.length>1){luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}else if(rangeArr1.length==1){var r1=rangeArr1[0].row[0],r2=rangeArr1[0].row[1];var c1=rangeArr1[0].column[0],c2=rangeArr1[0].column[1];if(r1==r2&&c1==c2){v1=luckysheet.getcellvalue(r1,c1,luckysheet.flowdata);conditionRange.push({"row":rangeArr1[0].row,"column":rangeArr1[0].column});conditionValue.push(v1);}else {luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}}else if(rangeArr1.length==0){if(isNaN(v1)||v1==""){luckysheet.conditionformat.infoDialog("条件值只能是数字或者单个单元格","");return;}else {conditionValue.push(v1);}}var rangeArr2=luckysheet.conditionformat.getRangeByTxt(v2);if(rangeArr2.length>1){luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}else if(rangeArr2.length==1){var r1=rangeArr2[0].row[0],r2=rangeArr2[0].row[1];var c1=rangeArr2[0].column[0],c2=rangeArr2[0].column[1];if(r1==r2&&c1==c2){v2=luckysheet.getcellvalue(r1,c1,luckysheet.flowdata);conditionRange.push({"row":rangeArr2[0].row,"column":rangeArr2[0].column});conditionValue.push(v2);}else {luckysheet.conditionformat.infoDialog("只能对单个单元格进行引用","");return;}}else if(rangeArr2.length==0){if(isNaN(v2)||v2==""){luckysheet.conditionformat.infoDialog("条件值只能是数字或者单个单元格","");return;}else {conditionValue.push(v2);}}}else if(conditionName=="occurrenceDate"){//日期
  var v=$("#luckysheet-conditionformat-dialog #daterange-btn").val();if(v==""||v==null){luckysheet.conditionformat.infoDialog("请选择日期","");return;}conditionValue.push(v);}else if(conditionName=="duplicateValue"){//重复值
  conditionValue.push($("#luckysheet-conditionformat-dialog #conditionVal option:selected").val());}else if(conditionName=="top10"||conditionName=="top10%"||conditionName=="last10"||conditionName=="last10%"){var v=$("#luckysheet-conditionformat-dialog #conditionVal").val().trim();if(parseInt(v)!=v||parseInt(v)<1||parseInt(v)>1000){luckysheet.conditionformat.infoDialog("请输入一个介于 1 和 1000 之间的整数","");return;}conditionValue.push(v);}else if(conditionName=="AboveAverage"){//高于平均值
  conditionValue.push("AboveAverage");}else if(conditionName=="SubAverage"){//低于平均值
  conditionValue.push("SubAverage");}//格式颜色
  if($("#checkTextColor").is(":checked")){var textcolor=$("#textcolorshow").spectrum("get").toHexString();}else {var textcolor=null;}if($("#checkCellColor").is(":checked")){var cellcolor=$("#cellcolorshow").spectrum("get").toHexString();}else {var cellcolor=null;}//保存之前的规则
  var fileH=$.extend(true,[],luckysheet.getluckysheetfile());var historyRules=luckysheet.conditionformat.getHistoryRules(fileH);//保存当前的规则
  var rule={"type":"default","cellrange":$.extend(true,[],luckysheet_select_save),"format":{"textColor":textcolor,"cellColor":cellcolor},"conditionName":conditionName,"conditionRange":conditionRange,"conditionValue":conditionValue};var ruleArr=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]==undefined?[]:luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"];ruleArr.push(rule);luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]=ruleArr;var fileC=$.extend(true,[],luckysheet.getluckysheetfile());var currentRules=luckysheet.conditionformat.getCurrentRules(fileC);//刷新一次表格
  luckysheet.conditionformat.ref(historyRules,currentRules);//隐藏一些dom
  $("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-conditionformat-dialog").hide();//发送给后台
  if(luckysheet.server.allowUpdate){luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,ruleArr,{"k":"luckysheet_conditionformat_save"});}});// 图标集弹出层 选择
  $(document).off("click.CFicons").on("click.CFicons","#luckysheet-CFicons-dialog .item",function(){$("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-CFicons-dialog").hide();if(luckysheet_select_save.length>0){var cellrange=$.extend(true,[],luckysheet_select_save);var format={"len":$(this).attr("data-len"),"leftMin":$(this).attr("data-leftMin"),"top":$(this).attr("data-top")};luckysheet.conditionformat.updateItem("icons",cellrange,format);}});// 选择单元格
  $(document).on("click",".range .fa-table",function(){var id=$(this).parents(".luckysheet-modal-dialog").attr("id");$("#"+id).hide();//入口
  if(id=="luckysheet-conditionformat-dialog"){if($(this).siblings("input").attr("id")=="conditionVal"){var source="0_1";}else {var source="0_2";}}else if(id=="luckysheet-newConditionRule-dialog"){if($(this).parents(".range").attr("id")=="conditionVal"){var source="1_1";}else {var source="1_2";}}else if(id=="luckysheet-editorConditionRule-dialog"){if($(this).parents(".range").attr("id")=="conditionVal"){var source="2_1";}else {var source="2_2";}}//input值
  var v=$(this).siblings("input").val();luckysheet.conditionformat.singleRangeDialog(source,v);luckysheet.selectionCopyShow(luckysheet.conditionformat.getRangeByTxt(v));});$(document).on("click","#luckysheet-singleRange-dialog-confirm",function(){$("#luckysheet-modal-dialog-mask").show();$(this).parents("#luckysheet-singleRange-dialog").hide();var source=$(this).attr("data-source");var v=$(this).parents("#luckysheet-singleRange-dialog").find("input").val();if(source=="0_1"){$("#luckysheet-conditionformat-dialog").show();$("#luckysheet-conditionformat-dialog #conditionVal").val(v);}else if(source=="0_2"){$("#luckysheet-conditionformat-dialog").show();$("#luckysheet-conditionformat-dialog #conditionVal2").val(v);}else if(source=="1_1"){$("#luckysheet-newConditionRule-dialog").show();$("#luckysheet-newConditionRule-dialog #conditionVal input").val(v);}else if(source=="1_2"){$("#luckysheet-newConditionRule-dialog").show();$("#luckysheet-newConditionRule-dialog #conditionVal2 input").val(v);}else if(source=="2_1"){$("#luckysheet-editorConditionRule-dialog").show();$("#luckysheet-editorConditionRule-dialog #conditionVal input").val(v);}else if(source=="2_2"){$("#luckysheet-editorConditionRule-dialog").show();$("#luckysheet-editorConditionRule-dialog #conditionVal2 input").val(v);}var range=[];luckysheet.selectionCopyShow(range);});$(document).on("click","#luckysheet-singleRange-dialog-close",function(){$("#luckysheet-modal-dialog-mask").show();$(this).parents("#luckysheet-singleRange-dialog").hide();var source=$(this).attr("data-source");if(source=="0_1"||source=="0_2"){$("#luckysheet-conditionformat-dialog").show();}else if(source=="1_1"||source=="1_2"){$("#luckysheet-newConditionRule-dialog").show();}else if(source=="2_1"||source=="2_2"){$("#luckysheet-editorConditionRule-dialog").show();}var range=[];luckysheet.selectionCopyShow(range);});// 弹出层右上角关闭按钮
  $(document).on("click",".luckysheet-modal-dialog-title-close",function(){var id=$(this).parents(".luckysheet-modal-dialog").attr("id");//新建规则弹出层
  if(id=="luckysheet-newConditionRule-dialog"){var source=$("#"+id).find("#luckysheet-newConditionRule-dialog-close").attr("data-source");//新建规则入口
  if(source==1){$("#luckysheet-administerRule-dialog").show();}}//编辑规则弹出层
  if(id=="luckysheet-editorConditionRule-dialog"){$("#luckysheet-administerRule-dialog").show();}//选择单元格弹出层
  if(id=="luckysheet-singleRange-dialog"){$("#luckysheet-modal-dialog-mask").show();var source=$(this).parents("#luckysheet-singleRange-dialog").find("#luckysheet-singleRange-dialog-confirm").attr("data-source");if(source=="0_1"||source=="0_2"){$("#luckysheet-conditionformat-dialog").show();}else if(source=="1_1"||source=="1_2"){$("#luckysheet-newConditionRule-dialog").show();}else if(source=="2_1"||source=="2_2"){$("#luckysheet-editorConditionRule-dialog").show();}var range=[];luckysheet.selectionCopyShow(range);}//选择应用范围弹出层
  if(id=="luckysheet-multiRange-dialog"){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-administerRule-dialog").show();var range=[];luckysheet.selectionCopyShow(range);}//提示框
  if(id=="luckysheet-conditionformat-info-dialog"){$("#luckysheet-modal-dialog-mask").show();}});//提示框
  $(document).on("click","#luckysheet-conditionformat-info-dialog-close",function(){$(this).parents("#luckysheet-conditionformat-info-dialog").hide();});},singleRangeDialog:function singleRangeDialog(source,value){$("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-singleRange-dialog").remove();$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-singleRange-dialog","addclass":"luckysheet-singleRange-dialog","title":"选择单元格","content":'<input readonly="readonly" placeholder="请选择单元格" value="'+value+'"/>',"botton":'<button id="luckysheet-singleRange-dialog-confirm" class="btn btn-primary" data-source="'+source+'">确定</button><button id="luckysheet-singleRange-dialog-close" class="btn btn-default" data-source="'+source+'">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-singleRange-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-singleRange-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();},multiRangeDialog:function multiRangeDialog(dataItem,value){$("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-multiRange-dialog").remove();$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-multiRange-dialog","addclass":"luckysheet-multiRange-dialog","title":"选择应用范围","content":'<input readonly="readonly" placeholder="请选择应用范围" value="'+value+'"/>',"botton":'<button id="luckysheet-multiRange-dialog-confirm" class="btn btn-primary" data-item="'+dataItem+'">确定</button><button id="luckysheet-multiRange-dialog-close" class="btn btn-default">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-multiRange-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-multiRange-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();luckysheet.selectionCopyShow(luckysheet.conditionformat.getRangeByTxt(value));},getTxtByRange:function getTxtByRange(range){if(range.length>0){var txt=[];for(var s=0;s<range.length;s++){var r1=range[s].row[0],r2=range[s].row[1];var c1=range[s].column[0],c2=range[s].column[1];txt.push(luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,{"row":[r1,r2],"column":[c1,c2]},luckysheet.currentSheetIndex));}return txt.join(",");}},getRangeByTxt:function getRangeByTxt(txt){var range=[];if(txt.indexOf(",")!=-1){var arr=txt.split(",");for(var i=0;i<arr.length;i++){if(luckysheet.formula.iscelldata(arr[i])){range.push(luckysheet.formula.getcellrange(arr[i]));}else {range=[];break;}}}else {if(luckysheet.formula.iscelldata(txt)){range.push(luckysheet.formula.getcellrange(txt));}}return range;},colorSelectInit:function colorSelectInit(){$(".luckysheet-conditionformat-config-color").spectrum({showPalette:true,showPaletteOnly:true,preferredFormat:"hex",clickoutFiresChange:false,showInitial:true,showInput:true,// flat: true,
  hideAfterPaletteSelect:true,showSelectionPalette:true,// showButtons: false,//隐藏选择取消按钮
  maxPaletteSize:8,maxSelectionSize:8,// color: currenColor,
  cancelText:"取消",chooseText:"确定颜色",togglePaletteMoreText:"自定义",togglePaletteLessText:"收起",togglePaletteOnly:true,clearText:"清除颜色选择",noColorSelectedText:"没有颜色被选择",localStorageKey:"spectrum.textcolor"+luckysheet.server.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function change(color){if(color!=null){color=color.toHexString();}}});},conditionformatDialog:function conditionformatDialog(title,content){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-conditionformat-dialog").remove();$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-conditionformat-dialog","addclass":"luckysheet-conditionformat-dialog","title":title,"content":content,"botton":'<button id="luckysheet-conditionformat-dialog-confirm" class="btn btn-primary">确定</button><button class="btn btn-default luckysheet-model-close-btn">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-conditionformat-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-conditionformat-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();luckysheet.conditionformat.init();luckysheet.conditionformat.colorSelectInit();if(title=="条件格式——发生日期"){luckysheet.conditionformat.daterangeInit("luckysheet-conditionformat-dialog");}},CFiconsDialog:function CFiconsDialog(){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-CFicons-dialog").remove();var content='<div class="box">'+'<div style="margin-bottom: 10px;">请点击选择一组图标：</div>'+'<div class="title">方向</div>'+'<div class="list">'+'<div class="left">'+'<div class="item" data-len="3" data-leftMin="0" data-top="0" title="三向箭头(彩色)"><div style="background-position:0 0;"></div></div>'+'<div class="item" data-len="3" data-leftMin="0" data-top="1" title="3个三角形"><div style="background-position:0 -20px;"></div></div>'+'<div class="item" data-len="4" data-leftMin="0" data-top="2" title="四向箭头(彩色)"><div style="background-position:0 -40px;"></div></div>'+'<div class="item" data-len="5" data-leftMin="0" data-top="3" title="五向箭头(彩色)"><div style="background-position:0 -60px;"></div></div>'+'</div>'+'<div class="right">'+'<div class="item" data-len="3" data-leftMin="5" data-top="0" title="三向箭头(灰色)"><div style="background-position:-131px 0;"></div></div>'+'<div class="item" data-len="4" data-leftMin="5" data-top="1" title="四向箭头(灰色)"><div style="background-position:-131px -20px;"></div></div>'+'<div class="item" data-len="5" data-leftMin="5" data-top="2" title="五向箭头(灰色)"><div style="background-position:-131px -40px;"></div></div>'+'</div>'+'<div style="clear:both;"></div>'+'</div>'+'<div class="title">形状</div>'+'<div class="list">'+'<div class="left">'+'<div class="item" data-len="3" data-leftMin="0" data-top="4" title="三色交通灯(无边框)"><div style="background-position:0 -80px;"></div></div>'+'<div class="item" data-len="3" data-leftMin="0" data-top="5" title="三标志"><div style="background-position:0 -100px;"></div></div>'+'<div class="item" data-len="4" data-leftMin="0" data-top="6" title="绿-红-黑渐变"><div style="background-position:0 -120px;"></div></div>'+'</div>'+'<div class="right">'+'<div class="item" data-len="3" data-leftMin="5" data-top="4" title="三色交通灯(有边框)"><div style="background-position:-131px -80px;"></div></div>'+'<div class="item" data-len="4" data-leftMin="5" data-top="5" title="四色交通灯"><div style="background-position:-131px -100px;"></div></div>'+'</div>'+'<div style="clear:both;"></div>'+'</div>'+'<div class="title">标记</div>'+'<div class="list">'+'<div class="left">'+'<div class="item" data-len="3" data-leftMin="0" data-top="7" title="三个符号(有圆圈)"><div style="background-position:0 -140px;"></div></div>'+'<div class="item" data-len="3" data-leftMin="0" data-top="8" title="三色旗"><div style="background-position:0 -160px;"></div></div>'+'</div>'+'<div class="right">'+'<div class="item" data-len="3" data-leftMin="5" data-top="7" title="三个符号(无圆圈)"><div style="background-position:-131px -140px;"></div></div>'+'</div>'+'<div style="clear:both;"></div>'+'</div>'+'<div class="title">等级</div>'+'<div class="list">'+'<div class="left">'+'<div class="item" data-len="3" data-leftMin="0" data-top="9" title="3个星形"><div style="background-position:0 -180px;"></div></div>'+'<div class="item" data-len="5" data-leftMin="0" data-top="10" title="五象限图"><div style="background-position:0 -200px;"></div></div>'+'<div class="item" data-len="5" data-leftMin="0" data-top="11" title="5个框"><div style="background-position:0 -220px;"></div></div>'+'</div>'+'<div class="right">'+'<div class="item" data-len="4" data-leftMin="5" data-top="9" title="四等级"><div style="background-position:-131px -180px;"></div></div>'+'<div class="item" data-len="5" data-leftMin="5" data-top="10" title="五等级"><div style="background-position:-131px -200px;"></div></div>'+'</div>'+'<div style="clear:both;"></div>'+'</div>'+'</div>';$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-CFicons-dialog","addclass":"luckysheet-CFicons-dialog","title":"图标集","content":content,"botton":'<button class="btn btn-default luckysheet-model-close-btn">关闭</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-CFicons-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-CFicons-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();},administerRuleDialog:function administerRuleDialog(){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-administerRule-dialog").remove();//工作表
  var opHtml='';for(var j=0;j<luckysheetfile.length;j++){if(luckysheetfile[j].status=="1"){opHtml+='<option value="'+luckysheetfile[j]["index"]+'" selected="selected">当前工作表：'+luckysheetfile[j]["name"]+'</option>';}else {opHtml+='<option value="'+luckysheetfile[j]["index"]+'">表：'+luckysheetfile[j]["name"]+'</option>';}}var content='<div class="chooseSheet">'+'<label>显示其格式规则：</label>'+'<select>'+opHtml+'</select>'+'</div>'+'<div class="ruleBox">'+'<div class="ruleBtn">'+'<button id="newConditionRule" class="btn btn-default">新建规则</button>'+'<button id="editorConditionRule" class="btn btn-default">编辑规则</button>'+'<button id="deleteConditionRule" class="btn btn-default">删除规则</button>'+'</div>'+'<div class="ruleList">'+'<div class="listTitle">'+'<span>规则</span>'+'<span>格式</span>'+'<span>应用范围</span>'+'</div>'+'<div class="listBox"></div>'+'</div>'+'</div>';$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-administerRule-dialog","addclass":"luckysheet-administerRule-dialog","title":"条件格式规则管理器","content":content,"botton":'<button id="luckysheet-administerRule-dialog-confirm" class="btn btn-primary">确定</button><button id="luckysheet-administerRule-dialog-close" class="btn btn-default">关闭</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-administerRule-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-administerRule-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();//当前工作表的规则列表
  var index=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();luckysheet.conditionformat.getConditionRuleList(index);},getConditionRuleList:function getConditionRuleList(index){$("#luckysheet-administerRule-dialog .ruleList .listBox").empty();var ruleArr=luckysheet.conditionformat.fileClone[luckysheet.sheetmanage.getSheetIndex(index)].luckysheet_conditionformat_save;//条件格式规则集合
  if(ruleArr!=null&&ruleArr.length>0){for(var i=0;i<ruleArr.length;i++){var type=ruleArr[i]["type"];//规则类型
  var format=ruleArr[i]["format"];//规则样式
  var cellrange=ruleArr[i]["cellrange"];//规则应用范围
  var ruleName;//规则名称
  var formatHtml='';//样式dom
  if(type=="dataBar"){ruleName="数据条";formatHtml='<canvas width="46" height="18" style="width: 46px;height: 18px;margin: 3px 0 0 5px;"></canvas>';}else if(type=="colorGradation"){ruleName="色阶";formatHtml='<canvas width="46" height="18" style="width: 46px;height: 18px;margin: 3px 0 0 5px;"></canvas>';}else if(type=="icons"){ruleName="图标集";formatHtml='<canvas width="46" height="18" style="width: 46px;height: 18px;margin: 3px 0 0 5px;"></canvas>';}else {ruleName=luckysheet.conditionformat.getConditionRuleName(ruleArr[i].conditionName,ruleArr[i].conditionRange,ruleArr[i].conditionValue);if(format["textColor"]!=null){formatHtml+='<span class="colorbox" title="文本颜色" style="background-color:'+format["textColor"]+'"></span>';}if(format["cellColor"]!=null){formatHtml+='<span class="colorbox" title="单元格颜色" style="background-color:'+format["cellColor"]+'"></span>';}}//应用范围dom
  var rangeTxtArr=[];for(var s=0;s<cellrange.length;s++){var r1=cellrange[s].row[0],r2=cellrange[s].row[1];var c1=cellrange[s].column[0],c2=cellrange[s].column[1];rangeTxtArr.push(luckysheet.luckysheetchatatABC(c1)+(r1+1)+":"+luckysheet.luckysheetchatatABC(c2)+(r2+1));}//条件格式规则列表dom
  var itemHtml='<div class="item" data-item="'+i+'">'+'<div class="ruleName" title="'+ruleName+'">'+ruleName+'</div>'+'<div class="format">'+formatHtml+'</div>'+'<div class="ruleRange">'+'<input class="formulaInputFocus" readonly="true" value="'+rangeTxtArr.join(",")+'"/>'+'<i class="fa fa-table" aria-hidden="true" title="点击选择应用范围"></i>'+'</div>'+'</div>';$("#luckysheet-administerRule-dialog .ruleList .listBox").prepend(itemHtml);}$("#luckysheet-administerRule-dialog .ruleList .listBox .item canvas").each(function(i){var x=$(this).closest(".item").attr("data-item");var type=ruleArr[x]["type"];var format=ruleArr[x]["format"];var can=$(this).get(0).getContext("2d");if(type=="dataBar"){if(format.length==2){var my_gradient=can.createLinearGradient(0,0,46,0);my_gradient.addColorStop(0,format[0]);my_gradient.addColorStop(1,format[1]);can.fillStyle=my_gradient;can.fillRect(0,0,46,18);can.beginPath();can.moveTo(0,0);can.lineTo(0,18);can.lineTo(46,18);can.lineTo(46,0);can.lineTo(0,0);can.lineWidth=devicePixelRatio;can.strokeStyle=format[0];can.stroke();can.closePath();}else if(format.length==1){can.fillStyle=format[0];can.fillRect(0,0,46,18);can.beginPath();can.moveTo(0,0);can.lineTo(0,18);can.lineTo(46,18);can.lineTo(46,0);can.lineTo(0,0);can.lineWidth=devicePixelRatio;can.strokeStyle=format[0];can.stroke();can.closePath();}}else if(type=="colorGradation"){var my_gradient=can.createLinearGradient(0,0,46,0);if(format.length==3){my_gradient.addColorStop(0,format[0]);my_gradient.addColorStop(0.5,format[1]);my_gradient.addColorStop(1,format[2]);}else if(format.length==2){my_gradient.addColorStop(0,format[0]);my_gradient.addColorStop(1,format[1]);}can.fillStyle=my_gradient;can.fillRect(0,0,46,18);}else if(type=="icons"){var len=format["len"];var l=format["leftMin"];var t=format["top"];var w1=32*len+10*(len-1);var h1=32;var w2=46;var h2=46*32/w1;if(l=="0"){can.drawImage(luckysheet_CFiconsImg,0,t*32,w1,h1,0,(18-h2)/2,w2,h2);}else if(l=="5"){can.drawImage(luckysheet_CFiconsImg,210,t*32,w1,h1,0,(18-h2)/2,w2,h2);}}});$("#luckysheet-administerRule-dialog .ruleList .listBox .item").eq(0).addClass("on");}},getConditionRuleName:function getConditionRuleName(conditionName,conditionRange,conditionValue){//v 有条件单元格取条件单元格，若无取条件值
  if(conditionRange[0]!=null){var v=luckysheet.luckysheetchatatABC(conditionRange[0]["column"][0])+(conditionRange[0]["row"][0]+1);}else {var v=conditionValue[0];}//返回条件格式规则名称
  if(conditionName=="greaterThan"){return "单元格值 > "+v;}else if(conditionName=="lessThan"){return "单元格值 < "+v;}else if(conditionName=="betweenness"){if(conditionRange[1]!=null){var v2=luckysheet.luckysheetchatatABC(conditionRange[1]["column"][0])+(conditionRange[1]["row"][0]+1);}else {var v2=conditionValue[1];}return "单元格值介于 "+v+" 和 "+v2+" 之间";}else if(conditionName=="equal"){return "单元格值 = "+v;}else if(conditionName=="textContains"){return "单元格值包含 ="+v;}else if(conditionName=="occurrenceDate"){return conditionValue;}else if(conditionName=="duplicateValue"){if(conditionValue=="0"){return "重复值";}if(conditionValue=="1"){return "唯一值";}}else if(conditionName=="top10"){return "前 "+v+" 个";}else if(conditionName=="top10%"){return "前 "+v+"% 个";}else if(conditionName=="last10"){return "后 "+v+" 个";}else if(conditionName=="last10%"){return "后 "+v+"% 个";}else if(conditionName=="AboveAverage"){return "高于平均值";}else if(conditionName=="SubAverage"){return "低于平均值";}},newConditionRuleDialog:function newConditionRuleDialog(source){//规则说明
  var ruleExplainHtml=luckysheet.conditionformat.getRuleExplain(0);//弹出层
  $("#luckysheet-modal-dialog-mask").show();$("#luckysheet-administerRule-dialog").hide();$("#luckysheet-newConditionRule-dialog").remove();var content='<div>'+'<div class="boxTitle">选择规则类型：</div>'+luckysheet.conditionformat.ruleTypeHtml+'<div class="boxTitle">编辑规则说明：</div>'+'<div class="ruleExplainBox">'+ruleExplainHtml+'</div>'+'</div>';$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-newConditionRule-dialog","addclass":"luckysheet-newEditorRule-dialog","title":"新建格式规则","content":content,"botton":'<button id="luckysheet-newConditionRule-dialog-confirm" class="btn btn-primary" data-source="'+source+'">确定</button><button id="luckysheet-newConditionRule-dialog-close" class="btn btn-default" data-source="'+source+'">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-newConditionRule-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-newConditionRule-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();//index的规则类型focus
  $("#luckysheet-newConditionRule-dialog .ruleTypeBox .ruleTypeItem:eq(0)").addClass("on").siblings().removeClass("on");luckysheet.conditionformat.colorSelectInit();},editorConditionRuleDialog:function editorConditionRuleDialog(){var rule=luckysheet.conditionformat.editorRule.data;var ruleType=rule["type"],ruleFormat=rule["format"];var index,type1;if(ruleType=="dataBar"||ruleType=="colorGradation"||ruleType=="icons"){index=0;type1=ruleType;}else {var conditionName=rule["conditionName"];if(conditionName=="greaterThan"||conditionName=="lessThan"||conditionName=="betweenness"||conditionName=="equal"||conditionName=="textContains"||conditionName=="occurrenceDate"){index=1;if(conditionName=="greaterThan"||conditionName=="lessThan"||conditionName=="betweenness"||conditionName=="equal"){type1="number";}else if(conditionName=="textContains"){type1="text";}else if(conditionName=="occurrenceDate"){type1="date";}}else if(conditionName=="top10"||conditionName=="top10%"||conditionName=="last10"||conditionName=="last10%"){index=2;if(conditionName=="top10"||conditionName=="top10%"){type1="top";}else if(conditionName=="last10"||conditionName=="last10%"){type1="last";}}else if(conditionName=="AboveAverage"||conditionName=="SubAverage"){index=3;type1=conditionName;}else if(conditionName=="duplicateValue"){index=4;type1=rule["conditionValue"];}}//规则说明
  var ruleExplainHtml=luckysheet.conditionformat.getRuleExplain(index);//弹出层
  $("#luckysheet-modal-dialog-mask").show();$("#luckysheet-administerRule-dialog").hide();$("#luckysheet-editorConditionRule-dialog").remove();var content='<div>'+'<div class="boxTitle">选择规则类型：</div>'+luckysheet.conditionformat.ruleTypeHtml+'<div class="boxTitle">编辑规则说明：</div>'+'<div class="ruleExplainBox">'+ruleExplainHtml+'</div>'+'</div>';$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-editorConditionRule-dialog","addclass":"luckysheet-newEditorRule-dialog","title":"编辑格式规则","content":content,"botton":'<button id="luckysheet-editorConditionRule-dialog-confirm" class="btn btn-primary">确定</button><button id="luckysheet-editorConditionRule-dialog-close" class="btn btn-default">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-editorConditionRule-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-editorConditionRule-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();luckysheet.conditionformat.colorSelectInit();//规则类型focus
  $("#luckysheet-editorConditionRule-dialog .ruleTypeBox .ruleTypeItem:eq("+index+")").addClass("on").siblings().removeClass("on");//type1
  $("#luckysheet-editorConditionRule-dialog #type1").val(type1);if(type1=="dataBar"||type1=="colorGradation"||type1=="icons"||type1=="number"||type1=="text"||type1=="date"){$("#luckysheet-editorConditionRule-dialog ."+type1+"Box").show();$("#luckysheet-editorConditionRule-dialog ."+type1+"Box").siblings().hide();}if(type1=="date"){luckysheet.conditionformat.daterangeInit("luckysheet-editorConditionRule-dialog");}//type2  format  value
  if(ruleType=="dataBar"||ruleType=="colorGradation"||ruleType=="icons"){if(type1=="dataBar"){if(ruleFormat.length==2){$("#luckysheet-editorConditionRule-dialog .dataBarBox #type2").val("gradient");}else if(ruleFormat.length==1){$("#luckysheet-editorConditionRule-dialog .dataBarBox #type2").val("solid");}$("#luckysheet-editorConditionRule-dialog .dataBarBox .luckysheet-conditionformat-config-color").spectrum("set",ruleFormat[0]);}else if(type1=="colorGradation"){if(ruleFormat.length==3){$("#luckysheet-editorConditionRule-dialog .colorGradationBox #type2").val("threeColor");$("#luckysheet-editorConditionRule-dialog .colorGradationBox .midVal").show();$("#luckysheet-editorConditionRule-dialog .colorGradationBox .maxVal .luckysheet-conditionformat-config-color").spectrum("set",ruleFormat[0]);$("#luckysheet-editorConditionRule-dialog .colorGradationBox .midVal .luckysheet-conditionformat-config-color").spectrum("set",ruleFormat[1]);$("#luckysheet-editorConditionRule-dialog .colorGradationBox .minVal .luckysheet-conditionformat-config-color").spectrum("set",ruleFormat[2]);}else if(ruleFormat.length==2){$("#luckysheet-editorConditionRule-dialog .colorGradationBox #type2").val("twoColor");$("#luckysheet-editorConditionRule-dialog .colorGradationBox .midVal").hide();$("#luckysheet-editorConditionRule-dialog .colorGradationBox .maxVal .luckysheet-conditionformat-config-color").spectrum("set",ruleFormat[0]);$("#luckysheet-editorConditionRule-dialog .colorGradationBox .minVal .luckysheet-conditionformat-config-color").spectrum("set",ruleFormat[1]);}}else if(type1=="icons"){var len=ruleFormat["len"];var l=ruleFormat["leftMin"];var t=ruleFormat["top"];$("#luckysheet-editorConditionRule-dialog .iconsBox li").each(function(i,e){if($(e).find("div").attr("data-len")==len&&$(e).find("div").attr("data-leftmin")==l&&$(e).find("div").attr("data-top")==t){$("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").css("background-position",$(e).find("div").css("background-position"));$("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").attr("data-len",$(e).find("div").attr("data-len"));$("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").attr("data-leftmin",$(e).find("div").attr("data-leftmin"));$("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").attr("data-top",$(e).find("div").attr("data-leftmin"));$("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").attr("title",$(e).find("div").attr("title"));return true;}});}}else {if(type1=="number"){$("#luckysheet-editorConditionRule-dialog .numberBox #type2").val(conditionName);if(rule.conditionRange[0]!=null){var val1=luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,{"row":rule.conditionRange[0]["row"],"column":rule.conditionRange[0]["column"]},luckysheet.currentSheetIndex);}else {var val1=rule.conditionValue[0];}$("#luckysheet-editorConditionRule-dialog .numberBox #conditionVal input").val(val1);if(conditionName=="betweenness"){$("#luckysheet-editorConditionRule-dialog .numberBox .txt").show();$("#luckysheet-editorConditionRule-dialog .numberBox #conditionVal2").show();if(rule.conditionRange[1]!=null){var val2=luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,{"row":rule.conditionRange[1]["row"],"column":rule.conditionRange[1]["column"]},luckysheet.currentSheetIndex);}else {var val2=rule.conditionValue[1];}$("#luckysheet-editorConditionRule-dialog .numberBox #conditionVal2 input").val(val2);}else {$("#luckysheet-editorConditionRule-dialog .numberBox .txt").hide();$("#luckysheet-editorConditionRule-dialog .numberBox #conditionVal2").hide();}}else if(type1=="text"){if(rule.conditionRange[0]!=null){var val1=luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,{"row":rule.conditionRange[0]["row"],"column":rule.conditionRange[0]["column"]},luckysheet.currentSheetIndex);}else {var val1=rule.conditionValue[0];}$("#luckysheet-editorConditionRule-dialog .textBox #conditionVal input").val(val1);}else if(type1=="date"){luckysheet.conditionformat.daterangeInit("luckysheet-editorConditionRule-dialog");var val1=rule.conditionValue[0];$("#luckysheet-editorConditionRule-dialog .dateBox #daterange-btn").val(val1);}else if(type1=="top"||type1=="last"){var val1=rule.conditionValue[0];if(conditionName=="top10%"||conditionName=="last10%"){$("#luckysheet-editorConditionRule-dialog #isPercent").attr("checked","checked");}}}},infoDialog:function infoDialog(title,content){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-conditionformat-info-dialog").remove();$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-conditionformat-info-dialog","addclass":"","title":title,"content":content,"botton":'<button id="luckysheet-conditionformat-info-dialog-close" class="btn btn-default">&nbsp;&nbsp;关闭&nbsp;&nbsp;</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-conditionformat-info-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-conditionformat-info-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();},getRuleExplain:function getRuleExplain(index){var textCellColorHtml=luckysheet.conditionformat.textCellColorHtml;switch(index){case 0://基于各自值设置所有单元格的格式
  var ruleExplainHtml='<div class="title">基于各自值设置所有单元格的格式：</div>'+'<div style="height: 30px;margin-bottom: 5px;">'+'<label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">格式样式：</label>'+'<select id="type1">'+'<option value="dataBar">数据条</option>'+'<option value="colorGradation">色阶</option>'+'<option value="icons">图标集</option>'+'</select>'+'</div>'+'<div>'+'<div class="type1Box dataBarBox">'+'<div style="height: 30px;margin-bottom: 5px;">'+'<label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">填充类型：</label>'+'<select id="type2">'+'<option value="gradient">渐变</option>'+'<option value="solid">实心</option>'+'</select>'+'</div>'+'<div style="height: 30px;margin-bottom: 5px;">'+'<label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">颜色：</label>'+'<input data-tips="数据条颜色" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="#638ec6" style="display: none;">'+'</div>'+'</div>'+'<div class="type1Box colorGradationBox" style="display: none;">'+'<div style="height: 30px;margin-bottom: 5px;">'+'<label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">填充类型：</label>'+'<select id="type2">'+'<option value="threeColor">三色</option>'+'<option value="twoColor">双色</option>'+'</select>'+'</div>'+'<div class="maxVal" style="height: 30px;margin-bottom: 5px;">'+'<label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">最大值：</label>'+'<input data-tips="最大值颜色" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="rgb(99, 190, 123)" style="display: none;">'+'</div>'+'<div class="midVal" style="height: 30px;margin-bottom: 5px;">'+'<label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">中间值：</label>'+'<input data-tips="中间值颜色" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="rgb(255, 235, 132)" style="display: none;">'+'</div>'+'<div class="minVal" style="height: 30px;margin-bottom: 5px;">'+'<label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">最小值：</label>'+'<input data-tips="最小值颜色" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="rgb(248, 105, 107)" style="display: none;">'+'</div>'+'</div>'+'<div class="type1Box iconsBox" style="display: none;">'+'<label>填充类型：</label>'+'<div class="showbox">'+'<div class="model" data-len="3" data-leftmin="0" data-top="0" title="三向箭头(彩色)" style="background-position: 0 0;"></div>'+'<span class="ui-selectmenu-icon ui-icon ui-icon-triangle-1-s" style="margin-top: 2px;"></span>'+'</div>'+'<ul>'+'<li><div data-len="3" data-leftmin="0" data-top="0" title="三向箭头(彩色)" style="background-position: 0 0;"></div></li>'+'<li><div data-len="3" data-leftmin="5" data-top="0" title="三向箭头(灰色)" style="background-position: -131px 0;"></div></li>'+'<li><div data-len="3" data-leftmin="0" data-top="1" title="3个三角形" style="background-position: 0 -20px;"></div></li>'+'<li><div data-len="4" data-leftmin="0" data-top="2" title="四向箭头(彩色)" style="background-position: 0 -40px;"></div></li>'+'<li><div data-len="4" data-leftmin="5" data-top="1" title="四向箭头(灰色)" style="background-position: -131px -20px;"></div></li>'+'<li><div data-len="5" data-leftmin="0" data-top="3" title="五向箭头(彩色)" style="background-position: 0 -60px;"></div></li>'+'<li><div data-len="5" data-leftmin="5" data-top="2" title="五向箭头(灰色)" style="background-position: -131px -40px;"></div></li>'+'<li><div data-len="3" data-leftmin="0" data-top="4" title="三色交通灯(无边框)" style="background-position: 0 -80px;"></div></li>'+'<li><div data-len="3" data-leftmin="5" data-top="4" title="三色交通灯(有边框)" style="background-position: -131px -80px;"></div></li>'+'<li><div data-len="3" data-leftmin="0" data-top="5" title="三标志" style="background-position: 0 -100px;"></div></li>'+'<li><div data-len="4" data-leftmin="5" data-top="5" title="四色交通灯" style="background-position: -131px -100px;"></div></li>'+'<li><div data-len="4" data-leftmin="0" data-top="6" title="绿-红-黑渐变" style="background-position: 0 -120px;"></div></li>'+'<li><div data-len="3" data-leftmin="0" data-top="7" title="三个符号(有圆圈)" style="background-position: 0 -140px;"></div></li>'+'<li><div data-len="3" data-leftmin="5" data-top="7" title="三个符号(无圆圈)" style="background-position: -131px -140px;"></div></li>'+'<li><div data-len="3" data-leftmin="0" data-top="8" title="三色旗" style="background-position: 0 -160px;"></div></li>'+'<li><div data-len="3" data-leftmin="0" data-top="9" title="3个星形" style="background-position: 0 -180px;"></div></li>'+'<li><div data-len="5" data-leftmin="0" data-top="10" title="五象限图" style="background-position: 0 -200px;"></div></li>'+'<li><div data-len="5" data-leftmin="0" data-top="11" title="5个框" style="background-position: 0 -220px;"></div></li>'+'<li><div data-len="4" data-leftmin="5" data-top="9" title="四等级" style="background-position: -131px -180px;"></div></li>'+'<li><div data-len="5" data-leftmin="5" data-top="10" title="五等级" style="background-position: -131px -200px;"></div></li>'+'</ul>'+'</div>'+'</div>';break;case 1://只为包含以下内容的单元格设置格式
  var ruleExplainHtml='<div class="title">只为满足以下条件的单元格：</div>'+'<div style="height: 30px;margin-bottom: 10px;">'+'<select id="type1">'+'<option value="number">单元格值</option>'+'<option value="text">特定文本</option>'+'<option value="date">发生日期</option>'+'</select>'+'<div>'+'<div class="type1Box numberBox">'+'<select id="type2">'+'<option value="greaterThan">大于</option>'+'<option value="lessThan">小于</option>'+'<option value="betweenness">介于</option>'+'<option value="equal">等于</option>'+'</select>'+'<div class="inpbox range" id="conditionVal">'+'<input class="formulaInputFocus"/><i class="fa fa-table" aria-hidden="true" title="点击选择单元格"></i>'+'</div>'+'<span class="txt" style="display: none;">到</span>'+'<div class="inpbox range" id="conditionVal2" style="display: none;">'+'<input class="formulaInputFocus"/><i class="fa fa-table" aria-hidden="true" title="点击选择数据范围"></i>'+'</div>'+'</div>'+'<div class="type1Box textBox" style="display: none;">'+'<select id="type2">'+'<option value="">包含</option>'+'</select>'+'<div class="inpbox range" id="conditionVal">'+'<input class="formulaInputFocus"/><i class="fa fa-table" aria-hidden="true" title="点击选择单元格"></i>'+'</div>'+'</div>'+'<div class="type1Box dateBox" style="display: none;">'+'<div style="width: 162px;" class="inpbox">'+'<input style="width: 150px;" id="daterange-btn" readonly="readonly" placeholder="请选择日期"/>'+'</div>'+'</div>'+'</div>'+'</div>'+'<div class="title">设置格式：</div>'+textCellColorHtml;break;case 2://仅对排名靠前或靠后的数值设置格式
  var ruleExplainHtml='<div class="title">为以下排名内的值：</div>'+'<div style="height: 30px;margin-bottom: 10px;">'+'<select id="type1">'+'<option value="top">前</option>'+'<option value="last">后</option>'+'</select>'+'<div class="inpbox" id="conditionVal">'+'<input class="formulaInputFocus" type="number" value="10"/>'+'</div>'+'<input id="isPercent" type="checkbox"/>'+'<label for="isPercent" class="txt">所选范围的百分比</label>'+'</div>'+'<div class="title">设置格式：</div>'+textCellColorHtml;break;case 3://仅对高于或低于平均值的数值设置格式
  var ruleExplainHtml='<div class="title">为满足以下条件的值：</div>'+'<div style="height: 30px;margin-bottom: 10px;">'+'<select id="type1">'+'<option value="AboveAverage">高于</option>'+'<option value="SubAverage">低于</option>'+'</select>'+'<span class="txt">选定范围的平均值</span>'+'</div>'+'<div class="title">设置格式：</div>'+textCellColorHtml;break;case 4://仅对唯一值或重复值设置格式
  var ruleExplainHtml='<div class="title">全部：</div>'+'<div style="height: 30px;margin-bottom: 10px;">'+'<select id="type1">'+'<option value="0">重复</option>'+'<option value="1">唯一</option>'+'</select>'+'<span class="txt">选定范围中的数值</span>'+'</div>'+'<div class="title">设置格式：</div>'+textCellColorHtml;break;}return ruleExplainHtml;},daterangeInit:function daterangeInit(id){//日期选择插件
  $('.ranges_1 ul').remove();$('#'+id).find("#daterange-btn").daterangepicker({ranges:{// '全部': [moment(), moment().subtract(-1, 'days')],
  '昨天':[moment().subtract(1,'days'),moment().subtract(1,'days')],'今天':[moment(),moment()],// '明天': [moment().subtract(-1, 'days'), moment().subtract(-1, 'days')],
  '上周':[moment(moment().subtract(1,'week')).subtract(new Date().getDay()-1,'days'),moment().subtract(new Date().getDay(),'days')],'本周':[moment().subtract(new Date().getDay()-1,'days'),moment().add(7-new Date().getDay(),'days')],'上月':[moment(moment().format('YYYY-MM')).subtract(1,'month'),moment(moment().format('YYYY-MM')).subtract(1,'day')],'本月':[moment().format('YYYY-MM'),moment(moment(moment().format('YYYY-MM')).add(1,'month')).subtract(1,'day')],'去年':[moment(moment(moment().format('YYYY'))).subtract(1,'years').format('YYYY'),moment(moment().format('YYYY')).subtract(1,'day')],'本年':[moment().format('YYYY'),moment(moment(moment().add(1,'years')).format('YYYY')).subtract(1,'day')],'最近7天':[moment().subtract(6,'days'),moment()],'最近30天':[moment().subtract(29,'days'),moment()]// '未来七天': [moment(),moment().subtract(-6, 'days')],
  // '未来30天': [moment(),moment().subtract(-29, 'days')],
  // '未来60天': [moment(),moment().subtract(-59, 'days'), ]
  },startDate:moment(),endDate:moment()},function(start,end,label){//label:通过它来知道用户选择的是什么，传给后台进行相应的展示
  if(label=='全部'){$('#daterange-btn').val('');}else if(label=='昨天'||label=='今天'){$('#daterange-btn').val(start.format('YYYY/MM/DD'));}else if(label=='上周'||label=='本周'||label=='上月'||label=='本月'||label=='去年'||label=='本年'||label=='最近7天'||label=='最近30天'){$('#daterange-btn').val(start.format('YYYY/MM/DD')+'-'+end.format('YYYY/MM/DD'));}});},CFSplitRange:function CFSplitRange(range1,range2,range3,type){var range=[];var offset_r=range3["row"][0]-range2["row"][0];var offset_c=range3["column"][0]-range2["column"][0];var r1=range1["row"][0],r2=range1["row"][1];var c1=range1["column"][0],c2=range1["column"][1];if(r1>=range2["row"][0]&&r2<=range2["row"][1]&&c1>=range2["column"][0]&&c2<=range2["column"][1]){//选区 包含 条件格式应用范围 全部
  if(type=="allPart"){//所有部分
  range=[{"row":[r1+offset_r,r2+offset_r],"column":[c1+offset_c,c2+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[];}else if(type=="operatePart"){//操作部分
  range=[{"row":[r1+offset_r,r2+offset_r],"column":[c1+offset_c,c2+offset_c]}];}}else if(r1>=range2["row"][0]&&r1<=range2["row"][1]&&c1>=range2["column"][0]&&c2<=range2["column"][1]){//选区 行贯穿 条件格式应用范围 上部分
  if(type=="allPart"){//所有部分
  range=[{"row":[range2["row"][1]+1,r2],"column":[c1,c2]},{"row":[r1+offset_r,range2["row"][1]+offset_r],"column":[c1+offset_c,c2+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[range2["row"][1]+1,r2],"column":[c1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[r1+offset_r,range2["row"][1]+offset_r],"column":[c1+offset_c,c2+offset_c]}];}}else if(r2>=range2["row"][0]&&r2<=range2["row"][1]&&c1>=range2["column"][0]&&c2<=range2["column"][1]){//选区 行贯穿 条件格式应用范围 下部分
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][0]+offset_r,r2+offset_r],"column":[c1+offset_c,c2+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[range2["row"][0]+offset_r,r2+offset_r],"column":[c1+offset_c,c2+offset_c]}];}}else if(r1<range2["row"][0]&&r2>range2["row"][1]&&c1>=range2["column"][0]&&c2<=range2["column"][1]){//选区 行贯穿 条件格式应用范围 中间部分
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]},{"row":[range2["row"][0]+offset_r,range2["row"][1]+offset_r],"column":[c1+offset_c,c2+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[range2["row"][0]+offset_r,range2["row"][1]+offset_r],"column":[c1+offset_c,c2+offset_c]}];}}else if(c1>=range2["column"][0]&&c1<=range2["column"][1]&&r1>=range2["row"][0]&&r2<=range2["row"][1]){//选区 列贯穿 条件格式应用范围 左部分 
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,r2],"column":[range2["column"][1]+1,c2]},{"row":[r1+offset_r,r2+offset_r],"column":[c1+offset_c,range2["column"][1]+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,r2],"column":[range2["column"][1]+1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[r1+offset_r,r2+offset_r],"column":[c1+offset_c,range2["column"][1]+offset_c]}];}}else if(c2>=range2["column"][0]&&c2<=range2["column"][1]&&r1>=range2["row"][0]&&r2<=range2["row"][1]){//选区 列贯穿 条件格式应用范围 右部分
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,r2],"column":[c1,range2["column"][0]-1]},{"row":[r1+offset_r,r2+offset_r],"column":[range2["column"][0]+offset_c,c2+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,r2],"column":[c1,range2["column"][0]-1]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[r1+offset_r,r2+offset_r],"column":[range2["column"][0]+offset_c,c2+offset_c]}];}}else if(c1<range2["column"][0]&&c2>range2["column"][1]&&r1>=range2["row"][0]&&r2<=range2["row"][1]){//选区 列贯穿 条件格式应用范围 中间部分
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,r2],"column":[c1,range2["column"][0]-1]},{"row":[r1,r2],"column":[range2["column"][1]+1,c2]},{"row":[r1+offset_r,r2+offset_r],"column":[range2["column"][0]+offset_c,range2["column"][1]+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,r2],"column":[c1,range2["column"][0]-1]},{"row":[r1,r2],"column":[range2["column"][1]+1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[r1+offset_r,r2+offset_r],"column":[range2["column"][0]+offset_c,range2["column"][1]+offset_c]}];}}else if(r1>=range2["row"][0]&&r1<=range2["row"][1]&&c1>=range2["column"][0]&&c1<=range2["column"][1]){//选区 包含 条件格式应用范围 左上角部分
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,range2["row"][1]],"column":[range2["column"][1]+1,c2]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]},{"row":[r1+offset_r,range2["row"][1]+offset_r],"column":[c1+offset_c,range2["column"][1]+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,range2["row"][1]],"column":[range2["column"][1]+1,c2]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[r1+offset_r,range2["row"][1]+offset_r],"column":[c1+offset_c,range2["column"][1]+offset_c]}];}}else if(r1>=range2["row"][0]&&r1<=range2["row"][1]&&c2>=range2["column"][0]&&c2<=range2["column"][1]){//选区 包含 条件格式应用范围 右上角部分
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,range2["row"][1]],"column":[c1,range2["column"][0]-1]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]},{"row":[r1+offset_r,range2["row"][1]+offset_r],"column":[range2["column"][0]+offset_c,c2+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,range2["row"][1]],"column":[c1,range2["column"][0]-1]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[r1+offset_r,range2["row"][1]+offset_r],"column":[range2["column"][0]+offset_c,c2+offset_c]}];}}else if(r2>=range2["row"][0]&&r2<=range2["row"][1]&&c1>=range2["column"][0]&&c1<=range2["column"][1]){//选区 包含 条件格式应用范围 左下角部分
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][0],r2],"column":[range2["column"][1]+1,c2]},{"row":[range2["row"][0]+offset_r,r2+offset_r],"column":[c1+offset_c,range2["column"][1]+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][0],r2],"column":[range2["column"][1]+1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[range2["row"][0]+offset_r,r2+offset_r],"column":[c1+offset_c,range2["column"][1]+offset_c]}];}}else if(r2>=range2["row"][0]&&r2<=range2["row"][1]&&c2>=range2["column"][0]&&c2<=range2["column"][1]){//选区 包含 条件格式应用范围 右下角部分
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][0],r2],"column":[c1,range2["column"][0]-1]},{"row":[range2["row"][0]+offset_r,r2+offset_r],"column":[range2["column"][0]+offset_c,c2+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][0],r2],"column":[c1,range2["column"][0]-1]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[range2["row"][0]+offset_r,r2+offset_r],"column":[range2["column"][0]+offset_c,c2+offset_c]}];}}else if(r1<range2["row"][0]&&r2>range2["row"][1]&&c1>=range2["column"][0]&&c1<=range2["column"][1]){//选区 包含 条件格式应用范围 左中间部分
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][0],range2["row"][1]],"column":[range2["column"][1]+1,c2]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]},{"row":[range2["row"][0]+offset_r,range2["row"][1]+offset_r],"column":[c1+offset_c,range2["column"][1]+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][0],range2["row"][1]],"column":[range2["column"][1]+1,c2]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[range2["row"][0]+offset_r,range2["row"][1]+offset_r],"column":[c1+offset_c,range2["column"][1]+offset_c]}];}}else if(r1<range2["row"][0]&&r2>range2["row"][1]&&c2>=range2["column"][0]&&c2<=range2["column"][1]){//选区 包含 条件格式应用范围 右中间部分
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][0],range2["row"][1]],"column":[c1,range2["column"][0]-1]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]},{"row":[range2["row"][0]+offset_r,range2["row"][1]+offset_r],"column":[range2["column"][0]+offset_c,c2+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][0],range2["row"][1]],"column":[c1,range2["column"][0]-1]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[range2["row"][0]+offset_r,range2["row"][1]+offset_r],"column":[range2["column"][0]+offset_c,c2+offset_c]}];}}else if(c1<range2["column"][0]&&c2>range2["column"][1]&&r1>=range2["row"][0]&&r1<=range2["row"][1]){//选区 包含 条件格式应用范围 上中间部分
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,range2["row"][1]],"column":[c1,range2["column"][0]-1]},{"row":[r1,range2["row"][1]],"column":[range2["column"][1]+1,c2]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]},{"row":[r1+offset_r,range2["row"][1]+offset_r],"column":[range2["column"][0]+offset_c,range2["column"][1]+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,range2["row"][1]],"column":[c1,range2["column"][0]-1]},{"row":[r1,range2["row"][1]],"column":[range2["column"][1]+1,c2]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[r1+offset_r,range2["row"][1]+offset_r],"column":[range2["column"][0]+offset_c,range2["column"][1]+offset_c]}];}}else if(c1<range2["column"][0]&&c2>range2["column"][1]&&r2>=range2["row"][0]&&r2<=range2["row"][1]){//选区 包含 条件格式应用范围 下中间部分
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][0],r2],"column":[c1,range2["column"][0]-1]},{"row":[range2["row"][0],r2],"column":[range2["column"][1]+1,c2]},{"row":[range2["row"][0]+offset_r,r2+offset_r],"column":[range2["column"][0]+offset_c,range2["column"][1]+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][0],r2],"column":[c1,range2["column"][0]-1]},{"row":[range2["row"][0],r2],"column":[range2["column"][1]+1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[range2["row"][0]+offset_r,r2+offset_r],"column":[range2["column"][0]+offset_c,range2["column"][1]+offset_c]}];}}else if(r1<range2["row"][0]&&r2>range2["row"][1]&&c1<range2["column"][0]&&c2>range2["column"][1]){//选区 包含 条件格式应用范围 正中间部分
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][0],range2["row"][1]],"column":[c1,range2["column"][0]-1]},{"row":[range2["row"][0],range2["row"][1]],"column":[range2["column"][1]+1,c2]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]},{"row":[range2["row"][0]+offset_r,range2["row"][1]+offset_r],"column":[range2["column"][0]+offset_c,range2["column"][1]+offset_c]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,range2["row"][0]-1],"column":[c1,c2]},{"row":[range2["row"][0],range2["row"][1]],"column":[c1,range2["column"][0]-1]},{"row":[range2["row"][0],range2["row"][1]],"column":[range2["column"][1]+1,c2]},{"row":[range2["row"][1]+1,r2],"column":[c1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[{"row":[range2["row"][0]+offset_r,range2["row"][1]+offset_r],"column":[range2["column"][0]+offset_c,range2["column"][1]+offset_c]}];}}else {//选区 在 条件格式应用范围 之外
  if(type=="allPart"){//所有部分
  range=[{"row":[r1,r2],"column":[c1,c2]}];}else if(type=="restPart"){//剩余部分
  range=[{"row":[r1,r2],"column":[c1,c2]}];}else if(type=="operatePart"){//操作部分
  range=[];}}return range;},getcolorGradation:function getcolorGradation(color1,color2,value1,value2,value){var rgb1=color1.split(',');var r1=parseInt(rgb1[0].split('(')[1]);var g1=parseInt(rgb1[1]);var b1=parseInt(rgb1[2].split(')')[0]);var rgb2=color2.split(',');var r2=parseInt(rgb2[0].split('(')[1]);var g2=parseInt(rgb2[1]);var b2=parseInt(rgb2[2].split(')')[0]);var r=Math.round(r1-(r1-r2)/(value1-value2)*(value1-value));var g=Math.round(g1-(g1-g2)/(value1-value2)*(value1-value));var b=Math.round(b1-(b1-b2)/(value1-value2)*(value1-value));return "rgb("+r+", "+g+", "+b+")";},getCFPartRange:function getCFPartRange(sheetIndex,range1,range2){var ruleArr=[];var cf=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(sheetIndex)].luckysheet_conditionformat_save;if(cf!=null&&cf.length>0){label:for(var i=0;i<cf.length;i++){var cellrange=cf[i].cellrange;for(var j=0;j<cellrange.length;j++){var r1=cellrange[j].row[0],r2=cellrange[j].row[1];var c1=cellrange[j].column[0],c2=cellrange[j].column[1];for(var s=0;s<range.length;s++){if(range[s].row[0]>=r1&&range[s].row[0]<=r2||range[s].row[1]>=r1&&range[s].row[1]<=r2||range[s].column[0]>=c1&&range[s].column[0]<=c2||range[s].column[1]>=c1&&range[s].column[1]<=c2){ruleArr.push(cf[i]);continue label;}}}}}return ruleArr;},checksCF:function checksCF(r,c,computeMap){if(computeMap!=null&&r+"_"+c in computeMap){return computeMap[r+"_"+c];}else {return null;}},getComputeMap:function getComputeMap(){var index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);var ruleArr=luckysheetfile[index]["luckysheet_conditionformat_save"];var data=luckysheetfile[index]["data"];if(data==null){return null;}var computeMap=luckysheet.conditionformat.compute(ruleArr,data);return computeMap;},compute:function compute(ruleArr,d){if(ruleArr==null){ruleArr=[];}//条件计算存储
  var computeMap={};if(ruleArr.length>0){for(var i=0;i<ruleArr.length;i++){var type=ruleArr[i]["type"];var cellrange=ruleArr[i]["cellrange"];var format=ruleArr[i]["format"];if(type=="dataBar"){//数据条
  var max=null,min=null;for(var s=0;s<cellrange.length;s++){for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}var cell=d[r][c];if(luckysheet.getObjType(cell)=="object"&&cell["ct"]!=null&&cell["ct"].t=="n"&&cell.v!=null){if(max==null||parseInt(cell.v)>max){max=parseInt(cell.v);}if(min==null||parseInt(cell.v)<min){min=parseInt(cell.v);}}}}}if(max!=null&&min!=null){if(min<0){//选区范围内有负数
  var plusLen=Math.round(max/(max-min)*10)/10;//正数所占比
  var minusLen=Math.round(Math.abs(min)/(max-min)*10)/10;//负数所占比
  for(var s=0;s<cellrange.length;s++){for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}var cell=d[r][c];if(luckysheet.getObjType(cell)=="object"&&cell["ct"]!=null&&cell["ct"].t=="n"&&cell.v!=null){if(parseInt(cell.v)<0){//负数
  var valueLen=Math.round(Math.abs(parseInt(cell.v))/Math.abs(min)*100)/100;if(r+"_"+c in computeMap){computeMap[r+"_"+c]["dataBar"]={"valueType":"minus","minusLen":minusLen,"valueLen":valueLen,"format":format};}else {computeMap[r+"_"+c]={"dataBar":{"valueType":"minus","minusLen":minusLen,"valueLen":valueLen,"format":format}};}}if(parseInt(cell.v)>0){//正数
  var valueLen=Math.round(parseInt(cell.v)/max*100)/100;if(r+"_"+c in computeMap){computeMap[r+"_"+c]["dataBar"]={"valueType":"plus","plusLen":plusLen,"minusLen":minusLen,"valueLen":valueLen,"format":format};}else {computeMap[r+"_"+c]={"dataBar":{"valueType":"plus","plusLen":plusLen,"minusLen":minusLen,"valueLen":valueLen,"format":format}};}}}}}}}else {var plusLen=1;for(var s=0;s<cellrange.length;s++){for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}var cell=d[r][c];if(luckysheet.getObjType(cell)=="object"&&cell["ct"]!=null&&cell["ct"].t=="n"&&cell.v!=null){if(max==0){var valueLen=1;}else {var valueLen=Math.round(parseInt(cell.v)/max*100)/100;}if(r+"_"+c in computeMap){computeMap[r+"_"+c]["dataBar"]={"valueType":"plus","plusLen":plusLen,"valueLen":valueLen,"format":format};}else {computeMap[r+"_"+c]={"dataBar":{"valueType":"plus","plusLen":plusLen,"valueLen":valueLen,"format":format}};}}}}}}}}else if(type=="colorGradation"){//色阶
  var max=null,min=null,sum=0,count=0;for(var s=0;s<cellrange.length;s++){for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}var cell=d[r][c];if(luckysheet.getObjType(cell)=="object"&&cell["ct"]!=null&&cell["ct"].t=="n"&&cell.v!=null){count++;sum+=parseInt(cell.v);if(max==null||parseInt(cell.v)>max){max=parseInt(cell.v);}if(min==null||parseInt(cell.v)<min){min=parseInt(cell.v);}}}}}if(max!=null&&min!=null){if(format.length==3){//三色色阶
  var avg=Math.floor(sum/count);for(var s=0;s<cellrange.length;s++){for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}var cell=d[r][c];if(luckysheet.getObjType(cell)=="object"&&cell["ct"]!=null&&cell["ct"].t=="n"&&cell.v!=null){if(parseInt(cell.v)==min){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["cellColor"]=format[2];}else {computeMap[r+"_"+c]={"cellColor":format[2]};}}else if(parseInt(cell.v)>min&&parseInt(cell.v)<avg){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["cellColor"]=luckysheet.conditionformat.getcolorGradation(format[2],format[1],min,avg,parseInt(cell.v));}else {computeMap[r+"_"+c]={"cellColor":luckysheet.conditionformat.getcolorGradation(format[2],format[1],min,avg,parseInt(cell.v))};}}else if(parseInt(cell.v)==avg){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["cellColor"]=format[1];}else {computeMap[r+"_"+c]={"cellColor":format[1]};}}else if(parseInt(cell.v)>avg&&parseInt(cell.v)<max){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["cellColor"]=luckysheet.conditionformat.getcolorGradation(format[1],format[0],avg,max,parseInt(cell.v));}else {computeMap[r+"_"+c]={"cellColor":luckysheet.conditionformat.getcolorGradation(format[1],format[0],avg,max,parseInt(cell.v))};}}else if(parseInt(cell.v)==max){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["cellColor"]=format[0];}else {computeMap[r+"_"+c]={"cellColor":format[0]};}}}}}}}else if(format.length==2){//两色色阶
  for(var s=0;s<cellrange.length;s++){for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}var cell=d[r][c];if(luckysheet.getObjType(cell)=="object"&&cell["ct"]!=null&&cell["ct"].t=="n"&&cell.v!=null){if(parseInt(cell.v)==min){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["cellColor"]=format[1];}else {computeMap[r+"_"+c]={"cellColor":format[1]};}}else if(parseInt(cell.v)>min&&parseInt(cell.v)<max){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["cellColor"]=luckysheet.conditionformat.getcolorGradation(format[1],format[0],min,max,parseInt(cell.v));}else {computeMap[r+"_"+c]={"cellColor":luckysheet.conditionformat.getcolorGradation(format[1],format[0],min,max,parseInt(cell.v))};}}else if(parseInt(cell.v)==max){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["cellColor"]=format[0];}else {computeMap[r+"_"+c]={"cellColor":format[0]};}}}}}}}}}else if(type=="icons"){//图标集
  var len=parseInt(format["len"]);var leftMin=parseInt(format["leftMin"]);var top=parseInt(format["top"]);var max=null,min=null;for(var s=0;s<cellrange.length;s++){for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}var cell=d[r][c];if(luckysheet.getObjType(cell)=="object"&&cell["ct"]!=null&&cell["ct"].t=="n"&&cell.v!=null){if(max==null||parseInt(cell.v)>max){max=parseInt(cell.v);}if(min==null||parseInt(cell.v)<min){min=parseInt(cell.v);}}}}}if(max!=null&&min!=null){var a=Math.floor((max-min+1)/len);var b=(max-min+1)%len;if(len==3){//一组图标有三个
  if(b==2){var v1=[min,min+a];var v2=[min+a+1,min+a*2];var v3=[min+a*2+1,max];}else {var v1=[min,min+a-1];var v2=[min+a,min+a*2-1];var v3=[min+a*2,max];}for(var s=0;s<cellrange.length;s++){for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}var cell=d[r][c];if(luckysheet.getObjType(cell)=="object"&&cell["ct"]!=null&&cell["ct"].t=="n"&&cell.v!=null){if(parseInt(cell.v)>=v1[0]&&parseInt(cell.v)<=v1[1]){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["icons"]={"left":leftMin+2,"top":top};}else {computeMap[r+"_"+c]={"icons":{"left":leftMin+2,"top":top}};}}else if(parseInt(cell.v)>=v2[0]&&parseInt(cell.v)<=v2[1]){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["icons"]={"left":leftMin+1,"top":top};}else {computeMap[r+"_"+c]={"icons":{"left":leftMin+1,"top":top}};}}else if(parseInt(cell.v)>=v3[0]&&parseInt(cell.v)<=v3[1]){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["icons"]={"left":leftMin,"top":top};}else {computeMap[r+"_"+c]={"icons":{"left":leftMin,"top":top}};}}}}}}}else if(len==4){//一组图标有四个
  if(b==2){var v1=[min,min+a];var v2=[min+a+1,min+a*2];var v3=[min+a*2+1,min+a*3];var v4=[min+a*3+1,max];}else if(b==3){var v1=[min,min+a];var v2=[min+a+1,min+a*2];var v3=[min+a*2+1,min+a*3+1];var v4=[min+a*3+2,max];}else {var v1=[min,min+a-1];var v2=[min+a,min+a*2-1];var v3=[min+a*2,min+a*3-1];var v4=[min+a*3,max];}for(var s=0;s<cellrange.length;s++){for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}var cell=d[r][c];if(luckysheet.getObjType(cell)=="object"&&cell["ct"]!=null&&cell["ct"].t=="n"&&cell.v!=null){if(parseInt(cell.v)>=v1[0]&&parseInt(cell.v)<=v1[1]){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["icons"]={"left":leftMin+3,"top":top};}else {computeMap[r+"_"+c]={"icons":{"left":leftMin+3,"top":top}};}}else if(parseInt(cell.v)>=v2[0]&&parseInt(cell.v)<=v2[1]){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["icons"]={"left":leftMin+2,"top":top};}else {computeMap[r+"_"+c]={"icons":{"left":leftMin+2,"top":top}};}}else if(parseInt(cell.v)>=v3[0]&&parseInt(cell.v)<=v3[1]){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["icons"]={"left":leftMin+1,"top":top};}else {computeMap[r+"_"+c]={"icons":{"left":leftMin+1,"top":top}};}}else if(parseInt(cell.v)>=v4[0]&&parseInt(cell.v)<=v4[1]){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["icons"]={"left":leftMin,"top":top};}else {computeMap[r+"_"+c]={"icons":{"left":leftMin,"top":top}};}}}}}}}else if(len==5){//一组图标有五个
  if(b==2){var v1=[min,min+a];var v2=[min+a+1,min+a*2];var v3=[min+a*2+1,min+a*3];var v4=[min+a*3+1,min+a*4];var v5=[min+a*4+1,max];}else if(b==3){var v1=[min,min+a];var v2=[min+a+1,min+a*2];var v3=[min+a*2+1,min+a*3+1];var v4=[min+a*3+2,min+a*4+1];var v5=[min+a*4+2,max];}else if(b==4){var v1=[min,min+a];var v2=[min+a+1,min+a*2+1];var v3=[min+a*2+2,min+a*3+1];var v4=[min+a*3+2,min+a*4+2];var v5=[min+a*4+3,max];}else {var v1=[min,min+a-1];var v2=[min+a,min+a*2-1];var v3=[min+a*2,min+a*3-1];var v4=[min+a*3,min+a*4-1];var v5=[min+a*4,max];}for(var s=0;s<cellrange.length;s++){for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}var cell=d[r][c];if(luckysheet.getObjType(cell)=="object"&&cell["ct"]!=null&&cell["ct"].t=="n"&&cell.v!=null){if(parseInt(cell.v)>=v1[0]&&parseInt(cell.v)<=v1[1]){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["icons"]={"left":leftMin+4,"top":top};}else {computeMap[r+"_"+c]={"icons":{"left":leftMin+4,"top":top}};}}else if(parseInt(cell.v)>=v2[0]&&parseInt(cell.v)<=v2[1]){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["icons"]={"left":leftMin+3,"top":top};}else {computeMap[r+"_"+c]={"icons":{"left":leftMin+3,"top":top}};}}else if(parseInt(cell.v)>=v3[0]&&parseInt(cell.v)<=v3[1]){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["icons"]={"left":leftMin+2,"top":top};}else {computeMap[r+"_"+c]={"icons":{"left":leftMin+2,"top":top}};}}else if(parseInt(cell.v)>=v4[0]&&parseInt(cell.v)<=v4[1]){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["icons"]={"left":leftMin+1,"top":top};}else {computeMap[r+"_"+c]={"icons":{"left":leftMin+1,"top":top}};}}else if(parseInt(cell.v)>=v5[0]&&parseInt(cell.v)<=v5[1]){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["icons"]={"left":leftMin,"top":top};}else {computeMap[r+"_"+c]={"icons":{"left":leftMin,"top":top}};}}}}}}}}}else {//获取变量值
  var conditionName=ruleArr[i].conditionName,//条件名称
  conditionValue0=ruleArr[i].conditionValue[0],//条件值1
  conditionValue1=ruleArr[i].conditionValue[1],//条件值2
  textColor=format.textColor,//条件格式文本颜色 fc
  cellColor=format.cellColor;//条件格式单元格颜色 bg
  for(var s=0;s<cellrange.length;s++){//条件类型判断    
  if(conditionName=="greaterThan"||conditionName=="lessThan"||conditionName=="equal"||conditionName=="textContains"){//循环应用范围计算
  for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}//单元格值
  var cell=d[r][c];if(luckysheet.getObjType(cell)!="object"||luckysheet.func_methods.isRealNull(cell.v)){continue;}//符合条件
  if(conditionName=="greaterThan"&&cell.v>conditionValue0){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["textColor"]=textColor;computeMap[r+"_"+c]["cellColor"]=cellColor;}else {computeMap[r+"_"+c]={"textColor":textColor,"cellColor":cellColor};}}else if(conditionName=="lessThan"&&cell.v<conditionValue0){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["textColor"]=textColor;computeMap[r+"_"+c]["cellColor"]=cellColor;}else {computeMap[r+"_"+c]={"textColor":textColor,"cellColor":cellColor};}}else if(conditionName=="equal"&&cell.v==conditionValue0){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["textColor"]=textColor;computeMap[r+"_"+c]["cellColor"]=cellColor;}else {computeMap[r+"_"+c]={"textColor":textColor,"cellColor":cellColor};}}else if(conditionName=="textContains"&&cell.v.toString().indexOf(conditionValue0)!=-1){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["textColor"]=textColor;computeMap[r+"_"+c]["cellColor"]=cellColor;}else {computeMap[r+"_"+c]={"textColor":textColor,"cellColor":cellColor};}}}}}else if(conditionName=="betweenness"){//比较条件值1和条件值2的大小
  if(conditionValue0>conditionValue1){var vBig=conditionValue0,vSmall=conditionValue1;}else {var vBig=conditionValue1,vSmall=conditionValue0;}//循环应用范围计算
  for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}//单元格值
  var cell=d[r][c];if(luckysheet.getObjType(cell)!="object"||luckysheet.func_methods.isRealNull(cell.v)){continue;}//符合条件
  if(cell.v>=vSmall&&cell.v<=vBig){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["textColor"]=textColor;computeMap[r+"_"+c]["cellColor"]=cellColor;}else {computeMap[r+"_"+c]={"textColor":textColor,"cellColor":cellColor};}}}}}else if(conditionName=="occurrenceDate"){//获取日期所对应的数值
  if(conditionValue0.toString().indexOf("-")==-1){var dBig=luckysheet.mask.genarate(conditionValue0)[2],dSmall=luckysheet.mask.genarate(conditionValue0)[2];}else {var dBig=luckysheet.mask.genarate(conditionValue0.toString().split("-")[1])[2],dSmall=luckysheet.mask.genarate(conditionValue0.toString().split("-")[0])[2];}//循环应用范围计算
  for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}//单元格值类型为日期类型
  if(d[r][c].ct!=null&&d[r][c].ct.t=="d"){//单元格值
  var cellVal=luckysheet.getcellvalue(r,c,d);//符合条件
  if(cellVal>=dSmall&&cellVal<=dBig){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["textColor"]=textColor;computeMap[r+"_"+c]["cellColor"]=cellColor;}else {computeMap[r+"_"+c]={"textColor":textColor,"cellColor":cellColor};}}}}}}else if(conditionName=="duplicateValue"){//应用范围单元格值处理
  var dmap={};for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){var item=luckysheet.getcellvalue(r,c,d);if(!(item in dmap)){dmap[item]=[];}dmap[item].push({"r":r,"c":c});}}//循环应用范围计算
  if(conditionValue0=="0"){//重复值
  for(x in dmap){if(x!="null"&&x!="undefined"&&dmap[x].length>1){for(var j=0;j<dmap[x].length;j++){if(dmap[x][j].r+"_"+dmap[x][j].c in computeMap){computeMap[dmap[x][j].r+"_"+dmap[x][j].c]["textColor"]=textColor;computeMap[dmap[x][j].r+"_"+dmap[x][j].c]["cellColor"]=cellColor;}else {computeMap[dmap[x][j].r+"_"+dmap[x][j].c]={"textColor":textColor,"cellColor":cellColor};}}}}}if(conditionValue0=="1"){//唯一值
  for(x in dmap){if(x!="null"&&x!="undefined"&&dmap[x].length==1){if(dmap[x][0].r+"_"+dmap[x][0].c in computeMap){computeMap[dmap[x][0].r+"_"+dmap[x][0].c]["textColor"]=textColor;computeMap[dmap[x][0].r+"_"+dmap[x][0].c]["cellColor"]=cellColor;}else {computeMap[dmap[x][0].r+"_"+dmap[x][0].c]={"textColor":textColor,"cellColor":cellColor};}}}}}else if(conditionName=="top10"||conditionName=="top10%"||conditionName=="last10"||conditionName=="last10%"||conditionName=="AboveAverage"||conditionName=="SubAverage"){//应用范围单元格值(数值型)
  var dArr=[];for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}//单元格值类型为数字类型
  if(d[r][c].ct!=null&&d[r][c].ct.t=="n"){dArr.push(luckysheet.getcellvalue(r,c,d));}}}//数组处理
  if(conditionName=="top10"||conditionName=="top10%"||conditionName=="last10"||conditionName=="last10%"){//从大到小排序
  for(var j=0;j<dArr.length;j++){for(var k=0;k<dArr.length-1-j;k++){if(dArr[k]<dArr[k+1]){var temp=dArr[k];dArr[k]=dArr[k+1];dArr[k+1]=temp;}}}//取条件值数组
  if(conditionName=="top10"){var cArr=dArr.slice(0,conditionValue0);//前10项数组
  }else if(conditionName=="top10%"){var cArr=dArr.slice(0,Math.floor(conditionValue0*dArr.length/100));//前10%数组
  }else if(conditionName=="last10"){var cArr=dArr.slice(dArr.length-conditionValue0,dArr.length);//最后10项数组
  }else if(conditionName=="last10%"){var cArr=dArr.slice(dArr.length-Math.floor(conditionValue0*dArr.length/100),dArr.length);//最后10%数组
  }//循环应用范围计算
  for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}//单元格值
  var cellVal=luckysheet.getcellvalue(r,c,d);//符合条件
  if(cArr.indexOf(cellVal)!=-1){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["textColor"]=textColor;computeMap[r+"_"+c]["cellColor"]=cellColor;}else {computeMap[r+"_"+c]={"textColor":textColor,"cellColor":cellColor};}}}}}else if(conditionName=="AboveAverage"||conditionName=="SubAverage"){//计算数组平均值
  var sum=0;for(var j=0;j<dArr.length;j++){sum+=dArr[j];}var averageNum=sum/dArr.length;//循环应用范围计算
  if(conditionName=="AboveAverage"){//高于平均值
  for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}//单元格值
  var cellVal=luckysheet.getcellvalue(r,c,d);//符合条件
  if(cellVal>averageNum){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["textColor"]=textColor;computeMap[r+"_"+c]["cellColor"]=cellColor;}else {computeMap[r+"_"+c]={"textColor":textColor,"cellColor":cellColor};}}}}}else if(conditionName=="SubAverage"){//低于平均值
  for(var r=cellrange[s].row[0];r<=cellrange[s].row[1];r++){for(var c=cellrange[s].column[0];c<=cellrange[s].column[1];c++){if(d[r]==null||d[r][c]==null){continue;}//单元格值
  var cellVal=luckysheet.getcellvalue(r,c,d);//符合条件
  if(cellVal<averageNum){if(r+"_"+c in computeMap){computeMap[r+"_"+c]["textColor"]=textColor;computeMap[r+"_"+c]["cellColor"]=cellColor;}else {computeMap[r+"_"+c]={"textColor":textColor,"cellColor":cellColor};}}}}}}}}}}}return computeMap;},updateItem:function updateItem(type,cellrange,format){var index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);var files=luckysheet.getluckysheetfile();//保存之前的规则
  var fileH=$.extend(true,[],files);var historyRules=luckysheet.conditionformat.getHistoryRules(fileH);//保存当前的规则
  if(type=="delSheet"){var ruleArr=[];}else {var rule={"type":type,"cellrange":cellrange,"format":format};var ruleArr=files[index]["luckysheet_conditionformat_save"]==null?[]:files[index]["luckysheet_conditionformat_save"];ruleArr.push(rule);}files[index]["luckysheet_conditionformat_save"]=ruleArr;var fileC=$.extend(true,[],files);var currentRules=luckysheet.conditionformat.getCurrentRules(fileC);//刷新一次表格
  luckysheet.conditionformat.ref(historyRules,currentRules);//发送给后台
  if(luckysheet.server.allowUpdate){luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,ruleArr,{"k":"luckysheet_conditionformat_save"});}},getHistoryRules:function getHistoryRules(fileH){var historyRules=[];for(var h=0;h<fileH.length;h++){historyRules.push({"sheetIndex":fileH[h]["index"],"luckysheet_conditionformat_save":fileH[h]["luckysheet_conditionformat_save"]});}return historyRules;},getCurrentRules:function getCurrentRules(fileC){var currentRules=[];for(var c=0;c<fileC.length;c++){currentRules.push({"sheetIndex":fileC[c]["index"],"luckysheet_conditionformat_save":fileC[c]["luckysheet_conditionformat_save"]});}return currentRules;},ref:function ref(historyRules,currentRules){if(clearjfundo){luckysheet.jfundo=[];var redo={};redo["type"]="updateCF";redo["data"]={"historyRules":historyRules,"currentRules":currentRules};luckysheet.jfredo.push(redo);}setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);//编辑器qksheet表格编辑时
  if(luckysheetConfigsetting.pointEdit){luckysheet.pointEdit_updateData();}}};//交替颜色
  luckysheet.alternateformat={rangefocus:false,modelfocusIndex:null,FixedModelColor:[{"head":{"fc":"#000","bc":"#bfbdbe"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#f8f3f7"},"foot":{"fc":"#000","bc":"#dde2de"}},{"head":{"fc":"#000","bc":"#4bd4e7"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#eaf7ff"},"foot":{"fc":"#000","bc":"#aae9f8"}},{"head":{"fc":"#000","bc":"#5ed593"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#e5fbee"},"foot":{"fc":"#000","bc":"#a5efcc"}},{"head":{"fc":"#000","bc":"#f6cb4b"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#fff9e7"},"foot":{"fc":"#000","bc":"#ffebac"}},{"head":{"fc":"#000","bc":"#f96420"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#ffe5d9"},"foot":{"fc":"#000","bc":"#ffcfba"}},{"head":{"fc":"#000","bc":"#5599fc"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#ecf2fe"},"foot":{"fc":"#000","bc":"#afcbfa"}},{"head":{"fc":"#000","bc":"#22a69b"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#dff2f8"},"foot":{"fc":"#000","bc":"#8dd4d0"}},{"head":{"fc":"#000","bc":"#7a939a"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#f0eff7"},"foot":{"fc":"#000","bc":"#bdcad0"}},{"head":{"fc":"#000","bc":"#d7a270"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#fdf3f1"},"foot":{"fc":"#000","bc":"#ead2b6"}},{"head":{"fc":"#000","bc":"#89c54b"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#f1f7e9"},"foot":{"fc":"#000","bc":"#c5e3a7"}},{"head":{"fc":"#000","bc":"#8f88f0"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#f0e5ff"},"foot":{"fc":"#000","bc":"#c6c4f6"}},{"head":{"fc":"#000","bc":"#fd1664"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#feddee"},"foot":{"fc":"#000","bc":"#f98ab5"}},{"head":{"fc":"#000","bc":"#da96d3"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#fce8fb"},"foot":{"fc":"#000","bc":"#f2caee"}},{"head":{"fc":"#000","bc":"#b49191"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#f5ebe8"},"foot":{"fc":"#000","bc":"#d8c3c3"}},{"head":{"fc":"#000","bc":"#91b493"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#f0fbf0"},"foot":{"fc":"#000","bc":"#b4cfb6"}},{"head":{"fc":"#000","bc":"#b4a891"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#f8f6f1"},"foot":{"fc":"#000","bc":"#d3cab8"}},{"head":{"fc":"#000","bc":"#91abb4"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#eff7fa"},"foot":{"fc":"#000","bc":"#b7cbd3"}},{"head":{"fc":"#000","bc":"#b7ba82"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#fafbeb"},"foot":{"fc":"#000","bc":"#dadcb4"}},{"head":{"fc":"#000","bc":"#df3e3e"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#fde9e9"},"foot":{"fc":"#000","bc":"#f89292"}},{"head":{"fc":"#000","bc":"#f2711c"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#fef0d7"},"foot":{"fc":"#000","bc":"#fbb335"}},{"head":{"fc":"#000","bc":"#b5cc18"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#f9fbd4"},"foot":{"fc":"#000","bc":"#e2ed2a"}},{"head":{"fc":"#000","bc":"#00b5ad"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#ccfaf9"},"foot":{"fc":"#000","bc":"#00e4df"}},{"head":{"fc":"#000","bc":"#2185d0"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#d8f3fc"},"foot":{"fc":"#000","bc":"#3cc4f0"}},{"head":{"fc":"#000","bc":"#a5673f"},"one":{"fc":"#000","bc":"#ffffff"},"two":{"fc":"#000","bc":"#f6ede5"},"foot":{"fc":"#000","bc":"#d3a47c"}}],getModelBox:function getModelBox(hasRowHeader,hasRowFooter){$("#luckysheet-modal-dialog-slider-alternateformat #luckysheet-alternateformat-modelList").empty();$("#luckysheet-modal-dialog-slider-alternateformat #luckysheet-alternateformat-modelCustom").empty();//格式样式 模板
  var modelListHtml='';for(var i=0;i<luckysheet.alternateformat.FixedModelColor.length;i++){var obj=luckysheet.alternateformat.FixedModelColor[i];var color1,color2,color3,color4;if(hasRowHeader&&hasRowFooter){color1=obj["head"];color2=obj["one"];color3=obj["two"];color4=obj["foot"];}else if(hasRowHeader){color1=obj["head"];color2=obj["one"];color3=obj["two"];color4=obj["one"];}else if(hasRowFooter){color1=obj["one"];color2=obj["two"];color3=obj["one"];color4=obj["foot"];}else {color1=obj["one"];color2=obj["two"];color3=obj["one"];color4=obj["two"];}modelListHtml+='<div class="modelbox">'+'<div class="box">'+'<span style="color:'+color1["fc"]+';background-color:'+color1["bc"]+'"> — </span>'+'<span style="color:'+color2["fc"]+';background-color:'+color2["bc"]+'"> — </span>'+'<span style="color:'+color3["fc"]+';background-color:'+color3["bc"]+'"> — </span>'+'<span style="color:'+color4["fc"]+';background-color:'+color4["bc"]+'"> — </span>'+'</div>'+'</div>';}$("#luckysheet-modal-dialog-slider-alternateformat #luckysheet-alternateformat-modelList").append(modelListHtml);//自定义 模板
  var modelCustom=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_alternateformat_save_modelCustom"];if(modelCustom!=null&&modelCustom.length>0){var modelCustomHtml='';for(var i=0;i<modelCustom.length;i++){var obj=modelCustom[i];var color1,color2,color3,color4;if(hasRowHeader&&hasRowFooter){color1=obj["head"];color2=obj["one"];color3=obj["two"];color4=obj["foot"];}else if(hasRowHeader){color1=obj["head"];color2=obj["one"];color3=obj["two"];color4=obj["one"];}else if(hasRowFooter){color1=obj["one"];color2=obj["two"];color3=obj["one"];color4=obj["foot"];}else {color1=obj["one"];color2=obj["two"];color3=obj["one"];color4=obj["two"];}modelCustomHtml+='<div class="modelbox">'+'<div class="box">'+'<span style="color:'+color1["fc"]+';background-color:'+color1["bc"]+'"> — </span>'+'<span style="color:'+color2["fc"]+';background-color:'+color2["bc"]+'"> — </span>'+'<span style="color:'+color3["fc"]+';background-color:'+color3["bc"]+'"> — </span>'+'<span style="color:'+color4["fc"]+';background-color:'+color4["bc"]+'"> — </span>'+'</div>'+'</div>';}$("#luckysheet-modal-dialog-slider-alternateformat #luckysheet-alternateformat-modelCustom").append(modelCustomHtml);}},init:function init(){$("#luckysheet-modal-dialog-slider-alternateformat").remove();$("body").append(luckysheetAlternateformatHtml);luckysheet.luckysheetsizeauto();//关闭
  $("#luckysheet-modal-dialog-slider-alternateformat .luckysheet-model-close-btn").click(function(){$("#luckysheet-modal-dialog-slider-alternateformat").hide();luckysheet.luckysheetsizeauto();});//应用范围
  $(document).off("focus.AFrangeInput").on("focus.AFrangeInput","#luckysheet-alternateformat-range input",function(){luckysheet.alternateformat.rangefocus=true;});$(document).off("blur.AFrangeInput").on("blur.AFrangeInput","#luckysheet-alternateformat-range input",function(){luckysheet.alternateformat.rangefocus=false;});$(document).off("keydown.AFrangeInput").on("keydown.AFrangeInput","#luckysheet-alternateformat-range input",function(e){var rangeValue=$(this).val().trim();if(e.keyCode==13){luckysheet.alternateformat.update();}});$(document).off("click.AFrangeIcon").on("click.AFrangeIcon","#luckysheet-alternateformat-range .fa-table",function(){$("#luckysheet-modal-dialog-slider-alternateformat").hide();luckysheet.luckysheetsizeauto();var rangeValue=$(this).parents("#luckysheet-alternateformat-range").find("input").val().trim();luckysheet.alternateformat.rangeDialog(rangeValue);});$(document).off("click.AFrDCf").on("click.AFrDCf","#luckysheet-alternateformat-rangeDialog-confirm",function(){var rangeValue=$(this).parents("#luckysheet-alternateformat-rangeDialog").find("input").val().trim();$("#luckysheet-modal-dialog-slider-alternateformat #luckysheet-alternateformat-range input").val(rangeValue);$(this).parents("#luckysheet-alternateformat-rangeDialog").hide();$("#luckysheet-modal-dialog-slider-alternateformat").show();luckysheet.luckysheetsizeauto();luckysheet.alternateformat.update();});$(document).off("click.AFrDCl").on("click.AFrDCl","#luckysheet-alternateformat-rangeDialog-close",function(){$(this).parents("#luckysheet-alternateformat-rangeDialog").hide();$("#luckysheet-modal-dialog-slider-alternateformat").show();luckysheet.luckysheetsizeauto();});$(document).off("click.AFrDTitle").on("click.AFrDTitle","#luckysheet-alternateformat-rangeDialog .luckysheet-modal-dialog-title-close",function(){$(this).parents("#luckysheet-alternateformat-rangeDialog").hide();$("#luckysheet-modal-dialog-slider-alternateformat").show();luckysheet.luckysheetsizeauto();});//页眉、页脚选中
  $(document).off("change.AFrowHeader").on("change.AFrowHeader","#luckysheet-alternateformat-rowHeader",function(){if($(this).is(":checked")){var hasRowHeader=true;}else {var hasRowHeader=false;}if($("#luckysheet-alternateformat-rowFooter").is(":checked")){var hasRowFooter=true;}else {var hasRowFooter=false;}luckysheet.alternateformat.checkboxChange(hasRowHeader,hasRowFooter);luckysheet.alternateformat.modelboxOn();luckysheet.alternateformat.update();});$(document).off("change.AFrowFooter").on("change.AFrowFooter","#luckysheet-alternateformat-rowFooter",function(){if($("#luckysheet-alternateformat-rowHeader").is(":checked")){var hasRowHeader=true;}else {var hasRowHeader=false;}if($(this).is(":checked")){var hasRowFooter=true;}else {var hasRowFooter=false;}luckysheet.alternateformat.checkboxChange(hasRowHeader,hasRowFooter);luckysheet.alternateformat.modelboxOn();luckysheet.alternateformat.update();});//点击样式模板
  $(document).off("click.AFmodelbox").on("click.AFmodelbox","#luckysheet-modal-dialog-slider-alternateformat .modelbox",function(){var index=$(this).index();var $id=$(this).parents(".cf").attr("id");if($id=="luckysheet-alternateformat-modelList"){luckysheet.alternateformat.modelfocusIndex=index;}else if($id=="luckysheet-alternateformat-modelCustom"){var len=luckysheet.alternateformat.FixedModelColor.length;luckysheet.alternateformat.modelfocusIndex=index+len;}luckysheet.alternateformat.modelboxOn();luckysheet.alternateformat.update();});//点击选择文本/单元格颜色
  $(document).off("click.AFselectColor").on("click.AFselectColor","#luckysheet-modal-dialog-slider-alternateformat .luckysheet-color-menu-button-indicator",function(){var $parent=$(this).closest(".toningbox");if($(this).find(".luckysheet-icon-img").hasClass("luckysheet-icon-text-color")){var colorType="fc";var currenColor=$parent.find(".toningShow").data("fc");}else if($(this).find(".luckysheet-icon-img").hasClass("luckysheet-icon-cell-color")){var colorType="bc";var currenColor=$parent.find(".toningShow").data("bc");}//source
  if($parent.hasClass("header")){var source="0";}else if($parent.hasClass("ctOne")){var source="1";}else if($parent.hasClass("ctTwo")){var source="2";}else if($parent.hasClass("footer")){var source="3";}luckysheet.alternateformat.colorSelectDialog(currenColor,colorType,source);});//选择颜色 确定 添加自定义模板
  $(document).off("click.AFselectColorConfirm").on("click.AFselectColorConfirm","#luckysheet-alternateformat-colorSelect-dialog-confirm",function(){var $parent=$(this).parents("#luckysheet-alternateformat-colorSelect-dialog");$("#luckysheet-modal-dialog-mask").hide();$parent.hide();//获取currenColor colorType source
  var currenColor=$parent.find(".currenColor span").attr("title");if($parent.find(".luckysheet-modal-dialog-title-text").text()=="选择文本颜色"){var colorType="fc";}else if($parent.find(".luckysheet-modal-dialog-title-text").text()=="选择单元格颜色"){var colorType="bc";}var source=$parent.find(".currenColor").attr("data-source");//赋给颜色
  if(source=="0"){if(colorType=="fc"){$("#luckysheet-alternateformat-modelToning .header .toningShow").css("color",currenColor);$("#luckysheet-alternateformat-modelToning .header .toningShow").data("fc",currenColor);$("#luckysheet-alternateformat-modelToning .header .luckysheet-icon-text-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",currenColor);}if(colorType=="bc"){$("#luckysheet-alternateformat-modelToning .header .toningShow").css("background-color",currenColor);$("#luckysheet-alternateformat-modelToning .header .toningShow").data("bc",currenColor);$("#luckysheet-alternateformat-modelToning .header .luckysheet-icon-cell-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",currenColor);}}else if(source=="1"){if(colorType=="fc"){$("#luckysheet-alternateformat-modelToning .ctOne .toningShow").css("color",currenColor);$("#luckysheet-alternateformat-modelToning .ctOne .toningShow").data("fc",currenColor);$("#luckysheet-alternateformat-modelToning .ctOne .luckysheet-icon-text-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",currenColor);}if(colorType=="bc"){$("#luckysheet-alternateformat-modelToning .ctOne .toningShow").css("background-color",currenColor);$("#luckysheet-alternateformat-modelToning .ctOne .toningShow").data("bc",currenColor);$("#luckysheet-alternateformat-modelToning .ctOne .luckysheet-icon-cell-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",currenColor);}}else if(source=="2"){if(colorType=="fc"){$("#luckysheet-alternateformat-modelToning .ctTwo .toningShow").css("color",currenColor);$("#luckysheet-alternateformat-modelToning .ctTwo .toningShow").data("fc",currenColor);$("#luckysheet-alternateformat-modelToning .ctTwo .luckysheet-icon-text-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",currenColor);}if(colorType=="bc"){$("#luckysheet-alternateformat-modelToning .ctTwo .toningShow").css("background-color",currenColor);$("#luckysheet-alternateformat-modelToning .ctTwo .toningShow").data("bc",currenColor);$("#luckysheet-alternateformat-modelToning .ctTwo .luckysheet-icon-cell-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",currenColor);}}else if(source=="3"){if(colorType=="fc"){$("#luckysheet-alternateformat-modelToning .footer .toningShow").css("color",currenColor);$("#luckysheet-alternateformat-modelToning .footer .toningShow").data("fc",currenColor);$("#luckysheet-alternateformat-modelToning .footer .luckysheet-icon-text-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",currenColor);}if(colorType=="bc"){$("#luckysheet-alternateformat-modelToning .footer .toningShow").css("background-color",currenColor);$("#luckysheet-alternateformat-modelToning .footer .toningShow").data("bc",currenColor);$("#luckysheet-alternateformat-modelToning .footer .luckysheet-icon-cell-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",currenColor);}}//若模板聚焦在固有模板，则新加模板；若模板聚焦在自定义模板，则修改该模板
  if($("#luckysheet-alternateformat-rowHeader").is(":checked")){var hasRowHeader=true;}else {var hasRowHeader=false;}if($("#luckysheet-alternateformat-rowFooter").is(":checked")){var hasRowFooter=true;}else {var hasRowFooter=false;}var index=luckysheet.alternateformat.modelfocusIndex;var len=luckysheet.alternateformat.FixedModelColor.length;if(index<len){var format=$.extend(true,{},luckysheet.alternateformat.getFormatByIndex());}else {var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];var modelCustom=file["luckysheet_alternateformat_save_modelCustom"];var format=$.extend(true,{},modelCustom[index-len]);}if(source=="0"){if(colorType=="fc"){format["head"]["fc"]=currenColor;}else if(colorType=="bc"){format["head"]["bc"]=currenColor;}}else if(source=="1"){if(colorType=="fc"){format["one"]["fc"]=currenColor;}else if(colorType=="bc"){format["one"]["bc"]=currenColor;}}else if(source=="2"){if(colorType=="fc"){format["two"]["fc"]=currenColor;}else if(colorType=="bc"){format["two"]["bc"]=currenColor;}}else if(source=="3"){if(colorType=="fc"){format["foot"]["fc"]=currenColor;}if(colorType=="bc"){format["foot"]["bc"]=currenColor;}}if(luckysheet.alternateformat.modelfocusIndex<len){luckysheet.alternateformat.addCustomModel(format);luckysheet.alternateformat.modelfocusIndex=luckysheet.alternateformat.getIndexByFormat(format);}else {file["luckysheet_alternateformat_save_modelCustom"][index-len]=format;if(luckysheet.server.allowUpdate){luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,file["luckysheet_alternateformat_save_modelCustom"],{"k":"luckysheet_alternateformat_save_modelCustom"});}}luckysheet.alternateformat.getModelBox(hasRowHeader,hasRowFooter);luckysheet.alternateformat.modelboxOn();luckysheet.alternateformat.update();});//点击 移除交替颜色 按钮
  $(document).off("click.AFremove").on("click.AFremove","#luckysheet-alternateformat-remove",function(){var dataIndex=$(this).data("index");var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];var ruleArr=file["luckysheet_alternateformat_save"];//保存之前的规则
  var historyRules=$.extend(true,[],ruleArr);//保存当前的规则
  if(ruleArr.length>1){ruleArr.splice(dataIndex,1);}else {ruleArr=[];}var currentRules=$.extend(true,[],ruleArr);//刷新一次表格
  luckysheet.alternateformat.ref(historyRules,currentRules);if(luckysheet.server.allowUpdate){luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,ruleArr,{"k":"luckysheet_alternateformat_save"});}//隐藏一些dom
  $("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-modal-dialog-slider-alternateformat").hide();luckysheet.luckysheetsizeauto();});},perfect:function perfect(){var range=$.extend(true,{},luckysheet_select_save[0]);var existsIndex=luckysheet.alternateformat.rangeIsExists(range)[1];var obj=$.extend(true,{},luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_alternateformat_save"][existsIndex]);//应用范围
  var cellrange=obj["cellrange"];$("#luckysheet-alternateformat-range input").val(luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,{"row":cellrange["row"],"column":cellrange["column"]},luckysheet.currentSheetIndex));luckysheet_select_save=[{"row":cellrange["row"],"column":cellrange["column"]}];luckysheet.selectHightlightShow();//页眉、页脚
  var hasRowHeader=obj["hasRowHeader"];var hasRowFooter=obj["hasRowFooter"];//模板聚焦
  var format=obj["format"];luckysheet.alternateformat.modelfocusIndex=luckysheet.alternateformat.getIndexByFormat(format);if(luckysheet.alternateformat.modelfocusIndex==null){luckysheet.alternateformat.addCustomModel(format);luckysheet.alternateformat.modelfocusIndex=luckysheet.alternateformat.getIndexByFormat(format);}luckysheet.alternateformat.checkboxChange(hasRowHeader,hasRowFooter);luckysheet.alternateformat.modelboxOn();//标识 交替颜色的index
  $("#luckysheet-alternateformat-remove").data("index",existsIndex);},checkboxChange:function checkboxChange(hasRowHeader,hasRowFooter){if(hasRowHeader){$("#luckysheet-alternateformat-rowHeader").prop("checked",true);$("#luckysheet-alternateformat-modelToning .header").show();}else {$("#luckysheet-alternateformat-rowHeader").removeAttr("checked");$("#luckysheet-alternateformat-modelToning .header").hide();}if(hasRowFooter){$("#luckysheet-alternateformat-rowFooter").prop("checked",true);$("#luckysheet-alternateformat-modelToning .footer").show();}else {$("#luckysheet-alternateformat-rowFooter").removeAttr("checked");$("#luckysheet-alternateformat-modelToning .footer").hide();}luckysheet.alternateformat.getModelBox(hasRowHeader,hasRowFooter);},modelboxOn:function modelboxOn(){//模板 foucs
  $("#luckysheet-modal-dialog-slider-alternateformat .modelbox").removeClass("on");var index=luckysheet.alternateformat.modelfocusIndex;var len=luckysheet.alternateformat.FixedModelColor.length;if(index<len){$("#luckysheet-alternateformat-modelList .modelbox").eq(index).addClass("on");}else {$("#luckysheet-alternateformat-modelCustom .modelbox").eq(index-len).addClass("on");}//编辑 对应颜色改变
  luckysheet.alternateformat.modelToningColor();},modelToningColor:function modelToningColor(){var format=luckysheet.alternateformat.getFormatByIndex();//页眉
  $("#luckysheet-alternateformat-modelToning .header .toningShow").css({"color":format["head"].fc,"background-color":format["head"].bc});$("#luckysheet-alternateformat-modelToning .header .toningShow").data("fc",format["head"].fc).data("bc",format["head"].bc);$("#luckysheet-alternateformat-modelToning .header .luckysheet-icon-text-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",format["head"].fc);$("#luckysheet-alternateformat-modelToning .header .luckysheet-icon-cell-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",format["head"].bc);//颜色1
  $("#luckysheet-alternateformat-modelToning .ctOne .toningShow").css({"color":format["one"].fc,"background-color":format["one"].bc});$("#luckysheet-alternateformat-modelToning .ctOne .toningShow").data("fc",format["one"].fc).data("bc",format["one"].bc);$("#luckysheet-alternateformat-modelToning .ctOne .luckysheet-icon-text-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",format["one"].fc);$("#luckysheet-alternateformat-modelToning .ctOne .luckysheet-icon-cell-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",format["one"].bc);//颜色2
  $("#luckysheet-alternateformat-modelToning .ctTwo .toningShow").css({"color":format["two"].fc,"background-color":format["two"].bc});$("#luckysheet-alternateformat-modelToning .ctTwo .toningShow").data("fc",format["two"].fc).data("bc",format["two"].bc);$("#luckysheet-alternateformat-modelToning .ctTwo .luckysheet-icon-text-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",format["two"].fc);$("#luckysheet-alternateformat-modelToning .ctTwo .luckysheet-icon-cell-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",format["two"].bc);//页脚
  $("#luckysheet-alternateformat-modelToning .footer .toningShow").css({"color":format["foot"].fc,"background-color":format["foot"].bc});$("#luckysheet-alternateformat-modelToning .footer .toningShow").data("fc",format["foot"].fc).data("bc",format["foot"].bc);$("#luckysheet-alternateformat-modelToning .footer .luckysheet-icon-text-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",format["foot"].fc);$("#luckysheet-alternateformat-modelToning .footer .luckysheet-icon-cell-color").parents(".luckysheet-color-menu-button-indicator").css("border-bottom-color",format["foot"].bc);},addCustomModel:function addCustomModel(format){var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];if(file["luckysheet_alternateformat_save_modelCustom"]==null){file["luckysheet_alternateformat_save_modelCustom"]=[];}file["luckysheet_alternateformat_save_modelCustom"].push(format);if(luckysheet.server.allowUpdate){luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,file["luckysheet_alternateformat_save_modelCustom"],{"k":"luckysheet_alternateformat_save_modelCustom"});}},colorSelectDialog:function colorSelectDialog(currenColor,colorType,source){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-alternateformat-colorSelect-dialog").remove();if(colorType=="fc"){var title="选择文本颜色";}else if(colorType=="bc"){var title="选择单元格颜色";}$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-alternateformat-colorSelect-dialog","addclass":"luckysheet-alternateformat-colorSelect-dialog","title":title,"content":"<div class='currenColor' data-source='"+source+"'>当前颜色：<span title='"+currenColor+"' style='background-color:"+currenColor+"'></span></div><div class='colorshowbox'></div>","botton":'<button id="luckysheet-alternateformat-colorSelect-dialog-confirm" class="btn btn-primary">确定</button><button class="btn btn-default luckysheet-model-close-btn">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-alternateformat-colorSelect-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-alternateformat-colorSelect-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();//初始化选择颜色插件
  $("#luckysheet-alternateformat-colorSelect-dialog").find(".colorshowbox").spectrum({showPalette:true,showPaletteOnly:true,preferredFormat:"hex",clickoutFiresChange:false,showInitial:true,showInput:true,flat:true,hideAfterPaletteSelect:true,showSelectionPalette:true,showButtons:false,//隐藏选择取消按钮
  maxPaletteSize:8,maxSelectionSize:8,color:currenColor,cancelText:"取消",chooseText:"确定颜色",togglePaletteMoreText:"自定义",togglePaletteLessText:"收起",togglePaletteOnly:true,clearText:"清除颜色选择",noColorSelectedText:"没有颜色被选择",localStorageKey:"spectrum.textcolor"+luckysheet.server.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],move:function move(color){if(color!=null){color=color.toHexString();}else {color="#000";}$("#luckysheet-alternateformat-colorSelect-dialog .currenColor span").css("background-color",color).attr("title",color);}});},rangeDialog:function rangeDialog(value){$("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-alternateformat-rangeDialog").remove();$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-alternateformat-rangeDialog","addclass":"luckysheet-alternateformat-rangeDialog","title":"选择应用范围","content":'<input readonly="readonly" placeholder="请选择交替颜色应用范围" value="'+value+'"/>',"botton":'<button id="luckysheet-alternateformat-rangeDialog-confirm" class="btn btn-primary">确定</button><button id="luckysheet-alternateformat-rangeDialog-close" class="btn btn-default">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-alternateformat-rangeDialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-alternateformat-rangeDialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();},rangeIsExists:function rangeIsExists(range,index){var isExists=false;var existsIndex=null;//获取已有交替颜色所有应用范围
  var AFarr=$.extend(true,[],luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_alternateformat_save"]);if(index!=undefined&&index!=null){if(AFarr.length>1){AFarr.splice(index,1);}else {AFarr=[];}}if(AFarr.length>0){var arr=[];for(var i=0;i<AFarr.length;i++){var obj={"index":i,"map":luckysheet.alternateformat.getRangeMap(AFarr[i]["cellrange"]["row"],AFarr[i]["cellrange"]["column"])};arr.push(obj);}//获取当前选区
  var rangeMap=luckysheet.alternateformat.getRangeMap(range["row"],range["column"]);//遍历
  for(x in rangeMap){if(isExists){break;}for(var j=0;j<arr.length;j++){if(x in arr[j]["map"]){isExists=true;existsIndex=arr[j]["index"];break;}}}}return [isExists,existsIndex];},getRangeMap:function getRangeMap(row,column){var map={};var st_r=row[0],ed_r=row[1],st_c=column[0],ed_c=column[1];for(var r=st_r;r<=ed_r;r++){for(var c=st_c;c<=ed_c;c++){map[r+"_"+c]=0;}}return map;},getIndexByFormat:function getIndexByFormat(format){var index=null;//格式样式 模板
  var modelList=luckysheet.alternateformat.FixedModelColor;for(var i=0;i<modelList.length;i++){var obj=modelList[i];if(format["head"].fc==obj["head"].fc&&format["head"].bc==obj["head"].bc){if(format["one"].fc==obj["one"].fc&&format["one"].bc==obj["one"].bc){if(format["two"].fc==obj["two"].fc&&format["two"].bc==obj["two"].bc){if(format["foot"].fc==obj["foot"].fc&&format["foot"].bc==obj["foot"].bc){index=i;break;}}}}}//自定义 模板
  var modelCustom=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_alternateformat_save_modelCustom"];if(modelCustom!=null&&modelCustom.length>0){for(var j=0;j<modelCustom.length;j++){var obj=modelCustom[j];if(format["head"].fc==obj["head"].fc&&format["head"].bc==obj["head"].bc){if(format["one"].fc==obj["one"].fc&&format["one"].bc==obj["one"].bc){if(format["two"].fc==obj["two"].fc&&format["two"].bc==obj["two"].bc){if(format["foot"].fc==obj["foot"].fc&&format["foot"].bc==obj["foot"].bc){index=modelList.length+j;break;}}}}}}return index;},getFormatByIndex:function getFormatByIndex(){var index=luckysheet.alternateformat.modelfocusIndex;var len=luckysheet.alternateformat.FixedModelColor.length;var format={};if(index<len){format=luckysheet.alternateformat.FixedModelColor[index];}else {format=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_alternateformat_save_modelCustom"][index-len];}return format;},"new":function _new(cellrange){var format=luckysheet.alternateformat.getFormatByIndex();var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];var ruleArr=file["luckysheet_alternateformat_save"];if(ruleArr==null){ruleArr=[];}//保存之前的规则
  var historyRules=$.extend(true,[],ruleArr);//保存当前的规则
  var obj={"cellrange":{"row":cellrange["row"],"column":cellrange["column"]},"format":format,"hasRowHeader":true,"hasRowFooter":false};ruleArr.push(obj);var currentRules=$.extend(true,[],ruleArr);//刷新一次表格
  luckysheet.alternateformat.ref(historyRules,currentRules);if(luckysheet.server.allowUpdate){luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,ruleArr,{"k":"luckysheet_alternateformat_save"});}},update:function update(){//获取标识
  var dataIndex=$("#luckysheet-alternateformat-remove").data("index");//应用范围
  var rangeValue=$("#luckysheet-modal-dialog-slider-alternateformat #luckysheet-alternateformat-range input").val().trim();if(luckysheet.formula.iscelldata(rangeValue)){var cellrange=luckysheet.formula.getcellrange(rangeValue);var isExists=luckysheet.alternateformat.rangeIsExists(cellrange,dataIndex)[0];if(isExists){if(luckysheet.isEditMode()){alert("您选择的应用范围已存在交替颜色且不属于你要编辑的应用范围！");}else {luckysheet.tooltip.info("您选择的应用范围已存在交替颜色且不属于你要编辑的应用范围！","");}return;}}else {if(luckysheet.isEditMode()){alert("您选择的应用范围不是选区！");}else {luckysheet.tooltip.info("您选择的应用范围不是选区！","");}return;}//页眉、页脚
  if($("#luckysheet-modal-dialog-slider-alternateformat #luckysheet-alternateformat-rowHeader").is(":checked")){var hasRowHeader=true;}else {var hasRowHeader=false;}if($("#luckysheet-modal-dialog-slider-alternateformat #luckysheet-alternateformat-rowFooter").is(":checked")){var hasRowFooter=true;}else {var hasRowFooter=false;}//获取选中样式模板的颜色
  var format=luckysheet.alternateformat.getFormatByIndex();var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];var ruleArr=file["luckysheet_alternateformat_save"];if(ruleArr==null){ruleArr=[];}//保存之前的规则
  var historyRules=$.extend(true,[],ruleArr);//保存当前的规则
  var obj={"cellrange":{"row":cellrange["row"],"column":cellrange["column"]},"format":format,"hasRowHeader":hasRowHeader,"hasRowFooter":hasRowFooter};ruleArr[dataIndex]=obj;var currentRules=$.extend(true,[],ruleArr);//刷新一次表格
  luckysheet.alternateformat.ref(historyRules,currentRules);if(luckysheet.server.allowUpdate){luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,ruleArr,{"k":"luckysheet_alternateformat_save"});}},checksAF:function checksAF(r,c,computeMap){if(r+"_"+c in computeMap){//返回值（fc  bc）
  return computeMap[r+"_"+c];}else {return null;}},getComputeMap:function getComputeMap(){var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];var ruleArr=file["luckysheet_alternateformat_save"];var computeMap=luckysheet.alternateformat.compute(ruleArr);return computeMap;},compute:function compute(obj){//计算存储
  var computeMap={};if(obj!=null&&obj.length>0){for(var i=0;i<obj.length;i++){var cellrange=obj[i]["cellrange"];var format=obj[i]["format"];var hasRowHeader=obj[i]["hasRowHeader"];var hasRowFooter=obj[i]["hasRowFooter"];var st_r=cellrange["row"][0],ed_r=cellrange["row"][1],st_c=cellrange["column"][0],ed_c=cellrange["column"][1];if(hasRowHeader&&hasRowFooter){//页眉所在行
  for(var c=st_c;c<=ed_c;c++){computeMap[st_r+"_"+c]=[format["head"].fc,format["head"].bc];}//中间行
  if(ed_r-st_r>1){for(var r=st_r+1;r<ed_r;r++){if((r-st_r)%2!=0){var fc=format["one"].fc;var bc=format["one"].bc;}else {var fc=format["two"].fc;var bc=format["two"].bc;}for(var c=st_c;c<=ed_c;c++){computeMap[r+"_"+c]=[fc,bc];}}}//页脚所在行
  if(ed_r>st_r){for(var c=st_c;c<=ed_c;c++){computeMap[ed_r+"_"+c]=[format["foot"].fc,format["foot"].bc];}}}else if(hasRowHeader){//页眉所在行
  for(var c=st_c;c<=ed_c;c++){computeMap[st_r+"_"+c]=[format["head"].fc,format["head"].bc];}//中间行
  if(ed_r>st_r){for(var r=st_r+1;r<=ed_r;r++){if((r-st_r)%2!=0){var fc=format["one"].fc;var bc=format["one"].bc;}else {var fc=format["two"].fc;var bc=format["two"].bc;}for(var c=st_c;c<=ed_c;c++){computeMap[r+"_"+c]=[fc,bc];}}}}else if(hasRowFooter){//中间行
  if(ed_r>st_r){for(var r=st_r;r<ed_r;r++){if((r-st_r)%2==0){var fc=format["one"].fc;var bc=format["one"].bc;}else {var fc=format["two"].fc;var bc=format["two"].bc;}for(var c=st_c;c<=ed_c;c++){computeMap[r+"_"+c]=[fc,bc];}}}//页脚所在行
  for(var c=st_c;c<=ed_c;c++){computeMap[ed_r+"_"+c]=[format["foot"].fc,format["foot"].bc];}}else {//中间行
  for(var r=st_r;r<=ed_r;r++){if((r-st_r)%2==0){var fc=format["one"].fc;var bc=format["one"].bc;}else {var fc=format["two"].fc;var bc=format["two"].bc;}for(var c=st_c;c<=ed_c;c++){computeMap[r+"_"+c]=[fc,bc];}}}}}return computeMap;},ref:function ref(historyRules,currentRules){if(clearjfundo){luckysheet.jfundo=[];var redo={};redo["type"]="updateAF";redo["sheetIndex"]=luckysheet.currentSheetIndex;redo["data"]={"historyRules":historyRules,"currentRules":currentRules};luckysheet.jfredo.push(redo);}var index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);luckysheetfile[index]["luckysheet_alternateformat_save"]=currentRules;setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}};//if公式生成器
  luckysheet.ifFormulaGenerator={singleRangeFocus:false,init:function init(){//点击选择单元格
  $(document).off("focus.IFcompareValue").on("focus.IFcompareValue","#luckysheet-ifFormulaGenerator-dialog #compareValue",function(){$("#luckysheet-modal-dialog-mask").hide();luckysheet.ifFormulaGenerator.singleRangeFocus=true;});$(document).off("click.IFsingRange").on("click.IFsingRange","#luckysheet-ifFormulaGenerator-dialog .singRange",function(){var value=$("#luckysheet-ifFormulaGenerator-dialog #compareValue").val().trim();if(luckysheet.formula.iscelldata(value)){luckysheet.ifFormulaGenerator.singleRangeDialog(value);}else {luckysheet.ifFormulaGenerator.singleRangeDialog();}});$(document).off("click.IFsingRangeConfirm").on("click.IFsingRangeConfirm","#luckysheet-ifFormulaGenerator-singleRange-confirm",function(){$("#luckysheet-formula-functionrange-select").hide();$("#luckysheet-ifFormulaGenerator-singleRange-dialog").hide();$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-ifFormulaGenerator-dialog").show();var value=$(this).parents("#luckysheet-ifFormulaGenerator-singleRange-dialog").find("input").val().trim();$("#luckysheet-ifFormulaGenerator-dialog #compareValue").val(value);luckysheet.ifFormulaGenerator.singleRangeFocus=false;});$(document).off("click.IFsingRangeCancel").on("click.IFsingRangeCancel","#luckysheet-ifFormulaGenerator-singleRange-cancel",function(){$("#luckysheet-formula-functionrange-select").hide();$("#luckysheet-ifFormulaGenerator-singleRange-dialog").hide();$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-ifFormulaGenerator-dialog").show();luckysheet.ifFormulaGenerator.singleRangeFocus=false;});$(document).off("click.IFsingRangeClose").on("click.IFsingRangeClose","#luckysheet-ifFormulaGenerator-singleRange-dialog .luckysheet-modal-dialog-title-close",function(){$("#luckysheet-formula-functionrange-select").hide();$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-ifFormulaGenerator-dialog").show();luckysheet.ifFormulaGenerator.singleRangeFocus=false;});//点击选择范围
  $(document).off("click.IFmultiRange").on("click.IFmultiRange","#luckysheet-ifFormulaGenerator-dialog .multiRange",function(){luckysheet.ifFormulaGenerator.multiRangeDialog();luckysheet.ifFormulaGenerator.singleRangeFocus=false;});$(document).off("click.IFmultiRangeConfirm").on("click.IFmultiRangeConfirm","#luckysheet-ifFormulaGenerator-multiRange-confirm",function(){$("#luckysheet-formula-functionrange-select").hide();$("#luckysheet-row-count-show").hide();$("#luckysheet-column-count-show").hide();$("#luckysheet-ifFormulaGenerator-multiRange-dialog").hide();$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-ifFormulaGenerator-dialog").show();var value=$(this).parents("#luckysheet-ifFormulaGenerator-multiRange-dialog").find("input").val().trim();var cellrange=luckysheet.formula.getcellrange(value);var str_r=cellrange["row"][0],end_r=cellrange["row"][1],str_c=cellrange["column"][0],end_c=cellrange["column"][1];var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  var arr=[];//获取范围内所有数值
  for(var r=str_r;r<=end_r;r++){for(var c=str_c;c<=end_c;c++){if(d[r]!=null&&d[r][c]!=null&&d[r][c]["ct"]!=null&&d[r][c]["ct"]["t"]=="n"){arr.push(d[r][c]["v"]);}}}//从大到小排序
  for(var j=0;j<arr.length;j++){for(var k=0;k<arr.length-1-j;k++){if(arr[k]<arr[k+1]){var temp=arr[k];arr[k]=arr[k+1];arr[k+1]=temp;}}}var largeNum=arr[0];var smallNum=arr[arr.length-1];//赋值
  $("#luckysheet-ifFormulaGenerator-dialog #smallRange").val(smallNum);$("#luckysheet-ifFormulaGenerator-dialog #largeRange").val(largeNum);});$(document).off("click.IFmultiRangeCancel").on("click.IFmultiRangeCancel","#luckysheet-ifFormulaGenerator-multiRange-cancel",function(){$("#luckysheet-formula-functionrange-select").hide();$("#luckysheet-row-count-show").hide();$("#luckysheet-column-count-show").hide();$("#luckysheet-ifFormulaGenerator-multiRange-dialog").hide();$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-ifFormulaGenerator-dialog").show();});$(document).off("click.IFmultiRangeClose").on("click.IFmultiRangeClose","#luckysheet-ifFormulaGenerator-multiRange-dialog .luckysheet-modal-dialog-title-close",function(){$("#luckysheet-formula-functionrange-select").hide();$("#luckysheet-row-count-show").hide();$("#luckysheet-column-count-show").hide();$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-ifFormulaGenerator-dialog").show();});//选择 划分方式
  $(document).on("change","#DivisionMethod",function(){var value=$(this).find("option:selected").val();if(value=="2"){$("#DivisionMethodVal").hide();}else {$("#DivisionMethodVal").show();}$("#luckysheet-ifFormulaGenerator-dialog .ifList").empty();});//点击 生成 按钮
  $(document).off("click.IFcreateBtn").on("click.IFcreateBtn","#luckysheet-ifFormulaGenerator-dialog #createBtn",function(){var compareValue=$(this).parents("#luckysheet-ifFormulaGenerator-dialog").find("#compareValue").val().trim();if(compareValue==""){luckysheet.ifFormulaGenerator.info("比较值不能为空！");return;}var method=$(this).parents("#luckysheet-ifFormulaGenerator-dialog").find("#DivisionMethod option:selected").val();if(method=="2"){var itemHtml='<div class="item">'+'<input type="number" class="smallNum formulaInputFocus"/>'+'<select class="operator">'+'<option value="0"> <= </option>'+'<option value="1"> < </option>'+'</select>'+'<span class="compareValue">'+compareValue+'</span>'+'<select class="operator2">'+'<option value="0"> <= </option>'+'<option value="1" selected="selected"> < </option>'+'</select>'+'<input type="number" class="largeNum formulaInputFocus"/>'+'<span>标签：</span>'+'<input type="text" class="markText formulaInputFocus" value="">'+'<i class="fa fa-remove" aria-hidden="true"></i>'+'</div>';$("#luckysheet-ifFormulaGenerator-dialog .ifList").append(itemHtml);}else {var smallRange=$(this).parents("#luckysheet-ifFormulaGenerator-dialog").find("#smallRange").val().trim();var largeRange=$(this).parents("#luckysheet-ifFormulaGenerator-dialog").find("#largeRange").val().trim();var DivisionMethodVal=$(this).parents("#luckysheet-ifFormulaGenerator-dialog").find("#DivisionMethodVal").val().trim();if(smallRange==""||largeRange==""){luckysheet.ifFormulaGenerator.info("范围不能为空！");return;}else if(DivisionMethodVal==""){luckysheet.ifFormulaGenerator.info("划分值不能为空！");return;}luckysheet.ifFormulaGenerator.getIfList(compareValue,smallRange,largeRange,method,DivisionMethodVal);}});//点击 删除条件
  $(document).on("click","#luckysheet-ifFormulaGenerator-dialog .item .fa-remove",function(){$(this).parents(".item").remove();});//点击 确认 按钮
  $(document).off("click.IFconfirmBtn").on("click.IFconfirmBtn","#luckysheet-ifFormulaGenerator-dialog-confirm",function(){var $item=$(this).parents("#luckysheet-ifFormulaGenerator-dialog").find(".ifList .item");var str='';$($item.toArray().reverse()).each(function(i,e){var smallNum=$(e).find(".smallNum").val().trim();var largeNum=$(e).find(".largeNum").val().trim();var operator=$(e).find(".operator option:selected").val();var operator2=$(e).find(".operator2 option:selected").val();var compareValue=$(e).find(".compareValue").text();var markText=$(e).find(".markText").val().trim();if(markText==""){markText="标签"+(i+1);}if(smallNum==""&&largeNum==""){return true;}if(operator=="0"){var s=compareValue+">="+smallNum;}else {var s=compareValue+">"+smallNum;}if(operator2=="0"){var l=compareValue+"<="+largeNum;}else {var l=compareValue+"<"+largeNum;}if(i==0&&largeNum==""){var a=s;}else if(i==$item.length-1&&smallNum==""){var a=l;}else {var a="and("+s+","+l+")";}if(i==0){str='if('+a+',"'+markText+'")';}else {str='if('+a+',"'+markText+'",'+str+')';}});//
  if(str.length==0){luckysheet.ifFormulaGenerator.info("没有生成可用的条件！");return;}$("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-ifFormulaGenerator-dialog").hide();var last=luckysheet_select_save[luckysheet_select_save.length-1];var row_index=last["row_focus"],col_index=last["column_focus"];var row=visibledatarow[row_index],row_pre=row_index-1==-1?0:visibledatarow[row_index-1];var col=visibledatacolumn[col_index],col_pre=col_index-1==-1?0:visibledatacolumn[col_index-1];luckysheet.luckysheetupdateCell(row,row_pre,row_index,col,col_pre,col_index,luckysheet.flowdata);$("#luckysheet-rich-text-editor").html("="+str);$("#luckysheet-functionbox-cell").html($("#luckysheet-rich-text-editor").html());$("#luckysheet-wa-functionbox-confirm").click();// var fp = $.trim(luckysheet.formula.functionParser(str));
  // var result = eval(fp);
  });//info
  $(document).on("click","#luckysheet-ifFormulaGenerator-info .luckysheet-model-close-btn",function(){$("#luckysheet-modal-dialog-mask").show();});$(document).on("click","#luckysheet-ifFormulaGenerator-info .luckysheet-modal-dialog-title-close",function(){$("#luckysheet-modal-dialog-mask").show();});},ifFormulaDialog:function ifFormulaDialog(fp){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-ifFormulaGenerator-dialog").remove();var compareValue="";var ifListHtml='';if(!!fp){var arr=fp.split("if(");for(var i=1;i<arr.length;i++){var txt=arr[i].replace("and(","").replace(/\)/g,"").replace(/\"/g,"");var arr2=txt.split(",");arr2=luckysheet.ifFormulaGenerator.clearArr(arr2);compareValue=luckysheet.ifFormulaGenerator.splitTxt(arr2[0])[0];if(arr2.length==3){var smallNum=luckysheet.ifFormulaGenerator.splitTxt(arr2[0])[1];var largeNum=luckysheet.ifFormulaGenerator.splitTxt(arr2[1])[2];var markText=arr2[2];}else {var smallNum=luckysheet.ifFormulaGenerator.splitTxt(arr2[0])[1];var largeNum=luckysheet.ifFormulaGenerator.splitTxt(arr2[0])[2];var markText=arr2[1];}var itemHtml='<div class="item">'+'<input type="number" class="smallNum formulaInputFocus" value="'+smallNum+'"/>'+'<select class="operator">'+'<option value="0"> <= </option>'+'<option value="1"> < </option>'+'</select>'+'<span class="compareValue">'+compareValue+'</span>'+'<select class="operator2">'+'<option value="0"> <= </option>'+'<option value="1" selected="selected"> < </option>'+'</select>'+'<input type="number" class="largeNum formulaInputFocus" value="'+largeNum+'"/>'+'<span>标签：</span>'+'<input type="text" class="markText formulaInputFocus" value="'+markText+'">'+'<i class="fa fa-remove" aria-hidden="true"></i>'+'</div>';ifListHtml+=itemHtml;}}var content='<div class="ifAttr">'+'<div class="attrBox">'+'<label for="compareValue"> 比较值 </label>'+'<div class="inpBox">'+'<input id="compareValue" class="formulaInputFocus" value="'+compareValue+'"/>'+'<i class="singRange fa fa-table" aria-hidden="true" title="点击选择单元格"></i>'+'</div>'+'</div>'+'<div class="attrBox">'+'<label for="smallRange"> 范围 </label>'+'<input type="number" id="smallRange" class="formulaInputFocus"/>'+'<span class="text"> 至 </span>'+'<input type="number" id="largeRange" class="formulaInputFocus"/>'+'<div id="rangeAssess">'+'<span> 范围评估 </span>'+'<i class="multiRange fa fa-table" aria-hidden="true" title="点击选择范围"></i>'+'</div>'+'</div>'+'<div class="attrBox">'+'<label for="DivisionMethod"> 划分方式 </label>'+'<select id="DivisionMethod">'+'<option value="0"> 划分值相同 </option>'+'<option value="1"> 划分为N份 </option>'+'<option value="2"> 自定义输入 </option>'+'</select>'+'<input id="DivisionMethodVal" class="formulaInputFocus"/>'+'<div id="createBtn"> 生成 </div>'+'</div>'+'</div>'+'<div class="ifList">'+ifListHtml+'</div>';$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-ifFormulaGenerator-dialog","addclass":"luckysheet-ifFormulaGenerator-dialog","title":"if公式生成器","content":content,"botton":'<button id="luckysheet-ifFormulaGenerator-dialog-confirm" class="btn btn-primary">确认</button><button class="btn btn-default luckysheet-model-close-btn">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-ifFormulaGenerator-dialog").find(".luckysheet-modal-dialog-content").css("min-width",590).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-ifFormulaGenerator-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();},clearArr:function clearArr(arr){for(var i=0;i<arr.length;i++){if(arr[i]==""||arr[i]==null||arr[i]==undefined){arr.splice(i,1);}}return arr;},splitTxt:function splitTxt(txt){var compareValue,smallNum,largeNum;if(txt.indexOf(">=")!=-1){compareValue=txt.split(">=")[0];smallNum=txt.split(">=")[1];return [compareValue,smallNum,largeNum];}else if(txt.indexOf(">")!=-1){compareValue=txt.split(">")[0];smallNum=txt.split(">")[1];return [compareValue,smallNum,largeNum];}else if(txt.indexOf("<=")!=-1){compareValue=txt.split("<=")[0];largeNum=txt.split("<=")[1];return [compareValue,smallNum,largeNum];}else if(txt.indexOf("<")!=-1){compareValue=txt.split("<")[0];largeNum=txt.split("<")[1];return [compareValue,smallNum,largeNum];}},singleRangeDialog:function singleRangeDialog(value){$("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-ifFormulaGenerator-dialog").hide();$("#luckysheet-ifFormulaGenerator-singleRange-dialog").remove();if(value!=undefined&&value!=null){var val=value;}else {var val="";}$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-ifFormulaGenerator-singleRange-dialog","addclass":"luckysheet-ifFormulaGenerator-singleRange-dialog","title":"选择单元格","content":'<input readonly="readonly" placeholder="请选择单元格" value="'+val+'">',"botton":'<button id="luckysheet-ifFormulaGenerator-singleRange-confirm" class="btn btn-primary">确认</button><button id="luckysheet-ifFormulaGenerator-singleRange-cancel" class="btn btn-default">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-ifFormulaGenerator-singleRange-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-ifFormulaGenerator-singleRange-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();},multiRangeDialog:function multiRangeDialog(){$("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-ifFormulaGenerator-dialog").hide();$("#luckysheet-ifFormulaGenerator-multiRange-dialog").remove();$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-ifFormulaGenerator-multiRange-dialog","addclass":"luckysheet-ifFormulaGenerator-multiRange-dialog","title":"选择范围","content":'<input readonly="readonly" placeholder="请选择范围" value="">',"botton":'<button id="luckysheet-ifFormulaGenerator-multiRange-confirm" class="btn btn-primary">确认</button><button id="luckysheet-ifFormulaGenerator-multiRange-cancel" class="btn btn-default">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-ifFormulaGenerator-multiRange-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-ifFormulaGenerator-multiRange-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();},getIfList:function getIfList(compareValue,smallRange,largeRange,method,methodVal){$("#luckysheet-ifFormulaGenerator-dialog .ifList").empty();var smallRange=parseInt(smallRange);var largeRange=parseInt(largeRange);var methodVal=parseInt(methodVal);var arr=[];if(method=="0"){var len=Math.ceil((largeRange-smallRange)/methodVal);for(var i=0;i<=len;i++){var num=smallRange+methodVal*i;if(i==0||num>=largeRange){arr.push("");}else {arr.push(num);}}}else if(method=="1"){var addnum=Math.ceil((largeRange-smallRange)/methodVal);for(var i=0;i<=methodVal;i++){var num=smallRange+addnum*i;if(i==0||num>=largeRange){arr.push("");}else {arr.push(num);}}}for(var j=0;j<arr.length-1;j++){if(j==0){var markText="小于"+arr[j+1];}else if(j==arr.length-2){var markText="大于等于"+arr[j];}else {var markText=arr[j]+"到"+arr[j+1];}var itemHtml='<div class="item">'+'<input type="number" class="smallNum formulaInputFocus" value="'+arr[j]+'"/>'+'<select class="operator">'+'<option value="0"> <= </option>'+'<option value="1"> < </option>'+'</select>'+'<span class="compareValue">'+compareValue+'</span>'+'<select class="operator2">'+'<option value="0"> <= </option>'+'<option value="1" selected="selected"> < </option>'+'</select>'+'<input type="number" class="largeNum formulaInputFocus" value="'+arr[j+1]+'"/>'+'<span>标签：</span>'+'<input type="text" class="markText formulaInputFocus" value="'+markText+'">'+'<i class="fa fa-remove" aria-hidden="true"></i>'+'</div>';$("#luckysheet-ifFormulaGenerator-dialog .ifList").append(itemHtml);}},info:function info(title){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-ifFormulaGenerator-info").remove();$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-ifFormulaGenerator-info","addclass":"","title":title,"content":"","botton":'<button class="btn btn-default luckysheet-model-close-btn">&nbsp;&nbsp;关闭&nbsp;&nbsp;</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-ifFormulaGenerator-info").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-ifFormulaGenerator-info").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();}};//插入函数
  luckysheet.insertFormula={init:function init(){$(document).off("keyup.fxSFLI").on("keyup.fxSFLI","#searchFormulaListInput",function(){$("#formulaTypeList").empty();var txt=$(this).val().toUpperCase();if(txt==""){//若没有查找内容则根据类别筛选
  luckysheet.insertFormula.formulaListByType($("#formulaTypeSelect option:selected").val());}else {for(var i=0;i<luckysheet.functionlist.length;i++){if(/^[a-zA-Z]+$/.test(txt)){if(luckysheet.functionlist[i].n.indexOf(txt)!="-1"){$('<div class="listBox" name="'+luckysheet.functionlist[i].n+'"><span>'+luckysheet.functionlist[i].n+'</span><span>'+luckysheet.functionlist[i].a+'</span></div>').appendTo($("#formulaTypeList"));}}else if(luckysheet.functionlist[i].a.indexOf(txt)!="-1"){$('<div class="listBox" name="'+luckysheet.functionlist[i].n+'"><span>'+luckysheet.functionlist[i].n+'</span><span>'+luckysheet.functionlist[i].a+'</span></div>').appendTo($("#formulaTypeList"));}}}$("#formulaTypeList .listBox:first-child").addClass("on");//默认公式列表第一个为选中状态
  });$(document).off("change.fxFormulaTS").on("change.fxFormulaTS","#formulaTypeSelect",function(){var type=$("#formulaTypeSelect option:selected").val();luckysheet.insertFormula.formulaListByType(type);});$(document).off("click.fxListbox").on("click.fxListbox","#formulaTypeList .listBox",function(){$(this).addClass("on").siblings().removeClass("on");});//选择公式后弹出参数栏弹框
  $(document).off("click.fxFormulaCf").on("click.fxFormulaCf","#luckysheet-search-formula-confirm",function(){var formula=$("#luckysheet-search-formula .listBox.on").attr("name");var formulaTxt='<span dir="auto" class="luckysheet-formula-text-color">=</span><span dir="auto" class="luckysheet-formula-text-color">'+formula.toUpperCase()+'</span><span dir="auto" class="luckysheet-formula-text-color">(</span><span dir="auto" class="luckysheet-formula-text-color">)</span>';$("#luckysheet-rich-text-editor").html(formulaTxt);$("#luckysheet-functionbox-cell").html($("#luckysheet-rich-text-editor").html());luckysheet.insertFormula.formulaParmDialog(formula);});//公式参数框
  $(document).off("focus.fxParamInput").on("focus.fxParamInput","#luckysheet-search-formula-parm .parmBox input",function(){var parmIndex=$(this).parents(".parmBox").index();luckysheet.formula.data_parm_index=parmIndex;var formulatxt=$(this).parents("#luckysheet-search-formula-parm").find(".luckysheet-modal-dialog-title-text").text();var parmLen=window.luckysheet_function[formulatxt].p.length;if(parmIndex>=parmLen){var parmDetail=window.luckysheet_function[formulatxt].p[parmLen-1].detail;var parmRepeat=window.luckysheet_function[formulatxt].p[parmLen-1].repeat;}else {var parmDetail=window.luckysheet_function[formulatxt].p[parmIndex].detail;var parmRepeat=window.luckysheet_function[formulatxt].p[parmIndex].repeat;}//参数选区显示，参数值显示
  luckysheet.insertFormula.parmTxtShow($(this).val());//计算结果
  luckysheet.insertFormula.functionStrCompute();//参数名称和释义切换
  $("#luckysheet-search-formula-parm .parmDetailsBox").empty();var parmName=$(this).parents(".parmBox").find(".name").text();$('<span>'+parmName+':</span><span>'+parmDetail+'</span>').appendTo($("#luckysheet-search-formula-parm .parmDetailsBox"));//公式参数可自增（参数自增最多5个）
  if(parmRepeat=="y"){var parmCount=$("#luckysheet-search-formula-parm .parmBox").length;if(parmCount<5&&parmIndex==parmCount-1){$('<div class="parmBox"><div class="name">值'+(parmCount+1)+'</div><div class="txt"><input class="formulaInputFocus" /><i class="fa fa-table" aria-hidden="true" title="点击选择数据范围"></i></div><div class="val">=</div></div>').appendTo($("#luckysheet-search-formula-parm .parmListBox"));}}});$(document).off("blur.fxParamInput").on("blur.fxParamInput","#luckysheet-search-formula-parm .parmBox input",function(){var txt=$(this).val();if(luckysheet.formula.getfunctionParam(txt).fn==null&&!luckysheet.formula.iscelldata(txt)){if(!luckysheet.func_methods.isRealNum(txt)&&txt!=""&&txt.length<=2&&txt.indexOf('"')!=0&&txt.lastIndexOf('"')!=0){txt='"'+txt+'"';$(this).val(txt);luckysheet.insertFormula.parmTxtShow(txt);luckysheet.insertFormula.functionStrCompute();}}});$(document).off("keyup.fxParamInput").on("keyup.fxParamInput","#luckysheet-search-formula-parm .parmBox input",function(){//参数选区显示，参数值显示
  luckysheet.insertFormula.parmTxtShow($(this).val());//计算结果
  luckysheet.insertFormula.functionStrCompute();});//点击图标选取数据范围
  $(document).off("click.fxParamI").on("click.fxParamI","#luckysheet-search-formula-parm .parmBox i",function(){luckysheet.formula.data_parm_index=$(this).parents(".parmBox").index();//选取范围弹出框
  $("#luckysheet-search-formula-parm").hide();$("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-search-formula-parm-select").remove();if($(this).parents(".parmBox").find(".txt input").val()==""){$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-search-formula-parm-select","addclass":"luckysheet-search-formula-parm-select","title":"选取数据范围","content":"<input id='luckysheet-search-formula-parm-select-input' class='luckysheet-datavisual-range-container' style='font-size: 14px;padding:5px;max-width:none;' spellcheck='false' aria-label='数据范围' readonly='true' placeholder='数据范围'>","botton":'<button id="luckysheet-search-formula-parm-select-confirm" class="btn btn-primary">确认</button>',"style":"z-index:100003"}));}else {$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-search-formula-parm-select","addclass":"luckysheet-search-formula-parm-select","title":"选取数据范围","content":"<input id='luckysheet-search-formula-parm-select-input' class='luckysheet-datavisual-range-container' style='font-size: 14px;padding:5px;max-width:none;' spellcheck='false' aria-label='数据范围' readonly='true' value='"+$(this).parents(".parmBox").find(".txt input").val()+"'>","botton":'<button id="luckysheet-search-formula-parm-select-confirm" class="btn btn-primary">确认</button>',"style":"z-index:100003"}));}var $t=$("#luckysheet-search-formula-parm-select").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-search-formula-parm-select").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();//参数选区虚线框
  luckysheet.insertFormula.parmTxtShow($(this).parents(".parmBox").find(".txt input").val());});//点击确定
  $(document).off("click.fxParamCf").on("click.fxParamCf","#luckysheet-search-formula-parm-confirm",function(){$("#luckysheet-wa-functionbox-confirm").click();});//选取范围后传回参数栏弹框
  $(document).off("click.fxParamSelectCf").on("click.fxParamSelectCf","#luckysheet-search-formula-parm-select-confirm",function(){var parmIndex=$("#luckysheet-search-formula-parm-select-input").attr("data_parm_index");$("#luckysheet-search-formula-parm-select").hide();$("#luckysheet-search-formula-parm").show();$("#luckysheet-search-formula-parm .parmBox").eq(parmIndex).find(".txt input").focus();});},formulaListDialog:function formulaListDialog(){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-search-formula").remove();$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-search-formula","addclass":"luckysheet-search-formula","title":"","content":"<div class='inpbox'><label for='searchFormulaListInput'>查找函数：</label><input class='formulaInputFocus' id='searchFormulaListInput' placeholder='请输入您要查找的函数名称或函数功能的简要描述' spellcheck='false'/></div><div class='selbox'><label>或选择类别：</label><select id='formulaTypeSelect'><option value='0'>数学</option><option value='1'>统计</option><option value='2'>查找</option><option value='3'>Luckysheet内置</option><option value='4'>数据挖掘</option><option value='5'>数据源</option><option value='6'>日期</option><option value='7'>过滤器</option><option value='8'>财务</option><option value='9'>工程计算</option><option value='10'>逻辑</option><option value='11'>运算符</option><option value='12'>文本</option><option value='13'>转换工具</option><option value='14'>数组</option><option value='-1'>其它</option></select></div><div class='listbox'><label>选择函数：</label><div id='formulaTypeList'></div></div>","botton":'<button id="luckysheet-search-formula-confirm" class="btn btn-primary">确认</button><button class="btn btn-default luckysheet-model-close-btn">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-search-formula").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-search-formula").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3,"user-select":"none"}).show();luckysheet.insertFormula.formulaListByType("0");//默认公式列表为类型0
  $("#searchFormulaListInput").focus();},formulaListByType:function formulaListByType(type){$("#formulaTypeList").empty();for(var i=0;i<luckysheet.functionlist.length;i++){if(type=="-1"&&luckysheet.functionlist[i].t>14||luckysheet.functionlist[i].t==type){$('<div class="listBox" name="'+luckysheet.functionlist[i].n+'"><span>'+luckysheet.functionlist[i].n+'</span><span>'+luckysheet.functionlist[i].a+'</span></div>').appendTo($("#formulaTypeList"));}}$("#formulaTypeList .listBox:first-child").addClass("on");//默认公式列表第一个为选中状态
  },formulaParmDialog:function formulaParmDialog(formula,parm){//参数弹出框
  var parm_title='',parm_content='',parm_list_content='';for(var i=0;i<luckysheet.functionlist.length;i++){if(luckysheet.functionlist[i].n==formula.toUpperCase()){parm_title=luckysheet.functionlist[i].n;for(var j=0;j<luckysheet.functionlist[i].p.length;j++){if(parm==null){//无参数
  parm_list_content+='<div class="parmBox">'+'<div class="name">'+luckysheet.functionlist[i].p[j].name+'</div>'+'<div class="txt">'+'<input class="formulaInputFocus" spellcheck="false"/>'+'<i class="fa fa-table" aria-hidden="true" title="点击选择数据范围"></i>'+'</div>'+'<div class="val">=</div>'+'</div>';}else {//有参数
  if(parm[j]==null){parm[j]="";}parm_list_content+='<div class="parmBox">'+'<div class="name">'+luckysheet.functionlist[i].p[j].name+'</div>'+'<div class="txt">'+'<input class="formulaInputFocus" value="'+parm[j]+'" spellcheck="false"/>'+'<i class="fa fa-table" aria-hidden="true" title="点击选择数据范围"></i>'+'</div>'+'<div class="val">=</div>'+'</div>';}}parm_content='<div>'+'<div class="parmListBox">'+parm_list_content+'</div>'+'<div class="formulaDetails">'+luckysheet.functionlist[i].d+'</div>'+'<div class="parmDetailsBox"></div>'+'<div class="result">计算结果 = <span></span></div>'+'</div>';}}$("#luckysheet-search-formula").hide();$("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-search-formula-parm").remove();$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-search-formula-parm","addclass":"luckysheet-search-formula-parm","title":parm_title,"content":parm_content,"botton":'<button id="luckysheet-search-formula-parm-confirm" class="btn btn-primary">确认</button><button class="btn btn-default luckysheet-model-close-btn">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-search-formula-parm").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-search-formula-parm").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();//参数栏第一个参数聚焦，显示选取虚线框
  $("#luckysheet-search-formula-parm .parmBox:eq(0) input").focus();//遍历参数，有参数显示值，无显示空
  $("#luckysheet-search-formula-parm .parmBox").each(function(index,e){var parmtxt=$(e).find(".txt input").val();if(luckysheet.formula.getfunctionParam(parmtxt).fn==null){//参数不是公式
  if(luckysheet.formula.iscelldata(parmtxt)){//参数是选区
  var txtdata=window.luckysheet_getcelldata(parmtxt).data;if(luckysheet.getObjType(txtdata)=="array"){//参数为多个单元格选区
  var txtArr=[];for(var i=0;i<txtdata.length;i++){for(var j=0;j<txtdata[i].length;j++){var cell=txtdata[i][j];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){txtArr.push(null);}else {txtArr.push(cell.v);}}}$("#luckysheet-search-formula-parm .parmBox").eq(index).find(".val").text(" = {"+txtArr.join(",")+"}");}else {//参数为单个单元格选区
  $("#luckysheet-search-formula-parm .parmBox").eq(index).find(".val").text(" = {"+txtdata.v+"}");}}else {//参数不是选区
  $("#luckysheet-search-formula-parm .parmBox").eq(index).find(".val").text(" = {"+parmtxt+"}");}}else {//参数是公式
  $("#luckysheet-search-formula-parm .parmBox").eq(index).find(".val").text(" = {"+eval($.trim(luckysheet.formula.functionParser("="+parmtxt)))+"}");}});$("#luckysheet-formula-functionrange .luckysheet-formula-functionrange-highlight").remove();luckysheet.formula.data_parm_index=0;luckysheet.formula.rangestart=true;},parmTxtShow:function parmTxtShow(parmtxt){if(luckysheet.formula.getfunctionParam(parmtxt).fn==null){//参数不是公式
  if(luckysheet.formula.iscelldata(parmtxt)){//参数是选区
  var cellrange=luckysheet.formula.getcellrange(parmtxt);var r1=cellrange.row[0],r2=cellrange.row[1],c1=cellrange.column[0],c2=cellrange.column[1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];$("#luckysheet-formula-functionrange-select").css({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1}).show();$("#luckysheet-formula-help-c").hide();luckysheet.luckysheet_count_show(col_pre,row_pre,col-col_pre-1,row-row_pre-1,cellrange.row,cellrange.column);var txtdata=window.luckysheet_getcelldata(parmtxt).data;if(luckysheet.getObjType(txtdata)=="array"){//参数为多个单元格选区
  var txtArr=[];for(var i=0;i<txtdata.length;i++){for(var j=0;j<txtdata[i].length;j++){var cell=txtdata[i][j];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){txtArr.push(null);}else {txtArr.push(cell.v);}}}$("#luckysheet-search-formula-parm .parmBox").eq(luckysheet.formula.data_parm_index).find(".val").text(" = {"+txtArr.join(",")+"}");}else {//参数为单个单元格选区
  $("#luckysheet-search-formula-parm .parmBox").eq(luckysheet.formula.data_parm_index).find(".val").text(" = {"+txtdata.v+"}");}}else {//参数不是选区
  $("#luckysheet-search-formula-parm .parmBox").eq(luckysheet.formula.data_parm_index).find(".val").text(" = {"+parmtxt+"}");$("#luckysheet-formula-functionrange-select").hide();}}else {//参数是公式
  var txt;for(var k=0;k<luckysheet.formula.getfunctionParam(parmtxt).param.length;k++){if(luckysheet.formula.iscelldata(luckysheet.formula.getfunctionParam(parmtxt).param[k])){txt=luckysheet.formula.getfunctionParam(parmtxt).param[k];break;}}var cellrange=luckysheet.formula.getcellrange(txt);var r1=cellrange.row[0],r2=cellrange.row[1],c1=cellrange.column[0],c2=cellrange.column[1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];$("#luckysheet-formula-functionrange-select").css({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1}).show();// $("#luckysheet-cols-h-selected").css({ "left": col_pre, "width": col - col_pre - 1, "display": "block", "background-color": "rgba(76, 76, 76, 0.1)" });
  // $("#luckysheet-rows-h-selected").css({ "top": row_pre, "height": row - row_pre - 1, "display": "block", "background-color": "rgba(76, 76, 76, 0.1)" });
  $("#luckysheet-formula-help-c").hide();luckysheet.luckysheet_count_show(col_pre,row_pre,col-col_pre-1,row-row_pre-1,cellrange.row,cellrange.column);$("#luckysheet-search-formula-parm .parmBox").eq(luckysheet.formula.data_parm_index).find(".val").text(" = {"+eval($.trim(luckysheet.formula.functionParser("="+parmtxt)))+"}");}},functionStrCompute:function functionStrCompute(){var isVal=true;//参数不为空
  var parmValArr=[];//参数值集合
  var lvi=-1;//最后一个有值的参数索引
  var formulatxt=$("#luckysheet-search-formula-parm").find(".luckysheet-modal-dialog-title-text").text();$("#luckysheet-search-formula-parm .parmBox").each(function(i,e){var parmtxt=$(e).find(".txt input").val();var parmRequire=window.luckysheet_function[formulatxt].p[i].require;if(parmtxt==""&&parmRequire=="m"){isVal=false;}if(parmtxt!=""){lvi=i;}});//单元格显示
  if(lvi==-1){var functionHtmlTxt="="+$("#luckysheet-search-formula-parm .luckysheet-modal-dialog-title-text").text()+"()";}else if(lvi==0){var functionHtmlTxt="="+$("#luckysheet-search-formula-parm .luckysheet-modal-dialog-title-text").text()+"("+$("#luckysheet-search-formula-parm .parmBox").eq(0).find(".txt input").val()+")";}else {for(var j=0;j<=lvi;j++){parmValArr.push($("#luckysheet-search-formula-parm .parmBox").eq(j).find(".txt input").val());}var functionHtmlTxt="="+$("#luckysheet-search-formula-parm .luckysheet-modal-dialog-title-text").text()+"("+parmValArr.join(",")+")";}var function_str=luckysheet.formula.functionHTMLGenerate(functionHtmlTxt);$("#luckysheet-rich-text-editor").html(function_str);$("#luckysheet-functionbox-cell").html($("#luckysheet-rich-text-editor").html());if(isVal){//公式计算
  var fp=$.trim(luckysheet.formula.functionParser($("#luckysheet-rich-text-editor").text()));var result=null;try{result=eval(fp);}catch(e){result=luckysheet.formula.error.n;}$("#luckysheet-search-formula-parm .result span").text(result);}}};//选区下拉
  luckysheet.dropCell={iconHtml:'<div id="luckysheet-dropCell-icon" style="position: absolute;padding: 2px;background-color: #f1f1f1;z-index: 990;cursor: pointer;">'+'<div id="icon_dropCell"></div>'+'</div>',typeListHtml:'<div id="luckysheet-dropCell-typeList" class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-mousedown-cancel">'+'<div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-type="0">'+'<div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="padding: 3px 2px;">'+'<span style="margin-right:5px;width:13px;display:inline-block;" class="icon luckysheet-mousedown-cancel"></span>复制单元格'+'</div>'+'</div>'+'<div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-type="1">'+'<div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="padding: 3px 2px;">'+'<span style="margin-right:5px;width:13px;display:inline-block;" class="icon luckysheet-mousedown-cancel"></span>填充序列'+'</div>'+'</div>'+'<div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-type="2">'+'<div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="padding: 3px 2px;">'+'<span style="margin-right:5px;width:13px;display:inline-block;" class="icon luckysheet-mousedown-cancel"></span>仅填充格式'+'</div>'+'</div>'+'<div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-type="3">'+'<div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="padding: 3px 2px;">'+'<span style="margin-right:5px;width:13px;display:inline-block;" class="icon luckysheet-mousedown-cancel"></span>不带格式填充'+'</div>'+'</div>'+'<div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-type="4">'+'<div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="padding: 3px 2px;">'+'<span style="margin-right:5px;width:13px;display:inline-block;" class="icon luckysheet-mousedown-cancel"></span>以天数填充'+'</div>'+'</div>'+'<div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-type="5">'+'<div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="padding: 3px 2px;">'+'<span style="margin-right:5px;width:13px;display:inline-block;" class="icon luckysheet-mousedown-cancel"></span>以工作日填充'+'</div>'+'</div>'+'<div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-type="6">'+'<div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="padding: 3px 2px;">'+'<span style="margin-right:5px;width:13px;display:inline-block;" class="icon luckysheet-mousedown-cancel"></span>以月填充'+'</div>'+'</div>'+'<div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-type="7">'+'<div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="padding: 3px 2px;">'+'<span style="margin-right:5px;width:13px;display:inline-block;" class="icon luckysheet-mousedown-cancel"></span>以年填充'+'</div>'+'</div>'+'<div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" data-type="8">'+'<div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="padding: 3px 2px;">'+'<span style="margin-right:5px;width:13px;display:inline-block;" class="icon luckysheet-mousedown-cancel"></span>以中文小写数字填充'+'</div>'+'</div>'+'</div>',copyRange:{},//复制范围
  applyRange:{},//应用范围
  applyType:null,//0复制单元格，1填充序列，2仅填充格式，3不带格式填充，4以天数填充，5以工作日填充，6以月填充，7以年填充，8以中文小写数字序列填充
  direction:null,//down-往下拖拽，right-往右拖拽，up-往上拖拽，left-往左拖拽
  chnNumChar:{"零":0,"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9},chnNameValue:{"十":{value:10,secUnit:false},"百":{value:100,secUnit:false},"千":{value:1000,secUnit:false},"万":{value:10000,secUnit:true},"亿":{value:100000000,secUnit:true}},ChineseToNumber:function ChineseToNumber(chnStr){var rtn=0;var section=0;var number=0;var secUnit=false;var str=chnStr.split("");for(var i=0;i<str.length;i++){var num=luckysheet.dropCell.chnNumChar[str[i]];if(typeof num!="undefined"){number=num;if(i==str.length-1){section+=number;}}else {var unit=luckysheet.dropCell.chnNameValue[str[i]].value;secUnit=luckysheet.dropCell.chnNameValue[str[i]].secUnit;if(secUnit){section=(section+number)*unit;rtn+=section;section=0;}else {section+=number*unit;}number=0;}}return rtn+section;},chnNumChar2:["零","一","二","三","四","五","六","七","八","九"],chnUnitSection:["","万","亿","万亿","亿亿"],chnUnitChar:["","十","百","千"],SectionToChinese:function SectionToChinese(section){var strIns='',chnStr='';var unitPos=0;var zero=true;while(section>0){var v=section%10;if(v==0){if(!zero){zero=true;chnStr=luckysheet.dropCell.chnNumChar2[v]+chnStr;}}else {zero=false;strIns=luckysheet.dropCell.chnNumChar2[v];strIns+=luckysheet.dropCell.chnUnitChar[unitPos];chnStr=strIns+chnStr;}unitPos++;section=Math.floor(section/10);}return chnStr;},NumberToChinese:function NumberToChinese(num){var unitPos=0;var strIns='',chnStr='';var needZero=false;if(num==0){return luckysheet.dropCell.chnNumChar2[0];}while(num>0){var section=num%10000;if(needZero){chnStr=luckysheet.dropCell.chnNumChar2[0]+chnStr;}strIns=luckysheet.dropCell.SectionToChinese(section);strIns+=section!=0?luckysheet.dropCell.chnUnitSection[unitPos]:luckysheet.dropCell.chnUnitSection[0];chnStr=strIns+chnStr;needZero=section<1000&&section>0;num=Math.floor(num/10000);unitPos++;}return chnStr;},isChnNumber:function isChnNumber(txt){var isChnNumber=true;if(txt.length==1){if(txt=="日"||txt in luckysheet.dropCell.chnNumChar){isChnNumber=true;}else {isChnNumber=false;}}else {var str=txt.split("");for(var i=0;i<str.length;i++){if(!(str[i]in luckysheet.dropCell.chnNumChar||str[i]in luckysheet.dropCell.chnNameValue)){isChnNumber=false;break;}}}return isChnNumber;},isExtendNumber:function isExtendNumber(txt){var reg=/[0-9]/;if(reg.test(txt.substr(txt.length-1,1))){var isExtendNumber=true;}else {var isExtendNumber=false;}if(isExtendNumber){var str=txt.split("");str.reverse();var len=0;for(var i=0;i<str.length;i++){if(!reg.test(str[i])){len=i;break;}}return [isExtendNumber,txt.substr(0,txt.length-len),txt.substr(txt.length-len,len)];}else {return [isExtendNumber];}},isChnWeek1:function isChnWeek1(txt){if(txt.length==1){if(txt=="日"||luckysheet.dropCell.ChineseToNumber(txt)<7){var isChnWeek1=true;}else {var isChnWeek1=false;}}else {var isChnWeek1=false;}return isChnWeek1;},isChnWeek2:function isChnWeek2(txt){if(txt.length==2){if(txt=="周一"||txt=="周二"||txt=="周三"||txt=="周四"||txt=="周五"||txt=="周六"||txt=="周日"){var isChnWeek2=true;}else {var isChnWeek2=false;}}else {var isChnWeek2=false;}return isChnWeek2;},isChnWeek3:function isChnWeek3(txt){if(txt.length==3){if(txt=="星期一"||txt=="星期二"||txt=="星期三"||txt=="星期四"||txt=="星期五"||txt=="星期六"||txt=="星期日"){var isChnWeek3=true;}else {var isChnWeek3=false;}}else {var isChnWeek3=false;}return isChnWeek3;},createIcon:function createIcon(){var copy_r=luckysheet.dropCell.copyRange["row"][1],copy_c=luckysheet.dropCell.copyRange["column"][1];var apply_r=luckysheet.dropCell.applyRange["row"][1],apply_c=luckysheet.dropCell.applyRange["column"][1];if(apply_r>=copy_r&&apply_c>=copy_c){var row_index=apply_r;var col_index=apply_c;}else {var row_index=copy_r;var col_index=copy_c;}var row=luckysheet.rowLocationByIndex(row_index)[1],row_pre=luckysheet.rowLocationByIndex(row_index)[0];var col=luckysheet.colLocationByIndex(col_index)[1],col_pre=luckysheet.colLocationByIndex(col_index)[0];$("#luckysheet-dropCell-icon").remove();$("#luckysheet-cell-main").append(luckysheet.dropCell.iconHtml);// $("body").append(luckysheet.dropCell.iconHtml);
  $("#luckysheet-dropCell-icon").css({"left":col,"top":row});//点击icon
  $("#luckysheet-dropCell-icon").mouseover(function(){$(this).css("background-color","#ffe8e8");}).mouseleave(function(){$(this).css("background-color","#f1f1f1");}).mousedown(function(event){$("#luckysheet-dropCell-typeList").remove();$("body").append(luckysheet.dropCell.typeListHtml);var typeItemHide=luckysheet.dropCell.typeItemHide();if(!typeItemHide[0]&&!typeItemHide[1]&&!typeItemHide[2]&&!typeItemHide[3]&&!typeItemHide[4]&&!typeItemHide[5]&&!typeItemHide[6]){$("#luckysheet-dropCell-typeList .luckysheet-cols-menuitem[data-type=1]").hide();$("#luckysheet-dropCell-typeList .luckysheet-cols-menuitem[data-type=4]").hide();$("#luckysheet-dropCell-typeList .luckysheet-cols-menuitem[data-type=5]").hide();$("#luckysheet-dropCell-typeList .luckysheet-cols-menuitem[data-type=6]").hide();$("#luckysheet-dropCell-typeList .luckysheet-cols-menuitem[data-type=7]").hide();$("#luckysheet-dropCell-typeList .luckysheet-cols-menuitem[data-type=8]").hide();}if(!typeItemHide[2]){$("#luckysheet-dropCell-typeList .luckysheet-cols-menuitem[data-type=4]").hide();$("#luckysheet-dropCell-typeList .luckysheet-cols-menuitem[data-type=5]").hide();$("#luckysheet-dropCell-typeList .luckysheet-cols-menuitem[data-type=6]").hide();$("#luckysheet-dropCell-typeList .luckysheet-cols-menuitem[data-type=7]").hide();}if(!typeItemHide[3]){$("#luckysheet-dropCell-typeList .luckysheet-cols-menuitem[data-type=8]").hide();}var left=$(this).offset().left;var top=$(this).offset().top+25;var winH=$(window).height(),winW=$(window).width();var menuW=$("#luckysheet-dropCell-typeList").width(),menuH=$("#luckysheet-dropCell-typeList").height();if(left+menuW>winW){left=left-menuW;}if(top+menuH>winH){top=top-menuH-38;}if(top<0){top=0;}$("#luckysheet-dropCell-typeList").css({"left":left,"top":top}).show();$("#luckysheet-dropCell-icon").mouseleave(function(){$(this).css("backgroundColor","#ffe8e8");});var type=luckysheet.dropCell.applyType;$("#luckysheet-dropCell-typeList .luckysheet-cols-menuitem[data-type="+type+"]").find("span").append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>');event.stopPropagation();});//点击数据填充类型
  $(document).off("click.dCtypeList").on("click.dCtypeList","#luckysheet-dropCell-typeList .luckysheet-cols-menuitem",function(){$("#luckysheet-dropCell-typeList .fa-check").remove();$(this).find("span").append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>');var type=$(this).attr("data-type");luckysheet.dropCell.applyType=type;luckysheet.dropCell.update();$("#luckysheet-dropCell-typeList").hide();$("#luckysheet-dropCell-icon").css("backgroundColor","#f1f1f1");$("#luckysheet-dropCell-icon").mouseleave(function(){$(this).css("backgroundColor","#f1f1f1");});luckysheet.jfcountfunc();});},typeItemHide:function typeItemHide(){var copyRange=luckysheet.dropCell.copyRange;var str_r=copyRange["row"][0],end_r=copyRange["row"][1];var str_c=copyRange["column"][0],end_c=copyRange["column"][1];var hasNumber=false,hasExtendNumber=false,hasDate=false,hasChn=false,hasChnWeek1=false,hasChnWeek2=false,hasChnWeek3=false;for(var r=str_r;r<=end_r;r++){for(var c=str_c;c<=end_c;c++){if(!!luckysheet.flowdata[r][c]){var cell=luckysheet.flowdata[r][c];if(luckysheet.getObjType(cell)=="object"&&cell["v"]!=null&&cell["f"]==null){if(cell["ct"]!=null&&cell["ct"].t=="n"){hasNumber=true;}else if(cell["ct"]!=null&&cell["ct"].t=="d"){hasDate=true;}else if(luckysheet.dropCell.isExtendNumber(cell["m"])[0]){hasExtendNumber=true;}else if(luckysheet.dropCell.isChnNumber(cell["m"])&&cell["m"]!="日"){hasChn=true;}else if(cell["m"]=="日"){hasChnWeek1=true;}else if(luckysheet.dropCell.isChnWeek2(cell["m"])){hasChnWeek2=true;}else if(luckysheet.dropCell.isChnWeek3(cell["m"])){hasChnWeek3=true;}}}}}return [hasNumber,hasExtendNumber,hasDate,hasChn,hasChnWeek1,hasChnWeek2,hasChnWeek3];},update:function update(){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];var cfg=$.extend(true,{},config);var borderInfoCompute=luckysheet.getBorderInfoCompute();var direction=luckysheet.dropCell.direction;var type=luckysheet.dropCell.applyType;//复制范围
  var copyRange=luckysheet.dropCell.copyRange;var copy_str_r=copyRange["row"][0],copy_end_r=copyRange["row"][1];var copy_str_c=copyRange["column"][0],copy_end_c=copyRange["column"][1];var copyData=luckysheet.dropCell.getCopyData(d,copy_str_r,copy_end_r,copy_str_c,copy_end_c,direction);if(direction=="down"||direction=="up"){var csLen=copy_end_r-copy_str_r+1;}else if(direction=="right"||direction=="left"){var csLen=copy_end_c-copy_str_c+1;}//应用范围
  var applyRange=luckysheet.dropCell.applyRange;var apply_str_r=applyRange["row"][0],apply_end_r=applyRange["row"][1];var apply_str_c=applyRange["column"][0],apply_end_c=applyRange["column"][1];if(direction=="down"||direction=="up"){var asLen=apply_end_r-apply_str_r+1;for(var i=apply_str_c;i<=apply_end_c;i++){var copyD=copyData[i-apply_str_c];var applyData=luckysheet.dropCell.getApplyData(copyD,csLen,asLen);if(direction=="down"){for(var j=apply_str_r;j<=apply_end_r;j++){var cell=applyData[j-apply_str_r];if(cell.f!=null){var f="="+luckysheet.formula.functionCopy(cell.f,"down",j-apply_str_r+1);var v=luckysheet.formula.execfunction(f,j,i,true);cell.f=v[2];cell.v=v[1];if(cell.spl!=null){cell.spl=v[3].data;}else {if(luckysheet.func_methods.isRealNum(cell.v)&&!/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(cell.v)){if(cell.v==Infinity||cell.v==-Infinity){cell.m=cell.v.toString();}else {if(cell.v.toString().indexOf("e")>-1){var len=cell.v.toString().split(".")[1].split("e")[0].length;if(len>5){len=5;}cell.m=cell.v.toExponential(len).toString();}else {var mask=luckysheet.mask.genarate(Math.round(cell.v*1000000000)/1000000000);cell.m=mask[0].toString();}}cell.ct={"fa":"General","t":"n"};}else {var mask=luckysheet.mask.genarate(cell.v);cell.m=mask[0].toString();cell.ct=mask[1];}}}d[j][i]=cell;//边框
  var bd_r=copy_str_r+(j-apply_str_r)%csLen;var bd_c=i;if(borderInfoCompute[bd_r+"_"+bd_c]){var bd_obj={"rangeType":"cell","value":{"row_index":j,"col_index":i,"l":borderInfoCompute[bd_r+"_"+bd_c].l,"r":borderInfoCompute[bd_r+"_"+bd_c].r,"t":borderInfoCompute[bd_r+"_"+bd_c].t,"b":borderInfoCompute[bd_r+"_"+bd_c].b}};cfg["borderInfo"].push(bd_obj);}else if(borderInfoCompute[j+"_"+i]){var bd_obj={"rangeType":"cell","value":{"row_index":j,"col_index":i,"l":null,"r":null,"t":null,"b":null}};cfg["borderInfo"].push(bd_obj);}}}if(direction=="up"){for(var j=apply_end_r;j>=apply_str_r;j--){var cell=applyData[apply_end_r-j];if(cell.f!=null){var f="="+luckysheet.formula.functionCopy(cell.f,"up",apply_end_r-j+1);var v=luckysheet.formula.execfunction(f,j,i,true);cell.f=v[2];cell.v=v[1];if(cell.spl!=null){cell.spl=v[3].data;}else {if(luckysheet.func_methods.isRealNum(cell.v)&&!/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(cell.v)){if(cell.v==Infinity||cell.v==-Infinity){cell.m=cell.v.toString();}else {if(cell.v.toString().indexOf("e")>-1){var len=cell.v.toString().split(".")[1].split("e")[0].length;if(len>5){len=5;}cell.m=cell.v.toExponential(len).toString();}else {var mask=luckysheet.mask.genarate(Math.round(cell.v*1000000000)/1000000000);cell.m=mask[0].toString();}}cell.ct={"fa":"General","t":"n"};}else {var mask=luckysheet.mask.genarate(cell.v);cell.m=mask[0].toString();cell.ct=mask[1];}}}d[j][i]=cell;//边框
  var bd_r=copy_end_r-(apply_end_r-j)%csLen;var bd_c=i;if(borderInfoCompute[bd_r+"_"+bd_c]){var bd_obj={"rangeType":"cell","value":{"row_index":j,"col_index":i,"l":borderInfoCompute[bd_r+"_"+bd_c].l,"r":borderInfoCompute[bd_r+"_"+bd_c].r,"t":borderInfoCompute[bd_r+"_"+bd_c].t,"b":borderInfoCompute[bd_r+"_"+bd_c].b}};cfg["borderInfo"].push(bd_obj);}else if(borderInfoCompute[j+"_"+i]){var bd_obj={"rangeType":"cell","value":{"row_index":j,"col_index":i,"l":null,"r":null,"t":null,"b":null}};cfg["borderInfo"].push(bd_obj);}}}}}else if(direction=="right"||direction=="left"){var asLen=apply_end_c-apply_str_c+1;for(var i=apply_str_r;i<=apply_end_r;i++){var copyD=copyData[i-apply_str_r];var applyData=luckysheet.dropCell.getApplyData(copyD,csLen,asLen);if(direction=="right"){for(var j=apply_str_c;j<=apply_end_c;j++){var cell=applyData[j-apply_str_c];if(cell.f!=null){var f="="+luckysheet.formula.functionCopy(cell.f,"right",j-apply_str_c+1);var v=luckysheet.formula.execfunction(f,i,j,true);cell.f=v[2];cell.v=v[1];if(cell.spl!=null){cell.spl=v[3].data;}else {if(luckysheet.func_methods.isRealNum(cell.v)&&!/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(cell.v)){if(cell.v==Infinity||cell.v==-Infinity){cell.m=cell.v.toString();}else {if(cell.v.toString().indexOf("e")>-1){var len=cell.v.toString().split(".")[1].split("e")[0].length;if(len>5){len=5;}cell.m=cell.v.toExponential(len).toString();}else {var mask=luckysheet.mask.genarate(Math.round(cell.v*1000000000)/1000000000);cell.m=mask[0].toString();}}cell.ct={"fa":"General","t":"n"};}else {var mask=luckysheet.mask.genarate(cell.v);cell.m=mask[0].toString();cell.ct=mask[1];}}}d[i][j]=cell;//边框
  var bd_r=i;var bd_c=copy_str_c+(j-apply_str_c)%csLen;if(borderInfoCompute[bd_r+"_"+bd_c]){var bd_obj={"rangeType":"cell","value":{"row_index":i,"col_index":j,"l":borderInfoCompute[bd_r+"_"+bd_c].l,"r":borderInfoCompute[bd_r+"_"+bd_c].r,"t":borderInfoCompute[bd_r+"_"+bd_c].t,"b":borderInfoCompute[bd_r+"_"+bd_c].b}};cfg["borderInfo"].push(bd_obj);}else if(borderInfoCompute[i+"_"+j]){var bd_obj={"rangeType":"cell","value":{"row_index":i,"col_index":j,"l":null,"r":null,"t":null,"b":null}};cfg["borderInfo"].push(bd_obj);}}}if(direction=="left"){for(var j=apply_end_c;j>=apply_str_c;j--){var cell=applyData[apply_end_c-j];if(cell.f!=null){var f="="+luckysheet.formula.functionCopy(cell.f,"left",apply_end_c-j+1);var v=luckysheet.formula.execfunction(f,i,j,true);cell.f=v[2];cell.v=v[1];if(cell.spl!=null){cell.spl=v[3].data;}else {if(luckysheet.func_methods.isRealNum(cell.v)&&!/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(cell.v)){if(cell.v==Infinity||cell.v==-Infinity){cell.m=cell.v.toString();}else {if(cell.v.toString().indexOf("e")>-1){var len=cell.v.toString().split(".")[1].split("e")[0].length;if(len>5){len=5;}cell.m=cell.v.toExponential(len).toString();}else {var mask=luckysheet.mask.genarate(Math.round(cell.v*1000000000)/1000000000);cell.m=mask[0].toString();}}cell.ct={"fa":"General","t":"n"};}else {var mask=luckysheet.mask.genarate(cell.v);cell.m=mask[0].toString();cell.ct=mask[1];}}}d[i][j]=cell;//边框
  var bd_r=i;var bd_c=copy_end_c-(apply_end_c-j)%csLen;if(borderInfoCompute[bd_r+"_"+bd_c]){var bd_obj={"rangeType":"cell","value":{"row_index":i,"col_index":j,"l":borderInfoCompute[bd_r+"_"+bd_c].l,"r":borderInfoCompute[bd_r+"_"+bd_c].r,"t":borderInfoCompute[bd_r+"_"+bd_c].t,"b":borderInfoCompute[bd_r+"_"+bd_c].b}};cfg["borderInfo"].push(bd_obj);}else if(borderInfoCompute[i+"_"+j]){var bd_obj={"rangeType":"cell","value":{"row_index":i,"col_index":j,"l":null,"r":null,"t":null,"b":null}};cfg["borderInfo"].push(bd_obj);}}}}}//条件格式
  var cdformat=$.extend(true,[],file["luckysheet_conditionformat_save"]);if(cdformat!=null&&cdformat.length>0){for(var i=0;i<cdformat.length;i++){var cdformat_cellrange=cdformat[i].cellrange;var emptyRange=[];for(var j=0;j<cdformat_cellrange.length;j++){var range=luckysheet.conditionformat.CFSplitRange(cdformat_cellrange[j],{"row":copyRange["row"],"column":copyRange["column"]},{"row":applyRange["row"],"column":applyRange["column"]},"operatePart");if(range.length>0){emptyRange=emptyRange.concat(range);}}if(emptyRange.length>0){cdformat[i].cellrange.push(applyRange);}}}//刷新一次表格
  luckysheet.jfrefreshgrid(d,luckysheet_select_save,cfg,cdformat);luckysheet.selectHightlightShow();},getCopyData:function getCopyData(d,r1,r2,c1,c2,direction){var copyData=[];if(direction=="down"||direction=="up"){var a1=c1,a2=c2,b1=r1,b2=r2;}else if(direction=="right"||direction=="left"){var a1=r1,a2=r2,b1=c1,b2=c2;}for(var a=a1;a<=a2;a++){var obj={};var arrData=[];var arrIndex=[];var text="";var extendNumberStr=null;var isSameStr=true;for(var b=b1;b<=b2;b++){//单元格
  if(direction=="down"||direction=="up"){var data=d[b][a];}else if(direction=="right"||direction=="left"){var data=d[a][b];}//单元格值类型
  if(!!data&&!!data["v"]&&data["f"]==null){if(!!data["ct"]&&data["ct"]["t"]=="n"){var str="number";extendNumberStr=null;}else if(!!data["ct"]&&data["ct"]["t"]=="d"){var str="date";extendNumberStr=null;}else if(luckysheet.dropCell.isExtendNumber(data["m"])[0]){var str="extendNumber";if(extendNumberStr==null){isSameStr=true;extendNumberStr=luckysheet.dropCell.isExtendNumber(data["m"])[1];}else {if(luckysheet.dropCell.isExtendNumber(data["m"])[1]!=extendNumberStr){isSameStr=false;extendNumberStr=luckysheet.dropCell.isExtendNumber(data["m"])[1];}else {isSameStr=true;}}}else if(luckysheet.dropCell.isChnNumber(data["m"])){var str="chnNumber";extendNumberStr=null;}else if(luckysheet.dropCell.isChnWeek2(data["m"])){var str="chnWeek2";extendNumberStr=null;}else if(luckysheet.dropCell.isChnWeek3(data["m"])){var str="chnWeek3";extendNumberStr=null;}else {var str="other";extendNumberStr=null;}}else {var str="other";extendNumberStr=null;}//
  if(str=="extendNumber"){if(b==b1){if(b1==b2){text=str;arrData.push(data);arrIndex.push(b-b1+1);obj[text]=[];obj[text].push({"data":arrData,"index":arrIndex});}else {text=str;arrData.push(data);arrIndex.push(b-b1+1);}}else if(b==b2){if(text==str&&isSameStr){arrData.push(data);arrIndex.push(b-b1+1);if(text in obj){obj[text].push({"data":arrData,"index":arrIndex});}else {obj[text]=[];obj[text].push({"data":arrData,"index":arrIndex});}}else {if(text in obj){obj[text].push({"data":arrData,"index":arrIndex});}else {obj[text]=[];obj[text].push({"data":arrData,"index":arrIndex});}text=str;arrData=[];arrData.push(data);arrIndex=[];arrIndex.push(b-b1+1);if(text in obj){obj[text].push({"data":arrData,"index":arrIndex});}else {obj[text]=[];obj[text].push({"data":arrData,"index":arrIndex});}}}else {if(text==str&&isSameStr){arrData.push(data);arrIndex.push(b-b1+1);}else {if(text in obj){obj[text].push({"data":arrData,"index":arrIndex});}else {obj[text]=[];obj[text].push({"data":arrData,"index":arrIndex});}text=str;arrData=[];arrData.push(data);arrIndex=[];arrIndex.push(b-b1+1);}}}else {if(b==b1){if(b1==b2){text=str;arrData.push(data);arrIndex.push(b-b1+1);obj[text]=[];obj[text].push({"data":arrData,"index":arrIndex});}else {text=str;arrData.push(data);arrIndex.push(b-b1+1);}}else if(b==b2){if(text==str){arrData.push(data);arrIndex.push(b-b1+1);if(text in obj){obj[text].push({"data":arrData,"index":arrIndex});}else {obj[text]=[];obj[text].push({"data":arrData,"index":arrIndex});}}else {if(text in obj){obj[text].push({"data":arrData,"index":arrIndex});}else {obj[text]=[];obj[text].push({"data":arrData,"index":arrIndex});}text=str;arrData=[];arrData.push(data);arrIndex=[];arrIndex.push(b-b1+1);if(text in obj){obj[text].push({"data":arrData,"index":arrIndex});}else {obj[text]=[];obj[text].push({"data":arrData,"index":arrIndex});}}}else {if(text==str){arrData.push(data);arrIndex.push(b-b1+1);}else {if(text in obj){obj[text].push({"data":arrData,"index":arrIndex});}else {obj[text]=[];obj[text].push({"data":arrData,"index":arrIndex});}text=str;arrData=[];arrData.push(data);arrIndex=[];arrIndex.push(b-b1+1);}}}}copyData.push(obj);}return copyData;},getApplyData:function getApplyData(copyD,csLen,asLen){var applyData=[];var direction=luckysheet.dropCell.direction;var type=luckysheet.dropCell.applyType;var num=Math.floor(asLen/csLen);var rsd=asLen%csLen;//纯数字类型
  var copyD_number=copyD["number"];var applyD_number=[];if(!!copyD_number){for(var i=0;i<copyD_number.length;i++){var s=luckysheet.dropCell.getLenS(copyD_number[i]["index"],rsd);var len=copyD_number[i]["index"].length*num+s;if(type=="1"||type=="3"){var arrData=luckysheet.dropCell.getDataByType(copyD_number[i]["data"],len,direction,type,"number");}else if(type=="2"){var arrData=luckysheet.dropCell.getDataByType(copyD_number[i]["data"],len,direction,type);}else {var arrData=luckysheet.dropCell.getDataByType(copyD_number[i]["data"],len,direction,"0");}var arrIndex=luckysheet.dropCell.getDataIndex(csLen,asLen,copyD_number[i]["index"]);applyD_number.push({"data":arrData,"index":arrIndex});}}//扩展数字型（即一串字符最后面的是数字）
  var copyD_extendNumber=copyD["extendNumber"];var applyD_extendNumber=[];if(!!copyD_extendNumber){for(var i=0;i<copyD_extendNumber.length;i++){var s=luckysheet.dropCell.getLenS(copyD_extendNumber[i]["index"],rsd);var len=copyD_extendNumber[i]["index"].length*num+s;if(type=="1"||type=="3"){var arrData=luckysheet.dropCell.getDataByType(copyD_extendNumber[i]["data"],len,direction,type,"extendNumber");}else if(type=="2"){var arrData=luckysheet.dropCell.getDataByType(copyD_extendNumber[i]["data"],len,direction,type);}else {var arrData=luckysheet.dropCell.getDataByType(copyD_extendNumber[i]["data"],len,direction,"0");}var arrIndex=luckysheet.dropCell.getDataIndex(csLen,asLen,copyD_extendNumber[i]["index"]);applyD_extendNumber.push({"data":arrData,"index":arrIndex});}}//日期类型
  var copyD_date=copyD["date"];var applyD_date=[];if(!!copyD_date){for(var i=0;i<copyD_date.length;i++){var s=luckysheet.dropCell.getLenS(copyD_date[i]["index"],rsd);var len=copyD_date[i]["index"].length*num+s;if(type=="1"||type=="3"){var arrData=luckysheet.dropCell.getDataByType(copyD_date[i]["data"],len,direction,type,"date");}else if(type=="8"){var arrData=luckysheet.dropCell.getDataByType(copyD_date[i]["data"],len,direction,"0");}else {var arrData=luckysheet.dropCell.getDataByType(copyD_date[i]["data"],len,direction,type);}var arrIndex=luckysheet.dropCell.getDataIndex(csLen,asLen,copyD_date[i]["index"]);applyD_date.push({"data":arrData,"index":arrIndex});}}//中文小写数字 或 一~日
  var copyD_chnNumber=copyD["chnNumber"];var applyD_chnNumber=[];if(!!copyD_chnNumber){for(var i=0;i<copyD_chnNumber.length;i++){var s=luckysheet.dropCell.getLenS(copyD_chnNumber[i]["index"],rsd);var len=copyD_chnNumber[i]["index"].length*num+s;if(type=="1"||type=="3"){var arrData=luckysheet.dropCell.getDataByType(copyD_chnNumber[i]["data"],len,direction,type,"chnNumber");}else if(type=="2"||type=="8"){var arrData=luckysheet.dropCell.getDataByType(copyD_chnNumber[i]["data"],len,direction,type);}else {var arrData=luckysheet.dropCell.getDataByType(copyD_chnNumber[i]["data"],len,direction,"0");}var arrIndex=luckysheet.dropCell.getDataIndex(csLen,asLen,copyD_chnNumber[i]["index"]);applyD_chnNumber.push({"data":arrData,"index":arrIndex});}}//周一~周日
  var copyD_chnWeek2=copyD["chnWeek2"];var applyD_chnWeek2=[];if(!!copyD_chnWeek2){for(var i=0;i<copyD_chnWeek2.length;i++){var s=luckysheet.dropCell.getLenS(copyD_chnWeek2[i]["index"],rsd);var len=copyD_chnWeek2[i]["index"].length*num+s;if(type=="1"||type=="3"){var arrData=luckysheet.dropCell.getDataByType(copyD_chnWeek2[i]["data"],len,direction,type,"chnWeek2");}else if(type=="2"){var arrData=luckysheet.dropCell.getDataByType(copyD_chnWeek2[i]["data"],len,direction,type);}else {var arrData=luckysheet.dropCell.getDataByType(copyD_chnWeek2[i]["data"],len,direction,"0");}var arrIndex=luckysheet.dropCell.getDataIndex(csLen,asLen,copyD_chnWeek2[i]["index"]);applyD_chnWeek2.push({"data":arrData,"index":arrIndex});}}//星期一~星期日
  var copyD_chnWeek3=copyD["chnWeek3"];var applyD_chnWeek3=[];if(!!copyD_chnWeek3){for(var i=0;i<copyD_chnWeek3.length;i++){var s=luckysheet.dropCell.getLenS(copyD_chnWeek3[i]["index"],rsd);var len=copyD_chnWeek3[i]["index"].length*num+s;if(type=="1"||type=="3"){var arrData=luckysheet.dropCell.getDataByType(copyD_chnWeek3[i]["data"],len,direction,type,"chnWeek3");}else if(type=="2"){var arrData=luckysheet.dropCell.getDataByType(copyD_chnWeek3[i]["data"],len,direction,type);}else {var arrData=luckysheet.dropCell.getDataByType(copyD_chnWeek3[i]["data"],len,direction,"0");}var arrIndex=luckysheet.dropCell.getDataIndex(csLen,asLen,copyD_chnWeek3[i]["index"]);applyD_chnWeek3.push({"data":arrData,"index":arrIndex});}}//其它
  var copyD_other=copyD["other"];var applyD_other=[];if(!!copyD_other){for(var i=0;i<copyD_other.length;i++){var s=luckysheet.dropCell.getLenS(copyD_other[i]["index"],rsd);var len=copyD_other[i]["index"].length*num+s;if(type=="2"||type=="3"){var arrData=luckysheet.dropCell.getDataByType(copyD_other[i]["data"],len,direction,type);}else {var arrData=luckysheet.dropCell.getDataByType(copyD_other[i]["data"],len,direction,"0");}var arrIndex=luckysheet.dropCell.getDataIndex(csLen,asLen,copyD_other[i]["index"]);applyD_other.push({"data":arrData,"index":arrIndex});}}//
  for(var x=1;x<=asLen;x++){if(applyD_number.length>0){for(var y=0;y<applyD_number.length;y++){if(x in applyD_number[y]["index"]){applyData.push(applyD_number[y]["data"][applyD_number[y]["index"][x]]);}}}if(applyD_extendNumber.length>0){for(var y=0;y<applyD_extendNumber.length;y++){if(x in applyD_extendNumber[y]["index"]){applyData.push(applyD_extendNumber[y]["data"][applyD_extendNumber[y]["index"][x]]);}}}if(applyD_date.length>0){for(var y=0;y<applyD_date.length;y++){if(x in applyD_date[y]["index"]){applyData.push(applyD_date[y]["data"][applyD_date[y]["index"][x]]);}}}if(applyD_chnNumber.length>0){for(var y=0;y<applyD_chnNumber.length;y++){if(x in applyD_chnNumber[y]["index"]){applyData.push(applyD_chnNumber[y]["data"][applyD_chnNumber[y]["index"][x]]);}}}if(applyD_chnWeek2.length>0){for(var y=0;y<applyD_chnWeek2.length;y++){if(x in applyD_chnWeek2[y]["index"]){applyData.push(applyD_chnWeek2[y]["data"][applyD_chnWeek2[y]["index"][x]]);}}}if(applyD_chnWeek3.length>0){for(var y=0;y<applyD_chnWeek3.length;y++){if(x in applyD_chnWeek3[y]["index"]){applyData.push(applyD_chnWeek3[y]["data"][applyD_chnWeek3[y]["index"][x]]);}}}if(applyD_other.length>0){for(var y=0;y<applyD_other.length;y++){if(x in applyD_other[y]["index"]){applyData.push(applyD_other[y]["data"][applyD_other[y]["index"][x]]);}}}}return applyData;},getLenS:function getLenS(indexArr,rsd){var s=0;for(var j=0;j<indexArr.length;j++){if(indexArr[j]<=rsd){s++;}else {break;}}return s;},getDataIndex:function getDataIndex(csLen,asLen,indexArr){var obj={};var num=Math.floor(asLen/csLen);var rsd=asLen%csLen;var sum=0;if(num>0){for(var i=1;i<=num;i++){for(var j=0;j<indexArr.length;j++){obj[indexArr[j]+(i-1)*csLen]=sum;sum++;}}for(var a=0;a<indexArr.length;a++){if(indexArr[a]<=rsd){obj[indexArr[a]+csLen*num]=sum;sum++;}else {break;}}}else {for(var a=0;a<indexArr.length;a++){if(indexArr[a]<=rsd){obj[indexArr[a]]=sum;sum++;}else {break;}}}return obj;},getDataByType:function getDataByType(data,len,direction,type,dataType){var applyData=[];if(type=="0"){//复制单元格
  if(direction=="up"||direction=="left"){data.reverse();}applyData=luckysheet.dropCell.FillCopy(data,len);}else if(type=="1"){//填充序列
  if(dataType=="number"){//数据类型是 数字 
  applyData=luckysheet.dropCell.FillSeries(data,len,direction);}else if(dataType=="extendNumber"){//扩展数字（一串字符最后面的是数字）
  if(data.length==1){if(direction=="down"||direction=="right"){var step=1;}else if(direction=="up"||direction=="left"){var step=-1;}applyData=luckysheet.dropCell.FillExtendNumber(data,len,step);}else {var dataNumArr=[];for(var i=0;i<data.length;i++){var txt=data[i]["m"];dataNumArr.push(Number(luckysheet.dropCell.isExtendNumber(txt)[2]));}if(direction=="up"||direction=="left"){data.reverse();dataNumArr.reverse();}if(luckysheet.dropCell.isEqualDiff(dataNumArr)){//等差数列，以等差为step
  var step=dataNumArr[1]-dataNumArr[0];applyData=luckysheet.dropCell.FillExtendNumber(data,len,step);}else {//不是等差数列，复制数据
  applyData=luckysheet.dropCell.FillCopy(data,len);}}}else if(dataType=="date"){//数据类型是 日期
  if(data.length==1){//以一天为step
  if(direction=="down"||direction=="right"){var step=1;}else if(direction=="up"||direction=="left"){var step=-1;}applyData=luckysheet.dropCell.FillDays(data,len,step);}else {if(direction=="up"||direction=="left"){data.reverse();}var judgeDate=luckysheet.dropCell.judgeDate(data);if(judgeDate[0]&&judgeDate[3]){//日一样，月差为等差数列，以月差为step
  var step=moment(data[1]["m"]).diff(moment(data[0]["m"]),"months");applyData=luckysheet.dropCell.FillMonths(data,len,step);}else if(!judgeDate[0]&&judgeDate[2]){//日不一样，日差为等差数列，以日差为step
  var step=moment(data[1]["m"]).diff(moment(data[0]["m"]),"days");applyData=luckysheet.dropCell.FillDays(data,len,step);}else {//其它，复制数据
  applyData=luckysheet.dropCell.FillCopy(data,len);}}}else if(dataType=="chnNumber"){//数据类型是 中文小写数字
  if(data.length==1){if(data[0]["m"]=="日"||luckysheet.dropCell.ChineseToNumber(data[0]["m"])<7){//数字小于7，以周一~周日序列填充
  if(direction=="down"||direction=="right"){var step=1;}else if(direction=="up"||direction=="left"){var step=-1;}applyData=luckysheet.dropCell.FillChnWeek(data,len,step);}else {//数字大于7，以中文小写数字序列填充
  if(direction=="down"||direction=="right"){var step=1;}else if(direction=="up"||direction=="left"){var step=-1;}applyData=luckysheet.dropCell.FillChnNumber(data,len,step);}}else {var hasweek=false;for(var i=0;i<data.length;i++){if(data[i]["m"]=="日"){hasweek=true;break;}}var dataNumArr=[];var weekIndex=0;for(var i=0;i<data.length;i++){if(data[i]["m"]=="日"){if(i==0){dataNumArr.push(0);}else {weekIndex++;dataNumArr.push(weekIndex*7);}}else if(hasweek&&luckysheet.dropCell.ChineseToNumber(data[i]["m"])>0&&luckysheet.dropCell.ChineseToNumber(data[i]["m"])<7){dataNumArr.push(luckysheet.dropCell.ChineseToNumber(data[i]["m"])+weekIndex*7);}else {dataNumArr.push(luckysheet.dropCell.ChineseToNumber(data[i]["m"]));}}if(direction=="up"||direction=="left"){data.reverse();dataNumArr.reverse();}if(luckysheet.dropCell.isEqualDiff(dataNumArr)){if(hasweek||dataNumArr[dataNumArr.length-1]<6&&dataNumArr[0]>0||dataNumArr[0]<6&&dataNumArr[dataNumArr.length-1]>0){//以周一~周日序列填充
  var step=dataNumArr[1]-dataNumArr[0];applyData=luckysheet.dropCell.FillChnWeek(data,len,step);}else {//以中文小写数字序列填充
  var step=dataNumArr[1]-dataNumArr[0];applyData=luckysheet.dropCell.FillChnNumber(data,len,step);}}else {//不是等差数列，复制数据
  applyData=luckysheet.dropCell.FillCopy(data,len);}}}else if(dataType=="chnWeek2"){//周一~周日
  if(data.length==1){if(direction=="down"||direction=="right"){var step=1;}else if(direction=="up"||direction=="left"){var step=-1;}applyData=luckysheet.dropCell.FillChnWeek2(data,len,step);}else {var dataNumArr=[];var weekIndex=0;for(var i=0;i<data.length;i++){var lastTxt=data[i]["m"].substr(data[i]["m"].length-1,1);if(data[i]["m"]=="周日"){if(i==0){dataNumArr.push(0);}else {weekIndex++;dataNumArr.push(weekIndex*7);}}else {dataNumArr.push(luckysheet.dropCell.ChineseToNumber(lastTxt)+weekIndex*7);}}if(direction=="up"||direction=="left"){data.reverse();dataNumArr.reverse();}if(luckysheet.dropCell.isEqualDiff(dataNumArr)){//等差数列，以等差为step
  var step=dataNumArr[1]-dataNumArr[0];applyData=luckysheet.dropCell.FillChnWeek2(data,len,step);}else {//不是等差数列，复制数据
  applyData=luckysheet.dropCell.FillCopy(data,len);}}}else if(dataType=="chnWeek3"){//星期一~星期日
  if(data.length==1){if(direction=="down"||direction=="right"){var step=1;}else if(direction=="up"||direction=="left"){var step=-1;}applyData=luckysheet.dropCell.FillChnWeek3(data,len,step);}else {var dataNumArr=[];var weekIndex=0;for(var i=0;i<data.length;i++){var lastTxt=data[i]["m"].substr(data[i]["m"].length-1,1);if(data[i]["m"]=="星期日"){if(i==0){dataNumArr.push(0);}else {weekIndex++;dataNumArr.push(weekIndex*7);}}else {dataNumArr.push(luckysheet.dropCell.ChineseToNumber(lastTxt)+weekIndex*7);}}if(direction=="up"||direction=="left"){data.reverse();dataNumArr.reverse();}if(luckysheet.dropCell.isEqualDiff(dataNumArr)){//等差数列，以等差为step
  var step=dataNumArr[1]-dataNumArr[0];applyData=luckysheet.dropCell.FillChnWeek3(data,len,step);}else {//不是等差数列，复制数据
  applyData=luckysheet.dropCell.FillCopy(data,len);}}}else {//数据类型是 其它
  if(direction=="up"||direction=="left"){data.reverse();}applyData=luckysheet.dropCell.FillCopy(data,len);}}else if(type=="2"){//仅填充格式
  if(direction=="up"||direction=="left"){data.reverse();}applyData=luckysheet.dropCell.FillOnlyFormat(data,len);}else if(type=="3"){//不带格式填充
  var dataArr=luckysheet.dropCell.getDataByType(data,len,direction,"1",dataType);applyData=luckysheet.dropCell.FillWithoutFormat(dataArr);}else if(type=="4"){//以天数填充
  if(data.length==1){//以一天为step
  if(direction=="down"||direction=="right"){var step=1;}else if(direction=="up"||direction=="left"){var step=-1;}applyData=luckysheet.dropCell.FillDays(data,len,step);}else if(data.length==2){//以日差为step
  if(direction=="up"||direction=="left"){data.reverse();}var step=moment(data[1]["m"]).diff(moment(data[0]["m"]),"days");applyData=luckysheet.dropCell.FillDays(data,len,step);}else {if(direction=="up"||direction=="left"){data.reverse();}var judgeDate=luckysheet.dropCell.judgeDate(data);if(judgeDate[0]&&judgeDate[3]){//日一样，且月差为等差数列，以月差为step
  var step=moment(data[1]["m"]).diff(moment(data[0]["m"]),"months");applyData=luckysheet.dropCell.FillMonths(data,len,step);}else if(!judgeDate[0]&&judgeDate[2]){//日不一样，且日差为等差数列，以日差为step
  var step=moment(data[1]["m"]).diff(moment(data[0]["m"]),"days");applyData=luckysheet.dropCell.FillDays(data,len,step);}else {//日差不是等差数列，复制数据
  applyData=luckysheet.dropCell.FillCopy(data,len);}}}else if(type=="5"){//以工作日填充
  if(data.length==1){//以一天为step（若那天为休息日，则跳过）
  if(direction=="down"||direction=="right"){var step=1;}else if(direction=="up"||direction=="left"){var step=-1;}var newLen=Math.round(len*1.5);for(var i=1;i<=newLen;i++){var d=$.extend(true,{},data[0]);var day=moment(d["m"]).add(i,"days").day();if(day==0||day==6){continue;}var date=moment(d["m"]).add(step*i,"days").format("YYYY-MM-DD");d["m"]=date;d["v"]=luckysheet.mask.genarate(date)[2];applyData.push(d);if(applyData.length==len){break;}}}else if(data.length==2){if(moment(data[1]["m"]).date()==moment(data[0]["m"]).date()&&moment(data[1]["m"]).diff(moment(data[0]["m"]),"months")!=0){//日一样，且月差大于一月，以月差为step（若那天为休息日，则向前取最近的工作日）
  if(direction=="up"||direction=="left"){data.reverse();}var step=moment(data[1]["m"]).diff(moment(data[0]["m"]),"months");for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var day=moment(data[data.length-1]).add(step*i,"months").day();if(day==0){var date=moment(data[data.length-1]).add(step*i,"months").subtract(2,"days").format("YYYY-MM-DD");}else if(day==6){var date=moment(data[data.length-1]).add(step*i,"months").subtract(1,"days").format("YYYY-MM-DD");}else {var date=moment(data[data.length-1]).add(step*i,"months").format("YYYY-MM-DD");}d["m"]=date;d["v"]=luckysheet.mask.genarate(date)[2];applyData.push(d);}}else {//日不一样
  if(Math.abs(moment(data[1]["m"]).diff(moment(data[0]["m"])))>7){//若日差大于7天，以一月为step（若那天是休息日，则向前取最近的工作日）
  if(direction=="down"||direction=="right"){var step_month=1;}else if(direction=="up"||direction=="left"){var step_month=-1;data.reverse();}var step;//以数组第一个为对比
  for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var num=Math.ceil(i/data.length);if(index==0){step=moment(d["m"]).add(step_month*num,"months").diff(moment(d["m"]),"days");}var day=moment(d["m"]).add(step,"days").day();if(day==0){var date=moment(d["m"]).add(step,"days").subtract(2,"days").format("YYYY-MM-DD");}else if(day==6){var date=moment(d["m"]).add(step,"days").subtract(1,"days").format("YYYY-MM-DD");}else {var date=moment(d["m"]).add(step,"days").format("YYYY-MM-DD");}d["m"]=date;d["v"]=luckysheet.mask.genarate(date)[2];applyData.push(d);}}else {//若日差小于等于7天，以7天为step（若那天是休息日，则向前取最近的工作日）
  if(direction=="down"||direction=="right"){var step_day=7;}else if(direction=="up"||direction=="left"){var step_day=-7;data.reverse();}var step;//以数组第一个为对比
  for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var num=Math.ceil(i/data.length);if(index==0){step=moment(d["m"]).add(step_day*num,"days").diff(moment(d["m"]),"days");}var day=moment(d["m"]).add(step,"days").day();if(day==0){var date=moment(d["m"]).add(step,"days").subtract(2,"days").format("YYYY-MM-DD");}else if(day==6){var date=moment(d["m"]).add(step,"days").subtract(1,"days").format("YYYY-MM-DD");}else {var date=moment(d["m"]).add(step,"days").format("YYYY-MM-DD");}d["m"]=date;d["v"]=luckysheet.mask.genarate(date)[2];applyData.push(d);}}}}else {var judgeDate=luckysheet.dropCell.judgeDate(data);if(judgeDate[0]&&judgeDate[3]){//日一样，且月差为等差数列，以月差为step（若那天为休息日，则向前取最近的工作日）
  if(direction=="up"||direction=="left"){data.reverse();}var step=moment(data[1]["m"]).diff(moment(data[0]["m"]),"months");for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var day=moment(data[data.length-1]["m"]).add(step*i,"months").day();if(day==0){var date=moment(data[data.length-1]["m"]).add(step*i,"months").subtract(2,"days").format("YYYY-MM-DD");}else if(day==6){var date=moment(data[data.length-1]["m"]).add(step*i,"months").subtract(1,"days").format("YYYY-MM-DD");}else {var date=moment(data[data.length-1]["m"]).add(step*i,"months").format("YYYY-MM-DD");}d["m"]=date;d["v"]=luckysheet.mask.genarate(date)[2];applyData.push(d);}}else if(!judgeDate[0]&&judgeDate[2]){//日不一样，且日差为等差数列
  if(Math.abs(moment(data[1]["m"]).diff(moment(data[0]["m"])))>7){//若日差大于7天，以一月为step（若那天是休息日，则向前取最近的工作日）
  if(direction=="down"||direction=="right"){var step_month=1;}else if(direction=="up"||direction=="left"){var step_month=-1;data.reverse();}var step;//以数组第一个为对比
  for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var num=Math.ceil(i/data.length);if(index==0){step=moment(d["m"]).add(step_month*num,"months").diff(moment(d["m"]),"days");}var day=moment(d["m"]).add(step,"days").day();if(day==0){var date=moment(d["m"]).add(step,"days").subtract(2,"days").format("YYYY-MM-DD");}else if(day==6){var date=moment(d["m"]).add(step,"days").subtract(1,"days").format("YYYY-MM-DD");}else {var date=moment(d["m"]).add(step,"days").format("YYYY-MM-DD");}d["m"]=date;d["v"]=luckysheet.mask.genarate(date)[2];applyData.push(d);}}else {//若日差小于等于7天，以7天为step（若那天是休息日，则向前取最近的工作日）
  if(direction=="down"||direction=="right"){var step_day=7;}else if(direction=="up"||direction=="left"){var step_day=-7;data.reverse();}var step;//以数组第一个为对比
  for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var num=Math.ceil(i/data.length);if(index==0){step=moment(d["m"]).add(step_day*num,"days").diff(moment(d["m"]),"days");}var day=moment(d["m"]).add(step,"days").day();if(day==0){var date=moment(d["m"]).add(step,"days").subtract(2,"days").format("YYYY-MM-DD");}else if(day==6){var date=moment(d["m"]).add(step,"days").subtract(1,"days").format("YYYY-MM-DD");}else {var date=moment(d["m"]).add(step,"days").format("YYYY-MM-DD");}d["m"]=date;d["v"]=luckysheet.mask.genarate(date)[2];applyData.push(d);}}}else {//日差不是等差数列，复制数据
  if(direction=="up"||direction=="left"){data.reverse();}applyData=luckysheet.dropCell.FillCopy(data,len);}}}else if(type=="6"){//以月填充
  if(data.length==1){//以一月为step
  if(direction=="down"||direction=="right"){var step=1;}else if(direction=="up"||direction=="left"){var step=-1;}applyData=luckysheet.dropCell.FillMonths(data,len,step);}else if(data.length==2){if(moment(data[1]["m"]).date()==moment(data[0]["m"]).date()&&moment(data[1]["m"]).diff(moment(data[0]["m"]),"months")!=0){//日一样，且月差大于一月，以月差为step
  if(direction=="up"||direction=="left"){data.reverse();}var step=moment(data[1]["m"]).diff(moment(data[0]["m"]),"months");applyData=luckysheet.dropCell.FillMonths(data,len,step);}else {//以一月为step
  if(direction=="down"||direction=="right"){var step_month=1;}else if(direction=="up"||direction=="left"){var step_month=-1;data.reverse();}var step;//以数组第一个为对比
  for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var num=Math.ceil(i/data.length);if(index==0){step=moment(d["m"]).add(step_month*num,"months").diff(moment(d["m"]),"days");}var date=moment(d["m"]).add(step,"days").format("YYYY-MM-DD");d["m"]=date;d["v"]=luckysheet.mask.genarate(date)[2];applyData.push(d);}}}else {var judgeDate=luckysheet.dropCell.judgeDate(data);if(judgeDate[0]&&judgeDate[3]){//日一样，且月差为等差数列，以月差为step
  if(direction=="up"||direction=="left"){data.reverse();}var step=moment(data[1]["m"]).diff(moment(data[0]["m"]),"months");applyData=luckysheet.dropCell.FillMonths(data,len,step);}else if(!judgeDate[0]&&judgeDate[2]){//日不一样，且日差为等差数列，以一月为step
  if(direction=="down"||direction=="right"){var step_month=1;}else if(direction=="up"||direction=="left"){var step_month=-1;data.reverse();}var step;//以数组第一个为对比
  for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var num=Math.ceil(i/data.length);if(index==0){step=moment(d["m"]).add(step_month*num,"months").diff(moment(d["m"]),"days");}var date=moment(d["m"]).add(step,"days").format("YYYY-MM-DD");d["m"]=date;d["v"]=luckysheet.mask.genarate(date)[2];applyData.push(d);}}else {//日差不是等差数列，复制数据
  if(direction=="up"||direction=="left"){data.reverse();}applyData=luckysheet.dropCell.FillCopy(data,len);}}}else if(type=="7"){//以年填充
  if(data.length==1){//以一年为step
  if(direction=="down"||direction=="right"){var step=1;}else if(direction=="up"||direction=="left"){var step=-1;}applyData=luckysheet.dropCell.FillYears(data,len,step);}else if(data.length==2){if(moment(data[1]["m"]).date()==moment(data[0]["m"]).date()&&moment(data[1]["m"]).month()==moment(data[0]["m"]).month()&&moment(data[1]["m"]).diff(moment(data[0]["m"]),"years")!=0){//日月一样，且年差大于一年，以年差为step
  if(direction=="up"||direction=="left"){data.reverse();}var step=moment(data[1]["m"]).diff(moment(data[0]["m"]),"years");applyData=luckysheet.dropCell.FillYears(data,len,step);}else {//以一年为step
  if(direction=="down"||direction=="right"){var step_year=1;}else if(direction=="up"||direction=="left"){var step_year=-1;data.reverse();}var step;//以数组第一个为对比
  for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var num=Math.ceil(i/data.length);if(index==0){step=moment(d["m"]).add(step_year*num,"years").diff(moment(d["m"]),"days");}var date=moment(d["m"]).add(step,"days").format("YYYY-MM-DD");d["m"]=date;d["v"]=luckysheet.mask.genarate(date)[2];applyData.push(d);}}}else {var judgeDate=luckysheet.dropCell.judgeDate(data);if(judgeDate[0]&&judgeDate[1]&&judgeDate[4]){//日月一样，且年差为等差数列，以年差为step
  if(direction=="up"||direction=="left"){data.reverse();}var step=moment(data[1]["m"]).diff(moment(data[0]["m"]),"years");applyData=luckysheet.dropCell.FillYears(data,len,step);}else if(judgeDate[0]&&judgeDate[3]||judgeDate[2]){//日一样且月差为等差数列，或天差为等差数列，以一年为step
  if(direction=="down"||direction=="right"){var step_year=1;}else if(direction=="up"||direction=="left"){var step_year=-1;data.reverse();}var step;//以数组第一个为对比
  for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var num=Math.ceil(i/data.length);if(index==0){step=moment(d["m"]).add(step_year*num,"years").diff(moment(d["m"]),"days");}var date=moment(d["m"]).add(step,"days").format("YYYY-MM-DD");d["m"]=date;d["v"]=luckysheet.mask.genarate(date)[2];applyData.push(d);}}else {//日差不是等差数列，复制数据
  if(direction=="up"||direction=="left"){data.reverse();}applyData=luckysheet.dropCell.FillCopy(data,len);}}}else if(type=="8"){//以中文小写数字序列填充
  if(data.length==1){if(direction=="down"||direction=="right"){var step=1;}else if(direction=="up"||direction=="left"){var step=-1;}applyData=luckysheet.dropCell.FillChnNumber(data,len,step);}else {var dataNumArr=[];for(var i=0;i<data.length;i++){dataNumArr.push(luckysheet.dropCell.ChineseToNumber(data[i]["m"]));}if(direction=="up"||direction=="left"){data.reverse();dataNumArr.reverse();}if(luckysheet.dropCell.isEqualDiff(dataNumArr)){var step=dataNumArr[1]-dataNumArr[0];applyData=luckysheet.dropCell.FillChnNumber(data,len,step);}else {//不是等差数列，复制数据
  applyData=luckysheet.dropCell.FillCopy(data,len);}}}return applyData;},FillCopy:function FillCopy(data,len){var applyData=[];for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);applyData.push(d);}return applyData;},FillSeries:function FillSeries(data,len,direction){var applyData=[];var dataNumArr=[];for(var j=0;j<data.length;j++){dataNumArr.push(Number(data[j]["v"]));}if(data.length>2&&luckysheet.dropCell.isEqualRatio(dataNumArr)){//等比数列
  for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);if(direction=="down"||direction=="right"){var num=Number(data[data.length-1]["v"])*Math.pow(Number(data[1]["v"])/Number(data[0]["v"]),i);}else if(direction=="up"||direction=="left"){var num=Number(data[0]["v"])/Math.pow(Number(data[1]["v"])/Number(data[0]["v"]),i);}d["v"]=num;d["m"]=luckysheet.mask.update(d["ct"]["fa"],num);applyData.push(d);}}else {//线性数列
  var xArr=luckysheet.dropCell.getXArr(data.length);for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);if(direction=="down"||direction=="right"){var y=luckysheet.dropCell.forecast(data.length+i,dataNumArr,xArr);}else if(direction=="up"||direction=="left"){var y=luckysheet.dropCell.forecast(1-i,dataNumArr,xArr);}d["v"]=y;d["m"]=luckysheet.mask.update(d["ct"]["fa"],y);applyData.push(d);}}return applyData;},FillExtendNumber:function FillExtendNumber(data,len,step){var applyData=[];for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var last=data[data.length-1]["m"];var lastTxt=luckysheet.dropCell.isExtendNumber(last)[1];var lastNum=luckysheet.dropCell.isExtendNumber(last)[2];var num=Math.abs(Number(lastNum)+step*i);d["v"]=lastTxt+num.toString();d["m"]=lastTxt+num.toString();applyData.push(d);}return applyData;},FillOnlyFormat:function FillOnlyFormat(data,len){var applyData=[];for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);delete d["f"];delete d["m"];delete d["v"];applyData.push(d);}return applyData;},FillWithoutFormat:function FillWithoutFormat(dataArr){var applyData=[];for(var i=0;i<dataArr.length;i++){var d=$.extend(true,{},dataArr[i]);if(d["f"]==null){var obj={"m":d["v"].toString(),"v":d["v"]};}else {var obj={"f":d["f"],"m":d["v"].toString(),"v":d["v"]};}applyData.push(obj);}return applyData;},FillDays:function FillDays(data,len,step){var applyData=[];for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var date=luckysheet.mask.update("yyyy-MM-dd",d["v"]);date=moment(date).add(step*i,"days").format("YYYY-MM-DD");d["v"]=luckysheet.mask.genarate(date)[2];d["m"]=luckysheet.mask.update(d["ct"]["fa"],d["v"]);applyData.push(d);}return applyData;},FillMonths:function FillMonths(data,len,step){var applyData=[];for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var date=luckysheet.mask.update("yyyy-MM-dd",d["v"]);date=moment(date).add(step*i,"months").format("YYYY-MM-DD");d["v"]=luckysheet.mask.genarate(date)[2];d["m"]=luckysheet.mask.update(d["ct"]["fa"],d["v"]);applyData.push(d);}return applyData;},FillYears:function FillYears(data,len,step){var applyData=[];for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var date=luckysheet.mask.update("yyyy-MM-dd",d["v"]);date=moment(date).add(step*i,"years").format("YYYY-MM-DD");d["v"]=luckysheet.mask.genarate(date)[2];d["m"]=luckysheet.mask.update(d["ct"]["fa"],d["v"]);applyData.push(d);}return applyData;},FillChnWeek:function FillChnWeek(data,len,step){var applyData=[];for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);if(data[data.length-1]["m"]=="日"){var num=7+step*i;}else {var num=luckysheet.dropCell.ChineseToNumber(data[data.length-1]["m"])+step*i;}if(num<0){num=Math.ceil(Math.abs(num)/7)*7+num;}var rsd=num%7;if(rsd==0){d["m"]="日";d["v"]="日";}else if(rsd==1){d["m"]="一";d["v"]="一";}else if(rsd==2){d["m"]="二";d["v"]="二";}else if(rsd==3){d["m"]="三";d["v"]="三";}else if(rsd==4){d["m"]="四";d["v"]="四";}else if(rsd==5){d["m"]="五";d["v"]="五";}else if(rsd==6){d["m"]="六";d["v"]="六";}applyData.push(d);}return applyData;},FillChnWeek2:function FillChnWeek2(data,len,step){var applyData=[];for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);if(data[data.length-1]["m"]=="周日"){var num=7+step*i;}else {var last=data[data.length-1]["m"];var txt=last.substr(last.length-1,1);var num=luckysheet.dropCell.ChineseToNumber(txt)+step*i;}if(num<0){num=Math.ceil(Math.abs(num)/7)*7+num;}var rsd=num%7;if(rsd==0){d["m"]="周日";d["v"]="周日";}else if(rsd==1){d["m"]="周一";d["v"]="周一";}else if(rsd==2){d["m"]="周二";d["v"]="周二";}else if(rsd==3){d["m"]="周三";d["v"]="周三";}else if(rsd==4){d["m"]="周四";d["v"]="周四";}else if(rsd==5){d["m"]="周五";d["v"]="周五";}else if(rsd==6){d["m"]="周六";d["v"]="周六";}applyData.push(d);}return applyData;},FillChnWeek3:function FillChnWeek3(data,len,step){var applyData=[];for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);if(data[data.length-1]["m"]=="星期日"){var num=7+step*i;}else {var last=data[data.length-1]["m"];var txt=last.substr(last.length-1,1);var num=luckysheet.dropCell.ChineseToNumber(txt)+step*i;}if(num<0){num=Math.ceil(Math.abs(num)/7)*7+num;}var rsd=num%7;if(rsd==0){d["m"]="星期日";d["v"]="星期日";}else if(rsd==1){d["m"]="星期一";d["v"]="星期一";}else if(rsd==2){d["m"]="星期二";d["v"]="星期二";}else if(rsd==3){d["m"]="星期三";d["v"]="星期三";}else if(rsd==4){d["m"]="星期四";d["v"]="星期四";}else if(rsd==5){d["m"]="星期五";d["v"]="星期五";}else if(rsd==6){d["m"]="星期六";d["v"]="星期六";}applyData.push(d);}return applyData;},FillChnNumber:function FillChnNumber(data,len,step){var applyData=[];for(var i=1;i<=len;i++){var index=(i-1)%data.length;var d=$.extend(true,{},data[index]);var num=luckysheet.dropCell.ChineseToNumber(data[data.length-1]["m"])+step*i;if(num<=0){var txt="零";}else {var txt=luckysheet.dropCell.NumberToChinese(num);}d["v"]=txt;d["m"]=txt.toString();applyData.push(d);}return applyData;},isEqualDiff:function isEqualDiff(arr){var diff=true;var step=arr[1]-arr[0];for(var i=1;i<arr.length;i++){if(arr[i]-arr[i-1]!=step){diff=false;break;}}return diff;},isEqualRatio:function isEqualRatio(arr){var ratio=true;var step=arr[1]/arr[0];for(var i=1;i<arr.length;i++){if(arr[i]/arr[i-1]!=step){ratio=false;break;}}return ratio;},getXArr:function getXArr(len){var xArr=[];for(var i=1;i<=len;i++){xArr.push(i);}return xArr;},forecast:function forecast(x,yArr,xArr){function getAverage(arr){var sum=0;for(var i=0;i<arr.length;i++){sum+=arr[i];}return sum/arr.length;}var ax=getAverage(xArr);//x数组 平均值
  var ay=getAverage(yArr);//y数组 平均值
  var sum_d=0,sum_n=0;for(var j=0;j<xArr.length;j++){//分母和
  sum_d+=(xArr[j]-ax)*(yArr[j]-ay);//分子和
  sum_n+=(xArr[j]-ax)*(xArr[j]-ax);}if(sum_n==0){var b=1;}else {var b=sum_d/sum_n;}var a=ay-b*ax;return Math.round((a+b*x)*100000)/100000;},judgeDate:function judgeDate(data){var isSameDay=true,isSameMonth=true,isEqualDiffDays=true,isEqualDiffMonths=true,isEqualDiffYears=true;var sameDay=moment(data[0]["m"]).date(),sameMonth=moment(data[0]["m"]).month();var equalDiffDays=moment(data[1]["m"]).diff(moment(data[0]["m"]),"days");var equalDiffMonths=moment(data[1]["m"]).diff(moment(data[0]["m"]),"months");var equalDiffYears=moment(data[1]["m"]).diff(moment(data[0]["m"]),"years");for(var i=1;i<data.length;i++){//日是否一样
  if(moment(data[i]["m"]).date()!=sameDay){isSameDay=false;}//月是否一样
  if(moment(data[i]["m"]).month()!=sameMonth){isSameMonth=false;}//日差是否是 等差数列
  if(moment(data[i]["m"]).diff(moment(data[i-1]["m"]),"days")!=equalDiffDays){isEqualDiffDays=false;}//月差是否是 等差数列
  if(moment(data[i]["m"]).diff(moment(data[i-1]["m"]),"months")!=equalDiffMonths){isEqualDiffMonths=false;}//年差是否是 等差数列
  if(moment(data[i]["m"]).diff(moment(data[i-1]["m"]),"years")!=equalDiffYears){isEqualDiffYears=false;}}if(equalDiffDays==0){isEqualDiffDays=false;}if(equalDiffMonths==0){isEqualDiffMonths=false;}if(equalDiffYears==0){isEqualDiffYears=false;}return [isSameDay,isSameMonth,isEqualDiffDays,isEqualDiffMonths,isEqualDiffYears];}};//定位
  luckysheet.locationCell={createDialog:function createDialog(){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-locationCell-dialog").remove();var content='<div class="listbox">'+'<div class="listItem">'+'<input type="radio" name="locationType" checked="checked" id="locationConstant">'+'<label for="locationConstant">常量</label>'+'<div class="subbox">'+'<div class="subItem">'+'<input type="checkbox" checked="checked" class="date" id="locationConstantDate">'+'<label for="locationConstantDate">日期</label>'+'</div>'+'<div class="subItem">'+'<input type="checkbox" checked="checked" class="number" id="locationConstantNumber">'+'<label for="locationConstantNumber">数字</label>'+'</div>'+'<div class="subItem">'+'<input type="checkbox" checked="checked" class="string" id="locationConstantString">'+'<label for="locationConstantString">字符</label>'+'</div>'+'<div class="subItem">'+'<input type="checkbox" checked="checked" class="boolean" id="locationConstantBoolean">'+'<label for="locationConstantBoolean">逻辑值</label>'+'</div>'+'<div class="subItem">'+'<input type="checkbox" checked="checked" class="error" id="locationConstantError">'+'<label for="locationConstantError">错误</label>'+'</div>'+'</div>'+'</div>'+'<div class="listItem">'+'<input type="radio" name="locationType" id="locationFormula">'+'<label for="locationFormula">公式</label>'+'<div class="subbox">'+'<div class="subItem">'+'<input type="checkbox" checked="checked" class="date" id="locationFormulaDate" disabled="true">'+'<label for="locationFormulaDate" style="color: #666">日期</label>'+'</div>'+'<div class="subItem">'+'<input type="checkbox" checked="checked" class="number" id="locationFormulaNumber" disabled="true">'+'<label for="locationFormulaNumber" style="color: #666">数字</label>'+'</div>'+'<div class="subItem">'+'<input type="checkbox" checked="checked" class="string" id="locationFormulaString" disabled="true">'+'<label for="locationFormulaString" style="color: #666">字符</label>'+'</div>'+'<div class="subItem">'+'<input type="checkbox" checked="checked" class="boolean" id="locationFormulaBoolean" disabled="true">'+'<label for="locationFormulaBoolean" style="color: #666">逻辑值</label>'+'</div>'+'<div class="subItem">'+'<input type="checkbox" checked="checked" class="error" id="locationFormulaError" disabled="true">'+'<label for="locationFormulaError" style="color: #666">错误</label>'+'</div>'+'</div>'+'</div>'+'<div class="listItem">'+'<input type="radio" name="locationType" id="locationNull">'+'<label for="locationNull">空值</label>'+'</div>'+'<div class="listItem">'+'<input type="radio" name="locationType" id="locationCF">'+'<label for="locationCF">条件格式</label>'+'</div>'+'<div class="listItem">'+'<input type="radio" name="locationType" id="locationStepRow">'+'<label for="locationStepRow">间隔行</label>'+'</div>'+'<div class="listItem">'+'<input type="radio" name="locationType" id="locationStepColumn">'+'<label for="locationStepColumn">间隔列</label>'+'</div>'+'</div>';$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-locationCell-dialog","addclass":"luckysheet-locationCell-dialog","title":"定位条件","content":content,"botton":'<button id="luckysheet-locationCell-dialog-confirm" class="btn btn-primary">确定</button><button class="btn btn-default luckysheet-model-close-btn">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-locationCell-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-locationCell-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();},init:function init(){$(document).on("click","#luckysheet-locationCell-dialog .listItem input:radio",function(e){$("#luckysheet-locationCell-dialog .listItem input:checkbox").prop("disabled",true);$("#luckysheet-locationCell-dialog .listItem .subbox label").css("color","#666");$(this).siblings(".subbox").find("input:checkbox").removeAttr("disabled");$(this).siblings(".subbox").find("label").css("color","#000");});$(document).off("click.locationCellConfirm").on("click.locationCellConfirm","#luckysheet-locationCell-dialog #luckysheet-locationCell-dialog-confirm",function(){$("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-locationCell-dialog").hide();var $radio=$("#luckysheet-locationCell-dialog .listItem input:radio:checked");var id=$radio.attr("id");if(id=="locationConstant"||id=="locationFormula"){var $checkbox=$radio.siblings(".subbox").find("input:checkbox:checked");if($checkbox.length==0){return;}else if($checkbox.length==5){var value="all";}else {var arr=[];for(var i=0;i<$checkbox.length;i++){if($($checkbox[i]).hasClass("date")){arr.push("d");}else if($($checkbox[i]).hasClass("number")){arr.push("n");}else if($($checkbox[i]).hasClass("string")){arr.push("s,g");}else if($($checkbox[i]).hasClass("boolean")){arr.push("b");}else if($($checkbox[i]).hasClass("error")){arr.push("e");}}var value=arr.join(",");}if(luckysheet_select_save.length==0||luckysheet_select_save.length==1&&luckysheet_select_save[0].row[0]==luckysheet_select_save[0].row[1]&&luckysheet_select_save[0].column[0]==luckysheet_select_save[0].column[1]){//单个单元格
  var range=[{"row":[0,luckysheet.flowdata.length-1],"column":[0,luckysheet.flowdata[0].length-1]}];}else {var range=$.extend(true,[],luckysheet_select_save);}luckysheet.locationCell.apply(range,id,value);}else if(id=="locationStepRow"){if(luckysheet_select_save.length==0||luckysheet_select_save.length==1&&luckysheet_select_save[0].row[0]==luckysheet_select_save[0].row[1]){if(luckysheet.isEditMode()){alert("请选择最少两行");}else {luckysheet.tooltip.info("提示","请选择最少两行");}return;}var range=$.extend(true,[],luckysheet_select_save);luckysheet.locationCell.apply(range,"locationStepRow");}else if(id=="locationStepColumn"){if(luckysheet_select_save.length==0||luckysheet_select_save.length==1&&luckysheet_select_save[0].column[0]==luckysheet_select_save[0].column[1]){if(luckysheet.isEditMode()){alert("请选择最少两列");}else {luckysheet.tooltip.info("提示","请选择最少两列");}return;}var range=$.extend(true,[],luckysheet_select_save);luckysheet.locationCell.apply(range,"locationStepColumn");}else {if(luckysheet_select_save.length==0||luckysheet_select_save.length==1&&luckysheet_select_save[0].row[0]==luckysheet_select_save[0].row[1]&&luckysheet_select_save[0].column[0]==luckysheet_select_save[0].column[1]){//单个单元格
  var range=[{"row":[0,luckysheet.flowdata.length-1],"column":[0,luckysheet.flowdata[0].length-1]}];}else {var range=$.extend(true,[],luckysheet_select_save);}luckysheet.locationCell.apply(range,id);}});},apply:function apply(range,type,value){var rangeArr=[];if(type=="locationFormula"||type=="locationConstant"||type=="locationNull"||type=="locationCF"){if(type=="locationFormula"){//公式
  if(value=="all"){var str="luckysheet.flowdata[r] != null && luckysheet.flowdata[r][c] != null && luckysheet.flowdata[r][c].v != null && luckysheet.flowdata[r][c].f != null";}else {var str="luckysheet.flowdata[r] != null && luckysheet.flowdata[r][c] != null && luckysheet.flowdata[r][c].v != null && luckysheet.flowdata[r][c].f != null && luckysheet.flowdata[r][c].ct != null && value.indexOf(luckysheet.flowdata[r][c].ct.t) != -1";}}else if(type=="locationConstant"){//常量
  if(value=="all"){var str="luckysheet.flowdata[r] != null && luckysheet.flowdata[r][c] != null && luckysheet.flowdata[r][c].v != null && luckysheet.flowdata[r][c].f == null && luckysheet.flowdata[r][c].ct != null";}else {var str="luckysheet.flowdata[r] != null && luckysheet.flowdata[r][c] != null && luckysheet.flowdata[r][c].v != null && luckysheet.flowdata[r][c].f == null && luckysheet.flowdata[r][c].ct != null && value.indexOf(luckysheet.flowdata[r][c].ct.t) != -1";}}else if(type=="locationNull"){//空值
  var str="luckysheet.flowdata[r] != null && (luckysheet.flowdata[r][c] == null || luckysheet.flowdata[r][c].v == null || luckysheet.flowdata[r][c].v == '') ";}else if(type=="locationCF"){//条件格式
  var index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);var ruleArr=luckysheetfile[index]["luckysheet_conditionformat_save"];var data=luckysheetfile[index]["data"];var computeMap=luckysheet.conditionformat.compute(ruleArr,data);if(JSON.stringify(computeMap)=="{}"){if(luckysheet.isEditMode()){alert("未找到单元格");}else {luckysheet.tooltip.info("提示","未找到单元格");}return;}var str="(r + '_' + c) in computeMap";}for(var s=0;s<range.length;s++){var st_r=range[s].row[0],ed_r=range[s].row[1];var st_c=range[s].column[0],ed_c=range[s].column[1];if(st_r==ed_r){var stack_stc=null,stack_edc=null;var r=st_r;for(var c=st_c;c<=ed_c;c++){if(c==st_c){if(eval(str)){stack_stc=c;}else {stack_stc=null;}}else if(c==ed_c){if(eval(str)){if(stack_stc==null){rangeArr.push({"row":[st_r,ed_r],"column":[ed_c,ed_c]});}else {rangeArr.push({"row":[st_r,ed_r],"column":[stack_stc,ed_c]});}}else {if(stack_edc==null&&stack_stc!=null){rangeArr.push({"row":[st_r,ed_r],"column":[stack_stc,stack_stc]});}else if(stack_edc!=null){rangeArr.push({"row":[st_r,ed_r],"column":[stack_stc,stack_edc]});}}}else {if(eval(str)){if(stack_stc==null){stack_stc=c;}else {stack_edc=c;}}else {if(stack_edc==null&&stack_stc!=null){rangeArr.push({"row":[st_r,ed_r],"column":[stack_stc,stack_stc]});stack_stc=null;}else if(stack_edc!=null){rangeArr.push({"row":[st_r,ed_r],"column":[stack_stc,stack_edc]});stack_stc=null;stack_edc=null;}}}}}else {var stack={};for(var r=st_r;r<=ed_r;r++){stack[r]=[];var stack_stc=null,stack_edc=null;for(var c=st_c;c<=ed_c;c++){if(c==ed_c){if(eval(str)){if(stack_stc==null){stack[r].push({"status":false,"range":[ed_c,ed_c]});}else {stack[r].push({"status":false,"range":[stack_stc,ed_c]});}}else {if(stack_edc==null&&stack_stc!=null){stack[r].push({"status":false,"range":[stack_stc,stack_stc]});}else if(stack_edc!=null){stack[r].push({"status":false,"range":[stack_stc,stack_edc]});}}}else if(c==st_c){if(eval(str)){stack_stc=c;}else {stack_stc=null;}}else {if(eval(str)){if(stack_stc==null){stack_stc=c;}else {stack_edc=c;}}else {if(stack_edc==null&&stack_stc!=null){stack[r].push({"status":false,"range":[stack_stc,stack_stc]});stack_stc=null;}else if(stack_edc!=null){stack[r].push({"status":false,"range":[stack_stc,stack_edc]});stack_stc=null;stack_edc=null;}}}}}for(var i=st_r;i<=ed_r;i++){if(i==ed_r){if(stack[i].length>0){for(var j=0;j<stack[i].length;j++){if(!stack[i][j].status){rangeArr.push({"row":[ed_r,ed_r],"column":stack[i][j].range});}}}}else {if(stack[i].length>0){for(var j=0;j<stack[i].length;j++){if(!stack[i][j].status){var b=0;for(var a=1;a<ed_r-i;a++){if(stack[i+a][j]!=null&&stack[i+a][j].range[0]==stack[i][j].range[0]&&stack[i+a][j].range[1]==stack[i][j].range[1]){b=a;stack[i+a][j].status=true;}else {break;}}rangeArr.push({"row":[i,i+b],"column":stack[i][j].range});}}}}}}}}else if(type=="locationStepRow"){//间隔行
  for(var s=0;s<range.length;s++){if(range[s].row[0]==range[s].row[1]){continue;}var st_r=range[s].row[0],ed_r=range[s].row[1];var st_c=range[s].column[0],ed_c=range[s].column[1];for(var r=st_r;r<=ed_r;r++){if((r-st_r)%2==0){rangeArr.push({"row":[r,r],"column":[st_c,ed_c]});}}}}else if(type=="locationStepColumn"){//间隔列
  for(var s=0;s<range.length;s++){if(range[s].column[0]==range[s].column[1]){continue;}var st_r=range[s].row[0],ed_r=range[s].row[1];var st_c=range[s].column[0],ed_c=range[s].column[1];for(var c=st_c;c<=ed_c;c++){if((c-st_c)%2==0){rangeArr.push({"row":[st_r,ed_r],"column":[c,c]});}}}}if(rangeArr.length==0){if(luckysheet.isEditMode()){alert("未找到单元格");}else {luckysheet.tooltip.info("提示","未找到单元格");}}else {luckysheet_select_save=rangeArr;luckysheet.selectHightlightShow();var scrollLeft=$("#luckysheet-cell-main").scrollLeft(),scrollTop=$("#luckysheet-cell-main").scrollTop();var winH=$("#luckysheet-cell-main").height(),winW=$("#luckysheet-cell-main").width();var row=visibledatarow[luckysheet_select_save[0]["row"][1]],row_pre=luckysheet_select_save[0]["row"][0]-1==-1?0:visibledatarow[luckysheet_select_save[0]["row"][0]-1];var col=visibledatacolumn[luckysheet_select_save[0]["column"][1]],col_pre=luckysheet_select_save[0]["column"][0]-1==-1?0:visibledatacolumn[luckysheet_select_save[0]["column"][0]-1];if(col-scrollLeft-winW+20>0){$("#luckysheet-scrollbar-x").scrollLeft(col-winW+20);}else if(col_pre-scrollLeft-20<0){$("#luckysheet-scrollbar-x").scrollLeft(col_pre-20);}if(row-scrollTop-winH+20>0){$("#luckysheet-scrollbar-y").scrollTop(row-winH+20);}else if(row_pre-scrollTop-20<0){$("#luckysheet-scrollbar-y").scrollTop(row_pre-20);}}}};//更多格式
  luckysheet.moreFormat={moneyFmtList:[{"name":"人民币","pos":"before","value":"¥"},{"name":"美元","pos":"before","value":"$"},{"name":"欧元","pos":"before","value":"€"},{"name":"英镑","pos":"before","value":"￡"},{"name":"港元","pos":"before","value":"$"},{"name":"日元","pos":"before","value":"￥"},{"name":"阿尔巴尼亚列克","pos":"before","value":"Lek"},{"name":"阿尔及利亚第纳尔","pos":"before","value":"din"},{"name":"阿富汗尼","pos":"after","value":"Af"},{"name":"阿根廷比索","pos":"before","value":"$"},{"name":"阿拉伯联合酋长国迪拉姆","pos":"before","value":"dh"},{"name":"阿鲁巴弗罗林","pos":"before","value":"Afl"},{"name":"阿曼里亚尔","pos":"before","value":"Rial"},{"name":"阿塞拜疆马纳特","pos":"before","value":"?"},{"name":"埃及镑","pos":"before","value":"￡"},{"name":"埃塞俄比亚比尔","pos":"before","value":"Birr"},{"name":"安哥拉宽扎","pos":"before","value":"Kz"},{"name":"澳大利亚元","pos":"before","value":"$"},{"name":"澳门元","pos":"before","value":"MOP"},{"name":"巴巴多斯元","pos":"before","value":"$"},{"name":"巴布亚新几内亚基那","pos":"before","value":"PGK"},{"name":"巴哈马元","pos":"before","value":"$"},{"name":"巴基斯坦卢比","pos":"before","value":"Rs"},{"name":"巴拉圭瓜拉尼","pos":"after","value":"Gs"},{"name":"巴林第纳尔","pos":"before","value":"din"},{"name":"巴拿马巴波亚","pos":"before","value":"B/"},{"name":"巴西里亚伊","pos":"before","value":"R$"},{"name":"白俄罗斯卢布","pos":"after","value":"р"},{"name":"百慕大元","pos":"before","value":"$"},{"name":"保加利亚列弗","pos":"before","value":"lev"},{"name":"冰岛克朗","pos":"before","value":"kr"},{"name":"波黑可兑换马克","pos":"before","value":"KM"},{"name":"波兰兹罗提","pos":"after","value":"z?"},{"name":"玻利维亚诺","pos":"before","value":"Bs"},{"name":"伯利兹元","pos":"before","value":"$"},{"name":"博茨瓦纳普拉","pos":"before","value":"P"},{"name":"不丹努扎姆","pos":"before","value":"Nu"},{"name":"布隆迪法郎","pos":"before","value":"FBu"},{"name":"朝鲜圆","pos":"before","value":"?KP"},{"name":"丹麦克朗","pos":"after","value":"kr"},{"name":"东加勒比元","pos":"before","value":"$"},{"name":"多米尼加比索","pos":"before","value":"RD$"},{"name":"俄国卢布","pos":"after","value":"?"},{"name":"厄立特里亚纳克法","pos":"before","value":"Nfk"},{"name":"非洲金融共同体法郎","pos":"before","value":"CFA"},{"name":"菲律宾比索","pos":"before","value":"?"},{"name":"斐济元","pos":"before","value":"$"},{"name":"佛得角埃斯库多","pos":"before","value":"CVE"},{"name":"福克兰群岛镑","pos":"before","value":"￡"},{"name":"冈比亚达拉西","pos":"before","value":"GMD"},{"name":"刚果法郎","pos":"before","value":"FrCD"},{"name":"哥伦比亚比索","pos":"before","value":"$"},{"name":"哥斯达黎加科朗","pos":"before","value":"?"},{"name":"古巴比索","pos":"before","value":"$"},{"name":"古巴可兑换比索","pos":"before","value":"$"},{"name":"圭亚那元","pos":"before","value":"$"},{"name":"哈萨克斯坦坚戈","pos":"before","value":"?"},{"name":"海地古德","pos":"before","value":"HTG"},{"name":"韩元","pos":"before","value":"?"},{"name":"荷属安的列斯盾","pos":"before","value":"NAf."},{"name":"洪都拉斯拉伦皮拉","pos":"before","value":"L"},{"name":"吉布提法郎","pos":"before","value":"Fdj"},{"name":"吉尔吉斯斯坦索姆","pos":"before","value":"KGS"},{"name":"几内亚法郎","pos":"before","value":"FG"},{"name":"加拿大元","pos":"before","value":"$"},{"name":"加纳塞地","pos":"before","value":"GHS"},{"name":"柬埔寨瑞尔","pos":"before","value":"Riel"},{"name":"捷克克朗","pos":"after","value":"K?"},{"name":"津巴布韦元","pos":"before","value":"$"},{"name":"卡塔尔里亚尔","pos":"before","value":"Rial"},{"name":"开曼群岛元","pos":"before","value":"$"},{"name":"科摩罗法郎","pos":"before","value":"CF"},{"name":"科威特第纳尔","pos":"before","value":"din"},{"name":"克罗地亚库纳","pos":"before","value":"kn"},{"name":"肯尼亚先令","pos":"before","value":"Ksh"},{"name":"莱索托洛蒂","pos":"before","value":"LSL"},{"name":"老挝基普","pos":"before","value":"?"},{"name":"黎巴嫩镑","pos":"before","value":"L￡"},{"name":"立陶宛立特","pos":"before","value":"Lt"},{"name":"利比亚第纳尔","pos":"before","value":"din"},{"name":"利比亚元","pos":"before","value":"$"},{"name":"卢旺达法郎","pos":"before","value":"RF"},{"name":"罗马尼亚列伊","pos":"before","value":"RON"},{"name":"马达加斯加阿里亚里","pos":"before","value":"Ar"},{"name":"马尔代夫拉菲亚","pos":"before","value":"Rf"},{"name":"马拉维克瓦查","pos":"before","value":"MWK"},{"name":"马来西亚林吉特","pos":"before","value":"RM"},{"name":"马其顿戴第纳尔","pos":"before","value":"din"},{"name":"毛里求斯卢比","pos":"before","value":"MURs"},{"name":"毛里塔尼亚乌吉亚","pos":"before","value":"MRO"},{"name":"蒙古图格里克","pos":"before","value":"?"},{"name":"孟加拉塔卡","pos":"before","value":"?"},{"name":"秘鲁新索尔","pos":"before","value":"S/"},{"name":"缅甸开亚特","pos":"before","value":"K"},{"name":"摩尔多瓦列伊","pos":"before","value":"MDL"},{"name":"摩洛哥迪拉姆","pos":"before","value":"dh"},{"name":"莫桑比克梅蒂卡尔","pos":"before","value":"MTn"},{"name":"墨西哥比索","pos":"before","value":"$"},{"name":"纳米比亚元","pos":"before","value":"$"},{"name":"南非兰特","pos":"before","value":"R"},{"name":"南苏丹镑","pos":"before","value":"￡"},{"name":"尼加拉瓜科多巴","pos":"before","value":"C$"},{"name":"尼泊尔卢比","pos":"before","value":"Rs"},{"name":"尼日利亚奈拉","pos":"before","value":"?"},{"name":"挪威克朗","pos":"after","value":"kr"},{"name":"乔治亚拉瑞","pos":"before","value":"GEL"},{"name":"人民币（离岸）","pos":"before","value":"￥"},{"name":"瑞典克朗","pos":"after","value":"kr"},{"name":"瑞士法郎","pos":"before","value":"CHF"},{"name":"塞尔维亚第纳尔","pos":"before","value":"din"},{"name":"塞拉利昂利昂","pos":"before","value":"SLL"},{"name":"塞舌尔卢比","pos":"before","value":"SCR"},{"name":"沙特里亚尔","pos":"before","value":"Rial"},{"name":"圣多美多布拉","pos":"before","value":"Db"},{"name":"圣赫勒拿群岛磅","pos":"before","value":"￡"},{"name":"斯里兰卡卢比","pos":"before","value":"Rs"},{"name":"斯威士兰里兰吉尼","pos":"before","value":"SZL"},{"name":"苏丹镑","pos":"before","value":"SDG"},{"name":"苏里南元","pos":"before","value":"$"},{"name":"所罗门群岛元","pos":"before","value":"$"},{"name":"索马里先令","pos":"before","value":"SOS"},{"name":"塔吉克斯坦索莫尼","pos":"before","value":"Som"},{"name":"太平洋法郎","pos":"after","value":"FCFP"},{"name":"泰国铢","pos":"before","value":"?"},{"name":"坦桑尼亚先令","pos":"before","value":"TSh"},{"name":"汤加潘加","pos":"before","value":"T$"},{"name":"特立尼达和多巴哥元","pos":"before","value":"$"},{"name":"突尼斯第纳尔","pos":"before","value":"din"},{"name":"土耳其里拉","pos":"before","value":"?"},{"name":"瓦努阿图瓦图","pos":"before","value":"VUV"},{"name":"危地马拉格查尔","pos":"before","value":"Q"},{"name":"委内瑞拉博利瓦","pos":"before","value":"Bs"},{"name":"文莱元","pos":"before","value":"$"},{"name":"乌干达先令","pos":"before","value":"UGX"},{"name":"乌克兰格里夫尼亚","pos":"before","value":"грн."},{"name":"乌拉圭比索","pos":"before","value":"$"},{"name":"乌兹别克斯坦苏姆","pos":"before","value":"so?m"},{"name":"西萨摩亚塔拉","pos":"before","value":"WST"},{"name":"新加坡元","pos":"before","value":"$"},{"name":"新台币","pos":"before","value":"NT$"},{"name":"新西兰元","pos":"before","value":"$"},{"name":"匈牙利福林","pos":"before","value":"Ft"},{"name":"叙利亚镑","pos":"before","value":"￡"},{"name":"牙买加元","pos":"before","value":"$"},{"name":"亚美尼亚德拉姆","pos":"before","value":"Dram"},{"name":"也门里亚尔","pos":"before","value":"Rial"},{"name":"伊拉克第纳尔","pos":"before","value":"din"},{"name":"伊朗里亚尔","pos":"before","value":"Rial"},{"name":"以色列新谢克尔","pos":"before","value":"?"},{"name":"印度卢比","pos":"before","value":"?"},{"name":"印度尼西亚卢比","pos":"before","value":"Rp"},{"name":"约旦第纳尔","pos":"before","value":"din"},{"name":"越南盾","pos":"after","value":"?"},{"name":"赞比亚克瓦查","pos":"before","value":"ZMW"},{"name":"直布罗陀镑","pos":"before","value":"￡"},{"name":"智利比索","pos":"before","value":"$"},{"name":"中非金融合作法郎","pos":"before","value":"FCFA"}],dateFmtList:[{"name":"1930-08-05","value":"yyyy-MM-dd"},{"name":"1930/8/5","value":"yyyy/MM/dd"},{"name":"1930年8月5日","value":'yyyy"年"M"月"d"日"'},{"name":"08-05","value":"MM-dd"},{"name":"8-5","value":"M-d"},{"name":"8月5日","value":'M"月"d"日"'},{"name":"13:30:30","value":"h:mm:ss"},{"name":"13:30","value":"h:mm"},{"name":"下午01:30","value":'AM/PM hh:mm'},{"name":"下午1:30","value":'AM/PM h:mm'},{"name":"下午1:30:30","value":'AM/PM h:mm:ss'},{"name":"08-05 下午01:30","value":"MM-dd AM/PM hh:mm"}// {
  //     "name": "1930年8月5日星期二",
  //     "value": ''
  // },
  // {
  //     "name": "1930年8月5日星期二 下午1:30:30",
  //     "value": ''
  // },
  ],numFmtList:[{"name":"1235","value":"0"},{"name":"1234.56","value":"0.00"},{"name":"1,235","value":"#,##0"},{"name":"1,234.56","value":"#,##0.00"},{"name":"1,235","value":"#,##0_);(#,##0)"},{"name":"1,235","value":"#,##0_);[Red](#,##0)"},{"name":"1,234.56","value":"#,##0.00_);(#,##0.00)"},{"name":"1,234.56","value":"#,##0.00_);[Red](#,##0.00)"},{"name":"$1,235","value":"$#,##0_);($#,##0)"},{"name":"$1,235","value":"$#,##0_);[Red]($#,##0)"},{"name":"$1,234.56","value":"$#,##0.00_);($#,##0.00)"},{"name":"$1,234.56","value":"$#,##0.00_);[Red]($#,##0.00)"},{"name":"1234.56","value":"@"},{"name":"123456%","value":"0%"},{"name":"123456.00%","value":"0.00%"},{"name":"1.23E+03","value":"0.00E+00"},{"name":"1.2E+3","value":"##0.0E+0"},{"name":"1234 5/9","value":"# ?/?"},{"name":"1234 14/25","value":"# ??/??"},{"name":"$ 1,235","value":'_($* #,##0_);_(...($* "-"_);_(@_)'},{"name":"1,235","value":'_(* #,##0_);_(*..._(* "-"_);_(@_)'},{"name":"$ 1,234.56",// "value": '_($* #,##0.00_)...* "-"??_);_(@_)'
  "value":'_($* #,##0.00_);_(...($* "-"_);_(@_)'},{"name":"1,234.56","value":'_(* #,##0.00_);...* "-"??_);_(@_)'}],createDialog:function createDialog(type){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-moreFormat-dialog").remove();var title="",content='';if(type=="morecurrency"){//货币
  title="货币格式";var listHtml='';for(var i=0;i<luckysheet.moreFormat.moneyFmtList.length;i++){var name=luckysheet.moreFormat.moneyFmtList[i]["name"];var pos=luckysheet.moreFormat.moneyFmtList[i]["pos"];var value=luckysheet.moreFormat.moneyFmtList[i]["value"];listHtml+='<div class="listItem">'+'<div class="name">'+name+'</div>'+'<div class="value">'+value+'</div>'+'<input type="hidden" value="'+pos+'"/>'+'</div>';}content='<div class="box" id="morecurrency">'+'<div class="decimal">'+'<label>小数位数：</label>'+'<input type="number" class="formulaInputFocus" value="2" min="0" max="9"/>'+'</div>'+'<div class="listbox">'+listHtml+'</div>'+'</div>';}else if(type=="moredatetime"){//日期时间
  title="日期与时间格式";var listHtml='';for(var i=0;i<luckysheet.moreFormat.dateFmtList.length;i++){var name=luckysheet.moreFormat.dateFmtList[i]["name"];var value=luckysheet.moreFormat.dateFmtList[i]["value"];listHtml+='<div class="listItem">'+'<div class="name">'+name+'</div>'+'<div class="value">'+value+'</div>'+'</div>';}content='<div class="box" id="moredatetime">'+'<div class="listbox">'+listHtml+'</div>'+'</div>';}else if(type=="moredigit"){//数字
  title="数字格式";var listHtml='';for(var i=0;i<luckysheet.moreFormat.numFmtList.length;i++){var name=luckysheet.moreFormat.numFmtList[i]["name"];var value=luckysheet.moreFormat.numFmtList[i]["value"];listHtml+='<div class="listItem">'+'<div class="name">'+name+'</div>'+'<div class="value">'+value+'</div>'+'</div>';}content='<div class="box" id="moredigit">'+'<div class="listbox">'+listHtml+'</div>'+'</div>';}$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-moreFormat-dialog","addclass":"luckysheet-moreFormat-dialog","title":title,"content":content,"botton":'<button id="luckysheet-moreFormat-dialog-confirm" class="btn btn-primary">确定</button><button class="btn btn-default luckysheet-model-close-btn">取消</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-moreFormat-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-moreFormat-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();$("#luckysheet-moreFormat-dialog .listbox .listItem").eq(0).addClass("on");},init:function init(){//选择格式
  $(document).on("click","#luckysheet-moreFormat-dialog .listbox .listItem",function(){$(this).addClass("on").siblings().removeClass("on");});//确定
  $(document).off("click.moreFormatConfirm").on("click.moreFormatConfirm","#luckysheet-moreFormat-dialog #luckysheet-moreFormat-dialog-confirm",function(){$("#luckysheet-moreFormat-dialog").hide();$("#luckysheet-modal-dialog-mask").hide();var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var value=$("#luckysheet-moreFormat-dialog .listbox .listItem.on .value").text();var id=$(this).parents("#luckysheet-moreFormat-dialog").find(".box").attr("id");if(id=="morecurrency"){//货币
  if(value.indexOf("?")!=-1){return;}var decimal=parseInt($("#luckysheet-moreFormat-dialog .decimal input").val().trim());if(decimal.toString()=="NaN"||decimal<0||decimal>9){if(luckysheet.isEditMode()){alert("小数位数必须在0-9之间！");}else {luckysheet.tooltip.info("小数位数必须在0-9之间！","");}return;}var str="";if(decimal>0){for(var i=1;i<=decimal;i++){str+="0";}str="0."+str;}else {str="#";}var pos=$("#luckysheet-moreFormat-dialog .listbox .listItem.on input:hidden").val();if(pos=="before"){str='"'+value+'" '+str;}else if(pos=="after"){str=str+' "'+value+'"';}luckysheet.menuButton.updateFormat(d,"ct",str);}else if(id=="moredatetime"){//日期时间
  luckysheet.menuButton.updateFormat(d,"ct",value);}else if(id=="moredigit"){//数字
  luckysheet.menuButton.updateFormat(d,"ct",value);}});}};//查找替换
  luckysheet.searchReplace={createDialog:function createDialog(source){$("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-search-replace").remove();var content='<div class="tabBox">'+'<span id="searchTab">查找</span>'+'<span id="replaceTab">替换</span>'+'</div>'+'<div class="ctBox">'+'<div class="inputBox">'+'<div class="textboxs" id="searchInput">查找内容：<input class="formulaInputFocus" spellcheck="false" value=""/></div>'+'<div class="textboxs" id="replaceInput">替换内容：<input class="formulaInputFocus" spellcheck="false" value=""/></div>'+'<div class="checkboxs">'+'<div id="regCheck">'+'<input type="checkbox"/>'+'<span>正则表达式匹配</span>'+'</div>'+'<div id="wordCheck">'+'<input type="checkbox"/>'+'<span>整词匹配</span>'+'</div>'+'<div id="caseCheck">'+'<input type="checkbox"/>'+'<span>区分大小写匹配</span>'+'</div>'+'</div>'+'</div>'+'<div class="btnBox">'+'<button id="replaceAllBtn" class="btn btn-default">全部替换</button>'+'<button id="replaceBtn" class="btn btn-default">替换</button>'+'<button id="searchAllBtn" class="btn btn-default">查找全部</button>'+'<button id="searchNextBtn" class="btn btn-default">查找下一个</button>'+'</div>'+'</div>';$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-search-replace","addclass":"luckysheet-search-replace","title":"","content":content,"botton":'<button class="btn btn-default luckysheet-model-close-btn">关闭</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-search-replace").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-search-replace").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();if(source=="0"){$("#luckysheet-search-replace #searchTab").addClass("on").siblings().removeClass("on");$("#luckysheet-search-replace #replaceInput").hide();$("#luckysheet-search-replace #replaceAllBtn").hide();$("#luckysheet-search-replace #replaceBtn").hide();}else if(source=="1"){$("#luckysheet-search-replace #replaceTab").addClass("on").siblings().removeClass("on");$("#luckysheet-search-replace #replaceInput").show();$("#luckysheet-search-replace #replaceAllBtn").show();$("#luckysheet-search-replace #replaceBtn").show();}},init:function init(){//查找替换 切换
  $(document).off("click.SRtabBoxspan").on("click.SRtabBoxspan","#luckysheet-search-replace .tabBox span",function(){$(this).addClass("on").siblings().removeClass("on");var $id=$(this).attr("id");if($id=="searchTab"){$("#luckysheet-search-replace #replaceInput").hide();$("#luckysheet-search-replace #replaceAllBtn").hide();$("#luckysheet-search-replace #replaceBtn").hide();$("#luckysheet-search-replace #searchInput input").focus();}else if($id=="replaceTab"){$("#luckysheet-search-replace #replaceInput").show();$("#luckysheet-search-replace #replaceAllBtn").show();$("#luckysheet-search-replace #replaceBtn").show();$("#luckysheet-search-replace #replaceInput input").focus();}});//查找下一个
  $(document).off("keyup.SRsearchInput").on("keyup.SRsearchInput","#luckysheet-search-replace #searchInput input",function(event){var kcode=event.keyCode;if(kcode==keycode.ENTER){luckysheet.searchReplace.searchNext();}});$(document).off("click.SRsearchNextBtn").on("click.SRsearchNextBtn","#luckysheet-search-replace #searchNextBtn",function(){luckysheet.searchReplace.searchNext();});//查找全部
  $(document).off("click.SRsearchAllBtn").on("click.SRsearchAllBtn","#luckysheet-search-replace #searchAllBtn",function(){luckysheet.searchReplace.searchAll();});$(document).off("click.SRsearchAllboxItem").on("click.SRsearchAllboxItem","#luckysheet-search-replace #searchAllbox .boxItem",function(){$(this).addClass("on").siblings().removeClass("on");var r=$(this).attr("data-row");var c=$(this).attr("data-col");var sheetIndex=$(this).attr("data-sheetIndex");if(sheetIndex!=luckysheet.currentSheetIndex){luckysheet.sheetmanage.changeSheetExec(sheetIndex);}luckysheet_select_save=[{"row":[r,r],"column":[c,c]}];luckysheet.selectHightlightShow();var scrollLeft=$("#luckysheet-cell-main").scrollLeft(),scrollTop=$("#luckysheet-cell-main").scrollTop();var winH=$("#luckysheet-cell-main").height(),winW=$("#luckysheet-cell-main").width();var row=visibledatarow[r],row_pre=r-1==-1?0:visibledatarow[r-1];var col=visibledatacolumn[c],col_pre=c-1==-1?0:visibledatacolumn[c-1];if(col-scrollLeft-winW+20>0){$("#luckysheet-scrollbar-x").scrollLeft(col-winW+20);}else if(col_pre-scrollLeft-20<0){$("#luckysheet-scrollbar-x").scrollLeft(col_pre-20);}if(row-scrollTop-winH+20>0){$("#luckysheet-scrollbar-y").scrollTop(row-winH+20);}else if(row_pre-scrollTop-20<0){$("#luckysheet-scrollbar-y").scrollTop(row_pre-20);}});//替换
  $(document).off("click.SRreplaceBtn").on("click.SRreplaceBtn","#luckysheet-search-replace #replaceBtn",function(){luckysheet.searchReplace.replace();});//全部替换
  $(document).off("click.SRreplaceAllBtn").on("click.SRreplaceAllBtn","#luckysheet-search-replace #replaceAllBtn",function(){luckysheet.searchReplace.replaceAll();});},searchNext:function searchNext(){var searchText=$("#luckysheet-search-replace #searchInput input").val();if(searchText==""||searchText==null){return;}if(luckysheet_select_save.length==0||luckysheet_select_save.length==1&&luckysheet_select_save[0].row[0]==luckysheet_select_save[0].row[1]&&luckysheet_select_save[0].column[0]==luckysheet_select_save[0].column[1]){var range=[{"row":[0,luckysheet.flowdata.length-1],"column":[0,luckysheet.flowdata[0].length-1]}];}else {var range=$.extend(true,[],luckysheet_select_save);}var searchIndexArr=luckysheet.searchReplace.getSearchIndexArr(searchText,range);if(searchIndexArr.length==0){if(luckysheet.isEditMode()){alert("没有查找到该内容");}else {luckysheet.tooltip.info("没有查找到该内容","");}return;}var count=0;if(luckysheet_select_save.length==0||luckysheet_select_save.length==1&&luckysheet_select_save[0].row[0]==luckysheet_select_save[0].row[1]&&luckysheet_select_save[0].column[0]==luckysheet_select_save[0].column[1]){if(luckysheet_select_save.length==0){count=0;}else {for(var i=0;i<searchIndexArr.length;i++){if(searchIndexArr[i].r==luckysheet_select_save[0].row[0]&&searchIndexArr[i].c==luckysheet_select_save[0].column[0]){if(i==searchIndexArr.length-1){count=0;}else {count=i+1;}break;}}}luckysheet_select_save=[{"row":[searchIndexArr[count].r,searchIndexArr[count].r],"column":[searchIndexArr[count].c,searchIndexArr[count].c]}];}else {var rf=range[range.length-1].row_focus;var cf=range[range.length-1].column_focus;for(var i=0;i<searchIndexArr.length;i++){if(searchIndexArr[i].r==rf&&searchIndexArr[i].c==cf){if(i==searchIndexArr.length-1){count=0;}else {count=i+1;}break;}}for(var s=0;s<range.length;s++){var r1=range[s].row[0],r2=range[s].row[1];var c1=range[s].column[0],c2=range[s].column[1];if(searchIndexArr[count].r>=r1&&searchIndexArr[count].r<=r2&&searchIndexArr[count].c>=c1&&searchIndexArr[count].c<=c2){var obj=range[s];obj["row_focus"]=searchIndexArr[count].r;obj["column_focus"]=searchIndexArr[count].c;range.splice(s,1);range.push(obj);break;}}luckysheet_select_save=range;}luckysheet.selectHightlightShow();var scrollLeft=$("#luckysheet-cell-main").scrollLeft(),scrollTop=$("#luckysheet-cell-main").scrollTop();var winH=$("#luckysheet-cell-main").height(),winW=$("#luckysheet-cell-main").width();var row=visibledatarow[searchIndexArr[count].r],row_pre=searchIndexArr[count].r-1==-1?0:visibledatarow[searchIndexArr[count].r-1];var col=visibledatacolumn[searchIndexArr[count].c],col_pre=searchIndexArr[count].c-1==-1?0:visibledatacolumn[searchIndexArr[count].c-1];if(col-scrollLeft-winW+20>0){$("#luckysheet-scrollbar-x").scrollLeft(col-winW+20);}else if(col_pre-scrollLeft-20<0){$("#luckysheet-scrollbar-x").scrollLeft(col_pre-20);}if(row-scrollTop-winH+20>0){$("#luckysheet-scrollbar-y").scrollTop(row-winH+20);}else if(row_pre-scrollTop-20<0){$("#luckysheet-scrollbar-y").scrollTop(row_pre-20);}if($("#searchAllbox").is(":visible")){$("#luckysheet-search-replace #searchAllbox .boxItem").removeClass("on");}},searchAll:function searchAll(){$("#luckysheet-search-replace #searchAllbox").remove();var searchText=$("#luckysheet-search-replace #searchInput input").val();if(searchText==""||searchText==null){return;}if(luckysheet_select_save.length==0||luckysheet_select_save.length==1&&luckysheet_select_save[0].row[0]==luckysheet_select_save[0].row[1]&&luckysheet_select_save[0].column[0]==luckysheet_select_save[0].column[1]){var range=[{"row":[0,luckysheet.flowdata.length-1],"column":[0,luckysheet.flowdata[0].length-1]}];}else {var range=$.extend(true,[],luckysheet_select_save);}var searchIndexArr=luckysheet.searchReplace.getSearchIndexArr(searchText,range);if(searchIndexArr.length==0){if(luckysheet.isEditMode()){alert("没有查找到该内容");}else {luckysheet.tooltip.info("没有查找到该内容","");}return;}var searchAllHtml='';for(var i=0;i<searchIndexArr.length;i++){var valueShowEs=luckysheet.mask.valueShowEs(searchIndexArr[i].r,searchIndexArr[i].c,luckysheet.flowdata).toString();if(valueShowEs.indexOf("</")>-1&&valueShowEs.indexOf(">")>-1){searchAllHtml+='<div class="boxItem" data-row="'+searchIndexArr[i].r+'" data-col="'+searchIndexArr[i].c+'" data-sheetIndex="'+luckysheet.currentSheetIndex+'">'+'<span>'+luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].name+'</span>'+'<span>'+luckysheet.luckysheetchatatABC(searchIndexArr[i].c)+(searchIndexArr[i].r+1)+'</span>'+'<span>'+valueShowEs+'</span>'+'</div>';}else {searchAllHtml+='<div class="boxItem" data-row="'+searchIndexArr[i].r+'" data-col="'+searchIndexArr[i].c+'" data-sheetIndex="'+luckysheet.currentSheetIndex+'">'+'<span>'+luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].name+'</span>'+'<span>'+luckysheet.luckysheetchatatABC(searchIndexArr[i].c)+(searchIndexArr[i].r+1)+'</span>'+'<span title="'+valueShowEs+'">'+valueShowEs+'</span>'+'</div>';}}$('<div id="searchAllbox"><div class="boxTitle"><span>工作表</span><span>单元格</span><span>值</span></div><div class="boxMain">'+searchAllHtml+'</div></div>').appendTo($("#luckysheet-search-replace"));$("#luckysheet-search-replace #searchAllbox .boxItem").eq(0).addClass("on").siblings().removeClass("on");luckysheet_select_save=[{"row":[searchIndexArr[0].r,searchIndexArr[0].r],"column":[searchIndexArr[0].c,searchIndexArr[0].c]}];luckysheet.selectHightlightShow();},getSearchIndexArr:function getSearchIndexArr(searchText,range){var arr=[];var obj={};//正则表达式匹配
  var regCheck=false;if($("#luckysheet-search-replace #regCheck input[type='checkbox']").is(":checked")){regCheck=true;}//整词匹配
  var wordCheck=false;if($("#luckysheet-search-replace #wordCheck input[type='checkbox']").is(":checked")){wordCheck=true;}//区分大小写匹配
  var caseCheck=false;if($("#luckysheet-search-replace #caseCheck input[type='checkbox']").is(":checked")){caseCheck=true;}for(var s=0;s<range.length;s++){var r1=range[s].row[0],r2=range[s].row[1];var c1=range[s].column[0],c2=range[s].column[1];for(var r=r1;r<=r2;r++){for(var c=c1;c<=c2;c++){var cell=luckysheet.flowdata[r][c];if(cell!=null){var value=luckysheet.mask.valueShowEs(r,c,luckysheet.flowdata);if(value==0){value=value.toString();}if(value!=null&&value!=""){value=value.toString();if(wordCheck){//整词
  if(caseCheck){if(searchText==value){if(!(r+"_"+c in obj)){obj[r+"_"+c]=0;arr.push({"r":r,"c":c});}}}else {var txt=searchText.toLowerCase();if(txt==value.toLowerCase()){if(!(r+"_"+c in obj)){obj[r+"_"+c]=0;arr.push({"r":r,"c":c});}}}}else if(regCheck){//正则表达式
  if(caseCheck){var reg=new RegExp(luckysheet.func_methods.getRegExpStr(searchText),"g");}else {var reg=new RegExp(luckysheet.func_methods.getRegExpStr(searchText),"ig");}if(reg.test(value)){if(!(r+"_"+c in obj)){obj[r+"_"+c]=0;arr.push({"r":r,"c":c});}}}else if(caseCheck){//区分大小写
  var reg=new RegExp(luckysheet.func_methods.getRegExpStr(searchText),"g");if(reg.test(value)){if(!(r+"_"+c in obj)){obj[r+"_"+c]=0;arr.push({"r":r,"c":c});}}}else {var reg=new RegExp(luckysheet.func_methods.getRegExpStr(searchText),"ig");if(reg.test(value)){if(!(r+"_"+c in obj)){obj[r+"_"+c]=0;arr.push({"r":r,"c":c});}}}}}}}}return arr;},replace:function replace(){var searchText=$("#luckysheet-search-replace #searchInput input").val();if(searchText==""||searchText==null){if(luckysheet.isEditMode()){alert("请输入查找内容");}else {luckysheet.tooltip.info("请输入查找内容","");}return;}if(luckysheet_select_save.length==0||luckysheet_select_save.length==1&&luckysheet_select_save[0].row[0]==luckysheet_select_save[0].row[1]&&luckysheet_select_save[0].column[0]==luckysheet_select_save[0].column[1]){var range=[{"row":[0,luckysheet.flowdata.length-1],"column":[0,luckysheet.flowdata[0].length-1]}];}else {var range=$.extend(true,[],luckysheet_select_save);}var searchIndexArr=luckysheet.searchReplace.getSearchIndexArr(searchText,range);if(searchIndexArr.length==0){if(luckysheet.isEditMode()){alert("没有可替换的内容");}else {luckysheet.tooltip.info("没有可替换的内容","");}return;}var count=null;var rf=luckysheet_select_save[luckysheet_select_save.length-1].row_focus;var cf=luckysheet_select_save[luckysheet_select_save.length-1].column_focus;for(var i=0;i<searchIndexArr.length;i++){if(searchIndexArr[i].r==rf&&searchIndexArr[i].c==cf){count=i;break;}}if(count==null){if(searchIndexArr.length==0){if(luckysheet.isEditMode()){alert("找不到匹配项");}else {luckysheet.tooltip.info("找不到匹配项","");}return;}else {count=0;}}//正则表达式匹配
  if($("#luckysheet-search-replace #regCheck input[type='checkbox']").is(":checked"));//整词匹配
  var wordCheck=false;if($("#luckysheet-search-replace #wordCheck input[type='checkbox']").is(":checked")){wordCheck=true;}//区分大小写匹配
  var caseCheck=false;if($("#luckysheet-search-replace #caseCheck input[type='checkbox']").is(":checked")){caseCheck=true;}var replaceText=$("#luckysheet-search-replace #replaceInput input").val();var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);if(wordCheck){var r=searchIndexArr[count].r;var c=searchIndexArr[count].c;var v=replaceText;luckysheet.setcellvalue(r,c,d,v);}else {if(caseCheck){var reg=new RegExp(luckysheet.func_methods.getRegExpStr(searchText),"g");}else {var reg=new RegExp(luckysheet.func_methods.getRegExpStr(searchText),"ig");}var r=searchIndexArr[count].r;var c=searchIndexArr[count].c;var v=luckysheet.mask.valueShowEs(r,c,d).toString().replace(reg,replaceText);luckysheet.setcellvalue(r,c,d,v);}luckysheet_select_save=[{"row":[r,r],"column":[c,c]}];if($("#luckysheet-search-replace #searchAllbox").is(":visible")){$("#luckysheet-search-replace #searchAllbox").hide();}luckysheet.jfrefreshgrid(d,luckysheet_select_save);luckysheet.selectHightlightShow();var scrollLeft=$("#luckysheet-cell-main").scrollLeft(),scrollTop=$("#luckysheet-cell-main").scrollTop();var winH=$("#luckysheet-cell-main").height(),winW=$("#luckysheet-cell-main").width();var row=visibledatarow[r],row_pre=r-1==-1?0:visibledatarow[r-1];var col=visibledatacolumn[c],col_pre=c-1==-1?0:visibledatacolumn[c-1];if(col-scrollLeft-winW+20>0){$("#luckysheet-scrollbar-x").scrollLeft(col-winW+20);}else if(col_pre-scrollLeft-20<0){$("#luckysheet-scrollbar-x").scrollLeft(col_pre-20);}if(row-scrollTop-winH+20>0){$("#luckysheet-scrollbar-y").scrollTop(row-winH+20);}else if(row_pre-scrollTop-20<0){$("#luckysheet-scrollbar-y").scrollTop(row_pre-20);}},replaceAll:function replaceAll(){var searchText=$("#luckysheet-search-replace #searchInput input").val();if(searchText==""||searchText==null){if(luckysheet.isEditMode()){alert("请输入查找内容");}else {luckysheet.tooltip.info("请输入查找内容","");}return;}if(luckysheet_select_save.length==0||luckysheet_select_save.length==1&&luckysheet_select_save[0].row[0]==luckysheet_select_save[0].row[1]&&luckysheet_select_save[0].column[0]==luckysheet_select_save[0].column[1]){var range=[{"row":[0,luckysheet.flowdata.length-1],"column":[0,luckysheet.flowdata[0].length-1]}];}else {var range=$.extend(true,[],luckysheet_select_save);}var searchIndexArr=luckysheet.searchReplace.getSearchIndexArr(searchText,range);if(searchIndexArr.length==0){if(luckysheet.isEditMode()){alert("没有可替换的内容");}else {luckysheet.tooltip.info("没有可替换的内容","");}return;}//正则表达式匹配
  if($("#luckysheet-search-replace #regCheck input[type='checkbox']").is(":checked"));//整词匹配
  var wordCheck=false;if($("#luckysheet-search-replace #wordCheck input[type='checkbox']").is(":checked")){wordCheck=true;}//区分大小写匹配
  var caseCheck=false;if($("#luckysheet-search-replace #caseCheck input[type='checkbox']").is(":checked")){caseCheck=true;}var replaceText=$("#luckysheet-search-replace #replaceInput input").val();var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var range=[];if(wordCheck){for(var i=0;i<searchIndexArr.length;i++){var r=searchIndexArr[i].r;var c=searchIndexArr[i].c;var v=replaceText;luckysheet.setcellvalue(r,c,d,v);range.push({"row":[r,r],"column":[c,c]});}}else {if(caseCheck){var reg=new RegExp(luckysheet.func_methods.getRegExpStr(searchText),"g");}else {var reg=new RegExp(luckysheet.func_methods.getRegExpStr(searchText),"ig");}for(var i=0;i<searchIndexArr.length;i++){var r=searchIndexArr[i].r;var c=searchIndexArr[i].c;var v=luckysheet.mask.valueShowEs(r,c,d).toString().replace(reg,replaceText);luckysheet.setcellvalue(r,c,d,v);range.push({"row":[r,r],"column":[c,c]});}}if($("#luckysheet-search-replace #searchAllbox").is(":visible")){$("#luckysheet-search-replace #searchAllbox").hide();}luckysheet.jfrefreshgrid(d,range);luckysheet_select_save=$.extend(true,[],range);luckysheet.selectHightlightShow();if(luckysheet.isEditMode()){alert("已经帮您搜索并进行了"+searchIndexArr.length+"处替换");}else {luckysheet.tooltip.info("已经帮您搜索并进行了"+searchIndexArr.length+"处替换","");}}};//分列
  luckysheet.splitColumn={createDialog:function createDialog(){$("#luckysheet-modal-dialog-mask").show();$("#luckysheet-splitColumn-dialog").remove();var content='<div class="box">'+'<div class="boxTitle">分割符号</div>'+'<div class="boxMain">'+'<div style="height: 22px;line-height: 22px;">'+'<input id="splitColumn_type_01" type="checkbox"/>'+'<label for="splitColumn_type_01">Tab 键</label>'+'</div>'+'<div style="height: 22px;line-height: 22px;">'+'<input id="splitColumn_type_02" type="checkbox"/>'+'<label for="splitColumn_type_02">分号</label>'+'</div>'+'<div style="height: 22px;line-height: 22px;">'+'<input id="splitColumn_type_03" type="checkbox"/>'+'<label for="splitColumn_type_03">逗号</label>'+'</div>'+'<div style="height: 22px;line-height: 22px;">'+'<input id="splitColumn_type_04" type="checkbox"/>'+'<label for="splitColumn_type_04">空格</label>'+'</div>'+'<div style="height: 22px;line-height: 22px;">'+'<input id="splitColumn_type_05" type="checkbox"/>'+'<label for="splitColumn_type_05">其它</label>'+'<input type="text" class="formulaInputFocus" maxlength="1"/>'+'</div>'+'</div>'+'<div style="height: 22px;line-height: 22px;">'+'<input id="splitColumn_type_06" type="checkbox"/>'+'<label for="splitColumn_type_06">连续分隔符号视为单个处理</label>'+'</div>'+'<div class="boxTitle" style="margin-top: 10px;">数据预览</div>'+'<div class="boxMain" id="splitColumnData">'+'</div>'+'</div>';$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-splitColumn-dialog","addclass":"luckysheet-splitColumn-dialog","title":"文本分列","content":content,"botton":'<button id="luckysheet-splitColumn-dialog-confirm" class="btn btn-primary">确定</button><button class="btn btn-default luckysheet-model-close-btn">关闭</button>',"style":"z-index:100003"}));var $t=$("#luckysheet-splitColumn-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-splitColumn-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/3}).show();var dataArr=luckysheet.splitColumn.getDataArr();luckysheet.splitColumn.dataPreview(dataArr);},init:function init(){//数据预览
  $(document).off("change.SPCinpcheckbox").on("change.SPCcheckbox","#luckysheet-splitColumn-dialog .box input[type='checkbox']",function(){var regStr=luckysheet.splitColumn.getRegStr();var dataArr=luckysheet.splitColumn.getDataArr(regStr);luckysheet.splitColumn.dataPreview(dataArr);});$(document).off("keyup.SPCinptext").on("keyup.SPCinptext","#luckysheet-splitColumn-dialog .box input[type='text']",function(){if($(this).siblings("input[type='checkbox']").is(":checked")){var regStr=luckysheet.splitColumn.getRegStr();var dataArr=luckysheet.splitColumn.getDataArr(regStr);luckysheet.splitColumn.dataPreview(dataArr);}});//确定按钮
  $(document).off("click.SPCconfirm").on("click.SPCconfirm","#luckysheet-splitColumn-dialog #luckysheet-splitColumn-dialog-confirm",function(){$("#luckysheet-modal-dialog-mask").hide();$("#luckysheet-splitColumn-dialog").hide();var regStr=luckysheet.splitColumn.getRegStr();var dataArr=luckysheet.splitColumn.getDataArr(regStr);var r=luckysheet_select_save[0].row[0];var c=luckysheet_select_save[0].column[0];if(dataArr[0].length==1){return;}var dataCover=false;for(var i=0;i<dataArr.length;i++){for(var j=1;j<dataArr[0].length;j++){var cell=luckysheet.flowdata[r+i][c+j];if(cell!=null&&cell.v!=null){dataCover=true;break;}}}if(dataCover){var func1=function func1(){luckysheet.splitColumn.update(r,c,dataArr);};luckysheet.tooltip.confirm("提示","此处已有数据，是否替换它？",func1);}else {luckysheet.splitColumn.update(r,c,dataArr);}});},update:function update(r,c,dataArr){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);for(var i=0;i<dataArr.length;i++){for(var j=0;j<dataArr[0].length;j++){var v=dataArr[i][j];luckysheet.setcellvalue(r+i,c+j,d,v);}}var st_r=luckysheet_select_save[0].row[0],st_c=luckysheet_select_save[0].column[0];var range=[{"row":[st_r,st_r+dataArr.length-1],"column":[st_c,st_c+dataArr[0].length-1]}];luckysheet.jfrefreshgrid(d,range);luckysheet.selectHightlightShow();},dataPreview:function dataPreview(dataArr){$("#luckysheet-splitColumn-dialog #splitColumnData").empty();var trHtml='';for(var i=0;i<dataArr.length;i++){var tdHtml='';for(var j=0;j<dataArr[0].length;j++){tdHtml+='<td>'+dataArr[i][j]+'</td>';}trHtml+='<tr>'+tdHtml+'</tr>';}var tableHtml='<table>'+trHtml+'</table>';$("#luckysheet-splitColumn-dialog #splitColumnData").append(tableHtml);},getRegStr:function getRegStr(){var regStr='',mark=0;$("#luckysheet-splitColumn-dialog .box input[type='checkbox']:checked").each(function(i,e){var $id=$(e).attr("id");if($id=="splitColumn_type_01"){//Tab键
  regStr+="\\t";mark++;}else if($id=="splitColumn_type_02"){//分号
  if(mark>0){regStr+="|";}regStr+=";";mark++;}else if($id=="splitColumn_type_03"){//逗号
  if(mark>0){regStr+="|";}regStr+=",";mark++;}else if($id=="splitColumn_type_04"){//空格
  if(mark>0){regStr+="|";}regStr+="\\s";mark++;}else if($id=="splitColumn_type_05"){//其它
  var txt=$(e).siblings("input[type='text']").val().trim();if(txt!=""){if(mark>0){regStr+="|";}regStr+=txt;}}else if($id=="splitColumn_type_06"){//连续分隔符号视为单个处理
  regStr="["+regStr+"]+";}});return regStr;},getDataArr:function getDataArr(regStr){var arr=[];var r1=luckysheet_select_save[0].row[0];var r2=luckysheet_select_save[0].row[1];var c=luckysheet_select_save[0].column[0];if(regStr!=null&&regStr!=""){var reg=new RegExp(regStr,"g");var dataArr=[];for(var r=r1;r<=r2;r++){var rowArr=[];var cell=luckysheet.flowdata[r][c];if(cell!=null&&cell["m"]!=null){var value=cell["m"];}else {var value=luckysheet.getcellvalue(r,c,luckysheet.flowdata);}rowArr=value.toString().split(reg);dataArr.push(rowArr);}var rlen=dataArr.length;var clen=0;for(var i=0;i<rlen;i++){if(dataArr[i].length>clen){clen=dataArr[i].length;}}arr=luckysheet.splitColumn.getNullData(rlen,clen);for(var i=0;i<arr.length;i++){for(var j=0;j<arr[0].length;j++){if(dataArr[i][j]!=null){arr[i][j]=dataArr[i][j];}}}}else {for(var r=r1;r<=r2;r++){var rowArr=[];var cell=luckysheet.flowdata[r][c];if(cell!=null&&cell["m"]!=null){var value=cell["m"];}else {var value=luckysheet.getcellvalue(r,c,luckysheet.flowdata);}rowArr.push(value);arr.push(rowArr);}}return arr;},getNullData:function getNullData(rlen,clen){var arr=[];for(var r=0;r<rlen;r++){var rowArr=[];for(var c=0;c<clen;c++){rowArr.push("");}arr.push(rowArr);}return arr;}};//批注
  luckysheet.postil={defaultWidth:144,defaultHeight:84,currentObj:null,currentWinW:null,currentWinH:null,resize:null,resizeXY:null,move:false,moveXY:null,init:function init(){//点击批注框 聚焦
  $("#luckysheet-postil-showBoxs").off("mousedown.showPs").on("mousedown.showPs",".luckysheet-postil-show",function(event){luckysheet.postil.currentObj=$(this).find(".luckysheet-postil-show-main");if($(this).hasClass("luckysheet-postil-show-active")){event.stopPropagation();return;}luckysheet.postil.removeActivePs();$(this).addClass("luckysheet-postil-show-active");$(this).find(".luckysheet-postil-dialog-resize").show();$(this).find(".arrowCanvas").css("z-index",200);$(this).find(".luckysheet-postil-show-main").css("z-index",200);event.stopPropagation();});$("#luckysheet-postil-showBoxs").off("mouseup.showPs").on("mouseup.showPs",".luckysheet-postil-show",function(event){if(event.which=="3"){event.stopPropagation();}});//批注框 改变大小
  $("#luckysheet-postil-showBoxs").off("mousedown.resize").on("mousedown.resize",".luckysheet-postil-show .luckysheet-postil-dialog-resize .luckysheet-postil-dialog-resize-item",function(event){luckysheet.postil.currentObj=$(this).closest(".luckysheet-postil-show-main");luckysheet.postil.currentWinW=$("#luckysheet-cell-main")[0].scrollWidth;luckysheet.postil.currentWinH=$("#luckysheet-cell-main")[0].scrollHeight;luckysheet.postil.resize=$(this).data("type");var scrollTop=$("#luckysheet-cell-main").scrollTop(),scrollLeft=$("#luckysheet-cell-main").scrollLeft();var mouse=luckysheet.mouseposition(event.pageX,event.pageY);var x=mouse[0]+scrollLeft;var y=mouse[1]+scrollTop;var position=luckysheet.postil.currentObj.position();var width=luckysheet.postil.currentObj.width();var height=luckysheet.postil.currentObj.height();luckysheet.postil.resizeXY=[x,y,width,height,position.left+scrollLeft,position.top+scrollTop,scrollLeft,scrollTop];luckysheet.setluckysheet_scroll_status(true);if($(this).closest(".luckysheet-postil-show").hasClass("luckysheet-postil-show-active")){event.stopPropagation();return;}luckysheet.postil.removeActivePs();$(this).closest(".luckysheet-postil-show").addClass("luckysheet-postil-show-active");$(this).closest(".luckysheet-postil-show").find(".luckysheet-postil-dialog-resize").show();$(this).closest(".luckysheet-postil-show").find(".arrowCanvas").css("z-index",200);$(this).closest(".luckysheet-postil-show").find(".luckysheet-postil-show-main").css("z-index",200);event.stopPropagation();});//批注框 移动
  $("#luckysheet-postil-showBoxs").off("mousedown.move").on("mousedown.move",".luckysheet-postil-show .luckysheet-postil-dialog-move .luckysheet-postil-dialog-move-item",function(event){luckysheet.postil.currentObj=$(this).closest(".luckysheet-postil-show-main");luckysheet.postil.currentWinW=$("#luckysheet-cell-main")[0].scrollWidth;luckysheet.postil.currentWinH=$("#luckysheet-cell-main")[0].scrollHeight;luckysheet.postil.move=true;var scrollTop=$("#luckysheet-cell-main").scrollTop(),scrollLeft=$("#luckysheet-cell-main").scrollLeft();var offset=luckysheet.postil.currentObj.offset();var position=luckysheet.postil.currentObj.position();luckysheet.postil.moveXY=[event.pageX-offset.left,event.pageY-offset.top,position.left,position.top,scrollLeft,scrollTop];luckysheet.setluckysheet_scroll_status(true);if($(this).closest(".luckysheet-postil-show").hasClass("luckysheet-postil-show-active")){event.stopPropagation();return;}luckysheet.postil.removeActivePs();$(this).closest(".luckysheet-postil-show").addClass("luckysheet-postil-show-active");$(this).closest(".luckysheet-postil-show").find(".luckysheet-postil-dialog-resize").show();$(this).closest(".luckysheet-postil-show").find(".arrowCanvas").css("z-index",200);$(this).closest(".luckysheet-postil-show").find(".luckysheet-postil-show-main").css("z-index",200);event.stopPropagation();});},overshow:function overshow(event){$("#luckysheet-postil-overshow").remove();if($(event.target).closest("#luckysheet-cell-main").length==0){return;}var mouse=luckysheet.mouseposition(event.pageX,event.pageY);var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var scrollTop=$("#luckysheet-cell-main").scrollTop();var x=mouse[0]+scrollLeft;var y=mouse[1]+scrollTop;if(luckysheet.freezen.freezenverticaldata!=null&&mouse[0]<luckysheet.freezen.freezenverticaldata[0]-luckysheet.freezen.freezenverticaldata[2]){return;}if(luckysheet.freezen.freezenhorizontaldata!=null&&mouse[1]<luckysheet.freezen.freezenhorizontaldata[0]-luckysheet.freezen.freezenhorizontaldata[2]){return;}var rowLocation=luckysheet.rowLocation(y),row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col_index=colLocation[2];if(luckysheet.flowdata[row_index]==null||luckysheet.flowdata[row_index][col_index]==null||luckysheet.flowdata[row_index][col_index].ps==null){return;}var postil=luckysheet.flowdata[row_index][col_index].ps;if(postil["isshow"]||$("#luckysheet-postil-show_"+row_index+"_"+col_index).length>0){return;}var value=postil["value"]==null?"":postil["value"];var toX=visibledatacolumn[col_index];var toY=row_index==0?0:visibledatarow[row_index-1];var fromX=toX+18;var fromY=toY-18;if(fromY<0){fromY=2;}var size=luckysheet.postil.getArrowCanvasSize(fromX,fromY,toX,toY);var html='<div id="luckysheet-postil-overshow">'+'<canvas class="arrowCanvas" width="'+size[2]+'" height="'+size[3]+'" style="position:absolute;left:'+size[0]+'px;top:'+size[1]+'px;z-index:100;"></canvas>'+'<div style="width:132px;min-height:72px;color:#000;padding:5px;border:1px solid #000;background-color:rgb(255,255,225);position:absolute;left:'+fromX+'px;top:'+fromY+'px;z-index:100;">'+value+'</div>'+'</div>';$(html).appendTo($("#luckysheet-cell-main"));var ctx=$("#luckysheet-postil-overshow .arrowCanvas").get(0).getContext("2d");luckysheet.postil.drawArrow(ctx,size[4],size[5],size[6],size[7]);},getArrowCanvasSize:function getArrowCanvasSize(fromX,fromY,toX,toY){var left=toX-5;if(fromX<toX){left=fromX-5;}var top=toY-5;if(fromY<toY){top=fromY-5;}var width=Math.abs(fromX-toX)+10;var height=Math.abs(fromY-toY)+10;var x1=width-5;var x2=5;if(fromX<toX){x1=5;x2=width-5;}var y1=height-5;var y2=5;if(fromY<toY){y1=5;y2=height-5;}return [left,top,width,height,x1,y1,x2,y2];},drawArrow:function drawArrow(ctx,fromX,fromY,toX,toY,theta,headlen,width,color){theta=luckysheet.getObjType(theta)=="undefined"?30:theta;headlen=luckysheet.getObjType(headlen)=="undefined"?6:headlen;width=luckysheet.getObjType(width)=="undefined"?1:width;color=luckysheet.getObjType(color)=="undefined"?"#000":color;// 计算各角度和对应的P2,P3坐标
  var angle=Math.atan2(fromY-toY,fromX-toX)*180/Math.PI,angle1=(angle+theta)*Math.PI/180,angle2=(angle-theta)*Math.PI/180,topX=headlen*Math.cos(angle1),topY=headlen*Math.sin(angle1),botX=headlen*Math.cos(angle2),botY=headlen*Math.sin(angle2);ctx.save();ctx.beginPath();var arrowX=fromX-topX,arrowY=fromY-topY;ctx.moveTo(arrowX,arrowY);ctx.moveTo(fromX,fromY);ctx.lineTo(toX,toY);ctx.lineWidth=width;ctx.strokeStyle=color;ctx.stroke();arrowX=toX+topX;arrowY=toY+topY;ctx.moveTo(arrowX,arrowY);ctx.lineTo(toX,toY);arrowX=toX+botX;arrowY=toY+botY;ctx.lineTo(arrowX,arrowY);ctx.fillStyle=color;ctx.fill();ctx.restore();},buildAllPs:function buildAllPs(data){$("#luckysheet-cell-main #luckysheet-postil-showBoxs").empty();for(var r=0;r<data.length;r++){for(var c=0;c<data[0].length;c++){if(data[r][c]!=null&&data[r][c].ps!=null){var postil=data[r][c].ps;luckysheet.postil.buildPs(r,c,postil);}}}luckysheet.postil.init();},buildPs:function buildPs(r,c,postil){if($("#luckysheet-postil-show_"+r+"_"+c).length>0){$("#luckysheet-postil-show_"+r+"_"+c).remove();}if(postil==null){return;}var isshow=postil["isshow"]==null?false:postil["isshow"];if(isshow){var row=visibledatarow[r],row_pre=r-1==-1?0:visibledatarow[r-1];var col=visibledatacolumn[c],col_pre=c-1==-1?0:visibledatacolumn[c-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,r,c);if(!!margeset){row=margeset.row[1];row_pre=margeset.row[0];col=margeset.column[1];col_pre=margeset.column[0];}var toX=col;var toY=row_pre;var left=postil["left"]==null?toX+18:postil["left"];var top=postil["top"]==null?toY-18:postil["top"];var width=postil["width"]==null?luckysheet.postil.defaultWidth:postil["width"];var height=postil["height"]==null?luckysheet.postil.defaultHeight:postil["height"];var value=postil["value"]==null?"":postil["value"];if(top<0){top=2;}var size=luckysheet.postil.getArrowCanvasSize(left,top,toX,toY);var html='<div id="luckysheet-postil-show_'+r+'_'+c+'" class="luckysheet-postil-show">'+'<canvas class="arrowCanvas" width="'+size[2]+'" height="'+size[3]+'" style="position:absolute;left:'+size[0]+'px;top:'+size[1]+'px;z-index:100;"></canvas>'+'<div class="luckysheet-postil-show-main" style="width:'+width+'px;height:'+height+'px;color:#000;padding:5px;border:1px solid #000;background-color:rgb(255,255,225);position:absolute;left:'+left+'px;top:'+top+'px;box-sizing:border-box;z-index:100;">'+'<div class="luckysheet-postil-dialog-move">'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-t" data-type="t"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-r" data-type="r"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-b" data-type="b"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-l" data-type="l"></div>'+'</div>'+'<div class="luckysheet-postil-dialog-resize" style="display:none;">'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lt" data-type="lt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-mt" data-type="mt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lm" data-type="lm"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rm" data-type="rm"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rt" data-type="rt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lb" data-type="lb"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-mb" data-type="mb"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rb" data-type="rb"></div>'+'</div>'+'<div style="width:100%;height:100%;overflow:hidden;">'+'<div class="formulaInputFocus" style="width:'+(width-12)+'px;height:'+(height-12)+'px;line-height:18px;word-break:break-all;" spellcheck="false" contenteditable="true">'+value+'</div>'+'</div>'+'</div>'+'</div>';$(html).appendTo($("#luckysheet-cell-main #luckysheet-postil-showBoxs"));var ctx=$("#luckysheet-postil-show_"+r+"_"+c+" .arrowCanvas").get(0).getContext("2d");luckysheet.postil.drawArrow(ctx,size[4],size[5],size[6],size[7]);}},newPs:function newPs(r,c){var toX=visibledatacolumn[c];var toY=r==0?0:visibledatarow[r-1];var fromX=toX+18;var fromY=toY-18;if(fromY<0){fromY=2;}var size=luckysheet.postil.getArrowCanvasSize(fromX,fromY,toX,toY);var html='<div id="luckysheet-postil-show_'+r+'_'+c+'" class="luckysheet-postil-show luckysheet-postil-show-active">'+'<canvas class="arrowCanvas" width="'+size[2]+'" height="'+size[3]+'" style="position:absolute;left:'+size[0]+'px;top:'+size[1]+'px;z-index:100;"></canvas>'+'<div class="luckysheet-postil-show-main" style="width:144px;height:84px;color:#000;padding:5px;border:1px solid #000;background-color:rgb(255,255,225);position:absolute;left:'+fromX+'px;top:'+fromY+'px;box-sizing:border-box;z-index:100;">'+'<div class="luckysheet-postil-dialog-move">'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-t" data-type="t"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-r" data-type="r"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-b" data-type="b"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-l" data-type="l"></div>'+'</div>'+'<div class="luckysheet-postil-dialog-resize">'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lt" data-type="lt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-mt" data-type="mt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lm" data-type="lm"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rm" data-type="rm"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rt" data-type="rt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lb" data-type="lb"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-mb" data-type="mb"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rb" data-type="rb"></div>'+'</div>'+'<div style="width:100%;height:100%;overflow:hidden;">'+'<div class="formulaInputFocus" style="width:132px;height:72px;line-height:18px;word-break:break-all;" spellcheck="false" contenteditable="true">'+'</div>'+'</div>'+'</div>'+'</div>';$(html).appendTo($("#luckysheet-cell-main #luckysheet-postil-showBoxs"));var ctx=$("#luckysheet-postil-show_"+r+"_"+c+" .arrowCanvas").get(0).getContext("2d");luckysheet.postil.drawArrow(ctx,size[4],size[5],size[6],size[7]);$("#luckysheet-postil-show_"+r+"_"+c+" .formulaInputFocus").focus();luckysheet.postil.init();var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var rc=[];if(d[r][c]==null){d[r][c]={};}d[r][c].ps={"left":null,"top":null,"width":null,"height":null,"value":"","isshow":false};rc.push(r+"_"+c);luckysheet.postil.ref(d,rc);},editPs:function editPs(r,c){if($("#luckysheet-postil-show_"+r+"_"+c).length>0){$("#luckysheet-postil-show_"+r+"_"+c).show();$("#luckysheet-postil-show_"+r+"_"+c).addClass("luckysheet-postil-show-active");$("#luckysheet-postil-show_"+r+"_"+c).find(".luckysheet-postil-dialog-resize").show();}else {var postil=luckysheet.flowdata[r][c].ps;var row=visibledatarow[r],row_pre=r-1==-1?0:visibledatarow[r-1];var col=visibledatacolumn[c],col_pre=c-1==-1?0:visibledatacolumn[c-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,r,c);if(!!margeset){row=margeset.row[1];row_pre=margeset.row[0];col=margeset.column[1];col_pre=margeset.column[0];}var toX=col;var toY=row_pre;var left=postil["left"]==null?toX+18:postil["left"];var top=postil["top"]==null?toY-18:postil["top"];var width=postil["width"]==null?luckysheet.postil.defaultWidth:postil["width"];var height=postil["height"]==null?luckysheet.postil.defaultHeight:postil["height"];var value=postil["value"]==null?"":postil["value"];if(top<0){top=2;}var size=luckysheet.postil.getArrowCanvasSize(left,top,toX,toY);var html='<div id="luckysheet-postil-show_'+r+'_'+c+'" class="luckysheet-postil-show luckysheet-postil-show-active">'+'<canvas class="arrowCanvas" width="'+size[2]+'" height="'+size[3]+'" style="position:absolute;left:'+size[0]+'px;top:'+size[1]+'px;z-index:100;"></canvas>'+'<div class="luckysheet-postil-show-main" style="width:'+width+'px;height:'+height+'px;color:#000;padding:5px;border:1px solid #000;background-color:rgb(255,255,225);position:absolute;left:'+left+'px;top:'+top+'px;box-sizing:border-box;z-index:100;">'+'<div class="luckysheet-postil-dialog-move">'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-t" data-type="t"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-r" data-type="r"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-b" data-type="b"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-l" data-type="l"></div>'+'</div>'+'<div class="luckysheet-postil-dialog-resize">'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lt" data-type="lt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-mt" data-type="mt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lm" data-type="lm"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rm" data-type="rm"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rt" data-type="rt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lb" data-type="lb"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-mb" data-type="mb"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rb" data-type="rb"></div>'+'</div>'+'<div style="width:100%;height:100%;overflow:hidden;">'+'<div class="formulaInputFocus" style="width:'+(width-12)+'px;height:'+(height-12)+'px;line-height:18px;word-break:break-all;" spellcheck="false" contenteditable="true">'+value+'</div>'+'</div>'+'</div>'+'</div>';$(html).appendTo($("#luckysheet-cell-main #luckysheet-postil-showBoxs"));var ctx=$("#luckysheet-postil-show_"+r+"_"+c+" .arrowCanvas").get(0).getContext("2d");luckysheet.postil.drawArrow(ctx,size[4],size[5],size[6],size[7]);}$("#luckysheet-postil-show_"+r+"_"+c+" .formulaInputFocus").focus();luckysheet.luckysheetRangeLast($("#luckysheet-postil-show_"+r+"_"+c+" .formulaInputFocus").get(0));luckysheet.postil.init();},delPs:function delPs(r,c){if($("#luckysheet-postil-show_"+r+"_"+c).length>0){$("#luckysheet-postil-show_"+r+"_"+c).remove();}var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var rc=[];delete d[r][c].ps;rc.push(r+"_"+c);luckysheet.postil.ref(d,rc);},showHidePs:function showHidePs(r,c){var postil=luckysheet.flowdata[r][c].ps;var isshow=postil["isshow"];var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var rc=[];if(isshow){d[r][c].ps.isshow=false;$("#luckysheet-postil-show_"+r+"_"+c).remove();}else {d[r][c].ps.isshow=true;var row=visibledatarow[r],row_pre=r-1==-1?0:visibledatarow[r-1];var col=visibledatacolumn[c],col_pre=c-1==-1?0:visibledatacolumn[c-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,r,c);if(!!margeset){row=margeset.row[1];row_pre=margeset.row[0];col=margeset.column[1];col_pre=margeset.column[0];}var toX=col;var toY=row_pre;var left=postil["left"]==null?toX+18:postil["left"];var top=postil["top"]==null?toY-18:postil["top"];var width=postil["width"]==null?luckysheet.postil.defaultWidth:postil["width"];var height=postil["height"]==null?luckysheet.postil.defaultHeight:postil["height"];var value=postil["value"]==null?"":postil["value"];if(top<0){top=2;}var size=luckysheet.postil.getArrowCanvasSize(left,top,toX,toY);var html='<div id="luckysheet-postil-show_'+r+'_'+c+'" class="luckysheet-postil-show">'+'<canvas class="arrowCanvas" width="'+size[2]+'" height="'+size[3]+'" style="position:absolute;left:'+size[0]+'px;top:'+size[1]+'px;z-index:100;"></canvas>'+'<div class="luckysheet-postil-show-main" style="width:'+width+'px;height:'+height+'px;color:#000;padding:5px;border:1px solid #000;background-color:rgb(255,255,225);position:absolute;left:'+left+'px;top:'+top+'px;box-sizing:border-box;z-index:100;">'+'<div class="luckysheet-postil-dialog-move">'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-t" data-type="t"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-r" data-type="r"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-b" data-type="b"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-l" data-type="l"></div>'+'</div>'+'<div class="luckysheet-postil-dialog-resize" style="display:none;">'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lt" data-type="lt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-mt" data-type="mt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lm" data-type="lm"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rm" data-type="rm"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rt" data-type="rt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lb" data-type="lb"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-mb" data-type="mb"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rb" data-type="rb"></div>'+'</div>'+'<div style="width:100%;height:100%;overflow:hidden;">'+'<div class="formulaInputFocus" style="width:'+(width-12)+'px;height:'+(height-12)+'px;line-height:18px;word-break:break-all;" spellcheck="false" contenteditable="true">'+value+'</div>'+'</div>'+'</div>'+'</div>';$(html).appendTo($("#luckysheet-cell-main #luckysheet-postil-showBoxs"));var ctx=$("#luckysheet-postil-show_"+r+"_"+c+" .arrowCanvas").get(0).getContext("2d");luckysheet.postil.drawArrow(ctx,size[4],size[5],size[6],size[7]);luckysheet.postil.init();}rc.push(r+"_"+c);luckysheet.postil.ref(d,rc);},showHideAllPs:function showHideAllPs(){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var isAllShow=true;var allPs=[];for(var r=0;r<d.length;r++){for(var c=0;c<d[0].length;c++){if(d[r]!=null&&d[r][c]!=null&&d[r][c].ps!=null){allPs.push(r+"_"+c);if(!d[r][c].ps.isshow){isAllShow=false;}}}}if(allPs.length>0){var rc=[];if(isAllShow){//全部显示，操作为隐藏所有批注
  $("#luckysheet-cell-main #luckysheet-postil-showBoxs").empty();for(var i=0;i<allPs.length;i++){var rowIndex=allPs[i].split("_")[0];var colIndex=allPs[i].split("_")[1];var postil=d[rowIndex][colIndex].ps;if(postil["isshow"]){d[rowIndex][colIndex].ps.isshow=false;rc.push(allPs[i]);}}}else {//部分显示或全部隐藏，操作位显示所有批注
  for(var i=0;i<allPs.length;i++){var rowIndex=allPs[i].split("_")[0];var colIndex=allPs[i].split("_")[1];var postil=d[rowIndex][colIndex].ps;if(!postil["isshow"]){var row=visibledatarow[rowIndex],row_pre=rowIndex-1==-1?0:visibledatarow[rowIndex-1];var col=visibledatacolumn[colIndex],col_pre=colIndex-1==-1?0:visibledatacolumn[colIndex-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,rowIndex,colIndex);if(!!margeset){row=margeset.row[1];row_pre=margeset.row[0];col=margeset.column[1];col_pre=margeset.column[0];}var toX=col;var toY=row_pre;var left=postil["left"]==null?toX+18:postil["left"];var top=postil["top"]==null?toY-18:postil["top"];var width=postil["width"]==null?luckysheet.postil.defaultWidth:postil["width"];var height=postil["height"]==null?luckysheet.postil.defaultHeight:postil["height"];var value=postil["value"]==null?"":postil["value"];if(top<0){top=2;}var size=luckysheet.postil.getArrowCanvasSize(left,top,toX,toY);var html='<div id="luckysheet-postil-show_'+rowIndex+'_'+colIndex+'" class="luckysheet-postil-show">'+'<canvas class="arrowCanvas" width="'+size[2]+'" height="'+size[3]+'" style="position:absolute;left:'+size[0]+'px;top:'+size[1]+'px;z-index:100;"></canvas>'+'<div class="luckysheet-postil-show-main" style="width:'+width+'px;height:'+height+'px;color:#000;padding:5px;border:1px solid #000;background-color:rgb(255,255,225);position:absolute;left:'+left+'px;top:'+top+'px;box-sizing:border-box;z-index:100;">'+'<div class="luckysheet-postil-dialog-move">'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-t" data-type="t"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-r" data-type="r"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-b" data-type="b"></div>'+'<div class="luckysheet-postil-dialog-move-item luckysheet-postil-dialog-move-item-l" data-type="l"></div>'+'</div>'+'<div class="luckysheet-postil-dialog-resize" style="display:none;">'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lt" data-type="lt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-mt" data-type="mt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lm" data-type="lm"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rm" data-type="rm"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rt" data-type="rt"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-lb" data-type="lb"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-mb" data-type="mb"></div>'+'<div class="luckysheet-postil-dialog-resize-item luckysheet-postil-dialog-resize-item-rb" data-type="rb"></div>'+'</div>'+'<div style="width:100%;height:100%;overflow:hidden;">'+'<div class="formulaInputFocus" style="width:'+(width-12)+'px;height:'+(height-12)+'px;line-height:18px;word-break:break-all;" spellcheck="false" contenteditable="true">'+value+'</div>'+'</div>'+'</div>'+'</div>';$(html).appendTo($("#luckysheet-cell-main #luckysheet-postil-showBoxs"));var ctx=$("#luckysheet-postil-show_"+rowIndex+"_"+colIndex+" .arrowCanvas").get(0).getContext("2d");luckysheet.postil.drawArrow(ctx,size[4],size[5],size[6],size[7]);d[rowIndex][colIndex].ps.isshow=true;rc.push(allPs[i]);}}}}luckysheet.postil.ref(d,rc);luckysheet.postil.init();},removeActivePs:function removeActivePs(){if($("#luckysheet-postil-showBoxs .luckysheet-postil-show-active").length>0){var id=$("#luckysheet-postil-showBoxs .luckysheet-postil-show-active").attr("id");$("#"+id).removeClass("luckysheet-postil-show-active");$("#"+id).find(".luckysheet-postil-dialog-resize").hide();$("#"+id).find(".arrowCanvas").css("z-index",100);$("#"+id).find(".luckysheet-postil-show-main").css("z-index",100);var r=id.split("luckysheet-postil-show_")[1].split("_")[0];var c=id.split("luckysheet-postil-show_")[1].split("_")[1];var value=$("#"+id).find(".formulaInputFocus").text();var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var rc=[];d[r][c].ps.value=value;rc.push(r+"_"+c);luckysheet.postil.ref(d,rc);if(!d[r][c].ps.isshow){$("#"+id).remove();}}},ref:function ref(data,rc){if(clearjfundo){luckysheet.jfundo=[];luckysheet.jfredo.push({"type":"postil","data":luckysheet.flowdata,"curdata":data,"sheetIndex":luckysheet.currentSheetIndex,"rc":rc});}//luckysheet.flowdata
  luckysheet.flowdata=data;luckysheet.editor.webWorkerFlowDataCache(luckysheet.flowdata);//worker存数据
  luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].data=luckysheet.flowdata;luckysheet.formula.execFunctionGroupData=luckysheet.flowdata;//共享编辑模式
  if(luckysheet.server.allowUpdate){for(var i=0;i<rc.length;i++){var r=rc[i].split("_")[0];var c=rc[i].split("_")[1];luckysheet.server.saveParam("v",luckysheet.currentSheetIndex,luckysheet.flowdata[r][c],{"r":r,"c":c});}}//刷新表格
  setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);},positionSync:function positionSync(){$("#luckysheet-postil-showBoxs .luckysheet-postil-show").each(function(i,e){var id=$(e).attr("id");var r=id.split("luckysheet-postil-show_")[1].split("_")[0];var c=id.split("luckysheet-postil-show_")[1].split("_")[1];luckysheet.postil.buildPs(r,c,luckysheet.flowdata[r][c].ps);});}};luckysheet.hasChinaword=function(s){var patrn=/[\u4E00-\u9FA5]|[\uFE30-\uFFA0]/gi;if(!patrn.exec(s)){return false;}else {return true;}};luckysheet.getdatabyselectionD=function(d,range){if(range==null||range["row"]==null||range["row"].length==0){return [];}var dynamicArray_compute=luckysheet.dynamicArray_compute(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["dynamicArray"]);var data=[];for(var r=range["row"][0];r<=range["row"][1];r++){if(d[r]==null){continue;}if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null){continue;}var row=[];for(var c=range["column"][0];c<=range["column"][1];c++){var value;if(r+"_"+c in dynamicArray_compute){value=dynamicArray_compute[r+"_"+c];}else {value=d[r][c];}row.push(value);}data.push(row);}return data;};luckysheet.getdatabyselection=function(range,sheetIndex){if(range==null){range=luckysheet_select_save[0];}if(range["row"]==null||range["row"].length==0){return [];}//取数据
  if(sheetIndex!=null&&sheetIndex!=luckysheet.currentSheetIndex){var d=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(sheetIndex)]["data"];var cfg=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(sheetIndex)]["config"];}else {var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var cfg=config;}var data=[];for(var r=range["row"][0];r<=range["row"][1];r++){if(d[r]==null){continue;}if(cfg["rowhidden"]!=null&&cfg["rowhidden"][r]!=null){continue;}var row=[];for(var c=range["column"][0];c<=range["column"][1];c++){row.push(d[r][c]);}data.push(row);}return data;};//计算范围行高
  luckysheet.rowlenByRange=function(d,r1,r2,cfg){var cfg_clone=$.extend(true,{},cfg);if(cfg_clone["rowlen"]==null){cfg_clone["rowlen"]={};}var ctcanvas=$("#luckysheetTableContent").get(0).getContext("2d");for(var r=r1;r<=r2;r++){if(cfg_clone["rowhidden"]!=null&&cfg_clone["rowhidden"][r]!=null){continue;}var currentRowLen=defaultrowlen;if(cfg_clone["rowlen"][r]!=null){currentRowLen=cfg_clone["rowlen"][r];}for(var c=0;c<d[r].length;c++){if(d[r][c]!=null&&d[r][c]["v"]!=null&&d[r][c]["tb"]!=null&&d[r][c]["tb"]=="2"){//自动换行
  var fontset=luckysheetfontformat(d[r][c]);ctcanvas.font=fontset;var oneLineTextHeight=luckysheet.menuButton.getTextSize("田",fontset)[1];var cellText=luckysheet.getcellvalue(r,c,d).toString();//单元格文本
  var textWidth=ctcanvas.measureText(cellText).width;//文本宽度
  var cellWidth=luckysheet.colLocationByIndex(c)[1]-luckysheet.colLocationByIndex(c)[0]-8;//单元格宽度
  var computeRowlen;//计算行高
  if(textWidth>cellWidth){var strArr=[];//文本截断数组
  for(var strI=1;strI<=cellText.length;strI++){var strV=cellText.substring(strArr.join("").length,strI);var strtextMetrics=ctcanvas.measureText(strV).width;if(strtextMetrics>cellWidth){strArr.push(cellText.substring(strArr.join("").length,strI-1));strI=strI-2;}else if(strtextMetrics<=cellWidth&&strI==cellText.length){strArr.push(strV);}}computeRowlen=oneLineTextHeight*strArr.length;}else {computeRowlen=oneLineTextHeight;}//比较计算行高和当前行高取最大高度
  if(computeRowlen>currentRowLen){currentRowLen=computeRowlen;}}else if(d[r][c]!=null&&d[r][c]["v"]!=null&&d[r][c]["tr"]!=null){//文本旋转
  var fontset=luckysheetfontformat(d[r][c]);ctcanvas.font=fontset;var oneLineTextHeight=luckysheet.menuButton.getTextSize("田",fontset)[1];var cellText=luckysheet.getcellvalue(r,c,d).toString();//单元格文本
  var textWidth=ctcanvas.measureText(cellText).width;//文本宽度
  var computeRowlen;//计算行高
  if(d[r][c]["tr"]=="0"){//无旋转
  computeRowlen=oneLineTextHeight;}else if(d[r][c]["tr"]=="1"||d[r][c]["tr"]=="2"){//向下倾斜（45 旋转）----向上倾斜（-45 旋转）
  computeRowlen=0.707*(textWidth+oneLineTextHeight)+4;}else if(d[r][c]["tr"]=="3"){//竖排文字
  computeRowlen=cellText.length*oneLineTextHeight+4;}else if(d[r][c]["tr"]=="4"||d[r][c]["tr"]=="5"){//向下90（90 旋转）----向上90（-90 旋转）
  computeRowlen=textWidth+4;}computeRowlen=Math.round(computeRowlen);//比较计算高度和当前高度取最大高度
  if(computeRowlen>currentRowLen){currentRowLen=computeRowlen;}}else {var fontset=luckysheetfontformat(d[r][c]);var oneLineTextHeight=luckysheet.menuButton.getTextSize("田",fontset)[1];//比较计算高度和当前高度取最大高度
  if(oneLineTextHeight>currentRowLen){currentRowLen=oneLineTextHeight;}}}if(currentRowLen!=defaultrowlen){cfg_clone["rowlen"][r]=currentRowLen;}}return cfg_clone;};//计算表格行高数组
  luckysheet.computeRowlenArr=function(rowHeight,cfg){var rowlenArr=[];var rh_height=0;for(var i=0;i<rowHeight;i++){var rowlen=defaultrowlen;if(cfg["rowlen"]!=null&&cfg["rowlen"][i]!=null){rowlen=cfg["rowlen"][i];}if(cfg["rowhidden"]!=null&&cfg["rowhidden"][i]!=null){rowlen=cfg["rowhidden"][i];rowlenArr.push(rh_height);continue;}else {rh_height+=rowlen+1;}rowlenArr.push(rh_height);//行的临时长度分布
  }return rowlenArr;};luckysheet.getdatabyselectionNoCopy=function(range){if(range==null||range["row"]==null||range["row"].length==0){return [];}var data=[];for(var r=range["row"][0];r<=range["row"][1];r++){var row=[];if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null){continue;}for(var c=range["column"][0];c<=range["column"][1];c++){var value="";if(luckysheet.flowdata[r]!=null&&luckysheet.flowdata[r][c]!=null){value=luckysheet.flowdata[r][c];}row.push(value);}data.push(row);}return data;};luckysheet.datagridgrowth=function(data,addr,addc,iscallback){if(addr<=0&&addc<=0){return data;}if(addr<=0){addr=0;}if(addc<=0){addc=0;}var dataClen=0;if(data.length==0){data=[];dataClen=0;}else {dataClen=data[0].length;}var coladd=[];//需要额外增加的空列
  for(var c=0;c<addc;c++){coladd.push(null);}var rowadd=[];//完整的一个空行
  for(var r=0;r<dataClen+addc;r++){rowadd.push(null);}for(var r=0;r<data.length;r++){data[r]=[].concat(data[r].concat(coladd));}for(var r=0;r<addr;r++){data.push([].concat(rowadd));}if(!!iscallback){luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,data.length,{"k":"row"});luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,data[0].length,{"k":"column"});}return data;};luckysheet.cleargridelement=function(event){$("#luckysheet-cols-h-hover").hide();$("#luckysheet-rightclick-menu").hide();$("#luckysheet-cell-selected-boxs .luckysheet-cell-selected").hide();$("#luckysheet-cols-h-selected .luckysheet-cols-h-selected").hide();$("#luckysheet-rows-h-selected .luckysheet-rows-h-selected").hide();$("#luckysheet-cell-selected-focus").hide();$("#luckysheet-rows-h-hover").hide();$("#luckysheet-selection-copy .luckysheet-selection-copy").hide();$("#luckysheet-cols-menu-btn").hide();$("#luckysheet-row-count-show, #luckysheet-column-count-show").hide();if(!event){luckysheet.selection.clearcopy(event);}//else{
  //	luckysheet.selection.clearcopy();
  //}
  //选区下拉icon隐藏
  if($("#luckysheet-dropCell-icon").is(":visible")){if(event){$("#luckysheet-dropCell-icon").remove();}}//格式刷
  if(luckysheet.menuButton.luckysheetPaintModelOn&&!event){luckysheet.menuButton.cancelPaintModel();}};luckysheet.orderbydata=function(data,index,isAsc){if(isAsc==null){isAsc=true;}var a=function a(x,y){var x1=x[index],y1=y[index];if(luckysheet.getObjType(x[index])=="object"){x1=x[index].v;}if(luckysheet.getObjType(y[index])=="object"){y1=y[index].v;}if(luckysheet.func_methods.isRealNull(x1)){return 1;}if(luckysheet.func_methods.isRealNull(y1)){return -1;}// if(x1 == null){
  //     x1 = "";
  // }
  // if(y1 == null){
  //     y1 = "";
  // }
  if(luckysheet.datecontroll.isdatetime(x1)&&luckysheet.datecontroll.isdatetime(y1)){return luckysheet.datecontroll.diff(x1,y1);}else if(luckysheet.func_methods.isRealNum(x1)&&luckysheet.func_methods.isRealNum(y1)){return numeral(x1).value()-numeral(y1).value();}else if(!luckysheet.func_methods.isRealNum(x1)&&!luckysheet.func_methods.isRealNum(y1)){return x1.localeCompare(y1,"zh");}else if(!luckysheet.func_methods.isRealNum(x1)){return 1;}else if(!luckysheet.func_methods.isRealNum(y1)){return -1;}};var d=function d(x,y){var x1=x[index],y1=y[index];if(luckysheet.getObjType(x[index])=="object"){x1=x[index].v;}if(luckysheet.getObjType(y[index])=="object"){y1=y[index].v;}if(luckysheet.func_methods.isRealNull(x1)){return 1;}if(luckysheet.func_methods.isRealNull(y1)){return -1;}// if(x1 == null){
  //     x1 = "";
  // }
  // if(y1 == null){
  //     y1 = "";
  // }
  if(luckysheet.datecontroll.isdatetime(x1)&&luckysheet.datecontroll.isdatetime(y1)){return luckysheet.datecontroll.diff(y1,x1);}else if(luckysheet.func_methods.isRealNum(x1)&&luckysheet.func_methods.isRealNum(y1)){return numeral(y1).value()-numeral(x1).value();}else if(!luckysheet.func_methods.isRealNum(x1)&&!luckysheet.func_methods.isRealNum(y1)){return y1.localeCompare(x1,"zh");}else if(!luckysheet.func_methods.isRealNum(x1)){return -1;}else if(!luckysheet.func_methods.isRealNum(y1)){return 1;}};if(isAsc){return data.sort(a);}else {return data.sort(d);}};luckysheet.orderbydata1D=function(data,isAsc){if(isAsc==null){isAsc=true;}var a=function a(x,y){var x1=x,y1=y;if(luckysheet.getObjType(x)=="object"){x1=x.v;}if(luckysheet.getObjType(y)=="object"){y1=y.v;}if(x1==null){x1="";}if(y1==null){y1="";}if(luckysheet.datecontroll.isdatetime(x1)&&luckysheet.datecontroll.isdatetime(y1)){return luckysheet.datecontroll.diff(x1,y1);}else if(luckysheet.func_methods.isRealNum(x1)&&luckysheet.func_methods.isRealNum(y1)){return numeral(x1).value()-numeral(y1).value();}else if(!luckysheet.func_methods.isRealNum(x1)&&!luckysheet.func_methods.isRealNum(y1)){return x1.localeCompare(y1,"zh");}else if(!luckysheet.func_methods.isRealNum(x1)){return 1;}else if(!luckysheet.func_methods.isRealNum(y1)){return -1;}};var d=function d(x,y){var x1=x,y1=y;if(luckysheet.getObjType(x)=="object"){x1=x.v;}if(luckysheet.getObjType(y)=="object"){y1=y.v;}if(x1==null){x1="";}if(y1==null){y1="";}if(luckysheet.datecontroll.isdatetime(x1)&&luckysheet.datecontroll.isdatetime(y1)){return luckysheet.datecontroll.diff(y1,x1);}else if(luckysheet.func_methods.isRealNum(x1)&&luckysheet.func_methods.isRealNum(y1)){return numeral(y1).value()-numeral(x1).value();}else if(!luckysheet.func_methods.isRealNum(x1)&&!luckysheet.func_methods.isRealNum(y1)){return y1.localeCompare(x1,"zh");}else if(!luckysheet.func_methods.isRealNum(x1)){return -1;}else if(!luckysheet.func_methods.isRealNum(y1)){return 1;}};if(isAsc){return data.sort(a);}else {return data.sort(d);}};//排序选区数据
  luckysheet.sortSelection=function(isAsc){if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选择区域执行此操作，请选择单个区域，然后再试","");}return;}if(isAsc==null){isAsc=true;}var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var r1=luckysheet_select_save[0].row[0],r2=luckysheet_select_save[0].row[1];var c1=luckysheet_select_save[0].column[0],c2=luckysheet_select_save[0].column[1];var str,edr;for(var r=r1;r<=r2;r++){if(d[r]!=null&&d[r][c1]!=null){var cell=d[r][c1];if(cell.mc!=null||luckysheet.func_methods.isRealNull(cell.v)){continue;}if(str==null&&/[\u4e00-\u9fa5]+/g.test(cell.v)){str=r+1;edr=r+1;continue;}if(str==null){str=r;}edr=r;}}if(str==null||str>r2){return;}var hasMc=false;//排序选区是否有合并单元格
  var data=[];for(var r=str;r<=edr;r++){var data_row=[];for(var c=c1;c<=c2;c++){if(d[r][c]!=null&&d[r][c].mc!=null){hasMc=true;break;}data_row.push(d[r][c]);}data.push(data_row);}if(hasMc){if(luckysheet.isEditMode()){alert("选区有合并单元格，无法执行此操作！");}else {luckysheet.tooltip.info("选区有合并单元格，无法执行此操作！","");}return;}data=luckysheet.orderbydata(data,0,isAsc);for(var r=str;r<=edr;r++){for(var c=c1;c<=c2;c++){d[r][c]=data[r-str][c-c1];}}if(config["rowlen"]!=null){var cfg=$.extend(true,{},config);cfg=luckysheet.rowlenByRange(d,str,edr,cfg);luckysheet.jfrefreshgrid(d,[{"row":[str,edr],"column":[c1,c2]}],cfg,null,true);}else {luckysheet.jfrefreshgrid(d,[{"row":[str,edr],"column":[c1,c2]}]);}};//排序一列数据
  luckysheet.sortColumnSeletion=function(colIndex,isAsc){if(isAsc==null){isAsc=true;}var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var r1=0,r2=d.length-1;var c1=0,c2=d[0].length-1;var str,edr;for(var r=r1;r<=r2;r++){if(d[r][colIndex]!=null&&d[r][colIndex].mc!=null){continue;}if(d[r][colIndex]!=null&&!luckysheet.func_methods.isRealNull(d[r][colIndex].v)&&/[\u4e00-\u9fa5]+/g.test(d[r][colIndex].v)&&str==null){str=r+1;edr=r+1;continue;}if(str==null){str=r;}if(d[r][colIndex]!=null&&!luckysheet.func_methods.isRealNull(d[r][colIndex].v)){edr=r;}}if(str==null||str>r2){return;}var hasMc=false;//排序选区是否有合并单元格
  var data=[];for(var r=str;r<=edr;r++){var data_row=[];for(var c=c1;c<=c2;c++){if(d[r][c]!=null&&d[r][c].mc!=null){hasMc=true;break;}data_row.push(d[r][c]);}data.push(data_row);}if(hasMc){if(luckysheet.isEditMode()){alert("列排序会扩展至整个表格选区，选区有合并单元格，无法执行此操作，请选择功能栏排序功能！");}else {luckysheet.tooltip.info("列排序会扩展至整个表格选区，选区有合并单元格，无法执行此操作，请选择功能栏排序功能！","");}return;}data=luckysheet.orderbydata(data,colIndex,isAsc);for(var r=str;r<=edr;r++){for(var c=c1;c<=c2;c++){d[r][c]=data[r-str][c-c1];}}if(config["rowlen"]!=null){var cfg=$.extend(true,{},config);cfg=luckysheet.rowlenByRange(d,str,edr,cfg);luckysheet.jfrefreshgrid(d,[{"row":[str,edr],"column":[c1,c2]}],cfg,null,true);}else {luckysheet.jfrefreshgrid(d,[{"row":[str,edr],"column":[c1,c2]}]);}};/*
      data: [{"name":"Sheet1",color:"","status":"1","order":"0","data":[], "theme":{}},{"name":"Sheet2",color:"","status":"0","order":"1","data":[]},{"name":"Sheet3",color:"","status":"0","order":"2","data":[]}],
      */var luckysheetfile=null,container=null,defaultcolumnNum=60,defaultrowNum=84,fullscreenmode=true;luckysheet.getluckysheetfile=function(){return luckysheetfile;};luckysheet.setluckysheetfile=function(d){luckysheetfile=d;};luckysheet.getconfig=function(){return config;};luckysheet.setconfig=function(v){config=v;if(luckysheetfile!=null){luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=v;}};luckysheet.getvisibledatarow=function(){return visibledatarow;};luckysheet.setvisibledatarow=function(v){visibledatarow=v;if(luckysheetfile!=null){luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].visibledatarow=v;}};luckysheet.getvisibledatacolumn=function(){return visibledatacolumn;};luckysheet.setvisibledatacolumn=function(v){visibledatacolumn=v;if(luckysheetfile!=null){luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].visibledatacolumn=v;}};luckysheet.sheetmanage={generateRandomSheetIndex:function generateRandomSheetIndex(prefix){if(prefix==null){prefix="Sheet";}var userAgent=window.navigator.userAgent.replace(/[^a-zA-Z0-9]/g,"").split("");var mid="";for(var i=0;i<12;i++){mid+=userAgent[Math.round(Math.random()*(userAgent.length-1))];}var time=new Date().getTime();return prefix+"_"+mid+"_"+time;},generateRandomSheetName:function generateRandomSheetName(file,isPivotTable){var index=file.length;for(var i=0;i<file.length;i++){if(file[i].name.indexOf("Sheet")>-1||file[i].name.indexOf("数据透视表")>-1){var suffix=parseFloat(file[i].name.replace("Sheet","").replace("数据透视表",""));if(suffix!="NaN"&&Math.ceil(suffix)>index){index=Math.ceil(suffix);}}}if(isPivotTable){return "数据透视表"+(index+1);}else {return "Sheet"+(index+1);}},generateCopySheetName:function generateCopySheetName(file,name){var copySheetName="";if(name.toString().indexOf("(副本")>-1){var copy_i=name.toString().indexOf("(副本");var name2=name.toString().substring(0,copy_i)+"(副本";var index=null;for(var i=0;i<file.length;i++){var fileName=file[i].name.toString();var st_i=fileName.indexOf(name2);if(st_i>-1){var ed_i=fileName.indexOf(")",st_i+name2.length);var num=fileName.substring(st_i+name2.length,ed_i);if(luckysheet.func_methods.isRealNum(num)){if(index==null||parseInt(num)>index){index=parseInt(num);}}}}if(index==null){copySheetName=name2+"2)";}else {index++;copySheetName=name2+index+")";}}else {var index=null;var hascopy=false;var name2=name+"(副本";for(var i=0;i<file.length;i++){var fileName=file[i].name.toString();var st_i=fileName.indexOf(name2);if(st_i>-1){hascopy=true;var ed_i=fileName.indexOf(")",st_i+name2.length);var num=fileName.substring(st_i+name2.length,ed_i);if(luckysheet.func_methods.isRealNum(num)){if(index==null||parseInt(num)>index){index=parseInt(num);}}}}if(hascopy){if(index==null){copySheetName=name+"(副本2)";}else {index++;copySheetName=name+"(副本"+index+")";}}else {copySheetName=name+"(副本)";}}return copySheetName;},getSheetByIndex:function getSheetByIndex(index){try{if(index==null){index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);}var i=this.getSheetIndex(index);return luckysheetfile[i];}catch(err){console.log(err);}},getCurSheetnoset:function getCurSheetnoset(){var curindex=0;for(var i=0;i<luckysheetfile.length;i++){if(luckysheetfile[i].status==1){curindex=luckysheetfile[i].index;break;}}return curindex;},getCurSheet:function getCurSheet(){luckysheet.currentSheetIndex=luckysheetfile[0].index;for(var i=0;i<luckysheetfile.length;i++){if(luckysheetfile[i].status==1){luckysheet.currentSheetIndex=luckysheetfile[i].index;break;}}return luckysheet.currentSheetIndex;},addNewSheet:function addNewSheet(e,isPivotTable){if(luckysheet.isEditMode()){// alert("非编辑模式下不允许该操作！");
  return;}var order=luckysheetfile.length;var index=luckysheet.sheetmanage.generateRandomSheetIndex();var sheetname=luckysheet.sheetmanage.generateRandomSheetName(luckysheet.getluckysheetfile(),isPivotTable);$("#luckysheet-sheet-container-c").append(luckysheet.replaceHtml(sheetHTML,{"index":index,"active":"","name":sheetname,"style":"","colorset":""}));var sheetconfig={"name":sheetname,"color":"","status":"0","order":order,"index":index,"celldata":[],"row":defaultrowNum,"column":defaultcolumnNum,"config":{},"pivotTable":null,"isPivotTable":!!isPivotTable};luckysheetfile.push(sheetconfig);$("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active");$("#luckysheet-sheets-item"+index).addClass("luckysheet-sheets-item-active");$("#luckysheet-cell-main").append('<div id="luckysheet-datavisual-selection-set-'+index+'" class="luckysheet-datavisual-selection-set"></div>');luckysheet.cleargridelement(e);luckysheet.server.saveParam("sha",null,$.extend(true,{},sheetconfig));if(clearjfundo){var redo={};redo["type"]="addSheet";luckysheet.jfundo=[];redo["sheetconfig"]=$.extend(true,{},sheetconfig);redo["index"]=index;redo["currentSheetIndex"]=luckysheet.currentSheetIndex;luckysheet.jfredo.push(redo);}this.changeSheetExec(index,isPivotTable,true);},setSheetHide:function setSheetHide(index){luckysheetfile[this.getSheetIndex(index)].hide=1;var luckysheetcurrentSheetitem=$("#luckysheet-sheets-item"+index);luckysheetcurrentSheetitem.hide();$("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active");var indicator=luckysheetcurrentSheetitem.nextAll(":visible");if(luckysheetcurrentSheetitem.nextAll(":visible").length>0){indicator=indicator.eq(0).data("index");}else {indicator=luckysheetcurrentSheetitem.prevAll(":visible").eq(0).data("index");}$("#luckysheet-sheets-item"+indicator).addClass("luckysheet-sheets-item-active");this.changeSheetExec(indicator);//luckysheet.server.saveParam("sh", index, {"cur": indicator, "hide": 1});
  luckysheet.server.saveParam("sh",luckysheetcurrentSheetitem.data("index"),1,{"op":"hide","cur":indicator});},setSheetShow:function setSheetShow(index){luckysheetfile[this.getSheetIndex(index)].hide=0;this.changeSheetExec(index);luckysheet.server.saveParam("sh",index,0,{"op":"show","cur":null});},sheetMaxIndex:0,ordersheet:function ordersheet(property){return function(a,b){var value1=a[property];var value2=b[property];return value1-value2;};},getCurrentOrder:function getCurrentOrder(){var orders={};$("#luckysheet-sheet-area div.luckysheet-sheets-item").each(function(a){var index=$(this).data("index");for(var i=0;i<luckysheetfile.length;i++){if(luckysheetfile[i].index==index){orders[index.toString()]=a;break;}}});return orders;},reOrderAllSheet:function reOrderAllSheet(){var orders={};$("#luckysheet-sheet-area div.luckysheet-sheets-item").each(function(a){var index=$(this).data("index");for(var i=0;i<luckysheetfile.length;i++){if(luckysheetfile[i].index==index){luckysheetfile[i].order=a;orders[index.toString()]=a;break;}}});luckysheet.server.saveParam("shr",null,orders);},createSheet:function createSheet(){//修复拖动sheet更新后台后，重新打开显示错误
  var btn=[];luckysheetfile.sort(this.ordersheet('order'));for(var i=0;i<luckysheetfile.length;i++){var display="";var sheetIndex=luckysheetfile[i].index;var colorset='';if(luckysheetfile[i].color!=null){colorset='<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+luckysheetfile[i].color+';"></div>';}if(luckysheet.currentSheetIndex==sheetIndex){//使用luckysheetfile中的index比较，而不是order
  btn.push(luckysheet.replaceHtml(sheetHTML,{"index":sheetIndex,"active":"luckysheet-sheets-item-active","name":luckysheetfile[i].name,"style":"","colorset":colorset}));}else {if(luckysheetfile[i].hide==1){btn.push(luckysheet.replaceHtml(sheetHTML,{"index":sheetIndex,"active":"","name":luckysheetfile[i].name,"style":"display:none;","colorset":colorset}));}else {btn.push(luckysheet.replaceHtml(sheetHTML,{"index":sheetIndex,"active":"","name":luckysheetfile[i].name,"style":"","colorset":colorset}));}display="style='display:none;'";}//luckysheetfile[i].index = i; //index即为默认
  // if(sheetIndex > this.sheetMaxIndex){
  //     this.sheetMaxIndex = sheetIndex;
  // }
  $("#luckysheet-cell-main").append('<div '+display+' id="luckysheet-datavisual-selection-set-'+sheetIndex+'" class="luckysheet-datavisual-selection-set"></div>');}$("#luckysheet-sheet-container-c").append(btn.join(""));this.locationSheet();},locationSheet:function locationSheet(){var $c=$("#luckysheet-sheet-container-c"),winW=$("#"+container).width();var $cursheet=$("#luckysheet-sheet-container-c > div.luckysheet-sheets-item-active").eq(0);var scrollLeftpx=0;var c_width=0;$("#luckysheet-sheet-container-c > div.luckysheet-sheets-item:visible").each(function(){if($(this).hasClass("luckysheet-sheets-item-active")){scrollLeftpx=c_width;}c_width+=$(this).outerWidth();});setTimeout(function(){$c.scrollLeft(scrollLeftpx-10);if(c_width>=winW*0.7){$("#luckysheet-sheet-area .luckysheet-sheets-scroll").css("display","inline-block");$("#luckysheet-sheet-container .docs-sheet-fade-left").show();}},1);},copySheet:function copySheet(copyindex,e){if(luckysheet.isEditMode()){// alert("非编辑模式下不允许该操作！");
  return;}var order=luckysheetfile.length;var index=luckysheet.sheetmanage.generateRandomSheetIndex();var copyarrindex=this.getSheetIndex(copyindex);var copyjson=$.extend(true,{},luckysheetfile[copyarrindex]);copyjson.order=order;copyjson.index=index;copyjson.name=this.generateCopySheetName(luckysheetfile,copyjson.name);var colorset='';if(copyjson.color!=null){colorset='<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+copyjson.color+';"></div>';}var copyobject=$("#luckysheet-sheets-item"+copyindex);$("#luckysheet-sheet-container-c").append(luckysheet.replaceHtml(sheetHTML,{"index":copyjson.index,"active":"","name":copyjson.name,"order":copyjson.order,"style":"","colorset":colorset}));$("#luckysheet-sheets-item"+copyjson.index).insertAfter(copyobject);// luckysheetfile.push(copyjson);
  luckysheetfile.splice(copyindex+1,0,copyjson);$("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active");$("#luckysheet-sheets-item"+index).addClass("luckysheet-sheets-item-active");$("#luckysheet-cell-main").append('<div id="luckysheet-datavisual-selection-set-'+index+'" class="luckysheet-datavisual-selection-set"></div>');luckysheet.cleargridelement(e);// luckysheet.server.saveParam("shc", index, {"copyindex":copyindex});
  luckysheet.server.saveParam("shc",index,{"copyindex":copyindex,"name":copyjson.name});this.changeSheetExec(index);this.reOrderAllSheet();if(clearjfundo){luckysheet.jfredo.push({"type":"copySheet","copyindex":copyindex,"index":copyjson.index,"sheetIndex":copyjson.index});}else if(luckysheet.jfredo.length>0){var jfredostr=luckysheet.jfredo[luckysheet.jfredo.length-1];if(jfredostr.type=="copySheet"){jfredostr.index=copyjson.index;jfredostr.sheetIndex=copyjson.index;}}},hasSheet:function hasSheet(index){if(index==null){return false;}index=this.getSheetIndex(index);if(index==null){return false;}else {return true;}},createSheetbydata:function createSheetbydata(data,isrenew){var colorset='';if(data.color!=null){colorset='<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+data.color+';"></div>';}$("#luckysheet-sheet-container-c").append(luckysheet.replaceHtml(sheetHTML,{"index":data.index,"active":"","name":data.name,"order":data.order,"style":"","colorset":colorset}));var previndex=data.order;if(previndex>=luckysheetfile.length){previndex=luckysheetfile.length-1;$("#luckysheet-sheets-item"+data.index).insertAfter($("#luckysheet-sheets-item"+luckysheetfile[previndex].index));}else {$("#luckysheet-sheets-item"+data.index).insertBefore($("#luckysheet-sheets-item"+luckysheetfile[previndex].index));}luckysheetfile.push(data);$("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active");$("#luckysheet-sheets-item"+data.index).addClass("luckysheet-sheets-item-active");$("#luckysheet-cell-main").append('<div id="luckysheet-datavisual-selection-set-'+data.index+'" class="luckysheet-datavisual-selection-set"></div>');luckysheet.cleargridelement();if(isrenew!=null){luckysheet.server.saveParam("shre",null,{"reIndex":data.index});data.hide=0;luckysheet.server.saveParam("sh",data.index,0,{"op":"show","cur":null});}else {luckysheet.server.saveParam("sha",null,data);}this.changeSheetExec(data.index,data.isPivotTable,true);this.reOrderAllSheet();},deleteSheet:function deleteSheet(index){var arrIndex=this.getSheetIndex(index);this.setSheetHide(index);$("#luckysheet-sheets-item"+index).remove();$("#luckysheet-datavisual-selection-set-"+index).remove();var removedsheet=luckysheetfile.splice(arrIndex,1);this.reOrderAllSheet();luckysheet.server.saveParam("shd",null,{"deleIndex":index});if(clearjfundo){removedsheet[0].type="deleteSheet";luckysheet.jfredo.push(removedsheet[0]);}},nulldata:null,getGridData:function getGridData(d){var ret=[];for(var r=0;r<d.length;r++){for(var c=0;c<d[0].length;c++){if(d[r][c]==null){continue;}ret.push({r:r,c:c,v:d[r][c]});}}return ret;},buildGridData:function buildGridData(file){var row=file.row==null?defaultrowNum:file.row,column=file.column==null?defaultcolumnNum:file.column;var data=luckysheet.datagridgrowth([],row,column);var celldata=file.celldata;if(celldata!=null){for(var i=0;i<celldata.length;i++){var item=celldata[i];var r=item.r;var c=item.c;var v=item.v;if(r>=data.length){data=luckysheet.datagridgrowth(data,r-data.length+1,0);}if(c>=data[0].length){data=luckysheet.datagridgrowth(data,0,c-data[0].length+1);}luckysheet.setcellvalue(r,c,data,v);}}//亿万格式+精确度 恢复全局初始化
  luckysheetConfigsetting.autoFormatw=false;luckysheetConfigsetting.accuracy=undefined;return data;},cutGridData:function cutGridData(d){var rowindex=0;for(var r=d.length-1;r>=0;r--){var isnull=true;for(var c=0;c<d[0].length;c++){var value=luckysheet.getcellvalue(r,c);if(value!=null&&$.trim(value).length>0){isnull=false;break;}}if(!isnull){break;}else {rowindex=r;}}return d.slice(0,rowindex);},addGridData:function addGridData(celldata,row,column){var data=luckysheet.datagridgrowth([],row,column);if(celldata!=null){for(var i=0;i<celldata.length;i++){var item=celldata[i];var r=item.r;var c=item.c;var v=item.v;if(r>=data.length){data=luckysheet.datagridgrowth(data,r-data.length+1,0);}if(c>=data[0].length){data=luckysheet.datagridgrowth(data,0,c-data[0].length+1);}luckysheet.setcellvalue(r,c,data,v);}}return data;},initialjfFile:function initialjfFile(menu,title){var _this=this;this.getCurSheet();var file=luckysheetfile[_this.getSheetIndex(luckysheet.currentSheetIndex)];this.nulldata=luckysheet.datagridgrowth([],defaultrowNum,defaultcolumnNum);var data=_this.buildGridData(file);luckysheet_select_save=file["luckysheet_select_save"];if(luckysheet_select_save==null||luckysheet_select_save.length==0){if(data[0]!=null&&data[0][0]!=null&&data[0][0].mc!=null){luckysheet_select_save=[{"row":[0,data[0][0].mc.rs-1],"column":[0,data[0][0].mc.cs-1]}];}else {luckysheet_select_save=[{"row":[0,0],"column":[0,0]}];}}luckysheet_selection_range=file["luckysheet_selection_range"]==null?[]:file["luckysheet_selection_range"];config=file["config"]==null?{}:file["config"];var r2=luckysheet_select_save[0].row[1],c2=luckysheet_select_save[0].column[1];if(luckysheet_select_save.length>1){for(var i=0;i<luckysheet_select_save.length;i++){if(luckysheet_select_save[i].row[1]>r2){r2=luckysheet_select_save[i].row[1];}if(luckysheet_select_save[i].column[1]>c2){c2=luckysheet_select_save[i].column[1];}}}file.data=data;var rowheight=data.length;if(r2>rowheight-1){rowheight=r2+1;}var colwidth=data[0].length;if(c2>colwidth-1){colwidth=c2+1;}luckysheet.luckysheetcreatedom(colwidth,rowheight,data,menu,title);setTimeout(function(){luckysheet.tooltip.createHoverTip("#luckysheet_info_detail",".luckysheet_info_detail_title, .luckysheet_info_detail_input, .luckysheet_info_detail_update");luckysheet.tooltip.createHoverTip("#luckysheet-wa-editor",".luckysheet-toolbar-menu-button, .luckysheet-toolbar-button, .luckysheet-toolbar-combo-button");luckysheetTableContentHW=[$("#luckysheet-cell-main").width()+rowHeaderWidth-cellMainSrollBarSize,$("#luckysheet-cell-main").height()+columeHeaderHeight-cellMainSrollBarSize];$("#luckysheetTableContent, #luckysheetTableContentF").attr({width:Math.ceil(luckysheetTableContentHW[0]*devicePixelRatio),height:Math.ceil(luckysheetTableContentHW[1]*devicePixelRatio)}).css({width:luckysheetTableContentHW[0],height:luckysheetTableContentHW[1]}).get(0).getContext("2d");var key=luckysheet.server.gridKey;var cahce_key=key+"__qkcache";var ini=function ini(){file["load"]="1";_this.createSheet();var sheetindexset=_this.checkLoadSheetIndex(file);var sheetindex=[];for(var i=0;i<sheetindexset.length;i++){var item=sheetindexset[i];if(item==file["index"]){continue;}sheetindex.push(item);}var execF=function execF(){_this.storeSheetParam();_this.restoreselect();luckysheet.sheetmanage.CacheNotLoadControll=[];luckysheet.sheetmanage.restoreCache();luckysheet.formula.execFunctionGroup();luckysheet.sheetmanage.restoreSheetAll(luckysheet.currentSheetIndex);// $("#luckysheetTableContent").get(0).getContext("2d") ;
  // $("#luckysheetTableContentF").get(0).getContext("2d") ;
  luckysheet.luckysheetrefreshgrid(0,0);$("#luckysheet_info_detail_save").html("已恢复本地缓存");if(!!file.isPivotTable){luckysheetcurrentisPivotTable=true;luckysheet.pivotTable.changePivotTable(luckysheet.currentSheetIndex);}else {luckysheetcurrentisPivotTable=false;$("#luckysheet-modal-dialog-slider-pivot").hide();luckysheet.luckysheetsizeauto();}if(typeof luckysheet.luckysheetConfigsetting.beforeCreateDom=="function"){luckysheet.luckysheetConfigsetting.beforeCreateDom(luckysheet);}if(luckysheetConfigsetting.pointEdit){setTimeout(function(){$("#luckysheetloadingdata").remove();},0);}else {setTimeout(function(){$("#luckysheetloadingdata").fadeOut().remove();},500);}};var loadSheetUrl=luckysheet.server.loadSheetUrl;if(sheetindex.length==0||loadSheetUrl==""){execF();}else {$.post(loadSheetUrl,{"gridKey":luckysheet.server.gridKey,"index":sheetindex.join(",")},function(d){var dataset=eval("("+d+")");for(var item in dataset){if(item==file["index"]){continue;}var otherfile=luckysheetfile[_this.getSheetIndex(item)];if(otherfile["load"]==null||otherfile["load"]=="0"){otherfile.celldata=dataset[item.toString()];otherfile["data"]=_this.buildGridData(otherfile);otherfile["load"]="1";}}execF();});}};//ini();
  try{localforage.getItem(cahce_key).then(function(readValue){if(readValue!=null){luckysheet.sheetmanage.CacheNotLoadControll=readValue;}// console.log("2");
  luckysheet.server.clearcachelocaldata(function(){ini();});});}catch(e){// statements
  ini();console.log("缓存操作失败");}// setTimeout(function(){
  //     luckysheet.server.imageRequest();
  // }, 1000);
  },1);},storeSheetParam:function storeSheetParam(){var index=this.getSheetIndex(luckysheet.currentSheetIndex);var file=luckysheetfile[index];file["visibledatarow"]=visibledatarow;file["visibledatacolumn"]=visibledatacolumn;file["rowsplit"]=rowsplit;file["ch_width"]=ch_width;file["rh_height"]=rh_height;file["luckysheet_select_save"]=$.extend(true,[],luckysheet_select_save);file["luckysheet_selection_range"]=$.extend(true,[],luckysheet_selection_range);file["scrollLeft"]=$("#luckysheet-cell-main").scrollLeft();//列标题
  file["scrollTop"]=$("#luckysheet-cell-main").scrollTop();//行标题
  },setSheetParam:function setSheetParam(isload){var index=this.getSheetIndex(luckysheet.currentSheetIndex);var file=luckysheetfile[index];luckysheet.flowdata=file["data"];luckysheet.editor.webWorkerFlowDataCache(luckysheet.flowdata);//worker存数据
  luckysheet.postil.buildAllPs(luckysheet.flowdata);config=file["config"];luckysheet_select_save=file["luckysheet_select_save"]==null?[]:file["luckysheet_select_save"];luckysheet_selection_range=file["luckysheet_selection_range"]==null?[]:file["luckysheet_selection_range"];if(file["freezen"]==null){luckysheet.freezen.freezenhorizontaldata=null;luckysheet.freezen.freezenverticaldata=null;}else {luckysheet.freezen.freezenhorizontaldata=file["freezen"].horizontal==null?null:file["freezen"].horizontal.freezenhorizontaldata;luckysheet.freezen.freezenverticaldata=file["freezen"].vertical==null?null:file["freezen"].vertical.freezenverticaldata;}luckysheet.createFilterOptions(file["filter_select"],file["filter"]);luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);// if( !!isload && (file["visibledatarow"] == null || file["visibledatarow"].length == 0 || file["visibledatacolumn"] == null || file["visibledatacolumn"].length == 0 || file["rowsplit"] == null || file["ch_width"] == null || file["rh_height"] == null)){
  //     luckysheet.luckysheetcreatesheet(file["data"][0].length, file["data"].length, file["data"], file["config"], false);
  // }
  // else{
  //     visibledatarow = file["visibledatarow"];
  //     visibledatacolumn = file["visibledatacolumn"];
  //     rowsplit = file["rowsplit"];
  //     ch_width = file["ch_width"];
  //     rh_height = file["rh_height"];
  //     luckysheet.flowdata = file["data"];
  //     setTimeout(function(){
  //         luckysheet.editor.webWorkerFlowDataCache(file["data"]);//worker存数据
  //     },0);
  //     config = file["config"];
  // }
  // luckysheet_select_save = file["luckysheet_select_save"];
  // luckysheet_selection_range = file["luckysheet_selection_range"];
  },restoreselect:function restoreselect(){var index=this.getSheetIndex(luckysheet.currentSheetIndex);var file=luckysheetfile[index];//选区
  luckysheet.selectHightlightShow();//复制选区虚线框
  luckysheet.selectionCopyShow();if(file["scrollLeft"]!=null&&file["scrollLeft"]>0){$("#luckysheet-scrollbar-x").scrollLeft(file["scrollLeft"]);//列标题
  }else {$("#luckysheet-scrollbar-x").scrollLeft(0);}if(file["scrollTop"]!=null&&file["scrollTop"]>0){$("#luckysheet-scrollbar-y").scrollTop(file["scrollTop"]);//列标题
  }else {$("#luckysheet-scrollbar-y").scrollTop(0);}},storeSheetParamALL:function storeSheetParamALL(){this.storeSheetParam();var index=this.getSheetIndex(luckysheet.currentSheetIndex);luckysheetfile[index]["data"]=luckysheet.flowdata;luckysheetfile[index]["config"]=$.extend(true,{},config);},changeSheet:function changeSheet(index,isPivotInitial,isNewSheet){if(luckysheet.isEditMode()){// alert("非编辑模式下不允许该操作！");
  return;}if(luckysheet.server.allowUpdate){$("#luckysheet-cell-main #luckysheet-multipleRange-show").empty();luckysheet.server.multipleIndex=0;}$('#luckysheet-filter-selected-sheet'+luckysheet.currentSheetIndex+', #luckysheet-filter-options-sheet'+luckysheet.currentSheetIndex).hide();$('#luckysheet-filter-selected-sheet'+index+', #luckysheet-filter-options-sheet'+index).show();this.storeSheetParamALL();this.setCurSheet(index);var file=luckysheetfile[this.getSheetIndex(index)],data=file.data,cfg=file.config;if(!!file.isPivotTable){luckysheetcurrentisPivotTable=true;if(!isPivotInitial){luckysheet.pivotTable.changePivotTable(index);}}else {luckysheetcurrentisPivotTable=false;$("#luckysheet-modal-dialog-slider-pivot").hide();luckysheet.luckysheetsizeauto();}var _this=this;var load=file["load"];if(load!=null){_this.setSheetParam(true);_this.showSheet();setTimeout(function(){//luckysheet.flowdata = data;
  luckysheet.formula.execFunctionGroup();luckysheet.luckysheetrefreshgrid();luckysheet.server.saveParam("shs",null,luckysheet.currentSheetIndex);},1);}else {//$("#" + container + " div.luckysheetsheetchange").hide();
  var loadSheetUrl=luckysheet.server.loadSheetUrl;if(loadSheetUrl==""||luckysheetcurrentisPivotTable||!!isNewSheet){//var row = file.row==null?defaultrowNum:file.row, column = file.cloumn==null?defaultcolumnNum:file.cloumn;
  var data=_this.buildGridData(file);file["data"]=data;file["load"]="1";_this.setSheetParam();_this.showSheet();setTimeout(function(){luckysheet.sheetmanage.restoreCache();luckysheet.formula.execFunctionGroup();luckysheet.sheetmanage.restoreSheetAll(luckysheet.currentSheetIndex);luckysheet.luckysheetrefreshgrid();},1);luckysheet.server.saveParam("shs",null,luckysheet.currentSheetIndex);}else {$("#luckysheet-grid-window-1").append('<div id="luckysheetloadingdata" style="width:100%;text-align:center;position:absolute;top:0px;height:100%;font-size: 16px;z-index:1000000000;background:#fff;"><div style="position:relative;top:45%;width:100%;"> <div class="luckysheetLoaderGif"></div> <span>渲染中...</span></div></div>');var sheetindex=this.checkLoadSheetIndex(file);$.post(loadSheetUrl,{"gridKey":luckysheet.server.gridKey,"index":sheetindex.join(",")},function(d){var dataset=eval("("+d+")");file.celldata=dataset[index.toString()];var data=_this.buildGridData(file);setTimeout(function(){$("#luckysheetloadingdata").fadeOut().remove();},500);for(var item in dataset){if(item==index){continue;}var otherfile=luckysheetfile[_this.getSheetIndex(item)];if(otherfile["load"]==null||otherfile["load"]=="0"){otherfile.celldata=dataset[item.toString()];otherfile["data"]=_this.buildGridData(otherfile);otherfile["load"]="1";}}file["data"]=data;file["load"]="1";_this.setSheetParam();_this.showSheet();setTimeout(function(){luckysheet.sheetmanage.restoreCache();luckysheet.formula.execFunctionGroup();luckysheet.sheetmanage.restoreSheetAll(luckysheet.currentSheetIndex);luckysheet.luckysheetrefreshgrid();},1);luckysheet.server.saveParam("shs",null,luckysheet.currentSheetIndex);});}}$("#luckysheet-cell-main .luckysheet-datavisual-selection-set").hide();$("#luckysheet-datavisual-selection-set-"+index).show();//隐藏其他sheet的图表，显示当前sheet的图表 chartMix
  !!window.generator&&generator.renderChartShow(index);// $("#luckysheet-cell-main .luckysheet-data-visualization-chart[sheetIndex!='" + index + "']").hide();
  // $("#luckysheet-cell-main .luckysheet-data-visualization-chart[sheetIndex='" + index + "']").show();
  luckysheet.freezen.initialFreezen(index);this.restoreselect();},checkLoadSheetIndex:function checkLoadSheetIndex(file){var calchain=file.calcChain;//index
  var chart=file.chart;//dataSheetIndex
  var pivotTable=file.pivotTable;//pivotDataSheetIndex
  var ret=[],cache={};ret.push(file.index);cache[file.index.toString()]=1;if(calchain!=null){for(var i=0;i<calchain.length;i++){var func=calchain[i];var dataindex=func.index;if(dataindex==null){continue;}if(cache[dataindex.toString()]==null){ret.push(dataindex);cache[dataindex.toString()]=1;}}}if(chart!=null){for(var i=0;i<chart.length;i++){var cc=chart[i];var dataindex=cc.dataSheetIndex;if(dataindex==null){continue;}if(cache[dataindex.toString()]==null){ret.push(dataindex);cache[dataindex.toString()]=1;}}}if(pivotTable!=null){var dataindex=pivotTable.pivotDataSheetIndex;if(dataindex!=null&&cache[dataindex.toString()]==null){ret.push(dataindex);cache[dataindex.toString()]=1;}}return ret;},showSheet:function showSheet(){//$("#" + container + " div.luckysheetsheetchange").hide();
  // $("#luckysheetrowHeader_" + luckysheet.currentSheetIndex).show();
  // $("#luckysheet-cell-flow_" + luckysheet.currentSheetIndex).show();
  // $("#luckysheet-cols-h-cells_" + luckysheet.currentSheetIndex).show();
  $("#luckysheet-cell-flow_0").css({"width":ch_width,"top":"-1px"});//width更新
  $("#luckysheet-sheettable_0").css({"width":ch_width-1,"height":rh_height});$("#luckysheetrowHeader_0").css("height",rh_height);$("#luckysheet-cols-h-cells_0").css("width",ch_width);//width更新
  $("#luckysheet-scrollbar-x div").width(ch_width);$("#luckysheet-scrollbar-y div").height(rh_height-30);},setCurSheet:function setCurSheet(index){for(var i=0;i<luckysheetfile.length;i++){if(luckysheetfile[i]["index"]==index){luckysheetfile[i].status=1;}else {luckysheetfile[i].status=0;}}luckysheet.currentSheetIndex=index;},getSheetIndex:function getSheetIndex(index){for(var i=0;i<luckysheetfile.length;i++){if(luckysheetfile[i]["index"]==index){return i;}}return null;},changeSheetExec:function changeSheetExec(index,isPivotInitial,isNewSheet){var $sheet=$("#luckysheet-sheets-item"+index);//sheet-filter切换
  //$('#luckysheet-filter-selected-sheet'+ luckysheet.currentSheetIndex +', #luckysheet-filter-options-sheet'+ luckysheet.currentSheetIndex).hide();
  //$('#luckysheet-filter-selected-sheet'+ index +', #luckysheet-filter-options-sheet'+ index).show();
  //$("#luckysheet-cell-main").append('<div id="luckysheet-datavisual-selection-set-' + i + '" class="luckysheet-datavisual-selection-set"></div>');
  window.luckysheet_getcelldata_cache=null;$("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active");$sheet.addClass("luckysheet-sheets-item-active").show();luckysheet.cleargridelement();this.changeSheet(index,isPivotInitial,isNewSheet);$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();if(luckysheet.formula.rangestart){luckysheet.formula.createRangeHightlight();}var $c=$("#luckysheet-sheet-container-c");$c.scrollLeft($sheet.offset().left);var c_width=$c.width(),c_srollwidth=$c[0].scrollWidth,scrollLeft=$c.scrollLeft();if(scrollLeft<=0){$("#luckysheet-sheet-container .docs-sheet-fade-left").hide();}else {$("#luckysheet-sheet-container .docs-sheet-fade-left").show();}if(c_width+scrollLeft>=c_srollwidth){$("#luckysheet-sheet-container .docs-sheet-fade-right").hide();}else {$("#luckysheet-sheet-container .docs-sheet-fade-right").show();}},delChart:function delChart(chart_id,sheetIndex){var index=this.getSheetIndex(sheetIndex);var file=luckysheetfile[index];if(file.chart==null){file.chart=[];}else {for(var i=0;i<file.chart.length;i++){if(file.chart[i].chart_id==chart_id){luckysheetfile[index].chart.splice(i,1);break;}}}},saveChart:function saveChart(json){//采用chartMix store存储，弃用luckysheetfile存储，防止重复存储
  var index=this.getSheetIndex(json.sheetIndex);var file=luckysheetfile[index];if(file.chart==null){file.chart=[];file.chart.push(json);}else {for(var i=0;i<file.chart.length;i++){if(file.chart[i].chart_id==json.chart_id){var old=$.extend(true,{},file.chart[i]);file.chart[i]=$.extend(true,{},old,json);return;}}file.chart.push(json);}},getChart:function getChart(sheetIndex,chart_id){var index=getSheetIndex(sheetIndex);var file=luckysheetfile[index];if(file.chart==null){return null;}else {for(var i=0;i<file.chart.length;i++){if(file.chart[i].chart_id==chart_id){return file.chart[i];}}return null;}},restoreChart:function restoreChart(sheetIndex){if(luckysheet.chartparam.luckysheet_chartIns_index==-1){luckysheet.chartparam.luckysheet_chartIns_index=0;for(var i=0;i<luckysheetfile.length;i++){var chart=luckysheetfile[i].chart;if(chart!=null){luckysheet.chartparam.luckysheet_chartIns_index+=chart.length;}}}var index=this.getSheetIndex(sheetIndex);var file=luckysheetfile[index];if(file.chart!=null){for(var i=0;i<file.chart.length;i++){var c=file.chart[i];if(c.sheetIndex==null||c.dataSheetIndex==null||c.row==null||c.column==null){continue;}if($("#"+c.chart_id).length==0){var chart_selection_color=null;var chart_id=null;var chart_selection_id=null;if(c.chart_id!=null){chart_id=c.chart_id;var chart_id_index=parseInt(chart_id);if(isNaN(chart_id_index)){chart_id_index=luckysheet.chartparam.luckysheet_chartIns_index++;}else {if(chart_id_index>luckysheet.chartparam.luckysheet_chartIns_index){luckysheet.chartparam.luckysheet_chartIns_index=chart_id_index;}}chart_selection_color=luckysheet.jfcolor[chart_id_index];chart_selection_id=chart_id+"_selection";}else {chart_selection_color=luckysheet.jfcolor[luckysheet.chartparam.luckysheet_chartIns_index];chart_id="luckysheet-datav-chart-"+luckysheet.chartparam.luckysheet_chartIns_index++;chart_selection_id=chart_id+"_selection";c.chart_id=chart_id;}var chartTheme=c.chartTheme;chartTheme=chartTheme==null?"default0000":chartTheme;luckysheet.insertChartTosheet(c.sheetIndex,c.dataSheetIndex,c.option,c.chartType,c.selfOption,c.defaultOption,c.row,c.column,chart_selection_color,chart_id,chart_selection_id,c.chartStyle,c.rangeConfigCheck,c.rangeRowCheck,c.rangeColCheck,c.chartMarkConfig,c.chartTitleConfig,c.winWidth,c.winHeight,c.scrollLeft,c.scrollTop,chartTheme,c.myWidth,c.myHeight,c.myLeft!=null?parseFloat(c.myLeft):null,c.myTop!=null?parseFloat(c.myTop):null,c.myindexrank,true);}}}},getRangetxt:function getRangetxt(sheetIndex,range,currentIndex){var sheettxt="";if(currentIndex==null){currentIndex=luckysheet.currentSheetIndex;}if(sheetIndex!=currentIndex){sheettxt=luckysheetfile[this.getSheetIndex(sheetIndex)].name+"!";}var row0=range["row"][0],row1=range["row"][1];var column0=range["column"][0],column1=range["column"][1];if(row0==null&&row1==null){return sheettxt+luckysheet.luckysheetchatatABC(column0)+":"+luckysheet.luckysheetchatatABC(column1);}else if(column0==null&&column1==null){return sheettxt+(row0+1)+":"+(row1+1);}else {if(column0==column1&&row0==row1){return sheettxt+luckysheet.luckysheetchatatABC(column0)+(row0+1);}else {return sheettxt+luckysheet.luckysheetchatatABC(column0)+(row0+1)+":"+luckysheet.luckysheetchatatABC(column1)+(row1+1);}}},getSheetName:function getSheetName(sheetIndex){if(sheetIndex==null){sheetIndex=luckysheet.currentSheetIndex;}return luckysheetfile[this.getSheetIndex(sheetIndex)].name;},getSheetMerge:function getSheetMerge(){if(config.merge==null){return null;}return config.merge;},getSheetData:function getSheetData(sheetIndex){if(sheetIndex==null){sheetIndex=luckysheet.currentSheetIndex;}return luckysheetfile[this.getSheetIndex(sheetIndex)].data;},getSheetConfig:function getSheetConfig(sheetIndex){if(sheetIndex==null){sheetIndex=luckysheet.currentSheetIndex;}var config=luckysheetfile[this.getSheetIndex(sheetIndex)].config;if(config==null){luckysheetfile[this.getSheetIndex(sheetIndex)].config={};}return luckysheetfile[this.getSheetIndex(sheetIndex)].config;},restoreFilter:function restoreFilter(sheetIndex){var index=this.getSheetIndex(sheetIndex);var file=luckysheetfile[index];if($('#luckysheet-filter-selected-sheet'+sheetIndex).length>0||file.filter_select==null||JSON.stringify(file.filter_select)=="{}"){if(file.config!=null&&file.config.rowhidden!=null){file.config.rowhidden={};config=file.config;luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);}return;}if(luckysheet.getObjType(file.filter_select)!="object"){file.filter_select=JSON.parse(file.filter_select);}if(file.filter_select==null||file.filter_select.row==null||file.filter_select.column==null){return;}luckysheet.createFilterOptions(file.filter_select);if(luckysheet.getObjType(file.filter)!="object"){if(file.filter!=null&&luckysheet.getObjType(file.filter)=="string"){file.filter=JSON.parse(file.filter);}}var rowhidden={};if(file.config!=null&&file.config.rowhidden!=null){rowhidden=file.config.rowhidden;}$("#luckysheet-filter-options-sheet"+sheetIndex+" .luckysheet-filter-options").each(function(i){if(file.filter==null){return false;}var $top=$(this);var item=file.filter[i];if(item==null){return true;}if(luckysheet.getObjType(item)!="object"){item=JSON.parse(item);}luckysheet.labelFilterOptionState($top,item.optionstate,item.rowhidden,item.caljs,false,item.st_r,item.ed_r,item.cindex,item.st_c,item.ed_c);rowhidden=$.extend(true,rowhidden,item.rowhidden);});if(file.config==null){file.config={};}file.config["rowhidden"]=rowhidden;config=file.config;luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);// var $t = $("#luckysheet-filter-options-sheet" + sheetIndex + " .luckysheet-filter-options").eq(0);
  // luckysheet.filterseletedbyindex($t.data("str"), $t.data("edr"), $t.data("stc"), $t.data("edc"));
  },restorePivot:function restorePivot(sheetIndex){var index=this.getSheetIndex(sheetIndex);var file=luckysheetfile[index];if(!file.isPivotTable){return;}luckysheet.pivotTable.getCellData(sheetIndex);luckysheet.pivotTable.initialPivotManage(true);luckysheet.pivotTable.refreshPivotTable();},restoreSheetAll:function restoreSheetAll(sheetIndex){var _this=this;_this.restorePivot(sheetIndex);_this.restoreFilter(sheetIndex);// _this.restoreChart(sheetIndex);//TODO:chartMix重写restoreChart方法
  _this.restoreFreezen(sheetIndex);},restoreFreezen:function restoreFreezen(sheetIndex){luckysheet.freezen.initialFreezen(sheetIndex);},restoreCache:function restoreCache(){var key=luckysheet.server.gridKey;var _this=this;var data=_this.CacheNotLoadControll;//.concat(ret);
  _this.CacheNotLoadControll=[];if(data.length==0){return;}console.log(data);for(var i=0;i<data.length;i++){var item=data[i];_this.execCache(item);}// localforage.getItem(cahce_key).then(function(readValue) {
  //     if(readValue!=null){
  //         _this.CacheNotLoadControll = readValue;
  //     }
  //     luckysheet.server.getlocaldata(function(ret){
  //         if(ret==null){
  //             ret = [];
  //         }
  //         var data = _this.CacheNotLoadControll;
  //         //.concat(ret);
  //         _this.CacheNotLoadControll = [];
  //         if(data.length==0){
  //             return;
  //         }
  //         for(var i=0;i<data.length;i++){
  //             var item = data[i];
  //             _this.execCache(item);
  //         }
  //         luckysheet.server.clearcachelocaldata(function(){
  //             $("#luckysheet_info_detail_save").html("已恢复本地缓存");
  //         });
  //     });
  // });
  },CacheNotLoadControll:[],execCache:function execCache(item){var type=item.t;var index=item.i;var value=item.v;var _this=this;var file=luckysheetfile[_this.getSheetIndex(index)];if(type=="sha"){luckysheetfile.push(value);}else if(type=="shc"){var copyjson=$.extend(true,{},luckysheetfile[_this.getSheetIndex(value.copyindex)]);copyjson.index=index;luckysheetfile.push(copyjson);}else if(type=="shd"){luckysheetfile.splice(value.deleIndex,1);}else if(type=="shr"){for(var pos in value){luckysheetfile[_this.getSheetIndex(pos)].order=value[pos];}}if((file==null||file.load!="1")&&!(type in{"sha":0,"shc":0,"shd":0,"shr":0})){_this.CacheNotLoadControll.push(item);return;}if(type=="v"){var r=item.r,c=item.c,v=item.v;var data=_this.getSheetData(index);file.data[r][c]=v;}else if(type=="fc"){var op=item.op,pos=item.pos;if(luckysheet.getObjType(value)!="object"){value=eval('('+value+')');}var r=value.r,c=value.c;var func=value.func;if(op=="del"){luckysheet.formula.delFunctionGroup(r,c,index);}else {luckysheet.formula.insertUpdateFunctionGroup(r,c,func,index);}}else if(type=="cg"){var v=value,k=item.k;var config1=_this.getSheetConfig(index);if(!(k in config1)){config1[k]={};}for(var key in v){config1[k][key]=v[key];}config=config1;// else if(rc=="c"){
  //     for(var key in v){
  //         if(config.columlen==null){
  //             config.columlen = {};
  //         }
  //         config.columlen[key] = v[key];
  //     }
  // }
  }else if(type=="f"){var v=value,op=item.op,pos=item.pos;var filter=file.filter;if(filter==null){filter={};}if(op=="upOrAdd"){filter[pos]=v;}else if(op=="del"){delete filter[pos];}}else if(type=="fsc"){file.filter=null;file.filter_select=null;}else if(type=="fsr"){var v=value;file.filter=v.filter;file.filter_select=v.filter_select;}else if(type=="sh"){var op=item.op,cur=item.cur,v=value;if(op=="hide"){file.status=0;luckysheetfile[_this.getSheetIndex(cur)].status=1;}else if(op=="show"){for(var i=0;i<luckysheetfile.length;i++){luckysheetfile[i].status=0;}file.status=1;}}else if(type=="all"){var k=item.k,s=item.s;if(s&&luckysheet.getObjType(value)!="object"){file[k]=JSON.stringify(value);}else {file[k]=value;}}// else if(type=="fs"){
  //     var v = value;
  //     file.filter_select = v;
  // }
  // else if(op=="color"){
  //     file.color = v;
  // }
  // if(op=="name"){
  //     file.name = v;
  // }
  // else if(type=="p"){
  //     file.pivotTable = value;
  // }
  else if(type=="c"){var op=item.op,cid=item.cid;if(op=="add"){file.chart.push(value);}else if(op=="xy"||op=="wh"||op=="update"){for(var i=0;i<file.chart.length;i++){if(file.chart[i].chart_id==cid){for(var item in file.chart[i]){for(var vitem in value){if(item==vitem){file.chart[i][item]=value[vitem];}}}return;}}}else if(op=="del"){for(var i=0;i<file.chart.length;i++){if(file.chart[i].chart_id==cid){file.chart.splice(i,1);return;}}}}else if(type=="drc"){var rc=item.rc,index=value.index,len=value.len;var celldata=file.celldata;if(rc=="r"){// for(var i = 0; celldata.length < 0; i++){
  //     var cell = celldata[i];
  //     if(cell.r >= index && cell.r < index + len){
  //         delete cell;
  //     }
  //     else if(cell.r >= index + len){
  //         cell.r -= len;
  //     }
  // }
  for(var i=0;celldata.length==0;i++){var cell=celldata[i];if(cell.r>=index&&cell.r<index+len){// delete cell;
  delete celldata[i];}else if(cell.r>=index+len){cell.r-=len;}}file.row-=len;}else {// for(var i = 0; celldata.length < 0; i++){
  //     var cell = celldata[i];
  //     if(cell.c >= index && cell.c < index + len){
  //         delete cell;
  //     }
  //     else if(cell.c >= index + len){
  //         cell.c -= len;
  //     }
  // }
  for(var i=0;celldata.length==0;i++){var cell=celldata[i];if(cell.c>=index&&cell.c<index+len){// delete cell;
  delete celldata[i];}else if(cell.c>=index+len){cell.c-=len;}}file.column-=len;}var ret=[];for(var i=0;i<celldata.length;i++){if(celldata[i]!=null){ret.push(celldata[i]);}}file.celldata=ret;var mtype,mst,med;if(rc=="r"){mtype="row";}else {mtype="column";}mst=index;med=index+len-1;luckysheet.luckysheetdeletetable(mtype,mst,med,true);// setTimeout(function(){
  //     luckysheet.jfrefreshgridall(luckysheet.flowdata[0].length, luckysheet.flowdata.length, luckysheet.flowdata);
  // }, 10);
  }else if(type=="arc"){var rc=item.rc,index=value.index,len=value.len;var celldata=file.celldata;if(rc=="r"){// for(var i = 0; celldata.length < 0; i++){
  //     var cell = celldata[i];
  //     if(cell.r > index){
  //         cell.r += len;
  //     }
  // }
  for(var i=0;i<celldata.length;i++){var cell=celldata[i];if(cell.r>index){cell.r+=len;}}file.row+=len;}else {// for(var i = 0; celldata.length < 0; i++){
  //     var cell = celldata[i];
  //     if(cell.c > index){
  //         cell.c += len;
  //     }
  // }
  for(var i=0;i<celldata.length;i++){var cell=celldata[i];if(cell.c>index){cell.c+=len;}}file.column+=len;}var mtype;if(rc=="r"){mtype="row";}else {mtype="column";}// mst = index;
  // med = index + len - 1;
  //console.log(rc,mtype, mst, med);
  luckysheet.luckysheetextendtable(mtype,index,len,true);// var ret = [];
  // for(var i=0;i<celldata.length;i++){
  //     if(celldata[i]!=null){
  //         ret.push(celldata[i]);
  //     }
  // }
  // file.celldata = ret;
  }else if(type=="na"){luckysheet.server.saveParam("na",null,value);}else if(type=="thumb"){setTimeout(function(){_this.imageRequest();},2000);}}};var common_extend=function common_extend(jsonbject1,jsonbject2){var resultJsonObject={};for(var attr in jsonbject1){resultJsonObject[attr]=jsonbject1[attr];}for(var attr in jsonbject2){resultJsonObject[attr]=jsonbject2[attr];}return resultJsonObject;};luckysheet.create=function(setting){var extendsetting=common_extend(defaultSetting,setting);// rptapp 报表存储用户创建表格时的配置，翻页的时候使用
  luckysheet.rptSetting=setting;var//defaultflow = extendsetting.defaultflow,
  loadurl=extendsetting.loadUrl,//data1 = extendsetting.data,
  menu=extendsetting.menu,title=extendsetting.title;container=extendsetting.container;//config = extendsetting.config;
  luckysheetfile=extendsetting.data;defaultcolumnNum=extendsetting.column;defaultrowNum=extendsetting.row;fullscreenmode=extendsetting.fullscreenmode;luckysheet.server.gridKey=extendsetting.gridKey;luckysheet.server.loadUrl=extendsetting.loadUrl;luckysheet.server.updateUrl=extendsetting.updateUrl;luckysheet.server.updateImageUrl=extendsetting.updateImageUrl;luckysheet.server.title=extendsetting.title;luckysheet.server.loadSheetUrl=extendsetting.loadSheetUrl;luckysheet.server.allowUpdate=extendsetting.allowUpdate;luckysheetConfigsetting.autoFormatw=extendsetting.autoFormatw;luckysheetConfigsetting.accuracy=extendsetting.accuracy;luckysheetConfigsetting.total=luckysheetfile[0].total;luckysheetConfigsetting.allowCopy=extendsetting.allowCopy;luckysheetConfigsetting.showtoolbar=extendsetting.showtoolbar;luckysheetConfigsetting.showinfobar=extendsetting.showinfobar;luckysheetConfigsetting.showsheetbar=extendsetting.showsheetbar;luckysheetConfigsetting.showstatisticBar=extendsetting.showstatisticBar;luckysheetConfigsetting.pointEdit=extendsetting.pointEdit;luckysheetConfigsetting.pointEditUpdate=extendsetting.pointEditUpdate;luckysheetConfigsetting.pointEditZoom=extendsetting.pointEditZoom;luckysheetConfigsetting.userInfo=extendsetting.userInfo;luckysheetConfigsetting.userMenuItem=extendsetting.userMenuItem;luckysheetConfigsetting.myFolderUrl=extendsetting.myFolderUrl;luckysheetConfigsetting.functionButton=extendsetting.functionButton;luckysheetConfigsetting.showConfigWindowResize=extendsetting.showConfigWindowResize;luckysheetConfigsetting.enableAddRow=extendsetting.enableAddRow;luckysheetConfigsetting.enableAddCol=extendsetting.enableAddCol;luckysheetConfigsetting.enablePage=extendsetting.enablePage;luckysheetConfigsetting.pageInfo=extendsetting.pageInfo;luckysheetConfigsetting.editMode=extendsetting.editMode;luckysheetConfigsetting.chartConfigChange=extendsetting.chartConfigChange;luckysheetConfigsetting.beforeCreateDom=extendsetting.beforeCreateDom;luckysheetConfigsetting.fireMousedown=extendsetting.fireMousedown;devicePixelRatio=extendsetting.devicePixelRatio;if(devicePixelRatio==null){devicePixelRatio=1;}devicePixelRatio=Math.ceil(devicePixelRatio);//luckysheet.tooltip.chartPointConfig("luckysheet-chart-point-config");
  //loading
  $("#"+container).append('<div id="luckysheetloadingdata" style="width:100%;text-align:center;position:absolute;top:0px;height:100%;font-size: 16px;z-index:1000000000;background:#fff;"><div style="position:relative;top:45%;width:100%;"> <div class="luckysheetLoaderGif"> </div> <span>渲染中...</span></div></div>');if(luckysheetConfigsetting.pointEdit){//编辑器qksheet表格编辑状态
  $("#"+container).attr("tabindex",0).focus();$("#luckysheetloadingdata .luckysheetLoaderGif").css({"width":"4em","height":"4em"});}if(loadurl==""){luckysheet.sheetmanage.initialjfFile(menu,title);luckysheet.luckysheetsizeauto();luckysheet.luckysheetHandler();luckysheet.chartInitial();//luckysheet.luckysheetactiveCell();
  }else {$.post(loadurl,{"gridKey":luckysheet.server.gridKey},function(d){var data=eval("("+d+")");luckysheetfile=data;luckysheet.sheetmanage.initialjfFile(menu,title);luckysheet.luckysheetsizeauto();luckysheet.luckysheetHandler();luckysheet.chartInitial();//需要更新数据给后台时，建立WebSocket连接
  if(luckysheet.server.allowUpdate){luckysheet.server.openWebSocket();}// setTimeout(function(){
  //     $("#luckysheetloadingdata").fadeOut().remove();
  // }, 500);
  //luckysheet.luckysheetactiveCell();
  });}return luckysheet;};var gridW=0,gridH=0,cellmainHeight=0,cellmainWidth=0;luckysheet.luckysheetsizeauto=function(){// var winW = $(window).outerWidth(), winH = $(window).outerHeight();
  // $("#"+ container).height(winH-2).width(winW-2);
  if(!luckysheetConfigsetting.showinfobar){infobarHeight=0;$("#luckysheet_info_detail").hide();}else {infobarHeight=30;$("#luckysheet_info_detail").show();}if(!luckysheetConfigsetting.showtoolbar){$("#"+container).find(".luckysheet-wa-editor, .luckysheet-share-logo").hide();toolbarHeight=0;}else {$("#"+container).find(".luckysheet-wa-editor, .luckysheet-share-logo").show();toolbarHeight=35;}if(!luckysheetConfigsetting.showsheetbar){$("#"+container).find("#luckysheet-sheet-area").hide();sheetBarHeight=0;}else {$("#"+container).find("#luckysheet-sheet-area").show();sheetBarHeight=27;}if(!luckysheetConfigsetting.showstatisticBar){$("#"+container).find(".luckysheet-stat-area").hide();statisticBarHeight=0;}else {$("#"+container).find(".luckysheet-stat-area").show();statisticBarHeight=23;}if(luckysheetConfigsetting.pointEdit){//编辑器qksheet表格编辑时，不要滚动条
  cellMainSrollBarSize=0;}$("#"+container).find(".luckysheet-grid-container").css("top",toolbarHeight+infobarHeight+calculatebarHeight);gridW=$("#"+container).width(),gridH=$("#"+container).height();if(luckysheetConfigsetting.showConfigWindowResize){//数据透视表  图表  交替颜色
  if($("#luckysheet-modal-dialog-slider-pivot").is(":visible")){gridW-=$("#luckysheet-modal-dialog-slider-pivot").outerWidth();}else if($("#luckysheet-data-visualization").is(":visible")){gridW-=$("#luckysheet-data-visualization").outerWidth();}else if($("#luckysheet-modal-dialog-slider-alternateformat").is(":visible")){gridW-=$("#luckysheet-modal-dialog-slider-alternateformat").outerWidth();}}$("#"+container).find(".luckysheet").height(gridH-2).width(gridW-2);cellmainHeight=gridH-(infobarHeight+toolbarHeight+calculatebarHeight+columeHeaderHeight+sheetBarHeight+statisticBarHeight);cellmainWidth=gridW-rowHeaderWidth;$("#luckysheet-cols-h-c, #luckysheet-cell-main, #luckysheet-scrollbar-x").width(cellmainWidth);$("#luckysheet-cell-main").height(cellmainHeight);$("#luckysheet-rows-h").height(cellmainHeight-cellMainSrollBarSize);$("#luckysheet-scrollbar-y").height(cellmainHeight+6);$("#luckysheet-scrollbar-x").height(cellMainSrollBarSize);$("#luckysheet-scrollbar-y").width(cellMainSrollBarSize);luckysheetTableContentHW=[cellmainWidth+rowHeaderWidth-cellMainSrollBarSize,cellmainHeight+columeHeaderHeight-cellMainSrollBarSize];$("#luckysheetTableContent, #luckysheetTableContentF").attr({width:Math.ceil(luckysheetTableContentHW[0]*devicePixelRatio),height:Math.ceil(luckysheetTableContentHW[1]*devicePixelRatio)}).css({width:luckysheetTableContentHW[0],height:luckysheetTableContentHW[1]});$("#"+container).find("#luckysheet-grid-window-1").css("bottom",sheetBarHeight);$("#"+container).find(".luckysheet-grid-window").css("bottom",statisticBarHeight);var gridwidth=$("#luckysheet-grid-window-1").width();$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-handle").css({"width":gridwidth-10}).end().find(".luckysheet-freezebar-horizontal-drop").css({"width":gridwidth-10});var gridheight=$("#luckysheet-grid-window-1").height();$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-handle").css({"height":gridheight-10}).end().find(".luckysheet-freezebar-vertical-drop").css({"height":gridheight-10});luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid($("#luckysheet-cell-main").scrollLeft(),$("#luckysheet-cell-main").scrollTop());var ismore=false,toolbarW=0,morebtn='<div class="luckysheet-toolbar-separator luckysheet-inline-block" style="user-select: none;"> </div><div class="luckysheet-toolbar-button luckysheet-inline-block" data-tips="更多按钮" id="luckysheet-icon-morebtn" role="button" style="user-select: none;"> <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block" style="user-select: none;"> <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block" style="user-select: none;color:#0188fb;"><i class="fa fa-list-ul"></i> 更多... </div> </div> </div> </div>';var morediv='<div id="luckysheet-icon-morebtn-div" class="luckysheet-wa-editor" style="position:absolute;top:'+(infobarHeight+toolbarHeight+2+$("#"+container).offset().top+$("body").scrollTop())+'px; right:0px;z-index:1003;padding-left:0px;display:none;height:auto;white-space:initial;"></div>';if($("#luckysheet-icon-morebtn-div").length==0){$("body").append(morediv);}$("#luckysheet-icon-morebtn-div").hide();$("#luckysheet-icon-morebtn-div > div").appendTo($("#luckysheet-wa-editor"));// $("#luckysheet-wa-editor > div").trigger("create");
  // $("#luckysheet-icon-morebtn-div > div").trigger("create");
  $("#luckysheet-icon-morebtn").prev().remove().end().remove();$("#luckysheet-wa-editor > div").each(function(){var $t=$(this);toolbarW+=$t.outerWidth();if(!ismore&&toolbarW>gridW-120){ismore=true;}if(ismore){$("#luckysheet-icon-morebtn-div").append($(this));}});if(ismore){$("#luckysheet-wa-editor").append(morebtn);$("#luckysheet-icon-morebtn").click(function(){var right=$(window).width()-$("#luckysheet-icon-morebtn").offset().left-$("#luckysheet-icon-morebtn").width()+$("body").scrollLeft();$("#luckysheet-icon-morebtn-div").toggle().css("right",right<0?0:right);var $txt=$(this).find(".luckysheet-toolbar-menu-button-caption");if($txt.text().indexOf("更多")>-1){$(this).find(".luckysheet-toolbar-menu-button-caption").html('<i class="fa fa-list-ul"></i> 收起... ');}else {$(this).find(".luckysheet-toolbar-menu-button-caption").html('<i class="fa fa-list-ul"></i> 更多... ');}});//$("#luckysheet-wa-editor div").trigger("create");
  $("#luckysheet-icon-morebtn-div .luckysheet-toolbar-menu-button").css("margin-right",-1);$("#luckysheet-icon-morebtn-div .luckysheet-toolbar-button-split-left").css("margin-right",-3);}$("#"+container+" .luckysheet-wa-editor .luckysheet-toolbar-button-split-left").off("hover").hover(function(){$(this).next(".luckysheet-toolbar-button-split-right").addClass("luckysheet-toolbar-button-split-right-hover");},function(){$(this).next(".luckysheet-toolbar-button-split-right").removeClass("luckysheet-toolbar-button-split-right-hover");});$("#"+container+" .luckysheet-wa-editor .luckysheet-toolbar-button-split-right").off("hover").hover(function(){$(this).prev(".luckysheet-toolbar-button-split-left").addClass("luckysheet-toolbar-button-hover");},function(){$(this).prev(".luckysheet-toolbar-button-split-left").removeClass("luckysheet-toolbar-button-hover");});};luckysheet.filterseletedbyindex=function(r1,r2,c1,c2){var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];$('#luckysheet-filter-selected-sheet'+luckysheet.currentSheetIndex).css({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1});$option=$('#luckysheet-filter-options-sheet'+luckysheet.currentSheetIndex).find(".luckysheet-filter-options");for(var c=c1;c<=c2;c++){$option.eq(c-c1).css({"left":visibledatacolumn[c]-20,"top":visibledatarow[r1-1]});}};//公式函数 选区实体框
  luckysheet.seletedHighlistByindex=function(id,r1,r2,c1,c2){var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];$('#'+id).css({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1});};//选区
  luckysheet.selectHightlightShow=function(){$("#luckysheet-cell-selected-boxs").show();$("#luckysheet-cell-selected-boxs #luckysheet-cell-selected").siblings(".luckysheet-cell-selected").remove();if(luckysheet_select_save.length>0){for(var i=0;i<luckysheet_select_save.length;i++){var r1=luckysheet_select_save[i].row[0],r2=luckysheet_select_save[i].row[1];var c1=luckysheet_select_save[i].column[0],c2=luckysheet_select_save[i].column[1];if(luckysheet_select_save[i].row_focus==null){var rf=r1;}else {var rf=luckysheet_select_save[i].row_focus;}if(luckysheet_select_save[i].column_focus==null){var cf=c1;}else {var cf=luckysheet_select_save[i].column_focus;}var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];var row_f=visibledatarow[rf],row_pre_f=rf-1==-1?0:visibledatarow[rf-1];var col_f=visibledatacolumn[cf],col_pre_f=cf-1==-1?0:visibledatacolumn[cf-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,rf,cf);if(!!margeset){row_f=margeset.row[1];row_pre_f=margeset.row[0];col_f=margeset.column[1];col_pre_f=margeset.column[0];}luckysheet_select_save[i]["row"]=[r1,r2];luckysheet_select_save[i]["column"]=[c1,c2];luckysheet_select_save[i]["row_focus"]=rf;luckysheet_select_save[i]["column_focus"]=cf;luckysheet_select_save[i]["left"]=col_pre_f;luckysheet_select_save[i]["width"]=col_f-col_pre_f-1;luckysheet_select_save[i]["top"]=row_pre_f;luckysheet_select_save[i]["height"]=row_f-row_pre_f-1;luckysheet_select_save[i]["left_move"]=col_pre;luckysheet_select_save[i]["width_move"]=col-col_pre-1;luckysheet_select_save[i]["top_move"]=row_pre;luckysheet_select_save[i]["height_move"]=row-row_pre-1;if(i==0){if(luckysheet_select_save.length==1){if(mobilecheck){//移动端
  $("#luckysheet-cell-selected-boxs #luckysheet-cell-selected").css({"left":luckysheet_select_save[i]["left_move"],"width":luckysheet_select_save[i]["width_move"],"top":luckysheet_select_save[i]["top_move"],"height":luckysheet_select_save[i]["height_move"],"display":"block","border":"1px solid #0188fb"}).find(".luckysheet-cs-draghandle").css("display","block").end().find(".luckysheet-cs-fillhandle").css("display","none").end().find(".luckysheet-cs-touchhandle").css("display","block");}else {$("#luckysheet-cell-selected-boxs #luckysheet-cell-selected").css({"left":luckysheet_select_save[i]["left_move"],"width":luckysheet_select_save[i]["width_move"],"top":luckysheet_select_save[i]["top_move"],"height":luckysheet_select_save[i]["height_move"],"display":"block","border":"1px solid #0188fb"}).find(".luckysheet-cs-draghandle").css("display","block").end().find(".luckysheet-cs-fillhandle").css("display","block").end().find(".luckysheet-cs-touchhandle").css("display","none");}}else {$("#luckysheet-cell-selected-boxs #luckysheet-cell-selected").css({"left":luckysheet_select_save[i]["left_move"],"width":luckysheet_select_save[i]["width_move"],"top":luckysheet_select_save[i]["top_move"],"height":luckysheet_select_save[i]["height_move"],"display":"block","border":"1px solid rgba(1, 136, 251, 0.15)"}).find(".luckysheet-cs-draghandle").css("display","none").end().find(".luckysheet-cs-fillhandle").css("display","none");}}else {$("#luckysheet-cell-selected-boxs").append('<div class="luckysheet-cell-selected" style="left: '+luckysheet_select_save[i]["left_move"]+'px; width: '+luckysheet_select_save[i]["width_move"]+'px; top: '+luckysheet_select_save[i]["top_move"]+'px; height: '+luckysheet_select_save[i]["height_move"]+'px; border: 1px solid rgba(1, 136, 251, 0.15); display: block;"></div>');}if(i==luckysheet_select_save.length-1){//focus 取选区数组最后一个
  $("#luckysheet-cell-selected-focus").css({"left":luckysheet_select_save[i]["left"],"width":luckysheet_select_save[i]["width"],"top":luckysheet_select_save[i]["top"],"height":luckysheet_select_save[i]["height"],"display":"block"});//行列数
  luckysheet.luckysheet_count_show(luckysheet_select_save[i]["left_move"],luckysheet_select_save[i]["top_move"],luckysheet_select_save[i]["width_move"],luckysheet_select_save[i]["height_move"],[r1,r2],[c1,c2]);//左上角选择区域框
  luckysheet.formula.fucntionboxshow(rf,cf);}}//行列标题栏
  luckysheet.selectTitlesShow(luckysheet_select_save);//左上角范围显示
  $("#luckysheet-helpbox-cell").text(luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,luckysheet_select_save[luckysheet_select_save.length-1]));//动态数组显示
  if(luckysheet_select_save.length==1&&luckysheet_select_save[0].row[0]==luckysheet_select_save[0].row[1]&&luckysheet_select_save[0].column[0]==luckysheet_select_save[0].column[1]){luckysheet.dynamicArray_hightShow(luckysheet_select_save[0].row[0],luckysheet_select_save[0].column[0]);}}luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].luckysheet_select_save=luckysheet_select_save;};//选区标题栏
  luckysheet.selectTitlesShow=function(rangeArr){var s=$.extend(true,[],rangeArr);var rowTitleMap={},columnTitleMap={};for(var i=0;i<s.length;i++){var r1=s[i]["row"][0],r2=s[i]["row"][1],c1=s[i]["column"][0],c2=s[i]["column"][1];//行、列标题栏
  rowTitleMap=luckysheet.selectTitlesMap(rowTitleMap,r1,r2);columnTitleMap=luckysheet.selectTitlesMap(columnTitleMap,c1,c2);}//行标题
  $("#luckysheet-rows-h-selected").empty();var rowTitleRange=luckysheet.selectTitlesRange(rowTitleMap);for(var i=0;i<rowTitleRange.length;i++){var r1=rowTitleRange[i][0],r2=rowTitleRange[i][rowTitleRange[i].length-1];var row=luckysheet.rowLocationByIndex(r2)[1],row_pre=luckysheet.rowLocationByIndex(r1)[0];$("#luckysheet-rows-h-selected").append('<div class="luckysheet-rows-h-selected" style="top: '+row_pre+'px; height: '+(row-row_pre-1)+'px; display: block; background-color: rgba(76, 76, 76, 0.1);"></div>');}//列标题
  $("#luckysheet-cols-h-selected").empty();var columnTitleRange=luckysheet.selectTitlesRange(columnTitleMap);for(var j=0;j<columnTitleRange.length;j++){var c1=columnTitleRange[j][0],c2=columnTitleRange[j][columnTitleRange[j].length-1];var col=luckysheet.colLocationByIndex(c2)[1],col_pre=luckysheet.colLocationByIndex(c1)[0];$("#luckysheet-cols-h-selected").append('<div class="luckysheet-cols-h-selected" style="left: '+col_pre+'px; width: '+(col-col_pre-1)+'px; display: block; background-color: rgba(76, 76, 76, 0.1);"></div>');}};luckysheet.selectTitlesMap=function(rangeMap,range1,range2){var map=$.extend(true,{},rangeMap);for(var i=range1;i<=range2;i++){if(i in map){continue;}map[i]=0;}return map;};luckysheet.selectTitlesRange=function(map){var mapArr=[];for(var i in map){mapArr.push(i);}mapArr.sort(function(a,b){return a-b;});var rangeArr=[];var item=[];if(mapArr.length>1){for(var j=1;j<mapArr.length;j++){if(mapArr[j]-mapArr[j-1]==1){item.push(mapArr[j-1]);if(j==mapArr.length-1){item.push(mapArr[j]);rangeArr.push(item);}}else {if(j==1){if(j==mapArr.length-1){item.push(mapArr[j-1]);rangeArr.push(item);rangeArr.push([mapArr[j]]);}else {rangeArr.push(mapArr[0]);}}else if(j==mapArr.length-1){item.push(mapArr[j-1]);rangeArr.push(item);rangeArr.push([mapArr[j]]);}else {item.push(mapArr[j-1]);rangeArr.push(item);item=[];}}}}else {rangeArr.push([mapArr[0]]);}return rangeArr;};//选区是否重叠
  luckysheet.selectIsOverlap=function(){var overlap=false;var map={};for(var s=0;s<luckysheet_select_save.length;s++){var str_r=luckysheet_select_save[s].row[0],end_r=luckysheet_select_save[s].row[1];var str_c=luckysheet_select_save[s].column[0],end_c=luckysheet_select_save[s].column[1];for(var r=str_r;r<=end_r;r++){for(var c=str_c;c<=end_c;c++){if(r+"_"+c in map){overlap=true;break;}else {map[r+"_"+c]=0;}}}}return overlap;};//复制选区虚线框
  luckysheet.selectionCopyShow=function(range){$("#luckysheet-selection-copy").empty();if(range==null){range=luckysheet_selection_range;}if(range.length>0){for(var s=0;s<range.length;s++){var r1=range[s].row[0],r2=range[s].row[1];var c1=range[s].column[0],c2=range[s].column[1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];var copyDomHtml='<div class="luckysheet-selection-copy" style="display: block; left: '+col_pre+'px; width: '+(col-col_pre-1)+'px; top: '+row_pre+'px; height: '+(row-row_pre-1)+'px;">'+'<div class="luckysheet-selection-copy-top luckysheet-copy"></div>'+'<div class="luckysheet-selection-copy-right luckysheet-copy"></div>'+'<div class="luckysheet-selection-copy-bottom luckysheet-copy"></div>'+'<div class="luckysheet-selection-copy-left luckysheet-copy"></div>'+'<div class="luckysheet-selection-copy-hc"></div>'+'</div>';$("#luckysheet-selection-copy").append(copyDomHtml);}}};//范围是否只包含部分合并单元格
  luckysheet.hasPartMC=function(cfg,r1,r2,c1,c2){var hasPartMC=false;for(x in config["merge"]){var mc=cfg["merge"][x];if(r1<mc.r){if(r2>=mc.r&&r2<mc.r+mc.rs-1){if(c1>=mc.c&&c1<=mc.c+mc.cs-1){hasPartMC=true;break;}else if(c2>=mc.c&&c2<=mc.c+mc.cs-1){hasPartMC=true;break;}else if(c1<mc.c&&c2>mc.c+mc.cs-1){hasPartMC=true;break;}}else if(r2>=mc.r&&r2==mc.r+mc.rs-1){if(c1>mc.c&&c1<mc.c+mc.cs-1){hasPartMC=true;break;}else if(c2>mc.c&&c2<mc.c+mc.cs-1){hasPartMC=true;break;}else if(c1==mc.c&&c2<mc.c+mc.cs-1){hasPartMC=true;break;}else if(c1>mc.c&&c2==mc.c+mc.cs-1){hasPartMC=true;break;}}else if(r2>mc.r+mc.rs-1){if(c1>mc.c&&c1<=mc.c+mc.cs-1){hasPartMC=true;break;}else if(c2>=mc.c&&c2<mc.c+mc.cs-1){hasPartMC=true;break;}else if(c1==mc.c&&c2<mc.c+mc.cs-1){hasPartMC=true;break;}else if(c1>mc.c&&c2==mc.c+mc.cs-1){hasPartMC=true;break;}}}else if(r1==mc.r){if(r2<mc.r+mc.rs-1){if(c1>=mc.c&&c1<=mc.c+mc.cs-1){hasPartMC=true;break;}else if(c2>=mc.c&&c2<=mc.c+mc.cs-1){hasPartMC=true;break;}else if(c1<mc.c&&c2>mc.c+mc.cs-1){hasPartMC=true;break;}}else if(r2>=mc.r+mc.rs-1){if(c1>mc.c&&c1<=mc.c+mc.cs-1){hasPartMC=true;break;}else if(c2>=mc.c&&c2<mc.c+mc.cs-1){hasPartMC=true;break;}else if(c1==mc.c&&c2<mc.c+mc.cs-1){hasPartMC=true;break;}else if(c1>mc.c&&c2==mc.c+mc.cs-1){hasPartMC=true;break;}}}else if(r1<=mc.r+mc.rs-1){if(c1>=mc.c&&c1<=mc.c+mc.cs-1){hasPartMC=true;break;}else if(c2>=mc.c&&c2<=mc.c+mc.cs-1){hasPartMC=true;break;}else if(c1<mc.c&&c2>mc.c+mc.cs-1){hasPartMC=true;break;}}}return hasPartMC;};//范围是否都是空单元格(除第一个单元格)
  luckysheet.dynamicArray_rangeIsAllNull=function(range,data){var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var isAllNull=true;for(var r=r1;r<=r2;r++){for(var c=c1;c<=c2;c++){if(!(r==r1&&c==c1)&&data[r][c]!=null&&data[r][c].v!=null&&data[r][c].v.toString()!=""){isAllNull=false;break;}}}return isAllNull;};luckysheet.dynamicArray_spillEditCompute=function(computeObj,r,c){var rowIndex=computeObj[r+"_"+c].r;var colIndex=computeObj[r+"_"+c].c;for(x in computeObj){if(x==rowIndex+"_"+colIndex){computeObj[x].v="#SPILL!";}else if(computeObj[x].r==rowIndex&&computeObj[x].c==colIndex){delete computeObj[x];}}return computeObj;};//点击表格区域是否属于动态数组区域
  luckysheet.dynamicArray_hightShow=function(r,c){var dynamicArray=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["dynamicArray"]==null?[]:luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["dynamicArray"];var dynamicArray_compute=luckysheet.dynamicArray_compute(dynamicArray);if(r+"_"+c in dynamicArray_compute&&dynamicArray_compute[r+"_"+c].v!="#SPILL!"){var d_row=dynamicArray_compute[r+"_"+c].r;var d_col=dynamicArray_compute[r+"_"+c].c;var d_f=luckysheet.flowdata[d_row][d_col].f;var rlen,clen;for(var i=0;i<dynamicArray.length;i++){if(dynamicArray[i].f==d_f){rlen=dynamicArray[i].data.length;if(luckysheet.getObjType(dynamicArray[i].data[0])=="array"){clen=dynamicArray[i].data[0].length;}else {clen=1;}}}var d_row_end=d_row+rlen-1;var d_col_end=d_col+clen-1;var row=visibledatarow[d_row_end],row_pre=d_row-1==-1?0:visibledatarow[d_row-1];var col=visibledatacolumn[d_col_end],col_pre=d_col-1==-1?0:visibledatacolumn[d_col-1];$("#luckysheet-dynamicArray-hightShow").css({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"display":"block"});}else {$("#luckysheet-dynamicArray-hightShow").hide();}};//动态数组计算
  luckysheet.dynamicArray_compute=function(dynamicArray){var dynamicArray_compute={};if(luckysheet.getObjType(dynamicArray)=="array"){for(var i=0;i<dynamicArray.length;i++){var d_row=dynamicArray[i].r;var d_col=dynamicArray[i].c;var d_f=dynamicArray[i].f;if(luckysheet.flowdata[d_row][d_col]!=null&&luckysheet.flowdata[d_row][d_col].f!=null&&luckysheet.flowdata[d_row][d_col].f==d_f){if(d_row+"_"+d_col in dynamicArray_compute){dynamicArray_compute=luckysheet.dynamicArray_spillEditCompute(dynamicArray_compute,d_row,d_col);}var d_data=dynamicArray[i].data;var d_rowlen=d_data.length;var d_collen=1;if(luckysheet.getObjType(d_data[0])=="array"){d_collen=d_data[0].length;}if(luckysheet.dynamicArray_rangeIsAllNull({"row":[d_row,d_row+d_rowlen-1],"column":[d_col,d_col+d_collen-1]},luckysheet.flowdata)){for(var x=0;x<d_rowlen;x++){for(var y=0;y<d_collen;y++){var rowIndex=d_row+x;var colIndex=d_col+y;if(luckysheet.getObjType(d_data[0])=="array"){dynamicArray_compute[rowIndex+"_"+colIndex]={"v":d_data[x][y],"r":d_row,"c":d_col};}else {dynamicArray_compute[rowIndex+"_"+colIndex]={"v":d_data[x],"r":d_row,"c":d_col};}}}}else {dynamicArray_compute[d_row+"_"+d_col]={"v":"#SPILL!","r":d_row,"c":d_col};}}}}return dynamicArray_compute;};//shift + 方向键 / ctrl + shift + 方向键 功能
  luckysheet.rowHasMerge=function(r,c1,c2){var rowHasMerge=false;for(var c=c1;c<=c2;c++){var cell=luckysheet.flowdata[r][c];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell){rowHasMerge=true;break;}}return rowHasMerge;};luckysheet.colHasMerge=function(c,r1,r2){var colHasMerge=false;for(var r=r1;r<=r2;r++){var cell=luckysheet.flowdata[r][c];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell){colHasMerge=true;break;}}return colHasMerge;};luckysheet.getRowMerge=function(rIndex,c1,c2){var r1=0,r2=luckysheet.flowdata.length-1;var str=null;if(rIndex>r1){for(var r=rIndex;r>=r1;r--){for(var c=c1;c<=c2;c++){var cell=luckysheet.flowdata[r][c];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell){var mc=config["merge"][cell["mc"].r+"_"+cell["mc"].c];if(str==null||mc.r<str){str=mc.r;}}}if(luckysheet.rowHasMerge(str-1,c1,c2)&&str>r1){r=str-1;}else {break;}}}else {str=r1;}var end=null;if(rIndex<r2){for(var r=rIndex;r<=r2;r++){for(var c=c1;c<=c2;c++){var cell=luckysheet.flowdata[r][c];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell){var mc=config["merge"][cell["mc"].r+"_"+cell["mc"].c];if(end==null||mc.r+mc.rs-1>end){end=mc.r+mc.rs-1;}}}if(luckysheet.rowHasMerge(end+1,c1,c2)&&end<r2){r=end+1;}else {break;}}}else {end=r2;}return [str,end];};luckysheet.getColMerge=function(cIndex,r1,r2){var c1=0,c2=luckysheet.flowdata[0].length-1;var str=null;if(cIndex>c1){for(var c=cIndex;c>=c1;c--){for(var r=r1;r<=r2;r++){var cell=luckysheet.flowdata[r][c];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell){var mc=config["merge"][cell["mc"].r+"_"+cell["mc"].c];if(str==null||mc.c<str){str=mc.c;}}}if(luckysheet.colHasMerge(str-1,r1,r2)&&str>c1){c=str-1;}else {break;}}}else {str=c1;}var end=null;if(cIndex<c2){for(var c=cIndex;c<=c2;c++){for(var r=r1;r<=r2;r++){var cell=luckysheet.flowdata[r][c];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell){var mc=config["merge"][cell["mc"].r+"_"+cell["mc"].c];if(end==null||mc.c+mc.cs-1>end){end=mc.c+mc.cs-1;}}}if(luckysheet.colHasMerge(end+1,r1,r2)&&end<c2){c=end+1;}else {break;}}}else {end=c2;}return [str,end];};luckysheet.getNextIndex=function(direction,focusIndex,strIndex,endIndex){var index=null;var stNull;if(direction=="down"){var stValue=luckysheet.flowdata[strIndex][focusIndex];if(luckysheet.getObjType(stValue)=="object"&&luckysheet.func_methods.isRealNull(stValue.v)){stNull=false;}else if(luckysheet.func_methods.isRealNull(stValue)){stNull=false;}else {stNull=true;}var cellNull=[],i=0;for(var r=strIndex+1;r<=endIndex;r++){var cell=luckysheet.flowdata[r][focusIndex];if(luckysheet.getObjType(cell)=="object"&&luckysheet.func_methods.isRealNull(cell.v)){cellNull.push(false);}else if(luckysheet.func_methods.isRealNull(cell)){cellNull.push(false);}else {cellNull.push(true);}if(cellNull.length==1&&stNull&&cellNull[i]==false){index=strIndex+i+1;break;}else if(cellNull.length>1){if(stNull&&cellNull[i]==false){//起始是空，找第一个有值的位置
  index=strIndex+i+1;break;}else if(!stNull){//起始有值，找一个有值的位置
  if(cellNull[i]==false&&cellNull[i-1]==true){//前面为空
  index=strIndex+i+1;break;}else if(cellNull[i]==true&&cellNull[i-1]==false){//后面为空
  index=strIndex+i;break;}}}if(r==endIndex){index=endIndex;}i++;}}else if(direction=="up"){var stValue=luckysheet.flowdata[endIndex][focusIndex];if(luckysheet.getObjType(stValue)=="object"&&luckysheet.func_methods.isRealNull(stValue.v)){stNull=false;}else if(luckysheet.func_methods.isRealNull(stValue)){stNull=false;}else {stNull=true;}var cellNull=[],i=0;for(var r=endIndex-1;r>=strIndex;r--){var cell=luckysheet.flowdata[r][focusIndex];if(luckysheet.getObjType(cell)=="object"&&luckysheet.func_methods.isRealNull(cell.v)){cellNull.push(false);}else if(luckysheet.func_methods.isRealNull(cell)){cellNull.push(false);}else {cellNull.push(true);}if(cellNull.length==1&&stNull&&cellNull[i]==false){index=endIndex-(i+1);break;}else if(cellNull.length>1){if(stNull&&cellNull[i]==false){//起始是空，找第一个有值的位置
  index=endIndex-(i+1);break;}else if(!stNull){//起始有值，找一个有值的位置
  if(cellNull[i]==false&&cellNull[i-1]==true){//前面为空
  index=endIndex-(i+1);break;}else if(cellNull[i]==true&&cellNull[i-1]==false){//后面为空
  index=endIndex-i;break;}}}if(r==strIndex){index=strIndex;}i++;}}else if(direction=="right"){var stValue=luckysheet.flowdata[focusIndex][strIndex];if(luckysheet.getObjType(stValue)=="object"&&luckysheet.func_methods.isRealNull(stValue.v)){stNull=false;}else if(luckysheet.func_methods.isRealNull(stValue)){stNull=false;}else {stNull=true;}var cellNull=[],i=0;for(var c=strIndex+1;c<=endIndex;c++){var cell=luckysheet.flowdata[focusIndex][c];if(luckysheet.getObjType(cell)=="object"&&luckysheet.func_methods.isRealNull(cell.v)){cellNull.push(false);}else if(luckysheet.func_methods.isRealNull(cell)){cellNull.push(false);}else {cellNull.push(true);}if(cellNull.length==1&&stNull&&cellNull[i]==false){index=strIndex+i+1;break;}else if(cellNull.length>1){if(stNull&&cellNull[i]==false){//起始是空，找第一个有值的位置
  index=strIndex+i+1;break;}else if(!stNull){//起始有值，找一个有值的位置
  if(cellNull[i]==false&&cellNull[i-1]==true){//前面为空
  index=strIndex+i+1;break;}else if(cellNull[i]==true&&cellNull[i-1]==false){//后面为空
  index=strIndex+i;break;}}}if(c==endIndex){index=endIndex;}i++;}}else if(direction=="left"){var stValue=luckysheet.flowdata[focusIndex][endIndex];if(luckysheet.getObjType(stValue)=="object"&&luckysheet.func_methods.isRealNull(stValue.v)){stNull=false;}else if(luckysheet.func_methods.isRealNull(stValue)){stNull=false;}else {stNull=true;}var cellNull=[],i=0;for(var c=endIndex-1;c>=strIndex;c--){var cell=luckysheet.flowdata[focusIndex][c];if(luckysheet.getObjType(cell)=="object"&&luckysheet.func_methods.isRealNull(cell.v)){cellNull.push(false);}else if(luckysheet.func_methods.isRealNull(cell)){cellNull.push(false);}else {cellNull.push(true);}if(cellNull.length==1&&stNull&&cellNull[i]==false){index=endIndex-(i+1);break;}else if(cellNull.length>1){if(stNull&&cellNull[i]==false){//起始是空，找第一个有值的位置
  index=endIndex-(i+1);break;}else if(!stNull){//起始有值，找一个有值的位置
  if(cellNull[i]==false&&cellNull[i-1]==true){//前面为空
  index=endIndex-(i+1);break;}else if(cellNull[i]==true&&cellNull[i-1]==false){//后面为空
  index=endIndex-i;break;}}}if(c==strIndex){index=strIndex;}i++;}}return index;};//获取表格边框数据计算值
  luckysheet.getBorderInfoCompute=function(sheetIndex){var borderInfoCompute={};if(sheetIndex==null){var cfg=config;var data=luckysheet.flowdata;}else {var cfg=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(sheetIndex)].config;var data=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(sheetIndex)].data;}var borderInfo=cfg["borderInfo"];if(borderInfo!=null&&borderInfo.length>0){for(var i=0;i<borderInfo.length;i++){var rangeType=borderInfo[i].rangeType;if(rangeType=="range"){var borderType=borderInfo[i].borderType;var borderColor=borderInfo[i].color;var borderStyle=borderInfo[i].style;var borderRange=borderInfo[i].range;for(var j=0;j<borderRange.length;j++){var bd_r1=borderRange[j].row[0],bd_r2=borderRange[j].row[1];var bd_c1=borderRange[j].column[0],bd_c2=borderRange[j].column[1];if(borderType=="border-left"){for(var bd_r=bd_r1;bd_r<=bd_r2;bd_r++){if(cfg["rowhidden"]!=null&&cfg["rowhidden"][bd_r]!=null){continue;}if(borderInfoCompute[bd_r+"_"+bd_c1]==null){borderInfoCompute[bd_r+"_"+bd_c1]={};}borderInfoCompute[bd_r+"_"+bd_c1].l={"color":borderColor,"style":borderStyle};var bd_c_left=bd_c1-1;if(bd_c_left>=0&&borderInfoCompute[bd_r+"_"+bd_c_left]){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c_left])=="object"&&data[bd_r][bd_c_left].mc!=null){var cell_left=data[bd_r][bd_c_left];var mc=cfg["merge"][cell_left.mc.r+"_"+cell_left.mc.c];if(mc.c+mc.cs-1==bd_c_left){borderInfoCompute[bd_r+"_"+bd_c_left].r={"color":borderColor,"style":borderStyle};}}else {borderInfoCompute[bd_r+"_"+bd_c_left].r={"color":borderColor,"style":borderStyle};}}}}else if(borderType=="border-right"){for(var bd_r=bd_r1;bd_r<=bd_r2;bd_r++){if(cfg["rowhidden"]!=null&&cfg["rowhidden"][bd_r]!=null){continue;}if(borderInfoCompute[bd_r+"_"+bd_c2]==null){borderInfoCompute[bd_r+"_"+bd_c2]={};}borderInfoCompute[bd_r+"_"+bd_c2].r={"color":borderColor,"style":borderStyle};var bd_c_right=bd_c2+1;if(bd_c_right<data[0].length&&borderInfoCompute[bd_r+"_"+bd_c_right]){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c_right])=="object"&&data[bd_r][bd_c_right].mc!=null){var cell_right=data[bd_r][bd_c_right];var mc=cfg["merge"][cell_right.mc.r+"_"+cell_right.mc.c];if(mc.c==bd_c_right){borderInfoCompute[bd_r+"_"+bd_c_right].l={"color":borderColor,"style":borderStyle};}}else {borderInfoCompute[bd_r+"_"+bd_c_right].l={"color":borderColor,"style":borderStyle};}}}}else if(borderType=="border-top"){if(cfg["rowhidden"]!=null&&cfg["rowhidden"][bd_r1]!=null){continue;}for(var bd_c=bd_c1;bd_c<=bd_c2;bd_c++){if(borderInfoCompute[bd_r1+"_"+bd_c]==null){borderInfoCompute[bd_r1+"_"+bd_c]={};}borderInfoCompute[bd_r1+"_"+bd_c].t={"color":borderColor,"style":borderStyle};var bd_r_top=bd_r1-1;if(bd_r_top>=0&&borderInfoCompute[bd_r_top+"_"+bd_c]){if(data[bd_r_top]!=null&&luckysheet.getObjType(data[bd_r_top][bd_c])=="object"&&data[bd_r_top][bd_c].mc!=null){var cell_top=data[bd_r_top][bd_c];var mc=cfg["merge"][cell_top.mc.r+"_"+cell_top.mc.c];if(mc.r+mc.rs-1==bd_r_top){borderInfoCompute[bd_r_top+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}else {borderInfoCompute[bd_r_top+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}}}else if(borderType=="border-bottom"){if(cfg["rowhidden"]!=null&&cfg["rowhidden"][bd_r2]!=null){continue;}for(var bd_c=bd_c1;bd_c<=bd_c2;bd_c++){if(borderInfoCompute[bd_r2+"_"+bd_c]==null){borderInfoCompute[bd_r2+"_"+bd_c]={};}borderInfoCompute[bd_r2+"_"+bd_c].b={"color":borderColor,"style":borderStyle};var bd_r_bottom=bd_r2+1;if(bd_r_bottom<data.length&&borderInfoCompute[bd_r_bottom+"_"+bd_c]){if(data[bd_r_bottom]!=null&&luckysheet.getObjType(data[bd_r_bottom][bd_c])=="object"&&data[bd_r_bottom][bd_c].mc!=null){var cell_bottom=data[bd_r_bottom][bd_c];var mc=cfg["merge"][cell_bottom.mc.r+"_"+cell_bottom.mc.c];if(mc.r==bd_r_bottom){borderInfoCompute[bd_r_bottom+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}}else {borderInfoCompute[bd_r_bottom+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}}}}else if(borderType=="border-all"){for(var bd_r=bd_r1;bd_r<=bd_r2;bd_r++){if(cfg["rowhidden"]!=null&&cfg["rowhidden"][bd_r]!=null){continue;}for(var bd_c=bd_c1;bd_c<=bd_c2;bd_c++){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null){var cell=data[bd_r][bd_c];var mc=cfg["merge"][cell.mc.r+"_"+cell.mc.c];if(mc.r==bd_r){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}if(mc.r+mc.rs-1==bd_r){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}if(mc.c==bd_c){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};}if(mc.c+mc.cs-1==bd_c){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};}}else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}if(bd_r==bd_r1){var bd_r_top=bd_r1-1;if(bd_r_top>=0&&borderInfoCompute[bd_r_top+"_"+bd_c]){if(data[bd_r_top]!=null&&luckysheet.getObjType(data[bd_r_top][bd_c])=="object"&&data[bd_r_top][bd_c].mc!=null){var cell_top=data[bd_r_top][bd_c];var mc=cfg["merge"][cell_top.mc.r+"_"+cell_top.mc.c];if(mc.r+mc.rs-1==bd_r_top){borderInfoCompute[bd_r_top+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}else {borderInfoCompute[bd_r_top+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}}if(bd_r==bd_r2){var bd_r_bottom=bd_r2+1;if(bd_r_bottom<data.length&&borderInfoCompute[bd_r_bottom+"_"+bd_c]){if(data[bd_r_bottom]!=null&&luckysheet.getObjType(data[bd_r_bottom][bd_c])=="object"&&data[bd_r_bottom][bd_c].mc!=null){var cell_bottom=data[bd_r_bottom][bd_c];var mc=cfg["merge"][cell_bottom.mc.r+"_"+cell_bottom.mc.c];if(mc.r==bd_r_bottom){borderInfoCompute[bd_r_bottom+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}}else {borderInfoCompute[bd_r_bottom+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}}}if(bd_c==bd_c1){var bd_c_left=bd_c1-1;if(bd_c_left>=0&&borderInfoCompute[bd_r+"_"+bd_c_left]){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c_left])=="object"&&data[bd_r][bd_c_left].mc!=null){var cell_left=data[bd_r][bd_c_left];var mc=cfg["merge"][cell_left.mc.r+"_"+cell_left.mc.c];if(mc.c+mc.cs-1==bd_c_left){borderInfoCompute[bd_r+"_"+bd_c_left].r={"color":borderColor,"style":borderStyle};}}else {borderInfoCompute[bd_r+"_"+bd_c_left].r={"color":borderColor,"style":borderStyle};}}}if(bd_c==bd_c2){var bd_c_right=bd_c2+1;if(bd_c_right<data[0].length&&borderInfoCompute[bd_r+"_"+bd_c_right]){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c_right])=="object"&&data[bd_r][bd_c_right].mc!=null){var cell_right=data[bd_r][bd_c_right];var mc=cfg["merge"][cell_right.mc.r+"_"+cell_right.mc.c];if(mc.c==bd_c_right){borderInfoCompute[bd_r+"_"+bd_c_right].l={"color":borderColor,"style":borderStyle};}}else {borderInfoCompute[bd_r+"_"+bd_c_right].l={"color":borderColor,"style":borderStyle};}}}}}}else if(borderType=="border-outside"){for(var bd_r=bd_r1;bd_r<=bd_r2;bd_r++){if(cfg["rowhidden"]!=null&&cfg["rowhidden"][bd_r]!=null){continue;}for(var bd_c=bd_c1;bd_c<=bd_c2;bd_c++){if(!(bd_r==bd_r1||bd_r==bd_r2||bd_c==bd_c1||bd_c==bd_c2)){continue;}if(bd_r==bd_r1){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};var bd_r_top=bd_r1-1;if(bd_r_top>=0&&borderInfoCompute[bd_r_top+"_"+bd_c]){if(data[bd_r_top]!=null&&luckysheet.getObjType(data[bd_r_top][bd_c])=="object"&&data[bd_r_top][bd_c].mc!=null){var cell_top=data[bd_r_top][bd_c];var mc=cfg["merge"][cell_top.mc.r+"_"+cell_top.mc.c];if(mc.r+mc.rs-1==bd_r_top){borderInfoCompute[bd_r_top+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}else {borderInfoCompute[bd_r_top+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}}if(bd_r==bd_r2){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};var bd_r_bottom=bd_r2+1;if(bd_r_bottom<data.length&&borderInfoCompute[bd_r_bottom+"_"+bd_c]){if(data[bd_r_bottom]!=null&&luckysheet.getObjType(data[bd_r_bottom][bd_c])=="object"&&data[bd_r_bottom][bd_c].mc!=null){var cell_bottom=data[bd_r_bottom][bd_c];var mc=cfg["merge"][cell_bottom.mc.r+"_"+cell_bottom.mc.c];if(mc.r==bd_r_bottom){borderInfoCompute[bd_r_bottom+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}}else {borderInfoCompute[bd_r_bottom+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}}}if(bd_c==bd_c1){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};var bd_c_left=bd_c1-1;if(bd_c_left>=0&&borderInfoCompute[bd_r+"_"+bd_c_left]){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c_left])=="object"&&data[bd_r][bd_c_left].mc!=null){var cell_left=data[bd_r][bd_c_left];var mc=cfg["merge"][cell_left.mc.r+"_"+cell_left.mc.c];if(mc.c+mc.cs-1==bd_c_left){borderInfoCompute[bd_r+"_"+bd_c_left].r={"color":borderColor,"style":borderStyle};}}else {borderInfoCompute[bd_r+"_"+bd_c_left].r={"color":borderColor,"style":borderStyle};}}}if(bd_c==bd_c2){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};var bd_c_right=bd_c2+1;if(bd_c_right<data[0].length&&borderInfoCompute[bd_r+"_"+bd_c_right]){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c_right])=="object"&&data[bd_r][bd_c_right].mc!=null){var cell_right=data[bd_r][bd_c_right];var mc=cfg["merge"][cell_right.mc.r+"_"+cell_right.mc.c];if(mc.c==bd_c_right){borderInfoCompute[bd_r+"_"+bd_c_right].l={"color":borderColor,"style":borderStyle};}}else {borderInfoCompute[bd_r+"_"+bd_c_right].l={"color":borderColor,"style":borderStyle};}}}}}}else if(borderType=="border-inside"){for(var bd_r=bd_r1;bd_r<=bd_r2;bd_r++){if(cfg["rowhidden"]!=null&&cfg["rowhidden"][bd_r]!=null){continue;}for(var bd_c=bd_c1;bd_c<=bd_c2;bd_c++){if(bd_r==bd_r1&&bd_c==bd_c1){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null);else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}else if(bd_r==bd_r2&&bd_c==bd_c1){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null);else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}}else if(bd_r==bd_r1&&bd_c==bd_c2){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null);else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}else if(bd_r==bd_r2&&bd_c==bd_c2){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null);else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}}else if(bd_r==bd_r1){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null){var cell=data[bd_r][bd_c];var mc=cfg["merge"][cell.mc.r+"_"+cell.mc.c];if(mc.c==bd_c){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};}else if(mc.c+mc.cs-1==bd_c){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};}}else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}else if(bd_r==bd_r2){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null){var cell=data[bd_r][bd_c];var mc=cfg["merge"][cell.mc.r+"_"+cell.mc.c];if(mc.c==bd_c){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};}else if(mc.c+mc.cs-1==bd_c){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};}}else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}}else if(bd_c==bd_c1){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null){var cell=data[bd_r][bd_c];var mc=cfg["merge"][cell.mc.r+"_"+cell.mc.c];if(mc.r==bd_r){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}else if(mc.r+mc.rs-1==bd_r){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}else if(bd_c==bd_c2){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null){var cell=data[bd_r][bd_c];var mc=cfg["merge"][cell.mc.r+"_"+cell.mc.c];if(mc.r==bd_r){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}else if(mc.r+mc.rs-1==bd_r){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}else {if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null){var cell=data[bd_r][bd_c];var mc=cfg["merge"][cell.mc.r+"_"+cell.mc.c];if(mc.r==bd_r){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}else if(mc.r+mc.rs-1==bd_r){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}if(mc.c==bd_c){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};}else if(mc.c+mc.cs-1==bd_c){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};}}else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}}}}else if(borderType=="border-horizontal"){for(var bd_r=bd_r1;bd_r<=bd_r2;bd_r++){if(cfg["rowhidden"]!=null&&cfg["rowhidden"][bd_r]!=null){continue;}for(var bd_c=bd_c1;bd_c<=bd_c2;bd_c++){if(bd_r==bd_r1){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null);else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}else if(bd_r==bd_r2){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null);else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}}else {if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null){var cell=data[bd_r][bd_c];var mc=cfg["merge"][cell.mc.r+"_"+cell.mc.c];if(mc.r==bd_r){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};}else if(mc.r+mc.rs-1==bd_r){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].t={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].b={"color":borderColor,"style":borderStyle};}}}}}else if(borderType=="border-vertical"){for(var bd_r=bd_r1;bd_r<=bd_r2;bd_r++){if(cfg["rowhidden"]!=null&&cfg["rowhidden"][bd_r]!=null){continue;}for(var bd_c=bd_c1;bd_c<=bd_c2;bd_c++){if(bd_c==bd_c1){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null);else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};}}else if(bd_c==bd_c2){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null);else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};}}else {if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null){var cell=data[bd_r][bd_c];var mc=cfg["merge"][cell.mc.r+"_"+cell.mc.c];if(mc.c==bd_c){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};}else if(mc.c+mc.cs-1==bd_c){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};}}else {if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}borderInfoCompute[bd_r+"_"+bd_c].l={"color":borderColor,"style":borderStyle};borderInfoCompute[bd_r+"_"+bd_c].r={"color":borderColor,"style":borderStyle};}}}}}else if(borderType=="border-none"){for(var bd_r=bd_r1;bd_r<=bd_r2;bd_r++){if(cfg["rowhidden"]!=null&&cfg["rowhidden"][bd_r]!=null){continue;}for(var bd_c=bd_c1;bd_c<=bd_c2;bd_c++){if(borderInfoCompute[bd_r+"_"+bd_c]!=null){delete borderInfoCompute[bd_r+"_"+bd_c];}if(bd_r==bd_r1){var bd_r_top=bd_r1-1;if(bd_r_top>=0&&borderInfoCompute[bd_r_top+"_"+bd_c]){delete borderInfoCompute[bd_r_top+"_"+bd_c].b;}}if(bd_r==bd_r2){var bd_r_bottom=bd_r2+1;if(bd_r_bottom<data.length&&borderInfoCompute[bd_r_bottom+"_"+bd_c]){delete borderInfoCompute[bd_r_bottom+"_"+bd_c].t;}}if(bd_c==bd_c1){var bd_c_left=bd_c1-1;if(bd_c_left>=0&&borderInfoCompute[bd_r+"_"+bd_c_left]){delete borderInfoCompute[bd_r+"_"+bd_c_left].r;}}if(bd_c==bd_c2){var bd_c_right=bd_c2+1;if(bd_c_right<data[0].length&&borderInfoCompute[bd_r+"_"+bd_c_right]){delete borderInfoCompute[bd_r+"_"+bd_c_right].l;}}}}}}}else if(rangeType=="cell"){var value=borderInfo[i].value;var bd_r=value.row_index,bd_c=value.col_index;if(cfg["rowhidden"]!=null&&cfg["rowhidden"][bd_r]!=null){continue;}if(value.l!=null||value.r!=null||value.t!=null||value.b!=null){if(borderInfoCompute[bd_r+"_"+bd_c]==null){borderInfoCompute[bd_r+"_"+bd_c]={};}if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c])=="object"&&data[bd_r][bd_c].mc!=null){var cell=data[bd_r][bd_c];var mc=cfg["merge"][cell.mc.r+"_"+cell.mc.c];if(value.l!=null&&bd_c==mc.c){//左边框
  borderInfoCompute[bd_r+"_"+bd_c].l={"color":value.l.color,"style":value.l.style};var bd_c_left=bd_c-1;if(bd_c_left>=0&&borderInfoCompute[bd_r+"_"+bd_c_left]){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c_left])=="object"&&data[bd_r][bd_c_left].mc!=null){var cell_left=data[bd_r][bd_c_left];var mc_l=cfg["merge"][cell_left.mc.r+"_"+cell_left.mc.c];if(mc_l.c+mc_l.cs-1==bd_c_left){borderInfoCompute[bd_r+"_"+bd_c_left].r={"color":value.l.color,"style":value.l.style};}}else {borderInfoCompute[bd_r+"_"+bd_c_left].r={"color":value.l.color,"style":value.l.style};}}}else {borderInfoCompute[bd_r+"_"+bd_c].l=null;}if(value.r!=null&&bd_c==mc.c+mc.cs-1){//右边框
  borderInfoCompute[bd_r+"_"+bd_c].r={"color":value.r.color,"style":value.r.style};var bd_c_right=bd_c+1;if(bd_c_right<data[0].length&&borderInfoCompute[bd_r+"_"+bd_c_right]){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c_right])=="object"&&data[bd_r][bd_c_right].mc!=null){var cell_right=data[bd_r][bd_c_right];var mc_r=cfg["merge"][cell_right.mc.r+"_"+cell_right.mc.c];if(mc_r.c==bd_c_right){borderInfoCompute[bd_r+"_"+bd_c_right].l={"color":value.r.color,"style":value.r.style};}}else {borderInfoCompute[bd_r+"_"+bd_c_right].l={"color":value.r.color,"style":value.r.style};}}}else {borderInfoCompute[bd_r+"_"+bd_c].r=null;}if(value.t!=null&&bd_r==mc.r){//上边框
  borderInfoCompute[bd_r+"_"+bd_c].t={"color":value.t.color,"style":value.t.style};var bd_r_top=bd_r-1;if(bd_r_top>=0&&borderInfoCompute[bd_r_top+"_"+bd_c]){if(data[bd_r_top]!=null&&luckysheet.getObjType(data[bd_r_top][bd_c])=="object"&&data[bd_r_top][bd_c].mc!=null){var cell_top=data[bd_r_top][bd_c];var mc_t=cfg["merge"][cell_top.mc.r+"_"+cell_top.mc.c];if(mc_t.r+mc_t.rs-1==bd_r_top){borderInfoCompute[bd_r_top+"_"+bd_c].b={"color":value.t.color,"style":value.t.style};}}else {borderInfoCompute[bd_r_top+"_"+bd_c].b={"color":value.t.color,"style":value.t.style};}}}else {borderInfoCompute[bd_r+"_"+bd_c].t=null;}if(value.b!=null&&bd_r==mc.r+mc.rs-1){//下边框
  borderInfoCompute[bd_r+"_"+bd_c].b={"color":value.b.color,"style":value.b.style};var bd_r_bottom=bd_r+1;if(bd_r_bottom<data.length&&borderInfoCompute[bd_r_bottom+"_"+bd_c]){if(data[bd_r_bottom]!=null&&luckysheet.getObjType(data[bd_r_bottom][bd_c])=="object"&&data[bd_r_bottom][bd_c].mc!=null){var cell_bottom=data[bd_r_bottom][bd_c];var mc_b=cfg["merge"][cell_bottom.mc.r+"_"+cell_bottom.mc.c];if(mc_b.r==bd_r_bottom){borderInfoCompute[bd_r_bottom+"_"+bd_c].t={"color":value.b.color,"style":value.b.style};}}else {borderInfoCompute[bd_r_bottom+"_"+bd_c].t={"color":value.b.color,"style":value.b.style};}}}else {borderInfoCompute[bd_r+"_"+bd_c].b=null;}}else {if(value.l!=null){//左边框
  borderInfoCompute[bd_r+"_"+bd_c].l={"color":value.l.color,"style":value.l.style};var bd_c_left=bd_c-1;if(bd_c_left>=0&&borderInfoCompute[bd_r+"_"+bd_c_left]){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c_left])=="object"&&data[bd_r][bd_c_left].mc!=null){var cell_left=data[bd_r][bd_c_left];var mc_l=cfg["merge"][cell_left.mc.r+"_"+cell_left.mc.c];if(mc_l.c+mc_l.cs-1==bd_c_left){borderInfoCompute[bd_r+"_"+bd_c_left].r={"color":value.l.color,"style":value.l.style};}}else {borderInfoCompute[bd_r+"_"+bd_c_left].r={"color":value.l.color,"style":value.l.style};}}}else {borderInfoCompute[bd_r+"_"+bd_c].l=null;}if(value.r!=null){//右边框
  borderInfoCompute[bd_r+"_"+bd_c].r={"color":value.r.color,"style":value.r.style};var bd_c_right=bd_c+1;if(bd_c_right<data[0].length&&borderInfoCompute[bd_r+"_"+bd_c_right]){if(data[bd_r]!=null&&luckysheet.getObjType(data[bd_r][bd_c_right])=="object"&&data[bd_r][bd_c_right].mc!=null){var cell_right=data[bd_r][bd_c_right];var mc_r=cfg["merge"][cell_right.mc.r+"_"+cell_right.mc.c];if(mc_r.c==bd_c_right){borderInfoCompute[bd_r+"_"+bd_c_right].l={"color":value.r.color,"style":value.r.style};}}else {borderInfoCompute[bd_r+"_"+bd_c_right].l={"color":value.r.color,"style":value.r.style};}}}else {borderInfoCompute[bd_r+"_"+bd_c].r=null;}if(value.t!=null){//上边框
  borderInfoCompute[bd_r+"_"+bd_c].t={"color":value.t.color,"style":value.t.style};var bd_r_top=bd_r-1;if(bd_r_top>=0&&borderInfoCompute[bd_r_top+"_"+bd_c]){if(data[bd_r_top]!=null&&luckysheet.getObjType(data[bd_r_top][bd_c])=="object"&&data[bd_r_top][bd_c].mc!=null){var cell_top=data[bd_r_top][bd_c];var mc_t=cfg["merge"][cell_top.mc.r+"_"+cell_top.mc.c];if(mc_t.r+mc_t.rs-1==bd_r_top){borderInfoCompute[bd_r_top+"_"+bd_c].b={"color":value.t.color,"style":value.t.style};}}else {borderInfoCompute[bd_r_top+"_"+bd_c].b={"color":value.t.color,"style":value.t.style};}}}else {borderInfoCompute[bd_r+"_"+bd_c].t=null;}if(value.b!=null){//下边框
  borderInfoCompute[bd_r+"_"+bd_c].b={"color":value.b.color,"style":value.b.style};var bd_r_bottom=bd_r+1;if(bd_r_bottom<data.length&&borderInfoCompute[bd_r_bottom+"_"+bd_c]){if(data[bd_r_bottom]!=null&&luckysheet.getObjType(data[bd_r_bottom][bd_c])=="object"&&data[bd_r_bottom][bd_c].mc!=null){var cell_bottom=data[bd_r_bottom][bd_c];var mc_b=cfg["merge"][cell_bottom.mc.r+"_"+cell_bottom.mc.c];if(mc_b.r==bd_r_bottom){borderInfoCompute[bd_r_bottom+"_"+bd_c].t={"color":value.b.color,"style":value.b.style};}}else {borderInfoCompute[bd_r_bottom+"_"+bd_c].t={"color":value.b.color,"style":value.b.style};}}}else {borderInfoCompute[bd_r+"_"+bd_c].b=null;}}}else {delete borderInfoCompute[bd_r+"_"+bd_c];}}}}return borderInfoCompute;};var luckysheetbinary_search=function luckysheetbinary_search(arr,key){var low=0,high=arr.length-1;while(low<=high){var mid=parseInt((high+low)/2);if(key<arr[mid]&&(mid==0||key>=arr[mid-1])){return mid;}else if(key>=arr[mid]){low=mid+1;}else if(key<arr[mid]){high=mid-1;}else {return -1;}}};var luckysheetorder_search=function luckysheetorder_search(arr,y){var i=0,row=0,row_pre=0,row_index=-1,i_ed=arr.length-1;while(i<arr.length&&i_ed>=0&&i_ed>=i){row=arr[i_ed];if(i_ed==0){row_pre=0;}else {row_pre=arr[i_ed-1];}if(y>=row_pre&&y<row){row_index=i_ed;break;}row=arr[i];if(i==0){row_pre=0;}else {row_pre=arr[i-1];}if(y>=row_pre&&y<row){row_index=i;break;}i++;i_ed--;}return row_index;};var luckysheet_searcharray=function luckysheet_searcharray(arr,y){if(luckysheetConfigsetting.pointEdit){arr=$.extend(true,[],arr);for(var i=0;i<arr.length;i++){arr[i]=arr[i]*luckysheetConfigsetting.pointEditZoom;}}var index=arr.length-1;if(arr.length<40||y<=arr[20]||y>=arr[index-20]){index=luckysheetorder_search(arr,y);}else {index=luckysheetbinary_search(arr,y);}return index;};//, columeflowset, rowflowset
  luckysheet.luckysheetHandler=function(){//var rowshowstate = [];
  //for(var i=0; i<flowheight_end;i++){
  //    if(i<3){
  //        rowshowstate.append(true);
  //    }
  //    else{
  //        rowshowstate.append(false);
  //    }
  //}
  //var colshowstate = [];
  //for(var i=0; i<flowwidth_end;i++){
  //    if(i<2){
  //        colshowstate.append(true);
  //    }
  //    else{
  //        colshowstate.append(false);
  //    }
  //}
  //全局滚动事件
  luckysheet.luckysheetscrollevent=function(isadjust){var $t=$("#luckysheet-cell-main");var scrollLeft=$("#luckysheet-scrollbar-x").scrollLeft(),scrollTop=$("#luckysheet-scrollbar-y").scrollTop();// if (!!isadjust && luckysheetautoadjustmousedown != 0) {
  //     var scrollHeight = $t.get(0).scrollHeight;
  //     var windowHeight = $t.height();
  //     var scrollWidth = $t.get(0).scrollWidth;
  //     var windowWidth = $t.width();
  //     var maxScrollLeft = scrollWidth - windowWidth;
  //     var maxScrollTop = scrollHeight - windowHeight;
  //     var visibledatacolumn_c = visibledatacolumn, visibledatarow_c = visibledatarow;
  //     // if (luckysheet.freezen.freezenhorizontaldata != null || luckysheet.freezen.freezenverticaldata != null) {
  //     //     // luckysheet.cleargridelement();
  //     // }
  //     if (luckysheet.freezen.freezenhorizontaldata != null) {
  //         visibledatarow_c = luckysheet.freezen.freezenhorizontaldata[3];
  //     }
  //     if (luckysheet.freezen.freezenverticaldata != null) {
  //         visibledatacolumn_c = luckysheet.freezen.freezenverticaldata[3];
  //     }
  //     var col_ed = luckysheet_searcharray(visibledatacolumn_c, scrollLeft);
  //     var row_ed = luckysheet_searcharray(visibledatarow_c, scrollTop);
  //     //var col_ed_e = luckysheet_searcharray(visibledatacolumn_c, scrollLeft + luckysheetTableContentHW[0]);
  //     //var row_ed_e = luckysheet_searcharray(visibledatarow_c, scrollTop + luckysheetTableContentHW[1]);
  //     var refreshLeft = scrollLeft , refreshTop = scrollTop;
  //     if (col_ed <= 0) {
  //         scrollLeft = 0;
  //     }
  //     else {
  //         scrollLeft = visibledatacolumn_c[col_ed - 1];
  //     }
  //     if (row_ed <= 0) {
  //         scrollTop = 0;
  //     }
  //     else {
  //         scrollTop = visibledatarow_c[row_ed - 1];
  //     }
  //     // if (luckysheetautoscrollp[0] < scrollLeft) {
  //     //     //col_ed += 1;
  //     //     if (col_ed <= 0) {
  //     //         scrollLeft = visibledatacolumn_c[0];
  //     //     }
  //     //     else {
  //     //         scrollLeft = visibledatacolumn_c[col_ed-1];
  //     //     }
  //     // }
  //     // else if (luckysheetautoscrollp[0] >= scrollLeft) {
  //     //     //col_ed -= 1;
  //     //     if (col_ed <= 0) {
  //     //         scrollLeft = 0;
  //     //     }
  //     //     else {
  //     //         scrollLeft = visibledatacolumn_c[col_ed];
  //     //     }
  //     // }
  //     // if (luckysheetautoscrollp[1] < scrollTop) {
  //     //     //row_ed += luckysheetautoadjustmousedown;
  //     //     if (row_ed == 0) {
  //     //         scrollTop = visibledatarow_c[0];
  //     //     }
  //     //     else {
  //     //         scrollTop = visibledatarow_c[row_ed-1];
  //     //     }
  //     //     //console.log(scrollTop, visibledatarow_c, row_ed);
  //     // }
  //     // else if (luckysheetautoscrollp[1] >= scrollTop) {
  //     //     //row_ed -= luckysheetautoadjustmousedown;
  //     //     if (row_ed <= 0) {
  //     //         scrollTop = 0;
  //     //     }
  //     //     else {
  //     //         scrollTop = visibledatarow_c[row_ed];
  //     //     }
  //     // }
  // }
  if(luckysheet.freezen.freezenhorizontaldata!=null){if(scrollTop<luckysheet.freezen.freezenhorizontaldata[2]){scrollTop=luckysheet.freezen.freezenhorizontaldata[2];$("#luckysheet-scrollbar-y").scrollTop(scrollTop);return;//$(this).scrollTop(scrollTop);
  }}if(luckysheet.freezen.freezenverticaldata!=null){if(scrollLeft<luckysheet.freezen.freezenverticaldata[2]){scrollLeft=luckysheet.freezen.freezenverticaldata[2];$("#luckysheet-scrollbar-x").scrollLeft(scrollLeft);return;//$(this).scrollTop(scrollLeft);
  }}$("#luckysheet-cols-h-c").scrollLeft(scrollLeft);//列标题
  $("#luckysheet-rows-h").scrollTop(scrollTop);//行标题
  $t.scrollLeft(scrollLeft).scrollTop(scrollTop);$("#luckysheet-input-box-index").css({"left":$("#luckysheet-input-box").css("left"),"top":parseInt($("#luckysheet-input-box").css("top"))-20+"px","z-index":$("#luckysheet-input-box").css("z-index")}).show();luckysheet.luckysheetrefreshgrid(scrollLeft,scrollTop);$("#luckysheet-bottom-controll-row").css("left",scrollLeft+10);//有选区且有冻结时，滚动适应
  if(luckysheet.freezen.freezenhorizontaldata!=null||luckysheet.freezen.freezenverticaldata!=null){luckysheet.freezen.scrollAdapt();}};$("#luckysheet-cell-main").scroll(function(){//luckysheet.luckysheetscrollevent(true);
  // else{
  // 	luckysheetautoadjust = setTimeout(function(){
  //         luckysheet.luckysheetscrollevent(true);
  //     }, 100);
  // }
  // luckysheetautoadjust = setTimeout(function(){
  //     luckysheet.luckysheetscrollevent(true);
  // }, 100);
  }).mousewheel(function(event,delta){//luckysheetautoadjustmousedown = 2;
  //$("#luckysheet-scrollbar-x").scrollLeft($("#luckysheet-scrollbar-x").scrollLeft() - event.deltaX*19*2);
  //$("#luckysheet-scrollbar-y").scrollTop($("#luckysheet-scrollbar-y").scrollTop() - event.deltaY*19*2);
  event.preventDefault();});$("#luckysheet-grid-window-1").mousewheel(function(event,delta){var scrollLeft=$("#luckysheet-scrollbar-x").scrollLeft(),scrollTop=$("#luckysheet-scrollbar-y").scrollTop();var visibledatacolumn_c=visibledatacolumn,visibledatarow_c=visibledatarow;if(luckysheet.freezen.freezenhorizontaldata!=null){visibledatarow_c=luckysheet.freezen.freezenhorizontaldata[3];}if(luckysheet.freezen.freezenverticaldata!=null){visibledatacolumn_c=luckysheet.freezen.freezenverticaldata[3];}visibledatacolumn_c=luckysheet.ArrayUnique(visibledatacolumn_c);visibledatarow_c=luckysheet.ArrayUnique(visibledatarow_c);var col_st=luckysheet_searcharray(visibledatacolumn_c,scrollLeft);var row_st=luckysheet_searcharray(visibledatarow_c,scrollTop);var colscroll=0;var rowscroll=0;if(event.deltaX!=0){if(event.deltaX<0){var col_ed=col_st+3;if(col_ed>=visibledatacolumn_c.length){col_ed=visibledatacolumn_c.length-1;}}else {var col_ed=col_st-3;if(col_ed<0){col_ed=0;}}colscroll=col_ed==0?0:visibledatacolumn_c[col_ed-1];$("#luckysheet-scrollbar-x").scrollLeft(colscroll);}if(event.deltaY!=0){if(event.deltaY<0){var row_ed=row_st+3;if(row_ed>=visibledatarow_c.length){row_ed=visibledatarow_c.length-1;}}else {var row_ed=row_st-3;if(row_ed<0){row_ed=0;}}rowscroll=row_ed==0?0:visibledatarow_c[row_ed-1];$("#luckysheet-scrollbar-y").scrollTop(rowscroll);}});$("#luckysheet-scrollbar-x").scroll(function(){//luckysheet.luckysheetscrollevent(true);
  setTimeout(function(){luckysheet.luckysheetscrollevent(true);},10);}).mousewheel(function(event,delta){event.preventDefault();});$("#luckysheet-scrollbar-y").scroll(function(){//luckysheet.luckysheetscrollevent(true);
  setTimeout(function(){luckysheet.luckysheetscrollevent(true);},10);}).mousewheel(function(event,delta){event.preventDefault();});$(window).resize(function(){var luckysheetDocument=document.getElementById("luckysheet");if(luckysheetDocument){luckysheet.luckysheetsizeauto();}//luckysheetautoadjustmousedown = 2;
  });//数组去重
  luckysheet.ArrayUnique=function(dataArr){var arr=[];if(dataArr.length>0){for(var i=0;i<dataArr.length;i++){if(arr.indexOf(dataArr[i])==-1){arr.push(dataArr[i]);}}}return arr;};luckysheet.rowLocationByIndex=function(row_index){var row=0,row_pre=0;row=visibledatarow[row_index];if(row_index==0){row_pre=0;}else {row_pre=visibledatarow[row_index-1];}return [row_pre,row,row_index];};luckysheet.rowLocation=function(y){//var row = 0, row_pre = 0;
  var row_index=luckysheet_searcharray(visibledatarow,y);if(row_index==-1&&y>0){row_index=visibledatarow.length-1;}else if(row_index==-1&&y<=0){row_index=0;}// row = visibledatarow[row_index];
  // if (row_index == 0) {
  //     row_pre = 0;
  // }
  // else {
  //     row_pre = visibledatarow[row_index - 1];
  // }
  return luckysheet.rowLocationByIndex(row_index);};luckysheet.colLocationByIndex=function(col_index){var col=0,col_pre=0;col=visibledatacolumn[col_index];if(col_index==0){col_pre=0;}else {col_pre=visibledatacolumn[col_index-1];}return [col_pre,col,col_index];};luckysheet.colLocation=function(x){//var col = 0, col_pre = 0;
  var col_index=luckysheet_searcharray(visibledatacolumn,x);if(col_index==-1&&x>0){col_index=visibledatacolumn.length-1;}else if(col_index==-1&&x<=0){col_index=0;}return luckysheet.colLocationByIndex(col_index);// col = visibledatacolumn[col_index];
  // if (col_index == 0) {
  //     col_pre = 0;
  // }
  // else {
  //     col_pre = visibledatacolumn[col_index - 1];
  // }
  // return [col_pre, col, col_index];
  };var mouseposition=function mouseposition(x,y){var container_offset=$("#"+container).offset();if(luckysheetConfigsetting.pointEdit){var newX=x-container_offset.left-rowHeaderWidth*luckysheetConfigsetting.pointEditZoom,newY=y-container_offset.top-(infobarHeight+toolbarHeight+calculatebarHeight+columeHeaderHeight)*luckysheetConfigsetting.pointEditZoom;}else {var newX=x-container_offset.left-rowHeaderWidth,newY=y-container_offset.top-infobarHeight-toolbarHeight-calculatebarHeight-columeHeaderHeight;}return [newX,newY];};luckysheet.mouseposition=mouseposition;//选区拖动替换
  var luckysheet_cell_selected_move=false,luckysheet_cell_selected_move_index=[];$("#luckysheet-cell-main div.luckysheet-cs-draghandle").mousedown(function(event){if(luckysheet.isEditMode()){//此模式下禁用选区拖动
  return;}$("#luckysheet-cell-selected").find(".luckysheet-cs-fillhandle").css("cursor","move").end().find(".luckysheet-cs-draghandle").css("cursor","move");$("#luckysheet-cell-main, #luckysheetTableContent, #luckysheet-sheettable_0").css("cursor","move");luckysheet_cell_selected_move=true;luckysheet_scroll_status=true;var mouse=mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();var rowLocation=luckysheet.rowLocation(y),row_pre=rowLocation[0],row=rowLocation[1],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col_pre=colLocation[0],col=colLocation[1],col_index=colLocation[2];luckysheet_cell_selected_move_index=[row_index,col_index];$("#luckysheet-cell-selected-move").css({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"display":"block"});event.stopPropagation();});//选区下拉
  var luckysheet_cell_selected_extend=false,luckysheet_cell_selected_extend_index=[],luckysheet_cell_selected_extend_time=null;$("#luckysheet-cell-main div.luckysheet-cs-fillhandle").mousedown(function(event){if(luckysheet.isEditMode()){//此模式下禁用选区下拉
  return;}$("#luckysheet-cell-selected").find(".luckysheet-cs-fillhandle").css("cursor","crosshair").end().find(".luckysheet-cs-draghandle").css("cursor","crosshair");$("#luckysheet-cell-main, #luckysheetTableContent, #luckysheet-sheettable_0").css("cursor","crosshair");luckysheet_cell_selected_extend_time=setTimeout(function(){luckysheet_cell_selected_extend=true;luckysheet_scroll_status=true;var mouse=mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft()-5;var y=mouse[1]+$("#luckysheet-cell-main").scrollTop()-5;var rowLocation=luckysheet.rowLocation(y),row_pre=rowLocation[0],row=rowLocation[1],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col_pre=colLocation[0],col=colLocation[1],col_index=colLocation[2];luckysheet_cell_selected_extend_index=[row_index,col_index];$("#luckysheet-cell-selected-extend").css({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"display":"block"});},100);event.stopPropagation();}).click(function(){clearTimeout(luckysheet_cell_selected_extend_time);event.stopPropagation();}).dblclick(function(){var last=luckysheet_select_save[0];var r0=last.row[0],r1=last.row[1],c0=last.column[0],c1=last.column[1];if(luckysheet.pivotTable.isPivotRange(r0,c0)){return;}var dropCellState=false;var step=0;for(var r=r1+1;r<luckysheet.flowdata.length;r++){if(c0-1>=0&&c1+1<luckysheet.flowdata[0].length){var cell1=luckysheet.flowdata[r][c0-1];var cell2=luckysheet.flowdata[r][c1+1];if(r==r1+1){if((cell1==null||luckysheet.func_methods.isRealNull(cell1.v))&&(cell2==null||luckysheet.func_methods.isRealNull(cell2.v))){dropCellState=false;break;}else {dropCellState=true;step++;}}else {if((cell1==null||luckysheet.func_methods.isRealNull(cell1.v))&&(cell2==null||luckysheet.func_methods.isRealNull(cell2.v))){break;}step++;}}else if(c0-1>=0){var cell=luckysheet.flowdata[r][c0-1];if(r==r1+1){if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){dropCellState=false;break;}else {dropCellState=true;step++;}}else {if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){break;}step++;}}else if(c1+1<luckysheet.flowdata[0].length){var cell=luckysheet.flowdata[r][c1+1];if(r==r1+1){if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){dropCellState=false;break;}else {dropCellState=true;step++;}}else {if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){break;}step++;}}}if(!dropCellState||step==0){event.stopPropagation();return;}//复制范围
  luckysheet.dropCell.copyRange={"row":[r0,r1],"column":[c0,c1]};//applyType
  var typeItemHide=luckysheet.dropCell.typeItemHide();if(!typeItemHide[0]&&!typeItemHide[1]&&!typeItemHide[2]&&!typeItemHide[3]&&!typeItemHide[4]&&!typeItemHide[5]&&!typeItemHide[6]){luckysheet.dropCell.applyType="0";}else {luckysheet.dropCell.applyType="1";}luckysheet.dropCell.applyRange={"row":[r1+1,r1+step],"column":[c0,c1]};luckysheet.dropCell.direction="down";luckysheet_select_save=[{"row":[r0,r1+step],"column":[c0,c1]}];luckysheet.dropCell.update();luckysheet.dropCell.createIcon();$("#luckysheet-cell-selected-move").hide();$("#luckysheet-sheettable").css("cursor","default");clearTimeout(jfcountfuncTimeout);jfcountfuncTimeout=setTimeout(function(){jfcountfunc();},500);event.stopPropagation();});$("#luckysheet-cell-main, #luckysheetTableContent").mousedown(function(event){$("#luckysheet-cell-selected").find(".luckysheet-cs-fillhandle").css("cursor","default").end().find(".luckysheet-cs-draghandle").css("cursor","default");$("#luckysheet-cell-main, #luckysheetTableContent, #luckysheet-sheettable_0").css("cursor","default");//有批注在编辑时
  luckysheet.postil.removeActivePs();//luckysheetautoadjustmousedown = 1;
  var mouse=mouseposition(event.pageX,event.pageY);if(mouse[0]>=cellmainWidth-cellMainSrollBarSize||mouse[1]>=cellmainHeight-cellMainSrollBarSize){return;}var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();if(luckysheet.freezen.freezenverticaldata!=null&&mouse[0]<luckysheet.freezen.freezenverticaldata[0]-luckysheet.freezen.freezenverticaldata[2]){x=mouse[0]+luckysheet.freezen.freezenverticaldata[2];}if(luckysheet.freezen.freezenhorizontaldata!=null&&mouse[1]<luckysheet.freezen.freezenhorizontaldata[0]-luckysheet.freezen.freezenhorizontaldata[2]){y=mouse[1]+luckysheet.freezen.freezenhorizontaldata[2];}var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];var row_index_ed=row_index,col_index_ed=col_index;var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,row_index,col_index);if(!!margeset){row=margeset.row[1];row_pre=margeset.row[0];row_index=margeset.row[2];row_index_ed=margeset.row[3];col=margeset.column[1];col_pre=margeset.column[0];col_index=margeset.column[2];col_index_ed=margeset.column[3];}//若点击单元格部分不在视图内
  if(col_pre<$("#luckysheet-cell-main").scrollLeft()){$("#luckysheet-scrollbar-x").scrollLeft(col_pre);}if(row_pre<$("#luckysheet-cell-main").scrollTop()){$("#luckysheet-scrollbar-y").scrollTop(row_pre);}//mousedown是右键
  if(event.which=="3"){var isright=false;for(var s=0;s<luckysheet_select_save.length;s++){if(luckysheet_select_save[s]["row"]!=null&&row_index>=luckysheet_select_save[s]["row"][0]&&row_index<=luckysheet_select_save[s]["row"][1]&&col_index>=luckysheet_select_save[s]["column"][0]&&col_index<=luckysheet_select_save[s]["column"][1]){isright=true;break;}}if(isright){return;}}//单元格数据下钻
  if(luckysheet.flowdata[row_index]!=null&&luckysheet.flowdata[row_index][col_index]!=null&&luckysheet.flowdata[row_index][col_index].dd!=null){if(luckysheetConfigsetting.fireMousedown!=null&&luckysheet.getObjType(luckysheetConfigsetting.fireMousedown)=="function"){luckysheetConfigsetting.fireMousedown(luckysheet.flowdata[row_index][col_index].dd);return;}}luckysheet_scroll_status=true;//公式相关
  var $input=$("#luckysheet-input-box");if(parseInt($input.css("top"))>0){if(luckysheet.formula.rangestart||luckysheet.formula.rangedrag_column_start||luckysheet.formula.rangedrag_row_start||luckysheet.formula.israngeseleciton()){//公式选区
  var rowseleted=[row_index,row_index_ed];var columnseleted=[col_index,col_index_ed];var left=col_pre;var width=col-col_pre-1;var top=row_pre;var height=row-row_pre-1;if(event.shiftKey){var last=luckysheet.formula.func_selectedrange;var top=0,height=0,rowseleted=[];if(last.top>row_pre){top=row_pre;height=last.top+last.height-row_pre;if(last.row[1]>last.row_focus){last.row[1]=last.row_focus;}rowseleted=[row_index,last.row[1]];}else if(last.top==row_pre){top=row_pre;height=last.top+last.height-row_pre;rowseleted=[row_index,last.row[0]];}else {top=last.top;height=row-last.top-1;if(last.row[0]<last.row_focus){last.row[0]=last.row_focus;}rowseleted=[last.row[0],row_index];}var left=0,width=0,columnseleted=[];if(last.left>col_pre){left=col_pre;width=last.left+last.width-col_pre;if(last.column[1]>last.column_focus){last.column[1]=last.column_focus;}columnseleted=[col_index,last.column[1]];}else if(last.left==col_pre){left=col_pre;width=last.left+last.width-col_pre;columnseleted=[col_index,last.column[0]];}else {left=last.left;width=col-last.left-1;if(last.column[0]<last.column_focus){last.column[0]=last.column_focus;}columnseleted=[last.column[0],col_index];}var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,rowseleted,last,top,height,left,width);if(changeparam!=null){columnseleted=changeparam[0];rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];left=changeparam[4];width=changeparam[5];}luckysheet.luckysheet_count_show(left,top,width,height,rowseleted,columnseleted);last["row"]=rowseleted;last["column"]=columnseleted;last["left_move"]=left;last["width_move"]=width;last["top_move"]=top;last["height_move"]=height;luckysheet.formula.func_selectedrange=last;}else if(event.ctrlKey&&$("#luckysheet-rich-text-editor").find("span").last().text()!=","){//按住ctrl 选择选区时  先处理上一个选区
  var vText=$("#luckysheet-rich-text-editor").text()+",";if(vText.length>0&&vText.substr(0,1)=="="){vText=luckysheet.formula.functionHTMLGenerate(vText);if(window.getSelection){// all browsers, except IE before version 9
  var currSelection=window.getSelection();luckysheet.formula.functionRangeIndex=[$(currSelection.anchorNode).parent().index(),currSelection.anchorOffset];}else {// Internet Explorer before version 9
  var textRange=document.selection.createRange();luckysheet.formula.functionRangeIndex=textRange;}$("#luckysheet-rich-text-editor").html(vText);luckysheet.formula.canceFunctionrangeSelected();luckysheet.formula.createRangeHightlight();}luckysheet.formula.rangestart=false;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;$("#luckysheet-functionbox-cell").html(vText);luckysheet.formula.rangeHightlightselected($("#luckysheet-rich-text-editor"));//再进行 选区的选择
  luckysheet.formula.israngeseleciton();luckysheet.formula.func_selectedrange={"left":left,"width":width,"top":top,"height":height,"left_move":left,"width_move":width,"top_move":top,"height_move":height,"row":rowseleted,"column":columnseleted,"row_focus":row_index,"column_focus":col_index};}else {luckysheet.formula.func_selectedrange={"left":left,"width":width,"top":top,"height":height,"left_move":left,"width_move":width,"top_move":top,"height_move":height,"row":rowseleted,"column":columnseleted,"row_focus":row_index,"column_focus":col_index};}luckysheet.formula.rangeSetValue({"row":rowseleted,"column":columnseleted});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;$("#luckysheet-formula-functionrange-select").css({"left":left,"width":width,"top":top,"height":height}).show();$("#luckysheet-formula-help-c").hide();luckysheet.luckysheet_count_show(left,top,width,height,rowseleted,columnseleted);setTimeout(function(){var currSelection=window.getSelection();var anchorOffset=currSelection.anchorNode;if($("#luckysheet-search-formula-parm").is(":visible")||$("#luckysheet-search-formula-parm-select").is(":visible")){$editor=$("#luckysheet-rich-text-editor");luckysheet.formula.rangechangeindex=luckysheet.formula.data_parm_index;}else {$editor=$(anchorOffset).closest("div");}var $span=$editor.find("span[rangeindex='"+luckysheet.formula.rangechangeindex+"']");luckysheet.formula.setCaretPosition($span.get(0),0,$span.html().length);},1);return;}else {luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheet_select_status=true;if($("#luckysheet-info").is(":visible")){luckysheet_select_status=false;}}}else {luckysheet_select_status=true;}//条件格式 应用范围可选择多个单元格
  if($("#luckysheet-multiRange-dialog").is(":visible")){luckysheet.conditionformat.selectStatus=true;luckysheet_select_status=false;if(event.shiftKey){var last=luckysheet.conditionformat.selectRange[luckysheet.conditionformat.selectRange.length-1];var top=0,height=0,rowseleted=[];if(last.top>row_pre){top=row_pre;height=last.top+last.height-row_pre;if(last.row[1]>last.row_focus){last.row[1]=last.row_focus;}rowseleted=[row_index,last.row[1]];}else if(last.top==row_pre){top=row_pre;height=last.top+last.height-row_pre;rowseleted=[row_index,last.row[0]];}else {top=last.top;height=row-last.top-1;if(last.row[0]<last.row_focus){last.row[0]=last.row_focus;}rowseleted=[last.row[0],row_index];}var left=0,width=0,columnseleted=[];if(last.left>col_pre){left=col_pre;width=last.left+last.width-col_pre;if(last.column[1]>last.column_focus){last.column[1]=last.column_focus;}columnseleted=[col_index,last.column[1]];}else if(last.left==col_pre){left=col_pre;width=last.left+last.width-col_pre;columnseleted=[col_index,last.column[0]];}else {left=last.left;width=col-last.left-1;if(last.column[0]<last.column_focus){last.column[0]=last.column_focus;}columnseleted=[last.column[0],col_index];}var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,rowseleted,last,top,height,left,width);if(changeparam!=null){columnseleted=changeparam[0];rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];left=changeparam[4];width=changeparam[5];}last["row"]=rowseleted;last["column"]=columnseleted;last["left_move"]=left;last["width_move"]=width;last["top_move"]=top;last["height_move"]=height;luckysheet.conditionformat.selectRange[luckysheet.conditionformat.selectRange.length-1]=last;}else if(event.ctrlKey){luckysheet.conditionformat.selectRange.push({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[row_index,row_index_ed],"column":[col_index,col_index_ed],"row_focus":row_index,"column_focus":col_index});}else {luckysheet.conditionformat.selectRange=[];luckysheet.conditionformat.selectRange.push({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[row_index,row_index_ed],"column":[col_index,col_index_ed],"row_focus":row_index,"column_focus":col_index});}luckysheet.selectionCopyShow(luckysheet.conditionformat.selectRange);var range=luckysheet.conditionformat.getTxtByRange(luckysheet.conditionformat.selectRange);$("#luckysheet-multiRange-dialog input").val(range);return;}else {luckysheet.conditionformat.selectStatus=false;luckysheet.conditionformat.selectRange=[];}//条件格式 条件值只能选择单个单元格
  if($("#luckysheet-singleRange-dialog").is(":visible")){luckysheet_select_status=false;luckysheet.selectionCopyShow([{"row":[row_index,row_index],"column":[col_index,col_index]}]);var range=luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,{"row":[row_index,row_index],"column":[col_index,col_index]},luckysheet.currentSheetIndex);$("#luckysheet-singleRange-dialog input").val(range);return;}//if公式生成器
  if(luckysheet.ifFormulaGenerator.singleRangeFocus){$("#luckysheet-ifFormulaGenerator-dialog .singRange").click();}if($("#luckysheet-ifFormulaGenerator-singleRange-dialog").is(":visible")){//选择单个单元格
  luckysheet_select_status=false;luckysheet.formula.rangestart=false;$("#luckysheet-formula-functionrange-select").css({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1}).show();$("#luckysheet-formula-help-c").hide();var range=luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,{"row":[row_index,row_index],"column":[col_index,col_index]},luckysheet.currentSheetIndex);$("#luckysheet-ifFormulaGenerator-singleRange-dialog input").val(range);return;}if($("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){//选择范围
  luckysheet_select_status=false;luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[row_index,row_index],"column":[col_index,col_index],"row_focus":row_index,"column_focus":col_index};luckysheet.formula.rangestart=true;$("#luckysheet-formula-functionrange-select").css({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1}).show();$("#luckysheet-formula-help-c").hide();var range=luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,{"row":[row_index,row_index],"column":[col_index,col_index]},luckysheet.currentSheetIndex);$("#luckysheet-ifFormulaGenerator-multiRange-dialog input").val(range);$("#luckysheet-row-count-show").hide();$("#luckysheet-column-count-show").hide();return;}if(luckysheet_select_status){if(event.shiftKey){//按住shift点击，选择范围
  var last=$.extend(true,{},luckysheet_select_save[luckysheet_select_save.length-1]);//选区最后一个
  var top=0,height=0,rowseleted=[];if(last.top>row_pre){top=row_pre;height=last.top+last.height-row_pre;if(last.row[1]>last.row_focus){last.row[1]=last.row_focus;}rowseleted=[row_index,last.row[1]];}else if(last.top==row_pre){top=row_pre;height=last.top+last.height-row_pre;rowseleted=[row_index,last.row[0]];}else {top=last.top;height=row-last.top-1;if(last.row[0]<last.row_focus){last.row[0]=last.row_focus;}rowseleted=[last.row[0],row_index];}var left=0,width=0,columnseleted=[];if(last.left>col_pre){left=col_pre;width=last.left+last.width-col_pre;if(last.column[1]>last.column_focus){last.column[1]=last.column_focus;}columnseleted=[col_index,last.column[1]];}else if(last.left==col_pre){left=col_pre;width=last.left+last.width-col_pre;columnseleted=[col_index,last.column[0]];}else {left=last.left;width=col-last.left-1;if(last.column[0]<last.column_focus){last.column[0]=last.column_focus;}columnseleted=[last.column[0],col_index];}var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,rowseleted,last,top,height,left,width);if(changeparam!=null){columnseleted=changeparam[0];rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];left=changeparam[4];width=changeparam[5];}last["row"]=rowseleted;last["column"]=columnseleted;last["left_move"]=left;last["width_move"]=width;last["top_move"]=top;last["height_move"]=height;luckysheet_select_save[luckysheet_select_save.length-1]=last;//交替颜色选择范围
  if($("#luckysheet-alternateformat-rangeDialog").is(":visible")){$("#luckysheet-alternateformat-rangeDialog input").val(luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,luckysheet_select_save));}if(luckysheet.chartparam.luckysheet_chart_data_select_state){$("#luckysheet-datavisual-range-selection-input").val(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].name+"!"+luckysheet.luckysheetchatatABC(luckysheet_select_save[0]["column"][0])+(luckysheet_select_save[0]["row"][0]+1)+":"+luckysheet.luckysheetchatatABC(luckysheet_select_save[0]["column"][1])+(luckysheet_select_save[0]["row"][1]+1));}if(luckysheet.pivotTable.luckysheet_pivotTable_select_state){$("#luckysheet-pivotTable-range-selection-input").val(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].name+"!"+luckysheet.luckysheetchatatABC(luckysheet_select_save[0]["column"][0])+(luckysheet_select_save[0]["row"][0]+1)+":"+luckysheet.luckysheetchatatABC(luckysheet_select_save[0]["column"][1])+(luckysheet_select_save[0]["row"][1]+1));}}else if(event.ctrlKey){//选区添加
  luckysheet_select_save.push({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[row_index,row_index_ed],"column":[col_index,col_index_ed],"row_focus":row_index,"column_focus":col_index});}else {luckysheet_select_save=[];luckysheet_select_save.push({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[row_index,row_index_ed],"column":[col_index,col_index_ed],"row_focus":row_index,"column_focus":col_index});//单元格格式icon对应
  luckysheet.menuButton.menuButtonFocus(luckysheet.flowdata,row_index,col_index);//函数公式显示栏
  luckysheet.formula.fucntionboxshow(row_index,col_index);}luckysheet.selectHightlightShow();if(luckysheet.freezen.freezenhorizontaldata!=null||luckysheet.freezen.freezenverticaldata!=null){luckysheet.freezen.scrollAdaptOfselect();}if(!mobilecheck){//非移动端聚焦输入框
  luckysheetactiveCell();}if(luckysheet.server.allowUpdate){//允许编辑后的后台更新时
  luckysheet.server.saveParam("mv",luckysheet.currentSheetIndex,luckysheet_select_save);}}clearTimeout(luckysheet.chartparam.luckysheet_chart_rangefocus_timeout);if(luckysheet.chartparam.luckysheet_chart_rangefocus){luckysheet.chartparam.luckysheet_chart_rangefocus=false;$("#luckysheet-datavisual-range-button").click();}//交替颜色
  if(luckysheet.alternateformat.rangefocus){luckysheet.alternateformat.rangefocus=false;$("#luckysheet-alternateformat-range .fa-table").click();}$("#luckysheet-row-count-show, #luckysheet-column-count-show").hide();if(!luckysheet.isEditMode()){//chartMix 隐藏当前页的数据选择区域高亮
  !!window.store&&store.commit("hideAllNeedRangeShow");}$("#luckysheet-helpbox-cell").text(luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,luckysheet_select_save[luckysheet_select_save.length-1]));//数据透视表
  luckysheet.pivotTable.pivotclick(row_index,col_index,luckysheet.currentSheetIndex);$("#"+container).attr("tabindex",0).focus();//$("#luckysheet-cols-h-c .luckysheet-cols-h-cells-c .luckysheet-cols-h-cells-clip .luckysheet-cols-h-cell-sel").removeClass("luckysheet-cols-h-cell-sel").addClass("luckysheet-cols-h-cell-nosel");
  //$("#luckysheet-rows-h .luckysheet-rows-h-cells .luckysheet-rows-h-cells-c .luckysheet-rows-h-cells-clip .luckysheet-rows-h-cell-sel").removeClass("luckysheet-rows-h-cell-sel").addClass("luckysheet-rows-h-cell-nosel");
  //$("#luckysheet-cols-h-c .luckysheet-cols-h-cells-c .luckysheet-cols-h-cells-clip .luckysheet-cols-h-cell-nosel").eq(col_index).removeClass("luckysheet-cols-h-cell-nosel").addClass("luckysheet-cols-h-cell-sel");
  //$("#luckysheet-rows-h .luckysheet-rows-h-cells .luckysheet-rows-h-cells-c .luckysheet-rows-h-cells-clip .luckysheet-rows-h-cell-nosel").eq(row_index).removeClass("luckysheet-rows-h-cell-nosel").addClass("luckysheet-rows-h-cell-sel");
  //event.stopImmediatePropagation();
  }).mouseup(function(event){if(event.which=="3"){if(luckysheet.isEditMode()){//非编辑模式下禁止右键功能框
  return;}var x=event.pageX;var y=event.pageY;var obj_s=luckysheet_select_save[0];$("#luckysheet-cols-rows-data").show();$("#luckysheet-cols-rows-add, #luckysheet-cols-rows-shift").hide();if(obj_s["row"]!=null&&obj_s["row"][0]==0&&obj_s["row"][1]==luckysheet.flowdata.length-1){luckysheetRightHeadClickIs="column";$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-word").text("列");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-size").text("宽");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-left").text("左");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-right").text("右");$("#luckysheet-cols-rows-add").show();$("#luckysheet-cols-rows-data").show();$("#luckysheet-cols-rows-shift").hide();luckysheet_cols_menu_status=true;//列宽默认值
  var cfg=$.extend(true,{},config);if(cfg["columlen"]==null){cfg["columlen"]={};}var first_collen=cfg["columlen"][luckysheet_select_save[0].column[0]]==null?luckysheet.defaultcollen:cfg["columlen"][luckysheet_select_save[0].column[0]];var isSame=true;for(var i=0;i<luckysheet_select_save.length;i++){var s=luckysheet_select_save[i];var c1=s.column[0],c2=s.column[1];for(var c=c1;c<=c2;c++){var collen=cfg["columlen"][c]==null?luckysheet.defaultcollen:cfg["columlen"][c];if(collen!=first_collen){isSame=false;break;}}}if(isSame){$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val(first_collen);}else {$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val("");}}else if(obj_s["column"]!=null&&obj_s["column"][0]==0&&obj_s["column"][1]==luckysheet.flowdata[0].length-1){luckysheetRightHeadClickIs="row";$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-word").text("行");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-size").text("高");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-left").text("上");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-right").text("下");$("#luckysheet-cols-rows-add").show();$("#luckysheet-cols-rows-data").show();$("#luckysheet-cols-rows-shift").hide();luckysheet_cols_menu_status=true;//行高默认值
  var cfg=$.extend(true,{},config);if(cfg["rowlen"]==null){cfg["rowlen"]={};}var first_rowlen=cfg["rowlen"][luckysheet_select_save[0].row[0]]==null?luckysheet.defaultrowlen:cfg["rowlen"][luckysheet_select_save[0].row[0]];var isSame=true;for(var i=0;i<luckysheet_select_save.length;i++){var s=luckysheet_select_save[i];var r1=s.row[0],r2=s.row[1];for(var r=r1;r<=r2;r++){var rowlen=cfg["rowlen"][r]==null?luckysheet.defaultrowlen:cfg["rowlen"][r];if(rowlen!=first_rowlen){isSame=false;break;}}}if(isSame){$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val(first_rowlen);}else {$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val("");}}showrightclickmenu($("#luckysheet-rightclick-menu"),x,y);}}).dblclick(function(event){if(parseInt($("#luckysheet-input-box").css("top"))>0){return;}var mouse=mouseposition(event.pageX,event.pageY);if(mouse[0]>=cellmainWidth-cellMainSrollBarSize||mouse[1]>=cellmainHeight-cellMainSrollBarSize){return;}var scrollLeft=$("#luckysheet-cell-main").scrollLeft(),scrollTop=$("#luckysheet-cell-main").scrollTop();var x=mouse[0]+scrollLeft;var y=mouse[1]+scrollTop;var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];//row_index = luckysheet.freezen.changeFreezenIndex(row_index, "h");
  //col_index = luckysheet.freezen.changeFreezenIndex(col_index, "v");
  if(luckysheet.pivotTable.isPivotRange(row_index,col_index)){//数据透视表没有 任何数据
  if((luckysheet.pivotTable.filter==null||luckysheet.pivotTable.filter.length==0)&&(luckysheet.pivotTable.row==null||luckysheet.pivotTable.row.length==0)&&(luckysheet.pivotTable.column==null||luckysheet.pivotTable.column.length==0)&&(luckysheet.pivotTable.values==null||luckysheet.pivotTable.values.length==0)){return;}//数据透视表没有 数值数据
  if(luckysheet.pivotTable.values==null||luckysheet.pivotTable.values.length==0){return;}//点击位置不是 数值数据 所在区域
  if(row_index==0||col_index==0){return;}if(luckysheet.pivotTable.column!=null&&luckysheet.pivotTable.column.length>0){if(luckysheet.pivotTable.values.length>=2&&luckysheet.pivotTable.showType=="column"){if(row_index<=luckysheet.pivotTable.column.length||col_index>=luckysheet.pivotTable.pivotDatas[0].length-luckysheet.pivotTable.values.length){return;}}else {if(row_index<=luckysheet.pivotTable.column.length-1||col_index>=luckysheet.pivotTable.pivotDatas[0].length-1){return;}}}if(luckysheet.pivotTable.row!=null&&luckysheet.pivotTable.row.length>0){if(luckysheet.pivotTable.values.length>=2&&luckysheet.pivotTable.showType=="row"){if(col_index<=luckysheet.pivotTable.row.length||row_index>=luckysheet.pivotTable.pivotDatas.length-luckysheet.pivotTable.values.length){return;}}else {if(col_index<=luckysheet.pivotTable.row.length-1||row_index>=luckysheet.pivotTable.pivotDatas.length-1){return;}}}luckysheet.sheetmanage.addNewSheet(event);luckysheet.pivotTable.drillDown(row_index,col_index);return;}var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,row_index,col_index);if(!!margeset){row=margeset.row[1];row_pre=margeset.row[0];row_index=margeset.row[2];col=margeset.column[1];col_pre=margeset.column[0];col_index=margeset.column[2];}// $("#luckysheet-cell-selected").hide();
  if($("#luckysheet-search-formula-parm").is(":visible")||$("#luckysheet-search-formula-parm-select").is(":visible")){//公式参数栏显示
  $("#luckysheet-cell-selected").hide();}else if($("#luckysheet-conditionformat-dialog").is(":visible")||$("#luckysheet-administerRule-dialog").is(":visible")||$("#luckysheet-newConditionRule-dialog").is(":visible")||$("#luckysheet-editorConditionRule-dialog").is(":visible")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){//条件格式
  return;}else if($("#luckysheet-modal-dialog-slider-alternateformat").is(":visible")||$("#luckysheet-alternateformat-rangeDialog").is(":visible")){//交替颜色
  return;}else {if(luckysheet.menuButton.luckysheetPaintModelOn){luckysheet.menuButton.cancelPaintModel();}luckysheet.luckysheetupdateCell(row,row_pre,row_index,col,col_pre,col_index,luckysheet.flowdata);}//luckysheetCellUpdate = [row_index, col_index];
  //$("#luckysheet-rich-text-editor").focus().select();
  //$("#luckysheet-input-box").css({ "background-color": "rgb(255, 255, 255)", "padding": "0px 2px", "font-size": "13px", "max-width": winW - col_pre - 20 + scrollLeft, "max-height": winH - row_index - 20 + scrollTop, "min-width": col - col_pre + 1 - 8, "min-height": row - row_pre + 1 - 4, "left": left - 2, "top": top - 2, "right": "auto" }).show();
  //$("#luckysheet-rich-text-editor").text(d[row_index][col_index]);
  //luckysheetRangeLast($("#luckysheet-rich-text-editor")[0]);
  });$("#luckysheet-bottom-add-row, #luckysheet-bottom-add-row-input, #luckysheet-bottom-return-top").on("mousedown dblclick mouseup",function(e){e.stopPropagation();});$("#luckysheet-bottom-add-row").on("click",function(e){$("#luckysheet-rightclick-menu").hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),value=$("#luckysheet-bottom-add-row-input").val();if(value==""){value=100;}if(isNaN(parseInt(value))){if(luckysheet.isEditMode()){alert("请输入数字");}else {luckysheet.tooltip.info("增加错误","请输入数字");}return;}value=parseInt(value);if(value<1||value>100){if(luckysheet.isEditMode()){alert("增加范围限制在1-100");}else {luckysheet.tooltip.info("增加错误","增加范围限制在1-100");}return;}//var st_index = luckysheet_select_save[luckysheetRightHeadClickIs][0];
  luckysheetextendtable("row",luckysheet.flowdata.length-1,value);});$("#luckysheet-bottom-return-top").on("click",function(e){$("#luckysheet-scrollbar-y").scrollTop(0);});var luckysheetactiveCell=function luckysheetactiveCell(){if(!!fullscreenmode){setTimeout(function(){$("#luckysheet-rich-text-editor").focus().select();},50);}};luckysheet.luckysheetactiveCell=luckysheetactiveCell;luckysheet.luckysheetupdateCell=function(row,row_pre,row_index,col,col_pre,col_index,d,cover,isnotfocus){if(luckysheet.isEditMode()){//此模式下禁用单元格编辑
  return;}if($("#luckysheet-dropCell-icon").is(":visible")){$("#luckysheet-dropCell-icon").remove();}var winH=$(window).height(),winW=$(window).width();var container_offset=$("#"+container).offset();var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var scrollTop=$("#luckysheet-cell-main").scrollTop();if(luckysheetConfigsetting.pointEdit){var left=col_pre*luckysheetConfigsetting.pointEditZoom+container_offset.left+rowHeaderWidth*luckysheetConfigsetting.pointEditZoom-scrollLeft,top=row_pre*luckysheetConfigsetting.pointEditZoom+container_offset.top+(infobarHeight+toolbarHeight+calculatebarHeight+columeHeaderHeight)*luckysheetConfigsetting.pointEditZoom-scrollTop;}else {var left=col_pre+container_offset.left+rowHeaderWidth-scrollLeft,top=row_pre+container_offset.top+infobarHeight+toolbarHeight+calculatebarHeight+columeHeaderHeight-scrollTop;}if(luckysheet.pivotTable.isPivotRange(row_index,col_index)){return;}luckysheetCellUpdate=[row_index,col_index];if(!isnotfocus){$("#luckysheet-rich-text-editor").focus().select();}if(luckysheetConfigsetting.pointEdit){$("#luckysheet-input-box").removeAttr("style").css({"background-color":"rgb(255, 255, 255)","padding":"0px 2px","font-size":"13px","max-width":winW+scrollLeft-col_pre-20-rowHeaderWidth,"max-height":winH+scrollTop-row_pre-20-15-toolbarHeight-infobarHeight-calculatebarHeight-sheetBarHeight-statisticBarHeight,"min-width":col-col_pre+1-8,"min-height":row-row_pre+1-4,"left":left-2*luckysheetConfigsetting.pointEditZoom,"top":top-2*luckysheetConfigsetting.pointEditZoom,"right":"auto","overflow-y":"auto","box-sizing":"initial","transform-origin":"0 0","transform":"scale("+luckysheetConfigsetting.pointEditZoom+")","z-index":1000});}else {$("#luckysheet-input-box").removeAttr("style").css({"background-color":"rgb(255, 255, 255)","padding":"0px 2px","font-size":"13px","max-width":winW+scrollLeft-col_pre-20-rowHeaderWidth,"max-height":winH+scrollTop-row_pre-20-15-toolbarHeight-infobarHeight-calculatebarHeight-sheetBarHeight-statisticBarHeight,"min-width":col-col_pre+1-8,"min-height":row-row_pre+1-4,"left":left-2,"top":top-2,"right":"auto","overflow-y":"auto","box-sizing":"initial"});}if(luckysheet.freezen.freezenverticaldata!=null||luckysheet.freezen.freezenhorizontaldata!=null){$("#luckysheet-input-box").css("z-index",10002);}$("#luckysheet-input-box-index").html(luckysheet.luckysheetchatatABC(col_index)+(row_index+1)).hide();$("#luckysheet-wa-functionbox-cancel, #luckysheet-wa-functionbox-confirm").addClass("luckysheet-wa-calculate-active");var value="";if(d[row_index]!=null&&d[row_index][col_index]!=null){var cell=d[row_index][col_index];if(!cover){if(cell.f!=null){value=luckysheet.getcellvalue(row_index,col_index,d,"f");}else {value=luckysheet.mask.valueShowEs(row_index,col_index,d);}}var style=luckysheet.menuButton.getStyleByCell(d,row_index,col_index);style=$("#luckysheet-input-box").get(0).style.cssText+style;$("#luckysheet-input-box").get(0).style.cssText=style;if($("#luckysheet-input-box").get(0).style.backgroundColor=="rgba(0, 0, 0, 0)"){$("#luckysheet-input-box").get(0).style.background="rgb(255,255,255)";}}else {//交替颜色
  var af_compute=luckysheet.alternateformat.getComputeMap();var checksAF=luckysheet.alternateformat.checksAF(row_index,col_index,af_compute);//条件格式
  var cf_compute=luckysheet.conditionformat.getComputeMap();var checksCF=luckysheet.conditionformat.checksCF(row_index,col_index,cf_compute);if(checksCF!=null&&checksCF["cellColor"]!=null){$("#luckysheet-input-box").get(0).style.background=checksCF["cellColor"];}else if(checksAF!=null){$("#luckysheet-input-box").get(0).style.background=checksAF[1];}}if((value==null||value.toString()=="")&&!cover){value="<br/>";}$("#luckysheet-rich-text-editor").html(value);if(!isnotfocus){luckysheetRangeLast($("#luckysheet-rich-text-editor")[0]);}luckysheet.formula.rangetosheet=luckysheet.currentSheetIndex;luckysheet.formula.createRangeHightlight();luckysheet.formula.rangeResizeTo=$("#luckysheet-rich-text-editor");luckysheet.cleargridelement();};$("#luckysheet-input-box").click(function(){luckysheet.formula.rangeHightlightselected($("#luckysheet-rich-text-editor"));}).add("#"+container).on("keydown",function(event){if($("#luckysheet-modal-dialog-mask").is(":visible")||$(event.target).hasClass("luckysheet-mousedown-cancel")||$(event.target).hasClass("formulaInputFocus")){return;}var ctrlKey=event.ctrlKey;var altKey=event.altKey;var shiftKey=event.shiftKey;var kcode=event.keyCode;if($("#luckysheet-modal-dialog-mask").is(":visible")||$(event.target).hasClass("luckysheet-mousedown-cancel")||$(event.target).hasClass("sp-input")||parseInt($("#luckysheet-input-box").css("top"))>0&&$(event.target).closest(".luckysheet-input-box").length>0&&kcode!=keycode.ENTER&&kcode!=keycode.TAB&&kcode!=keycode.UP&&kcode!=keycode.DOWN&&kcode!=keycode.LEFT&&kcode!=keycode.RIGHT){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().is("#luckysheet-helpbox-cell")||anchor.is("#luckysheet-helpbox-cell")){if(kcode==keycode.ENTER){var helpboxValue=$("#luckysheet-helpbox-cell").text();if(luckysheet.formula.iscelldata(helpboxValue)){var cellrange=luckysheet.formula.getcellrange(helpboxValue);luckysheet_select_save=[{"row":cellrange["row"],"column":cellrange["column"],"row_focus":cellrange["row"][0],"column_focus":cellrange["column"][0]}];luckysheet.selectHightlightShow();$("#luckysheet-helpbox-cell").blur();var scrollLeft=$("#luckysheet-cell-main").scrollLeft(),scrollTop=$("#luckysheet-cell-main").scrollTop();var winH=$("#luckysheet-cell-main").height(),winW=$("#luckysheet-cell-main").width();var row=visibledatarow[cellrange["row"][1]],row_pre=cellrange["row"][0]-1==-1?0:visibledatarow[cellrange["row"][0]-1];var col=visibledatacolumn[cellrange["column"][1]],col_pre=cellrange["column"][0]-1==-1?0:visibledatacolumn[cellrange["column"][0]-1];if(col-scrollLeft-winW+20>0){$("#luckysheet-scrollbar-x").scrollLeft(col-winW+20);}else if(col_pre-scrollLeft-20<0){$("#luckysheet-scrollbar-x").scrollLeft(col_pre-20);}if(row-scrollTop-winH+20>0){$("#luckysheet-scrollbar-y").scrollTop(row-winH+20);}else if(row_pre-scrollTop-20<0){$("#luckysheet-scrollbar-y").scrollTop(row_pre-20);}}}}return;}var $inputbox=$("#luckysheet-input-box");if(kcode==keycode.ENTER&&parseInt($inputbox.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")&&luckysheet.formula.searchFunctionCell!=null){luckysheet.formula.searchFunctionEnter($("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active"));}else {luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheet_select_save=[{"row":[luckysheetCellUpdate[0],luckysheetCellUpdate[0]],"column":[luckysheetCellUpdate[1],luckysheetCellUpdate[1]],"row_focus":luckysheetCellUpdate[0],"column_focus":luckysheetCellUpdate[1]}];luckysheetMoveHighlightCell("down",1,"rangeOfSelect");//$("#luckysheet-input-box").blur();
  }//若有参数弹出框，隐藏
  if($("#luckysheet-search-formula-parm").is(":visible")){$("#luckysheet-search-formula-parm").hide();}//若有参数选取范围弹出框，隐藏
  if($("#luckysheet-search-formula-parm-select").is(":visible")){$("#luckysheet-search-formula-parm-select").hide();}event.preventDefault();}else if(kcode==keycode.TAB){if(parseInt($inputbox.css("top"))>0){return;}// luckysheet.formula.updatecell(luckysheetCellUpdate[0], luckysheetCellUpdate[1]);
  luckysheetMoveHighlightCell("right",1,"rangeOfSelect");event.preventDefault();}else if(kcode==keycode.F2){if(parseInt($inputbox.css("top"))>0){return;}var last=luckysheet_select_save[luckysheet_select_save.length-1];var row_index=last["row_focus"],col_index=last["column_focus"];var row=visibledatarow[row_index],row_pre=row_index-1==-1?0:visibledatarow[row_index-1];var col=visibledatacolumn[col_index],col_pre=col_index-1==-1?0:visibledatacolumn[col_index-1];luckysheet.luckysheetupdateCell(row,row_pre,row_index,col,col_pre,col_index,luckysheet.flowdata);event.preventDefault();}else if(kcode==keycode.F4&&parseInt($inputbox.css("top"))>0){luckysheet.formula.setfreezonFuc(event);event.preventDefault();}else if(kcode==keycode.ESC&&parseInt($inputbox.css("top"))>0){luckysheet.formula.dontupdate();luckysheetMoveHighlightCell("down",0,"rangeOfSelect");event.preventDefault();}else if(kcode==keycode.ENTER){if($(event.target).hasClass("formulaInputFocus")||$("#luckysheet-conditionformat-dialog").is(":visible")){return;}else if(String.fromCharCode(kcode)!=null&&$("#luckysheet-cell-selected").is(":visible")){var last=luckysheet_select_save[luckysheet_select_save.length-1];var row_index=last["row_focus"],col_index=last["column_focus"];var row=visibledatarow[row_index],row_pre=row_index-1==-1?0:visibledatarow[row_index-1];var col=visibledatacolumn[col_index],col_pre=col_index-1==-1?0:visibledatacolumn[col_index-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,row_index,col_index);if(!!margeset){row=margeset.row[1];row_pre=margeset.row[0];row_index=margeset.row[2];col=margeset.column[1];col_pre=margeset.column[0];col_index=margeset.column[2];}luckysheet.luckysheetupdateCell(row,row_pre,row_index,col,col_pre,col_index,luckysheet.flowdata);event.preventDefault();}}else {if(ctrlKey||event.metaKey){if(shiftKey){if(!luckysheet_shiftkeydown){luckysheet.luckysheet_shiftpositon=$.extend(true,{},luckysheet_select_save[luckysheet_select_save.length-1]);luckysheet_shiftkeydown=true;}//Ctrl + shift + 方向键  调整选区
  if(kcode==keycode.UP){if(parseInt($inputbox.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightRange2("up","rangeOfSelect");}else if(kcode==keycode.DOWN){if(parseInt($inputbox.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightRange2("down","rangeOfSelect");}else if(kcode==keycode.LEFT){if(parseInt($inputbox.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightRange2("left","rangeOfSelect");}else if(kcode==keycode.RIGHT){if(parseInt($inputbox.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightRange2("right","rangeOfSelect");}}else if(kcode==66){//Ctrl + B  加粗
  $("#luckysheet-icon-bold").click();}else if(kcode==67){//Ctrl + C  复制
  //复制时存在格式刷状态，取消格式刷
  if(luckysheet.menuButton.luckysheetPaintModelOn){luckysheet.menuButton.cancelPaintModel();}if(luckysheet_select_save.length==0){return;}//复制范围内包含部分合并单元格，提示
  if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}}//多重选区 有条件格式时 提示
  var cdformat=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].luckysheet_conditionformat_save;if(luckysheet_select_save.length>1&&cdformat!=null&&cdformat.length>0){var hasCF=false;var cf_compute=luckysheet.conditionformat.getComputeMap();label:for(var s=0;s<luckysheet_select_save.length;s++){if(hasCF){break;}var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];for(var r=r1;r<=r2;r++){for(var c=c1;c<=c2;c++){if(luckysheet.conditionformat.checksCF(r,c,cf_compute)!=null){hasCF=true;continue label;}}}}if(hasCF){if(luckysheet.isEditMode()){alert("无法对多重选择区域执行此操作");}else {luckysheet.tooltip.info("无法对多重选择区域执行此操作","");}return;}}//多重选区 行不一样且列不一样时 提示
  if(luckysheet_select_save.length>1){var isSameRow=true,str_r=luckysheet_select_save[0].row[0],end_r=luckysheet_select_save[0].row[1];var isSameCol=true,str_c=luckysheet_select_save[0].column[0],end_c=luckysheet_select_save[0].column[1];for(var s=1;s<luckysheet_select_save.length;s++){if(luckysheet_select_save[s].row[0]!=str_r||luckysheet_select_save[s].row[1]!=end_r){isSameRow=false;}if(luckysheet_select_save[s].column[0]!=str_c||luckysheet_select_save[s].column[1]!=end_c){isSameCol=false;}}if(!isSameRow&&!isSameCol||luckysheet.selectIsOverlap()){if(luckysheet.isEditMode()){alert("无法对多重选择区域执行此操作");}else {luckysheet.tooltip.info("无法对多重选择区域执行此操作","");}return;}}luckysheet.selection.copy(event);luckysheet_paste_iscut=false;luckysheetactiveCell();event.stopPropagation();return;}else if(kcode==70){//Ctrl + F  查找
  luckysheet.searchReplace.createDialog(0);luckysheet.searchReplace.init();$("#luckysheet-search-replace #searchInput input").focus();}else if(kcode==72){//Ctrl + H  替换
  luckysheet.searchReplace.createDialog(1);luckysheet.searchReplace.init();$("#luckysheet-search-replace #searchInput input").focus();}else if(kcode==73){//Ctrl + I  斜体
  $("#luckysheet-icon-italic").click();}else if(kcode==86){//Ctrl + V  粘贴
  if(luckysheet.isEditMode()){//此模式下禁用粘贴
  return;}if($(event.target).hasClass("formulaInputFocus")){return;}if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("无法在此处粘贴此内容，请选择粘贴区域的一个单元格，然后再次尝试粘贴");}else {luckysheet.tooltip.info("无法在此处粘贴此内容，请选择粘贴区域的一个单元格，然后再次尝试粘贴","");}return;}luckysheet.selection.isPasteAction=true;luckysheetactiveCell();event.stopPropagation();return;}else if(kcode==88){//Ctrl + X  剪切
  //复制时存在格式刷状态，取消格式刷
  if(luckysheet.menuButton.luckysheetPaintModelOn){luckysheet.menuButton.cancelPaintModel();}if(luckysheet_select_save.length==0){return;}//复制范围内包含部分合并单元格，提示
  if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.luckysheetConfigsetting.editMode){alert("无法对合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对合并单元格执行此操作","");}return;}}//多重选区时 提示
  if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选择区域执行此操作，请选择单个区域，然后再试","");}return;}luckysheet.selection.copy(event);luckysheet_paste_iscut=true;luckysheetactiveCell();event.stopPropagation();return;}else if(kcode==90){//Ctrl + Z  撤销
  luckysheet.controlHistory.redo(event);luckysheetactiveCell();event.stopPropagation();return;}else if(kcode==89){//Ctrl + Y  重做
  luckysheet.controlHistory.undo(event);luckysheetactiveCell();event.stopPropagation();return;}else if(kcode==keycode.UP){//Ctrl + up  调整单元格
  if(parseInt($inputbox.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightCell2("up","rangeOfSelect");}else if(kcode==keycode.DOWN){//Ctrl + down  调整单元格
  if(parseInt($inputbox.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightCell2("down","rangeOfSelect");}else if(kcode==keycode.LEFT){//Ctrl + top  调整单元格
  if(parseInt($inputbox.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightCell2("left","rangeOfSelect");}else if(kcode==keycode.RIGHT){//Ctrl + right  调整单元格
  if(parseInt($inputbox.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightCell2("right","rangeOfSelect");}else if(String.fromCharCode(kcode).toLocaleUpperCase()=="A"){//Ctrl + A  全选
  $("#luckysheet-left-top").trigger("mousedown");$(document).trigger("mouseup");}event.preventDefault();return;}else if(shiftKey&&(kcode==keycode.UP||kcode==keycode.DOWN||kcode==keycode.LEFT||kcode==keycode.RIGHT||altKey&&(kcode==53||kcode==101))){if(parseInt($inputbox.css("top"))>0||$(event.target).hasClass("formulaInputFocus")){return;}if(!luckysheet_shiftkeydown){luckysheet.luckysheet_shiftpositon=$.extend(true,{},luckysheet_select_save[luckysheet_select_save.length-1]);luckysheet_shiftkeydown=true;}//shift + 方向键 调整选区
  if(kcode==keycode.UP){if($("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightRange("down",-1,"rangeOfSelect");}else if(kcode==keycode.DOWN){if($("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightRange("down",1,"rangeOfSelect");}else if(kcode==keycode.LEFT){if($("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightRange("right",-1,"rangeOfSelect");}else if(kcode==keycode.RIGHT){if($("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightRange("right",1,"rangeOfSelect");}else if(altKey&&(kcode==53||kcode==101)){//Alt + Shift + 5（删除线）
  $("#luckysheet-icon-strikethrough").click();}event.preventDefault();}else if(kcode==keycode.ESC){if(luckysheet.menuButton.luckysheetPaintModelOn){luckysheet.menuButton.cancelPaintModel();}else {luckysheet.cleargridelement(event);event.preventDefault();}luckysheet.selectHightlightShow();}else if(kcode==keycode.DELETE){if(luckysheet.chartparam.luckysheetCurrentChartActive&&!luckysheet.isEditMode()){luckysheet.chartparam.luckysheetCurrentChartMoveObj.find(".luckysheet-modal-controll-del").click();}else {$("#luckysheet-delete-text").click();}event.preventDefault();}else if(kcode==keycode.UP){if(parseInt($inputbox.css("top"))>0||$(event.target).hasClass("formulaInputFocus")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightCell("down",-1,"rangeOfSelect");event.preventDefault();}else if(kcode==keycode.DOWN){if(parseInt($inputbox.css("top"))>0||$(event.target).hasClass("formulaInputFocus")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightCell("down",1,"rangeOfSelect");event.preventDefault();}else if(kcode==keycode.LEFT){if(parseInt($inputbox.css("top"))>0||$(event.target).hasClass("formulaInputFocus")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightCell("right",-1,"rangeOfSelect");event.preventDefault();}else if(kcode==keycode.RIGHT){if(parseInt($inputbox.css("top"))>0||$(event.target).hasClass("formulaInputFocus")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible")){return;}luckysheetMoveHighlightCell("right",1,"rangeOfSelect");event.preventDefault();}else if(!(kcode>=112&&kcode<=123||kcode<=46||kcode==144||kcode==108||event.ctrlKey||event.altKey||event.shiftKey&&(kcode==37||kcode==38||kcode==39||kcode==40))||kcode==8||kcode==32||kcode==46||kcode==0||event.ctrlKey&&kcode==86){if(String.fromCharCode(kcode)!=null&&$("#luckysheet-cell-selected").is(":visible")&&kcode!=keycode.CAPSLOCK&&kcode!=keycode.WIN&&kcode!=18){var last=luckysheet_select_save[luckysheet_select_save.length-1];var row_index=last["row_focus"],col_index=last["column_focus"];var row=visibledatarow[row_index],row_pre=row_index-1==-1?0:visibledatarow[row_index-1];var col=visibledatacolumn[col_index],col_pre=col_index-1==-1?0:visibledatacolumn[col_index-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,row_index,col_index);if(!!margeset){row=margeset.row[1];row_pre=margeset.row[0];row_index=margeset.row[2];col=margeset.column[1];col_pre=margeset.column[0];col_index=margeset.column[2];}luckysheet.luckysheetupdateCell(row,row_pre,row_index,col,col_pre,col_index,luckysheet.flowdata,true);if(kcode==8){$("#luckysheet-rich-text-editor").html("<br/>");}luckysheet.formula.functionInputHanddler($("#luckysheet-functionbox-cell"),$("#luckysheet-rich-text-editor"),kcode);}}}luckysheetactiveCell();event.stopPropagation();});var luckysheetMoveEndCell=function luckysheetMoveEndCell(postion,type,isScroll,terminal,onlyvalue){if(isScroll==null){isScroll=true;}if(!postion){postion="down";}if(!type){type="cell";}if(onlyvalue==null){onlyvalue=false;}var last=luckysheet_select_save[luckysheet_select_save.length-1];var curR=last["row"]==null?0:last["row"][0];var curC=last["column"]==null?0:last["column"][0];var startR=last["row"]==null?0:last["row"][0];var startC=last["column"]==null?0:last["column"][0];var endR=last["row"]==null?0:last["row"][1];var endC=last["column"]==null?0:last["column"][1];luckysheet.formula.fucntionboxshow(curR,curC);if(type=="range"){var p_startR=luckysheet.luckysheet_shiftpositon["row"][0];var p_startC=luckysheet.luckysheet_shiftpositon["column"][0];var p_endR=luckysheet.luckysheet_shiftpositon["row"][1];var p_endC=luckysheet.luckysheet_shiftpositon["column"][1];if(postion=="down"||postion=="up"){if(p_endR<endR){curR=last["row"]==null?0:last["row"][1];}else if(p_startR>startR){curR=last["row"]==null?0:last["row"][0];}else if(p_endR==endR&&p_startR==startR){if(postion=="down"){curR=last["row"]==null?0:last["row"][1];}else {curR=last["row"]==null?0:last["row"][0];}}//if (endR >= datarowlen) {
  //    endR = datarowlen - 1;
  //}
  //if (endR < 0) {
  //    endR = 0;
  //}
  //if (startR >= datarowlen) {
  //    startR = datarowlen - 1;
  //}
  //if (startR < 0) {
  //    startR = 0;
  //}
  }else if(postion=="right"||postion=="left"){if(p_endC<endC){curC=last["column"]==null?0:last["column"][1];}else if(p_startC>startC){curC=last["column"]==null?0:last["column"][0];}else if(p_endC==endC&&p_startC==startC){if(postion=="right"){curC=last["column"]==null?0:last["column"][1];}else {curC=last["column"]==null?0:last["column"][0];}}//console.log(p_startC, p_endC, startC, endC, curC);
  //if (endC >= datacolumnlen) {
  //    endC = datacolumnlen - 1;
  //}
  //if (endC < 0) {
  //    endC = 0;
  //}
  //if (startC >= datacolumnlen) {
  //    startC = datacolumnlen - 1;
  //}
  //if (startC < 0) {
  //    startC = 0;
  //}
  }}var datarowlen=luckysheet.flowdata.length,datacolumnlen=luckysheet.flowdata[0].length;var data=luckysheet.flowdata,moveP="",moveV=0;if(postion=="up"){if(curR==0){return;}else {var stvalue=[],p=null,i=0,p_pre=null;for(var c=startC;c<=endC;c++){stvalue=[];i=0;for(var r=curR-1;r>=0;r--){var cell=data[r][c];if(luckysheet.getObjType(cell)=="object"&&luckysheet.func_methods.isRealNull(cell.v)){stvalue.push(false);}else if(luckysheet.func_methods.isRealNull(cell)){stvalue.push(false);}else {stvalue.push(true);}if(stvalue.length>1){if(stvalue[i]==true&&stvalue[i-1]==false){p=r;break;}else if(stvalue[i]==false&&stvalue[i-1]==true){p=r+1;break;}}i++;}if(p==null){p=0;}if(p_pre==null||p<p_pre){p_pre=p;}}moveP="down";moveV=p_pre-curR;}}else if(postion=="down"){if(curR==datarowlen-1){return;}else {var stvalue=[],p=null,i=0,p_pre=null;for(var c=startC;c<=endC;c++){stvalue=[];i=0;for(var r=curR+1;r<data.length;r++){var cell=data[r][c];if(luckysheet.getObjType(cell)=="object"&&luckysheet.func_methods.isRealNull(cell.v)){stvalue.push(false);}else if(luckysheet.func_methods.isRealNull(cell)){stvalue.push(false);}else {stvalue.push(true);}if(stvalue.length>1){if(stvalue[i]==true&&stvalue[i-1]==false){p=r;break;}else if(stvalue[i]==false&&stvalue[i-1]==true){p=r-1;break;}}i++;}if(p==null){p=data.length-1;}if(p_pre==null||p>p_pre){p_pre=p;}}moveP="down";moveV=p_pre-curR;}}else if(postion=="left"){if(curC==0){return;}else {var stvalue=[],p=null,i=0,p_pre=null;for(var r=startR;r<=endR;r++){stvalue=[];i=0;for(var c=curC-1;c>=0;c--){var cell=data[r][c];if(luckysheet.getObjType(cell)=="object"&&luckysheet.func_methods.isRealNull(cell.v)){stvalue.push(false);}else if(luckysheet.func_methods.isRealNull(cell)){stvalue.push(false);}else {stvalue.push(true);}if(stvalue.length>1){if(stvalue[i]==true&&stvalue[i-1]==false){p=c;break;}else if(stvalue[i]==false&&stvalue[i-1]==true){p=c+1;break;}}i++;}if(p==null){p=0;}if(p_pre==null||p<p_pre){p_pre=p;}}moveP="right";moveV=p_pre-curC;}}else if(postion=="right"){if(curC==datacolumnlen-1){return;}else {var stvalue=[],p=null,i=0,p_pre=null;for(var r=startR;r<=endR;r++){stvalue=[];i=0;for(var c=curC+1;c<data[0].length;c++){var cell=data[r][c];if(luckysheet.getObjType(cell)=="object"&&luckysheet.func_methods.isRealNull(cell.v)){stvalue.push(false);}else if(luckysheet.func_methods.isRealNull(cell)){stvalue.push(false);}else {stvalue.push(true);}if(stvalue.length>1){if(stvalue[i]==true&&stvalue[i-1]==false){p=c;break;}else if(stvalue[i]==false&&stvalue[i-1]==true){p=c-1;break;}}i++;}if(p==null){p=data[0].length-1;}if(p_pre==null||p>p_pre){p_pre=p;}}moveP="right";moveV=p_pre-curC;}}//console.log("up", moveV, curR, p_endR, moveV + curR < p_endR);
  //console.log("down", moveV, curR, p_startR, moveV + curR > p_startR);
  //console.log("left", moveV, curC, p_endC, moveV + curC < p_endC);
  //console.log("right", moveV, curC, p_startC, moveV + curC > p_startC);
  if(type=="range"){if(postion=="up"){if(p_endR<endR){if(moveV+curR<p_endR){moveV=p_endR-curR;}}}else if(postion=="down"){if(p_startR>startR){if(moveV+curR>p_startR){moveV=p_startR-curR;}}}else if(postion=="left"){if(p_endC<endC){if(moveV+curC<p_endC){moveV=p_endC-curC;}}//else if (p_startC > startC) {
  //}
  //else if (p_endC == endC && p_startC == startC) {
  //    if (postion == "right") {
  //    }
  //    else {
  //    }
  //}
  //if (curC != p_endC && moveV + curC > p_endC) {
  //    moveV = curC - p_endC;
  //}
  }else if(postion=="right"){if(p_startC>startC){if(moveV+curC>p_startC){moveV=p_startC-curC;}}}if(terminal!=null&&Math.abs(moveV)>Math.abs(terminal)){moveV=terminal;}}if(!onlyvalue){if(type=="cell"){luckysheetMoveHighlightCell(moveP,moveV,"rangeOfSelect",isScroll);}else if(type=="range"){luckysheetMoveHighlightRange(moveP,moveV,"rangeOfSelect",isScroll);}}else {return moveV;}};luckysheet.luckysheetMoveEndCell=luckysheetMoveEndCell;//方向键  调整单元格
  var luckysheetMoveHighlightCell=function luckysheetMoveHighlightCell(postion,index,type,isScroll){if(isScroll==null){isScroll=true;}var datarowlen=luckysheet.flowdata.length,datacolumnlen=luckysheet.flowdata[0].length;if(type=="rangeOfSelect"){var last=luckysheet_select_save[luckysheet_select_save.length-1];if(last["row_focus"]==null){var curR=last["row"][0];}else {var curR=last["row_focus"];}if(last["column_focus"]==null){var curC=last["column"][0];}else {var curC=last["column_focus"];}//focus单元格 是否是合并单元格
  var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,curR,curC);if(!!margeset){var str_r=margeset.row[2];var end_r=margeset.row[3];var str_c=margeset.column[2];var end_c=margeset.column[3];if(index>0){if(postion=="down"){curR=end_r;curC=str_c;}else if(postion=="right"){curR=str_r;curC=end_c;}}else {curR=str_r;curC=str_c;}}var moveX=last["moveXY"]==null?curR:last["moveXY"].x;var moveY=last["moveXY"]==null?curC:last["moveXY"].y;if(postion=="down"){curR+=index;moveX=curR;}else if(postion=="right"){curC+=index;moveY=curC;}if(curR>=datarowlen){curR=datarowlen-1;moveX=curR;}if(curR<0){curR=0;moveX=curR;}if(curC>=datacolumnlen){curC=datacolumnlen-1;moveY=curC;}if(curC<0){curC=0;moveY=curC;}//移动的下一个单元格是否是合并的单元格
  var margeset2=luckysheet.menuButton.mergeborer(luckysheet.flowdata,curR,curC);if(!!margeset2){var row=margeset2.row[1];var row_pre=margeset2.row[0];var row_index=margeset2.row[2];var row_index_ed=margeset2.row[3];var col=margeset2.column[1];var col_pre=margeset2.column[0];var col_index=margeset2.column[2];var col_index_ed=margeset2.column[3];}else {var row=visibledatarow[moveX],row_pre=moveX-1==-1?0:visibledatarow[moveX-1];var col=visibledatacolumn[moveY],col_pre=moveY-1==-1?0:visibledatacolumn[moveY-1];var row_index=moveX;var row_index_ed=moveX;var col_index=moveY;var col_index_ed=moveY;}last["row"]=[row_index,row_index_ed];last["column"]=[col_index,col_index_ed];last["row_focus"]=row_index;last["column_focus"]=col_index;last["moveXY"]={"x":moveX,"y":moveY};luckysheet.selectHightlightShow();luckysheet.pivotTable.pivotclick(row_index,col_index);luckysheet.formula.fucntionboxshow(row_index,col_index);//图表
  if(luckysheet.chartparam.luckysheet_chart_data_select_state){$("#luckysheet-datavisual-range-selection-input").val(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].name+"!"+luckysheet.luckysheetchatatABC(last["column"][0])+(last["row"][0]+1)+":"+luckysheet.luckysheetchatatABC(last["column"][1])+(last["row"][1]+1));}}else if(type=="rangeOfFormula"){var last=luckysheet.formula.func_selectedrange;if(last["row_focus"]==null){var curR=last["row"][0];}else {var curR=last["row_focus"];}if(last["column_focus"]==null){var curC=last["column"][0];}else {var curC=last["column_focus"];}//focus单元格 是否是合并单元格
  var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,curR,curC);if(!!margeset){var str_r=margeset.row[2];var end_r=margeset.row[3];var str_c=margeset.column[2];var end_c=margeset.column[3];if(index>0){if(postion=="down"){curR=end_r;curC=str_c;}else if(postion=="right"){curR=str_r;curC=end_c;}}else {curR=str_r;curC=str_c;}}var moveX=last["moveXY"]==null?curR:last["moveXY"].x;var moveY=last["moveXY"]==null?curC:last["moveXY"].y;if(postion=="down"){curR+=index;moveX=curR;}else if(postion=="right"){curC+=index;moveY=curC;}if(curR>=datarowlen){curR=datarowlen-1;moveX=curR;}if(curR<0){curR=0;moveX=curR;}if(curC>=datacolumnlen){curC=datacolumnlen-1;moveY=curC;}if(curC<0){curC=0;moveY=curC;}//移动的下一个单元格是否是合并的单元格
  var margeset2=luckysheet.menuButton.mergeborer(luckysheet.flowdata,curR,curC);if(!!margeset2){var row=margeset2.row[1];var row_pre=margeset2.row[0];var row_index=margeset2.row[2];var row_index_ed=margeset2.row[3];var col=margeset2.column[1];var col_pre=margeset2.column[0];var col_index=margeset2.column[2];var col_index_ed=margeset2.column[3];}else {var row=visibledatarow[moveX],row_pre=moveX-1==-1?0:visibledatarow[moveX-1];var col=visibledatacolumn[moveY],col_pre=moveY-1==-1?0:visibledatacolumn[moveY-1];var row_index=moveX;var row_index_ed=moveX;var col_index=moveY;var col_index_ed=moveY;}luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[row_index,row_index_ed],"column":[col_index,col_index_ed],"row_focus":row_index,"column_focus":col_index,"moveXY":{"x":moveX,"y":moveY}};$("#luckysheet-formula-functionrange-select").css({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1}).show();luckysheet.formula.rangeSetValue({"row":[row_index,row_index_ed],"column":[col_index,col_index_ed]});}//var winW = $(window).width(), winH = $(window).height();
  var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var scrollTop=$("#luckysheet-cell-main").scrollTop();var winH=$("#luckysheet-cell-main").height(),winW=$("#luckysheet-cell-main").width();var sleft=0,stop=0;if(col-scrollLeft-winW+20>0){sleft=col-winW+20;if(isScroll){$("#luckysheet-scrollbar-x").scrollLeft(sleft);}}else if(col_pre-scrollLeft-20<0){sleft=col_pre-20;if(isScroll){$("#luckysheet-scrollbar-x").scrollLeft(sleft);}}if(row-scrollTop-winH+20>0){stop=row-winH+20;if(isScroll){$("#luckysheet-scrollbar-y").scrollTop(stop);}}else if(row_pre-scrollTop-20<0){stop=row_pre-20;if(isScroll){$("#luckysheet-scrollbar-y").scrollTop(stop);}}clearTimeout(jfcountfuncTimeout);jfcountfunc();};//ctrl + 方向键  调整单元格
  var luckysheetMoveHighlightCell2=function luckysheetMoveHighlightCell2(postion,type,isScroll){if(!isScroll){isScroll=true;}if(type=="rangeOfSelect"){var last=luckysheet_select_save[luckysheet_select_save.length-1];var rf=last["row_focus"],cf=last["column_focus"];if(config["merge"]!=null&&rf+"_"+cf in config["merge"]){var focusIsMerge=true;var mc=config["merge"][rf+"_"+cf];}else {var focusIsMerge=false;}if(postion=="down"){if(rf==luckysheet.flowdata.length-1){return;}if(focusIsMerge){rf=luckysheet.getNextIndex("down",cf,mc.r+mc.rs-1,luckysheet.flowdata.length-1);}else {rf=luckysheet.getNextIndex("down",cf,rf,luckysheet.flowdata.length-1);}}else if(postion=="up"){if(rf==0){return;}if(focusIsMerge){rf=luckysheet.getNextIndex("up",cf,0,mc.r);}else {rf=luckysheet.getNextIndex("up",cf,0,rf);}}else if(postion=="right"){if(cf==luckysheet.flowdata[0].length-1){return;}if(focusIsMerge){cf=luckysheet.getNextIndex("right",rf,mc.c+mc.cs-1,luckysheet.flowdata[0].length-1);}else {cf=luckysheet.getNextIndex("right",rf,cf,luckysheet.flowdata[0].length-1);}}else if(postion=="left"){if(cf==0){return;}if(focusIsMerge){cf=luckysheet.getNextIndex("left",rf,0,mc.c);}else {cf=luckysheet.getNextIndex("left",rf,0,cf);}}var rowseleted=[rf,rf];var columnseleted=[cf,cf];var row=visibledatarow[rf],row_pre=rf-1==-1?0:visibledatarow[rf-1];var col=visibledatacolumn[cf],col_pre=cf-1==-1?0:visibledatacolumn[cf-1];var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,rowseleted,last,row_pre,row-row_pre-1,col_pre,col-col_pre-1);if(changeparam!=null){columnseleted=changeparam[0];rowseleted=changeparam[1];// top = changeparam[2];
  // height = changeparam[3];
  // left = changeparam[4];
  // width = changeparam[5];
  }luckysheet_select_save=[{"row":rowseleted,"column":columnseleted}];luckysheet.selectHightlightShow();luckysheet.pivotTable.pivotclick(rf,cf);luckysheet.formula.fucntionboxshow(rf,cf);//图表
  if(luckysheet.chartparam.luckysheet_chart_data_select_state){$("#luckysheet-datavisual-range-selection-input").val(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].name+"!"+luckysheet.luckysheetchatatABC(columnseleted[0])+(rowseleted[0]+1)+":"+luckysheet.luckysheetchatatABC(columnseleted[1])+(rowseleted[1]+1));}}else if(type=="rangeOfFormula"){var last=luckysheet.formula.func_selectedrange;var rf=last["row_focus"],cf=last["column_focus"];if(config["merge"]!=null&&rf+"_"+cf in config["merge"]){var focusIsMerge=true;var mc=config["merge"][rf+"_"+cf];}else {var focusIsMerge=false;}if(postion=="down"){if(rf==luckysheet.flowdata.length-1){return;}if(focusIsMerge){rf=luckysheet.getNextIndex("down",cf,mc.r+mc.rs-1,luckysheet.flowdata.length-1);}else {rf=luckysheet.getNextIndex("down",cf,rf,luckysheet.flowdata.length-1);}}else if(postion=="up"){if(rf==0){return;}if(focusIsMerge){rf=luckysheet.getNextIndex("up",cf,0,mc.r);}else {rf=luckysheet.getNextIndex("up",cf,0,rf);}}else if(postion=="right"){if(cf==luckysheet.flowdata[0].length-1){return;}if(focusIsMerge){cf=luckysheet.getNextIndex("right",rf,mc.c+mc.cs-1,luckysheet.flowdata[0].length-1);}else {cf=luckysheet.getNextIndex("right",rf,cf,luckysheet.flowdata[0].length-1);}}else if(postion=="left"){if(cf==0){return;}if(focusIsMerge){cf=luckysheet.getNextIndex("left",rf,0,mc.c);}else {cf=luckysheet.getNextIndex("left",rf,0,cf);}}var rowseleted=[rf,rf];var columnseleted=[cf,cf];var row=visibledatarow[rf],row_pre=rf-1==-1?0:visibledatarow[rf-1];var col=visibledatacolumn[cf],col_pre=cf-1==-1?0:visibledatacolumn[cf-1];var top=row_pre,height=row-row_pre-1;var left=col_pre,width=col-col_pre-1;var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,rowseleted,last,top,height,left,width);if(changeparam!=null){columnseleted=changeparam[0];rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];left=changeparam[4];width=changeparam[5];}luckysheet.formula.func_selectedrange={"left":left,"width":width,"top":top,"height":height,"left_move":left,"width_move":width,"top_move":top,"height_move":height,"row":rowseleted,"column":columnseleted,"row_focus":rf,"column_focus":cf};$("#luckysheet-formula-functionrange-select").css({"left":left,"width":width,"top":top,"height":height}).show();luckysheet.formula.rangeSetValue({"row":rowseleted,"column":columnseleted});}var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var scrollTop=$("#luckysheet-cell-main").scrollTop();var winH=$("#luckysheet-cell-main").height(),winW=$("#luckysheet-cell-main").width();var sleft=0,stop=0;if(col-scrollLeft-winW+20>0){sleft=col-winW+20;if(isScroll){$("#luckysheet-scrollbar-x").scrollLeft(sleft);}}else if(col_pre-scrollLeft-20<0){sleft=col_pre-20;if(isScroll){$("#luckysheet-scrollbar-x").scrollLeft(sleft);}}if(row-scrollTop-winH+20>0){stop=row-winH+20;if(isScroll){$("#luckysheet-scrollbar-y").scrollTop(stop);}}else if(row_pre-scrollTop-20<0){stop=row_pre-20;if(isScroll){$("#luckysheet-scrollbar-y").scrollTop(stop);}}clearTimeout(jfcountfuncTimeout);jfcountfunc();};//shift + 方向键  调整选区
  var luckysheetMoveHighlightRange=function luckysheetMoveHighlightRange(postion,index,type,isScroll){if(isScroll==null){isScroll=true;}if(type=="rangeOfSelect"){var last=luckysheet_select_save[luckysheet_select_save.length-1];var curR=last["row"][0],endR=last["row"][1];var curC=last["column"][0],endC=last["column"][1];var rf=last["row_focus"],cf=last["column_focus"];var datarowlen=luckysheet.flowdata.length,datacolumnlen=luckysheet.flowdata[0].length;if(postion=="down"){//选区上下变动
  if(luckysheet.rowHasMerge(rf,curC,endC)){//focus单元格所在行有合并单元格
  var rfMerge=luckysheet.getRowMerge(rf,curC,endC);var rf_str=rfMerge[0],rf_end=rfMerge[1];if(rf_str>curR&&rf_end==endR){if(index>0&&luckysheet.rowHasMerge(curR,curC,endC)){curR=luckysheet.getRowMerge(curR,curC,endC)[1];}curR+=index;}else if(rf_end<endR&&rf_str==curR){if(index<0&&luckysheet.rowHasMerge(endR,curC,endC)){endR=luckysheet.getRowMerge(endR,curC,endC)[0];}endR+=index;}else {if(index>0){endR+=index;}else {curR+=index;}}}else {if(rf>curR&&rf==endR){if(index>0&&luckysheet.rowHasMerge(curR,curC,endC)){curR=luckysheet.getRowMerge(curR,curC,endC)[1];}curR+=index;}else if(rf<endR&&rf==curR){if(index<0&&luckysheet.rowHasMerge(endR,curC,endC)){endR=luckysheet.getRowMerge(endR,curC,endC)[0];}endR+=index;}else if(rf==curR&&rf==endR){if(index>0){endR+=index;}else {curR+=index;}}}if(endR>=datarowlen){endR=datarowlen-1;}if(endR<0){endR=0;}if(curR>=datarowlen){curR=datarowlen-1;}if(curR<0){curR=0;}}else {if(luckysheet.colHasMerge(cf,curR,endR)){//focus单元格所在列有合并单元格
  var cfMerge=luckysheet.getColMerge(cf,curR,endR);var cf_str=cfMerge[0],cf_end=cfMerge[1];if(cf_str>curC&&cf_end==endC){if(index>0&&luckysheet.colHasMerge(curC,curR,endR)){curC=luckysheet.getColMerge(curC,curR,endR)[1];}curC+=index;}else if(cf_end<endC&&cf_str==curC){if(index<0&&luckysheet.colHasMerge(endC,curR,endR)){endC=luckysheet.getColMerge(endC,curR,endR)[0];}endC+=index;}else {if(index>0){endC+=index;}else {curC+=index;}}}else {if(cf>curC&&cf==endC){if(index>0&&luckysheet.colHasMerge(curC,curR,endR)){curC=luckysheet.getColMerge(curC,curR,endR)[1];}curC+=index;}else if(cf<endC&&cf==curC){if(index<0&&luckysheet.colHasMerge(endC,curR,endR)){endC=luckysheet.getColMerge(endC,curR,endR)[0];}endC+=index;}else if(cf==curC&&cf==endC){if(index>0){endC+=index;}else {curC+=index;}}}if(endC>=datacolumnlen){endC=datacolumnlen-1;}if(endC<0){endC=0;}if(curC>=datacolumnlen){curC=datacolumnlen-1;}if(curC<0){curC=0;}}var rowseleted=[curR,endR];var columnseleted=[curC,endC];var row=visibledatarow[endR],row_pre=curR-1==-1?0:visibledatarow[curR-1];var col=visibledatacolumn[endC],col_pre=curC-1==-1?0:visibledatacolumn[curC-1];var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,rowseleted,last,row_pre,row-row_pre-1,col_pre,col-col_pre-1);if(changeparam!=null){columnseleted=changeparam[0];rowseleted=changeparam[1];// top = changeparam[2];
  // height = changeparam[3];
  // left = changeparam[4];
  // width = changeparam[5];
  }last["row"]=rowseleted;last["column"]=columnseleted;luckysheet.selectHightlightShow();//图表
  if(luckysheet.chartparam.luckysheet_chart_data_select_state){$("#luckysheet-datavisual-range-selection-input").val(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].name+"!"+luckysheet.luckysheetchatatABC(last["column"][0])+(last["row"][0]+1)+":"+luckysheet.luckysheetchatatABC(last["column"][1])+(last["row"][1]+1));}}else if(type=="rangeOfFormula"){var last=luckysheet.formula.func_selectedrange;var curR=last["row"][0],endR=last["row"][1];var curC=last["column"][0],endC=last["column"][1];var rf=last["row_focus"],cf=last["column_focus"];var datarowlen=luckysheet.flowdata.length,datacolumnlen=luckysheet.flowdata[0].length;if(postion=="down"){//选区上下变动
  if(luckysheet.rowHasMerge(rf,curC,endC)){//focus单元格所在行有合并单元格
  var rfMerge=luckysheet.getRowMerge(rf,curC,endC);var rf_str=rfMerge[0],rf_end=rfMerge[1];if(rf_str>curR&&rf_end==endR){if(index>0&&luckysheet.rowHasMerge(curR,curC,endC)){curR=luckysheet.getRowMerge(curR,curC,endC)[1];}curR+=index;}else if(rf_end<endR&&rf_str==curR){if(index<0&&luckysheet.rowHasMerge(endR,curC,endC)){endR=luckysheet.getRowMerge(endR,curC,endC)[0];}endR+=index;}else {if(index>0){endR+=index;}else {curR+=index;}}}else {if(rf>curR&&rf==endR){if(index>0&&luckysheet.rowHasMerge(curR,curC,endC)){curR=luckysheet.getRowMerge(curR,curC,endC)[1];}curR+=index;}else if(rf<endR&&rf==curR){if(index<0&&luckysheet.rowHasMerge(endR,curC,endC)){endR=luckysheet.getRowMerge(endR,curC,endC)[0];}endR+=index;}else if(rf==curR&&rf==endR){if(index>0){endR+=index;}else {curR+=index;}}}if(endR>=datarowlen){endR=datarowlen-1;}if(endR<0){endR=0;}if(curR>=datarowlen){curR=datarowlen-1;}if(curR<0){curR=0;}}else {if(luckysheet.colHasMerge(cf,curR,endR)){//focus单元格所在列有合并单元格
  var cfMerge=luckysheet.getColMerge(cf,curR,endR);var cf_str=cfMerge[0],cf_end=cfMerge[1];if(cf_str>curC&&cf_end==endC){if(index>0&&luckysheet.colHasMerge(curC,curR,endR)){curC=luckysheet.getColMerge(curC,curR,endR)[1];}curC+=index;}else if(cf_end<endC&&cf_str==curC){if(index<0&&luckysheet.colHasMerge(endC,curR,endR)){endC=luckysheet.getColMerge(endC,curR,endR)[0];}endC+=index;}else {if(index>0){endC+=index;}else {curC+=index;}}}else {if(cf>curC&&cf==endC){if(index>0&&luckysheet.colHasMerge(curC,curR,endR)){curC=luckysheet.getColMerge(curC,curR,endR)[1];}curC+=index;}else if(cf<endC&&cf==curC){if(index<0&&luckysheet.colHasMerge(endC,curR,endR)){endC=luckysheet.getColMerge(endC,curR,endR)[0];}endC+=index;}else if(cf==curC&&cf==endC){if(index>0){endC+=index;}else {curC+=index;}}}if(endC>=datacolumnlen){endC=datacolumnlen-1;}if(endC<0){endC=0;}if(curC>=datacolumnlen){curC=datacolumnlen-1;}if(curC<0){curC=0;}}var rowseleted=[curR,endR];var columnseleted=[curC,endC];var row=visibledatarow[endR],row_pre=curR-1==-1?0:visibledatarow[curR-1];var col=visibledatacolumn[endC],col_pre=curC-1==-1?0:visibledatacolumn[curC-1];var top=row_pre,height=row-row_pre-1;var left=col_pre,width=col-col_pre-1;var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,rowseleted,last,top,height,left,width);if(changeparam!=null){columnseleted=changeparam[0];rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];left=changeparam[4];width=changeparam[5];}luckysheet.formula.func_selectedrange={"left":left,"width":width,"top":top,"height":height,"left_move":left,"width_move":width,"top_move":top,"height_move":height,"row":rowseleted,"column":columnseleted,"row_focus":rf,"column_focus":cf};$("#luckysheet-formula-functionrange-select").css({"left":left,"width":width,"top":top,"height":height}).show();luckysheet.formula.rangeSetValue({"row":rowseleted,"column":columnseleted});}//var winW = $(window).width(), winH = $(window).height();
  var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var scrollTop=$("#luckysheet-cell-main").scrollTop();var winH=$("#luckysheet-cell-main").height(),winW=$("#luckysheet-cell-main").width();var sleft=0,stop=0;if(col-scrollLeft-winW+20>0){sleft=col-winW+20;if(isScroll){$("#luckysheet-scrollbar-x").scrollLeft(sleft);}}else if(col_pre-scrollLeft-20<0){sleft=col_pre-20;if(isScroll){$("#luckysheet-scrollbar-x").scrollLeft(sleft);}}if(row-scrollTop-winH+20>0){stop=row-winH+20;if(isScroll){$("#luckysheet-scrollbar-y").scrollTop(stop);}}else if(row_pre-scrollTop-20<0){stop=row_pre-20;if(isScroll){$("#luckysheet-scrollbar-y").scrollTop(stop);}}clearTimeout(jfcountfuncTimeout);jfcountfunc();};//ctrl + shift + 方向键  调整选区
  var luckysheetMoveHighlightRange2=function luckysheetMoveHighlightRange2(postion,type,isScroll){if(!isScroll){isScroll=true;}if(type=="rangeOfSelect"){var last=luckysheet_select_save[luckysheet_select_save.length-1];var rf=last["row_focus"],cf=last["column_focus"];var r1=last["row"][0],r2=last["row"][1];var c1=last["column"][0],c2=last["column"][1];if(postion=="down"){if(r2==luckysheet.flowdata.length-1){return;}if(luckysheet.rowHasMerge(rf,c1,c2)){//focus所在行有合并单元格
  var rfMerge=luckysheet.getRowMerge(rf,c1,c2);var rf_str=rfMerge[0],rf_end=rfMerge[1];if(rf_str>r1&&rf_end==r2){r1=luckysheet.getNextIndex("down",cf,r1,r2);}else {r2=luckysheet.getNextIndex("down",cf,r2,luckysheet.flowdata.length-1);}}else {if(rf>r1&&rf==r2){r1=luckysheet.getNextIndex("down",cf,r1,r2);}else {r2=luckysheet.getNextIndex("down",cf,r2,luckysheet.flowdata.length-1);}}}else if(postion=="up"){if(r1==0){return;}if(luckysheet.rowHasMerge(rf,c1,c2)){//focus所在行有合并单元格
  var rfMerge=luckysheet.getRowMerge(rf,c1,c2);var rf_str=rfMerge[0],rf_end=rfMerge[1];if(rf_end<r2&&rf_str==r1){r2=luckysheet.getNextIndex("up",cf,r1,r2);}else {r1=luckysheet.getNextIndex("up",cf,0,r1);}}else {if(rf<r2&&rf==r1){r2=luckysheet.getNextIndex("up",cf,r1,r2);}else {r1=luckysheet.getNextIndex("up",cf,0,r1);}}}else if(postion=="right"){if(c2==luckysheet.flowdata[0].length-1){return;}if(luckysheet.colHasMerge(cf,r1,r2)){//focus所在行有合并单元格
  var cfMerge=luckysheet.getColMerge(cf,r1,r2);var cf_str=cfMerge[0],cf_end=cfMerge[1];if(cf_str>c1&&cf_end==c2){c1=luckysheet.getNextIndex("right",rf,c1,c2);}else {c2=luckysheet.getNextIndex("right",rf,c2,luckysheet.flowdata[0].length-1);}}else {if(cf>c1&&cf==c2){c1=luckysheet.getNextIndex("right",rf,c1,c2);}else {c2=luckysheet.getNextIndex("right",rf,c2,luckysheet.flowdata[0].length-1);}}}else if(postion=="left"){if(c1==0){return;}if(luckysheet.colHasMerge(cf,r1,r2)){//focus所在行有合并单元格
  var cfMerge=luckysheet.getColMerge(cf,r1,r2);var cf_str=cfMerge[0],cf_end=cfMerge[1];if(cf_end<c2&&cf_str==c1){c2=luckysheet.getNextIndex("left",rf,c1,c2);}else {c1=luckysheet.getNextIndex("left",rf,0,c1);}}else {if(cf<c2&&cf==c1){c2=luckysheet.getNextIndex("left",rf,c1,c2);}else {c1=luckysheet.getNextIndex("left",rf,0,c1);}}}var rowseleted=[r1,r2];var columnseleted=[c1,c2];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,rowseleted,last,row_pre,row-row_pre-1,col_pre,col-col_pre-1);if(changeparam!=null){columnseleted=changeparam[0];rowseleted=changeparam[1];// top = changeparam[2];
  // height = changeparam[3];
  // left = changeparam[4];
  // width = changeparam[5];
  }last["row"]=rowseleted;last["column"]=columnseleted;luckysheet.selectHightlightShow();//图表
  if(luckysheet.chartparam.luckysheet_chart_data_select_state){$("#luckysheet-datavisual-range-selection-input").val(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].name+"!"+luckysheet.luckysheetchatatABC(last["column"][0])+(last["row"][0]+1)+":"+luckysheet.luckysheetchatatABC(last["column"][1])+(last["row"][1]+1));}}else if(type=="rangeOfFormula"){var last=luckysheet.formula.func_selectedrange;var rf=last["row_focus"],cf=last["column_focus"];var r1=last["row"][0],r2=last["row"][1];var c1=last["column"][0],c2=last["column"][1];if(postion=="down"){if(r2==luckysheet.flowdata.length-1){return;}if(luckysheet.rowHasMerge(rf,c1,c2)){//focus所在行有合并单元格
  var rfMerge=luckysheet.getRowMerge(rf,c1,c2);var rf_str=rfMerge[0],rf_end=rfMerge[1];if(rf_str>r1&&rf_end==r2){r1=luckysheet.getNextIndex("down",cf,r1,r2);}else {r2=luckysheet.getNextIndex("down",cf,r2,luckysheet.flowdata.length-1);}}else {if(rf>r1&&rf==r2){r1=luckysheet.getNextIndex("down",cf,r1,r2);}else {r2=luckysheet.getNextIndex("down",cf,r2,luckysheet.flowdata.length-1);}}}else if(postion=="up"){if(r1==0){return;}if(luckysheet.rowHasMerge(rf,c1,c2)){//focus所在行有合并单元格
  var rfMerge=luckysheet.getRowMerge(rf,c1,c2);var rf_str=rfMerge[0],rf_end=rfMerge[1];if(rf_end<r2&&rf_str==r1){r2=luckysheet.getNextIndex("up",cf,r1,r2);}else {r1=luckysheet.getNextIndex("up",cf,0,r1);}}else {if(rf<r2&&rf==r1){r2=luckysheet.getNextIndex("up",cf,r1,r2);}else {r1=luckysheet.getNextIndex("up",cf,0,r1);}}}else if(postion=="right"){if(c2==luckysheet.flowdata[0].length-1){return;}if(luckysheet.colHasMerge(cf,r1,r2)){//focus所在行有合并单元格
  var cfMerge=luckysheet.getColMerge(cf,r1,r2);var cf_str=cfMerge[0],cf_end=cfMerge[1];if(cf_str>c1&&cf_end==c2){c1=luckysheet.getNextIndex("right",rf,c1,c2);}else {c2=luckysheet.getNextIndex("right",rf,c2,luckysheet.flowdata[0].length-1);}}else {if(cf>c1&&cf==c2){c1=luckysheet.getNextIndex("right",rf,c1,c2);}else {c2=luckysheet.getNextIndex("right",rf,c2,luckysheet.flowdata[0].length-1);}}}else if(postion=="left"){if(c1==0){return;}if(luckysheet.colHasMerge(cf,r1,r2)){//focus所在行有合并单元格
  var cfMerge=luckysheet.getColMerge(cf,r1,r2);var cf_str=cfMerge[0],cf_end=cfMerge[1];if(cf_end<c2&&cf_str==c1){c2=luckysheet.getNextIndex("left",rf,c1,c2);}else {c1=luckysheet.getNextIndex("left",rf,0,c1);}}else {if(cf<c2&&cf==c1){c2=luckysheet.getNextIndex("left",rf,c1,c2);}else {c1=luckysheet.getNextIndex("left",rf,0,c1);}}}var rowseleted=[r1,r2];var columnseleted=[c1,c2];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];var top=row_pre,height=row-row_pre-1;var left=col_pre,width=col-col_pre-1;var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,rowseleted,last,top,height,left,width);if(changeparam!=null){columnseleted=changeparam[0];rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];left=changeparam[4];width=changeparam[5];}luckysheet.formula.func_selectedrange={"left":left,"width":width,"top":top,"height":height,"left_move":left,"width_move":width,"top_move":top,"height_move":height,"row":rowseleted,"column":columnseleted,"row_focus":rf,"column_focus":cf};$("#luckysheet-formula-functionrange-select").css({"left":left,"width":width,"top":top,"height":height}).show();luckysheet.formula.rangeSetValue({"row":rowseleted,"column":columnseleted});}var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var scrollTop=$("#luckysheet-cell-main").scrollTop();var winH=$("#luckysheet-cell-main").height(),winW=$("#luckysheet-cell-main").width();var sleft=0,stop=0;if(col-scrollLeft-winW+20>0){sleft=col-winW+20;if(isScroll){$("#luckysheet-scrollbar-x").scrollLeft(sleft);}}else if(col_pre-scrollLeft-20<0){sleft=col_pre-20;if(isScroll){$("#luckysheet-scrollbar-x").scrollLeft(sleft);}}if(row-scrollTop-winH+20>0){stop=row-winH+20;if(isScroll){$("#luckysheet-scrollbar-y").scrollTop(stop);}}else if(row_pre-scrollTop-20<0){stop=row_pre-20;if(isScroll){$("#luckysheet-scrollbar-y").scrollTop(stop);}}clearTimeout(jfcountfuncTimeout);jfcountfunc();};luckysheet.luckysheetMoveHighlightRange2=luckysheetMoveHighlightRange2;var luckysheetRangeLast=function luckysheetRangeLast(obj){var range;if(document.createRange){//chrome, firefox, opera, safari, ie9+
  if(obj.innerHTML!=obj.innerText||obj.innerHTML==""){obj.focus();//解决ff不获取焦点无法定位问题
  range=window.getSelection();//创建range
  range.selectAllChildren(obj);//range 选择obj下所有子内容
  range.collapseToEnd();//光标移至最后
  }else {var len=obj.innerText.length;range=document.createRange();range.selectNodeContents(obj);range.setStart(obj.childNodes[0],len);range.collapse(true);var selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);}}else if(document.selection){//ie8 and lower
  range=document.body.createTextRange();range.moveToElementText(obj);range.collapse(false);range.select();}// if (window.getSelection) {//ie11 10 9 ff safari
  //     obj.focus(); //解决ff不获取焦点无法定位问题
  //     var range = window.getSelection();//创建range
  //     range.selectAllChildren(obj);//range 选择obj下所有子内容
  //     range.collapseToEnd();//光标移至最后
  // }
  // else if (document.selection) {//ie10 9 8 7 6 5
  //     var range = document.selection.createRange();//创建选择对象
  //     //var range = document.body.createTextRange();
  //     range.moveToElementText(obj);//range定位到obj
  //     range.collapse(false);//光标移至最后
  //     range.select();
  // }
  };luckysheet.luckysheetRangeLast=luckysheetRangeLast;$("#luckysheet-copy-btn, #luckysheet-cols-copy-btn, #luckysheet-paste-btn-title").click(function(event){$(this).parent().hide();//复制范围内包含部分合并单元格，提示
  if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}}//多重选区 有条件格式时 提示
  var cdformat=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].luckysheet_conditionformat_save;if(luckysheet_select_save.length>1&&cdformat!=null&&cdformat.length>0){var hasCF=false;var cf_compute=luckysheet.conditionformat.getComputeMap();label:for(var s=0;s<luckysheet_select_save.length;s++){if(hasCF){break;}var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];for(var r=r1;r<=r2;r++){for(var c=c1;c<=c2;c++){if(luckysheet.conditionformat.checksCF(r,c,cf_compute)!=null){hasCF=true;continue label;}}}}if(hasCF){if(luckysheet.isEditMode()){alert("无法对多重选择区域执行此操作");}else {luckysheet.tooltip.info("无法对多重选择区域执行此操作","");}return;}}//多重选区 行不一样且列不一样时 提示       
  if(luckysheet_select_save.length>1){var isSameRow=true,str_r=luckysheet_select_save[0].row[0],end_r=luckysheet_select_save[0].row[1];var isSameCol=true,str_c=luckysheet_select_save[0].column[0],end_c=luckysheet_select_save[0].column[1];for(var s=1;s<luckysheet_select_save.length;s++){if(luckysheet_select_save[s].row[0]!=str_r||luckysheet_select_save[s].row[1]!=end_r){isSameRow=false;}if(luckysheet_select_save[s].column[0]!=str_c||luckysheet_select_save[s].column[1]!=end_c){isSameCol=false;}}if(!isSameRow&&!isSameCol||luckysheet.selectIsOverlap()){if(luckysheet.isEditMode()){alert("无法对多重选择区域执行此操作");}else {luckysheet.tooltip.info("无法对多重选择区域执行此操作","");}return;}}luckysheet.selection.copy(event);});$("#luckysheet-copy-paste, #luckysheet-cols-paste-btn, #luckysheet-paste-btn-title").click(function(event){luckysheet.selection.paste(event,"btn");$(this).parent().hide();});$("#luckysheet-chart-btn-title").click(function(){$("#luckysheetdatavisual").click();});$("#luckysheet-pivot-btn-title").click(function(e){luckysheet.pivotTable.createPivotTable(e);});$("#luckysheet-selectall-btn-title").click(function(){$("#luckysheet-left-top").trigger("mousedown");$(document).trigger("mouseup");});$("#luckysheet-download-btn-title").click(function(){if(luckysheet.isEditMode()){alert("正在下载！");}else {luckysheet.tooltip.info("正在下载！","");}});//截图
  $("#luckysheet-chart-btn-screenshot").click(function(){if(luckysheet_select_save.length==0){if(luckysheet.isEditMode()){alert("请框选需要截图的范围");}else {luckysheet.tooltip.info("提示！","请框选需要截图的范围");}return;}if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("无法对多重选择区域执行此操作");}else {luckysheet.tooltip.info("提示！","无法对多重选择区域执行此操作");}return;}//复制范围内包含部分合并单元格，提示
  if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对合并单元格执行此操作");}else {luckysheet.tooltip.info("提示！","无法对合并单元格执行此操作");}return;}}var st_r=luckysheet_select_save[0].row[0],ed_r=luckysheet_select_save[0].row[1];var st_c=luckysheet_select_save[0].column[0],ed_c=luckysheet_select_save[0].column[1];var shotData=luckysheet.datagridgrowth([],ed_r+1,ed_c+1);for(var r=st_r;r<=ed_r;r++){for(var c=st_c;c<=ed_c;c++){shotData[r][c]=luckysheet.flowdata[r][c];}}if(st_r-1<0){var scrollHeight=0;var rh_height=visibledatarow[ed_r];}else {var scrollHeight=visibledatarow[st_r-1];var rh_height=visibledatarow[ed_r]-visibledatarow[st_r-1];}if(st_c-1<0){var scrollWidth=0;var ch_width=visibledatacolumn[ed_c];}else {var scrollWidth=visibledatacolumn[st_c-1];var ch_width=visibledatacolumn[ed_c]-visibledatacolumn[st_c-1];}var newCanvas=$("<canvas>").attr({width:Math.ceil(ch_width*devicePixelRatio),height:Math.ceil(rh_height*devicePixelRatio)}).css({width:ch_width,height:rh_height});var d=luckysheet.flowdata;luckysheet.flowdata=shotData;luckysheetDrawMain(scrollWidth,scrollHeight,ch_width,rh_height,1,1,null,null,newCanvas);// luckysheetDrawMain(scrollWidth, scrollHeight, ch_width, rh_height, 0, 0, null, null, newCanvas);
  luckysheet.flowdata=d;luckysheet.editor.webWorkerFlowDataCache(luckysheet.flowdata);//worker存数据
  var image=new Image();var url=newCanvas.get(0).toDataURL("image/png");image.src=url;if(ch_width>rh_height){image.style.width="100%";}else {image.style.height="100%";}var maxHeight=$(window).height()-200;luckysheet.tooltip.screenshot("截取成功！",'<div id="luckysheet-confirm-screenshot-save" style="height:'+maxHeight+'px;overflow:auto;"></div>',url);$("#luckysheet-confirm-screenshot-save").append(image);newCanvas.remove();//newCanvas.appendTo("body");
  });$(document).on("click","a.download",function(){//截图下载
  var dataURI=$("#luckysheet-confirm-screenshot-save img").attr("src");var binStr=atob(dataURI.split(",")[1]),len=binStr.length,arr=new Uint8Array(len);for(var i=0;i<len;i++){arr[i]=binStr.charCodeAt(i);}var blob=new Blob([arr]);var element=document.createElement('a');element.setAttribute('href',URL.createObjectURL(blob));element.setAttribute('download','截图.png');element.style.display='none';document.body.appendChild(element);element.click();var _clickHandler;element.addEventListener('click',_clickHandler=function clickHandler(){requestAnimationFrame(function(){URL.revokeObjectURL(element.href);});element.removeAttribute('href');element.removeEventListener('click',_clickHandler);});document.body.removeChild(element);});$("#luckysheet-share-btn-title").click(function(){var savedata=[];for(var i=0;i<luckysheetfile.length;i++){var charts=luckysheetfile[i].chart;if(charts==null){continue;}for(var c=0;c<charts.length;c++){var chart=charts[c];var data=luckysheet.getdatabyselectionD(luckysheetfile[i].data,{"row":eval('('+chart.row+')'),"column":eval('('+chart.column+')')});savedata.push([chart.defaultOption,chart.selfOption,chart.chartType,chart.chartStyle,chart.chartMarkConfig,chart.chartTitleConfig,data]);}}luckysheet.tooltip.info("正在发布数据",'<div style="width:100%;text-align:center;position:relative;top:45%;font-size: 16px;"> <div class="luckysheetLoaderGif"> </div><span>渲染中...</span></div>');$.post("../Home/seth5js",{"text":JSON.stringify(savedata)},function(data){if(data=="0"){if(luckysheet.isEditMode()){alert("发布数据失败, 请稍后再试！");}else {luckysheet.tooltip.info("发布数据失败",'请稍后再试！');}}else {var img='<img src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAYAAAB5fY51AAAgAElEQVR4nO3df2wk91038PfaPt8P3+R+5JJLd5IrKTTZhOOg5DZP9unzUFq3txS1OiOsCKEsaKEV4gTxI6qni2DFH4/8qM+W53kk949FKUhLZQRIWGAkquIjBtRSuWQDBfUaljbJNUl3Q5pr4rtJfD7bO8Mf9m721jO7M975fma+6/dLihTvrec7M9/5fjzf3wnHcRwQEWlgJOoTICLyiwGLiLTBgEVE2mDAIiJtMGARkTYYsIhIGwxYRKQNBiwi0gYDFhFpgwGLiLTBgEVE2mDAIiJtMGARkTYYsIhIGwxYRKQNBiwi0gYDFhFpgwGLiLTBgEVE2mDAIiJtMGARkTYYsIhIGwxYRKSNMdUJnD17tu93rly5Eug4uVwOhUIhULpzc3OYnJz0/H61WkU+n2//vLS0BNM0e6ZRLpdRLpcBAIZhYGVlpef3Z2ZmsLy83P45nU6jUqn0/J1sNot6vd7+ud+9siwLmUym/XOlUkE6ne75O933ql8andft5/vdaVy6dAmXLl0KdE5B829lZQWGYfRMo/M6TNPE0tJSz+/n83lUq9X2z5OTk5ibm+v5O5lMBpZltX/ud6/q9Tqy2Wz7ZxX5VyqVMD8/7/v7bmm48XOug9LyDavzofHr2Wef7fnvnUEBAGq1Wt9jNhqN9v9blrXrGN26j9n5+278HLPbM8880zPNMOzl/g/6+/3yr/s6u++Dm877X6/Xbwss/b7vlmY3P8fs1n3MoPnvx6D5F6VYBKxsNuuZsZZl3fYXB9jO1M6/pt3cHqTOvyhuisXibT/PzMz0zNhSqYTFxcXbPpuenu6ZRvfD1+9hvHDhQt/z7FStVjEzM7PrPHtde+ebUkuvguh2X4Lmn9t59ku/X/6VSqW+59mpWCzuyj+3+90paP65PQ/d59nJ7b64nWenoPmXz+d3/XvQ/ItSLAJWvV73DED5fN71wfB6GGu1mmdh8Mp4r2M9+eSTnoXHrQB5vRFZluUZaIrFouvDYlmW6+eLi4uehffJJ590/dyrkCwuLro+8G4PdUtnlbZlL/nndhyg9x8jr/zz+twr/8rlsuvveN3zveSf19uV17PTOl83QfNvZmbGM//cnvW95F9UEo7jOCoT8FP37ZZKpQJVZdLpNBqNRqAbm06nA70aG4YR+PU+6HWkUikAwapxpmkGvu5areb7WkzTRDKZDHSvVOefYRhIpVKxzL+g1fhhyL8WiTasWAYsItIPG92JiDowYBGRNhiwiEgbytuwWroHQBKR/vwMuA2T2BvWwsJCuxeMiPSXSqWwsLAgmqbYG1ZLr15DP1MEiEhO3Mor27CISBviAYvVQiL9RVWOxQOWism4RCQrqnLMKiERaUMsYFmW1Xc1AyLSx/T0dOD5mYMSC1jT09OsDhINkVqtJv4SEosVR4lIT/V6vV3GOfmZiKgDAxYRaUN5wMrlchx7RTTEUqkUcrkcksmk8rTEpuZ07zjiJshQ/0QiMegpKeN1S4Oc86DZ4pWWqnMLkl7Qc1Nl0HMO415KC3qP+7VB+9n5KUzKG91bWhfFRnii4cC5hEREPYgHLNXdnkSkXlTlWDxg9ds8lIjiL6pyLNaG1aJy1VHpRltg8AbWoOfsN72gDcJBzkPVNUt2SoR1HmGkp4rKxv+oVg8WfcPi1Byi4RFFeRYLWL12ZCYi/fTaYVqVWG2kOug4rLhUCYNUNYa9ShiH4wYVh3schjCetyDll3MJiYg6MGARkTYYsIhIG8qHNczNzeHZZ5/F/Py86qR6kh5+4JeqrmfpuYRBzsPr94OcWxjnG8b8x0GFcdwo2m475XI5nD9/XmSRA9F9CRcXF1EsFj3/XWWju+TYoThPio1zwApyjCBUBay4BEKVnTy9Gt1nZ2cxNTUV6HiDEq0SSl8cEakTRXkWb8MyDEM6SSIaEtxIlYgCi2rys/hcwn6L+A2zMAZR+j2GdHuZysGSg7b9xKHtcNhEVY45rIGItCEasPbz2xXRsImiPCuvElarVdTr9Z7DGYhIP/l8HsD28AbTNJFKpZR3qu2byc9xGIcVhKo2rDhsQhEGle1SHIf1jrhNfhZvdKfbxaWgBylMgzZ4x2XxvahHiFNwbHQnIm0of8NaWlri4n1EQ2xubg6pVAqmaSpPS/kblmmamJycRKVS4Sh3oiFiGAYqlQomJydFghUgWCWU3iGWiNSSaGTvJtqGxWk5RMMjivIs3ktommYkWwTFoUcojC5sv71ucV/CJQhVQy7CSG9QcXgu9yKq5h3xXsKo9jMjovBYlhVJuhzWQETaEA1YUS+TTEThiaI8iwWsUqmEUqkklRwRKRZFmVbe6F4ul9FoNLC4uKg6KSISNj8/D8uykEwmcfHiReXjsUQClhQdF2rTcYMEye96UbkpiKpJyjo+n360XkbS6bTygMVGdyLShvKAxek4RMPPMAyRsq68SriysoJ6vY7p6enIxm4QkRqGYWBhYUFsLqHISHfTNNuBK5vNSiRJRIotLS2JBaoW0ak5YV6crlMauoWxMqh0Y3UQ0rvbxOG5iMM5SJAOVgAb3YlII9xIlYgCi6ociwesWq0mnSQRhSyqciwasNhLSDQ8oijPogGLcwmJhkcU5Vn5voQzMzOo1Wq+1sEKsi9hUHHYl1By2kgYC/gN856CQY/hRrpXM4peVD/7ErY2Uf30pz+t/9Sc5eVlLtpHNMTq9TqWl5fRaDSUp8VhDUSkDQYsItKG8pHu6XQajUaD1UKiIWWaJpLJpMjkZ+WN7p2KxWLPhfyCNLrHpSFV1dpJQdJzE8aUnyBU7poz6D1WtYOQyo4NldcXRK9G96mpKczOzipL241olbBQKEgmR0QKRVGeRQMW18YiGh5RlGfOJSSiwPbNXEJOzyGiveLOz0QUWFSTn0UX8FP9dhVGb4mqHiWvY0vvxhKX3W2GmXR+RNWjaFmWeDuWSMCyLAsXLlxgdZBoiGQyGRiGgcuXL4sFLuVVwmw2i0wmw2BFNIQsy0Imk0E2mxWpJioPWGyzIhp+9Xpd5KWEcwmJSBsMWESkDeWN7q35gf3mEarmdx5X0J6xQRdgCzqXbNB5btI9SqrSU3luqno2pedESpCeTyg2rGF2dhbJZBLlclkqSSJSqFAoIJfLiaYpuloD0Hv296CrNfS6FFVvWEGomq3vJoyll8MQ5zcIVfdCeqybSmGV17CwDYuItCEesLhiA5H+otimHhCemgOonZ4TtBolvdtMGFWCOOz+4/f3wzgHlecR5BiSDfFe5xDWscMQ1fhKVgmJSBtiAatarSKTyUglR0SKZTIZVKtV0TSVByzLsrC8vIx8Ps/5hERDxLIs5PN5LC8vi5Vt5cMa/Owc26JyEwq/pHdMVtWGFZfrcBP3NixV5xD3XZ7dBCm/lUoF6XR64DR7EW90D0sc1pYKeh6SAUB6958gQUjl/ZEMCmH8sYnLeCtdsNGdiLSh/A2rUqmgVquhVCqpToqIIlAoFJBKpUQ2phDZ+TmdTsMwDBSLRdXJkRC/VRmV44woetLzCbWdS+gmikIwaBtWHHZGDnKMsB+XzjTi3IalatBv3AeOxm0uobaN7iRL9UhvvnGRH+IBK51OKxtsFnS1hjCOHdeenyh2EAorre57Kj28QtXvq0ovyNppYeWp6uELXsR7CaPaz4yIwhNVOebOzxQ7juPE4i2VvEVVjkUDVpRLJJN+GLjiLYryLBawyuUyhzUQDZFisSi+5Lm2cwmDimuje1y6r3Uz7PdN1RCIoNfMuYQhicMk1718P+zf9xLntdT3aq95rmoieBhj3aS/qzvOJdzHdGsj0ulcSQ0GLNIKg9b+JraRaq1W4yJ+MaJzwXcchyPjY8AwDFQqFZFJzy1ib1ipVAqVSkUqOepB52DVMgzXoDvpYAUIN7qrvjjprdXDIL0y6DAVdL/XEue3sThMlN8r6WAFRNBLaJpmZFsEUfzYjoOXrQ389dVVvP72BlbXN3H84CjMiXGcu3sC504fxfgom1rjZt/sS5hMJhmw9rG/uHodf/L8KpZfXoXTtAEHMEaAT/34aXz43cdw7q4JTIyPRn2a1EcymYwkXfGAJb0tEL0jyurgtfUtPFV7E6V/fg0jdhMJx0HugZP42P3H8d+SR9G0Hbywuo6nr76J515/C6vrmxgFcPLQGN5/5jjO3WNgYlzbYYNDJ6pyzCeAlPufz7yGLzy/irVbWxizm/jJ5FH84oMn8dg9E/iH797Ab3/lJSw89z1sbNmA7cCxmxhxHIw4Nhzbwf9t2jgyCrz/zAnM//wjUV8ORUgsYM3MzGB5eVkqOeoi/Xb1J1dv4Hf++Xt45e0tHLSb+IUfOo5fTp3Ab3z5FXzllRv4h5dWMWY3AWcnSG3ZsB0bCcfBmN2EYzuwbQdwHBx0bPzS+TP4jQ+8V/QaqLezZ89icnISc3NzYmkqn0tYLpdRrVZ9vULGYV/CoKS3+dprz5hkwPrWjQ2c+8urgOMg4Tj4fOYefKVh4a9efBPrmzZG7O3/Rp3twOTYDuzmdjVxxHGQaG5/jp23rL/7lf+KB+86uufzUZUfKnt447IwpJ+5hK19Gy5evKi8MV7byc8MWP5/f9Asfu2WjW/e2MJz1hb+5j/W8craFlY3bKze2oTj2Gg6QMoYxZnDozh1cAR//OINbGw0cWp8BB++5zAWn38DiZ3gNdLcCVhwgFZg6qoG2ls2joyNYOqhu/GJR8/g4dPGQOfPgLV3nPxMsWdtOfj4167jxbeb2MB2QIHjoGnbWN+yAceB49jYbDbRtB3YjoN/uraBrzsORne+O9Zs4sbaFhafv4kRe7s3cMS2MWY3kdhpm2pVA4+OJfBL70visfuO47H7jsM4yMeS3PHJoLYN28EfvXILv3f1Jl67ZW8HK2f7L7tt29jYCUZwbMCx28EKO1W5VrBqVe1avYHG2AiOHxjBOBz8gHEYx8ZH8a6JcbzfvAM/dPIwzhw7xLFW5IvYXMJsNsvxVzE39TULtbe20ASwge3YhI5gZdvbb1ZwbGzaDh6/7wgevmMcZ46M4r4jo9hoOnh1bQtff30NX3ju9XY18NjYCL78+EM4xjenoWOaJpaWlsTSE9uX0LIs5PP5novX69iG5UblQmsq2jY+/52b+Oy317G5s9xMqxro7FQDb23ZGIWDx+89jM+fP+nrmI/86Tdx9frGTjVwC7mH78LvfvA9A53nXoWxf2AY4rqHZS+92rBa84MNY7A2xiDE3sMNw8DCwoJUcuTTX756C5/99jrsdrBCuxrYtG1sNB3cf2QEl3/ilO9gtWU77WA1Ym8PVfiRUxNKr4PkLSwsiAYrgG1Y+9oLbzVR/Lc12A46qoHb1bhWsHIcB3/7gbtx6qC/6TL/em0Nha9+tx2sRmDjA/fegZ97+C6l10L7g3jASqVS3JswJv73t9bw9hbQhPPO6qOtN62dYDUKx1ew+uqrb+GpK6/ji1dX4TjA2E6wGoWDP/xYio3qQyaKlRqACAIWg1V8LF/bhO042MRO24Ztt9+sbNtGwrHxgHF7sPr9b6/iu29t4sUbG/jSS9exsWVjxG62hy4chIPzdx3BUxfuR/LowWgujJSLqhyzSriPbQcrp90b2A5WO0MXHMfGv642b/udn7nvKL7+xjpOHxrFyTFgbbMJYyyBcycP473HD+LcqSMwuNoCKSIWsFq9hFEZtNdFeusuCZ3BCh3VwNZYq03bQdN28OmvX8Nv/fAJHB8fxalDY/hI8ig+EmB1kX/87ipeevMm0uYx3H/yiJJrad1zVbMJVPXwBhHGyPowTU9Pi/cSig1r8DMOS+WwBt0ClsSwhnu+9PptvYGOvT3Gyna2hzK0BoWO2k2M2tsj3A80bRw/kMBd4wnceWBku5G+6eDaW+tY39zC6voWbNtB7VfSOPt7X4PdbOIT70vi46m78ei9x/d0nn70ClhxeVakt14L41npNzVHehyW8jesIHORSNZtwWrnrcreebNqBauE806wSjhAwnFgrW/hrZsOvmPbGGluz/87lLAxPpLAe44dwrm7J3Di8AFc+dXHAAAnDh9wTf/VGzfx9L+/hofvuQOP3OdvyATFS71eb5dxziUkpZrN7RHsrWqg3VEN3A5QNkZ2qoyJnZ6/wwkb5Q+ewYPHD+HQaAITB0aQAGAcGL1tpdAX3ljD899fw8urN/HJ9H270m5cv4nH/v/TeHtjE0+cfzcDFvnCgLWPzaeP4/GV77ffrNa37Pab1qht31YNTOzMDdy0bXzy6asYaToYc7baE6O/8YlH8Jmvfgef/6c6Rh0bP376KH70tIH0vccAAOtbTTz78ps4f98JPPyZL6HZdPD3v/5BvOfU3peNof1HecC6dOmS7/WwgpBuq5Buwwjzu17n89F7DuGT9x/BUy/cwKb9TrUw4di7qoGticxwnHY18GPvOQHjwAiOHhjFnYcPYPaDP4hL5+/FCIB7jIOwHQcvfP9t/Nqf/wue/tb3cGNtA43/9TFUP/URHBwbxVEFcwsHXcIl6DFUCeN5kzrn1npYEuu8iwQsgCuORimRSHg+vP/n3HE0bm7iz15+ux2suquBrWCV6AhWI7DxBx994LZjXV/fxGvWOmrX1vAX33gVz/3Hdbzx9i0kbBuHRoGffug0AODOCY7PGhZDt+Jot16N8EF6Cd30+qskuYed9KRaP/xcf3LhBbxxc3NXNXDEtnHq4BgeOj6OxvU13FjfwvpmE81NG5l7DfzZ9I/A/Ozf4UAigdMTB/DAnRN44seSeOTeYzg1cRAvv7mGv//29/DFb9bxmx95GO+790To17eXvI9Dr10YVBZhleV1L9iGtU/0estqufLxH8DvfuP7+P1/fwMbW7dXA2cfS+LxB+8EsD25eaNpAwAOjW1PufnW//jvSCQSOHJgu+H9+vomvvriNXz5hWv4wjMvYqvpYHwsgffeFf6YHV3GvdHgxANWOp3mVl8xdfLgKD5z/m586uxJfPyLL6D2xhYSjoPRpoNff/pFPPUvDfzUu4/h+MEx3DE+ihEACThIAHhjbQOHRkfwE/efxLtPHMEj/28Za7e2AMfBhx84jY8+9C589OF3KWm3Inmqhy94EX96Go2GdJK0w89bFgCcOjSGlZ99sP2z7Ti4traJq9fXsfLKdby0ehOrNzexvrG5vfio4+DMHQfx3jsn2gHp+d/+KWXX0YlvV9GIqhyLB6ywVh2Nw6YAe0nTr0HbXcI8r5FEAndPjOPuiXH8l+QdoR03DCru/6DtnUHOSWXbmMq2rahWDxZd84MrNRANjyjKs1jAqtVqkU5+JqJw9VvyXAXOJSSiPbEsC9PT0+2fJeYSchlIItIGAxYRaWNfD4oJYz6i9KJsqo4xLCTnfAa973GYj6j7s6L8DWtubg65XE51MkQUkVwuh0qlIrIxhehcwsXFRRSLRc9/H3TF0TjP9/KicuzYfhTnNyxVVM6J7NVpNjs7i6mpqUDHG5RoG5b0xRGROlGUZ/FGd+mdYokofFGV40g2UlU1+TmKpWFUVQuiTi8u1Z0whJGnbt8NmkfS1XmVx943G6lypQY9dBauYQpeFI6oyjHHYVFfXBGB4kI0YC0uLkomRyFKJBIMXHSbKMqz8mEN1WoVtVoNpVKp73dVbqTqF9uw9iYu7TaqlgxSNVwi7svL+JkLXCgUkEqlkEqllDfGKw9YQSY/M2DFLz2/GLD2lt4wBKwWbqTaQ9CHatCeHy/SU3PiMKhx0GOHsR1bGOnFIfiHETTj8sdCAhvdiUgbygPWysqK6L5lRCRrbm4OKysrIhtTKA9YhmFgcnISlUqFo9yJhohhGKhUKpicnBQr22JVwnQ6jUqlIpUcESkm0cjeTbTRPczh/EEbFAdtgFTVo6SqAVplQ/OgPWYqz03V9Uk3gqucZhaWKKbniDe6m6YpnSQRhSyq5h3xgBXVfmZEFB7LsiJJl8MaiEgbogFrfn5eMjkiUqhcLounKdboXiwWOfmZaIiUy2U0Gg3Mzs6Kpak8YLUuKupgJTk/TCW/PU1x39EliDisEhGHxfe87oPKNd37aZXrZDKJixcvKu9UEwlYRDS8WkErnU4rD1hsdCcibSgPWBx3RTT8TNMUGZulvEq4tLQEy7Jw4cKFyMZuEJEahmHg8uXLYgNJRXoJDcPAysoKLMtCJpORSJKIFFtZWREf8S46l1CH1RrisuLooFT2rKmaHyg9f046T1X1VEclivLMRnci0oZ4wIpqA0YiCk9U5Vg8YNVqNekkiShkUZVj0YDFXkKi4RFFeRYNWH72JlSltRFo539+v9erYdTr+0GOMSi3tBzHCfSfmzC+G8a5+T2HIPdnL7sjqfhP5TmoFkV5Vr4vYT6fR6PR8LUO1qD7EgZdcVSa5LZSYWwfJrl6ZxjH9Tp2GKu6xuH5CUpqX0LTNJFMJtsbqqqkfFhDtVpVnQQRRaher6Ner4tUETmsgYi0wYBFRNpQXiWcnJxErVYLfS13Hdd7khzJLT3yvFdj/CDH9TqGyh12/J6fdFtcXJmmiVQqhWQyqTwt5Y3unfqtOhqk0V1HqgJWHBYiVDkFZ9BHNIztuIL8fhBxD1i9Gt2npqZEVxsFhKuEhUJBMjkiUiiK8iwasHSY/ExE/uyLyc+cS0ikv30zl5DTc4j0F1U5Fl0PCwhv5+c4jzwOo8csSIOwdM+fZAO9V3px2cUoyDkMmk9hXHNYjflR7eAu+obFbeqJhkcU5VkkYNXrdWQyGWSzWYnkiEhANptFJpMRDVzKq4SZTIbtVkRDyrKs9ovIwsKC8sZ45W9YDFZE+wMnPxMRdRDvJVQpiukM0r1Sg15jkJ4mVWtOSeeTdI+iynmOqtLThfI3rCtXruDKlSvI5XKqkyIiYblcrl3G0+m08vTEqoSFQoFzCYmGSBRlWrQNi29ZRMMjivLMRnci0oZ4o7thGJEMdZCeTjLoOcRhnSRVDb/SHRWq1sPS8TrCen5M0wzlOEFx8jMRBbYv5hISEQ1CLGBVq1VkMhmp5IhIsUwmI76Nn/KAVa/Xsby8jHw+z+og0RCxLAv5fB7Ly8tiVUTlm1D42Tm2Jc47P4fRsCm5a05QKhto/aQVlMq1oeKwplYc1k4DgpXfSqWifPDoUE3N0VFctpQfVFyCUJDjhvX9bmFMadJt0UIpbHQnIm0of8OqVCqo1+soFouqkyKiCMzOzrY3U1VNecBKp9Ptem2pVGLDO9GQMAwDhUIBU1NTYmmK7vwM9G7E24+N7nFpw5Lc3MJLXO7xoKSX5VG5tE9Y5TUsbHSPmPQOK0GEcW6DNjQHTU+VIPdYei2r/dQYL97oLrFmDhGpFVU5Fg9Y0iNjiSh8tVotknQ5rIGIAouq80w0YC0uLkomR0QKRVGexQJWuVzmWCyiIVIsFlEul0XT3DdzCVVRNRxg0J4fHeczeonDsAbpXYHiMgQmbnMJ2YZFRNpgwCIibTBgEZE2lI90b7VL1Wo1zMzMRLYWNBGFyzRNzM3NiUx6bhF7w0qlUpibm5NKjogUkw5WgPBcQtUXN4xzp/xQtTqllzjMXZTeMi2MOZGDnkPcnm/pYAVE0IYV1X5mRBSefbMvYTKZlE6SiEIWVTnm5GciCiyqcsxhDUSkDbFG93w+H2pUjsOibmFQtaOL9E4xYZBe+G5QKs8hDtfXz9mzZ5FOp1GpVMTSVD6XsFQqoVqt+lo/J4olV4nIm5+5hKlUCul0Gk888YTyxnjlb1jz8/OqkyCiCNVqNdRqNXzoQx9SHrDYhkVE2mDAIiJtiM0lzGaznEdINGRM08TS0pJYemJvWAsLC5EM5SciNVKpFBYWFkTT1HYjVSJSL27llW1YRKQN8YDFaiGR/qIqx+IBK6oNGIkoPNxIlYioD7FGd8uykM/n+YZFNCRSqRQqlQoMwxBLUyxgcRwW0fCRHocVq41UiUhf3EiViKgDAxYRaYMBi4i0EcuAFXRQWjqdDrQOj2EYgevae1nnJ+h1pFKpwOkE7aFJp9OBfsc0zcD3ivnn317yLwiJ/JMkui9hL14TKaenpz2HQrjNZeq1w/Ts7CympqZ2fV6tVpHP53d9bhgGKpXKrgycn59HqVRyPaelpSXXh7ZYLGJxcXHX51NTUygUCrseXMuykMlkXNO4dOkSLl26tOvzTCYDy7Jcf8ftXi0uLqJYLO763Ou6Ae9OlDDzL5/Pu16HV/4FvY5e+beysuKaF6VSKVD+1et1ZLNZ1zQKhQJyudyuz73yzzAMrKys7Prc67p77cgcZv5FIRZvWKZpeq4LXalUXAOA11+NXjtMuz3svY71uc99zjXTc7mc6wNnGIbnX9jZ2VnPz93+yhqG4fr51NSUa7BqnW+QtL2O5RWsAGBycnLXZ3vJP7fjAO+M7fE63yCf98o/t9/xuueGYQTOP9M0XT/3enZa5+umUCi4fu6Vf712ZHZ71veSf1GJRcBaWlryfDU2DGPXOI9eD3Xr37t5PSQt3Q/k3Nxcz1fpQqGw66Hvt9RGd8b3exAuX77c9zw7pdPpXcHa7Tw7uT3wvaoEbvclaP65nWe/9PvlX3eh7pd/bm9rbve7U9D8c3sevIIP4H5fvN4qW4Lmn9sfo6D5F6VYBKyg9jLW4/z58z3/vfvh81OP79xMstfbldcx+21G6eeY3R599NGeaYZh0LE2KvKv+zq774Obzvvv9Ubk9X23NLv5OWa37mOqeLtRPVZKJeUDR/1s7eXnBnYeJ5lM9s3I7nRTqVTPh8eyrNvq6n7OqV6vo9FoANgOLv0e4M7v+/2dWq12W7tG0HvV77q7v+8nje7r2C/5150Xfq5jGPPPi59zHZT4An5ERHulZZWQiPYnBiwi0gYDFhFpgwGLiLTBgEVE2mDAIiJtMGARkTYYsIhIGwxYRKQNBiwi0gYDFhFpgwGLiLTBgEVE2mDAIiJtMGARkTYYsIhIGwxYRKQNBiwi0gYDFgsBXbcAAAAcSURBVBFpgwGLiLTBgEVE2mDAIiJtMGARkTb+E290dzfWDONJAAAAAElFTkSuQmCC" />';luckysheet.tooltip.info("发布成功！请扫二维码",img);}});});//分列
  $("#luckysheet-splitColumn-btn-title").click(function(){if(luckysheet_select_save==null||luckysheet_select_save.length==0){return;}if(luckysheet_select_save.length>1){luckysheet.tooltip.info("不能对多重选择区域执行此操作，请选择单个区域，然后再试","");return;}if(luckysheet_select_save[0].column[0]!=luckysheet_select_save[0].column[1]){luckysheet.tooltip.info("一次只能转换一列数据，选定区域可以有多行，但不能有多列，请在选定单列区域以后再试","");return;}luckysheet.splitColumn.createDialog();luckysheet.splitColumn.init();});$("#luckysheet-freezen-btn-horizontal").click(function(){if($.trim($(this).text())=="取消冻结"){if(luckysheet.freezen.freezenverticaldata!=null){luckysheet.freezen.cancelFreezenVertical();luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}if(luckysheet.freezen.freezenhorizontaldata!=null){luckysheet.freezen.cancelFreezenHorizontal();luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}luckysheet.freezen.scrollAdapt();}else {if(luckysheet.freezen.freezenverticaldata!=null){luckysheet.freezen.cancelFreezenVertical();luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}if(luckysheet.freezen.freezenhorizontaldata==null){luckysheet.freezen.createFreezenHorizontal();luckysheet.freezen.createAssistCanvas();}}});$("#luckysheet-freezen-btn-vertical").click(function(){if(luckysheet.freezen.freezenverticaldata!=null){luckysheet.freezen.cancelFreezenVertical();luckysheet.luckysheetrefreshgrid();}else {luckysheet.freezen.createFreezenVertical();}luckysheet.freezen.createAssistCanvas();});var submenuhide=null,rightclickmenu=null;$(".luckysheet-cols-menu .luckysheet-cols-submenu").hover(function(){var $t=$(this),attrid=$t.attr("id"),$attr=$("#"+attrid+"_sub"),$con=$t.parent();var winW=$(window).width(),winH=$(window).height();var menuW=$con.width(),attrH=$attr.height()+25,attrW=$attr.width()+5;var offset=$t.offset();var top=offset.top,left=offset.left+menuW;if(left+attrW>winW){left=offset.left-attrW;}if(top+attrH>winH){top=winH-attrH;}$attr.css({"top":top,"left":left}).show();rightclickmenu=$t;},function(){var $t=$(this),attrid=$t.attr("id"),$attr=$("#"+attrid+"_sub");submenuhide=setTimeout(function(){$attr.hide();},200);});$(".luckysheet-rightgclick-menu-sub").hover(function(){rightclickmenu.addClass("luckysheet-cols-menuitem-hover");clearTimeout(submenuhide);},function(){rightclickmenu.removeClass("luckysheet-cols-menuitem-hover");$(this).hide();});$(".luckysheet-grid-container, #luckysheet-rightclick-menu").on("contextmenu",function(e){e.preventDefault();});$("#luckysheet-rightclick-menu input").on("keydown",function(e){e.stopPropagation();});var copychange=function copychange(){};$("#luckysheet-modal-dialog-mask").on("click dbclick mousedown mousemove mouseup",function(e){e.stopPropagation();e.preventDefault();});//$("#" + container).mouseover(function () {
  //    luckysheet.luckysheetactiveCell();
  //});
  $(document).on("visibilitychange webkitvisibilitychange msvisibilitychange",copychange).mouseleave(function(){}).mousedown(function(event){//有批注在编辑时
  luckysheet.postil.removeActivePs();//luckysheet.luckysheetactiveCell();
  if(!$(event.target).hasClass("luckysheet-mousedown-cancel")&&$(event.target).filter("[class*='sp-palette']").length==0&&$(event.target).filter("[class*='sp-thumb']").length==0&&$(event.target).filter("[class*='sp-']").length==0){$("#luckysheet-rightclick-menu").hide();$("#luckysheet-cols-h-hover").hide();$("#luckysheet-cols-menu-btn").hide();$("#luckysheet-rightclick-menu").hide();$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu, #luckysheet-user-menu").hide();$("body > .luckysheet-filter-menu, body > .luckysheet-filter-submenu, body > .luckysheet-cols-menu").hide();//$("body > luckysheet-menuButton").hide();
  luckysheet_cols_menu_status=false;}//点击功能栏时 如果是单元格编辑模式 则退出编辑模式 
  if($(event.target).closest("#luckysheet-wa-editor").length>0&&parseInt($("#luckysheet-input-box").css("top"))>0){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("down",0,"rangeOfSelect");}});$("#"+container).add("#luckysheet-input-box").keydown(function(event){if($("#luckysheet-modal-dialog-mask").is(":visible")||$(event.target).hasClass("luckysheet-mousedown-cancel")||$(event.target).hasClass("formulaInputFocus")){return;}var ctrlKey=event.ctrlKey;var altKey=event.altKey;var shiftKey=event.shiftKey;var kcode=event.keyCode;//luckysheet.formula.rangeHightlightselected();
  var $inputbox=$("#luckysheet-input-box");if(kcode==keycode.ESC&&parseInt($("#luckysheet-input-box").css("top"))>0){luckysheet.formula.dontupdate();luckysheetMoveHighlightCell("down",0,"rangeOfSelect");event.preventDefault();}else if(kcode==keycode.ENTER&&parseInt($inputbox.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")&&luckysheet.formula.searchFunctionCell!=null){luckysheet.formula.searchFunctionEnter($("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active"));event.preventDefault();}}else if(kcode==keycode.TAB&&parseInt($inputbox.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")&&luckysheet.formula.searchFunctionCell!=null){luckysheet.formula.searchFunctionEnter($("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active"));}else {luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("right",1,"rangeOfSelect");}event.preventDefault();}else if(kcode==keycode.F4&&parseInt($inputbox.css("top"))>0){luckysheet.formula.setfreezonFuc(event);event.preventDefault();}else if(kcode==keycode.UP&&parseInt($inputbox.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")){var $up=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active").prev();if($up.length==0){$up=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").last();}$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").removeClass("luckysheet-formula-search-item-active");$up.addClass("luckysheet-formula-search-item-active");event.preventDefault();}else if(ctrlKey&&shiftKey){if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightRange2("up","rangeOfFormula");}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightRange2("up","rangeOfFormula");}event.preventDefault();}}else if(ctrlKey){if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightCell2("up","rangeOfFormula");}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightCell2("up","rangeOfFormula");}}event.preventDefault();}else if(shiftKey){if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightRange("down",-1,"rangeOfFormula");}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightRange("down",-1,"rangeOfFormula");}}event.preventDefault();}else {if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightCell("down",-1,"rangeOfFormula");event.preventDefault();}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightCell("down",-1,"rangeOfFormula");event.preventDefault();}}else {var anchor=$(window.getSelection().anchorNode);var anchorOffset=window.getSelection().anchorOffset;if(anchor.parent().is("span")&&anchor.parent().next().length==0&&anchorOffset>0){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("down",-1,"rangeOfSelect");event.preventDefault();}else if(anchor.is("#luckysheet-rich-text-editor")&&anchor.context.childElementCount==anchorOffset){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("down",-1,"rangeOfSelect");event.preventDefault();}else if(anchor.parent().is("#luckysheet-rich-text-editor")&&anchor.context.length==anchorOffset){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("down",-1,"rangeOfSelect");event.preventDefault();}}}}else if(kcode==keycode.DOWN&&parseInt($inputbox.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")){var $up=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active").next();if($up.length==0){$up=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").first();}$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").removeClass("luckysheet-formula-search-item-active");$up.addClass("luckysheet-formula-search-item-active");event.preventDefault();}else if(ctrlKey&&shiftKey){//ctrl + shift + up 调整公式选区
  if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightRange2("down","rangeOfFormula");}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightRange2("down","rangeOfFormula");}}event.preventDefault();}else if(ctrlKey){if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightCell2("down","rangeOfFormula");}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightCell2("down","rangeOfFormula");}}event.preventDefault();}else if(shiftKey){if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightRange("down",1,"rangeOfFormula");}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightRange("down",1,"rangeOfFormula");}}event.preventDefault();}else {if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightCell("down",1,"rangeOfFormula");event.preventDefault();}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightCell("down",1,"rangeOfFormula");event.preventDefault();}}else {var anchor=$(window.getSelection().anchorNode);var anchorOffset=window.getSelection().anchorOffset;if(anchor.parent().is("span")&&anchor.parent().next().length==0&&anchorOffset>0){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("down",1,"rangeOfSelect");event.preventDefault();}else if(anchor.is("#luckysheet-rich-text-editor")&&anchor.context.childElementCount==anchorOffset){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("down",1,"rangeOfSelect");event.preventDefault();}else if(anchor.parent().is("#luckysheet-rich-text-editor")&&anchor.context.length==anchorOffset){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("down",1,"rangeOfSelect");event.preventDefault();}}}}else if(kcode==keycode.LEFT&&parseInt($inputbox.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")){event.preventDefault();}else if(ctrlKey&&shiftKey){//ctrl + shift + up 调整公式选区
  if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightRange2("left","rangeOfFormula");}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightRange2("left","rangeOfFormula");}}event.preventDefault();}else if(ctrlKey){if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightCell2("left","rangeOfFormula");}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightCell2("left","rangeOfFormula");}}event.preventDefault();}else if(shiftKey){if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightRange("right",-1,"rangeOfFormula");event.preventDefault();}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightRange("right",-1,"rangeOfFormula");event.preventDefault();}}}else {if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightCell("right",-1,"rangeOfFormula");event.preventDefault();}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightCell("right",-1,"rangeOfFormula");event.preventDefault();}}else {var anchor=$(window.getSelection().anchorNode);var anchorOffset=window.getSelection().anchorOffset;if(anchor.parent().is("span")&&anchor.parent().prev().length==0&&anchorOffset==0){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("right",-1,"rangeOfSelect");event.preventDefault();}else if(anchor.is("#luckysheet-rich-text-editor")&&anchorOffset==1){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("right",-1,"rangeOfSelect");event.preventDefault();}else if(anchor.parent().is("#luckysheet-rich-text-editor")&&anchorOffset==0){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("right",-1,"rangeOfSelect");event.preventDefault();}}}}else if(kcode==keycode.RIGHT&&parseInt($inputbox.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")){event.preventDefault();}else if(ctrlKey&&shiftKey){//ctrl + shift + up 调整公式选区
  if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightRange2("right","rangeOfFormula");}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightRange2("right","rangeOfFormula");}}event.preventDefault();}else if(ctrlKey){if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightCell2("right","rangeOfFormula");}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightCell2("right","rangeOfFormula");}}event.preventDefault();}else if(shiftKey){if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightRange("right",1,"rangeOfFormula");event.preventDefault();}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightRange("right",1,"rangeOfFormula");event.preventDefault();}}}else {if($("#luckysheet-formula-functionrange-select").is(":visible")){luckysheetMoveHighlightCell("right",1,"rangeOfFormula");event.preventDefault();}else if(luckysheet.formula.israngeseleciton()){var anchor=$(window.getSelection().anchorNode);if(anchor.parent().next().text()==null||anchor.parent().next().text()==""){var vText=$("#luckysheet-input-box #luckysheet-input-box-index").text();var range=luckysheet.formula.getcellrange(vText);if(range==null){range=luckysheet.formula.getcellrange($("#luckysheet-input-box-index").text());}var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[r1,r2],"column":[c1,c2],"row_focus":r1,"column_focus":c1};luckysheet.formula.rangeSetValue({"row":[r1,r2],"column":[c1,c2]});luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheetMoveHighlightCell("right",1,"rangeOfFormula");event.preventDefault();}}else {var anchor=$(window.getSelection().anchorNode);var anchorOffset=window.getSelection().anchorOffset;if(anchor.parent().is("span")&&anchor.parent().next().length==0&&anchorOffset>0){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("right",1,"rangeOfSelect");event.preventDefault();}else if(anchor.is("#luckysheet-rich-text-editor")&&anchor.context.childElementCount==anchorOffset){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("right",1,"rangeOfSelect");event.preventDefault();}else if(anchor.parent().is("#luckysheet-rich-text-editor")&&anchor.context.length==anchorOffset){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("right",1,"rangeOfSelect");event.preventDefault();}}}}else if(!(kcode>=112&&kcode<=123||kcode<=46||kcode==144||kcode==108||event.ctrlKey||event.altKey||event.shiftKey&&(kcode==37||kcode==38||kcode==39||kcode==40))||kcode==8||kcode==32||kcode==46||event.ctrlKey&&kcode==86){luckysheet.formula.functionInputHanddler($("#luckysheet-functionbox-cell"),$("#luckysheet-rich-text-editor"),kcode);}}).keyup(function(e){var kcode=e.keyCode;if(!e.shiftKey&&kcode==16){luckysheet_shiftkeydown=false;luckysheet.luckysheet_shiftpositon=null;}//输入框中文输入后 shift 和 空格 处理
  if(parseInt($("#luckysheet-input-box").css("top"))>0&&(kcode==13||kcode==16||kcode==32)){luckysheet.formula.functionInputHanddler($("#luckysheet-functionbox-cell"),$("#luckysheet-rich-text-editor"),kcode);}e.preventDefault();});//表格计数栏
  var jfcountfunc=function jfcountfunc(){if(luckysheet_select_save.length==0){return;}var min=Infinity,max=-Infinity,sum=0,count=0;for(var s=0;s<luckysheet_select_save.length;s++){var data=luckysheet.getdatabyselectionNoCopy(luckysheet_select_save[s]);for(var r=0;r<data.length;r++){for(var c=0;c<data[0].length;c++){if(luckysheet.func_methods.isRealNull(data[r][c])){continue;}count++;if(data[r][c].ct!=null&&data[r][c].ct.t=="d"){continue;}var value=data[r][c].v;if(!luckysheet.func_methods.isRealNum(value)){continue;}value=parseFloat(value);sum+=value;if(value<min){min=value;}if(value>max){max=value;}}}}var ret="";ret+="<span>计数:"+count+"</span>";// if (sum != 0 && (isFinite(max) || isFinite(min))) {
  if(isFinite(max)||isFinite(min)){//ret += "<span>求和:" + luckysheet.numFormat(sum) + "</span>";
  //ret += "<span>平均值:" + luckysheet.numFormat(sum / count, 4) + "</span>";
  //new runze 
  //处理成亿万格式
  // ret += "<span>求和:" + luckysheet.mask.update("w", luckysheet.numFormat(sum)) + "</span>";
  ret+="<span>求和:"+luckysheet.mask.update("w",sum)+"</span>";// ret += "<span>平均值:" + luckysheet.mask.update("w", luckysheet.numFormat(sum / count, 4)) + "</span>";
  ret+="<span>平均值:"+luckysheet.mask.update("w",Math.round(sum/count*10000)/10000)+"</span>";}if(isFinite(max)){//ret += "<span>最大值:" + luckysheet.numFormat(max) + "</span>";
  // ret += "<span>最大值:" + luckysheet.mask.update("w", luckysheet.numFormat(max)) + "</span>";
  ret+="<span>最大值:"+luckysheet.mask.update("w",max)+"</span>";}if(isFinite(min)){//ret += "<span>最小值:" + luckysheet.numFormat(min) + "</span>";
  // ret += "<span>最小值:" + luckysheet.mask.update("w", luckysheet.numFormat(min)) + "</span>";
  ret+="<span>最小值:"+luckysheet.mask.update("w",min)+"</span>";}$("#luckysheet-sta-content").html(ret);};luckysheet.jfcountfunc=jfcountfunc;$(document).mousemove(function(event){luckysheet.postil.overshow(event);//有批注显示
  clearInterval(jfautoscrollTimeout);if(luckysheet.formula.functionResizeStatus){var y=event.pageY;var movepx=y-luckysheet.formula.functionResizeData.y;var mpx=luckysheet.formula.functionResizeData.calculatebarHeight+movepx;var winh=Math.round($(window).height()/2);if(mpx<=28){if(mpx<=20){return;}mpx=28;}else if(mpx>=winh){if(mpx>=winh+8){return;}mpx=winh;}calculatebarHeight=mpx;$("#luckysheet-wa-calculate").css("height",calculatebarHeight-2);$("#luckysheet-wa-calculate-size").css({"background":"#5e5e5e","cursor":"ns-resize"});clearTimeout(luckysheet.formula.functionResizeTimeout);luckysheet.formula.functionResizeTimeout=setTimeout(function(){luckysheet.luckysheetsizeauto();},15);}else if(!!luckysheet.freezen.horizontalmovestate){var mouse=mouseposition(event.pageX,event.pageY);var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var scrollTop=$("#luckysheet-cell-main").scrollTop();var x=mouse[0]+scrollLeft;var y=mouse[1]+scrollTop;var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var top=mouse[1]+columeHeaderHeight;if(top<columeHeaderHeight){top=columeHeaderHeight;}if(top>luckysheet.freezen.windowHeight-4){top=luckysheet.freezen.windowHeight-4;}$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-handle").css({"top":top});if(top+scrollTop-columeHeaderHeight>=row_pre+(row-row_pre)/2){top=row-2-scrollTop+columeHeaderHeight;luckysheet.freezen.freezenhorizontaldata=[row,row_index+1,scrollTop,luckysheet.freezen.cutVolumn(visibledatarow,row_index+1),top];}else {top=row_pre-2-scrollTop+columeHeaderHeight;luckysheet.freezen.freezenhorizontaldata=[row_pre,row_index,scrollTop,luckysheet.freezen.cutVolumn(visibledatarow,row_index),top];}$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-drop").css({"top":top});luckysheet.freezen.saveFreezen(luckysheet.freezen.freezenhorizontaldata,top,null,null);}else if(!!luckysheet.freezen.verticalmovestate){var mouse=mouseposition(event.pageX,event.pageY);var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var scrollTop=$("#luckysheet-cell-main").scrollTop();var x=mouse[0]+scrollLeft;var y=mouse[1]+scrollTop;var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];var left=mouse[0]+rowHeaderWidth;if(left<rowHeaderWidth){left=rowHeaderWidth;}if(left>luckysheet.freezen.windowWidth-4){left=luckysheet.freezen.windowWidth-4;}$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-handle").css({"left":left});if(left+scrollLeft-rowHeaderWidth>=col_pre+(col-col_pre)/2){left=col-2-scrollLeft+rowHeaderWidth;luckysheet.freezen.freezenverticaldata=[col,col_index+1,scrollLeft,luckysheet.freezen.cutVolumn(visibledatacolumn,col_index+1),left];}else {left=col_pre-2-scrollLeft+rowHeaderWidth;luckysheet.freezen.freezenverticaldata=[col_pre,col_index,scrollLeft,luckysheet.freezen.cutVolumn(visibledatacolumn,col_index),left];}$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-drop").css({"left":left});luckysheet.freezen.saveFreezen(null,null,luckysheet.freezen.freezenverticaldata,left);luckysheet.luckysheetsizeauto();//调节选区时下部单元格溢出
  }else if(!!luckysheet.pivotTable&&luckysheet.pivotTable.movestate){var x=event.pageX,y=event.pageY;$("#luckysheet-modal-dialog-slider-pivot-move").css({"left":x-luckysheet.pivotTable.movesave.width/2,"top":y-luckysheet.pivotTable.movesave.height});}else if(!!luckysheet.chartparam.luckysheet_chart_point_config&&luckysheet.chartparam.luckysheet_chart_point_config.movestart){var x=event.pageX,y=event.pageY,$container=luckysheet.chartparam.luckysheet_chart_point_config.container;var curleft=x-$container.offset().left+$container.scrollLeft();var curtop=y-$container.offset().top+$container.scrollTop();//var $cur = $(event.target), $item = $(event.target).closest(".luckysheet-chart-point-searchitem");
  //$item.addClass("luckysheet-chart-point-searchitem-active");
  var top=0,height=0;if(luckysheet.chartparam.luckysheet_chart_point_config.top>curtop){top=curtop;height=luckysheet.chartparam.luckysheet_chart_point_config.top-curtop;}else if(luckysheet.chartparam.luckysheet_chart_point_config.top==curtop){top=curtop;height=luckysheet.chartparam.luckysheet_chart_point_config.top-curtop;}else {top=luckysheet.chartparam.luckysheet_chart_point_config.top;height=curtop-luckysheet.chartparam.luckysheet_chart_point_config.top-1;}var left=0,width=0;if(luckysheet.chartparam.luckysheet_chart_point_config.left>curleft){left=curleft;width=luckysheet.chartparam.luckysheet_chart_point_config.left-curleft;}else if(luckysheet.chartparam.luckysheet_chart_point_config.left==curleft){left=curleft;width=luckysheet.chartparam.luckysheet_chart_point_config.left-curleft;}else {left=luckysheet.chartparam.luckysheet_chart_point_config.left;width=curleft-luckysheet.chartparam.luckysheet_chart_point_config.left-1;}for(var i=0;i<luckysheet.chartparam.luckysheet_chart_point_config.objectIndicator.length;i++){var obj=luckysheet.chartparam.luckysheet_chart_point_config.objectIndicator[i];if(!(obj.left+obj.width+$container.scrollLeft()<=left||obj.top+obj.height+$container.scrollTop()<=top||obj.left+$container.scrollLeft()>=left+width||obj.top+$container.scrollTop()>=top+height)){if(obj.isselected){obj.item.removeClass("luckysheet-chart-point-searchitem-active");}else {obj.item.addClass("luckysheet-chart-point-searchitem-active");}}else {if(!obj.isselected){obj.item.removeClass("luckysheet-chart-point-searchitem-active");}}}$("#luckysheet-chart-point-selectedhelp").css({"left":left,"width":width,"top":top,"height":height});}else if(luckysheet_sheet_move_status){var scrollLeft=$("#luckysheet-sheet-container-c").scrollLeft();var x=event.pageX+scrollLeft;if(Math.abs(event.pageX-luckysheet_sheet_move_data.pageX)<3){return;}var winW=$("#luckysheet-sheet-container").width();var left=x-luckysheet_sheet_move_data.curleft-$("#luckysheet-sheet-container").offset().left;luckysheet_sheet_move_data.activeobject.css({"left":left});var row_index=luckysheet_searcharray(luckysheet_sheet_move_data.widthlist,left+luckysheet_sheet_move_data.curleft);luckysheet_sheet_move_data.cursorobject.css({"cursor":"move"});if(left-scrollLeft<=6){$("#luckysheet-sheets-leftscroll").click();}if(left-scrollLeft>=winW-40){$("#luckysheet-sheets-rightscroll").click();}if(row_index!=luckysheet_sheet_move_data.curindex){if(row_index==-1&&left>0){row_index=luckysheet_sheet_move_data.widthlist.length-1;$("#luckysheet-sheets-item-clone").insertAfter($("#luckysheet-sheet-area div.luckysheet-sheets-item:visible").eq(row_index));}else if(row_index==-1&&left<=0){$("#luckysheet-sheets-item-clone").insertBefore($("#luckysheet-sheet-area div.luckysheet-sheets-item:visible").eq(0));}else {$("#luckysheet-sheets-item-clone").insertAfter($("#luckysheet-sheet-area div.luckysheet-sheets-item:visible").eq(row_index));}luckysheet_sheet_move_data.widthlist=[];//luckysheet_sheet_move_data.curleft = x;
  $("#luckysheet-sheet-area div.luckysheet-sheets-item:visible").each(function(i){if(i==0){luckysheet_sheet_move_data.widthlist.push(parseInt($(this).outerWidth()));}else {luckysheet_sheet_move_data.widthlist.push(parseInt($(this).outerWidth())+luckysheet_sheet_move_data.widthlist[i-1]);}});luckysheet_sheet_move_data.curindex=$("#luckysheet-sheet-area div.luckysheet-sheets-item:visible").index($("#luckysheet-sheets-item-clone"));}}else if(luckysheet_model_move_state){var scrollTop=$(document).scrollTop(),scrollLeft=$(document).scrollLeft();var y=event.pageY+scrollTop,x=event.pageX+scrollLeft;var winH=$(window).height(),winW=$(window).width();var myh=luckysheet_model_move_obj.height(),myw=luckysheet_model_move_obj.width();var top=y-luckysheet_model_xy[1],left=x-luckysheet_model_xy[0];if(top<0){top=0;}if(top+myh+62>winH){top=winH-myh-62;}if(left<0){left=0;}if(left+myw+86>winW){left=winW-myw-86;}luckysheet_model_move_obj.css({"top":top,"left":left});event.preventDefault();}else if(!!luckysheet_scroll_status||!!luckysheet_select_status||!!luckysheet_rows_selected_status||!!luckysheet_cols_selected_status||!!luckysheet_cell_selected_move||!!luckysheet_cell_selected_move||!!luckysheet_cell_selected_extend||!!luckysheet_cols_change_size||!!luckysheet_rows_change_size||!!luckysheet.chartparam.luckysheetCurrentChartMove||!!luckysheet.chartparam.luckysheetCurrentChartResize||!!luckysheet.formula.rangeResize||!!luckysheet.formula.rangeMove){if(luckysheet_select_status){clearTimeout(jfcountfuncTimeout);jfcountfuncTimeout=setTimeout(function(){jfcountfunc();},500);}jfautoscrollTimeout=setInterval(function(){if(luckysheet_scroll_status&&!luckysheet_cols_change_size&&!luckysheet_rows_change_size){var mouse=mouseposition(event.pageX,event.pageY);var left=$("#luckysheet-scrollbar-x").scrollLeft(),top=$("#luckysheet-scrollbar-y").scrollTop();var x=mouse[0];var y=mouse[1];var winH=$("#luckysheet-cell-main").height()-20,winW=$("#luckysheet-cell-main").width()-60;if(y<0||y>winH){var stop;if(y<0){stop=top+y/2;}else {stop=top+(y-winH)/2;}$("#luckysheet-scrollbar-y").scrollTop(stop);}if(x<0||x>winW){var sleft;if(x<0){sleft=left+x/2;}else {sleft=left+(x-winW)/2;}$("#luckysheet-scrollbar-x").scrollLeft(sleft);}}if(luckysheet_select_status){var mouse=mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];var last=$.extend(true,{},luckysheet_select_save[luckysheet_select_save.length-1]);var top=0,height=0,rowseleted=[];if(last.top>row_pre){top=row_pre;height=last.top+last.height-row_pre;if(last.row[1]>last.row_focus){last.row[1]=last.row_focus;}rowseleted=[row_index,last.row[1]];}else if(last.top==row_pre){top=row_pre;height=last.top+last.height-row_pre;rowseleted=[row_index,last.row[0]];}else {top=last.top;height=row-last.top-1;if(last.row[0]<last.row_focus){last.row[0]=last.row_focus;}rowseleted=[last.row[0],row_index];}var left=0,width=0,columnseleted=[];if(last.left>col_pre){left=col_pre;width=last.left+last.width-col_pre;if(last.column[1]>last.column_focus){last.column[1]=last.column_focus;}columnseleted=[col_index,last.column[1]];}else if(last.left==col_pre){left=col_pre;width=last.left+last.width-col_pre;columnseleted=[col_index,last.column[0]];}else {left=last.left;width=col-last.left-1;if(last.column[0]<last.column_focus){last.column[0]=last.column_focus;}columnseleted=[last.column[0],col_index];}var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,rowseleted,last,top,height,left,width);if(changeparam!=null){columnseleted=changeparam[0];rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];left=changeparam[4];width=changeparam[5];}last["row"]=rowseleted;last["column"]=columnseleted;last["left_move"]=left;last["width_move"]=width;last["top_move"]=top;last["height_move"]=height;luckysheet_select_save[luckysheet_select_save.length-1]=last;luckysheet.selectHightlightShow();luckysheet.freezen.scrollFreezen();$("#luckysheet-helpbox-cell").text(luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,luckysheet_select_save[luckysheet_select_save.length-1]));//交替颜色选择范围
  if($("#luckysheet-alternateformat-rangeDialog").is(":visible")){$("#luckysheet-alternateformat-rangeDialog input").val(luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,luckysheet_select_save[luckysheet_select_save.length-1]));}if(luckysheet.chartparam.luckysheet_chart_data_select_state){$("#luckysheet-datavisual-range-selection-input").val(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].name+"!"+luckysheet.luckysheetchatatABC(luckysheet_select_save[0]["column"][0])+(luckysheet_select_save[0]["row"][0]+1)+":"+luckysheet.luckysheetchatatABC(luckysheet_select_save[0]["column"][1])+(luckysheet_select_save[0]["row"][1]+1));}if(luckysheet.pivotTable.luckysheet_pivotTable_select_state){$("#luckysheet-pivotTable-range-selection-input").val(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].name+"!"+luckysheet.luckysheetchatatABC(luckysheet_select_save[0]["column"][0])+(luckysheet_select_save[0]["row"][0]+1)+":"+luckysheet.luckysheetchatatABC(luckysheet_select_save[0]["column"][1])+(luckysheet_select_save[0]["row"][1]+1));}}else if(luckysheet.conditionformat.selectStatus){var mouse=mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];var last=luckysheet.conditionformat.selectRange[luckysheet.conditionformat.selectRange.length-1];var top=0,height=0,rowseleted=[];if(last.top>row_pre){top=row_pre;height=last.top+last.height-row_pre;if(last.row[1]>last.row_focus){last.row[1]=last.row_focus;}rowseleted=[row_index,last.row[1]];}else if(last.top==row_pre){top=row_pre;height=last.top+last.height-row_pre;rowseleted=[row_index,last.row[0]];}else {top=last.top;height=row-last.top-1;if(last.row[0]<last.row_focus){last.row[0]=last.row_focus;}rowseleted=[last.row[0],row_index];}var left=0,width=0,columnseleted=[];if(last.left>col_pre){left=col_pre;width=last.left+last.width-col_pre;if(last.column[1]>last.column_focus){last.column[1]=last.column_focus;}columnseleted=[col_index,last.column[1]];}else if(last.left==col_pre){left=col_pre;width=last.left+last.width-col_pre;columnseleted=[col_index,last.column[0]];}else {left=last.left;width=col-last.left-1;if(last.column[0]<last.column_focus){last.column[0]=last.column_focus;}columnseleted=[last.column[0],col_index];}var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,rowseleted,last,top,height,left,width);if(changeparam!=null){columnseleted=changeparam[0];rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];left=changeparam[4];width=changeparam[5];}last["row"]=rowseleted;last["column"]=columnseleted;last["left_move"]=left;last["width_move"]=width;last["top_move"]=top;last["height_move"]=height;luckysheet.conditionformat.selectRange[luckysheet.conditionformat.selectRange.length-1]=last;luckysheet.selectionCopyShow(luckysheet.conditionformat.selectRange);var range=luckysheet.conditionformat.getTxtByRange(luckysheet.conditionformat.selectRange);$("#luckysheet-multiRange-dialog input").val(range);}else if(luckysheet.formula.rangestart){luckysheet.formula.rangedrag(event);}else if(luckysheet.formula.rangedrag_row_start){luckysheet.formula.rangedrag_row(event);}else if(luckysheet.formula.rangedrag_column_start){luckysheet.formula.rangedrag_column(event);}else if(luckysheet_rows_selected_status){var mouse=mouseposition(event.pageX,event.pageY);var y=mouse[1]+$("#luckysheet-rows-h").scrollTop();if(y<0){return false;}var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var col_index=visibledatacolumn.length-1,col=visibledatacolumn[col_index],col_pre=0;var last=$.extend(true,{},luckysheet_select_save[luckysheet_select_save.length-1]);var top=0,height=0,rowseleted=[];if(last.top>row_pre){top=row_pre;height=last.top+last.height-row_pre;if(last.row[1]>last.row_focus){last.row[1]=last.row_focus;}rowseleted=[row_index,last.row[1]];}else if(last.top==row_pre){top=row_pre;height=last.top+last.height-row_pre;rowseleted=[row_index,last.row[0]];}else {top=last.top;height=row-last.top-1;if(last.row[0]<last.row_focus){last.row[0]=last.row_focus;}rowseleted=[last.row[0],row_index];}// var changeparam = luckysheet.menuButton.mergeMoveMain([0, col_index], rowseleted, last, top, height, col_pre, col);
  // if(changeparam != null){
  //     //columnseleted = changeparam[0];
  //     rowseleted= changeparam[1];
  //     top = changeparam[2];
  //     height = changeparam[3];
  //     //left = changeparam[4];
  //     //width = changeparam[5];
  // }
  last["row"]=rowseleted;last["top_move"]=top;last["height_move"]=height;luckysheet_select_save[luckysheet_select_save.length-1]=last;luckysheet.selectHightlightShow();clearTimeout(jfcountfuncTimeout);jfcountfuncTimeout=setTimeout(function(){jfcountfunc();},500);//event.preventDefault();
  }else if(luckysheet_cols_selected_status){var mouse=mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cols-h-c").scrollLeft();if(x<0){return false;}var row_index=visibledatarow.length-1,row=visibledatarow[row_index],row_pre=0;var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];var last=$.extend(true,{},luckysheet_select_save[luckysheet_select_save.length-1]);var left=0,width=0,columnseleted=[];if(last.left>col_pre){left=col_pre;width=last.left+last.width-col_pre;if(last.column[1]>last.column_focus){last.column[1]=last.column_focus;}columnseleted=[col_index,last.column[1]];}else if(last.left==col_pre){left=col_pre;width=last.left+last.width-col_pre;columnseleted=[col_index,last.column[0]];}else {left=last.left;width=col-last.left-1;if(last.column[0]<last.column_focus){last.column[0]=last.column_focus;}columnseleted=[last.column[0],col_index];}// var changeparam = luckysheet.menuButton.mergeMoveMain(columnseleted, [0, row_index], last, row_pre, row, left, width);
  // if(changeparam != null){
  //     columnseleted = changeparam[0];
  //     //rowseleted= changeparam[1];
  //     //top = changeparam[2];
  //     //height = changeparam[3];
  //     left = changeparam[4];
  //     width = changeparam[5];
  // }
  last["column"]=columnseleted;last["left_move"]=left;last["width_move"]=width;luckysheet_select_save[luckysheet_select_save.length-1]=last;luckysheet.selectHightlightShow();clearTimeout(jfcountfuncTimeout);jfcountfuncTimeout=setTimeout(function(){jfcountfunc();},500);//event.preventDefault();
  }else if(luckysheet_cell_selected_move){var mouse=mouseposition(event.pageX,event.pageY);var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var scrollTop=$("#luckysheet-cell-main").scrollTop();var x=mouse[0]+scrollLeft;var y=mouse[1]+scrollTop;var winH=$(window).height()+scrollTop-sheetBarHeight-statisticBarHeight,winW=$(window).width()+scrollLeft;var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];var row_index_original=luckysheet_cell_selected_move_index[0],col_index_original=luckysheet_cell_selected_move_index[1];var row_s=luckysheet_select_save[0]["row"][0]-row_index_original+row_index,row_e=luckysheet_select_save[0]["row"][1]-row_index_original+row_index;var col_s=luckysheet_select_save[0]["column"][0]-col_index_original+col_index,col_e=luckysheet_select_save[0]["column"][1]-col_index_original+col_index;if(row_s<0||y<0){row_s=0;row_e=luckysheet_select_save[0]["row"][1]-luckysheet_select_save[0]["row"][0];}if(col_s<0||x<0){col_s=0;col_e=luckysheet_select_save[0]["column"][1]-luckysheet_select_save[0]["column"][0];}if(row_e>=visibledatarow[visibledatarow.length-1]||y>winH){row_s=visibledatarow.length-1-luckysheet_select_save[0]["row"][1]+luckysheet_select_save[0]["row"][0];row_e=visibledatarow.length-1;}if(col_e>=visibledatacolumn[visibledatacolumn.length-1]||x>winW){col_s=visibledatacolumn.length-1-luckysheet_select_save[0]["column"][1]+luckysheet_select_save[0]["column"][0];col_e=visibledatacolumn.length-1;}var col_pre=col_s-1==-1?0:visibledatacolumn[col_s-1],col=visibledatacolumn[col_e];var row_pre=row_s-1==-1?0:visibledatarow[row_s-1],row=visibledatarow[row_e];$("#luckysheet-cell-selected-move").css({"left":col_pre,"width":col-col_pre-2,"top":row_pre,"height":row-row_pre-2,"display":"block"});//clearTimeout(jfcountfuncTimeout);
  //jfcountfuncTimeout = setTimeout(function () { jfcountfunc() }, 500);
  //event.preventDefault();
  }else if(luckysheet_cell_selected_extend){var mouse=mouseposition(event.pageX,event.pageY);var scrollLeft=$("#luckysheet-cell-main").scrollLeft()-5;var scrollTop=$("#luckysheet-cell-main").scrollTop()-5;var x=mouse[0]+scrollLeft;var y=mouse[1]+scrollTop;var winH=$(window).height()+scrollTop-sheetBarHeight-statisticBarHeight,winW=$(window).width()+scrollLeft;/*                        if (x < 0 || y < 0) {
                                                      return;
                                                  }*/var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];var row_index_original=luckysheet_cell_selected_extend_index[0],col_index_original=luckysheet_cell_selected_extend_index[1];var row_s=luckysheet_select_save[0]["row"][0],row_e=luckysheet_select_save[0]["row"][1];var col_s=luckysheet_select_save[0]["column"][0],col_e=luckysheet_select_save[0]["column"][1];if(row_s<0||y<0){row_s=0;row_e=luckysheet_select_save[0]["row"][1]-luckysheet_select_save[0]["row"][0];}if(col_s<0||x<0){col_s=0;col_e=luckysheet_select_save[0]["column"][1]-luckysheet_select_save[0]["column"][0];}if(row_e>=visibledatarow[visibledatarow.length-1]||y>winH){row_s=visibledatarow.length-1-luckysheet_select_save[0]["row"][1]+luckysheet_select_save[0]["row"][0];row_e=visibledatarow.length-1;}if(col_e>=visibledatacolumn[visibledatacolumn.length-1]||x>winW){col_s=visibledatacolumn.length-1-luckysheet_select_save[0]["column"][1]+luckysheet_select_save[0]["column"][0];col_e=visibledatacolumn.length-1;}var top=luckysheet_select_save[0].top_move,height=luckysheet_select_save[0].height_move;var left=luckysheet_select_save[0].left_move,width=luckysheet_select_save[0].width_move;if(Math.abs(row_index_original-row_index)>Math.abs(col_index_original-col_index)){if(!(row_index>=row_s&&row_index<=row_e)){if(luckysheet_select_save[0].top_move>=row_pre){top=row_pre;height=luckysheet_select_save[0].top_move+luckysheet_select_save[0].height_move-row_pre;}else {top=luckysheet_select_save[0].top_move;height=row-luckysheet_select_save[0].top_move-1;}}}else {if(!(col_index>=col_s&&col_index<=col_e)){if(luckysheet_select_save[0].left_move>=col_pre){left=col_pre;width=luckysheet_select_save[0].left_move+luckysheet_select_save[0].width_move-col_pre;}else {left=luckysheet_select_save[0].left_move;width=col-luckysheet_select_save[0].left_move-1;}}}$("#luckysheet-cell-selected-extend").css({"left":left,"width":width,"top":top,"height":height,"display":"block"});//event.preventDefault();
  }else if(luckysheet_cols_change_size){var mouse=mouseposition(event.pageX,event.pageY);var scrollLeft=$("#luckysheet-cols-h-c").scrollLeft();var x=mouse[0]+scrollLeft;var winW=$(window).width();var row_index=visibledatarow.length-1,row=visibledatarow[row_index],row_pre=0;var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];if(luckysheetConfigsetting.pointEdit){//编辑器qksheet表格编辑状态
  if((x+3)/luckysheetConfigsetting.pointEditZoom-luckysheet_cols_change_size_start[0]>30&&x/luckysheetConfigsetting.pointEditZoom<winW+scrollLeft-100){$("#luckysheet-change-size-line").css({"left":x/luckysheetConfigsetting.pointEditZoom});$("#luckysheet-cols-change-size").css({"left":(x-2)/luckysheetConfigsetting.pointEditZoom});}}else {if(x+3-luckysheet_cols_change_size_start[0]>30&&x<winW+scrollLeft-100){$("#luckysheet-change-size-line").css({"left":x});$("#luckysheet-cols-change-size").css({"left":x-2});}}//event.preventDefault();
  }else if(luckysheet_rows_change_size){var mouse=mouseposition(event.pageX,event.pageY);var scrollTop=$("#luckysheet-rows-h").scrollTop();var y=mouse[1]+scrollTop;var winH=$(window).height();var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];if(luckysheetConfigsetting.pointEdit){//编辑器qksheet表格编辑状态
  if((y+3)/luckysheetConfigsetting.pointEditZoom-luckysheet_rows_change_size_start[0]>19&&y/luckysheetConfigsetting.pointEditZoom<winH+scrollTop-200){$("#luckysheet-change-size-line").css({"top":y/luckysheetConfigsetting.pointEditZoom});$("#luckysheet-rows-change-size").css({"top":y/luckysheetConfigsetting.pointEditZoom});}}else {if(y+3-luckysheet_rows_change_size_start[0]>19&&y<winH+scrollTop-200){$("#luckysheet-change-size-line").css({"top":y});$("#luckysheet-rows-change-size").css({"top":y});}}//event.preventDefault();
  }else if(luckysheet.chartparam.luckysheetCurrentChartMove){var mouse=mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();// var scrollTop = $("#luckysheet-cell-main").scrollTop(), scrollLeft = $("#luckysheet-cell-main").scrollLeft();
  // var y = event.pageY + scrollTop, x = event.pageX + scrollLeft;
  var myh=luckysheet.chartparam.luckysheetCurrentChartMoveObj.height(),myw=luckysheet.chartparam.luckysheetCurrentChartMoveObj.width();var top=y-luckysheet.chartparam.luckysheetCurrentChartMoveXy[1],left=x-luckysheet.chartparam.luckysheetCurrentChartMoveXy[0];if(top<0){top=0;}if(top+myh+42+6>luckysheet.chartparam.luckysheetCurrentChartMoveWinH){top=luckysheet.chartparam.luckysheetCurrentChartMoveWinH-myh-42-6;}if(left<0){left=0;}if(left+myw+22+36>luckysheet.chartparam.luckysheetCurrentChartMoveWinW){left=luckysheet.chartparam.luckysheetCurrentChartMoveWinW-myw-22-36;}luckysheet.chartparam.luckysheetCurrentChartMoveObj.css({"top":top,"left":left});if(luckysheet.freezen.freezenhorizontaldata!=null||luckysheet.freezen.freezenverticaldata!=null){luckysheet.freezen.scrollAdapt();var toffset=luckysheet.chartparam.luckysheetCurrentChartMoveObj.offset();var tpsition=luckysheet.chartparam.luckysheetCurrentChartMoveObj.position();luckysheet.chartparam.luckysheetCurrentChartMoveXy=[event.pageX-toffset.left,event.pageY-toffset.top,tpsition.left,tpsition.top,$("#luckysheet-scrollbar-x").scrollLeft(),$("#luckysheet-scrollbar-y").scrollTop()];}//event.preventDefault();
  }else if(!!luckysheet.chartparam.luckysheetCurrentChartResize){var scrollTop=$("#luckysheet-cell-main").scrollTop(),scrollLeft=$("#luckysheet-cell-main").scrollLeft();var mouse=mouseposition(event.pageX,event.pageY);var x=mouse[0]+scrollLeft;var y=mouse[1]+scrollTop;if(x<0||y<0){return false;}var myh=luckysheet.chartparam.luckysheetCurrentChartResizeObj.height(),myw=luckysheet.chartparam.luckysheetCurrentChartResizeObj.width();var topchange=y-luckysheet.chartparam.luckysheetCurrentChartResizeXy[1],leftchange=x-luckysheet.chartparam.luckysheetCurrentChartResizeXy[0];var top=luckysheet.chartparam.luckysheetCurrentChartResizeXy[5],height=luckysheet.chartparam.luckysheetCurrentChartResizeXy[3],left=luckysheet.chartparam.luckysheetCurrentChartResizeXy[4],width=luckysheet.chartparam.luckysheetCurrentChartResizeXy[2];if(luckysheet.chartparam.luckysheetCurrentChartResize=="lm"||luckysheet.chartparam.luckysheetCurrentChartResize=="lt"||luckysheet.chartparam.luckysheetCurrentChartResize=="lb"){left=x;width=luckysheet.chartparam.luckysheetCurrentChartResizeXy[2]-leftchange;if(left>luckysheet.chartparam.luckysheetCurrentChartResizeXy[2]+luckysheet.chartparam.luckysheetCurrentChartResizeXy[4]-60){left=luckysheet.chartparam.luckysheetCurrentChartResizeXy[2]+luckysheet.chartparam.luckysheetCurrentChartResizeXy[4]-60;width=luckysheet.chartparam.luckysheetCurrentChartResizeXy[2]-(luckysheet.chartparam.luckysheetCurrentChartResizeXy[2]+luckysheet.chartparam.luckysheetCurrentChartResizeXy[4]-60-luckysheet.chartparam.luckysheetCurrentChartResizeXy[0]);}else if(left<=0){left=0;width=luckysheet.chartparam.luckysheetCurrentChartResizeXy[2]+luckysheet.chartparam.luckysheetCurrentChartResizeXy[0];}}if(luckysheet.chartparam.luckysheetCurrentChartResize=="rm"||luckysheet.chartparam.luckysheetCurrentChartResize=="rt"||luckysheet.chartparam.luckysheetCurrentChartResize=="rb"){width=luckysheet.chartparam.luckysheetCurrentChartResizeXy[2]+leftchange;if(width<60){width=60;}else if(width>=luckysheet.chartparam.luckysheetCurrentChartResizeWinW-luckysheet.chartparam.luckysheetCurrentChartResizeXy[4]-22-36){width=luckysheet.chartparam.luckysheetCurrentChartResizeWinW-luckysheet.chartparam.luckysheetCurrentChartResizeXy[4]-22-36;}}if(luckysheet.chartparam.luckysheetCurrentChartResize=="mt"||luckysheet.chartparam.luckysheetCurrentChartResize=="lt"||luckysheet.chartparam.luckysheetCurrentChartResize=="rt"){top=y;height=luckysheet.chartparam.luckysheetCurrentChartResizeXy[3]-topchange;if(top>luckysheet.chartparam.luckysheetCurrentChartResizeXy[3]+luckysheet.chartparam.luckysheetCurrentChartResizeXy[5]-60){top=luckysheet.chartparam.luckysheetCurrentChartResizeXy[3]+luckysheet.chartparam.luckysheetCurrentChartResizeXy[5]-60;height=luckysheet.chartparam.luckysheetCurrentChartResizeXy[3]-(luckysheet.chartparam.luckysheetCurrentChartResizeXy[3]+luckysheet.chartparam.luckysheetCurrentChartResizeXy[5]-60-luckysheet.chartparam.luckysheetCurrentChartResizeXy[1]);}else if(top<=0){top=0;height=luckysheet.chartparam.luckysheetCurrentChartResizeXy[3]+luckysheet.chartparam.luckysheetCurrentChartResizeXy[1];}}if(luckysheet.chartparam.luckysheetCurrentChartResize=="mb"||luckysheet.chartparam.luckysheetCurrentChartResize=="lb"||luckysheet.chartparam.luckysheetCurrentChartResize=="rb"){height=luckysheet.chartparam.luckysheetCurrentChartResizeXy[3]+topchange;if(height<60){height=60;}else if(height>=luckysheet.chartparam.luckysheetCurrentChartResizeWinH-luckysheet.chartparam.luckysheetCurrentChartResizeXy[5]-42-6){height=luckysheet.chartparam.luckysheetCurrentChartResizeWinH-luckysheet.chartparam.luckysheetCurrentChartResizeXy[5]-42-6;}}//if (top < 0) {
  //    top = 0;
  //}
  //if (top + myh > luckysheet.chartparam.luckysheetCurrentChartResizeWinH) {
  //    top = luckysheet.chartparam.luckysheetCurrentChartResizeWinH - myh;
  //}
  //if (left < 0) {
  //    left = 0;
  //}
  //if (left + myw > luckysheet.chartparam.luckysheetCurrentChartResizeWinW) {
  //    left = luckysheet.chartparam.luckysheetCurrentChartResizeWinW - myw;
  //}
  var resizedata={"top":top,"left":left,"height":height,"width":width};luckysheet.chartparam.luckysheetCurrentChartResizeObj.css(resizedata);//echarts.getInstanceById(luckysheet.chartparam.luckysheetCurrentChartResizeObj.find(".luckysheet-modal-dialog-content").attr("_echarts_instance_")).resize();
  !!window.generator&&generator.resize(luckysheet.chartparam.luckysheetcurrentChart);//event.preventDefault();
  }else if(luckysheet.postil.move){var mouse=mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();var myh=luckysheet.postil.currentObj.outerHeight(),myw=luckysheet.postil.currentObj.outerWidth();var top=y-luckysheet.postil.moveXY[1],left=x-luckysheet.postil.moveXY[0];if(top<0){top=0;}if(top+myh+42+6>luckysheet.postil.currentWinH){top=luckysheet.postil.currentWinH-myh-42-6;}if(left<0){left=0;}if(left+myw+22+36>luckysheet.postil.currentWinW){left=luckysheet.postil.currentWinW-myw-22-36;}luckysheet.postil.currentObj.css({"left":left,"top":top});}else if(!!luckysheet.postil.resize){var mouse=luckysheet.mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();if(x<0||y<0){return false;}var topchange=y-luckysheet.postil.resizeXY[1],leftchange=x-luckysheet.postil.resizeXY[0];var top=luckysheet.postil.resizeXY[5],height=luckysheet.postil.resizeXY[3],left=luckysheet.postil.resizeXY[4],width=luckysheet.postil.resizeXY[2];if(luckysheet.postil.resize=="lm"||luckysheet.postil.resize=="lt"||luckysheet.postil.resize=="lb"){left=x;width=luckysheet.postil.resizeXY[2]-leftchange;if(left>luckysheet.postil.resizeXY[2]+luckysheet.postil.resizeXY[4]-60){left=luckysheet.postil.resizeXY[2]+luckysheet.postil.resizeXY[4]-60;width=luckysheet.postil.resizeXY[2]-(luckysheet.postil.resizeXY[2]+luckysheet.postil.resizeXY[4]-60-luckysheet.postil.resizeXY[0]);}else if(left<=0){left=0;width=luckysheet.postil.resizeXY[2]+luckysheet.postil.resizeXY[0];}}if(luckysheet.postil.resize=="rm"||luckysheet.postil.resize=="rt"||luckysheet.postil.resize=="rb"){width=luckysheet.postil.resizeXY[2]+leftchange;if(width<60){width=60;}else if(width>=luckysheet.postil.currentWinW-luckysheet.postil.resizeXY[4]-22-36){width=luckysheet.postil.currentWinW-luckysheet.postil.resizeXY[4]-22-36;}}if(luckysheet.postil.resize=="mt"||luckysheet.postil.resize=="lt"||luckysheet.postil.resize=="rt"){top=y;height=luckysheet.postil.resizeXY[3]-topchange;if(top>luckysheet.postil.resizeXY[3]+luckysheet.postil.resizeXY[5]-60){top=luckysheet.postil.resizeXY[3]+luckysheet.postil.resizeXY[5]-60;height=luckysheet.postil.resizeXY[3]-(luckysheet.postil.resizeXY[3]+luckysheet.postil.resizeXY[5]-60-luckysheet.postil.resizeXY[1]);}else if(top<=0){top=0;height=luckysheet.postil.resizeXY[3]+luckysheet.postil.resizeXY[1];}}if(luckysheet.postil.resize=="mb"||luckysheet.postil.resize=="lb"||luckysheet.postil.resize=="rb"){height=luckysheet.postil.resizeXY[3]+topchange;if(height<60){height=60;}else if(height>=luckysheet.postil.currentWinH-luckysheet.postil.resizeXY[5]-42-6){height=luckysheet.postil.currentWinH-luckysheet.postil.resizeXY[5]-42-6;}}luckysheet.postil.currentObj.css({"width":width,"height":height,"left":left,"top":top});}else if(!!luckysheet.formula.rangeResize){luckysheet.formula.rangeResizeDraging(event,luckysheet.formula.rangeResizeObj,luckysheet.formula.rangeResizexy,luckysheet.formula.rangeResize,luckysheet.formula.rangeResizeWinW,luckysheet.formula.rangeResizeWinH,ch_width,rh_height);}else if(!!luckysheet.formula.rangeMove){luckysheet.formula.rangeMoveDraging(event,luckysheet.formula.rangeMovexy,luckysheet.formula.rangeMoveObj.data("range"),luckysheet.formula.rangeMoveObj,sheetBarHeight,statisticBarHeight);}else if(!!luckysheet.chart_selection.rangeResize){luckysheet.chart_selection.rangeResizeDraging(event,sheetBarHeight,statisticBarHeight);}else if(!!luckysheet.chart_selection.rangeMove){luckysheet.chart_selection.rangeMoveDraging(event,sheetBarHeight,statisticBarHeight);}},1);}});$(document).mouseup(function(event){//数据窗格主体
  if(luckysheet_select_status){clearTimeout(jfcountfuncTimeout);jfcountfuncTimeout=setTimeout(function(){jfcountfunc();},0);//格式刷
  if(luckysheet.menuButton.luckysheetPaintModelOn){luckysheet.selection.pasteHandlerOfPaintModel(luckysheet_copy_save);if(luckysheet.menuButton.luckysheetPaintSingle){//单次 格式刷
  luckysheet.menuButton.cancelPaintModel();}}}//$("#text-select").remove();
  luckysheet_select_status=false;clearTimeout(jfautoscrollTimeout);luckysheet_scroll_status=false;$("#luckysheet-cell-selected").find(".luckysheet-cs-fillhandle").css("cursor","crosshair").end().find(".luckysheet-cs-draghandle").css("cursor","move");$("#luckysheet-cell-main, #luckysheetTableContent, #luckysheet-sheettable_0").css("cursor","default");//行标题窗格主体
  luckysheet_rows_selected_status=false;//列标题窗格主体
  luckysheet_cols_selected_status=false;luckysheet_model_move_state=false;// if (luckysheetautoadjustmousedown == 1) {
  //     //luckysheet.luckysheetscrollevent(true);
  //     luckysheetautoadjustmousedown = 2;
  // }
  if(luckysheet.formula.functionResizeStatus){luckysheet.formula.functionResizeStatus=false;$("#luckysheet-wa-calculate-size").removeAttr("style");}if(!!luckysheet.freezen.horizontalmovestate){luckysheet.freezen.horizontalmovestate=false;$("#luckysheet-freezebar-horizontal").removeClass("luckysheet-freezebar-active");$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-handle").css("cursor","-webkit-grab");if(luckysheet.freezen.freezenhorizontaldata[4]<=columeHeaderHeight){luckysheet.freezen.cancelFreezenHorizontal();}luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}if(!!luckysheet.freezen.verticalmovestate){luckysheet.freezen.verticalmovestate=false;$("#luckysheet-freezebar-vertical").removeClass("luckysheet-freezebar-active");$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-handle").css("cursor","-webkit-grab");if(luckysheet.freezen.freezenverticaldata[4]<=rowHeaderWidth){luckysheet.freezen.cancelFreezenVertical();}luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}if(!!luckysheet.pivotTable&&luckysheet.pivotTable.movestate){$("#luckysheet-modal-dialog-slider-pivot-move").remove();luckysheet.pivotTable.movestate=false;$("#luckysheet-modal-dialog-pivotTable-list, #luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").css("cursor","default");if(luckysheet.pivotTable.movesave.containerid!="luckysheet-modal-dialog-pivotTable-list"){var $cur=$(event.target).closest(".luckysheet-modal-dialog-slider-config-list");if($cur.length==0){if(luckysheet.pivotTable.movesave.containerid=="luckysheet-modal-dialog-config-value"){luckysheet.pivotTable.resetOrderby(luckysheet.pivotTable.movesave.obj);}luckysheet.pivotTable.movesave.obj.remove();luckysheet.pivotTable.showvaluecolrow();$("#luckysheet-modal-dialog-pivotTable-list").find(".luckysheet-modal-dialog-slider-list-item").each(function(){$(this).find(".luckysheet-slider-list-item-selected").find("i").remove();});$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").find(".luckysheet-modal-dialog-slider-config-item").each(function(){var index=$(this).data("index");$("#luckysheet-modal-dialog-pivotTable-list").find(".luckysheet-modal-dialog-slider-list-item").each(function(){var $seleted=$(this).find(".luckysheet-slider-list-item-selected");if($(this).data("index")==index&&$seleted.find("i").length==0){$seleted.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>');}});});luckysheet.pivotTable.refreshPivotTable();}}}if(!!luckysheet.chartparam.luckysheet_chart_point_config&&luckysheet.chartparam.luckysheet_chart_point_config.movestart){clearTimeout(luckysheet.chartparam.luckysheet_chart_point_config.lagTimeoutclick);luckysheet.chartparam.luckysheet_chart_point_config.mouseupdone=true;luckysheet.chartparam.luckysheet_chart_point_config.movestart=false;$("#luckysheet-chart-point-selectedhelp").hide();luckysheet.chartparam.luckysheet_chart_point_config.objectIndicator=[];luckysheet.chartparam.luckysheet_chart_point_config.changeindex=[];var dataOpt=null,initialpointset=true;var currentOpt=luckysheet.chartparam.luckysheet_chart_point_config.pointchart.getOption();$("#luckysheet-chart-point-config .luckysheet-chart-point-searchitem-c").find(".luckysheet-chart-point-searchitem-active").each(function(){luckysheet.chartparam.luckysheet_chart_point_config.changeindex.push($(this).data("index"));var dataOpt1=currentOpt.series[0].data[$(this).data("index")];if(initialpointset&&!(dataOpt1 instanceof Array)){initialpointset=false;dataOpt=dataOpt1;}});luckysheet.luckysheetactivepointconfig(currentOpt,dataOpt);//var data = luckysheet.chartparam.luckysheet_chart_point_config.pointchart.series[0].data[luckysheet.chartparam.luckysheet_chart_point_config.changeindex[0]]
  }if(luckysheet_sheet_move_status){luckysheet_sheet_move_status=false;luckysheet_sheet_move_data.activeobject.insertBefore($("#luckysheet-sheets-item-clone"));luckysheet_sheet_move_data.activeobject.removeAttr("style");//luckysheet_sheet_move_data.activeobject.css({ "position": "relative", "opacity": 1, "cursor": "pointer", "transition": "all 0.1s", "z-index": "initial" });
  $("#luckysheet-sheets-item-clone").remove();luckysheet_sheet_move_data.cursorobject.css({"cursor":"pointer"});luckysheet_sheet_move_data={};luckysheet.sheetmanage.reOrderAllSheet();}clearTimeout(luckysheet.chartparam.luckysheetCurrentChartMoveTimeout);//图表拖动 chartMix
  if(luckysheet.chartparam.luckysheetCurrentChartMove){luckysheet.chartparam.luckysheetCurrentChartMove=false;if(luckysheet.chartparam.luckysheetInsertChartTosheetChange){//myTop, myLeft: 本次的chart框位置，scrollLeft,scrollTop: 上一次的滚动条位置
  var myTop=luckysheet.chartparam.luckysheetCurrentChartMoveObj.css("top"),myLeft=luckysheet.chartparam.luckysheetCurrentChartMoveObj.css("left"),scrollLeft=$("#luckysheet-cell-main").scrollLeft(),scrollTop=$("#luckysheet-cell-main").scrollTop();//点击时候存储的信息，即上一次操作结束的图表信息，x,y: chart框位置，scrollLeft1,scrollTop1: 滚动条位置
  var x=luckysheet.chartparam.luckysheetCurrentChartMoveXy[2];var y=luckysheet.chartparam.luckysheetCurrentChartMoveXy[3];var scrollLeft1=luckysheet.chartparam.luckysheetCurrentChartMoveXy[4];var scrollTop1=luckysheet.chartparam.luckysheetCurrentChartMoveXy[5];var chart_id=luckysheet.chartparam.luckysheetCurrentChartMoveObj.find(".luckysheet-modal-dialog-content").attr("id");var sheetIndex=!!window.store&&store.state.chartSetting.chartList[chart_id].sheetIndex;//去除chartobj,改用chart_id代替即可定位到此图表
  luckysheet.jfredo.push({"type":"moveChart","chart_id":chart_id,"sheetIndex":sheetIndex,"myTop":myTop,"myLeft":myLeft,"scrollTop":scrollTop,"scrollLeft":scrollLeft,"x":x,"y":y,"scrollTop1":scrollTop1,"scrollLeft1":scrollLeft1});//在store中更新数据
  !!window.store&&store.commit({type:"updateChartItem",key:"left",value:myLeft,chartId:chart_id});!!window.store&&store.commit({type:"updateChartItem",key:"top",value:myTop,chartId:chart_id});// luckysheet.sheetmanage.saveChart({ "chart_id": chart_id, "sheetIndex": sheetIndex, "top": myTop, "left": myLeft });
  //存储滚动条位置
  luckysheet.server.saveParam("c",sheetIndex,{"left":myLeft,"top":myTop,"scrollTop":scrollTop,"scrollLeft":scrollLeft},{"op":"xy","cid":chart_id});//协同编辑时可能影响用户操作，可以考虑不存储滚动条位置（google sheet没有存储滚动条位置）
  // luckysheet.server.saveParam("c", sheetIndex, { "left":myLeft, "top":myTop }, { "op":"xy", "cid": chart_id});
  }}if(!!luckysheet.formula.rangeResize){luckysheet.formula.rangeResizeDragged(event,luckysheet.formula.rangeResizeObj,luckysheet.formula.rangeResize,luckysheet.formula.rangeResizexy,luckysheet.formula.rangeResizeWinW,luckysheet.formula.rangeResizeWinH);}//图表改变大小 chartMix
  if(!!luckysheet.chartparam.luckysheetCurrentChartResize){luckysheet.chartparam.luckysheetCurrentChartResize=null;if(luckysheet.chartparam.luckysheetInsertChartTosheetChange){var myHeight=luckysheet.chartparam.luckysheetCurrentChartResizeObj.height(),myWidth=luckysheet.chartparam.luckysheetCurrentChartResizeObj.width(),scrollLeft=$("#luckysheet-cell-main").scrollLeft(),scrollTop=$("#luckysheet-cell-main").scrollTop();var myTop=luckysheet.chartparam.luckysheetCurrentChartMoveObj.css("top"),myLeft=luckysheet.chartparam.luckysheetCurrentChartMoveObj.css("left");var chart_id=luckysheet.chartparam.luckysheetCurrentChartResizeObj.find(".luckysheet-modal-dialog-content").attr("id");var sheetIndex=!!window.store&&store.state.chartSetting.chartList[chart_id].sheetIndex;var myWidth1=luckysheet.chartparam.luckysheetCurrentChartResizeXy[2];var myHeight1=luckysheet.chartparam.luckysheetCurrentChartResizeXy[3];var x=luckysheet.chartparam.luckysheetCurrentChartResizeXy[4];//增加上一次的位置x，y
  var y=luckysheet.chartparam.luckysheetCurrentChartResizeXy[5];var scrollLeft1=luckysheet.chartparam.luckysheetCurrentChartResizeXy[6];var scrollTop1=luckysheet.chartparam.luckysheetCurrentChartResizeXy[7];luckysheet.jfredo.push({"type":"resizeChart","chart_id":chart_id,"sheetIndex":sheetIndex,"myTop":myTop,"myLeft":myLeft,"myHeight":myHeight,"myWidth":myWidth,"scrollTop":scrollTop,"scrollLeft":scrollLeft,"x":x,"y":y,"myWidth1":myWidth1,"myHeight1":myHeight1,"scrollTop1":scrollTop1,"scrollLeft1":scrollLeft1});!!window.store&&store.commit({type:"updateChartItem",key:"height",value:myHeight,chartId:chart_id});!!window.store&&store.commit({type:"updateChartItem",key:"width",value:myWidth,chartId:chart_id});!!window.store&&store.commit({type:"updateChartItem",key:"left",value:myLeft,chartId:chart_id});!!window.store&&store.commit({type:"updateChartItem",key:"top",value:myTop,chartId:chart_id});//加上滚动条的位置
  // luckysheet.sheetmanage.saveChart({ "chart_id": chart_id, "sheetIndex": sheetIndex, "height": myHeight, "width": myWidth, "top": myTop, "left": myLeft, "scrollTop": scrollTop, "scrollLeft": scrollLeft });
  luckysheet.server.saveParam("c",sheetIndex,{"width":myWidth,"height":myHeight,"top":myTop,"left":myLeft,"scrollTop":scrollTop,"scrollLeft":scrollLeft},{"op":"wh","cid":chart_id});// luckysheet.server.saveParam("c", sheetIndex, { "width":myWidth, "height":myHeight, "top": myTop, "left": myLeft }, { "op":"wh", "cid": chart_id});
  }}//批注框 移动
  if(luckysheet.postil.move){luckysheet.postil.move=false;var ps_id=luckysheet.postil.currentObj.closest(".luckysheet-postil-show").attr("id");var ps_r=ps_id.split("luckysheet-postil-show_")[1].split("_")[0];var ps_c=ps_id.split("luckysheet-postil-show_")[1].split("_")[1];var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var rc=[];d[ps_r][ps_c].ps.left=luckysheet.postil.currentObj.position().left;d[ps_r][ps_c].ps.top=luckysheet.postil.currentObj.position().top;d[ps_r][ps_c].ps.value=luckysheet.postil.currentObj.find(".formulaInputFocus").text();rc.push(ps_r+"_"+ps_c);luckysheet.postil.ref(d,rc);$("#"+ps_id).remove();if(d[ps_r][ps_c].ps.isshow){luckysheet.postil.buildPs(ps_r,ps_c,d[ps_r][ps_c].ps);$("#"+ps_id).addClass("luckysheet-postil-show-active");$("#"+ps_id).find(".luckysheet-postil-dialog-resize").show();}else {luckysheet.postil.editPs(ps_r,ps_c);}}//批注框 改变大小
  if(!!luckysheet.postil.resize){luckysheet.postil.resize=null;var ps_id=luckysheet.postil.currentObj.closest(".luckysheet-postil-show").attr("id");var ps_r=ps_id.split("luckysheet-postil-show_")[1].split("_")[0];var ps_c=ps_id.split("luckysheet-postil-show_")[1].split("_")[1];var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var rc=[];d[ps_r][ps_c].ps.left=luckysheet.postil.currentObj.position().left;d[ps_r][ps_c].ps.top=luckysheet.postil.currentObj.position().top;d[ps_r][ps_c].ps.width=luckysheet.postil.currentObj.outerWidth();d[ps_r][ps_c].ps.height=luckysheet.postil.currentObj.outerHeight();d[ps_r][ps_c].ps.value=luckysheet.postil.currentObj.find(".formulaInputFocus").text();rc.push(ps_r+"_"+ps_c);luckysheet.postil.ref(d,rc);$("#"+ps_id).remove();if(d[ps_r][ps_c].ps.isshow){luckysheet.postil.buildPs(ps_r,ps_c,d[ps_r][ps_c].ps);$("#"+ps_id).addClass("luckysheet-postil-show-active");$("#"+ps_id).find(".luckysheet-postil-dialog-resize").show();}else {luckysheet.postil.editPs(ps_r,ps_c);}}//改变行高
  if(luckysheet_rows_change_size){luckysheet_rows_change_size=false;$("#luckysheet-change-size-line").hide();$("#luckysheet-rows-change-size").css("opacity",0);$("#luckysheet-sheettable, #luckysheet-rows-h, #luckysheet-rows-h canvas").css("cursor","default");var mouse=mouseposition(event.pageX,event.pageY);var scrollTop=$("#luckysheet-rows-h").scrollTop();var y=mouse[1]+scrollTop;var winH=$(window).height();var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];if(luckysheetConfigsetting.pointEdit){//编辑器qksheet表格编辑状态
  var size=(y+3)/luckysheetConfigsetting.pointEditZoom-luckysheet_rows_change_size_start[0];if((y+3)/luckysheetConfigsetting.pointEditZoom-luckysheet_rows_change_size_start[0]<19){size=19;}if(y/luckysheetConfigsetting.pointEditZoom>=winH-200+scrollTop){size=winW-200-luckysheet_rows_change_size_start[0]+scrollTop;}}else {var size=y+3-luckysheet_rows_change_size_start[0];if(y+3-luckysheet_rows_change_size_start[0]<19){size=19;}if(y>=winH-200+scrollTop){size=winW-200-luckysheet_rows_change_size_start[0]+scrollTop;}}var cfg=$.extend(true,{},config);if(cfg["rowlen"]==null){cfg["rowlen"]={};}cfg["rowlen"][luckysheet_rows_change_size_start[1]]=Math.ceil(size);if(clearjfundo){luckysheet.jfundo=[];luckysheet.jfredo.push({"type":"resize","ctrlType":"resizeR","config":$.extend(true,{},config),"curconfig":$.extend(true,{},cfg),"sheetIndex":luckysheet.currentSheetIndex});}//config
  config=cfg;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,cfg["rowlen"],{"k":"rowlen"});luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,null);// if ($("#luckysheet-filter-options-sheet" + luckysheet.currentSheetIndex).length > 0) {
  //     var $t = $("#luckysheet-filter-options-sheet" + luckysheet.currentSheetIndex).find(".luckysheet-filter-options").eq(0);
  //     var st_r = $t.data("str"), ed_r = $t.data("edr"), cindex = $t.data("cindex"), st_c = $t.data("stc"), ed_c = $t.data("edc");
  //     luckysheet.filterseletedbyindex(st_r, ed_r, st_c, ed_c);
  // }
  //luckysheet.cleargridelement(event);
  }//改变列宽
  if(luckysheet_cols_change_size){luckysheet_cols_change_size=false;$("#luckysheet-change-size-line").hide();$("#luckysheet-cols-change-size").css("opacity",0);$("#luckysheet-sheettable, #luckysheet-cols-h-c, .luckysheet-cols-h-cells, .luckysheet-cols-h-cells canvas").css("cursor","default");var mouse=mouseposition(event.pageX,event.pageY);var scrollLeft=$("#luckysheet-cols-h-c").scrollLeft();var x=mouse[0]+scrollLeft;var winW=$(window).width();var row_index=visibledatarow.length-1,row=visibledatarow[row_index],row_pre=0;var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];if(luckysheetConfigsetting.pointEdit){//编辑器qksheet表格编辑状态
  var size=(x+3)/luckysheetConfigsetting.pointEditZoom-luckysheet_cols_change_size_start[0];}else {var size=x+3-luckysheet_cols_change_size_start[0];}var firstcolumlen=defaultcollen;if(config["columlen"]!=null&&config["columlen"][luckysheet_cols_change_size_start[1]]!=null){firstcolumlen=config["columlen"][luckysheet_cols_change_size_start[1]];}if(Math.abs(size-firstcolumlen)<3){return;}if(luckysheetConfigsetting.pointEdit){//编辑器qksheet表格编辑状态
  if((x+3)/luckysheetConfigsetting.pointEditZoom-luckysheet_cols_change_size_start[0]<30){size=30;}if(x/luckysheetConfigsetting.pointEditZoom>=winW-100+scrollLeft){size=winW-100-luckysheet_cols_change_size_start[0]+scrollLeft;}}else {if(x+3-luckysheet_cols_change_size_start[0]<30){size=30;}if(x>=winW-100+scrollLeft){size=winW-100-luckysheet_cols_change_size_start[0]+scrollLeft;}}var cfg=$.extend(true,{},config);if(cfg["columlen"]==null){cfg["columlen"]={};}cfg["columlen"][luckysheet_cols_change_size_start[1]]=Math.ceil(size);if(clearjfundo){luckysheet.jfundo=[];luckysheet.jfredo.push({"type":"resize","ctrlType":"resizeC","config":$.extend(true,{},config),"curconfig":$.extend(true,{},cfg),"sheetIndex":luckysheet.currentSheetIndex});}//config
  config=cfg;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,cfg["columlen"],{"k":"columlen"});luckysheet.jfrefreshgrid_rhcw(null,luckysheet.flowdata[0].length);// if ($("#luckysheet-filter-options-sheet" + luckysheet.currentSheetIndex).length > 0) {
  //     var $t = $("#luckysheet-filter-options-sheet" + luckysheet.currentSheetIndex).find(".luckysheet-filter-options").eq(0);
  //     var st_r = $t.data("str"), ed_r = $t.data("edr"), cindex = $t.data("cindex"), st_c = $t.data("stc"), ed_c = $t.data("edc");
  //     luckysheet.filterseletedbyindex(st_r, ed_r, st_c, ed_c);
  // }
  setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);//luckysheet.cleargridelement(event);
  }if(luckysheet.formula.rangeMove){luckysheet.formula.rangeMoveDragged(luckysheet.formula.rangeMoveObj);}//改变选择框的位置并替换目标单元格
  if(luckysheet_cell_selected_move){$("#luckysheet-cell-selected-move").hide();luckysheet_cell_selected_move=false;var mouse=mouseposition(event.pageX,event.pageY);var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var scrollTop=$("#luckysheet-cell-main").scrollTop();var x=mouse[0]+scrollLeft;var y=mouse[1]+scrollTop;var winH=$(window).height()+scrollTop-sheetBarHeight-statisticBarHeight,winW=$(window).width()+scrollLeft;var rowLocation=luckysheet.rowLocation(y),row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col_index=colLocation[2];var row_index_original=luckysheet_cell_selected_move_index[0],col_index_original=luckysheet_cell_selected_move_index[1];if(row_index==row_index_original&&col_index==col_index_original){return;}var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var last=luckysheet_select_save[luckysheet_select_save.length-1];var data=luckysheet.getdatabyselection(last);var cfg=$.extend(true,{},config);if(cfg["merge"]==null){cfg["merge"]={};}if(cfg["rowlen"]==null){cfg["rowlen"]={};}//选区包含部分单元格
  if(luckysheet.hasPartMC(cfg,last["row"][0],last["row"][1],last["column"][0],last["column"][1])){if(luckysheet.isEditMode()){alert("无法对合并单元格执行此操作");}else {luckysheet.tooltip.info('<i class="fa fa-exclamation-triangle"></i>提示',"无法对合并单元格执行此操作");}return;}var row_s=last["row"][0]-row_index_original+row_index,row_e=last["row"][1]-row_index_original+row_index;var col_s=last["column"][0]-col_index_original+col_index,col_e=last["column"][1]-col_index_original+col_index;if(row_s<0||y<0){row_s=0;row_e=last["row"][1]-last["row"][0];}if(col_s<0||x<0){col_s=0;col_e=last["column"][1]-last["column"][0];}if(row_e>=visibledatarow[visibledatarow.length-1]||y>winH){row_s=visibledatarow.length-1-last["row"][1]+last["row"][0];row_e=visibledatarow.length-1;}if(col_e>=visibledatacolumn[visibledatacolumn.length-1]||x>winW){col_s=visibledatacolumn.length-1-last["column"][1]+last["column"][0];col_e=visibledatacolumn.length-1;}//替换的位置包含部分单元格
  if(luckysheet.hasPartMC(cfg,row_s,row_e,col_s,col_e)){if(luckysheet.isEditMode()){alert("无法对合并单元格执行此操作");}else {luckysheet.tooltip.info('<i class="fa fa-exclamation-triangle"></i>提示',"无法对合并单元格执行此操作");}return;}var borderInfoCompute=luckysheet.getBorderInfoCompute(luckysheet.currentSheetIndex);//删除原本位置的数据
  var RowlChange=null;for(var r=last["row"][0];r<=last["row"][1];r++){if(r in cfg["rowlen"]){RowlChange=true;}for(var c=last["column"][0];c<=last["column"][1];c++){var cell=d[r][c];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell){if(cell["mc"].r+"_"+cell["mc"].c in cfg["merge"]){delete cfg["merge"][cell["mc"].r+"_"+cell["mc"].c];}}d[r][c]=null;}}//边框
  if(cfg["borderInfo"]&&cfg["borderInfo"].length>0){var borderInfo=[];for(var i=0;i<cfg["borderInfo"].length;i++){var bd_rangeType=cfg["borderInfo"][i].rangeType;if(bd_rangeType=="range"){var bd_range=cfg["borderInfo"][i].range;var bd_emptyRange=[];for(var j=0;j<bd_range.length;j++){bd_emptyRange=bd_emptyRange.concat(luckysheet.conditionformat.CFSplitRange(bd_range[j],{"row":last["row"],"column":last["column"]},{"row":[row_s,row_e],"column":[col_s,col_e]},"restPart"));}cfg["borderInfo"][i].range=bd_emptyRange;borderInfo.push(cfg["borderInfo"][i]);}else if(bd_rangeType=="cell"){var bd_r=cfg["borderInfo"][i].value.row_index;var bd_c=cfg["borderInfo"][i].value.col_index;if(!(bd_r>=last["row"][0]&&bd_r<=last["row"][1]&&bd_c>=last["column"][0]&&bd_c<=last["column"][1])){borderInfo.push(cfg["borderInfo"][i]);}}}cfg["borderInfo"]=borderInfo;}//替换位置数据更新
  var offsetMC={};for(var r=0;r<data.length;r++){for(var c=0;c<data[0].length;c++){if(borderInfoCompute[r+last["row"][0]+"_"+(c+last["column"][0])]){var bd_obj={"rangeType":"cell","value":{"row_index":r+row_s,"col_index":c+col_s,"l":borderInfoCompute[r+last["row"][0]+"_"+(c+last["column"][0])].l,"r":borderInfoCompute[r+last["row"][0]+"_"+(c+last["column"][0])].r,"t":borderInfoCompute[r+last["row"][0]+"_"+(c+last["column"][0])].t,"b":borderInfoCompute[r+last["row"][0]+"_"+(c+last["column"][0])].b}};if(cfg["borderInfo"]==null){cfg["borderInfo"]=[];}cfg["borderInfo"].push(bd_obj);}var value="";if(data[r]!=null&&data[r][c]!=null){value=data[r][c];}if(luckysheet.getObjType(value)=="object"&&"mc"in value){var mc=$.extend(true,{},value["mc"]);if("rs"in value["mc"]){offsetMC[mc.r+"_"+mc.c]=[r+row_s,c+col_s];value["mc"].r=r+row_s;value["mc"].c=c+col_s;cfg["merge"][r+row_s+"_"+(c+col_s)]=value["mc"];}else {value["mc"].r=offsetMC[mc.r+"_"+mc.c][0];value["mc"].c=offsetMC[mc.r+"_"+mc.c][1];}}d[r+row_s][c+col_s]=value;}}if(RowlChange){cfg=luckysheet.rowlenByRange(d,last["row"][0],last["row"][1],cfg);cfg=luckysheet.rowlenByRange(d,row_s,row_e,cfg);}//条件格式
  var cdformat=$.extend(true,[],luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]);if(cdformat!=null&&cdformat.length>0){for(var i=0;i<cdformat.length;i++){var cdformat_cellrange=cdformat[i].cellrange;var emptyRange=[];for(var j=0;j<cdformat_cellrange.length;j++){var range=luckysheet.conditionformat.CFSplitRange(cdformat_cellrange[j],{"row":last["row"],"column":last["column"]},{"row":[row_s,row_e],"column":[col_s,col_e]},"allPart");emptyRange=emptyRange.concat(range);}cdformat[i].cellrange=emptyRange;}}if(luckysheet_select_save[0].row_focus==luckysheet_select_save[0].row[0]){var rf=row_s;}else {var rf=row_e;}if(luckysheet_select_save[0].column_focus==luckysheet_select_save[0].column[0]){var cf=col_s;}else {var cf=col_e;}var range=[];range.push({"row":last["row"],"column":last["column"]});range.push({"row":[row_s,row_e],"column":[col_s,col_e]});last["row"]=[row_s,row_e];last["column"]=[col_s,col_e];last["row_focus"]=rf;last["column_focus"]=cf;luckysheet.jfrefreshgrid(d,range,cfg,cdformat,RowlChange);luckysheet.selectHightlightShow();$("#luckysheet-sheettable").css("cursor","default");clearTimeout(jfcountfuncTimeout);jfcountfuncTimeout=setTimeout(function(){jfcountfunc();},500);}//图表选区拖拽移动
  if(luckysheet.chart_selection.rangeMove){luckysheet.chart_selection.rangeMoveDragged();}//图表选区拖拽拉伸
  if(!!luckysheet.chart_selection.rangeResize){luckysheet.chart_selection.rangeResizeDragged();}//选区下拉
  if(luckysheet_cell_selected_extend){luckysheet_cell_selected_extend=false;$("#luckysheet-cell-selected-extend").hide();var mouse=mouseposition(event.pageX,event.pageY);var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var scrollTop=$("#luckysheet-cell-main").scrollTop();var x=mouse[0]+scrollLeft-5;var y=mouse[1]+scrollTop-5;var winH=$(window).height()+scrollTop-sheetBarHeight-statisticBarHeight,winW=$(window).width()+scrollLeft;var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];var row_index_original=luckysheet_cell_selected_extend_index[0],col_index_original=luckysheet_cell_selected_extend_index[1];var last=luckysheet_select_save[luckysheet_select_save.length-1];var row_s=last["row"][0],row_e=last["row"][1];var col_s=last["column"][0],col_e=last["column"][1];if(row_s<0||y<0){row_s=0;row_e=last["row"][1]-last["row"][0];}if(col_s<0||x<0){col_s=0;col_e=last["column"][1]-last["column"][0];}if(row_e>=visibledatarow[visibledatarow.length-1]||y>winH){row_s=visibledatarow.length-1-last["row"][1]+last["row"][0];row_e=visibledatarow.length-1;}if(col_e>=visibledatacolumn[visibledatacolumn.length-1]||x>winW){col_s=visibledatacolumn.length-1-last["column"][1]+last["column"][0];col_e=visibledatacolumn.length-1;}//复制范围
  luckysheet.dropCell.copyRange={"row":$.extend(true,[],last["row"]),"column":$.extend(true,[],last["column"])};//applyType
  var typeItemHide=luckysheet.dropCell.typeItemHide();if(!typeItemHide[0]&&!typeItemHide[1]&&!typeItemHide[2]&&!typeItemHide[3]&&!typeItemHide[4]&&!typeItemHide[5]&&!typeItemHide[6]){luckysheet.dropCell.applyType="0";}else {luckysheet.dropCell.applyType="1";}if(Math.abs(row_index_original-row_index)>Math.abs(col_index_original-col_index)){if(!(row_index>=row_s&&row_index<=row_e)){if(luckysheet_select_save[0].top_move>=row_pre){//当往上拖拽时
  luckysheet.dropCell.applyRange={"row":[row_index,last["row"][0]-1],"column":last["column"]};luckysheet.dropCell.direction="up";row_s-=last["row"][0]-row_index;//是否有数据透视表范围
  if(luckysheet.pivotTable.isPivotRange(row_s,col_e)){luckysheet.tooltip.info("无法对所选单元格进行此更改，因为它会影响数据透视表！","");return;}}else {//当往下拖拽时
  luckysheet.dropCell.applyRange={"row":[last["row"][1]+1,row_index],"column":last["column"]};luckysheet.dropCell.direction="down";row_e+=row_index-last["row"][1];//是否有数据透视表范围
  if(luckysheet.pivotTable.isPivotRange(row_e,col_e)){luckysheet.tooltip.info("无法对所选单元格进行此更改，因为它会影响数据透视表！","");return;}}}else {return;}}else {if(!(col_index>=col_s&&col_index<=col_e)){if(luckysheet_select_save[0].left_move>=col_pre){//当往左拖拽时
  luckysheet.dropCell.applyRange={"row":last["row"],"column":[col_index,last["column"][0]-1]};luckysheet.dropCell.direction="left";col_s-=last["column"][0]-col_index;//是否有数据透视表范围
  if(luckysheet.pivotTable.isPivotRange(row_e,col_s)){luckysheet.tooltip.info("无法对所选单元格进行此更改，因为它会影响数据透视表！","");return;}}else {//当往右拖拽时
  luckysheet.dropCell.applyRange={"row":last["row"],"column":[last["column"][1]+1,col_index]};luckysheet.dropCell.direction="right";col_e+=col_index-last["column"][1];//是否有数据透视表范围
  if(luckysheet.pivotTable.isPivotRange(row_e,col_e)){luckysheet.tooltip.info("无法对所选单元格进行此更改，因为它会影响数据透视表！","");return;}}}else {return;}}if(config["merge"]!=null){var hasMc=false;for(var r=last["row"][0];r<=last["row"][1];r++){for(var c=last["column"][0];c<=last["column"][1];c++){var cell=luckysheet.flowdata[r][c];if(cell!=null&&cell.mc!=null){hasMc=true;break;}}}if(hasMc){if(luckysheet.isEditMode()){alert("无法对合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对合并单元格执行此操作","");}return;}for(var r=row_s;r<=row_e;r++){for(var c=col_s;c<=col_e;c++){var cell=luckysheet.flowdata[r][c];if(cell!=null&&cell.mc!=null){hasMc=true;break;}}}if(hasMc){if(luckysheet.isEditMode()){alert("无法对合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对合并单元格执行此操作","");}return;}}last["row"]=[row_s,row_e];last["column"]=[col_s,col_e];luckysheet.dropCell.update();luckysheet.dropCell.createIcon();$("#luckysheet-cell-selected-move").hide();$("#luckysheet-sheettable").css("cursor","default");clearTimeout(jfcountfuncTimeout);jfcountfuncTimeout=setTimeout(function(){jfcountfunc();},500);}});$("#luckysheet-left-top").mousedown(function(event){$("#luckysheet-wa-functionbox-confirm").click();luckysheet_select_status=false;luckysheet_select_save=[{"row":[0,luckysheet.flowdata.length-1],"column":[0,luckysheet.flowdata[0].length-1],"row_focus":0,"column_focus":0}];luckysheet.selectHightlightShow();clearTimeout(jfcountfuncTimeout);jfcountfuncTimeout=setTimeout(function(){jfcountfunc();},500);event.stopPropagation();});var luckysheet_rows_selected_status=false;$("#luckysheet-rows-h").mousedown(function(event){//有批注在编辑时
  luckysheet.postil.removeActivePs();var mouse=mouseposition(event.pageX,event.pageY);var y=mouse[1]+$("#luckysheet-rows-h").scrollTop();var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var col_index=visibledatacolumn.length-1,col=visibledatacolumn[col_index],col_pre=0;$("#luckysheet-rightclick-menu").hide();$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();//mousedown是右键
  if(event.which=="3"){var isright=false;for(var s=0;s<luckysheet_select_save.length;s++){var obj_s=luckysheet_select_save[s];if(obj_s["row"]!=null&&row_index>=obj_s["row"][0]&&row_index<=obj_s["row"][1]&&obj_s["column"][0]==0&&obj_s["column"][1]==luckysheet.flowdata[0].length-1){isright=true;break;}}if(isright){return;}}var top=row_pre,height=row-row_pre-1;var rowseleted=[row_index,row_index];luckysheet_scroll_status=true;//公式相关
  var $input=$("#luckysheet-input-box");if(parseInt($input.css("top"))>0){if(luckysheet.formula.rangestart||luckysheet.formula.rangedrag_column_start||luckysheet.formula.rangedrag_row_start||luckysheet.formula.israngeseleciton()||$("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){//公式选区
  var changeparam=luckysheet.menuButton.mergeMoveMain([0,col_index],rowseleted,{"row_focus":row_index,"column_focus":0},top,height,col_pre,col);if(changeparam!=null){//columnseleted = changeparam[0];
  rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];//left = changeparam[4];
  //width = changeparam[5];
  }if(event.shiftKey){var last=luckysheet.formula.func_selectedrange;var top=0,height=0,rowseleted=[];if(last.top>row_pre){top=row_pre;height=last.top+last.height-row_pre;if(last.row[1]>last.row_focus){last.row[1]=last.row_focus;}rowseleted=[row_index,last.row[1]];}else if(last.top==row_pre){top=row_pre;height=last.top+last.height-row_pre;rowseleted=[row_index,last.row[0]];}else {top=last.top;height=row-last.top-1;if(last.row[0]<last.row_focus){last.row[0]=last.row_focus;}rowseleted=[last.row[0],row_index];}var changeparam=luckysheet.menuButton.mergeMoveMain([0,col_index],rowseleted,{"row_focus":row_index,"column_focus":0},top,height,col_pre,col);if(changeparam!=null){// columnseleted = changeparam[0];
  rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];// left = changeparam[4];
  // width = changeparam[5];
  }last["row"]=rowseleted;last["top_move"]=top;last["height_move"]=height;luckysheet.formula.func_selectedrange=last;}else if(event.ctrlKey&&$("#luckysheet-rich-text-editor").find("span").last().text()!=","){//按住ctrl 选择选区时  先处理上一个选区
  var vText=$("#luckysheet-rich-text-editor").text()+",";if(vText.length>0&&vText.substr(0,1)=="="){vText=luckysheet.formula.functionHTMLGenerate(vText);if(window.getSelection){// all browsers, except IE before version 9
  var currSelection=window.getSelection();luckysheet.formula.functionRangeIndex=[$(currSelection.anchorNode).parent().index(),currSelection.anchorOffset];}else {// Internet Explorer before version 9
  var textRange=document.selection.createRange();luckysheet.formula.functionRangeIndex=textRange;}$("#luckysheet-rich-text-editor").html(vText);luckysheet.formula.canceFunctionrangeSelected();luckysheet.formula.createRangeHightlight();}luckysheet.formula.rangestart=false;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;$("#luckysheet-functionbox-cell").html(vText);luckysheet.formula.rangeHightlightselected($("#luckysheet-rich-text-editor"));//再进行 选区的选择
  luckysheet.formula.israngeseleciton();luckysheet.formula.func_selectedrange={"left":luckysheet.colLocationByIndex(0)[0],"width":luckysheet.colLocationByIndex(0)[1]-luckysheet.colLocationByIndex(0)[0]-1,"top":top,"height":height,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":top,"height_move":height,"row":rowseleted,"column":[0,col_index],"row_focus":row_index,"column_focus":0};}else {luckysheet.formula.func_selectedrange={"left":luckysheet.colLocationByIndex(0)[0],"width":luckysheet.colLocationByIndex(0)[1]-luckysheet.colLocationByIndex(0)[0]-1,"top":top,"height":height,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":top,"height_move":height,"row":rowseleted,"column":[0,col_index],"row_focus":row_index,"column_focus":0};}if(luckysheet.formula.rangestart||luckysheet.formula.rangedrag_column_start||luckysheet.formula.rangedrag_row_start||luckysheet.formula.israngeseleciton()){luckysheet.formula.rangeSetValue({"row":rowseleted,"column":[null,null]});}else if($("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){//if公式生成器
  var range=luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,{"row":rowseleted,"column":[0,col_index]},luckysheet.currentSheetIndex);$("#luckysheet-ifFormulaGenerator-multiRange-dialog input").val(range);}luckysheet.formula.rangedrag_row_start=true;luckysheet.formula.rangestart=false;luckysheet.formula.rangedrag_column_start=false;$("#luckysheet-formula-functionrange-select").css({"left":col_pre,"width":col-col_pre-1,"top":top,"height":height}).show();$("#luckysheet-formula-help-c").hide();luckysheet.luckysheet_count_show(col_pre,top,col-col_pre-1,height,rowseleted,[0,col_index]);setTimeout(function(){var currSelection=window.getSelection();var anchorOffset=currSelection.anchorNode;if($("#luckysheet-search-formula-parm").is(":visible")||$("#luckysheet-search-formula-parm-select").is(":visible")){$editor=$("#luckysheet-rich-text-editor");luckysheet.formula.rangechangeindex=luckysheet.formula.data_parm_index;}else {$editor=$(anchorOffset).closest("div");}var $span=$editor.find("span[rangeindex='"+luckysheet.formula.rangechangeindex+"']");luckysheet.formula.setCaretPosition($span.get(0),0,$span.html().length);},1);return;}else {luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheet_rows_selected_status=true;}}else {luckysheet_rows_selected_status=true;}if(luckysheet_rows_selected_status){if(event.shiftKey){//按住shift点击行索引选取范围
  var last=$.extend(true,{},luckysheet_select_save[luckysheet_select_save.length-1]);//选区最后一个
  var top=0,height=0,rowseleted=[];if(last.top>row_pre){top=row_pre;height=last.top+last.height-row_pre;if(last.row[1]>last.row_focus){last.row[1]=last.row_focus;}rowseleted=[row_index,last.row[1]];}else if(last.top==row_pre){top=row_pre;height=last.top+last.height-row_pre;rowseleted=[row_index,last.row[0]];}else {top=last.top;height=row-last.top-1;if(last.row[0]<last.row_focus){last.row[0]=last.row_focus;}rowseleted=[last.row[0],row_index];}last["row"]=rowseleted;last["top_move"]=top;last["height_move"]=height;luckysheet_select_save[luckysheet_select_save.length-1]=last;}else if(event.ctrlKey){luckysheet_select_save.push({"left":luckysheet.colLocationByIndex(0)[0],"width":luckysheet.colLocationByIndex(0)[1]-luckysheet.colLocationByIndex(0)[0]-1,"top":top,"height":height,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":top,"height_move":height,"row":rowseleted,"column":[0,col_index],"row_focus":row_index,"column_focus":0});}else {luckysheet_select_save=[];luckysheet_select_save.push({"left":luckysheet.colLocationByIndex(0)[0],"width":luckysheet.colLocationByIndex(0)[1]-luckysheet.colLocationByIndex(0)[0]-1,"top":top,"height":height,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":top,"height_move":height,"row":rowseleted,"column":[0,col_index],"row_focus":row_index,"column_focus":0});}luckysheet.selectHightlightShow();if(luckysheet.server.allowUpdate){//允许编辑后的后台更新时
  luckysheet.server.saveParam("mv",luckysheet.currentSheetIndex,luckysheet_select_save);}}$("#luckysheet-helpbox-cell").text(luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,luckysheet_select_save[luckysheet_select_save.length-1]));setTimeout(function(){clearTimeout(jfcountfuncTimeout);jfcountfunc();},101);}).mousemove(function(event){if(luckysheet_rows_selected_status||luckysheet_rows_change_size||luckysheet_select_status){$("#luckysheet-rows-h-hover").hide();return;}var mouse=mouseposition(event.pageX,event.pageY);var y=mouse[1]+$("#luckysheet-rows-h").scrollTop();var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];$("#luckysheet-rows-h-hover").css({"top":row_pre,"height":row-row_pre-1,"display":"block"});if(y<row-1&&y>=row-5){$("#luckysheet-rows-change-size").css({"top":row-3,"opacity":0});}else {//$("#luckysheet-rows-change-size").hide();
  $("#luckysheet-rows-change-size").css("opacity",0);}}).mouseleave(function(event){$("#luckysheet-rows-h-hover").hide();//$("#luckysheet-rows-change-size").hide();
  $("#luckysheet-rows-change-size").css("opacity",0);}).mouseup(function(event){if(event.which==3){if(luckysheet.isEditMode()){//非编辑模式下禁止右键功能框
  return;}$("#luckysheet-cols-rows-shift").hide();luckysheetRightHeadClickIs="row";$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-word").text("行");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-size").text("高");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-left").text("上");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-right").text("下");$("#luckysheet-cols-rows-add").show();$("#luckysheet-cols-rows-data").show();$("#luckysheet-cols-rows-shift").hide();showrightclickmenu($("#luckysheet-rightclick-menu"),$(this).offset().left+46,event.pageY);luckysheet_cols_menu_status=true;//行高默认值
  var cfg=$.extend(true,{},config);if(cfg["rowlen"]==null){cfg["rowlen"]={};}var first_rowlen=cfg["rowlen"][luckysheet_select_save[0].row[0]]==null?luckysheet.defaultrowlen:cfg["rowlen"][luckysheet_select_save[0].row[0]];var isSame=true;for(var i=0;i<luckysheet_select_save.length;i++){var s=luckysheet_select_save[i];var r1=s.row[0],r2=s.row[1];for(var r=r1;r<=r2;r++){var rowlen=cfg["rowlen"][r]==null?luckysheet.defaultrowlen:cfg["rowlen"][r];if(rowlen!=first_rowlen){isSame=false;break;}}}if(isSame){$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val(first_rowlen);}else {$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val("");}}});luckysheet.luckysheet_count_show=function(left,top,width,height,rowseleted,columnseleted){var rowl=rowseleted[1]-rowseleted[0]+1,coll=columnseleted[1]-columnseleted[0]+1;var drawWidth=luckysheetTableContentHW[0],drawHeight=luckysheetTableContentHW[1];var scrollWidth=$("#luckysheet-cell-main").scrollLeft(),scrollHeight=$("#luckysheet-cell-main").scrollTop();if(rowl>=4){var leftv=left-25;if(leftv<0){leftv=left+5;}if(leftv<scrollWidth){leftv=scrollWidth+10;}var topv=top+height/2;if(height>drawHeight){topv=scrollHeight+drawHeight/2;}$("#luckysheet-row-count-show").css({"left":leftv,"top":topv,"display":"block"}).html("<div>"+rowl.toString().split("").join("</div><div>")+"</div><div>行</div>");}else {$("#luckysheet-row-count-show").hide();}if(coll>=4){var topv=top-25;if(topv<0){topv=top+5;}if(topv<scrollHeight){topv=scrollHeight+10;}var leftv=left+width/2;if(width>drawWidth){leftv=scrollWidth+drawWidth/2;}$("#luckysheet-column-count-show").css({"left":leftv,"top":topv,"display":"block"}).text(coll+"列");}else {$("#luckysheet-column-count-show").hide();}};var luckysheet_cols_selected_status=false;$("#luckysheet-cols-h-c").mousedown(function(event){//有批注在编辑时
  luckysheet.postil.removeActivePs();var mouse=mouseposition(event.pageX,event.pageY);var x=mouse[0]+$(this).scrollLeft();var row_index=visibledatarow.length-1,row=visibledatarow[row_index],row_pre=0;var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];orderbyindex=col_index;//排序全局函数
  $("#luckysheet-rightclick-menu").hide();$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();$("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide();//mousedown是右键
  if(event.which=="3"){var isright=false;for(var s=0;s<luckysheet_select_save.length;s++){var obj_s=luckysheet_select_save[s];if(obj_s["column"]!=null&&col_index>=obj_s["column"][0]&&col_index<=obj_s["column"][1]&&obj_s["row"][0]==0&&obj_s["row"][1]==luckysheet.flowdata.length-1){isright=true;break;}}if(isright){return;}}var left=col_pre,width=col-col_pre-1;var columnseleted=[col_index,col_index];// var changeparam = luckysheet.menuButton.mergeMoveMain(columnseleted , [0, row_index], luckysheet_select_save[luckysheet_select_save.length - 1], row_pre, row, left, width);
  // if(changeparam != null){
  //     columnseleted = changeparam[0];
  //     //rowseleted= changeparam[1];
  //     //top = changeparam[2];
  //     //height = changeparam[3];
  //     left = changeparam[4];
  //     width = changeparam[5];
  // }
  luckysheet_scroll_status=true;//公式相关
  var $input=$("#luckysheet-input-box");if(parseInt($input.css("top"))>0){if(luckysheet.formula.rangestart||luckysheet.formula.rangedrag_column_start||luckysheet.formula.rangedrag_row_start||luckysheet.formula.israngeseleciton()||$("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){//公式选区
  var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,[0,row_index],{"row_focus":0,"column_focus":col_index},row_pre,row,left,width);if(changeparam!=null){columnseleted=changeparam[0];//rowseleted= changeparam[1];
  //top = changeparam[2];
  //height = changeparam[3];
  left=changeparam[4];width=changeparam[5];}if(event.shiftKey){var last=luckysheet.formula.func_selectedrange;var left=0,width=0,columnseleted=[];if(last.left>col_pre){left=col_pre;width=last.left+last.width-col_pre;if(last.column[1]>last.column_focus){last.column[1]=last.column_focus;}columnseleted=[col_index,last.column[1]];}else if(last.left==col_pre){left=col_pre;width=last.left+last.width-col_pre;columnseleted=[col_index,last.column[0]];}else {left=last.left;width=col-last.left-1;if(last.column[0]<last.column_focus){last.column[0]=last.column_focus;}columnseleted=[last.column[0],col_index];}var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,[0,row_index],{"row_focus":0,"column_focus":col_index},row_pre,row,left,width);if(changeparam!=null){columnseleted=changeparam[0];//rowseleted= changeparam[1];
  //top = changeparam[2];
  //height = changeparam[3];
  left=changeparam[4];width=changeparam[5];}last["column"]=columnseleted;last["left_move"]=left;last["width_move"]=width;luckysheet.formula.func_selectedrange=last;}else if(event.ctrlKey&&$("#luckysheet-rich-text-editor").find("span").last().text()!=","){//按住ctrl 选择选区时  先处理上一个选区
  var vText=$("#luckysheet-rich-text-editor").text()+",";if(vText.length>0&&vText.substr(0,1)=="="){vText=luckysheet.formula.functionHTMLGenerate(vText);if(window.getSelection){// all browsers, except IE before version 9
  var currSelection=window.getSelection();luckysheet.formula.functionRangeIndex=[$(currSelection.anchorNode).parent().index(),currSelection.anchorOffset];}else {// Internet Explorer before version 9
  var textRange=document.selection.createRange();luckysheet.formula.functionRangeIndex=textRange;}$("#luckysheet-rich-text-editor").html(vText);luckysheet.formula.canceFunctionrangeSelected();luckysheet.formula.createRangeHightlight();}luckysheet.formula.rangestart=false;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;$("#luckysheet-functionbox-cell").html(vText);luckysheet.formula.rangeHightlightselected($("#luckysheet-rich-text-editor"));//再进行 选区的选择
  luckysheet.formula.israngeseleciton();luckysheet.formula.func_selectedrange={"left":left,"width":width,"top":luckysheet.rowLocationByIndex(0)[0],"height":luckysheet.rowLocationByIndex(0)[1]-luckysheet.rowLocationByIndex(0)[0]-1,"left_move":left,"width_move":width,"top_move":row_pre,"height_move":row-row_pre-1,"row":[0,row_index],"column":columnseleted,"row_focus":0,"column_focus":col_index};}else {luckysheet.formula.func_selectedrange={"left":left,"width":width,"top":luckysheet.rowLocationByIndex(0)[0],"height":luckysheet.rowLocationByIndex(0)[1]-luckysheet.rowLocationByIndex(0)[0]-1,"left_move":left,"width_move":width,"top_move":row_pre,"height_move":row-row_pre-1,"row":[0,row_index],"column":columnseleted,"row_focus":0,"column_focus":col_index};}if(luckysheet.formula.rangestart||luckysheet.formula.rangedrag_column_start||luckysheet.formula.rangedrag_row_start||luckysheet.formula.israngeseleciton()){luckysheet.formula.rangeSetValue({"row":[null,null],"column":columnseleted});}else if($("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){//if公式生成器
  var range=luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,{"row":[0,row_index],"column":columnseleted},luckysheet.currentSheetIndex);$("#luckysheet-ifFormulaGenerator-multiRange-dialog input").val(range);}luckysheet.formula.rangedrag_column_start=true;luckysheet.formula.rangestart=false;luckysheet.formula.rangedrag_row_start=false;$("#luckysheet-formula-functionrange-select").css({"left":left,"width":width,"top":row_pre,"height":row-row_pre-1}).show();$("#luckysheet-formula-help-c").hide();luckysheet.luckysheet_count_show(left,row_pre,width,row-row_pre-1,[0,row_index],columnseleted);return;}else {luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheet_cols_selected_status=true;}}else {luckysheet_cols_selected_status=true;}if(luckysheet_cols_selected_status){if(event.shiftKey){//按住shift点击列索引选取范围
  var last=$.extend(true,{},luckysheet_select_save[luckysheet_select_save.length-1]);//选区最后一个
  var left=0,width=0,columnseleted=[];if(last.left>col_pre){left=col_pre;width=last.left+last.width-col_pre;if(last.column[1]>last.column_focus){last.column[1]=last.column_focus;}columnseleted=[col_index,last.column[1]];}else if(last.left==col_pre){left=col_pre;width=last.left+last.width-col_pre;columnseleted=[col_index,last.column[0]];}else {left=last.left;width=col-last.left-1;if(last.column[0]<last.column_focus){last.column[0]=last.column_focus;}columnseleted=[last.column[0],col_index];}last["column"]=columnseleted;last["left_move"]=left;last["width_move"]=width;luckysheet_select_save[luckysheet_select_save.length-1]=last;}else if(event.ctrlKey){//选区添加
  luckysheet_select_save.push({"left":left,"width":width,"top":luckysheet.rowLocationByIndex(0)[0],"height":luckysheet.rowLocationByIndex(0)[1]-luckysheet.rowLocationByIndex(0)[0]-1,"left_move":left,"width_move":width,"top_move":row_pre,"height_move":row-row_pre-1,"row":[0,row_index],"column":columnseleted,"row_focus":0,"column_focus":col_index});}else {luckysheet_select_save=[];luckysheet_select_save.push({"left":left,"width":width,"top":luckysheet.rowLocationByIndex(0)[0],"height":luckysheet.rowLocationByIndex(0)[1]-luckysheet.rowLocationByIndex(0)[0]-1,"left_move":left,"width_move":width,"top_move":row_pre,"height_move":row-row_pre-1,"row":[0,row_index],"column":columnseleted,"row_focus":0,"column_focus":col_index});}luckysheet.selectHightlightShow();if(luckysheet.server.allowUpdate){//允许编辑后的后台更新时
  luckysheet.server.saveParam("mv",luckysheet.currentSheetIndex,luckysheet_select_save);}}$("#luckysheet-helpbox-cell").text(luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,luckysheet_select_save[luckysheet_select_save.length-1]));setTimeout(function(){clearTimeout(jfcountfuncTimeout);jfcountfunc();},101);if(luckysheet_cols_menu_status){$("#luckysheet-rightclick-menu").hide();$("#luckysheet-cols-h-hover").hide();$("#luckysheet-cols-menu-btn").hide();luckysheet_cols_menu_status=false;}event.stopPropagation();}).mousemove(function(event){if(luckysheet_cols_selected_status||luckysheet_select_status){$("#luckysheet-cols-h-hover").hide();$("#luckysheet-cols-menu-btn").hide();return;}if(luckysheet_cols_menu_status||luckysheet_cols_change_size){return;}var mouse=mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cols-h-c").scrollLeft();var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];$("#luckysheet-cols-h-hover").css({"left":col_pre,"width":col-col_pre-1,"display":"block"});$("#luckysheet-cols-menu-btn").css({"left":col-19,"display":"block"});$("#luckysheet-cols-change-size").css({"left":col-5});if(x<col&&x>=col-5){$("#luckysheet-cols-change-size").css({"opacity":0});$("#luckysheet-cols-menu-btn").hide();}else {$("#luckysheet-change-size-line").hide();$("#luckysheet-cols-change-size").css("opacity",0);}}).mouseleave(function(event){if(luckysheet_cols_menu_status||luckysheet_cols_change_size){return;}$("#luckysheet-cols-h-hover").hide();$("#luckysheet-cols-menu-btn").hide();$("#luckysheet-cols-change-size").css("opacity",0);}).mouseup(function(event){if(event.which==3){if(luckysheet.isEditMode()){//非编辑模式下禁止右键功能框
  return;}luckysheetRightHeadClickIs="column";$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-word").text("列");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-size").text("宽");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-left").text("左");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-right").text("右");$("#luckysheet-cols-rows-add").show();$("#luckysheet-cols-rows-data").show();$("#luckysheet-cols-rows-shift").hide();showrightclickmenu($("#luckysheet-rightclick-menu"),event.pageX,$(this).offset().top+18);luckysheet_cols_menu_status=true;//列宽默认值
  var cfg=$.extend(true,{},config);if(cfg["columlen"]==null){cfg["columlen"]={};}var first_collen=cfg["columlen"][luckysheet_select_save[0].column[0]]==null?luckysheet.defaultcollen:cfg["columlen"][luckysheet_select_save[0].column[0]];var isSame=true;for(var i=0;i<luckysheet_select_save.length;i++){var s=luckysheet_select_save[i];var c1=s.column[0],c2=s.column[1];for(var c=c1;c<=c2;c++){var collen=cfg["columlen"][c]==null?luckysheet.defaultcollen:cfg["columlen"][c];if(collen!=first_collen){isSame=false;break;}}}if(isSame){$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val(first_collen);}else {$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val("");}}});var luckysheet_cols_change_size=false,luckysheet_cols_change_size_start=[];$("#luckysheet-cols-change-size").mousedown(function(event){//有批注在编辑时
  luckysheet.postil.removeActivePs();$("#luckysheet-input-box").hide();$("#luckysheet-cols-change-size").css({"opacity":1});var mouse=mouseposition(event.pageX,event.pageY);var scrollLeft=$("#luckysheet-cols-h-c").scrollLeft();var scrollTop=$("#luckysheet-cell-main").scrollTop();var winH=$("#luckysheet-cell-main").height();var x=mouse[0]+scrollLeft;var row_index=visibledatarow.length-1,row=visibledatarow[row_index];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];luckysheet_cols_change_size=true;luckysheet_scroll_status=true;$("#luckysheet-change-size-line").css({"height":winH+scrollTop,"border-width":"0 1px 0 0","top":0,"left":col-3,"width":"1px","display":"block","cursor":"ew-resize"});$("#luckysheet-sheettable, #luckysheet-cols-h-c, .luckysheet-cols-h-cells, .luckysheet-cols-h-cells canvas").css("cursor","ew-resize");luckysheet_cols_change_size_start=[col_pre,col_index];$("#luckysheet-rightclick-menu").hide();$("#luckysheet-cols-h-hover").hide();$("#luckysheet-cols-menu-btn").hide();event.stopPropagation();}).dblclick(function(){luckysheetcolsdbclick();// console.log(luckysheet_cols_dbclick_times, luckysheet_cols_dbclick_timeout);
  // luckysheet_cols_dbclick_times += 1;
  // if(luckysheet_cols_dbclick_times>=2){
  // 	luckysheet_cols_dbclick_times = 0;
  // 	luckysheetcolsdbclick();
  // 	clearTimeout(luckysheet_cols_dbclick_timeout);
  // }
  // luckysheet_cols_dbclick_timeout = setTimeout(function(){
  // 	luckysheet_cols_dbclick_times = 0;
  // }, 300);
  });function luckysheetcolsdbclick(){luckysheet_cols_change_size=false;//$("#luckysheet-change-size-line, #luckysheet-cols-change-size").hide();
  $("#luckysheet-change-size-line").hide();$("#luckysheet-cols-change-size").css("opacity",0);$("#luckysheet-sheettable, #luckysheet-cols-h-c, .luckysheet-cols-h-cells, .luckysheet-cols-h-cells canvas").css("cursor","default");var mouse=mouseposition(event.pageX,event.pageY);var scrollLeft=$("#luckysheet-cols-h-c").scrollLeft();var x=mouse[0]+scrollLeft;var winW=$(window).width();var row_index=visibledatarow.length-1,row=visibledatarow[row_index];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];//console.log(luckysheet_select_save["column"], col_index, luckysheet_select_save["column"][0], col_index, luckysheet_select_save["column"][1]);
  luckysheet_cols_change_size_start=[col_pre,col_index];var dataflow=$("#luckysheetTableContent").get(0).getContext("2d");var cfg=$.extend(true,{},config);var matchColumn={};for(var s=0;s<luckysheet_select_save.length;s++){var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];if(col_index<c1||col_index>c2){if(col_index in matchColumn){//此列已计算过
  continue;}x=-Infinity;var countret=0;var fontsize=13;for(var r=0;r<luckysheet.flowdata.length;r++){if(countret>=15){break;}var value=luckysheet.getcellvalue(r,luckysheet_cols_change_size_start[1],luckysheet.flowdata);var mask=luckysheet.getcellvalue(r,luckysheet_cols_change_size_start[1],luckysheet.flowdata,"m");if(mask!=null){value=mask;}var cell=luckysheet.flowdata[r][luckysheet_cols_change_size_start[1]];if(luckysheet.getObjType(cell)=="object"&&"fs"in cell){if(cell.fs>fontsize){fontsize=cell.fs;}}if(value==null||value.toString().length==0){countret++;continue;}var textMetrics=dataflow.measureText(value).width;if(textMetrics>x){x=textMetrics;}}var size=x+fontsize*1.5;if(x+3<30){size=30;}if(x>=winW-100+scrollLeft){size=winW-100+scrollLeft;}if(cfg["columlen"]==null){cfg["columlen"]={};}cfg["columlen"][luckysheet_cols_change_size_start[1]]=Math.ceil(size);matchColumn[col_index]=1;}else {for(var c=c1;c<=c2;c++){if(c in matchColumn){//此列已计算过
  continue;}x=-Infinity;var countret=0;var fontsize=13;for(var r=0;r<luckysheet.flowdata.length;r++){if(countret>=15){break;}var value=luckysheet.getcellvalue(r,c,luckysheet.flowdata);var cell=luckysheet.flowdata[r][c];if(luckysheet.getObjType(cell)=="object"&&"fs"in cell){if(cell.fs>fontsize){fontsize=cell.fs;}}if(luckysheet.func_methods.isRealNull(value)){countret++;continue;}var textMetrics=dataflow.measureText(value).width;if(textMetrics>x){x=textMetrics;}}var size=x+fontsize*1.5;if(x+3<30){size=30;}if(x>=winW-100+scrollLeft){size=winW-100+scrollLeft;}if(cfg["columlen"]==null){cfg["columlen"]={};}cfg["columlen"][c]=Math.ceil(size);matchColumn[c]=1;}}}// if (luckysheet_select_save[0]["column"] == null || col_index < luckysheet_select_save[0]["column"][0] || col_index > luckysheet_select_save[0]["column"][1]) {
  //     x = -Infinity;
  //     var countret = 0;
  //     var fontsize = 13;
  //     for (var r = 0; r < luckysheet.flowdata.length; r++) {
  //         if (countret >= 15) {
  //             break;
  //         }
  //         var value = luckysheet.getcellvalue(r, luckysheet_cols_change_size_start[1], luckysheet.flowdata);
  //         var mask = luckysheet.getcellvalue(r, luckysheet_cols_change_size_start[1], luckysheet.flowdata, "m");
  //         if(mask != null){
  //             value = mask;
  //         }
  //         var cell = luckysheet.flowdata[r][luckysheet_cols_change_size_start[1]];
  //         if((cell instanceof Object) && "fs" in cell){
  //             if(cell.fs > fontsize){
  //                 fontsize = cell.fs;
  //             }
  //         }
  //         if (value == null || value.toString().length == 0) {
  //             countret++;
  //             continue;
  //         }
  //         var textMetrics = dataflow.measureText(value).width;
  //         if (textMetrics > x) {
  //             x = textMetrics;
  //         }
  //     }
  //     var size = x + fontsize*1.5;
  //     if ((x + 3) < 30) {
  //         size = 30;
  //     }
  //     if (x >= winW - 100 + scrollLeft) {
  //         size = winW - 100 + scrollLeft;
  //     }
  //     if (cfg["columlen"] == null) {
  //         cfg["columlen"] = {};
  //     }
  //     cfg["columlen"][luckysheet_cols_change_size_start[1]] = Math.ceil(size);
  // }
  // else {
  //     for (var c = luckysheet_select_save[0]["column"][0]; c <= luckysheet_select_save[0]["column"][1]; c++) {
  //         x = -Infinity;
  //         var countret = 0;
  //         var fontsize = 13;
  //         for (var r = 0; r < luckysheet.flowdata.length; r++) {
  //             if (countret >= 15) {
  //                 break;
  //             }
  //             var value = luckysheet.getcellvalue(r, c, luckysheet.flowdata);
  //             var cell = luckysheet.flowdata[r][c];
  //             if((cell instanceof Object) && "fs" in cell){
  //                 if(cell.fs > fontsize){
  //                     fontsize = cell.fs;
  //                 }
  //             }
  //             if (value==null || value.toString().length == 0) {
  //                 countret++;
  //                 continue;
  //             }
  //             var textMetrics = dataflow.measureText(value).width;
  //             if (textMetrics > x) {
  //                 x = textMetrics;
  //             }
  //         }
  //         var size = x + fontsize*1.5;;
  //         if ((x + 3) < 30) {
  //             size = 30;
  //         }
  //         if (x >= winW - 100 + scrollLeft) {
  //             size = winW - 100 + scrollLeft;
  //         }
  //         if (cfg["columlen"] == null) {
  //             cfg["columlen"] = {};
  //         }
  //         cfg["columlen"][c] = Math.ceil(size);
  //     }
  // }
  //console.log(luckysheet.flowdata[0].length, luckysheet.flowdata.length, luckysheet.flowdata);
  luckysheet.jfrefreshgridall(luckysheet.flowdata[0].length,luckysheet.flowdata.length,luckysheet.flowdata,cfg,luckysheet_select_save,"resizeC","columlen");//console.log($("luckysheet-filter-options-sheet" + luckysheet.currentSheetIndex).length);
  // if ($("#luckysheet-filter-options-sheet" + luckysheet.currentSheetIndex).length > 0) {
  //     var $t = $("#luckysheet-filter-options-sheet" + luckysheet.currentSheetIndex).find(".luckysheet-filter-options").eq(0);
  //     var st_r = $t.data("str"), ed_r = $t.data("edr"), cindex = $t.data("cindex"), st_c = $t.data("stc"), ed_c = $t.data("edc");
  //     //console.log(st_r, ed_r, st_c, ed_c);
  //     luckysheet.filterseletedbyindex(st_r, ed_r, st_c, ed_c);
  // }
  //luckysheet.cleargridelement();
  }var luckysheet_rows_change_size=false,luckysheet_rows_change_size_start=[];$("#luckysheet-rows-change-size").mousedown(function(event){//有批注在编辑时
  luckysheet.postil.removeActivePs();$("#luckysheet-input-box").hide();$("#luckysheet-rows-change-size").css({"opacity":1});var mouse=mouseposition(event.pageX,event.pageY);var y=mouse[1]+$("#luckysheet-rows-h").scrollTop();var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var winW=$("#luckysheet-cell-main").width();var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];luckysheet_rows_change_size=true;luckysheet_scroll_status=true;$("#luckysheet-change-size-line").css({"height":"1px","border-width":"0 0px 1px 0","top":row-3,"left":0,"width":scrollLeft+winW,"display":"block","cursor":"ns-resize"});$("#luckysheet-sheettable, #luckysheet-rows-h, #luckysheet-rows-h canvas").css("cursor","ns-resize");luckysheet_rows_change_size_start=[row_pre,row_index];$("#luckysheet-rightclick-menu").hide();$("#luckysheet-rows-h-hover").hide();$("#luckysheet-cols-menu-btn").hide();event.stopPropagation();});//改为全局变量
  window.luckysheet_cols_menu_status=false;$("#luckysheet-cols-menu-btn").click(function(event){var $menu=$("#luckysheet-rightclick-menu");var offset=$(this).offset();//console.log(offset);
  $("#luckysheet-cols-rows-shift").show();luckysheetRightHeadClickIs="column";$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-word").text("列");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-left").text("左");$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-right").text("右");$("#luckysheet-cols-rows-add").show();$("#luckysheet-cols-rows-data").hide();$("#luckysheet-cols-rows-shift").show();showrightclickmenu($menu,offset.left,offset.top+18);luckysheet_cols_menu_status=true;});var orderbyindex=0;$("#luckysheetorderbyasc, #luckysheetorderbyasc_t").mousedown(function(event){luckysheet.cleargridelement(event);luckysheet.sortColumnSeletion(orderbyindex,true);luckysheet.selectHightlightShow();});$("#luckysheetorderbydesc, #luckysheetorderbydesc_t").click(function(event){luckysheet.cleargridelement(event);luckysheet.sortColumnSeletion(orderbyindex,false);luckysheet.selectHightlightShow();});//右键功能键
  //复制为json格式字符串，首行为标题
  $("#luckysheet-copy-json-head").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}//复制范围内包含部分合并单元格，提示
  if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);var arr=[];if(getdata.length==0){return;}if(getdata.length==1){var obj={};for(var i=0;i<getdata[0].length;i++){obj[luckysheet.getcellvalue(0,i,getdata)]="";}arr.push(obj);}else {for(var r=1;r<getdata.length;r++){var obj={};for(var c=0;c<getdata[0].length;c++){if(luckysheet.getcellvalue(0,c,getdata)==undefined){obj[""]=luckysheet.getcellvalue(r,c,getdata);}else {obj[luckysheet.getcellvalue(0,c,getdata)]=luckysheet.getcellvalue(r,c,getdata);}}arr.push(obj);}}luckysheet.selection.copybyformat(event,JSON.stringify(arr));});//复制为json格式字符串，无标题，采用ABCD作为标题
  $("#luckysheet-copy-json-nohead").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}//复制范围内包含部分合并单元格，提示
  if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);var arr=[];if(getdata.length==0){return;}var st=luckysheet_select_save[0]["column"][0];for(var r=0;r<getdata.length;r++){var obj={};for(var c=0;c<getdata[0].length;c++){obj[luckysheet.luckysheetchatatABC(c+st)]=luckysheet.getcellvalue(r,c,getdata);}arr.push(obj);}luckysheet.selection.copybyformat(event,JSON.stringify(arr));});//复制为一维数组
  $("#luckysheet-copy-array1").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}//复制范围内包含部分合并单元格，提示
  if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);var arr=[];if(getdata.length==0){return;}for(var r=0;r<getdata.length;r++){for(var c=0;c<getdata[0].length;c++){arr.push(luckysheet.getcellvalue(r,c,getdata));}}luckysheet.selection.copybyformat(event,JSON.stringify(arr));});//复制为二维数组
  $("#luckysheet-copy-array2").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}//复制范围内包含部分合并单元格，提示
  if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);var arr=[];if(getdata.length==0){return;}for(var r=0;r<getdata.length;r++){var a=[];for(var c=0;c<getdata[0].length;c++){a.push(luckysheet.getcellvalue(r,c,getdata));}arr.push(a);}luckysheet.selection.copybyformat(event,JSON.stringify(arr));});//复制为多维数组
  $("#luckysheet-copy-arraymore-confirm").click(function(event){$("body .luckysheet-cols-menu").hide();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}//复制范围内包含部分合并单元格，提示
  if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);var arr=[];if(getdata.length==0){return;}for(var r=0;r<getdata.length;r++){for(var c=0;c<getdata[0].length;c++){arr.push(getdata[r][c]);}}var row=$("#luckysheet-copy-arraymore-row").val(),col=$("#luckysheet-copy-arraymore-col").val();if(row==""&&col==""){luckysheet.selection.copybyformat(event,JSON.stringify(arr));$("body .luckysheet-cols-menu").hide();return;}if(row==""){row=1;}else {row=parseInt(row);if(row==null){row=1;}}if(col==""){col=1;}else {col=parseInt(col);if(col==null){col=1;}}if(row.toString()=="NaN"||col.toString()=="NaN"){if(luckysheet.isEditMode()){alert("请输入正确的数值!");}else {luckysheet.tooltip.info("请输入正确的数值!","");}return;}if(row<1||col<1){if(luckysheet.isEditMode()){alert("行列数不能小于1!");}else {luckysheet.tooltip.info("行列数不能小于1!","");}return;}var arrlen=arr.length,i=0,ret=[];for(var r=0;r<row;r++){var a=[];for(var c=0;c<col;c++){a.push(arr[i++]);if(i>=arrlen){luckysheet.selection.copybyformat(event,JSON.stringify(ret));$("body .luckysheet-cols-menu").hide();return;}}ret.push(a);}luckysheet.selection.copybyformat(event,JSON.stringify(ret));});//复制为对角线
  $("#luckysheet-copy-diagonal").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}//复制范围内包含部分合并单元格，提示
  if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);var arr=[];if(getdata.length==0){return;}var clen=getdata[0].length;for(var r=0;r<getdata.length;r++){if(r>=clen){break;}arr.push(getdata[r][r]);}luckysheet.selection.copybyformat(event,JSON.stringify(arr));});//复制为反对角线
  $("#luckysheet-copy-antidiagonal").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}//复制范围内包含部分合并单元格，提示
  if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);var arr=[];if(getdata.length==0){return;}var clen=getdata[0].length;for(var r=0;r<getdata.length;r++){if(r>=clen){break;}arr.push(getdata[r][clen-r-1]);}luckysheet.selection.copybyformat(event,JSON.stringify(arr));});//复制为对角偏移n列
  $("#luckysheet-copy-diagonaloffset").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}//复制范围内包含部分合并单元格，提示
  if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);var arr=[];if(getdata.length==0){return;}var clen=getdata[0].length,offset=parseInt($("#luckysheet-copy-diagonaloffset-value").val());if(offset.toString()=="NaN"){if(luckysheet.isEditMode()){alert("请输入正确的数值！");}else {luckysheet.tooltip.info("请输入正确的数值！","");}return;}if(offset<0){if(luckysheet.isEditMode()){alert("偏移列不能为负数！");}else {luckysheet.tooltip.info("偏移列不能为负数！","");}return;}if(offset==null){offset=1;}var clen=getdata[0].length;for(var r=0;r<getdata.length;r++){console.log(r,offset,clen);if(r+offset>=clen){break;}arr.push(getdata[r][r+offset]);}luckysheet.selection.copybyformat(event,JSON.stringify(arr));});//复制为布尔值
  $("#luckysheet-copy-boolvalue").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}//复制范围内包含部分合并单元格，提示
  if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);var arr=[];if(getdata.length==0){return;}for(var r=0;r<getdata.length;r++){var a=[];for(var c=0;c<getdata[0].length;c++){var bool=false;if(luckysheet.getObjType(getdata[r][c])=="object"){var v=getdata[r][c].v;}else {var v=getdata[r][c];}if(v==null||v==""){bool=false;}else {v=parseInt(v);if(v==null||v>0){bool=true;}else {bool=false;}}a.push(bool);}arr.push(a);}luckysheet.selection.copybyformat(event,JSON.stringify(arr));});//矩阵操作选区 翻转 上下
  $("#luckysheet-matrix-turn-up").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);if(getdata.length==0){return;}var arr=[];for(var r=getdata.length-1;r>=0;r--){var a=[];for(var c=0;c<getdata[0].length;c++){var value="";if(getdata[r]!=null&&getdata[r][c]!=null){value=getdata[r][c];}a.push(value);}arr.push(a);}luckysheet.editor.controlHandler(arr);});//矩阵操作选区 翻转 左右
  $("#luckysheet-matrix-turn-left").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);if(getdata.length==0){return;}var arr=[];for(var r=0;r<getdata.length;r++){var a=[];for(var c=getdata[0].length-1;c>=0;c--){var value="";if(getdata[r]!=null&&getdata[r][c]!=null){value=getdata[r][c];}a.push(value);}arr.push(a);}luckysheet.editor.controlHandler(arr);});//矩阵操作选区 翻转 顺时针
  $("#luckysheet-matrix-turn-cw").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);if(getdata.length==0){return;}var arr=[];for(var c=0;c<getdata[0].length;c++){var a=[];for(var r=getdata.length-1;r>=0;r--){var value="";if(getdata[r]!=null&&getdata[r][c]!=null){value=getdata[r][c];}a.push(value);}arr.push(a);}luckysheet.editor.controlHandlerD(arr);});//矩阵操作选区 翻转 逆时针
  $("#luckysheet-matrix-turn-anticw").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);if(getdata.length==0){return;}var arr=[];for(var c=getdata[0].length-1;c>=0;c--){var a=[];for(var r=0;r<getdata.length;r++){var value="";if(getdata[r]!=null&&getdata[r][c]!=null){value=getdata[r][c];}a.push(value);}arr.push(a);}luckysheet.editor.controlHandlerD(arr);});//矩阵操作选区 转置
  $("#luckysheet-matrix-turn-trans").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);if(getdata.length==0){return;}var arr=[];for(var c=0;c<getdata[0].length;c++){var a=[];for(var r=0;r<getdata.length;r++){var value="";if(getdata[r]!=null&&getdata[r][c]!=null){value=getdata[r][c];}a.push(value);}arr.push(a);}luckysheet.editor.controlHandlerD(arr);});var jfnqrt=function jfnqrt(x,p){if(x==0)return 0;var x0,x1;x0=x;x1=(p-1)*x0/p+x/(Math.pow(x0,p-1)*p);//利用迭代法求解
  while(Math.abs(x1-x0)>0.000001){x0=x1;x1=(p-1)*x0/p+x/(Math.pow(x0,p-1)*p);}return x1;};//矩阵操作选区 矩阵计算
  $("#luckysheet-matrix-cal-confirm").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);if(getdata.length==0){return;}var caltype=$("#luckysheet-matrix-cal-type").val(),calvalue=parseInt($("#luckysheet-matrix-cal-value").val());if(calvalue.toString()=="NaN"){if(luckysheet.isEditMode()){alert("请输入正确的数值！");}else {luckysheet.tooltip.info("请输入正确的数值！","");}return;}if(calvalue==null){calvalue=2;}var arr=[];for(var r=0;r<getdata.length;r++){var a=[];for(var c=0;c<getdata[0].length;c++){var value="";if(getdata[r]!=null&&getdata[r][c]!=null){value=getdata[r][c];if(parseInt(value)!=null&&getdata[r][c].ct!=undefined&&getdata[r][c].ct.t=="n"){if(caltype=="minus"){value.v=value.v-calvalue;}else if(caltype=="multiply"){value.v=value.v*calvalue;}else if(caltype=="divided"){value.v=luckysheet.numFormat(value.v/calvalue,4);}else if(caltype=="power"){value.v=Math.pow(value.v,calvalue);}else if(caltype=="root"){if(calvalue==2){value.v=luckysheet.numFormat(Math.sqrt(value.v),4);}else if(calvalue==3&&Math.cbrt){value.v=luckysheet.numFormat(Math.cbrt(value.v),4);}else {value.v=luckysheet.numFormat(jfnqrt(value.v,calvalue),4);}}else if(caltype=="log"){value.v=luckysheet.numFormat(Math.log(value.v)*10000/Math.log(Math.abs(calvalue)),4);}else {value.v=value.v+calvalue;}if(value.v==null){value.m="";}else {value.m=value.v.toString();}}}a.push(value);}arr.push(a);}luckysheet.editor.controlHandler(arr);});//矩阵操作选区 删除两端0值 按行
  $("#luckysheet-matrix-delezero-row").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);if(getdata.length==0){return;}var arr=[];var getdatalen=getdata[0].length;for(var r=0;r<getdata.length;r++){var a=[],stdel=true,eddel=true;for(var c=0;c<getdatalen;c++){var value="";if(getdata[r]!=null&&getdata[r][c]!=null){value=getdata[r][c];if((value.v=="0"||value.v==0)&&stdel){continue;}else {stdel=false;}}a.push(value);}var a1=[];if(a.length==getdatalen){a1=a;}else {for(var c=a.length-1;c>=0;c--){var value="";if(a[c]!=null){value=a[c];if((value.v=="0"||value.v==0)&&eddel){continue;}else {eddel=false;}}a1.unshift(value);}var l=getdatalen-a1.length;for(var c1=0;c1<l;c1++){a1.push("");}}arr.push(a1);}luckysheet.editor.controlHandler(arr);});//矩阵操作选区 删除两端0值 按列
  $("#luckysheet-matrix-delezero-column").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);if(getdata.length==0){return;}var arr=[];var getdatalen=getdata.length,collen=getdata[0].length;for(var c=0;c<collen;c++){var a=[],stdel=true,eddel=true;for(var r=0;r<getdatalen;r++){var value="";if(getdata[r]!=null&&getdata[r][c]!=null){value=getdata[r][c];if((value.v=="0"||value.v==0)&&stdel){continue;}else {stdel=false;}}a.push(value);}var a1=[];if(a.length==getdatalen){a1=a;}else {for(var r=a.length-1;r>=0;r--){var value="";if(a[r]!=null){value=a[r];if((value.v=="0"||value.v==0)&&eddel){continue;}else {eddel=false;}}a1.unshift(value);}var l=getdatalen-a1.length;for(var r1=0;r1<l;r1++){a1.push("");}}arr.push(a1);}var arr1=[];for(var c=0;c<arr[0].length;c++){var a=[];for(var r=0;r<arr.length;r++){var value="";if(arr[r]!=null&&arr[r][c]!=null){value=arr[r][c];}a.push(value);}arr1.push(a);}luckysheet.editor.controlHandler(arr1);});//矩阵操作选区 删除重复值 按行
  $("#luckysheet-matrix-delerpt-row").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);if(getdata.length==0){return;}var arr=[];var getdatalen=getdata[0].length;for(var r=0;r<getdata.length;r++){var a=[],repeat={};for(var c=0;c<getdatalen;c++){var value=null;if(getdata[r]!=null&&getdata[r][c]!=null){value=getdata[r][c];if(value.v in repeat){repeat[value.v].push(value);}else {repeat[value.v]=[];repeat[value.v].push(value);}}}for(var c=0;c<getdatalen;c++){var value=null;if(getdata[r]!=null&&getdata[r][c]!=null){value=getdata[r][c];if(repeat[value.v].length==1){a.push(value);}}}var l=getdatalen-a.length;for(var c1=0;c1<l;c1++){a.push(null);}arr.push(a);}luckysheet.editor.controlHandler(arr);});//矩阵操作选区 删除重复值 按列
  $("#luckysheet-matrix-delerpt-column").click(function(event){$("body .luckysheet-cols-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选定区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选定区域执行此操作，请选择单个区域，然后再试","");}return;}var getdata=luckysheet.getdatabyselection(luckysheet_select_save[0]);if(getdata.length==0){return;}var arr=[];var getdatalen=getdata.length,collen=getdata[0].length;for(var c=0;c<collen;c++){var a=[],repeat={};for(var r=0;r<getdatalen;r++){var value=null;if(getdata[r]!=null&&getdata[r][c]!=null){value=getdata[r][c];if(value.v in repeat){repeat[value.v].push(value);}else {repeat[value.v]=[];repeat[value.v].push(value);}}}for(var r=0;r<getdatalen;r++){var value=null;if(getdata[r]!=null&&getdata[r][c]!=null){value=getdata[r][c];if(repeat[value.v].length==1){a.push(value);}}}a1=a;var l=getdatalen-a1.length;for(var r1=0;r1<l;r1++){a1.push(null);}arr.push(a1);}var arr1=[];for(var c=0;c<arr[0].length;c++){var a=[];for(var r=0;r<arr.length;r++){var value=null;if(arr[r]!=null&&arr[r][c]!=null){value=arr[r][c];}a.push(value);}arr1.push(a);}luckysheet.editor.controlHandler(arr1);});$("#luckysheet-icon-undo").click(function(event){luckysheet.controlHistory.redo(event);});$("#luckysheet-icon-redo").click(function(event){luckysheet.controlHistory.undo(event);});var isInitialSheetConfig=false,luckysheetcurrentSheetitem=null,jfdbclicklagTimeout=null;function showsheetconfigmenu(){if(!isInitialSheetConfig){isInitialSheetConfig=true;$("#luckysheetsheetconfigcolorur").spectrum({showPalette:true,preferredFormat:"hex",clickoutFiresChange:false,showInitial:true,showInput:true,flat:true,hideAfterPaletteSelect:false,showSelectionPalette:true,maxPaletteSize:10,cancelText:"取消",chooseText:"确定颜色",togglePaletteMoreText:"更多",togglePaletteLessText:"少于",clearText:"清除颜色选择",noColorSelectedText:"没有颜色被选择",palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)"],["rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)"],["rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)"],["rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)"],["rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"],["#c1232b","#27727b","#fcce10","#e87c25","#b5c334","#fe8463","#9bca63","#fad860","#f3a43b","#60c0dd","#d7504b","#c6e579","#f4e001","#f0805a","#26c0c0","#c12e34","#e6b600","#0098d9","#2b821d","#005eaa","#339ca8","#cda819","#32a487","#3fb1e3","#6be6c1","#626c91","#a0a7e6","#c4ebad","#96dee8"]],change:function change(color){var $input=$(this);if(color!=null){color=color.toHexString();}else {color="rgb(0, 0, 0)";}var oldcolor=null;if(luckysheetcurrentSheetitem.find(".luckysheet-sheets-item-color").length>0){oldcolor=luckysheetcurrentSheetitem.find(".luckysheet-sheets-item-color").css("background-color");}luckysheetcurrentSheetitem.find(".luckysheet-sheets-item-color").remove();luckysheetcurrentSheetitem.append('<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+color+';"></div>');var index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);luckysheetfile[index].color=color;luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,color,{"k":"color"});if(clearjfundo){var redo={};redo["type"]="sheetColor";redo["sheetIndex"]=luckysheet.currentSheetIndex;redo["oldcolor"]=oldcolor;redo["color"]=color;luckysheet.jfundo=[];luckysheet.jfredo.push(redo);}}});$("#luckysheetsheetconfigcolorreset").click(function(){var oldcolor=null;if(luckysheetcurrentSheetitem.find(".luckysheet-sheets-item-color").length>0){oldcolor=luckysheetcurrentSheetitem.find(".luckysheet-sheets-item-color").css("background-color");}luckysheetcurrentSheetitem.find(".luckysheet-sheets-item-color").remove();var index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);luckysheetfile[index].color=null;luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,null,{"k":"color"});if(clearjfundo){var redo={};redo["type"]="sheetColor";redo["sheetIndex"]=luckysheet.currentSheetIndex;redo["oldcolor"]=oldcolor;redo["color"]=null;luckysheet.jfundo=[];luckysheet.jfredo.push(redo);}});}var index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);if(luckysheetfile[index].color!=null&&luckysheetfile[index].color.length>0){$("#luckysheetsheetconfigcolorur").spectrum("set",luckysheetfile[index].color);}//showrightclickmenu($("#luckysheet-rightclick-sheet-menu"), luckysheetcurrentSheetitem.offset().left + 46, event.pageY);
  $("#luckysheetsheetconfigcolorur").parent().find("span, div, button, input, a").addClass("luckysheet-mousedown-cancel");setTimeout(function(){mouseclickposition($("#luckysheet-rightclick-sheet-menu"),luckysheetcurrentSheetitem.offset().left+luckysheetcurrentSheetitem.width(),luckysheetcurrentSheetitem.offset().top-18,"leftbottom");},1);}var luckysheetsheetrightclick=function luckysheetsheetrightclick($t,$cur,e){//var $t = $(this), $cur = $(e.target);
  clearTimeout(jfdbclicklagTimeout);//console.log($cur, $cur.hasClass("luckysheet-sheets-item-name"), $cur.attr("contenteditable"));
  if($cur.hasClass("luckysheet-sheets-item-name")&&$cur.attr("contenteditable")=="true"){return;}if(luckysheet.formula.rangestart||luckysheet.formula.rangedrag_column_start||luckysheet.formula.rangedrag_row_start||luckysheet.formula.israngeseleciton()){//luckysheet.formula.rangeSetValue({ "row": [row_index, row_index], "column": [col_index, col_index] });
  //luckysheet.formula.rangestart = true;
  //this.rangeSetValueTo.parent();
  setTimeout(function(){luckysheet.formula.setCaretPosition(luckysheet.formula.rangeSetValueTo.get(0),0,luckysheet.formula.rangeSetValueTo.text().length);luckysheet.formula.createRangeHightlight();$("#luckysheet-input-box-index").find(".luckysheet-input-box-index-sheettxt").remove().end().prepend("<span class='luckysheet-input-box-index-sheettxt'>"+luckysheet.sheetmanage.getSheetName(luckysheet.formula.rangetosheet)+"!</span>").show();$("#luckysheet-input-box-index").css({"left":$("#luckysheet-input-box").css("left"),"top":parseInt($("#luckysheet-input-box").css("top"))-20+"px","z-index":$("#luckysheet-input-box").css("z-index")});},1);//$("#luckysheet-formula-functionrange-select").css({ "left": col_pre, "width": col - col_pre - 1, "top": row_pre, "height": row - row_pre - 1 }).show();
  }else {$("#luckysheet-input-box").removeAttr("style");$("#luckysheet-formula-functionrange .luckysheet-formula-functionrange-highlight").remove();}$("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active");$t.addClass("luckysheet-sheets-item-active");luckysheet.cleargridelement(e);luckysheet.sheetmanage.changeSheet($t.data("index"));//$("#luckysheet-input-box").hide();
  //console.log(luckysheet.formula.rangestart);
  $("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();if($cur.hasClass("luckysheet-sheets-item-menu")||$cur.hasClass("fa-sort-desc")||e.which=="3"){luckysheetcurrentSheetitem=$cur.closest(".luckysheet-sheets-item");showsheetconfigmenu();}};$("#luckysheet-sheet-area").on("mousedown","div.luckysheet-sheets-item",function(e){if(luckysheet.isEditMode()){// alert("非编辑模式下不允许该操作！");
  return;}var $t=$(this),$cur=$(e.target),$item=$cur.closest(".luckysheet-sheets-item");if(e.which=="3"){luckysheetsheetrightclick($t,$cur,e);luckysheetcurrentSheetitem=$item;showsheetconfigmenu();return;}if($item.hasClass("luckysheet-sheets-item-active")&&$item.find(".luckysheet-sheets-item-name").attr("contenteditable")=="false"){jfdbclicklagTimeout=setTimeout(function(){luckysheet_sheet_move_status=true;luckysheet_sheet_move_data={};luckysheet_sheet_move_data.widthlist=[];$("#luckysheet-sheet-area div.luckysheet-sheets-item:visible").each(function(i){if(i==0){luckysheet_sheet_move_data.widthlist.push(parseInt($(this).outerWidth()));}else {luckysheet_sheet_move_data.widthlist.push(parseInt($(this).outerWidth())+luckysheet_sheet_move_data.widthlist[i-1]);}});luckysheet_sheet_move_data.curindex=$("#luckysheet-sheet-area div.luckysheet-sheets-item").index($item);var x=e.pageX;luckysheet_sheet_move_data.curleft=x-$item.offset().left;luckysheet_sheet_move_data.pageX=x;luckysheet_sheet_move_data.activeobject=$item;luckysheet_sheet_move_data.cursorobject=$cur;var $itemclone=$item.clone().css("visibility","hidden").attr("id","luckysheet-sheets-item-clone");$item.after($itemclone);$item.css({"position":"absolute","opacity":0.8,"cursor":"move","transition":"initial","z-index":10});//$cur.css({ "cursor": "move" });
  },200);}}).on("click","div.luckysheet-sheets-item",function(e){if(luckysheet.isEditMode()){// alert("非编辑模式下不允许该操作！");
  return;}var $t=$(this),$cur=$(e.target);luckysheetsheetrightclick($t,$cur,e);});var luckysheetsheetnameeditor=function luckysheetsheetnameeditor($t){//var $t = $(this);
  $t.attr("contenteditable","true").addClass("luckysheet-mousedown-cancel").data("oldtxt",$t.text());setTimeout(function(){if(document.selection){var range=document.body.createTextRange();range.moveToElementText($t.get(0));range.select();}else if(window.getSelection){var range=document.createRange();range.selectNodeContents($t.get(0));window.getSelection().removeAllRanges();window.getSelection().addRange(range);}},1);};$("#luckysheet-sheet-area").on("dblclick","span.luckysheet-sheets-item-name",function(e){luckysheetsheetnameeditor($(this));});$("#luckysheet-sheet-area").on("blur","span.luckysheet-sheets-item-name",function(e){var $t=$(this);var txt=$t.text(),oldtxt=$t.data("oldtxt");var index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);for(var i=0;i<luckysheetfile.length;i++){if(index!=i&&luckysheetfile[i].name==txt){if(luckysheet.isEditMode()){alert("标签页的名称不能重复！请重新修改");}else {luckysheet.tooltip.info("提示","标签页的名称不能重复！请重新修改");}$t.text(oldtxt).attr("contenteditable","false");return;}}var winW=$(window).width();var c_width=0;$("#luckysheet-sheet-container-c > div.luckysheet-sheets-item:visible").each(function(){c_width+=$(this).outerWidth();});if(c_width>=winW*0.7){$("#luckysheet-sheet-area .luckysheet-sheets-scroll").css("display","inline-block");$("#luckysheet-sheet-container .docs-sheet-fade-left").show();}luckysheetfile[index].name=txt;luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,txt,{"k":"name"});$t.attr("contenteditable","false").removeClass("luckysheet-mousedown-cancel");if(clearjfundo){var redo={};redo["type"]="sheetName";redo["sheetIndex"]=luckysheet.currentSheetIndex;redo["oldtxt"]=oldtxt;redo["txt"]=txt;luckysheet.jfundo=[];luckysheet.jfredo.push(redo);}});$("#luckysheet-sheet-area").on("keydown","span.luckysheet-sheets-item-name",function(e){var kcode=e.keyCode;var $t=$(this);if(kcode==keycode.ENTER){var index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);luckysheetfile[index].name=$t.text();$t.attr("contenteditable","false");}});$("#luckysheetsheetconfigrename").click(function(){luckysheetsheetnameeditor(luckysheetcurrentSheetitem.find("span.luckysheet-sheets-item-name"));$("#luckysheet-input-box").removeAttr("style");$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();});$("#luckysheetsheetconfigshow").click(function(){$("#luckysheet-sheets-m").click();$("#luckysheet-input-box").removeAttr("style");$("#luckysheet-rightclick-sheet-menu").hide();});$("#luckysheetsheetconfigmoveleft").click(function(){//var oldorders = luckysheet.sheetmanage.getCurrentOrder();
  if(luckysheetcurrentSheetitem.prevAll(":visible").length>0){luckysheetcurrentSheetitem.insertBefore(luckysheetcurrentSheetitem.prevAll(":visible").eq(0));luckysheet.sheetmanage.reOrderAllSheet();}$("#luckysheet-input-box").removeAttr("style");$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();//var orders = luckysheet.sheetmanage.getCurrentOrder();
  // if (clearjfundo) {
  //     var redo = {};
  //     redo["type"] = "sheetorder";
  //     luckysheet.jfundo = [];
  //     redo["oldorders"] = oldorders;
  //     redo["orders"] = orders;
  //     luckysheet.jfredo.push(redo);
  // }
  });$("#luckysheetsheetconfigmoveright").click(function(){if(luckysheetcurrentSheetitem.nextAll(":visible").length>0){luckysheetcurrentSheetitem.insertAfter(luckysheetcurrentSheetitem.nextAll(":visible").eq(0));luckysheet.sheetmanage.reOrderAllSheet();}$("#luckysheet-input-box").removeAttr("style");$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();});$("#luckysheetsheetconfigdelete").click(function(e){$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();if($("#luckysheet-sheet-container-c .luckysheet-sheets-item:visible").length<=1){if(luckysheet.isEditMode()){alert("工作薄内至少含有一张可视工作表。若需删除选定的工作表，请先插入一张新工作表或显示一张隐藏的工作表。");}else {luckysheet.tooltip.info("工作薄内至少含有一张可视工作表。若需删除选定的工作表，请先插入一张新工作表或显示一张隐藏的工作表。","");}return;}var index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);luckysheet.tooltip.confirm("是否删除【"+luckysheetfile[index].name+"】？","<span style='color:#9e9e9e;font-size:12px;'>可以通过Ctrl+Z撤销删除</span>",function(){luckysheet.sheetmanage.deleteSheet(luckysheetcurrentSheetitem.data("index"));},null);$("#luckysheet-input-box").removeAttr("style");});$("#luckysheetsheetconfigcopy").click(function(e){//var index = luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);
  luckysheet.sheetmanage.copySheet(luckysheetcurrentSheetitem.data("index"),e);$("#luckysheet-input-box").removeAttr("style");$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();});$("#luckysheetsheetconfighide").click(function(){if($("#luckysheet-sheet-area div.luckysheet-sheets-item:visible").length==1){if(luckysheet.isEditMode()){alert("不能隐藏, 至少保留一个sheet标签");}else {luckysheet.tooltip.info("不能隐藏","至少保留一个sheet标签");}return;}luckysheet.sheetmanage.setSheetHide(luckysheetcurrentSheetitem.data("index"));$("#luckysheet-input-box").removeAttr("style");$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide();});$("#luckysheet-sheets-add").click(function(e){luckysheet.sheetmanage.addNewSheet(e);luckysheet.sheetmanage.locationSheet();// var $c = $("#luckysheet-sheet-container-c"), c_width = $c.width(), winW = $("#"+container).width();
  // $c.scrollLeft(100000000000);
  // if (c_width + $c.scrollLeft() >= winW * 0.7) {
  //     //console.log(c_width, $c.scrollLeft(), winW * 0.7);
  //     $("#luckysheet-sheet-area .luckysheet-sheets-scroll").css("display", "inline-block");
  //     $("#luckysheet-sheet-container .docs-sheet-fade-left").show();
  // }
  //$("#luckysheet-input-box").hide();
  $("#luckysheet-input-box").removeAttr("style");});var sheetscrollani=null,sheetscrollstart=0,sheetscrollend=0,sheetscrollstep=150;$("#luckysheet-sheets-leftscroll").click(function(){var $c=$("#luckysheet-sheet-container-c");sheetscrollstart=$c.scrollLeft();sheetscrollend=$c.scrollLeft()-sheetscrollstep;if(sheetscrollend<=0){$("#luckysheet-sheet-container .docs-sheet-fade-left").hide();}$("#luckysheet-sheet-container .docs-sheet-fade-right").show();clearInterval(sheetscrollani);sheetscrollani=setInterval(function(){//console.log(sheetscrollstart, sheetscrollend);
  sheetscrollstart-=4;$c.scrollLeft(sheetscrollstart);if(sheetscrollstart<=sheetscrollend){clearInterval(sheetscrollani);}},1);});$("#luckysheet-sheets-rightscroll").click(function(){var $c=$("#luckysheet-sheet-container-c");sheetscrollstart=$c.scrollLeft();sheetscrollend=$c.scrollLeft()+sheetscrollstep;if(sheetscrollstart>0){$("#luckysheet-sheet-container .docs-sheet-fade-right").hide();}$("#luckysheet-sheet-container .docs-sheet-fade-left").show();clearInterval(sheetscrollani);sheetscrollani=setInterval(function(){//console.log(sheetscrollstart, sheetscrollend);
  sheetscrollstart+=4;$c.scrollLeft(sheetscrollstart);if(sheetscrollstart>=sheetscrollend){clearInterval(sheetscrollani);}},1);});var initialOpenSheet=true;$("#luckysheet-sheets-m").click(function(e){$("#luckysheet-sheet-list").html("");var item="";for(var i=0;i<luckysheetfile.length;i++){var f=luckysheetfile[i],icon='',style="";//console.log(f.status);
  if(f["status"]==1){icon='<i class="fa fa-check" aria-hidden="true"></i>';}if(f["hide"]==1){icon='<i class="fa fa-low-vision" aria-hidden="true"></i>';style+="color:#BBBBBB;";}if(f["color"]!=null&&f["color"].length>0){style+="border-right:4px solid "+f["color"]+";";}item+=luckysheet.replaceHtml(sheetselectlistitemHTML,{"index":f["index"],"name":f["name"],"icon":icon,"style":style});}if(initialOpenSheet){$("#"+container).append(luckysheet.replaceHtml(sheetselectlistHTML,{"item":item}));$("#luckysheet-sheet-list").on("click",".luckysheet-cols-menuitem",function(e){if(luckysheet.isEditMode()){// luckysheet.tooltip.info("提示", "图表编辑模式下不允许该操作！");
  alert("图表编辑模式下不允许该操作！");return;}var $item=$(this),index=$item.data("index");if($item.data("index")!=luckysheet.currentSheetIndex){luckysheet.sheetmanage.setSheetShow(index);luckysheet.sheetmanage.locationSheet();}});initialOpenSheet=false;}else {$("#luckysheet-sheet-list").html(item);}$t=$("#luckysheet-sheet-list");//$t.find("span.icon").html("");
  //$("#luckysheet-sheet-btn" + luckysheet.currentSheetIndex + " span.icon").html('<i class="fa fa-check" aria-hidden="true"></i>');
  mouseclickposition($t,$(this).offset().left,$(this).offset().top-12,"leftbottom");//$("#luckysheet-input-box").hide();
  $("#luckysheet-input-box").removeAttr("style");//$t.css({"left":"", "top":"", "display":"block"});
  });var luckysheetextendtable=function luckysheetextendtable(type,index,value,direction){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];value=Math.floor(value);var cfg=$.extend(true,{},config);//合并单元格配置变动
  if(cfg["merge"]==null){cfg["merge"]={};}var merge_new={};for(var m in cfg["merge"]){var mc=cfg["merge"][m];var r=mc.r,c=mc.c,rs=mc.rs,cs=mc.cs;if(type=="row"){if(index<r){merge_new[r+value+"_"+c]={"r":r+value,"c":c,"rs":rs,"cs":cs};}else if(index==r){if(direction=="lefttop"){merge_new[r+value+"_"+c]={"r":r+value,"c":c,"rs":rs,"cs":cs};}else {merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs+value,"cs":cs};}}else if(index<r+rs-1){merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs+value,"cs":cs};}else if(index==r+rs-1){if(direction=="lefttop"){merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs+value,"cs":cs};}else {merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs,"cs":cs};}}else {merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs,"cs":cs};}}else if(type=="column"){if(index<c){merge_new[r+"_"+(c+value)]={"r":r,"c":c+value,"rs":rs,"cs":cs};}else if(index==c){if(direction=="lefttop"){merge_new[r+"_"+(c+value)]={"r":r,"c":c+value,"rs":rs,"cs":cs};}else {merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs,"cs":cs+value};}}else if(index<c+cs-1){merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs,"cs":cs+value};}else if(index==c+cs-1){if(direction=="lefttop"){merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs,"cs":cs+value};}else {merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs,"cs":cs};}}else {merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs,"cs":cs};}}}cfg["merge"]=merge_new;//公式配置变动
  var calcChain=file.calcChain;var newCalcChain=[];if(calcChain!=null&&calcChain.length>0){for(var i=0;i<calcChain.length;i++){var calc=$.extend(true,{},calcChain[i]);var calc_r=calc.r,calc_c=calc.c,calc_i=calc.index,calc_funcStr=calc.func[2];if(type=="row"){var functionStr="="+luckysheet.formula.functionStrChange(calc_funcStr,"add","row",direction,index,value);if(d[calc_r][calc_c].f==calc_funcStr){d[calc_r][calc_c].f=functionStr;}calc.func[2]=functionStr;if(direction=="lefttop"){if(calc_r>=index){calc.r+=value;}}else if(direction=="rightbottom"){if(calc_r>index){calc.r+=value;}}newCalcChain.push(calc);}else if(type=="column"){var functionStr="="+luckysheet.formula.functionStrChange(calc_funcStr,"add","col",direction,index,value);if(d[calc_r][calc_c].f==calc_funcStr){d[calc_r][calc_c].f=functionStr;}calc.func[2]=functionStr;if(direction=="lefttop"){if(calc_c>=index){calc.c+=value;}}else if(direction=="rightbottom"){if(calc_c>index){calc.c+=value;}}newCalcChain.push(calc);}}}//筛选配置变动
  var filter_select=file.filter_select;var filter=file.filter;var newFilterObj=null;if(filter_select!=null&&JSON.stringify(filter_select)!="{}"){newFilterObj={"filter_select":null,"filter":null};var f_r1=filter_select.row[0],f_r2=filter_select.row[1];var f_c1=filter_select.column[0],f_c2=filter_select.column[1];if(type=="row"){if(f_r1<index){if(f_r2==index&&direction=="lefttop"){f_r2+=value;}else if(f_r2>index){f_r2+=value;}}else if(f_r1==index){if(direction=="lefttop"){f_r1+=value;f_r2+=value;}else if(direction=="rightbottom"&&f_r2>index){f_r2+=value;}}else {f_r1+=value;f_r2+=value;}if(filter!=null){newFilterObj.filter={};for(var k in filter){var f_rowhidden=filter[k].rowhidden;var f_rowhidden_new={};for(var n in f_rowhidden){n=parseFloat(n);if(n<index){f_rowhidden_new[n]=0;}else if(n==index){if(direction=="lefttop"){f_rowhidden_new[n+value]=0;}else if(direction=="rightbottom"){f_rowhidden_new[n]=0;}}else {f_rowhidden_new[n+value]=0;}}newFilterObj.filter[k]=$.extend(true,{},filter[k]);newFilterObj.filter[k].rowhidden=f_rowhidden_new;newFilterObj.filter[k].str=f_r1;newFilterObj.filter[k].edr=f_r2;}}}else if(type=="column"){if(f_c1<index){if(f_c2==index&&direction=="lefttop"){f_c2+=value;}else if(f_c2>index){f_c2+=value;}}else if(f_c1==index){if(direction=="lefttop"){f_c1+=value;f_c2+=value;}else if(direction=="rightbottom"&&f_c2>index){f_c2+=value;}}else {f_c1+=value;f_c2+=value;}if(filter!=null){newFilterObj.filter={};for(var k in filter){var f_cindex=filter[k].cindex;if(f_cindex==index&&direction=="lefttop"){f_cindex+=value;}else if(f_cindex>index){f_cindex+=value;}newFilterObj.filter[f_cindex-f_c1]=$.extend(true,{},filter[k]);newFilterObj.filter[f_cindex-f_c1].cindex=f_cindex;newFilterObj.filter[f_cindex-f_c1].stc=f_c1;newFilterObj.filter[f_cindex-f_c1].edc=f_c2;}}}newFilterObj.filter_select={"row":[f_r1,f_r2],"column":[f_c1,f_c2]};}if(newFilterObj!=null&&newFilterObj.filter!=null){cfg["rowhidden"]={};for(var k in newFilterObj.filter){var f_rowhidden=newFilterObj.filter[k].rowhidden;for(var n in f_rowhidden){cfg["rowhidden"][n]=0;}}}else {delete cfg["rowhidden"];}//条件格式配置变动
  var CFarr=file.luckysheet_conditionformat_save;var newCFarr=[];if(CFarr!=null&&CFarr.length>0){for(var i=0;i<CFarr.length;i++){var cf_range=CFarr[i].cellrange;var cf_new_range=[];for(var j=0;j<cf_range.length;j++){var CFr1=cf_range[j].row[0],CFr2=cf_range[j].row[1],CFc1=cf_range[j].column[0],CFc2=cf_range[j].column[1];if(type=="row"){if(CFr1<index){if(CFr2==index&&direction=="lefttop"){CFr2+=value;}else if(CFr2>index){CFr2+=value;}}else if(CFr1==index){if(direction=="lefttop"){CFr1+=value;CFr2+=value;}else if(direction=="rightbottom"&&CFr2>index){CFr2+=value;}}else {CFr1+=value;CFr2+=value;}}else if(type=="column"){if(CFc1<index){if(CFc2==index&&direction=="lefttop"){CFc2+=value;}else if(CFc2>index){CFc2+=value;}}else if(CFc1==index){if(direction=="lefttop"){CFc1+=value;CFc2+=value;}else if(direction=="rightbottom"&&CFc2>index){CFc2+=value;}}else {CFc1+=value;CFc2+=value;}}cf_new_range.push({"row":[CFr1,CFr2],"column":[CFc1,CFc2]});}var cf=$.extend(true,{},CFarr[i]);cf.cellrange=cf_new_range;newCFarr.push(cf);}}//交替颜色配置变动
  var AFarr=file.luckysheet_alternateformat_save;var newAFarr=[];if(AFarr!=null&&AFarr.length>0){for(var i=0;i<AFarr.length;i++){var AFr1=AFarr[i].cellrange.row[0],AFr2=AFarr[i].cellrange.row[1],AFc1=AFarr[i].cellrange.column[0],AFc2=AFarr[i].cellrange.column[1];var af=$.extend(true,{},AFarr[i]);if(type=="row"){if(AFr1<index){if(AFr2==index&&direction=="lefttop"){AFr2+=value;}else if(AFr2>index){AFr2+=value;}}else if(AFr1==index){if(direction=="lefttop"){AFr1+=value;AFr2+=value;}else if(direction=="rightbottom"&&AFr2>index){AFr2+=value;}}else {AFr1+=value;AFr2+=value;}}else if(type=="column"){if(AFc1<index){if(AFc2==index&&direction=="lefttop"){AFc2+=value;}else if(AFc2>index){AFc2+=value;}}else if(AFc1==index){if(direction=="lefttop"){AFc1+=value;AFc2+=value;}else if(direction=="rightbottom"&&AFc2>index){AFc2+=value;}}else {AFc1+=value;AFc2+=value;}}af.cellrange={"row":[AFr1,AFr2],"column":[AFc1,AFc2]};newAFarr.push(af);}}//冻结配置变动
  var newFreezen={"freezenhorizontaldata":null,"freezenverticaldata":null};if(luckysheet.freezen.freezenhorizontaldata!=null&&type=="row"){var freezen_scrollTop=luckysheet.freezen.freezenhorizontaldata[2];var freezen_row_st=luckysheet.freezen.freezenhorizontaldata[1]-1;if(freezen_row_st==index&&direction=="lefttop"){freezen_row_st+=value;}else if(freezen_row_st>index){freezen_row_st+=value;}var freezen_top=visibledatarow[freezen_row_st]-2-freezen_scrollTop+columeHeaderHeight;newFreezen.freezenhorizontaldata=[visibledatarow[freezen_row_st],freezen_row_st+1,freezen_scrollTop,luckysheet.freezen.cutVolumn(visibledatarow,freezen_row_st+1),freezen_top];}else {newFreezen.freezenhorizontaldata=luckysheet.freezen.freezenhorizontaldata;}if(luckysheet.freezen.freezenverticaldata!=null&&type=="column"){var freezen_scrollLeft=luckysheet.freezen.freezenverticaldata[2];var freezen_col_st=luckysheet.freezen.freezenverticaldata[1]-1;if(freezen_col_st==index&&direction=="lefttop"){freezen_col_st+=value;}else if(freezen_col_st>index){freezen_col_st+=value;}var freezen_left=visibledatacolumn[freezen_col_st]-2-freezen_scrollLeft+rowHeaderWidth;newFreezen.freezenverticaldata=[visibledatacolumn[freezen_col_st],freezen_col_st+1,freezen_scrollLeft,luckysheet.freezen.cutVolumn(visibledatacolumn,freezen_col_st+1),freezen_left];}else {newFreezen.freezenverticaldata=luckysheet.freezen.freezenverticaldata;}if(type=="row"){var type1="r";//行高配置变动
  if(cfg["rowlen"]!=null){var rowlen_new={};for(var r in cfg["rowlen"]){r=parseFloat(r);if(r<index){rowlen_new[r]=cfg["rowlen"][r];}else if(r==index){if(direction=="lefttop"){rowlen_new[r+value]=cfg["rowlen"][r];}else if(direction=="rightbottom"){rowlen_new[r]=cfg["rowlen"][r];}}else {rowlen_new[r+value]=cfg["rowlen"][r];}}cfg["rowlen"]=rowlen_new;}//空行模板
  var row=[];for(var c=0;c<d[0].length;c++){row.push(null);}//边框
  if(cfg["borderInfo"]&&cfg["borderInfo"].length>0){var borderInfo=[];for(var i=0;i<cfg["borderInfo"].length;i++){var rangeType=cfg["borderInfo"][i].rangeType;if(rangeType=="range"){var borderRange=cfg["borderInfo"][i].range;var emptyRange=[];for(var j=0;j<borderRange.length;j++){var bd_r1=borderRange[j].row[0],bd_r2=borderRange[j].row[1];if(direction=="lefttop"){if(index<=bd_r1){bd_r1+=value;bd_r2+=value;}else if(index<=bd_r2){bd_r2+=value;}}else {if(index<bd_r1){bd_r1+=value;bd_r2+=value;}else if(index<bd_r2){bd_r2+=value;}}if(bd_r2>=bd_r1){emptyRange.push({"row":[bd_r1,bd_r2],"column":borderRange[j].column});}}if(emptyRange.length>0){var bd_obj={"rangeType":"range","borderType":cfg["borderInfo"][i].borderType,"style":cfg["borderInfo"][i].style,"color":cfg["borderInfo"][i].color,"range":emptyRange};borderInfo.push(bd_obj);}}else if(rangeType=="cell"){var row_index=cfg["borderInfo"][i].value.row_index;if(direction=="lefttop"){if(index<=row_index){row_index+=value;}}else {if(index<row_index){row_index+=value;}}cfg["borderInfo"][i].value.row_index=row_index;borderInfo.push(cfg["borderInfo"][i]);}}cfg["borderInfo"]=borderInfo;}var arr=[];for(var r=0;r<value;r++){arr.push(JSON.stringify(row));}if(direction=="lefttop"){if(index==0){eval('d.unshift('+arr.join(",")+')');}else {eval('d.splice('+index+', 0, '+arr.join(",")+')');}}else {eval('d.splice('+(index+1)+', 0, '+arr.join(",")+')');}}else {var type1="c";//行高配置变动
  if(cfg["columlen"]!=null){var columlen_new={};for(var c in cfg["columlen"]){c=parseFloat(c);if(c<index){columlen_new[c]=cfg["columlen"][c];}else if(c==index){if(direction=="lefttop"){columlen_new[c+value]=cfg["columlen"][c];}else if(direction=="rightbottom"){columlen_new[c]=cfg["columlen"][c];}}else {columlen_new[c+value]=cfg["columlen"][c];}}cfg["columlen"]=columlen_new;}//空列模板
  var col=[];for(var r=0;r<d.length;r++){col.push(null);}//边框
  if(cfg["borderInfo"]&&cfg["borderInfo"].length>0){var borderInfo=[];for(var i=0;i<cfg["borderInfo"].length;i++){var rangeType=cfg["borderInfo"][i].rangeType;if(rangeType=="range"){var borderRange=cfg["borderInfo"][i].range;var emptyRange=[];for(var j=0;j<borderRange.length;j++){var bd_c1=borderRange[j].column[0],bd_c2=borderRange[j].column[1];if(direction=="lefttop"){if(index<=bd_c1){bd_c1+=value;bd_c2+=value;}else if(index<=bd_c2){bd_c2+=value;}}else {if(index<bd_c1){bd_c1+=value;bd_c2+=value;}else if(index<bd_c2){bd_c2+=value;}}if(bd_c2>=bd_c1){emptyRange.push({"row":borderRange[j].row,"column":[bd_c1,bd_c2]});}}if(emptyRange.length>0){var bd_obj={"rangeType":"range","borderType":cfg["borderInfo"][i].borderType,"style":cfg["borderInfo"][i].style,"color":cfg["borderInfo"][i].color,"range":emptyRange};borderInfo.push(bd_obj);}}else if(rangeType=="cell"){var col_index=cfg["borderInfo"][i].value.col_index;if(direction=="lefttop"){if(index<=col_index){col_index+=value;}}else {if(index<col_index){col_index+=value;}}cfg["borderInfo"][i].value.col_index=col_index;borderInfo.push(cfg["borderInfo"][i]);}}cfg["borderInfo"]=borderInfo;}for(var r=0;r<d.length;r++){var row=d[r];for(var i=0;i<value;i++){if(direction=="lefttop"){if(index==0){row.unshift(col[r]);}else {row.splice(index,0,col[r]);}}else {row.splice(index+1,0,col[r]);}}}}luckysheet.jfrefreshgrid_adRC(d,cfg,"addRC",{"index":index,"len":value,"direction":direction,"rc":type1,"restore":false},newCalcChain,newFilterObj,newCFarr,newAFarr,newFreezen);var range=null;if(type=="row"){if(direction=="lefttop"){range=[{"row":[index,index+value-1],"column":[0,d[0].length-1]}];}else {range=[{"row":[index+1,index+value],"column":[0,d[0].length-1]}];}}else {if(direction=="lefttop"){range=[{"row":[0,d.length-1],"column":[index,index+value-1]}];}else {range=[{"row":[0,d.length-1],"column":[index+1,index+value]}];}}luckysheet_select_save=range;luckysheet.selectHightlightShow();if(type=="row"){var scrollLeft=$("#luckysheet-cell-main").scrollLeft(),scrollTop=$("#luckysheet-cell-main").scrollTop();var winH=$("#luckysheet-cell-main").height(),winW=$("#luckysheet-cell-main").width();var row=visibledatarow[range[0].row[1]],row_pre=range[0].row[0]-1==-1?0:visibledatarow[range[0].row[0]-1];// var col = visibledatacolumn[range[0].column[1]], col_pre = range[0].column[0] - 1 == -1 ? 0 : visibledatacolumn[range[0].column[0] - 1];
  // if (col - scrollLeft - winW + 20 > 0) {
  //     $("#luckysheet-scrollbar-x").scrollLeft(col - winW + 20);
  // }
  // else if (col_pre - scrollLeft - 20 < 0) {
  //     $("#luckysheet-scrollbar-x").scrollLeft(col_pre - 20);
  // }
  if(row-scrollTop-winH+20>0){$("#luckysheet-scrollbar-y").scrollTop(row-winH+20);}else if(row_pre-scrollTop-20<0){$("#luckysheet-scrollbar-y").scrollTop(row_pre-20);}if(value>30){$("#luckysheet-row-count-show").hide();$("#luckysheet-column-count-show").hide();}}};luckysheet.luckysheetextendtable=luckysheetextendtable;var luckysheetextendData=function luckysheetextendData(rowlen,newData){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var cfg=$.extend(true,{},config);if(cfg["merge"]==null){cfg["merge"]={};}var collen=d[0].length;var addNullData=luckysheet.datagridgrowth([],rowlen,collen);d=d.concat(addNullData);for(var i=0;i<newData.length;i++){var r=newData[i].r,c=newData[i].c,v=newData[i].v;luckysheet.setcellvalue(r,c,d,v);if(v!=null&&v.mc!=null&&v.mc.rs!=null){cfg["merge"][v.mc.r+"_"+v.mc.c]=$.extend(true,{},v.mc);}}//luckysheet.flowdata
  luckysheet.flowdata=d;luckysheet.editor.webWorkerFlowDataCache(luckysheet.flowdata);//worker存数据
  luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].data=d;//config
  config=cfg;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;//行高、列宽刷新
  luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);};luckysheet.luckysheetextendData=luckysheetextendData;//向左增加列，向上增加行
  $("#luckysheet-add-lefttop, #luckysheet-add-lefttop_t").click(function(event){$("#luckysheet-rightclick-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选择区域执行此操作，请选择单个区域，然后再试","");}return;}var $t=$(this),value=$t.parent().find("input").val();if(!luckysheet.func_methods.isRealNum(value)){if(luckysheet.isEditMode()){alert("增加错误, 请输入数字");}else {luckysheet.tooltip.info("增加错误, 请输入数字","");}return;}value=parseInt(value);if(value<1||value>100){if(luckysheet.isEditMode()){alert("增加错误, 增加范围限制在1-100");}else {luckysheet.tooltip.info("增加错误, 增加范围限制在1-100","");}return;}var st_index=luckysheet_select_save[0][luckysheetRightHeadClickIs][0];luckysheetextendtable(luckysheetRightHeadClickIs,st_index,value,"lefttop");});//向右增加列，向下增加行
  $("#luckysheet-add-rightbottom, #luckysheet-add-rightbottom_t").click(function(event){$("#luckysheet-rightclick-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选择区域执行此操作，请选择单个区域，然后再试","");}return;}var $t=$(this),value=$t.parent().find("input").val();if(!luckysheet.func_methods.isRealNum(value)){if(luckysheet.isEditMode()){alert("增加错误, 请输入数字");}else {luckysheet.tooltip.info("增加错误, 请输入数字","");}return;}value=parseInt(value);if(value<1||value>100){if(luckysheet.isEditMode()){alert("增加错误, 增加范围限制在1-100");}else {luckysheet.tooltip.info("增加错误, 增加范围限制在1-100","");}return;}var st_index=luckysheet_select_save[0][luckysheetRightHeadClickIs][1];luckysheetextendtable(luckysheetRightHeadClickIs,st_index,value,"rightbottom");});var luckysheetdeletetable=function luckysheetdeletetable(type,st,ed){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];var slen=ed-st+1;var cfg=$.extend(true,{},config);//合并单元格配置变动
  if(cfg["merge"]==null){cfg["merge"]={};}var merge_new={};for(var m in cfg["merge"]){var mc=cfg["merge"][m];var r=mc.r,c=mc.c,rs=mc.rs,cs=mc.cs;if(type=="row"){if(r<st){if(r+rs-1<st){merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs,"cs":cs};}else if(r+rs-1>=st&&r+rs-1<ed){merge_new[r+"_"+c]={"r":r,"c":c,"rs":st-r,"cs":cs};}else if(r+rs-1>=ed){merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs-slen,"cs":cs};}}else if(r>=st&&r<=ed){if(r+rs-1>ed){merge_new[st+"_"+c]={"r":st,"c":c,"rs":r+rs-1-ed,"cs":cs};}}else if(r>ed){merge_new[r-slen+"_"+c]={"r":r-slen,"c":c,"rs":rs,"cs":cs};}}else if(type=="column"){if(c<st){if(c+cs-1<st){merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs,"cs":cs};}else if(c+cs-1>=st&&c+cs-1<ed){merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs,"cs":st-c};}else if(c+cs-1>=ed){merge_new[r+"_"+c]={"r":r,"c":c,"rs":rs,"cs":cs-slen};}}else if(c>=st&&c<=ed){if(c+cs-1>ed){merge_new[r+"_"+st]={"r":r,"c":st,"rs":rs,"cs":c+cs-1-ed};}}else if(c>ed){merge_new[r+"_"+(c-slen)]={"r":r,"c":c-slen,"rs":rs,"cs":cs};}}}cfg["merge"]=merge_new;//公式配置变动
  var calcChain=file.calcChain;var newCalcChain=[];if(calcChain!=null&&calcChain.length>0){for(var i=0;i<calcChain.length;i++){var calc=$.extend(true,{},calcChain[i]);var calc_r=calc.r,calc_c=calc.c,calc_i=calc.index,calc_funcStr=calc.func[2];if(type=="row"){if(calc_r<st||calc_r>ed){var functionStr="="+luckysheet.formula.functionStrChange(calc_funcStr,"del","row",null,st,slen);if(d[calc_r][calc_c].f==calc_funcStr){d[calc_r][calc_c].f=functionStr;}calc.func[2]=functionStr;if(calc_r>ed){calc.r=calc_r-slen;}newCalcChain.push(calc);}}else if(type=="column"){if(calc_c<st||calc_c>ed){var functionStr="="+luckysheet.formula.functionStrChange(calc_funcStr,"del","col",null,st,slen);if(d[calc_r][calc_c].f==calc_funcStr){d[calc_r][calc_c].f=functionStr;}calc.func[2]=functionStr;if(calc_c>ed){calc.c=calc_c-slen;}newCalcChain.push(calc);}}}}//筛选配置变动
  var filter_select=file.filter_select;var filter=file.filter;var newFilterObj=null;if(filter_select!=null&&JSON.stringify(filter_select)!="{}"){newFilterObj={"filter_select":null,"filter":null};var f_r1=filter_select.row[0],f_r2=filter_select.row[1];var f_c1=filter_select.column[0],f_c2=filter_select.column[1];if(type=="row"){if(f_r1>ed){f_r1-=slen;f_r2-=slen;newFilterObj.filter_select={"row":[f_r1,f_r2],"column":[f_c1,f_c2]};}else if(f_r1<st){if(f_r2<st);else if(f_r2<=ed){f_r2=st-1;}else {f_r2-=slen;}newFilterObj.filter_select={"row":[f_r1,f_r2],"column":[f_c1,f_c2]};}if(newFilterObj.filter_select!=null&&filter!=null){for(var k in filter){var f_rowhidden=filter[k].rowhidden;var f_rowhidden_new={};for(var n in f_rowhidden){if(n<st){f_rowhidden_new[n]=0;}else if(n>ed){f_rowhidden_new[n-slen]=0;}}if(JSON.stringify(f_rowhidden_new)!="{}"){if(newFilterObj.filter==null){newFilterObj.filter={};}newFilterObj.filter[k]=$.extend(true,{},filter[k]);newFilterObj.filter[k].rowhidden=f_rowhidden_new;newFilterObj.filter[k].str=f_r1;newFilterObj.filter[k].edr=f_r2;}}}}else if(type=="column"){if(f_c1>ed){f_c1-=slen;f_c2-=slen;newFilterObj.filter_select={"row":[f_r1,f_r2],"column":[f_c1,f_c2]};}else if(f_c1<st){if(f_c2<st);else if(f_c2<=ed){f_c2=st-1;}else {f_c2-=slen;}newFilterObj.filter_select={"row":[f_r1,f_r2],"column":[f_c1,f_c2]};}else {if(f_c2>ed){f_c1=st;f_c2-=slen;newFilterObj.filter_select={"row":[f_r1,f_r2],"column":[f_c1,f_c2]};}}if(newFilterObj.filter_select!=null&&filter!=null){for(var k in filter){var f_cindex=filter[k].cindex;if(f_cindex<st){if(newFilterObj.filter==null){newFilterObj.filter={};}newFilterObj.filter[f_cindex-f_c1]=$.extend(true,{},filter[k]);newFilterObj.filter[f_cindex-f_c1].edc=f_c2;}else if(f_cindex>ed){f_cindex-=slen;if(newFilterObj.filter==null){newFilterObj.filter={};}newFilterObj.filter[f_cindex-f_c1]=$.extend(true,{},filter[k]);newFilterObj.filter[f_cindex-f_c1].cindex=f_cindex;newFilterObj.filter[f_cindex-f_c1].stc=f_c1;newFilterObj.filter[f_cindex-f_c1].edc=f_c2;}}}}}if(newFilterObj!=null&&newFilterObj.filter!=null){cfg["rowhidden"]={};for(var k in newFilterObj.filter){var f_rowhidden=newFilterObj.filter[k].rowhidden;for(var n in f_rowhidden){cfg["rowhidden"][n]=0;}}}else {delete cfg["rowhidden"];}//条件格式配置变动
  var CFarr=file.luckysheet_conditionformat_save;var newCFarr=[];if(CFarr!=null&&CFarr.length>0){for(var i=0;i<CFarr.length;i++){var cf_range=CFarr[i].cellrange;var cf_new_range=[];for(var j=0;j<cf_range.length;j++){var CFr1=cf_range[j].row[0],CFr2=cf_range[j].row[1],CFc1=cf_range[j].column[0],CFc2=cf_range[j].column[1];if(type=="row"){if(!(CFr1>=st&&CFr2<=ed)){if(CFr1>ed){CFr1-=slen;CFr2-=slen;}else if(CFr1<st){if(CFr2<st);else if(CFr2<=ed){CFr2=st-1;}else {CFr2-=slen;}}else {if(CFr2>ed){CFr1=st;CFr2-=slen;}}cf_new_range.push({"row":[CFr1,CFr2],"column":[CFc1,CFc2]});}}else if(type=="column"){if(!(CFc1>=st&&CFc2<=ed)){if(CFc1>ed){CFc1-=slen;CFc2-=slen;}else if(CFc1<st){if(CFc2<st);else if(CFc2<=ed){CFc2=st-1;}else {CFc2-=slen;}}else {if(CFc2>ed){CFc1=st;CFc2-=slen;}}cf_new_range.push({"row":[CFr1,CFr2],"column":[CFc1,CFc2]});}}}if(cf_new_range.length>0){var cf=$.extend(true,{},CFarr[i]);cf.cellrange=cf_new_range;newCFarr.push(cf);}}}//交替颜色配置变动
  var AFarr=file.luckysheet_alternateformat_save;var newAFarr=[];if(AFarr!=null&&AFarr.length>0){for(var i=0;i<AFarr.length;i++){var AFr1=AFarr[i].cellrange.row[0],AFr2=AFarr[i].cellrange.row[1],AFc1=AFarr[i].cellrange.column[0],AFc2=AFarr[i].cellrange.column[1];if(type=="row"){if(!(AFr1>=st&&AFr2<=ed)){var af=$.extend(true,{},AFarr[i]);if(AFr1>ed){AFr1-=slen;AFr2-=slen;}else if(AFr1<st){if(AFr2<st);else if(AFr2<=ed){AFr2=st-1;}else {AFr2-=slen;}}else {if(AFr2>ed){AFr1=st;AFr2-=slen;}}af.cellrange={"row":[AFr1,AFr2],"column":[AFc1,AFc2]};newAFarr.push(af);}}else if(type=="column"){if(!(AFc1>=st&&AFc2<=ed)){var af=$.extend(true,{},AFarr[i]);if(AFc1>ed){AFc1-=slen;AFc2-=slen;}else if(AFc1<st){if(AFc2<st);else if(AFc2<=ed){AFc2=st-1;}else {AFc2-=slen;}}else {if(AFc2>ed){AFc1=st;AFc2-=slen;}}af.cellrange={"row":[AFr1,AFr2],"column":[AFc1,AFc2]};newAFarr.push(af);}}}}//冻结配置变动
  var newFreezen={"freezenhorizontaldata":null,"freezenverticaldata":null};if(luckysheet.freezen.freezenhorizontaldata!=null&&type=="row"){var freezen_scrollTop=luckysheet.freezen.freezenhorizontaldata[2];var freezen_st=luckysheet_searcharray(visibledatarow,freezen_scrollTop);if(freezen_st==-1){freezen_st=0;}var freezen_row_st=luckysheet.freezen.freezenhorizontaldata[1]-1;if(freezen_row_st>=st){if(freezen_row_st<ed){freezen_row_st=st-1;}else {freezen_row_st-=slen;}}if(freezen_row_st<freezen_st){freezen_row_st=freezen_st;}var freezen_top=visibledatarow[freezen_row_st]-2-freezen_scrollTop+columeHeaderHeight;newFreezen.freezenhorizontaldata=[visibledatarow[freezen_row_st],freezen_row_st+1,freezen_scrollTop,luckysheet.freezen.cutVolumn(visibledatarow,freezen_row_st+1),freezen_top];}else {newFreezen.freezenhorizontaldata=luckysheet.freezen.freezenhorizontaldata;}if(luckysheet.freezen.freezenverticaldata!=null&&type=="column"){var freezen_scrollLeft=luckysheet.freezen.freezenverticaldata[2];var freezen_st2=luckysheet_searcharray(visibledatacolumn,freezen_scrollLeft);if(freezen_st2==-1){freezen_st2=0;}var freezen_col_st=luckysheet.freezen.freezenverticaldata[1]-1;if(freezen_col_st>=st){if(freezen_col_st<ed){freezen_col_st=st-1;}else {freezen_col_st-=slen;}}if(freezen_col_st<freezen_st2){freezen_col_st=freezen_st2;}var freezen_left=visibledatacolumn[freezen_col_st]-2-freezen_scrollLeft+rowHeaderWidth;newFreezen.freezenverticaldata=[visibledatacolumn[freezen_col_st],freezen_col_st+1,freezen_scrollLeft,luckysheet.freezen.cutVolumn(visibledatacolumn,freezen_col_st+1),freezen_left];}else {newFreezen.freezenverticaldata=luckysheet.freezen.freezenverticaldata;}//主逻辑
  if(type=="row"){var type1="r";//行高配置变动
  if(cfg["rowlen"]==null){cfg["rowlen"]={};}var rowlen_new={};for(var r in cfg["rowlen"]){if(r<st){rowlen_new[r]=cfg["rowlen"][r];}else if(r>ed){rowlen_new[r-slen]=cfg["rowlen"][r];}}cfg["rowlen"]=rowlen_new;//边框配置变动
  if(cfg["borderInfo"]&&cfg["borderInfo"].length>0){var borderInfo=[];for(var i=0;i<cfg["borderInfo"].length;i++){var rangeType=cfg["borderInfo"][i].rangeType;if(rangeType=="range"){var borderRange=cfg["borderInfo"][i].range;var emptyRange=[];for(var j=0;j<borderRange.length;j++){var bd_r1=borderRange[j].row[0],bd_r2=borderRange[j].row[1];for(var r=st;r<=ed;r++){if(r<borderRange[j].row[0]){bd_r1-=1;bd_r2-=1;}else if(r<=borderRange[j].row[1]){bd_r2-=1;}}if(bd_r2>=bd_r1){emptyRange.push({"row":[bd_r1,bd_r2],"column":borderRange[j].column});}}if(emptyRange.length>0){var bd_obj={"rangeType":"range","borderType":cfg["borderInfo"][i].borderType,"style":cfg["borderInfo"][i].style,"color":cfg["borderInfo"][i].color,"range":emptyRange};borderInfo.push(bd_obj);}}else if(rangeType=="cell"){var row_index=cfg["borderInfo"][i].value.row_index;if(row_index<st){borderInfo.push(cfg["borderInfo"][i]);}else if(row_index>ed){cfg["borderInfo"][i].value.row_index=row_index-(ed-st+1);borderInfo.push(cfg["borderInfo"][i]);}}}cfg["borderInfo"]=borderInfo;}//删除选中行
  d.splice(st,slen);if(!luckysheetConfigsetting.pointEdit){//非编辑器qksheet表格编辑状态
  //空白行模板
  var row=[];for(var c=0;c<d[0].length;c++){row.push(null);}//删除多少行，增加多少行空白行                
  for(var r=0;r<slen;r++){d.push(row);}}}else {var type1="c";//列宽配置变动
  if(cfg["columlen"]==null){cfg["columlen"]={};}var columlen_new={};for(var c in cfg["columlen"]){if(c<st){columlen_new[c]=cfg["columlen"][c];}else if(c>ed){columlen_new[c-slen]=cfg["columlen"][c];}}cfg["columlen"]=columlen_new;//边框配置变动
  if(cfg["borderInfo"]&&cfg["borderInfo"].length>0){var borderInfo=[];for(var i=0;i<cfg["borderInfo"].length;i++){var rangeType=cfg["borderInfo"][i].rangeType;if(rangeType=="range"){var borderRange=cfg["borderInfo"][i].range;var emptyRange=[];for(var j=0;j<borderRange.length;j++){var bd_c1=borderRange[j].column[0],bd_c2=borderRange[j].column[1];for(var c=st;c<=ed;c++){if(c<borderRange[j].column[0]){bd_c1-=1;bd_c2-=1;}else if(c<=borderRange[j].column[1]){bd_c2-=1;}}if(bd_c2>=bd_c1){emptyRange.push({"row":borderRange[j].row,"column":[bd_c1,bd_c2]});}}if(emptyRange.length>0){var bd_obj={"rangeType":"range","borderType":cfg["borderInfo"][i].borderType,"style":cfg["borderInfo"][i].style,"color":cfg["borderInfo"][i].color,"range":emptyRange};borderInfo.push(bd_obj);}}else if(rangeType=="cell"){var col_index=cfg["borderInfo"][i].value.col_index;if(col_index<st){borderInfo.push(cfg["borderInfo"][i]);}else if(col_index>ed){cfg["borderInfo"][i].value.col_index=col_index-(ed-st+1);borderInfo.push(cfg["borderInfo"][i]);}}}cfg["borderInfo"]=borderInfo;}//空白列模板
  var addcol=[];if(!luckysheetConfigsetting.pointEdit){//非编辑器qksheet表格编辑状态
  for(var r=0;r<slen;r++){addcol.push(null);}}for(var r=0;r<d.length;r++){var row=[].concat(d[r]);//删除选中列
  row.splice(st,slen);d[r]=row.concat(addcol);}}luckysheet.jfrefreshgrid_adRC(d,cfg,"delRC",{"index":st,"len":ed-st+1,"rc":type1},newCalcChain,newFilterObj,newCFarr,newAFarr,newFreezen);};luckysheet.luckysheetdeletetable=luckysheetdeletetable;//删除选中行列
  $("#luckysheet-del-selected, #luckysheet-del-selected_t").click(function(event){$("#luckysheet-rightclick-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheetRightHeadClickIs=="row"){if(luckysheet.isEditMode()){alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选择区域执行此操作，请选择单个区域，然后再试","");}}else if(luckysheetRightHeadClickIs=="column"){if(luckysheet.isEditMode()){alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选择区域执行此操作，请选择单个区域，然后再试","");}}return;}var st_index=luckysheet_select_save[0][luckysheetRightHeadClickIs][0],ed_index=luckysheet_select_save[0][luckysheetRightHeadClickIs][1];luckysheetdeletetable(luckysheetRightHeadClickIs,st_index,ed_index);});//清除单元格内容
  $("#luckysheet-delete-text").click(function(){$("#luckysheet-rightclick-menu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>0){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];if(luckysheet.hasPartMC(config,r1,r2,c1,c2)){hasPartMC=true;break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];for(var r=r1;r<=r2;r++){for(var c=c1;c<=c2;c++){if(luckysheet.pivotTable.isPivotRange(r,c)){continue;}if(luckysheet.getObjType(d[r][c])=="object"){delete d[r][c]["m"];delete d[r][c]["v"];if(d[r][c]["f"]!=null){delete d[r][c]["f"];luckysheet.formula.delFunctionGroup(r,c,luckysheet.currentSheetIndex);delete d[r][c]["spl"];}}else {d[r][c]=null;}}}}luckysheet.jfrefreshgrid(d,luckysheet_select_save);}});//行高列宽设置
  $("#luckysheet-rows-cols-changesize").click(function(){$("#luckysheet-rightclick-menu").hide();$("#"+container).attr("tabindex",0).focus();var size=parseInt($(this).siblings("input[type='number']").val().trim());if(size<0||size>255){if(luckysheet.isEditMode()){alert("数值必须在0 ~ 255之间");}else {luckysheet.tooltip.info("数值必须在0 ~ 255之间","");}return;}var cfg=$.extend(true,{},config);var type;if(luckysheetRightHeadClickIs=="row"){type="resizeR";if(cfg["rowlen"]==null){cfg["rowlen"]={};}for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0];var r2=luckysheet_select_save[s].row[1];for(var r=r1;r<=r2;r++){cfg["rowlen"][r]=size;}}}else if(luckysheetRightHeadClickIs=="column"){type="resizeC";if(cfg["columlen"]==null){cfg["columlen"]={};}for(var s=0;s<luckysheet_select_save.length;s++){var c1=luckysheet_select_save[s].column[0];var c2=luckysheet_select_save[s].column[1];for(var c=c1;c<=c2;c++){cfg["columlen"][c]=size;}}}if(clearjfundo){luckysheet.jfundo=[];luckysheet.jfredo.push({"type":"resize","ctrlType":type,"config":$.extend(true,{},config),"curconfig":$.extend(true,{},cfg),"sheetIndex":luckysheet.currentSheetIndex});}//config
  config=cfg;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;if(luckysheetRightHeadClickIs=="row"){luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,cfg["rowlen"],{"k":"rowlen"});luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,null);}else if(luckysheetRightHeadClickIs=="column"){luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,cfg["columlen"],{"k":"columlen"});luckysheet.jfrefreshgrid_rhcw(null,luckysheet.flowdata[0].length);}});var luckysheet_sort_initial=true,luckysheet_model_move_state=false,luckysheet_model_xy=[0,0],luckysheet_model_move_obj=null;$(document).on("mousedown","div.luckysheet-modal-dialog",function(e){if(!$(e.target).is(".luckysheet-modal-dialog")){return;}luckysheet_model_move_state=true;luckysheet_model_move_obj=$(e.currentTarget);var toffset=luckysheet_model_move_obj.offset();luckysheet_model_xy=[e.pageX-toffset.left,e.pageY-toffset.top];});$(document).on("click",".luckysheet-modal-dialog-title-close, .luckysheet-model-close-btn",function(e){//选择文本颜色和单元格颜色弹出框取消
  if($("#textcolorselect").is(":visible")||$("#cellcolorselect").is(":visible")){$("#luckysheet-conditionformat-dialog").show();}$(e.currentTarget).parents(".luckysheet-modal-dialog").hide();$("#luckysheet-modal-dialog-mask").hide();//函数查找功能所有弹出框关闭和取消
  if($(this).parents(".luckysheet-modal-dialog").hasClass("luckysheet-search-formula")){luckysheet.formula.dontupdate();luckysheetMoveHighlightCell("down",0,"rangeOfSelect");}if($(this).parents(".luckysheet-modal-dialog").hasClass("luckysheet-search-formula-parm")){luckysheet.formula.dontupdate();luckysheetMoveHighlightCell("down",0,"rangeOfSelect");}if($(this).parents(".luckysheet-modal-dialog").hasClass("luckysheet-search-formula-parm-select")){luckysheet.formula.dontupdate();luckysheetMoveHighlightCell("down",0,"rangeOfSelect");}$("#"+container).attr("tabindex",0).focus();});$("#luckysheetorderby").click(function(){$("body .luckysheet-cols-menu").hide();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选择区域执行此操作，请选择单个区域，然后再试","");}return;}var last=luckysheet_select_save[0];var r1=last["row"][0],r2=last["row"][1];var c1=last["column"][0],c2=last["column"][1];if(luckysheet_sort_initial){luckysheet_sort_initial=false;var content='<div style="overflow: hidden;" class="luckysheet-sort-modal"><div><label><input type="checkbox" id="luckysheet-sort-haveheader"/><span>数据具有标题行</span></label></div><div style="overflow-y:auto;" id="luckysheet-sort-dialog-tablec"><table data-itemcount="0" cellspacing="0"> <tr><td>排序依据 <select name="sort_0"> <option value="1">1</option> <option value="2">2</option> <option value="3">3</option> <option value="4">4</option> </select> </td> <td> <div><label><input value="asc" type="radio" checked="checked" name="sort_0"><span>正序A-Z</span></label></div> <div><label><input value="desc" type="radio" name="sort_0"><span>倒序Z-A</span></label></div></td></tr></table></div><div style="background: #e5e5e5;border-top: 1px solid #f5f5f5; height: 1px; width: 100%;margin:2px 0px;margin-bottom:10px;"></div> <div> <span style="font-weight: bold; text-decoration: underline;text-align:center;color: blue;cursor: pointer;" class="luckysheet-sort-dialog-additem">+ 添加其他排序列</span> </div> </div>';$("body").append(luckysheet.replaceHtml(modelHTML,{"id":"luckysheet-sort-dialog","addclass":"","title":"排序范围","content":content,"botton":'<button id="luckysheet-sort-modal-confirm" class="btn btn-primary">排序</button><button class="btn btn-default luckysheet-model-close-btn">关闭</button>'}));$("#luckysheet-sort-dialog .luckysheet-sort-dialog-additem").click(function(){var last=luckysheet_select_save[0];var r1=last["row"][0],r2=last["row"][1];var c1=last["column"][0],c2=last["column"][1];var option="",i=$("#luckysheet-sort-dialog table").data("itemcount")+1;var t=$("#luckysheet-sort-haveheader").is(':checked');for(var c=c1;c<=c2;c++){if(t){var v=luckysheet.getcellvalue(r1,c,luckysheet.flowdata,"m");if(v==null){v="列"+(c-c1+1);}option+='<option value="'+c+'">'+v+'</option>';}else {option+='<option value="'+c+'">'+luckysheet.luckysheetchatatABC(c)+'</option>';}}$("#luckysheet-sort-dialog table").append('<tr class="luckysheet-sort-dialog-tr"><td><span class="luckysheet-sort-item-close" onclick="$(this).parent().parent().remove();"><i class="fa fa-times" aria-hidden="true"></i></span>次要排序 <select name="sort_'+i+'">'+option+'</select> </td> <td> <div><label><input value="asc" type="radio" checked="checked" name="sort_'+i+'"><span>正序A-Z</span></label></div> <div><label><input value="desc" type="radio" name="sort_'+i+'"><span>倒序Z-A</span></label></div></td></tr>');$("#luckysheet-sort-dialog table").data("itemcount",i);});$("#luckysheet-sort-haveheader").change(function(){var last=luckysheet_select_save[0];var r1=last["row"][0],r2=last["row"][1];var c1=last["column"][0],c2=last["column"][1];var t=$(this).is(':checked');var option="";for(var c=c1;c<=c2;c++){if(t){var v=luckysheet.getcellvalue(r1,c,luckysheet.flowdata,"m");if(v==null){v="列"+(c-c1+1);}option+='<option value="'+c+'">'+v+'</option>';}else {option+='<option value="'+c+'">'+luckysheet.luckysheetchatatABC(c)+'</option>';}}$("#luckysheet-sort-dialog tr select").each(function(){$(this).html(option);});});//自定义排序
  $("#luckysheet-sort-modal-confirm").click(function(){if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选择区域执行此操作，请选择单个区域，然后再试","");}return;}var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var last=luckysheet_select_save[0];var r1=last["row"][0],r2=last["row"][1];var c1=last["column"][0],c2=last["column"][1];//数据具有标题行
  var t=$("#luckysheet-sort-haveheader").is(':checked');if(t){var str=r1+1;}else {var str=r1;}var hasMc=false;//排序选区是否有合并单元格
  var data=[];for(var r=str;r<=r2;r++){var data_row=[];for(var c=c1;c<=c2;c++){if(d[r][c]!=null&&d[r][c].mc!=null){hasMc=true;break;}data_row.push(d[r][c]);}data.push(data_row);}if(hasMc){if(luckysheet.isEditMode()){alert("选区有合并单元格，无法执行此操作！");}else {luckysheet.tooltip.info("选区有合并单元格，无法执行此操作！","");}return;}$($("#luckysheet-sort-dialog table tr").toArray().reverse()).each(function(){var i=$(this).find("select").val(),asc=$(this).find('input:radio:checked').val();i-=c1;if(asc=="asc"){asc=true;}else {asc=false;}data=luckysheet.orderbydata([].concat(data),i,asc);});for(var r=str;r<=r2;r++){for(var c=c1;c<=c2;c++){d[r][c]=data[r-str][c-c1];}}if(config["rowlen"]!=null){var cfg=$.extend(true,{},config);cfg=luckysheet.rowlenByRange(d,str,r2,cfg);luckysheet.jfrefreshgrid(d,[{"row":[str,r2],"column":[c1,c2]}],cfg,null,true);}else {luckysheet.jfrefreshgrid(d,[{"row":[str,r2],"column":[c1,c2]}]);}$("#luckysheet-sort-dialog").hide();$("#luckysheet-modal-dialog-mask").hide();});}var option="";for(var c=c1;c<=c2;c++){option+='<option value="'+c+'">'+luckysheet.luckysheetchatatABC(c)+'</option>';}$("#luckysheet-sort-dialog select").html(option);$("#luckysheet-sort-dialog .luckysheet-sort-dialog-tr").remove();$("#luckysheet-sort-haveheader").prop("checked",false);$("#luckysheet-sort-dialog input:radio:first").prop("checked","checked");$("#luckysheet-sort-dialog .luckysheet-modal-dialog-title-text").html("排序范围从<span>"+luckysheet.luckysheetchatatABC(c1)+(r1+1)+"</span>到<span>"+luckysheet.luckysheetchatatABC(c2)+(r2+1)+"</span>");var $t=$("#luckysheet-sort-dialog"),myh=$t.outerHeight(),myw=$t.outerWidth();var winw=$(window).width(),winh=$(window).height();var scrollLeft=$(document).scrollLeft(),scrollTop=$(document).scrollTop();$("#luckysheet-sort-dialog-tablec").css("max-height",(winh-myh)/2);$("#luckysheet-sort-dialog").css({"left":(winw+scrollLeft-myw)/2,"top":(winh+scrollTop-myh)/2}).show();$("#luckysheet-modal-dialog-mask").show();if(r1<r2){setTimeout(function(){var flowrowdata1=luckysheet.flowdata[r1],flowrowdata2=luckysheet.flowdata[r1+1],hastitle=false;for(var i=c1;i<=c2;i++){var isdatatype_r1=luckysheet.isdatatype(flowrowdata1[i]),isdatatype_r2=luckysheet.isdatatype(flowrowdata2[i]);if(isdatatype_r1!=isdatatype_r2){hastitle=true;}}if(hastitle){$("#luckysheet-sort-haveheader").prop("checked",true).change();}},10);}});//筛选事件处理
  var hidefilersubmenu=null;$("#luckysheet-filter-menu").mouseover(function(){clearTimeout(hidefilersubmenu);hidefilersubmenu=setTimeout(function(){$("#luckysheet-filter-submenu").hide();},500);});$("#luckysheet-filter-submenu").mouseover(function(){clearTimeout(hidefilersubmenu);}).find(".luckysheet-cols-menuitem").click(function(e){$("#luckysheet-filter-selected span").html($(this).find(".luckysheet-cols-menuitem-content").text()).data("value",$(this).data("value"));$("#luckysheet-filter-menu .luckysheet-filter-selected-input").hide();var $type=$(this).data("type");var $value=$(this).attr("data-value");if($type=="2"){$("#luckysheet-filter-selected span").data("type","2");$("#luckysheet-filter-menu .luckysheet-filter-selected-input2").show();$("#luckysheet-filter-menu .luckysheet-filter-selected-input input").prop("type","number");}else if($type=="0"){$("#luckysheet-filter-selected span").data("type","0");}else {$("#luckysheet-filter-selected span").data("type","1");$("#luckysheet-filter-menu .luckysheet-filter-selected-input").eq(0).show();//若是日期 改变input type类型为date
  if($value=="dateequal"||$value=="datelessthan"||$value=="datemorethan"){$("#luckysheet-filter-menu .luckysheet-filter-selected-input input").prop("type","date");}else if($value=="morethan"||$value=="moreequalthan"||$value=="lessthan"||$value=="lessequalthan"||$value=="equal"||$value=="noequal"){$("#luckysheet-filter-menu .luckysheet-filter-selected-input input").prop("type","number");}else {$("#luckysheet-filter-menu .luckysheet-filter-selected-input input").prop("type","text");}}$("#luckysheet-filter-byvalue").next().slideUp();$("#luckysheet-filter-submenu").hide();});$("#luckysheet-filter-bycondition, #luckysheet-filter-byvalue").click(function(){var $t=$(this);$t.next().slideToggle(200);setTimeout(function(){if($t.attr("id")=="luckysheet-filter-bycondition"&&$("#luckysheet-filter-bycondition").next().is(":visible")){if($("#luckysheet-filter-selected span").text()!="无"){$("#luckysheet-filter-byvalue").next().slideUp(200);}}if($t.is($("#luckysheet-filter-bycondition"))){if($("#luckysheet-filter-bycondition").next().is(":hidden")&&$("#luckysheet-filter-byvalue").next().is(":hidden")){$("#luckysheet-filter-byvalue").next().slideDown(200);}}},300);});//筛选取消
  $("#luckysheet-filter-cancel").click(function(){$("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide();});//筛选 确认
  $("#luckysheet-filter-confirm").click(function(){var $menu=$("#luckysheet-filter-menu");var st_r=$menu.data("str"),ed_r=$menu.data("edr"),cindex=$menu.data("cindex"),st_c=$menu.data("stc"),ed_c=$menu.data("edc");var rowhiddenother={};//其它筛选列的隐藏行
  $("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").not($("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").eq(cindex-st_c).get(0)).each(function(){var $t=$(this),rh=$t.data("rowhidden");if(rh==""){return true;}rh=JSON.parse(rh.replace(/\'/g,'"'));for(var r in rh){rowhiddenother[r]=0;}});var filterdata={};var rowhidden={};var caljs={};if($("#luckysheet-filter-bycondition").next().is(":visible")&&$("#luckysheet-filter-byvalue").next().is(":hidden")&&$("#luckysheet-filter-selected span").data("value")!="null"){var $t=$("#luckysheet-filter-selected span");var type=$t.data("type"),value=$t.data("value");caljs["value"]=value;caljs["text"]=$t.text();if(type=="0"){caljs["type"]="0";}else if(type=="2"){var $input=$("#luckysheet-filter-menu .luckysheet-filter-selected-input2 input");caljs["type"]="2";caljs["value1"]=$input.eq(0).val();caljs["value2"]=$input.eq(1).val();}else {caljs["type"]="1";caljs["value1"]=$("#luckysheet-filter-menu .luckysheet-filter-selected-input").eq(0).find("input").val();}for(var r=st_r+1;r<=ed_r;r++){if(r in rowhiddenother){continue;}if(luckysheet.flowdata[r]==null){continue;}var cell=luckysheet.flowdata[r][cindex];if(value=="cellnull"){//单元格为空
  if(cell!=null&&!luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}}else if(value=="cellnonull"){//单元格有数据
  if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}}else if(value=="textinclude"){//文本包含 
  var value1=caljs["value1"];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else {if(cell.m.indexOf(value1)==-1){rowhidden[r]=0;}}}else if(value=="textnotinclude"){//文本不包含
  var value1=caljs["value1"];if(cell==null||luckysheet.func_methods.isRealNull(cell.v));else {if(cell.m.indexOf(value1)>-1){rowhidden[r]=0;}}}else if(value=="textstart"){//文本开头为
  var value1=caljs["value1"],valuelen=value1.length;if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else {if(cell.m.substr(0,valuelen)!=value1){rowhidden[r]=0;}}}else if(value=="textend"){//文本结尾为
  var value1=caljs["value1"],valuelen=value1.length;if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else {if(valuelen>cell.m.length||cell.m.substr(cell.m.length-valuelen,valuelen)!=value1){rowhidden[r]=0;}}}else if(value=="textequal"){//文本等于
  var value1=caljs["value1"];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else {if(cell.m!=value1){rowhidden[r]=0;}}}else if(value=="dateequal"){//日期等于
  var value1=luckysheet.mask.genarate(caljs["value1"])[2];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="d"){if(parseInt(cell.v)!=value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="datelessthan"){//日期早于
  var value1=luckysheet.mask.genarate(caljs["value1"])[2];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="d"){if(parseInt(cell.v)>=value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="datemorethan"){//日期晚于
  var value1=luckysheet.mask.genarate(caljs["value1"])[2];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="d"){if(parseInt(cell.v)<=value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="morethan"){//大于
  var value1=parseFloat(caljs["value1"]);if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v<=value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="moreequalthan"){//大于等于
  var value1=parseFloat(caljs["value1"]);if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v<value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="lessthan"){//小于
  var value1=parseFloat(caljs["value1"]);if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v>=value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="lessequalthan"){//小于等于
  var value1=parseFloat(caljs["value1"]);if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v>value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="equal"){//等于
  var value1=parseFloat(caljs["value1"]);if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v!=value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="noequal"){//不等于
  var value1=parseFloat(caljs["value1"]);if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v==value1){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="include"){//介于
  var value1=parseFloat(caljs["value1"]),value2=parseFloat(caljs["value2"]);if(value1<value2){var min=value1;var max=value2;}else {var max=value1;var min=value2;}if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v<min||cell.v>max){rowhidden[r]=0;}}else {rowhidden[r]=0;}}else if(value=="noinclude"){//不在其中
  var value1=parseFloat(caljs["value1"]),value2=parseFloat(caljs["value2"]);if(value1<value2){var min=value1;var max=value2;}else {var max=value1;var min=value2;}if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}else if(cell.ct!=null&&cell.ct.t=="n"){if(cell.v>=min&&cell.v<=max){rowhidden[r]=0;}}else {rowhidden[r]=0;}}}}else {$("#luckysheet-filter-byvalue-select .ListBox input[type='checkbox']").each(function(i,e){if($(e).is(":visible")&&$(e).is(":checked")){return true;}if($(e).closest(".day").length>0){var day=$(e).siblings("label").text();if(Number(day)<10){day="0"+Number(day);}var month=$(e).closest(".monthBox").find(".month label").text().replace("月","");if(Number(month)<10){month="0"+Number(month);}var year=$(e).closest(".yearBox").find(".year label").text().replace("年","");var itemV="日期格式#$$$#"+year+"-"+month+"-"+day;filterdata[itemV]="1";}if($(e).closest(".textBox").length>0){var itemV=$(e).closest(".textBox").data("filter");filterdata[itemV]="1";}});for(var r=st_r+1;r<=ed_r;r++){if(r in rowhiddenother){continue;}if(luckysheet.flowdata[r]==null){continue;}var cell=luckysheet.flowdata[r][cindex];if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){var value="null#$$$#null";}else if(cell.ct!=null&&cell.ct.t=="d"){var fmt=luckysheet.mask.update("YYYY-MM-DD",cell.v);var value="日期格式#$$$#"+fmt;}else {var value=cell.v+"#$$$#"+cell.m;}if(value in filterdata){rowhidden[r]=0;}}}var $top=$("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").eq(cindex-st_c);var optionstate=$("#luckysheet-filter-byvalue-select .ListBox input[type='checkbox']:visible:checked").length<$("#luckysheet-filter-byvalue-select .ListBox input[type='checkbox']:visible").length||$("#luckysheet-filter-byvalue-input").val().length>0||$("#luckysheet-filter-bycondition").next().is(":visible")&&$("#luckysheet-filter-byvalue").next().is(":hidden")&&$("#luckysheet-filter-selected span").data("value")!="null";var rowhiddenall=$.extend(true,rowhiddenother,rowhidden),rowhidenPre=luckysheet.json.parseJsonParm($top.data("rowhidden"));luckysheet.labelFilterOptionState($top,optionstate,rowhidden,caljs,true,st_r,ed_r,cindex,st_c,ed_c);var cfg=$.extend(true,{},config);cfg["rowhidden"]=rowhiddenall;//保存撤销
  if(clearjfundo){var redo={};redo["type"]="datachangeAll_filter";redo["sheetIndex"]=luckysheet.currentSheetIndex;redo["config"]=$.extend(true,{},config);redo["curconfig"]=cfg;redo["optionstate"]=optionstate;redo["optionsindex"]=cindex-st_c;redo["rowhidden"]=$.extend(true,{},rowhidden);redo["rowhidenPre"]=$.extend(true,{},rowhidenPre);if(caljs!=null){redo["caljs"]=caljs;}luckysheet.jfundo=[];luckysheet.jfredo.push(redo);}//config
  config=cfg;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,cfg["rowhidden"],{"k":"rowhidden"});//行高、列宽 刷新  
  luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);// luckysheet.filterseletedbyindex(st_r, ed_r, st_c, ed_c);
  $("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide();luckysheet.cleargridelement();});luckysheet.json={parseJsonParm:function parseJsonParm(obj){if(obj==null){return {};}else if(luckysheet.getObjType(obj)=="string"){try{var json=eval('('+obj+')');return json;}catch(e){return {};}}else {return obj;}},hasKey:function hasKey(obj){var _this=this;var json=_this.parseJsonParm(obj);for(var item in json){return true;}return false;}};luckysheet.labelFilterOptionState=function($top,optionstate,rowhidden,caljs,notSave,str,edr,cindex,stc,edc){if(optionstate){$top.addClass("luckysheet-filter-options-active").data("rowhidden",JSON.stringify(rowhidden)).data("caljs",JSON.stringify(caljs)).html('<i class="fa fa-filter luckysheet-mousedown-cancel" aria-hidden="true"></i>');if(caljs!=null){$top.data("byconditionvalue",caljs["value"]).data("byconditiontype",caljs["type"]).data("byconditiontext",caljs["text"]);if(caljs["value1"]!=null){$top.data("byconditionvalue1",caljs["value1"]);}if(caljs["value2"]!=null){$top.data("byconditionvalue2",caljs["value2"]);}}}else {$top.removeClass("luckysheet-filter-options-active").data("rowhidden","").data("caljs","").html('<i class="fa fa-caret-down luckysheet-mousedown-cancel" aria-hidden="true"></i>');$top.data("byconditionvalue","null").data("byconditiontype","0").data("byconditiontext","无").data("byconditionvalue1","").data("byconditionvalue2","");}if(!!notSave){var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];if(file.filter==null){file.filter={};}if(optionstate){var param={"caljs":caljs,"rowhidden":rowhidden,"optionstate":optionstate,"str":str,"edr":edr,"cindex":cindex,"stc":stc,"edc":edc};// luckysheet.server.saveParam("f", luckysheet.currentSheetIndex, param, { "op": "upOrAdd", "pos": cindex - stc });
  file.filter[cindex-stc]=param;}else {// luckysheet.server.saveParam("f", luckysheet.currentSheetIndex, null, { "op": "del", "pos": cindex - stc });
  delete file.filter[cindex-stc];// file.filter[cindex - stc] = null;
  }luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,file.filter,{"k":"filter"});}};$("#luckysheet-filter-selected").click(function(){var $t=$(this),toffset=$t.offset(),$menu=$("#luckysheet-filter-submenu");$menu.hide();var winH=$(window).height(),winW=$(window).width();var menuW=$menu.width(),menuH=$menu.height();var top=toffset.top,left=toffset.left,mheight=winH-toffset.top-20;if(toffset.left+menuW>winW){left=toffset.left-menuW;}if(toffset.top>winH/2){top=winH-toffset.top;if(top<0){top=0;}mheight=toffset.top-20;}$menu.css({"top":top,"left":left,"height":mheight}).show();clearTimeout(hidefilersubmenu);});var orderbydatafiler=function orderbydatafiler(str,stc,edr,edc,index,asc){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);str=str+1;var hasMc=false;//排序选区是否有合并单元格
  var data=[];for(var r=str;r<=edr;r++){var data_row=[];for(var c=stc;c<=edc;c++){if(d[r][c]!=null&&d[r][c].mc!=null){hasMc=true;break;}data_row.push(d[r][c]);}data.push(data_row);}if(hasMc){if(luckysheet.isEditMode()){alert("筛选选区有合并单元格，无法执行此操作！");}else {luckysheet.tooltip.info("筛选选区有合并单元格，无法执行此操作！","");}return;}data=luckysheet.orderbydata(data,index-stc,asc);for(var r=str;r<=edr;r++){for(var c=stc;c<=edc;c++){d[r][c]=data[r-str][c-stc];}}if(config["rowlen"]!=null){var cfg=$.extend(true,{},config);cfg=luckysheet.rowlenByRange(d,str,edr,cfg);luckysheet.jfrefreshgrid(d,[{"row":[str,edr],"column":[stc,edc]}],cfg,null,true);}else {luckysheet.jfrefreshgrid(d,[{"row":[str,edr],"column":[stc,edc]}]);}};//创建筛选按钮
  luckysheet.createFilter=function(){if(luckysheet_select_save.length>1){$("#luckysheet-rightclick-menu").hide();$("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet.isEditMode()){alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选择区域执行此操作，请选择单个区域，然后再试","");}return;}if(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].isPivotTable){return;}$('#luckysheet-filter-selected-sheet'+luckysheet.currentSheetIndex+', #luckysheet-filter-options-sheet'+luckysheet.currentSheetIndex).remove();var last=luckysheet_select_save[0];if(last["row"][0]==last["row"][1]&&last["column"][0]==last["column"][1]){var st_c,ed_c,curR=last["row"][1];for(var c=0;c<luckysheet.flowdata[curR].length;c++){var cell=luckysheet.flowdata[curR][c];if(cell!=null&&!luckysheet.func_methods.isRealNull(cell.v)){if(st_c==null){st_c=c;}}else if(st_c!=null){ed_c=c-1;break;}}if(ed_c==null){ed_c=luckysheet.flowdata[curR].length-1;}luckysheet_select_save=[{"row":[curR,curR],"column":[st_c,ed_c]}];luckysheet.selectHightlightShow();luckysheet.luckysheet_shiftpositon=$.extend(true,{},last);luckysheetMoveEndCell("down","range");}else if(last["row"][1]-last["row"][0]<2){luckysheet.luckysheet_shiftpositon=$.extend(true,{},last);luckysheetMoveEndCell("down","range");}luckysheet_filter_save=$.extend(true,{},luckysheet_select_save[0]);luckysheet.createFilterOptions(luckysheet_filter_save);luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,luckysheet_filter_save,{"k":"filter_select"});if(filterchage){luckysheet.jfredo.push({"type":"filtershow","data":[],"curdata":[],"sheetIndex":luckysheet.currentSheetIndex,"filter_save":luckysheet_filter_save});}};luckysheet.createFilterOptions=function(luckysheet_filter_save,filterObj){$("#luckysheet-filter-selected-sheet"+luckysheet.currentSheetIndex).remove();$("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex).remove();if(luckysheet_filter_save==null||JSON.stringify(luckysheet_filter_save)=="{}"){return;}var r1=luckysheet_filter_save.row[0],r2=luckysheet_filter_save.row[1];var c1=luckysheet_filter_save.column[0],c2=luckysheet_filter_save.column[1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];var newSelectedHTML='<div id="luckysheet-filter-selected-sheet'+luckysheet.currentSheetIndex+'" class="luckysheet-cell-selected luckysheet-filter-selected"  style="left:'+col_pre+'px;width:'+(col-col_pre-1)+'px;top:'+row_pre+'px;height:'+(row-row_pre-1)+'px;display:block;border-color:#897BFF;z-index:20;background:none;"></div>';$("#luckysheet-cell-main").append(newSelectedHTML);var optionHTML="";for(var c=c1;c<=c2;c++){if(filterObj==null||filterObj[c-c1]==null){optionHTML+='<div data-rowhidden="" data-str="'+r1+'" data-edr="'+r2+'" data-cindex="'+c+'" data-stc="'+c1+'" data-edc="'+c2+'" class="luckysheet-filter-options" style="left:'+(visibledatacolumn[c]-20)+'px;top:'+row_pre+'px;display:block;"><i class="fa fa-caret-down" aria-hidden="true"></i></div>';}else {if(filterObj[c-c1].caljs!=null){if(filterObj[c-c1].caljs["value1"]!=null){var caljs_value1_data='data-byconditionvalue1="'+filterObj[c-c1].caljs["value1"]+'" ';}else {var caljs_value1_data='';}if(filterObj[c-c1].caljs["value2"]!=null){var caljs_value2_data='data-byconditionvalue2="'+filterObj[c-c1].caljs["value2"]+'" ';}else {var caljs_value2_data='';}var caljs_data='data-caljs="'+JSON.stringify(filterObj[c-c1].caljs)+'" '+'data-byconditionvalue="'+filterObj[c-c1].caljs["value"]+'" '+'data-byconditiontype="'+filterObj[c-c1].caljs["type"]+'" '+'data-byconditiontext="'+filterObj[c-c1].caljs["text"]+'" '+caljs_value1_data+caljs_value2_data;}else {var caljs_data='';}optionHTML+='<div data-rowhidden="'+JSON.stringify(filterObj[c-c1].rowhidden).replace(/\"/g,"'")+'" '+caljs_data+' data-str="'+r1+'" data-edr="'+r2+'" data-cindex="'+c+'" data-stc="'+c1+'" data-edc="'+c2+'" class="luckysheet-filter-options luckysheet-filter-options-active" style="left:'+(visibledatacolumn[c]-20)+'px;top:'+row_pre+'px;display:block;"><i class="fa fa-filter luckysheet-mousedown-cancel" aria-hidden="true"></i></div>';}}$("#luckysheet-cell-main").append('<div id="luckysheet-filter-options-sheet'+luckysheet.currentSheetIndex+'" class="luckysheet-filter-options-c">'+optionHTML+'</div>');$("#luckysheet-rightclick-menu").hide();$("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide();if($("#luckysheet-cell-main").scrollTop()>luckysheet_filter_save["top_move"]){$("#luckysheet-scrollbar-y").scrollTop(luckysheet_filter_save["top_move"]);}var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];file.filter_select=luckysheet_filter_save;};$("#luckysheetfilter").click(luckysheet.createFilter);//按颜色筛选
  var submenuhide=null;$("#luckysheet-filter-orderby-color").hover(function(){//遍历筛选列颜色
  var $menu=$("#luckysheet-filter-menu");var st_r=$menu.data("str"),ed_r=$menu.data("edr"),cindex=$menu.data("cindex"),st_c=$menu.data("stc"),ed_c=$menu.data("edc");var bgMap={};//单元格颜色
  var fcMap={};//字体颜色
  var af_compute=luckysheet.alternateformat.getComputeMap();var cf_compute=luckysheet.conditionformat.getComputeMap();for(var r=st_r+1;r<=ed_r;r++){var cell=luckysheet.flowdata[r][cindex];//单元格颜色
  var bg=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,cindex,"bg");var checksAF=luckysheet.alternateformat.checksAF(r,cindex,af_compute);if(checksAF!=null){//若单元格有交替颜色
  bg=checksAF[1];}var checksCF=luckysheet.conditionformat.checksCF(r,cindex,cf_compute);if(checksCF!=null&&checksCF["cellColor"]!=null){//若单元格有条件格式
  bg=checksCF["cellColor"];}if(bg.indexOf("rgb")>-1){bg=luckysheet.rgbTohex(bg);}if(bg.length==4){bg=bg.substr(0,1)+bg.substr(1,1).repeat(2)+bg.substr(2,1).repeat(2)+bg.substr(3,1).repeat(2);}//字体颜色
  var fc=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,cindex,"fc");if(checksAF!=null){//若单元格有交替颜色
  fc=checksAF[0];}if(checksCF!=null&&checksCF["textColor"]!=null){//若单元格有条件格式
  fc=checksCF["textColor"];}if(fc.indexOf("rgb")>-1){fc=luckysheet.rgbTohex(fc);}if(fc.length==4){fc=fc.substr(0,1)+fc.substr(1,1).repeat(2)+fc.substr(2,1).repeat(2)+fc.substr(3,1).repeat(2);}if(config!=null&&config["rowhidden"]!=null&&r in config["rowhidden"]){bgMap[bg]=1;if(cell!=null&&!luckysheet.func_methods.isRealNull(cell.v)){fcMap[fc]=1;}}else {bgMap[bg]=0;if(cell!=null&&!luckysheet.func_methods.isRealNull(cell.v)){fcMap[fc]=0;}}}//
  var filterBgColorHtml='';if(JSON.stringify(bgMap).length>2&&Object.keys(bgMap).length>1){var bgColorItemHtml='';for(b in bgMap){if(bgMap[b]==0){bgColorItemHtml+='<div class="item luckysheet-mousedown-cancel"><label class="luckysheet-mousedown-cancel" style="background-color: '+b+'" title="'+b+'"></label><input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/></div>';}else {bgColorItemHtml+='<div class="item luckysheet-mousedown-cancel"><label class="luckysheet-mousedown-cancel" style="background-color: '+b+'" title="'+b+'"></label><input class="luckysheet-mousedown-cancel" type="checkbox"/></div>';}}filterBgColorHtml='<div id="filterBgColor" class="box luckysheet-mousedown-cancel"><div class="title luckysheet-mousedown-cancel">按单元格颜色筛选</div><div style="max-height:128px;overflow:auto;" class="luckysheet-mousedown-cancel">'+bgColorItemHtml+'</div></div>';}var filterFcColorHtml='';if(JSON.stringify(fcMap).length>2&&Object.keys(fcMap).length>1){var fcColorItemHtml='';for(f in fcMap){if(fcMap[f]==0){fcColorItemHtml+='<div class="item luckysheet-mousedown-cancel"><label class="luckysheet-mousedown-cancel" style="background-color: '+f+'" title="'+f+'"></label><input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/></div>';}else {fcColorItemHtml+='<div class="item luckysheet-mousedown-cancel"><label class="luckysheet-mousedown-cancel" style="background-color: '+f+'" title="'+f+'"></label><input class="luckysheet-mousedown-cancel" type="checkbox"/></div>';}}filterFcColorHtml='<div id="filterFcColor" class="box luckysheet-mousedown-cancel"><div class="title luckysheet-mousedown-cancel">按字体颜色筛选</div><div style="max-height:128px;overflow:auto;" class="luckysheet-mousedown-cancel">'+fcColorItemHtml+'</div></div>';}//
  if(filterBgColorHtml==''&&filterFcColorHtml==''){var content='<div class="luckysheet-mousedown-cancel" style="padding: 10px 30px;text-align: center;">本列仅包含一种颜色</div>';}else {var content=filterBgColorHtml+filterFcColorHtml+'<div class="luckysheet-mousedown-cancel"><button id="luckysheet-filter-orderby-color-confirm" class="btn btn-primary luckysheet-mousedown-cancel" style="margin: 5px 20px;width: 70px;">确认</button></div>';}//颜色筛选子菜单
  $("#luckysheet-filter-orderby-color-submenu").remove();$("body").append('<div id="luckysheet-filter-orderby-color-submenu" class="luckysheet-cols-menu luckysheet-mousedown-cancel">'+content+'</div>');var $t=$("#luckysheet-filter-orderby-color-submenu").end(),myh=$t.outerHeight(),myw=$t.outerWidth();var $con=$(this).parent();var winW=$(window).width(),winH=$(window).height();var menuW=$con.width(),myh=$t.height()+25,myw=$t.width()+5;var offset=$(this).offset();var top=offset.top,left=offset.left+menuW;if(left+myw>winW){left=offset.left-myw;}if(top+myh>winH){top=winH-myh;}$("#luckysheet-filter-orderby-color-submenu").css({"top":top,"left":left}).show();},function(){submenuhide=setTimeout(function(){$("#luckysheet-filter-orderby-color-submenu").hide();},200);});$(document).on("mouseover mouseleave","#luckysheet-filter-orderby-color-submenu",function(e){if(e.type==="mouseover"){clearTimeout(submenuhide);}else {$(this).hide();}});$(document).on("click","#luckysheet-filter-orderby-color-submenu .item label",function(){$(this).siblings("input[type='checkbox']").click();});$(document).off("click.orderbyColorConfirm").on("click.orderbyColorConfirm","#luckysheet-filter-orderby-color-submenu #luckysheet-filter-orderby-color-confirm",function(){var bg_colorMap={};var fc_colorMap={};$("#luckysheet-filter-orderby-color-submenu .item").each(function(i,e){if($(e).find("input[type='checkbox']").is(":checked")){var color=$(this).find("label").attr("title");var $id=$(this).closest(".box").attr("id");if($id=="filterBgColor"){bg_colorMap[color]=0;}else if($id=="filterFcColor"){fc_colorMap[color]=0;}}});if($("#luckysheet-filter-orderby-color-submenu #filterBgColor").length>0){var bg_filter=true;}else {var bg_filter=false;}if($("#luckysheet-filter-orderby-color-submenu #filterFcColor").length>0){var fc_filter=true;}else {var fc_filter=false;}var $menu=$("#luckysheet-filter-menu");var st_r=$menu.data("str"),ed_r=$menu.data("edr"),cindex=$menu.data("cindex"),st_c=$menu.data("stc"),ed_c=$menu.data("edc");var rowhiddenother={};//其它筛选列的隐藏行
  $("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").not($("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").eq(cindex-st_c).get(0)).each(function(){var $t=$(this),rh=$t.data("rowhidden");if(rh==""){return true;}rh=JSON.parse(rh);for(var r in rh){rowhiddenother[r]=0;}});var rowhidden={};var caljs={};var af_compute=luckysheet.alternateformat.getComputeMap();var cf_compute=luckysheet.conditionformat.getComputeMap();for(var r=st_r+1;r<=ed_r;r++){if(r in rowhiddenother){continue;}if(luckysheet.flowdata[r]==null){continue;}var cell=luckysheet.flowdata[r][cindex];//单元格颜色
  var bg=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,cindex,"bg");var checksAF=luckysheet.alternateformat.checksAF(r,cindex,af_compute);if(checksAF!=null){//若单元格有交替颜色
  bg=checksAF[1];}var checksCF=luckysheet.conditionformat.checksCF(r,cindex,cf_compute);if(checksCF!=null&&checksCF["cellColor"]!=null){//若单元格有条件格式
  bg=checksCF["cellColor"];}if(bg.indexOf("rgb")>-1){bg=luckysheet.rgbTohex(bg);}if(bg.length==4){bg=bg.substr(0,1)+bg.substr(1,1).repeat(2)+bg.substr(2,1).repeat(2)+bg.substr(3,1).repeat(2);}//文本颜色
  var fc=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,cindex,"fc");if(checksAF!=null){//若单元格有交替颜色
  fc=checksAF[0];}if(checksCF!=null&&checksCF["textColor"]!=null){//若单元格有条件格式
  fc=checksCF["textColor"];}if(fc.indexOf("rgb")>-1){fc=luckysheet.rgbTohex(fc);}if(fc.length==4){fc=fc.substr(0,1)+fc.substr(1,1).repeat(2)+fc.substr(2,1).repeat(2)+fc.substr(3,1).repeat(2);}if(bg_filter&&fc_filter){if(!(bg in bg_colorMap)&&(!(fc in fc_colorMap)||cell==null||luckysheet.func_methods.isRealNull(cell.v))){rowhidden[r]=0;}}else if(bg_filter){if(!(bg in bg_colorMap)){rowhidden[r]=0;}}else if(fc_filter){if(!(fc in fc_colorMap)||cell==null||luckysheet.func_methods.isRealNull(cell.v)){rowhidden[r]=0;}}}var $top=$("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").eq(cindex-st_c);var optionstate=Object.keys(rowhidden).length>0;var rowhiddenall=$.extend(true,rowhiddenother,rowhidden),rowhidenPre=luckysheet.json.parseJsonParm($top.data("rowhidden"));luckysheet.labelFilterOptionState($top,optionstate,rowhidden,caljs,true,st_r,ed_r,cindex,st_c,ed_c);var cfg=$.extend(true,{},config);cfg["rowhidden"]=rowhiddenall;//保存撤销
  if(clearjfundo){var redo={};redo["type"]="datachangeAll_filter";redo["sheetIndex"]=luckysheet.currentSheetIndex;redo["config"]=$.extend(true,{},config);redo["curconfig"]=cfg;redo["optionstate"]=optionstate;redo["optionsindex"]=cindex-st_c;redo["rowhidden"]=$.extend(true,{},rowhidden);redo["rowhidenPre"]=$.extend(true,{},rowhidenPre);if(caljs!=null){redo["caljs"]=caljs;}luckysheet.jfundo=[];luckysheet.jfredo.push(redo);}//config
  config=cfg;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,cfg["rowhidden"],{"k":"rowhidden"});//行高、列宽 刷新  
  luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);// luckysheet.filterseletedbyindex(st_r, ed_r, st_c, ed_c);
  $("#luckysheet-filter-menu, #luckysheet-filter-submenu, #luckysheet-filter-orderby-color-submenu").hide();luckysheet.cleargridelement();});//筛选按钮点击事件
  $("#luckysheet-cell-main").on("click",".luckysheet-filter-options",function(e){var $t=$(e.currentTarget),toffset=$t.offset(),$menu=$("#luckysheet-filter-menu"),winH=$(window).height(),winW=$(window).width();var st_r=$t.data("str"),ed_r=$t.data("edr"),cindex=$t.data("cindex"),st_c=$t.data("stc"),ed_c=$t.data("edc"),rowhidden=$t.data("rowhidden")==""?{}:JSON.parse($t.data("rowhidden").replace(/\'/g,'"'));$("body .luckysheet-cols-menu").hide();$("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide();$("#luckysheet-filter-byvalue-input").val("");$("#luckysheet-filter-bycondition").next().hide();$("#luckysheet-filter-byvalue").next().show();$menu.data("str",st_r);$menu.data("edr",ed_r);$menu.data("cindex",cindex);$menu.data("stc",st_c);$menu.data("edc",ed_c);$("#luckysheet-filter-menu .luckysheet-filter-selected-input").hide().find("input").val();$("#luckysheet-filter-selected span").data("type","0").data("type",null).text("无");var byconditiontype=$t.data("byconditiontype");$("#luckysheet-filter-selected span").data("value",$t.data("byconditionvalue")).data("type",byconditiontype).text($t.data("byconditiontext"));if(byconditiontype=="2"){var $input=$("#luckysheet-filter-menu .luckysheet-filter-selected-input2").show().find("input");$input.eq(0).val($t.data("byconditionvalue1"));$input.eq(1).val($t.data("byconditionvalue2"));}else if(byconditiontype=="1"){$("#luckysheet-filter-menu .luckysheet-filter-selected-input").eq(0).show().find("input").val($t.data("byconditionvalue1"));}$("#luckysheet-filter-orderby-asc").off("click").on("click",function(){orderbydatafiler(st_r,st_c,ed_r,ed_c,cindex,true);});$("#luckysheet-filter-orderby-desc").off("click").on("click",function(){orderbydatafiler(st_r,st_c,ed_r,ed_c,cindex,false);});$("#luckysheet-filter-byvalue-select").empty().html('<div style="width:100%;text-align:center;position:relative;top:45%;font-size:14px;"><div class="luckysheetLoaderGif"></div><span>数据量大！请稍后</span></div>');var rowhiddenother={};//其它筛选列的隐藏行
  $("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").not(this).each(function(){var $t=$(this),rh=$t.data("rowhidden");if(rh==""){return true;}rh=JSON.parse(rh.replace(/\'/g,'"'));for(var r in rh){rowhiddenother[r]=0;}});setTimeout(function(){//日期值
  var dvmap={};var dvmap_uncheck={};//除日期以外的值
  var vmap={};var vmap_uncheck={};for(var r=st_r+1;r<=ed_r;r++){if(r in rowhiddenother){continue;}if(luckysheet.flowdata[r]==null){continue;}var cell=luckysheet.flowdata[r][cindex];if(cell!=null&&!luckysheet.func_methods.isRealNull(cell.v)&&cell.ct!=null&&cell.ct.t=="d"){//单元格是日期
  var v=luckysheet.mask.update("YYYY-MM-DD",cell.v);var y=v.split("-")[0];var m=v.split("-")[1];var d=v.split("-")[2];if(!(y in dvmap)){dvmap[y]={};}if(!(m in dvmap[y])){dvmap[y][m]={};}if(!(d in dvmap[y][m])){dvmap[y][m][d]=0;}dvmap[y][m][d]++;if(r in rowhidden){dvmap_uncheck[y]=0;dvmap_uncheck[m]=0;dvmap_uncheck[d]=0;}}else {if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){var v=null;var m=null;}else {var v=cell.v;var m=cell.m;}if(!(v in vmap)){vmap[v]={};}if(!(m in vmap[v])){vmap[v][m]=0;}vmap[v][m]++;if(r in rowhidden){vmap_uncheck[v+"#$$$#"+m]=0;}}}//遍历数据加到页面
  var item=[];if(JSON.stringify(dvmap).length>2){for(y in dvmap){var ysum=0;var monthHtml='';for(m in dvmap[y]){var msum=0;var dayHtml='';for(d in dvmap[y][m]){var dayL=dvmap[y][m][d];msum+=dayL;//月 小于 10
  if(Number(m)<10){var mT="0"+Number(m);}else {var mT=m;}//日 小于 10
  if(Number(d)<10){var dT="0"+Number(d);}else {var dT=d;}//日是否选中状态
  if(y in dvmap_uncheck&&m in dvmap_uncheck&&d in dvmap_uncheck){dayHtml+='<div class="day luckysheet-mousedown-cancel cf" data-check="false" title="'+y+'-'+mT+'-'+dT+'">'+'<input class="luckysheet-mousedown-cancel" type="checkbox"/>'+'<label class="luckysheet-mousedown-cancel">'+d+'</label>'+'<span class="count luckysheet-mousedown-cancel">( '+dayL+' )</span>'+'</div>';}else {dayHtml+='<div class="day luckysheet-mousedown-cancel cf" data-check="true" title="'+y+'-'+mT+'-'+dT+'">'+'<input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/>'+'<label class="luckysheet-mousedown-cancel">'+d+'</label>'+'<span class="count luckysheet-mousedown-cancel">( '+dayL+' )</span>'+'</div>';}}ysum+=msum;//月 小于 10
  if(Number(m)<10){var mT2="0"+Number(m);}else {var mT2=m;}//月是否选中状态
  if(y in dvmap_uncheck&&m in dvmap_uncheck){monthHtml+='<div class="monthBox luckysheet-mousedown-cancel">'+'<div class="month luckysheet-mousedown-cancel cf" data-check="false" title="'+y+'-'+mT2+'">'+'<i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i>'+'<input class="luckysheet-mousedown-cancel" type="checkbox"/>'+'<label class="luckysheet-mousedown-cancel">'+m+'月</label>'+'<span class="count luckysheet-mousedown-cancel">( '+msum+' )</span>'+'</div>'+'<div class="dayList luckysheet-mousedown-cancel">'+dayHtml+'</div>'+'</div>';}else {monthHtml+='<div class="monthBox luckysheet-mousedown-cancel">'+'<div class="month luckysheet-mousedown-cancel cf" data-check="true" title="'+y+'-'+mT2+'">'+'<i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i>'+'<input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/>'+'<label class="luckysheet-mousedown-cancel">'+m+'月</label>'+'<span class="count luckysheet-mousedown-cancel">( '+msum+' )</span>'+'</div>'+'<div class="dayList luckysheet-mousedown-cancel">'+dayHtml+'</div>'+'</div>';}}//年是否选中状态
  if(y in dvmap_uncheck){var yearHtml='<div class="yearBox luckysheet-mousedown-cancel">'+'<div class="year luckysheet-mousedown-cancel cf" data-check="false" title="'+y+'">'+'<i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i>'+'<input class="luckysheet-mousedown-cancel" type="checkbox"/>'+'<label class="luckysheet-mousedown-cancel">'+y+'年</label>'+'<span class="count luckysheet-mousedown-cancel">( '+ysum+' )</span>'+'</div>'+'<div class="monthList luckysheet-mousedown-cancel">'+monthHtml+'</div>'+'</div>';}else {var yearHtml='<div class="yearBox luckysheet-mousedown-cancel">'+'<div class="year luckysheet-mousedown-cancel cf" data-check="true" title="'+y+'">'+'<i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i>'+'<input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/>'+'<label class="luckysheet-mousedown-cancel">'+y+'年</label>'+'<span class="count luckysheet-mousedown-cancel">( '+ysum+' )</span>'+'</div>'+'<div class="monthList luckysheet-mousedown-cancel">'+monthHtml+'</div>'+'</div>';}item.unshift(yearHtml);}}if(JSON.stringify(vmap).length>2){var vmapKeys=Object.keys(vmap);vmapKeys=luckysheet.orderbydata1D(vmapKeys,true);for(var i=0;i<vmapKeys.length;i++){var v=vmapKeys[i];for(x in vmap[v]){if(v+"#$$$#"+x=="null#$$$#null"){var text="(空白)";}else {var text=x;}//是否选中状态
  if(v+"#$$$#"+x in vmap_uncheck){var dataHtml='<div class="textBox luckysheet-mousedown-cancel cf" data-check="false" data-filter="'+(v+"#$$$#"+x)+'" title="'+text+'">'+'<input class="luckysheet-mousedown-cancel" type="checkbox"/>'+'<label class="luckysheet-mousedown-cancel">'+text+'</label>'+'<span class="luckysheet-mousedown-cancel count">( '+vmap[v][x]+' )</span>'+'</div>';}else {var dataHtml='<div class="textBox luckysheet-mousedown-cancel cf" data-check="true" data-filter="'+(v+"#$$$#"+x)+'" title="'+text+'">'+'<input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/>'+'<label class="luckysheet-mousedown-cancel">'+text+'</label>'+'<span class="luckysheet-mousedown-cancel count">( '+vmap[v][x]+' )</span>'+'</div>';}item.push(dataHtml);}}}$("#luckysheet-filter-byvalue-select").html("<div class='ListBox luckysheet-mousedown-cancel' style='min-height: 100px; max-height: "+(winH-toffset.top-350)+"px; overflow-y: auto; overflow-x: hidden;'><table cellspacing='0' style='width:100%;' class='luckysheet-mousedown-cancel'>"+item.join("")+"</table></div>");},1);showrightclickmenu($menu,toffset.left,toffset.top+20);e.stopPropagation();return false;});//点击复选框
  $(document).off("click.filterCheckbox1").on("click.filterCheckbox1","#luckysheet-filter-byvalue-select .textBox",function(){if($(this).attr("data-check")=="true"){$(this).attr("data-check","false");$(this).find("input[type='checkbox']").removeAttr("checked");}else {$(this).attr("data-check","true");$(this).find("input[type='checkbox']").prop("checked",true);}});$(document).off("click.filterCheckbox2").on("click.filterCheckbox2","#luckysheet-filter-byvalue-select .year",function(){if($(this).attr("data-check")=="true"){$(this).attr("data-check","false");$(this).parents(".yearBox").find(".month").attr("data-check","false");$(this).parents(".yearBox").find(".day").attr("data-check","false");$(this).parents(".yearBox").find("input[type='checkbox']").removeAttr("checked");}else {$(this).attr("data-check","true");$(this).parents(".yearBox").find(".month").attr("data-check","true");$(this).parents(".yearBox").find(".day").attr("data-check","true");$(this).parents(".yearBox").find("input[type='checkbox']").prop("checked",true);}});$(document).off("click.filterCheckbox3").on("click.filterCheckbox3","#luckysheet-filter-byvalue-select .month",function(){//月份 对应的 天
  if($(this).attr("data-check")=="true"){$(this).attr("data-check","false");$(this).parents(".monthBox").find(".day").attr("data-check","false");$(this).parents(".monthBox").find("input[type='checkbox']").removeAttr("checked");}else {$(this).attr("data-check","true");$(this).parents(".monthBox").find(".day").attr("data-check","true");$(this).parents(".monthBox").find("input[type='checkbox']").prop("checked",true);}//月份 对应的 年份
  var yearDayAllCheck=true;var $yearDay=$(this).parents(".yearBox").find(".day");$yearDay.each(function(i,e){if($(e).attr("data-check")=="true");else {yearDayAllCheck=false;}});if(yearDayAllCheck){$(this).parents(".yearBox").find(".year").attr("data-check","true");$(this).parents(".yearBox").find(".year input[type='checkbox']").prop("checked",true);}else {$(this).parents(".yearBox").find(".year").attr("data-check","false");$(this).parents(".yearBox").find(".year input[type='checkbox']").removeAttr("checked");}});$(document).off("click.filterCheckbox4").on("click.filterCheckbox4","#luckysheet-filter-byvalue-select .day",function(){if($(this).attr("data-check")=="true"){$(this).attr("data-check","false");$(this).find("input[type='checkbox']").removeAttr("checked");}else {$(this).attr("data-check","true");$(this).find("input[type='checkbox']").prop("checked",true);}//天 对应的 月份
  var monthDayAllCheck=true;var $monthDay=$(this).parents(".monthBox").find(".day");$monthDay.each(function(i,e){if($(e).attr("data-check")=="true");else {monthDayAllCheck=false;}});if(monthDayAllCheck){$(this).parents(".monthBox").find(".month").attr("data-check","true");$(this).parents(".monthBox").find(".month input[type='checkbox']").prop("checked",true);}else {$(this).parents(".monthBox").find(".month").attr("data-check","false");$(this).parents(".monthBox").find(".month input[type='checkbox']").removeAttr("checked");}//天 对应的 年份
  var yearDayAllCheck=true;var $yearDay=$(this).parents(".yearBox").find(".day");$yearDay.each(function(i,e){if($(e).attr("data-check")=="true");else {yearDayAllCheck=false;}});if(yearDayAllCheck){$(this).parents(".yearBox").find(".year").attr("data-check","true");$(this).parents(".yearBox").find(".year input[type='checkbox']").prop("checked",true);}else {$(this).parents(".yearBox").find(".year").attr("data-check","false");$(this).parents(".yearBox").find(".year input[type='checkbox']").removeAttr("checked");}});//日期 三级下拉显示
  $(document).off("click.filterYearDropdown").on("click.filterYearDropdown","#luckysheet-filter-byvalue-select .yearBox .fa-caret-right",function(event){var $p=$(this).parents(".luckysheet-mousedown-cancel");if($p.hasClass("year")){$(this).parents(".yearBox").find(".monthList").slideToggle();}if($p.hasClass("month")){$(this).parents(".monthBox").find(".dayList").slideToggle();}event.stopPropagation();});//全选
  $("#luckysheet-filter-byvalue-btn-all").click(function(){$("#luckysheet-filter-byvalue-select .ListBox input[type='checkbox']").prop("checked",true);$("#luckysheet-filter-byvalue-select .ListBox input[type='checkbox']").parents(".luckysheet-mousedown-cancel").attr("data-check","true");});//清除
  $("#luckysheet-filter-byvalue-btn-clear").click(function(){$("#luckysheet-filter-byvalue-select .ListBox input[type='checkbox']").removeAttr("checked");$("#luckysheet-filter-byvalue-select .ListBox input[type='checkbox']").parents(".luckysheet-mousedown-cancel").attr("data-check","false");});//反选
  $("#luckysheet-filter-byvalue-btn-contra").click(function(){var $input=$("#luckysheet-filter-byvalue-select .ListBox input[type='checkbox']");$input.each(function(i,e){if($(e).is(":checked")){$(e).removeAttr("checked");$(e).parents(".luckysheet-mousedown-cancel").attr("data-check","false");}else {$(e).prop("checked",true);$(e).parents(".luckysheet-mousedown-cancel").attr("data-check","true");}});//天 对应的 月份
  var $month=$("#luckysheet-filter-byvalue-select .ListBox .monthBox");$month.each(function(index,event){var monthDayAllCheck=true;var $monthDay=$(event).find(".day input[type='checkbox']");$monthDay.each(function(i,e){if($(e).is(":checked"));else {monthDayAllCheck=false;}});if(monthDayAllCheck){$(event).find(".month input[type='checkbox']").prop("checked",true);$(event).attr("data-check","true");}else {$(event).find(".month input[type='checkbox']").removeAttr("checked");$(event).attr("data-check","false");}});//天 对应的 年份
  var $year=$("#luckysheet-filter-byvalue-select .ListBox .yearBox");$year.each(function(index,event){var yearDayAllCheck=true;var $yearDay=$(event).find(".day input[type='checkbox']");$yearDay.each(function(i,e){if($(e).is(":checked"));else {yearDayAllCheck=false;}});if(yearDayAllCheck){$(event).find(".year input[type='checkbox']").prop("checked",true);$(event).attr("data-check","true");}else {$(event).find(".year input[type='checkbox']").removeAttr("checked");$(event).attr("data-check","false");}});});//清除筛选
  $("#luckysheet-filter-initial").click(function(){$("#luckysheet-filter-menu .luckysheet-filter-selected-input").hide().find("input").val();$("#luckysheet-filter-selected span").data("type","0").data("type",null).text("无");$('#luckysheet-filter-selected-sheet'+luckysheet.currentSheetIndex+', #luckysheet-filter-options-sheet'+luckysheet.currentSheetIndex).remove();$("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide();var redo={};redo["type"]="datachangeAll_filter_clear";redo["sheetIndex"]=luckysheet.currentSheetIndex;redo["config"]=$.extend(true,{},config);config["rowhidden"]={};redo["curconfig"]=$.extend(true,{},config);redo["filter_save"]=$.extend(true,{},luckysheet_filter_save);var optiongroups=[];$("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").each(function(){var $t=$(this);var optionstate=$t.hasClass("luckysheet-filter-options-active");var rowhidden=luckysheet.json.parseJsonParm($t.data("rowhidden"));var caljs=luckysheet.json.parseJsonParm($t.data("caljs"));optiongroups.push({"optionstate":optionstate,"rowhidden":rowhidden,"caljs":caljs,"str":$t.data("str"),"edr":$t.data("edr"),"cindex":$t.data("cindex"),"stc":$t.data("stc"),"edc":$t.data("edc")});});redo["optiongroups"]=optiongroups;luckysheet.jfundo=[];luckysheet.jfredo.push(redo);//清除筛选发送给后台
  luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].filter=null;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].filter_select=null;luckysheet.server.saveParam("fsc",luckysheet.currentSheetIndex,null);//config
  luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,{},{"k":"rowhidden"});//行高、列宽 刷新  
  luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);});//按照值进行筛选
  $("#luckysheet-filter-byvalue-input").on('input propertychange',function(){var v=$(this).val().toString();$("#luckysheet-filter-byvalue-select .ListBox .luckysheet-mousedown-cancel").show();if(v!=""){$("#luckysheet-filter-byvalue-select .ListBox input[type='checkbox']").each(function(i,e){if($(e).closest(".day").length>0){var day=$(e).siblings("label").text().toString();var month=$(e).closest(".monthBox").find(".month label").text().toString();var year=$(e).closest(".yearBox").find(".year label").text().toString();var itemV=year+"-"+month+"-"+day;if(itemV.indexOf(v)==-1){$(e).closest(".day").hide();//天 对应的 月份
  var $monthDay=$(e).closest(".dayList").find(".day:visible");if($monthDay.length==0){$(e).closest(".monthBox").find(".month").hide();}//天 对应的 年份
  var $yearDay=$(e).closest(".monthList").find(".day:visible");if($yearDay.length==0){$(e).closest(".yearBox").find(".year").hide();}}}if($(e).closest(".textBox").length>0){var itemV=$(e).siblings("label").text().toString();if(itemV.indexOf(v)==-1){$(e).parents(".textBox").hide();}}});}});//info处理
  // $("#luckysheet_info_detail_user").html(luckysheetConfigsetting.userInfo+'&nbsp;<i class="fa fa-caret-down" aria-hidden="true"></i>').click(function(){
  //     if(luckysheetConfigsetting.userMenuItem.length==0){
  //         return
  //     }
  //     var userlen = $(this).outerWidth();
  //     var tlen = $("#luckysheet-user-menu").outerWidth();
  //     var menuleft = $(this).offset().left;
  //     if(tlen>userlen && (tlen + menuleft)>$("#"+container).width()){
  //         menuleft = menuleft - tlen + userlen;
  //     }
  //     mouseclickposition($("#luckysheet-user-menu"), menuleft, $(this).offset().top+20, "lefttop");
  // });
  if(luckysheetConfigsetting.userMenuItem.length>0){$("body").append('<div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-mousedown-cancel" id="luckysheet-user-menu">${item}</div>');var itemset="";for(var i=0;i<luckysheetConfigsetting.userMenuItem.length;i++){var item=luckysheetConfigsetting.userMenuItem[i];itemset+='<div data-src="'+item.url+'" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="padding: 6px 0px 6px 5px;"><span style="margin-right:3px;" class="icon luckysheet-mousedown-cancel">'+item.icon+'</span> '+item.name+'</div></div>';}$("#luckysheet-user-menu").html(itemset).find("i").addClass("luckysheet-mousedown-cancel").end().find(".luckysheet-cols-menuitem").click(function(){window.open($(this).data("src"),"_self");});}$("#luckysheet_info_detail_title").click(function(){window.open(luckysheetConfigsetting.myFolderUrl,"_self");});$("#luckysheet_info_detail_input").val(luckysheet.server.title).css("width",luckysheet.getByteLen(luckysheet.server.title)*10).keydown(function(){var ctrlKey=event.ctrlKey;var altKey=event.altKey;var shiftKey=event.shiftKey;var kcode=event.keyCode;var $t=$(this);if(kcode==keycode.ENTER){$t.blur().change();}}).bind('input propertychange',function(){var $t=$(this);var inputlen=luckysheet.getByteLen($t.val())*10;var updatelen=$("#luckysheet_info_detail_update").outerWidth();var savelen=$("#luckysheet_info_detail_save").outerWidth();var userlen=$("#luckysheet_info_detail_user").parent().outerWidth()+60;var containerlen=$("#"+container).outerWidth();var otherlen=100;var minuslen=containerlen-savelen-updatelen-userlen-otherlen;if(inputlen>minuslen){$("#luckysheet_info_detail_input").css("width",minuslen);}else {$("#luckysheet_info_detail_input").css("width",inputlen);}}).change(function(){luckysheet.server.saveParam("na",null,$(this).val());});//公式处理
  $("#luckysheet-functionbox-cell").focus(function(){if(luckysheet.isEditMode()){//此模式下禁用公式栏
  return;}if(luckysheet_select_save.length>0){var last=luckysheet_select_save[luckysheet_select_save.length-1];var row_index=last["row_focus"],col_index=last["column_focus"];var row=visibledatarow[row_index],row_pre=row_index-1==-1?0:visibledatarow[row_index-1];var col=visibledatacolumn[col_index],col_pre=col_index-1==-1?0:visibledatacolumn[col_index-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,row_index,col_index);if(!!margeset){row=margeset.row[1];row_pre=margeset.row[0];row_index=margeset.row[2];col=margeset.column[1];col_pre=margeset.column[0];col_index=margeset.column[2];}luckysheet.luckysheetupdateCell(row,row_pre,row_index,col,col_pre,col_index,luckysheet.flowdata,null,true);luckysheet.formula.rangeResizeTo=$("#luckysheet-functionbox-cell");}}).keydown(function(event){if(luckysheet.isEditMode()){//此模式下禁用公式栏
  return;}var ctrlKey=event.ctrlKey;var altKey=event.altKey;var shiftKey=event.shiftKey;var kcode=event.keyCode;var $inputbox=$("#luckysheet-input-box");//luckysheet.formula.rangeHightlightselected();
  if(kcode==keycode.ENTER&&parseInt($inputbox.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")&&luckysheet.formula.searchFunctionCell!=null){luckysheet.formula.searchFunctionEnter($("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active"));}else {luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheet_select_save=[{"row":[luckysheetCellUpdate[0],luckysheetCellUpdate[0]],"column":[luckysheetCellUpdate[1],luckysheetCellUpdate[1]],"row_focus":luckysheetCellUpdate[0],"column_focus":luckysheetCellUpdate[1]}];luckysheetMoveHighlightCell("down",1,"rangeOfSelect");$("#luckysheet-functionbox-cell").blur();}event.preventDefault();}else if(kcode==keycode.ESC&&parseInt($inputbox.css("top"))>0){luckysheet.formula.dontupdate();luckysheetMoveHighlightCell("down",0,"rangeOfSelect");event.preventDefault();}else if(kcode==keycode.F4&&parseInt($inputbox.css("top"))>0){luckysheet.formula.setfreezonFuc(event);event.preventDefault();}else if(kcode==keycode.UP&&parseInt($inputbox.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")){var $up=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active").prev();if($up.length==0){$up=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").last();}$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").removeClass("luckysheet-formula-search-item-active");$up.addClass("luckysheet-formula-search-item-active");event.preventDefault();}}else if(kcode==keycode.DOWN&&parseInt($inputbox.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")){var $up=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active").next();if($up.length==0){$up=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").first();}$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").removeClass("luckysheet-formula-search-item-active");$up.addClass("luckysheet-formula-search-item-active");event.preventDefault();}}else if(kcode==keycode.LEFT&&parseInt($inputbox.css("top"))>0){luckysheet.formula.rangeHightlightselected($("#luckysheet-functionbox-cell"));}else if(kcode==keycode.RIGHT&&parseInt($inputbox.css("top"))>0){luckysheet.formula.rangeHightlightselected($("#luckysheet-functionbox-cell"));}else if(!(kcode>=112&&kcode<=123||kcode<=46||kcode==144||kcode==108||event.ctrlKey||event.altKey||event.shiftKey&&(kcode==37||kcode==38||kcode==39||kcode==40))||kcode==8||kcode==32||kcode==46||event.ctrlKey&&kcode==86){luckysheet.formula.functionInputHanddler($("#luckysheet-rich-text-editor"),$("#luckysheet-functionbox-cell"),kcode);//         var value1 = $("#luckysheet-functionbox-cell").html(), value1txt = $("#luckysheet-functionbox-cell").text();
  //     	setTimeout(function(){
  //             var value = $("#luckysheet-functionbox-cell").text(), valuetxt = value;
  //             if (value.length > 0 && value.substr(0, 1) == "=" && kcode != 229) {
  //                 value = luckysheet.formula.functionHTMLGenerate(value);
  //                 value1 = luckysheet.formula.functionHTMLGenerate(value1txt);
  //                 if (window.getSelection) {  // all browsers, except IE before version 9
  //                     var currSelection = window.getSelection();
  //                     luckysheet.formula.functionRangeIndex = [$(currSelection.anchorNode).parent().index(), currSelection.anchorOffset];
  //                 }
  //                 else {  // Internet Explorer before version 9
  //                     var textRange = document.selection.createRange();
  //                     luckysheet.formula.functionRangeIndex = textRange;
  //                 }
  //                 $("#luckysheet-functionbox-cell").html(value);
  //          		luckysheet.formula.functionRange($("#luckysheet-functionbox-cell"), value, value1);
  //                 //console.log(value, value1, luckysheet.formula.functionRangeIndex);
  //                 // if (luckysheet.formula.functionRangeIndex != null) {
  //                 //     luckysheet.formula.functionRange($("#luckysheet-functionbox-cell"), value, value1);
  //                 // }
  //                 // else{
  //                 //     luckysheetRangeLast($("#luckysheet-functionbox-cell")[0]);
  //                 // }
  //             }
  //             $("#luckysheet-rich-text-editor").html(value);
  //},1);
  }}).click(function(){if(luckysheet.isEditMode()){//此模式下禁用公式栏
  return;}luckysheet.formula.rangeHightlightselected($("#luckysheet-functionbox-cell"));//console.log(window.getSelection().getRangeAt(0));
  //if ($(this).text().length == 0) {
  //    luckysheet.formula.functionRangeIndex = null;
  //}
  //else{
  //    if (window.getSelection) {  // all browsers, except IE before version 9
  //        var currSelection = window.getSelection();
  //        luckysheet.formula.functionRangeIndex = currSelection.getRangeAt(0).endOffset;
  //        //currSelection.removeAllRanges();
  //    }
  //    else {  // Internet Explorer before version 9
  //        var textRange = document.selection.createRange();
  //        luckysheet.formula.functionRangeIndex = textRange;
  //    }
  //}
  //console.log(luckysheet.formula.functionRangeIndex);
  });$("#luckysheet-wa-functionbox-cancel").click(function(){if(!$(this).hasClass("luckysheet-wa-calculate-active")){return;}//若有参数弹出框，隐藏
  if($("#luckysheet-search-formula-parm").is(":visible")){$("#luckysheet-search-formula-parm").hide();}//若有参数选取范围弹出框，隐藏
  if($("#luckysheet-search-formula-parm-select").is(":visible")){$("#luckysheet-search-formula-parm-select").hide();}luckysheet.formula.dontupdate();luckysheetMoveHighlightCell("down",0,"rangeOfSelect");});$("#luckysheet-wa-functionbox-confirm").click(function(){if(!$(this).hasClass("luckysheet-wa-calculate-active")){return;}//若有参数弹出框，隐藏
  if($("#luckysheet-search-formula-parm").is(":visible")){$("#luckysheet-search-formula-parm").hide();}//若有参数选取范围弹出框，隐藏
  if($("#luckysheet-search-formula-parm-select").is(":visible")){$("#luckysheet-search-formula-parm-select").hide();}luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);luckysheetMoveHighlightCell("down",0,"rangeOfSelect");//$("#luckysheet-functionbox-cell").html($("#luckysheet-rich-text-editor").html());
  });$("#luckysheet-wa-functionbox-fx").click(function(){//点击函数查找弹出框
  if(luckysheet_select_save.length==0){if(luckysheet.isEditMode()){alert("请选择单元格插入函数");}else {luckysheet.tooltip.info("请选择单元格插入函数","");}return;}var last=luckysheet_select_save[luckysheet_select_save.length-1];var row_index=last["row_focus"],col_index=last["column_focus"];var row=visibledatarow[row_index],row_pre=row_index-1==-1?0:visibledatarow[row_index-1];var col=visibledatacolumn[col_index],col_pre=col_index-1==-1?0:visibledatacolumn[col_index-1];luckysheet.luckysheetupdateCell(row,row_pre,row_index,col,col_pre,col_index,luckysheet.flowdata);var cell=luckysheet.flowdata[row_index][col_index];if(cell!=null&&cell.f!=null){//单元格有计算
  var functionStr=luckysheet.formula.getfunctionParam(cell.f);if(functionStr.fn!=null){//有函数公式
  luckysheet.insertFormula.formulaParmDialog(functionStr.fn,functionStr.param);}else {//无函数公式
  luckysheet.insertFormula.formulaListDialog();}}else {//单元格无计算
  $("#luckysheet-rich-text-editor").html('<span dir="auto" class="luckysheet-formula-text-color">=</span>');$("#luckysheet-functionbox-cell").html($("#luckysheet-rich-text-editor").html());luckysheet.insertFormula.formulaListDialog();}luckysheet.insertFormula.init();});$("#luckysheet-formula-functionrange").on("mousedown",".luckysheet-copy",function(event){luckysheet.formula.rangeMove=true;luckysheet_scroll_status=true;luckysheet.formula.rangeMoveObj=$(this).parent();luckysheet.formula.rangeMoveIndex=$(this).parent().attr("rangeindex");var mouse=mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();$("#luckysheet-formula-functionrange-highlight-"+luckysheet.formula.rangeMoveIndex).find(".luckysheet-selection-copy-hc").css("opacity",0.13);var type=$(this).data("type");if(type=="top"){y+=3;}else if(type=="right"){x-=3;}else if(type=="bottom"){y-=3;}else if(type=="left"){x+=3;}var rowLocation=luckysheet.rowLocation(y),row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col_index=colLocation[2];luckysheet.formula.rangeMovexy=[row_index,col_index];$("#luckysheet-sheettable").css("cursor","move");event.stopPropagation();});$("#luckysheet-formula-functionrange").on("mousedown",".luckysheet-highlight",function(e){luckysheet.formula.rangeResize=$(this).data("type");//开始状态resize
  luckysheet.formula.rangeResizeIndex=$(this).parent().attr("rangeindex");var mouse=mouseposition(e.pageX,e.pageY),scrollLeft=$("#luckysheet-cell-main").scrollLeft(),scrollTop=$("#luckysheet-cell-main").scrollTop();var x=mouse[0]+scrollLeft;var y=mouse[1]+scrollTop;luckysheet.formula.rangeResizeObj=$(this).parent();$("#luckysheet-formula-functionrange-highlight-"+luckysheet.formula.rangeResizeIndex).find(".luckysheet-selection-copy-hc").css("opacity",0.13);if(luckysheet.formula.rangeResize=="lt"){x+=3;y+=3;}else if(luckysheet.formula.rangeResize=="lb"){x+=3;y-=3;}else if(luckysheet.formula.rangeResize=="rt"){x-=3;y+=3;}else if(luckysheet.formula.rangeResize=="rb"){x-=3;y-=3;}var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];var position=luckysheet.formula.rangeResizeObj.position();luckysheet.formula.rangeResizexy=[col_pre,row_pre,luckysheet.formula.rangeResizeObj.width(),luckysheet.formula.rangeResizeObj.height(),position.left+scrollLeft,position.top+scrollTop,col,row];luckysheet.formula.rangeResizeWinH=$("#luckysheet-cell-main")[0].scrollHeight;luckysheet.formula.rangeResizeWinW=$("#luckysheet-cell-main")[0].scrollWidth;luckysheet_scroll_status=true;event.stopPropagation();});//图表选区mousedown
  $("#luckysheet-chart-rangeShow").on("mousedown.chartRangeShowMove",".luckysheet-chart-rangeShow-move",function(event){luckysheet.chart_selection.rangeMove=true;luckysheet_scroll_status=true;luckysheet.chart_selection.rangeMoveObj=$(this).parent();var chart_id=luckysheet.chartparam.luckysheetCurrentChartMoveObj.find(".luckysheet-modal-dialog-content").attr("id");// var vue = !!window.generator && generator.chartEditorComponent;
  var chart_json=!!window.store&&store.state.chartSetting.chartList[chart_id];var $id=$(this).parent().attr("id");if($id=="luckysheet-chart-rangeShow-content"){var row_s=chart_json.rangeArray[0].row[0]+chart_json.rangeSplitArray.content.row[0];var col_s=chart_json.rangeArray[0].column[0]+chart_json.rangeSplitArray.content.column[0];luckysheet.chart_selection.rangeMoveIndex=[row_s,col_s];}else if($id=="luckysheet-chart-rangeShow-rowtitle"){var row_s=chart_json.rangeArray[0].row[0]+chart_json.rangeSplitArray.rowtitle.row[0];var col_s=chart_json.rangeArray[0].column[0]+chart_json.rangeSplitArray.rowtitle.column[0];luckysheet.chart_selection.rangeMoveIndex=[row_s,col_s];}else if($id=="luckysheet-chart-rangeShow-coltitle"){var row_s=chart_json.rangeArray[0].row[0]+chart_json.rangeSplitArray.coltitle.row[0];var col_s=chart_json.rangeArray[0].column[0]+chart_json.rangeSplitArray.coltitle.column[0];luckysheet.chart_selection.rangeMoveIndex=[row_s,col_s];}var mouse=luckysheet.mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();var type=$(this).data("type");if(type=="top"){y+=3;}else if(type=="right"){x-=3;}else if(type=="bottom"){y-=3;}else if(type=="left"){x+=3;}var rowLocation=luckysheet.rowLocation(y),row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col_index=colLocation[2];luckysheet.chart_selection.rangeMovexy=[row_index,col_index];event.stopPropagation();});$("#luckysheet-chart-rangeShow").on("mousedown.chartRangeShowResize",".luckysheet-chart-rangeShow-resize",function(event){luckysheet.chart_selection.rangeResize=$(this).data("type");//开始状态resize
  luckysheet_scroll_status=true;luckysheet.chart_selection.rangeResizeObj=$(this).parent();var chart_id=luckysheet.chartparam.luckysheetCurrentChartMoveObj.find(".luckysheet-modal-dialog-content").attr("id");// var vue = !!window.generator && generator.chartEditorComponent;
  var chart_json=!!window.store&&store.state.chartSetting.chartList[chart_id];var $id=$(this).parent().attr("id");if($id=="luckysheet-chart-rangeShow-content"){if(chart_json.rangeRowCheck.exits){var row_s=chart_json.rangeArray[0].row[0]+chart_json.rangeSplitArray.content.row[0];var row_e=chart_json.rangeArray[0].row[0]+chart_json.rangeSplitArray.content.row[1];}else {var row_s=chart_json.rangeSplitArray.content.row[0];var row_e=chart_json.rangeSplitArray.content.row[0];}if(chart_json.rangeColCheck.exits){var col_s=chart_json.rangeArray[0].column[0]+chart_json.rangeSplitArray.content.column[0];var col_e=chart_json.rangeArray[0].column[0]+chart_json.rangeSplitArray.content.column[1];}else {var col_s=chart_json.rangeSplitArray.content.column[0];var col_e=chart_json.rangeSplitArray.content.column[1];}luckysheet.chart_selection.rangeResizeIndex={"row":[row_s,row_e],"column":[col_s,col_e]};}else if($id=="luckysheet-chart-rangeShow-rowtitle"){var row_s=chart_json.rangeArray[0].row[0]+chart_json.rangeSplitArray.rowtitle.row[0];var row_e=chart_json.rangeArray[0].row[0]+chart_json.rangeSplitArray.rowtitle.row[1];var col_s=chart_json.rangeArray[0].column[0]+chart_json.rangeSplitArray.rowtitle.column[0];var col_e=chart_json.rangeArray[0].column[0]+chart_json.rangeSplitArray.rowtitle.column[1];luckysheet.chart_selection.rangeResizeIndex={"row":[row_s,row_e],"column":[col_s,col_e]};}else if($id=="luckysheet-chart-rangeShow-coltitle"){var row_s=chart_json.rangeArray[0].row[0]+chart_json.rangeSplitArray.coltitle.row[0];var row_e=chart_json.rangeArray[0].row[0]+chart_json.rangeSplitArray.coltitle.row[1];var col_s=chart_json.rangeArray[0].column[0]+chart_json.rangeSplitArray.coltitle.column[0];var col_e=chart_json.rangeArray[0].column[0]+chart_json.rangeSplitArray.coltitle.column[1];luckysheet.chart_selection.rangeResizeIndex={"row":[row_s,row_e],"column":[col_s,col_e]};}var mouse=luckysheet.mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();if(luckysheet.chart_selection.rangeResize=="lt"){x+=3;y+=3;}else if(luckysheet.chart_selection.rangeResize=="lb"){x+=3;y-=3;}else if(luckysheet.chart_selection.rangeResize=="rt"){x-=3;y+=3;}else if(luckysheet.chart_selection.rangeResize=="rb"){x-=3;y-=3;}var rowLocation=luckysheet.rowLocation(y),row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col_index=colLocation[2];luckysheet.chart_selection.rangeResizexy=[row_index,col_index];event.stopPropagation();});$("#luckysheet-wa-calculate-size").mousedown(function(e){var y=e.pageY;luckysheet.formula.functionResizeData.y=y;luckysheet.formula.functionResizeStatus=true;luckysheet.formula.functionResizeData.calculatebarHeight=calculatebarHeight;if(luckysheet.formula.rangetosheet!=null){luckysheet.formula.updatecell(luckysheetCellUpdate[0],luckysheetCellUpdate[1]);}});var luckysheet_function_exe={};for(var i=0;i<luckysheet.functionlist.length;i++){var func=luckysheet.functionlist[i];luckysheet_function_exe[func.n]=func;}window.luckysheet_function=luckysheet_function_exe;//toolbar菜单
  $("#"+container+" .luckysheet-wa-editor").on("click",".luckysheet-toolbar-zoom-combobox",function(e){$(e.currentTarget).addClass("luckysheet-toolbar-combo-button-open");$(e.currentTarget).find(".luckysheet-toolbar-combo-button-input").focus();});$("#"+container+" .luckysheet-wa-editor").on("blur",".luckysheet-toolbar-combo-button-input",function(e){$(e.currentTarget).closest(".luckysheet-toolbar-zoom-combobox").removeClass("luckysheet-toolbar-combo-button-open");});//表格格式处理
  luckysheet.menuButton.initialMenuButton();var devicePixelRatio=window.devicePixelRatio||1;devicePixelRatio=Math.ceil(devicePixelRatio);luckysheet.dpi_x=document.getElementById('testdpidiv').offsetWidth*devicePixelRatio;luckysheet.dpi_y=document.getElementById('testdpidiv').offsetHeight*devicePixelRatio;$("#testdpidiv").remove();//粘贴事件处理
  $(document).on("paste",function(e){if(luckysheet.isEditMode()){//此模式下禁用粘贴
  return;}if(luckysheet.selection.isPasteAction){$("#luckysheet-rich-text-editor").blur();luckysheet.selection.isPasteAction=false;var clipboardData=window.clipboardData;//for IE
  if(!clipboardData){// for chrome
  clipboardData=e.originalEvent.clipboardData;}var txtdata=clipboardData.getData("text/html");//如果标示是qksheet复制的内容，判断剪贴板内容是否是当前页面复制的内容
  if(txtdata.indexOf("luckysheet_copy_action_table")>-1&&luckysheet_copy_save["copyRange"]!=null&&luckysheet_copy_save["copyRange"].length>0){//剪贴板内容解析
  var cpDataArr=[];var reg=new RegExp('<tr.*?>(.*?)</tr>','g');var reg2=new RegExp('<td.*?>(.*?)</td>','g');var regArr=txtdata.match(reg);for(var i=0;i<regArr.length;i++){var cpRowArr=[];var reg2Arr=regArr[i].match(reg2);for(var j=0;j<reg2Arr.length;j++){var cpValue=reg2Arr[j].replace(/<td.*?>/g,"").replace(/<\/td>/g,"");cpRowArr.push(cpValue);}cpDataArr.push(cpRowArr);}//当前页面复制区内容
  var copy_r1=luckysheet_copy_save["copyRange"][0].row[0],copy_r2=luckysheet_copy_save["copyRange"][0].row[1],copy_c1=luckysheet_copy_save["copyRange"][0].column[0],copy_c2=luckysheet_copy_save["copyRange"][0].column[1];var copy_index=luckysheet_copy_save["dataSheetIndex"];if(copy_index==luckysheet.currentSheetIndex){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);}else {var d=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(copy_index)].data;}var isEqual=true;for(var r=copy_r1;r<=copy_r2;r++){if(r-copy_r1>5){break;}for(var c=copy_c1;c<=copy_c2;c++){var cell=d[r][c];if(cell!=null&&cell.ct!=null&&cell.ct.fa.indexOf("w")>-1){var v=d[r][c].v;}else {var v=d[r][c].m;}if(v!=cpDataArr[r-copy_r1][c-copy_c1]){isEqual=false;break;}}}}if(txtdata.indexOf("luckysheet_copy_action_table")>-1&&luckysheet_copy_save["copyRange"]!=null&&luckysheet_copy_save["copyRange"].length>0&&isEqual){//剪切板内容 和 luckysheet本身复制的内容 一致
  if(luckysheet_paste_iscut){luckysheet_paste_iscut=false;luckysheet.selection.pasteHandlerOfCutPaste(luckysheet_copy_save);luckysheet.selection.clearcopy(e);}else {luckysheet.selection.pasteHandlerOfCopyPaste(luckysheet_copy_save);}}else {// if(txtdata.indexOf("table") > -1 && txtdata.indexOf("microsoft") > -1 && txtdata.indexOf("office") > -1 && txtdata.indexOf("excel") > -1 && txtdata.indexOf("mso-") > -1){
  if(txtdata.indexOf("table")>-1){$("#luckysheet-copy-content").html(txtdata);var data=new Array($("#luckysheet-copy-content").find("table tr").length);var colLen=0;$("#luckysheet-copy-content").find("table tr").eq(0).find("td").each(function(){var colspan=parseInt($(this).attr("colspan"));if(isNaN(colspan)){colspan=1;}colLen+=colspan;});for(var i=0;i<data.length;i++){data[i]=new Array(colLen);}var r=0;var borderInfo={};$("#luckysheet-copy-content").find("table tr").each(function(){var $tr=$(this);var c=0;$tr.find("td").each(function(){var $td=$(this);var cell={};var txt=$td.text();if($.trim(txt).length==0){cell.v=null;cell.m="";}else {var mask=luckysheet.mask.genarate($td.text());cell.v=mask[2];cell.ct=mask[1];cell.m=mask[0];}var bg=$td.css("background-color");if(bg=="rgba(0, 0, 0, 0)"){bg="rgba(255,255,255)";}// console.log(bg);
  // if(bg.indexOf("rgb")>-1){
  //     bg = luckysheet.rgbTohex(bg);
  // }
  // console.log(bg);
  cell.bg=bg;var bl=$td.css("font-weight");if(bl==400||bl=="normal"){cell.bl=0;}else {cell.bl=1;}var it=$td.css("font-style");if(it=="normal"){cell.it=0;}else {cell.it=1;}var ff=$td.css("font-family");var ffs=ff.split(",");for(var i=0;i<ffs.length;i++){var fa=$.trim(ffs[i].toLowerCase());fa=luckysheet.menuButton.fontjson[fa];if(fa==null){cell.ff=0;}else {cell.ff=fa;break;}}var fs=Math.floor(parseInt($td.css("font-size"))*72/luckysheet.dpi_y)+1;cell.fs=fs;var fc=$td.css("color");// if(fc.indexOf("rgb")>-1){
  //     fc = luckysheet.rgbTohex(fc);
  // }
  cell.fc=fc;var ht=$td.css("text-align");if(ht=="center"){cell.ht=0;}else if(ht=="right"){cell.ht=2;}else {cell.ht=1;}var vt=$td.css("vertical-align");if(vt=="middle"){cell.vt=0;}else if(vt=="top"||vt=="text-top"){cell.vt=1;}else {cell.vt=2;}// var borderstyle = $td.css("border");
  // if(borderstyle != null && borderstyle.length > 0 && borderstyle.substr(0, 3).toLowerCase() != "0px"){
  //     var width = $td.css("border-width");
  //     var type = $td.css("border-style");
  //     var color = $td.css("border-color");
  //     var borderconfig = luckysheet.menuButton.getQKBorder(width, type, color);
  //     cell.bs = borderconfig[0];
  //     cell.bc = borderconfig[1];
  // }
  // else{
  //     var bt = $td.css("border-top");
  //     if(bt != null && bt.length > 0 && bt.substr(0, 3).toLowerCase() != "0px"){
  //         var width = $td.css("border-top-width");
  //         var type = $td.css("border-top-style");
  //         var color = $td.css("border-top-color");
  //         var borderconfig = luckysheet.menuButton.getQKBorder(width, type, color);
  //         cell.bs_t = borderconfig[0];
  //         cell.bc_t = borderconfig[1];
  //     }
  //     var bb = $td.css("border-bottom");
  //     if(bb != null && bb.length > 0 && bb.substr(0, 3).toLowerCase() != "0px"){
  //         var width = $td.css("border-bottom-width");
  //         var type = $td.css("border-bottom-style");
  //         var color = $td.css("border-bottom-color");
  //         var borderconfig = luckysheet.menuButton.getQKBorder(width, type, color);
  //         cell.bs_b = borderconfig[0];
  //         cell.bc_b = borderconfig[1];
  //     }
  //     var bl = $td.css("border-left");
  //     if(bl != null && bl.length > 0 && bl.substr(0, 3).toLowerCase() != "0px"){
  //         var width = $td.css("border-left-width");
  //         var type = $td.css("border-left-style");
  //         var color = $td.css("border-left-color");
  //         var borderconfig = luckysheet.menuButton.getQKBorder(width, type, color);
  //         cell.bs_l = borderconfig[0];
  //         cell.bc_l = borderconfig[1];
  //     }
  //     var br = $td.css("border-right");
  //     if(br != null && br.length > 0 && br.substr(0, 3).toLowerCase() != "0px"){
  //         var width = $td.css("border-right-width");
  //         var type = $td.css("border-right-style");
  //         var color = $td.css("border-right-color");
  //         var borderconfig = luckysheet.menuButton.getQKBorder(width, type, color);
  //         cell.bs_r = borderconfig[0];
  //         cell.bc_r = borderconfig[1];
  //         if(bl != null && bl.length > 0 && bl.substr(0, 3).toLowerCase() != "0px"){
  //         }
  //         else{
  //             if(bb != null && bb.length > 0 && bb.substr(0, 3).toLowerCase() != "0px"){
  //                 cell.bs_l = borderconfig[0];
  //                 cell.bc_l = borderconfig[1];
  //             }
  //         }
  //     }
  // }
  while(c<colLen&&data[r][c]!=null){c++;}if(c==colLen){return true;}if(data[r][c]==null){data[r][c]=cell;var rowspan=parseInt($td.attr("rowspan"));var colspan=parseInt($td.attr("colspan"));if(isNaN(rowspan)){rowspan=1;}if(isNaN(colspan)){colspan=1;}var r_ab=luckysheet_select_save[0]["row"][0]+r;var c_ab=luckysheet_select_save[0]["column"][0]+c;for(var rp=0;rp<rowspan;rp++){for(var cp=0;cp<colspan;cp++){if(rp==0){var bt=$td.css("border-top");if(bt!=null&&bt.length>0&&bt.substr(0,3).toLowerCase()!="0px"){var width=$td.css("border-top-width");var type=$td.css("border-top-style");var color=$td.css("border-top-color");var borderconfig=luckysheet.menuButton.getQKBorder(width,type,color);if(borderInfo[r+rp+"_"+(c+cp)]==null){borderInfo[r+rp+"_"+(c+cp)]={};}borderInfo[r+rp+"_"+(c+cp)].t={"style":borderconfig[0],"color":borderconfig[1]};}}if(rp==rowspan-1){var bb=$td.css("border-bottom");if(bb!=null&&bb.length>0&&bb.substr(0,3).toLowerCase()!="0px"){var width=$td.css("border-bottom-width");var type=$td.css("border-bottom-style");var color=$td.css("border-bottom-color");var borderconfig=luckysheet.menuButton.getQKBorder(width,type,color);if(borderInfo[r+rp+"_"+(c+cp)]==null){borderInfo[r+rp+"_"+(c+cp)]={};}borderInfo[r+rp+"_"+(c+cp)].b={"style":borderconfig[0],"color":borderconfig[1]};}}if(cp==0){var bl=$td.css("border-left");if(bl!=null&&bl.length>0&&bl.substr(0,3).toLowerCase()!="0px"){var width=$td.css("border-left-width");var type=$td.css("border-left-style");var color=$td.css("border-left-color");var borderconfig=luckysheet.menuButton.getQKBorder(width,type,color);if(borderInfo[r+rp+"_"+(c+cp)]==null){borderInfo[r+rp+"_"+(c+cp)]={};}borderInfo[r+rp+"_"+(c+cp)].l={"style":borderconfig[0],"color":borderconfig[1]};}}if(cp==colspan-1){var br=$td.css("border-right");if(br!=null&&br.length>0&&br.substr(0,3).toLowerCase()!="0px"){var width=$td.css("border-right-width");var type=$td.css("border-right-style");var color=$td.css("border-right-color");var borderconfig=luckysheet.menuButton.getQKBorder(width,type,color);if(borderInfo[r+rp+"_"+(c+cp)]==null){borderInfo[r+rp+"_"+(c+cp)]={};}borderInfo[r+rp+"_"+(c+cp)].r={"style":borderconfig[0],"color":borderconfig[1]};}}if(rp==0&&cp==0){continue;}data[r+rp][c+cp]={"mc":{"r":r_ab,"c":c_ab}};}}if(rowspan>1||colspan>1){var first={"rs":rowspan,"cs":colspan,"r":r_ab,"c":c_ab};data[r][c].mc=first;// mclist.push(first);
  }}c++;if(c==colLen){return true;}//row.push(cell);
  });r++;//data.push(row);
  });luckysheet_selection_range=[];luckysheet.selection.pasteHandler(data,borderInfo);$("#luckysheet-copy-content").empty();}else {txtdata=clipboardData.getData("text/plain");luckysheet.selection.pasteHandler(txtdata);}}}});if(luckysheetConfigsetting.enablePage){$("#luckysheet-bottom-page-next").click(function(){// rptapp
  var queryExps=luckysheetConfigsetting.pageInfo.queryExps;var reportId=luckysheetConfigsetting.pageInfo.reportId;var fields=luckysheetConfigsetting.pageInfo.fields;var mobile=luckysheetConfigsetting.pageInfo.mobile;var frezon=luckysheetConfigsetting.pageInfo.frezon;var currentPage=luckysheetConfigsetting.pageInfo.currentPage;var totalPage=luckysheetConfigsetting.pageInfo.totalPage;var pageUrl=luckysheetConfigsetting.pageInfo.pageUrl;// rptapp
  luckysheet.method.addDataAjax({"queryExps":queryExps,"reportId":reportId,"fields":fields,"mobile":mobile,"frezon":frezon,"pageIndex":currentPage,"currentPage":currentPage},luckysheet.currentSheetIndex,pageUrl,function(){luckysheetConfigsetting.pageInfo.currentPage++;//$("#luckysheet-bottom-page-info").html('共'+ luckysheetConfigsetting.pageInfo.totalPage +'页，当前已显示'+ (luckysheetConfigsetting.pageInfo.currentPage+1) +'页，每页'+ luckysheetConfigsetting.pageInfo.pageSize +'条');
  if(luckysheetConfigsetting.pageInfo.totalPage==luckysheetConfigsetting.pageInfo.currentPage){$("#luckysheet-bottom-page-next").hide();$("#luckysheet-bottom-page-info").html('共'+luckysheetConfigsetting.total+'条，'+luckysheetConfigsetting.pageInfo.totalPage+'页，'+'已显示全部数据');}else {$("#luckysheet-bottom-page-info").html('共'+luckysheetConfigsetting.total+'条，'+luckysheetConfigsetting.pageInfo.totalPage+'页，当前已显示'+luckysheetConfigsetting.pageInfo.currentPage+'页');}});}).mousedown(function(e){e.stopPropagation();});}$("#luckysheet-bottom-bottom-top").click(function(){$("#luckysheet-scrollbar-y").scrollTop(0);}).mousedown(function(e){e.stopPropagation();});};var showrightclickmenu=function showrightclickmenu($menu,x,y){var winH=$(window).height(),winW=$(window).width();var menuW=$menu.width(),menuH=$menu.height();var top=y,left=x;if(x+menuW>winW){left=x-menuW;}if(y+menuH>winH){top=y-menuH;}if(top<0){top=0;}$menu.css({"top":top,"left":left}).show();};luckysheet.showrightclickmenu=showrightclickmenu;function mouseclickposition($menu,x,y,p){var winH=$(window).height(),winW=$(window).width();var menuW=$menu.width(),menuH=$menu.height();if(p==null){p="lefttop";}if(p=="lefttop"){$menu.css({"top":y,"left":x}).show();}else if(p=="righttop"){$menu.css({"top":y,"left":x-menuW}).show();}else if(p=="leftbottom"){$menu.css({"bottom":winH-y-12,"left":x}).show();}else if(p=="rightbottom"){$menu.css({"bottom":winH-y-12,"left":x-menuW}).show();}}//function luckysheetsliderlistitemfilter($filter) {
  //}
  var luckysheetfontformat=function luckysheetfontformat(format){if(luckysheet.getObjType(format)=="object"){var font="";//font-style
  if(format.it=="0"||format.it==null){font+="normal ";}else {font+="italic ";}//font-variant
  font+="normal ";//font-weight
  if(format.bl=="0"||format.bl==null){font+="normal ";}else {font+="bold ";}//font-size/line-height
  if(!format.fs){font+=Math.ceil(10*devicePixelRatio)+"pt ";}else {font+=Math.ceil(format.fs*devicePixelRatio)+"pt ";}if(!format.ff){font+='微软雅黑, "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Heiti SC", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif';}else {var fontarray=luckysheet.menuButton.fontarray;var fontfamily=null;if(luckysheet.isdatatypemulti(format.ff)["num"]){fontfamily=fontarray[parseInt(format.ff)];}else {fontfamily=fontarray[luckysheet.menuButton.fontjson[format.ff]];}if(fontfamily==null){fontfamily="微软雅黑";}font+=fontfamily+', "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Heiti SC", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif';}return font;}else {return luckysheetdefaultstyle.font;}};luckysheet.luckysheetfontformat=luckysheetfontformat;luckysheet.menuButton={"menu":'<div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-menuButton ${subclass} luckysheet-mousedown-cancel" id="luckysheet-icon-${id}-menuButton">${item}</div>',"item":'<div itemvalue="${value}" itemname="${name}" class="luckysheet-cols-menuitem ${sub} luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="padding: 3px 0px 3px 1px;"><span style="margin-right:3px;width:13px;display:inline-block;" class="icon luckysheet-mousedown-cancel"></span> ${name} <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel" style="user-select: none;">${example}</span></div></div>',"split":'<div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div>',"color":'<div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-rightgclick-menu-sub luckysheet-mousedown-cancel luckysheet-menuButton ${sub}" id="${id}"><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel luckysheet-color-reset"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">重置颜色</div></div> <div class="luckysheet-mousedown-cancel"> <div class="luckysheet-mousedown-cancel"> <input type="text" class="luckysheet-color-selected" /> </div> </div> <div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div> ${coloritem}</div>',"coloritem":'<div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel ${class}"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">${name}</div></div>',"subcolor":'<div id="luckysheet-icon-${id}-menuButton" class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-rightgclick-menu-sub luckysheet-menuButton-sub luckysheet-mousedown-cancel"> <div class="luckysheet-mousedown-cancel"> <div class="luckysheet-mousedown-cancel"> <input type="text" class="luckysheet-color-selected" /> </div> </div></div>',"rightclickmenu":null,"submenuhide":null,"focus":function focus($obj,value){$obj.find(".luckysheet-cols-menuitem").find("span.icon").html("");if(value==null){$obj.find(".luckysheet-cols-menuitem").eq(0).find("span.icon").html('<i class="fa fa-check luckysheet-mousedown-cancel"></i>');}else {$obj.find(".luckysheet-cols-menuitem[itemvalue='"+value+"']").find("span.icon").html('<i class="fa fa-check luckysheet-mousedown-cancel"></i>');}},"createButtonMenu":function createButtonMenu(itemdata){var itemset="";var _this=this;for(var i=0;i<itemdata.length;i++){var item=itemdata[i];if(item.value=="split"){itemset+=_this.split;}else {if(item.example=="more"){itemset+=luckysheet.replaceHtml(_this.item,{"value":item.value,"name":item.text,"example":"►","sub":"luckysheet-cols-submenu"});}else {itemset+=luckysheet.replaceHtml(_this.item,{"value":item.value,"name":item.text,"example":item.example,"sub":""});}}}return itemset;},cancelPaintModel:function cancelPaintModel(){var _this=this;$("#luckysheet-sheettable_0").removeClass("luckysheetPaintCursor");if(luckysheet_copy_save["dataSheetIndex"]==luckysheet.currentSheetIndex){luckysheet_selection_range=[];luckysheet.selectionCopyShow();}else {luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet_copy_save["dataSheetIndex"])].luckysheet_selection_range=[];}luckysheet_copy_save={};_this.luckysheetPaintModelOn=false;$("#luckysheetpopover").fadeOut(200,function(){$("#luckysheetpopover").remove();});},luckysheetPaintModelOn:false,luckysheetPaintSingle:false,"initialMenuButton":function initialMenuButton(){var _this=this;//格式刷
  $("#luckysheet-icon-paintformat").click(function(){if(luckysheet_select_save==null||luckysheet_select_save.length==0){if(luckysheet.isEditMode()){alert("请选择需要复制格式的区域");}else {luckysheet.tooltip.info("提示","请选择需要复制格式的区域");}return;}else if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("无法对多重选择区域执行此操作");}else {luckysheet.tooltip.info("提示","无法对多重选择区域执行此操作");}return;}luckysheet.tooltip.popover("<i class='fa fa-paint-brush'></i> 格式刷开启","topCenter",true,null,"ESC键退出",function(){//alert("关闭格式刷");
  // $("#luckysheet-sheettable_0").removeClass("luckysheetPaintCursor");
  // $("#luckysheet-selection-copy").hide();
  // luckysheet_selection_range=null;
  _this.cancelPaintModel();});$("#luckysheet-sheettable_0").addClass("luckysheetPaintCursor");luckysheet_selection_range=[{"row":luckysheet_select_save[0].row,"column":luckysheet_select_save[0].column}];luckysheet.selectionCopyShow();var RowlChange=false,HasMC=false;for(var r=luckysheet_select_save[0].row[0];r<=luckysheet_select_save[0].row[1];r++){if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null){continue;}if(config["rowlen"]!=null&&r in config["rowlen"]){RowlChange=true;}for(var c=luckysheet_select_save[0].column[0];c<=luckysheet_select_save[0].column[1];c++){var cell=luckysheet.flowdata[r][c];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell&&cell.mc.rs!=null){HasMC=true;}}}luckysheet_copy_save={"dataSheetIndex":luckysheet.currentSheetIndex,"copyRange":[{"row":luckysheet_select_save[0].row,"column":luckysheet_select_save[0].column}],"RowlChange":RowlChange,"HasMC":HasMC};_this.luckysheetPaintModelOn=true;_this.luckysheetPaintSingle=true;});$("#luckysheet-icon-paintformat").dblclick(function(){if(luckysheet_select_save==null||luckysheet_select_save.length==0){if(luckysheet.isEditMode()){alert("请选择需要复制格式的区域");}else {luckysheet.tooltip.info("提示","请选择需要复制格式的区域");}return;}else if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("无法对多重选择区域执行此操作");}else {luckysheet.tooltip.info("提示","无法对多重选择区域执行此操作");}return;}luckysheet.tooltip.popover("<i class='fa fa-paint-brush'></i> 格式刷开启","topCenter",true,null,"ESC键退出",function(){//alert("关闭格式刷");
  // $("#luckysheet-sheettable_0").removeClass("luckysheetPaintCursor");
  // $("#luckysheet-selection-copy").hide();
  // luckysheet_selection_range=null;
  _this.cancelPaintModel();});$("#luckysheet-sheettable_0").addClass("luckysheetPaintCursor");luckysheet_selection_range=[{"row":luckysheet_select_save[0].row,"column":luckysheet_select_save[0].column}];luckysheet.selectionCopyShow();var RowlChange=false,HasMC=false;for(var r=luckysheet_select_save[0].row[0];r<=luckysheet_select_save[0].row[1];r++){if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null){continue;}if(config["rowlen"]!=null&&r in config["rowlen"]){RowlChange=true;}for(var c=luckysheet_select_save[0].column[0];c<=luckysheet_select_save[0].column[1];c++){var cell=luckysheet.flowdata[r][c];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell&&cell.mc.rs!=null){HasMC=true;}}}luckysheet_copy_save={"dataSheetIndex":luckysheet.currentSheetIndex,"copyRange":[{"row":luckysheet_select_save[0].row,"column":luckysheet_select_save[0].column}],"RowlChange":RowlChange,"HasMC":HasMC};_this.luckysheetPaintModelOn=true;_this.luckysheetPaintSingle=false;});//货币格式
  $("#luckysheet-icon-currency").click(function(){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  _this.updateFormat(d,"ct","¥ #.00");});//百分比
  $("#luckysheet-icon-percent").click(function(){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  _this.updateFormat(d,"ct","0.00%");});//减少小数位数
  $("#luckysheet-icon-fmt-decimal-decrease").click(function(){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  var row_index=luckysheet_select_save[0]["row_focus"],col_index=luckysheet_select_save[0]["column_focus"];var foucsStatus=_this.checkstatus(d,row_index,col_index,"ct");var cell=d[row_index][col_index];if(foucsStatus==null||foucsStatus.t!="n"){return;}if(foucsStatus.fa=="General"){var mask=luckysheet.mask.genarate(cell.v);foucsStatus=mask[1];}//万亿格式
  var reg=/^(w|W)((0?)|(0\.0+))$/;if(reg.test(foucsStatus.fa)){if(foucsStatus.fa.indexOf(".")>-1){if(foucsStatus.fa.substr(-2)==".0"){_this.updateFormat(d,"ct",foucsStatus.fa.split(".")[0]);}else {_this.updateFormat(d,"ct",foucsStatus.fa.substr(0,foucsStatus.fa.length-1));}}else {_this.updateFormat(d,"ct",foucsStatus.fa);}return;}var prefix="",main="";if(foucsStatus.fa.indexOf(".")>-1){fa=foucsStatus.fa.split(".");prefix=fa[0];main=fa[1];}else {return;}var fa=main.split("");var tail="";for(i=fa.length-1;i>=0;i--){var c=fa[i];if(c!="#"&&c!="0"&&c!=","&&isNaN(parseInt(c))){tail=c+tail;}else {break;}}var fmt="";if(foucsStatus.fa.indexOf(".")>-1){var suffix=main;if(tail.length>0){suffix=main.replace(tail,"");}var pos=suffix.replace(/#/g,"0");pos=pos.substr(0,pos.length-1);if(pos==""){fmt=prefix+tail;}else {fmt=prefix+"."+pos+tail;}}_this.updateFormat(d,"ct",fmt);});//增加小数位数
  $("#luckysheet-icon-fmt-decimal-increase").click(function(){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  var row_index=luckysheet_select_save[0]["row_focus"],col_index=luckysheet_select_save[0]["column_focus"];var foucsStatus=_this.checkstatus(d,row_index,col_index,"ct");var cell=d[row_index][col_index];if(foucsStatus==null||foucsStatus.t!="n"){return;}if(foucsStatus.fa=="General"){var mask=luckysheet.mask.genarate(cell.v);foucsStatus=mask[1];}if(foucsStatus.fa=="General"){_this.updateFormat(d,"ct","#.0");return;}//万亿格式
  var reg=/^(w|W)((0?)|(0\.0+))$/;if(reg.test(foucsStatus.fa)){if(foucsStatus.fa.indexOf(".")>-1){_this.updateFormat(d,"ct",foucsStatus.fa+"0");}else {if(foucsStatus.fa.substr(-1)=="0"){_this.updateFormat(d,"ct",foucsStatus.fa+".0");}else {_this.updateFormat(d,"ct",foucsStatus.fa+"0.0");}}return;}var prefix="",main="";if(foucsStatus.fa.indexOf(".")>-1){fa=foucsStatus.fa.split(".");prefix=fa[0];main=fa[1];}else {main=foucsStatus.fa;}var fa=main.split("");var tail="";for(i=fa.length-1;i>=0;i--){var c=fa[i];if(c!="#"&&c!="0"&&c!=","&&isNaN(parseInt(c))){tail=c+tail;}else {break;}}var fmt="";if(foucsStatus.fa.indexOf(".")>-1){var suffix=main;if(tail.length>0){suffix=main.replace(tail,"");}var pos=suffix.replace(/#/g,"0");pos+="0";fmt=prefix+"."+pos+tail;}else {if(tail.length>0){fmt=main.replace(tail,"")+".0"+tail;}else {fmt=main+".0"+tail;}}_this.updateFormat(d,"ct",fmt);});//更多格式
  $("#luckysheet-icon-fmt-other").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var itemdata=[{"text":"自动","value":"General","example":""},{"text":"纯文本","value":"@","example":""},{"text":"","value":"split","example":""},{"text":"数字","value":"##0.00","example":"1000.12"},{"text":"百分比","value":"#0.00%","example":"12.21%"},{"text":"科学计数","value":"0.00E+00","example":"1.01E+5"},{"text":"","value":"split","example":""},{"text":"会计","value":"¥(0.00)","example":"¥(1200.09)"},//{ "text": "财务", "value": "(#.####)", "example": "(1200.09)" },
  {"text":"万元","value":"w","example":"1亿2000万2500"},{"text":"货币","value":"¥0.00","example":"¥1200.09"},//{ "text": "货币整数", "value": "¥####", "example": "¥1200" },
  {"text":"万元2位小数","value":"w0.00","example":"2万2500.55"},{"text":"","value":"split","example":""},{"text":"日期","value":"yyyy-MM-dd","example":"2017-11-29"},{"text":"时间","value":"hh:mm AM/PM","example":"3:00 PM"},{"text":"时间24H","value":"hh:mm","example":"15:00"},{"text":"日期时间","value":"yyyy-MM-dd hh:mm AM/PM","example":"2017-11-29 3:00 PM"},{"text":"日期时间24H","value":"yyyy-MM-dd hh:mm","example":"2017-11-29 15:00"},{"text":"","value":"split","example":""},{"text":"自定义格式","value":"fmtOtherSelf","example":"more"}];var itemset=_this.createButtonMenu(itemdata);// luckysheet-menuButton-sub
  var menu=luckysheet.replaceHtml(_this.menu,{"id":"fmt-other","item":itemset,"subclass":"","sub":""});var subitemdata=[{"text":"更多货币格式...","value":"morecurrency","example":""},{"text":"更多日期与时间格式...","value":"moredatetime","example":""},{"text":"更多数字格式...","value":"moredigit","example":""}];var subitemset=_this.createButtonMenu(subitemdata);var submenu=luckysheet.replaceHtml(_this.menu,{"id":"fmtOtherSelf","item":subitemset,"subclass":"luckysheet-menuButton-sub"});//luckysheet-icon-fmt-other-menuButton_sub
  $("body").append(menu+submenu);$menuButton=$("#"+menuButtonId).width(250);_this.focus($menuButton);$menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");if(itemvalue=="fmtOtherSelf"){return;}var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);//取数据
  _this.focus($menuButton,itemvalue);_this.updateFormat(d,"ct",itemvalue);});//更多格式
  $("#luckysheet-icon-fmtOtherSelf-menuButton").find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#luckysheet-icon-fmtOtherSelf-menuButton").hide();$("#"+container).attr("tabindex",0).focus();var itemvalue=$(this).attr("itemvalue");luckysheet.moreFormat.createDialog(itemvalue);luckysheet.moreFormat.init();});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft,$(this).offset().top+25,"lefttop");});//字体设置
  $("#luckysheet-icon-font-family").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var itemdata=[{"value":"0","text":"<span class='luckysheet-mousedown-cancel' style='font-size:16px;font-family:微软雅黑'>微软雅黑</span>","example":""},{"value":"1","text":"<span class='luckysheet-mousedown-cancel' style='font-size:16px;font-family:宋体'>宋体</span>","example":""},{"value":"2","text":"<span class='luckysheet-mousedown-cancel' style='font-size:16px;font-family:黑体'>黑体</span>","example":""},{"value":"3","text":"<span class='luckysheet-mousedown-cancel' style='font-size:16px;font-family:楷体'>楷体</span>","example":""},{"value":"4","text":"<span class='luckysheet-mousedown-cancel' style='font-size:16px;font-family:仿宋'>仿宋</span>","example":""},{"value":"5","text":"<span class='luckysheet-mousedown-cancel' style='font-size:16px;font-family:新宋体'>新宋体</span>","example":""},{"value":"6","text":"<span class='luckysheet-mousedown-cancel' style='font-size:16px;font-family:华文新魏'>华文新魏</span>","example":""},{"value":"7","text":"<span class='luckysheet-mousedown-cancel' style='font-size:16px;font-family:华文行楷'>华文行楷</span>","example":""},{"value":"8","text":"<span class='luckysheet-mousedown-cancel' style='font-size:16px;font-family:华文隶书'>华文隶书</span>","example":""},{"value":"9","text":"<span class='luckysheet-mousedown-cancel' style='font-size:16px;font-family:Arial'>Arial</span>","example":""},{"value":"10","text":"<span class='luckysheet-mousedown-cancel' style='font-size:16px;font-family:Times New Roman'>Times New Roman</span>","example":""},{"value":"11","text":"<span class='luckysheet-mousedown-cancel' style='font-size:16px;font-family:Tahoma'>Tahoma</span>","example":""},{"value":"12","text":"<span class='luckysheet-mousedown-cancel' style='font-size:16px;font-family:Verdana'>Verdana</span>","example":""}];var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"font-family","item":itemset,"subclass":"","sub":""});$("body").append(menu);$menuButton=$("#"+menuButtonId).width(150);_this.focus($menuButton);$menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue"),itemname=$t.attr("itemname");_this.focus($menuButton,itemvalue);$("#luckysheet-icon-font-family").find(".luckysheet-toolbar-menu-button-caption").html(" "+itemname+" ");var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat(d,"ff",itemvalue);});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft,$(this).offset().top+25,"lefttop");});//字体颜色
  $("#luckysheet-icon-text-color").click(function(){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var color=$(this).attr("color");if(color==null){color="#000000";}_this.updateFormat(d,"fc",color);});$("#luckysheet-icon-text-color-menu").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);console.log($menuButton.length);if($menuButton.length==0){var itemdata=[{"name":"交替颜色...","id":"luckysheet-color-alternate","example":""}];var itemset=_this.createButtonMenu(itemdata);var subid="text-color-self";var coloritem=luckysheet.replaceHtml(_this.coloritem,{"class":"luckysheet-icon-alternateformat","name":"交替颜色..."});// luckysheet-menuButton-sub
  var menu=luckysheet.replaceHtml(_this.color,{"id":menuButtonId,"coloritem":coloritem,"colorself":subid,"sub":""});//var submenu = luckysheet.replaceHtml(_this.subcolor, {"id": subid,  "subclass":"luckysheet-menuButton-sub"});
  //luckysheet-icon-fmt-other-menuButton_sub
  $("body").append(menu);$menuButton=$("#"+menuButtonId);// $menuButton.find(".luckysheet-cols-menuitem").click(function(){
  //     var $t = $(this), itemvalue = $t.attr("itemvalue");
  //     if(itemvalue=="fmtOtherSelf"){
  //         return;
  //     }
  //     _this.focus($menuButton, itemvalue);
  //     $menuButton.hide();
  // });
  //console.log(111)
  $("#"+menuButtonId).find(".luckysheet-color-selected").spectrum({showPalette:true,showPaletteOnly:true,preferredFormat:"hex",clickoutFiresChange:false,showInitial:true,showInput:true,flat:true,hideAfterPaletteSelect:true,showSelectionPalette:true,maxPaletteSize:8,maxSelectionSize:8,cancelText:"取消",chooseText:"确定颜色",togglePaletteMoreText:"自定义",togglePaletteLessText:"收起",togglePaletteOnly:true,clearText:"清除颜色选择",color:"#000",noColorSelectedText:"没有颜色被选择",localStorageKey:"spectrum.textcolor"+luckysheet.server.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function change(color){var $input=$(this);if(color!=null){color=color.toHexString();}else {color="#000";}$("#luckysheet-icon-text-color .luckysheet-color-menu-button-indicator").css("border-bottom-color",color);// var $input = $("#"+ menuButtonId).find(".luckysheet-color-selected");
  // $input.spectrum("set", $input.val());
  $("#luckysheet-icon-text-color").attr("color",color);var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat(d,"fc",color);$menuButton.hide();$("#"+container).attr("tabindex",0).focus();}});$menuButton.find(".luckysheet-color-reset").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $input=$("#"+menuButtonId).find(".luckysheet-color-selected");$input.val("#000000");$("#luckysheet-icon-text-color").attr("color",null);$input.spectrum("set","#000000");$("#luckysheet-icon-text-color .luckysheet-color-menu-button-indicator").css("border-bottom-color","#000000");var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat(d,"fc",null);});//交替颜色
  $menuButton.find(".luckysheet-icon-alternateformat").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选择区域执行此操作，请选择单个区域，然后再试","");}return;}var range=$.extend(true,{},luckysheet_select_save[0]);var isExists=luckysheet.alternateformat.rangeIsExists(range)[0];if(!isExists){luckysheet.alternateformat.modelfocusIndex=0;luckysheet.alternateformat["new"](range);}luckysheet.alternateformat.init();luckysheet.alternateformat.perfect();});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}var offsetTop=$(this).offset().top+26;setTimeout(function(){var $input=$("#"+menuButtonId).find(".luckysheet-color-selected");$input.spectrum("set",$input.val());mouseclickposition($menuButton,menuleft-28,offsetTop,"lefttop");},1);});//背景颜色
  $("#luckysheet-icon-cell-color").click(function(){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var color=$(this).attr("color");if(color==null){color="#ffffff";}_this.updateFormat(d,"bg",color);});$("#luckysheet-icon-cell-color-menu").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var subid="cell-color-self";var coloritem=luckysheet.replaceHtml(_this.coloritem,{"class":"luckysheet-icon-alternateformat","name":"交替颜色..."});var menu=luckysheet.replaceHtml(_this.color,{"id":menuButtonId,"coloritem":coloritem,"colorself":subid,"sub":""});$("body").append(menu);$menuButton=$("#"+menuButtonId);$("#"+menuButtonId).find(".luckysheet-color-selected").spectrum({showPalette:true,showPaletteOnly:true,preferredFormat:"hex",clickoutFiresChange:false,showInitial:true,showInput:true,flat:true,hideAfterPaletteSelect:true,showSelectionPalette:true,maxPaletteSize:8,maxSelectionSize:8,color:"#fff",cancelText:"取消",chooseText:"确定颜色",togglePaletteMoreText:"自定义",togglePaletteLessText:"收起",togglePaletteOnly:true,clearText:"清除颜色选择",noColorSelectedText:"没有颜色被选择",localStorageKey:"spectrum.bgcolor"+luckysheet.server.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function change(color){var $input=$(this);if(color!=null){color=color.toHexString();}else {color="#fff";}$("#luckysheet-icon-cell-color .luckysheet-color-menu-button-indicator").css("border-bottom-color",color);$("#luckysheet-icon-cell-color").attr("color",color);var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat(d,"bg",color);$menuButton.hide();$("#"+container).attr("tabindex",0).focus();}});$menuButton.find(".luckysheet-color-reset").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $input=$("#"+menuButtonId).find(".luckysheet-color-selected");$input.val("#ffffff");$("#luckysheet-icon-cell-color").attr("color",null);$input.spectrum("set","#ffffff");$("#luckysheet-icon-cell-color .luckysheet-color-menu-button-indicator").css("border-bottom-color","#ffffff");var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat(d,"bg",null);});//交替颜色
  $menuButton.find(".luckysheet-icon-alternateformat").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet_select_save.length>1){if(luckysheet.isEditMode()){alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试");}else {luckysheet.tooltip.info("不能对多重选择区域执行此操作，请选择单个区域，然后再试","");}return;}var range=$.extend(true,{},luckysheet_select_save[0]);var isExists=luckysheet.alternateformat.rangeIsExists(range)[0];if(!isExists){luckysheet.alternateformat.modelfocusIndex=0;luckysheet.alternateformat["new"](range);}luckysheet.alternateformat.init();luckysheet.alternateformat.perfect();});$("#"+menuButtonId).find(".luckysheet-color-selected").val("#fff");}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}var offsetTop=$(this).offset().top+26;setTimeout(function(){var $input=$("#"+menuButtonId).find(".luckysheet-color-selected");$input.spectrum("set",$input.val());mouseclickposition($menuButton,menuleft-28,offsetTop,"lefttop");},1);});//字体大小
  var luckysheet_fs_setTimeout=null;$("#luckysheet-icon-font-size").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var itemdata=[{"text":"9","value":"9","example":""},{"text":"10","value":"10","example":""},{"text":"11","value":"11","example":""},{"text":"12","value":"12","example":""},{"text":"14","value":"14","example":""},{"text":"16","value":"16","example":""},{"text":"18","value":"18","example":""},{"text":"20","value":"20","example":""},{"text":"22","value":"22","example":""},{"text":"24","value":"24","example":""},{"text":"26","value":"26","example":""},{"text":"28","value":"28","example":""},{"text":"36","value":"36","example":""},{"text":"48","value":"48","example":""},{"text":"72","value":"72","example":""}];var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"font-size","item":itemset,"subclass":"","sub":""});$("body").append(menu);$menuButton=$("#"+menuButtonId).width(150);_this.focus($menuButton,10);$menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue"),$input=$("#luckysheet-icon-font-size input");$("#luckysheet-icon-font-size").attr("itemvalue",itemvalue);_this.focus($menuButton,itemvalue);$input.val(itemvalue);var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat(d,"fs",itemvalue);clearTimeout(luckysheet_fs_setTimeout);});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var defualtvalue=$("#luckysheet-icon-font-size").attr("itemvalue");if(defualtvalue==null){defualtvalue=10;}_this.focus($menuButton,defualtvalue);var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft,$(this).offset().top+25,"lefttop");});// .find("input.luckysheet-toolbar-textinput").blur(function(){
  //     var itemvalue = parseInt($(this).val());
  //     var $menuButton = $("#luckysheet-icon-font-size-menuButton");
  //     _this.focus($menuButton, itemvalue);
  //     var d = luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);
  //     _this.updateFormat(d, "fs", itemvalue);
  //     luckysheet_fs_setTimeout = setTimeout(function(){
  //         $menuButton.hide();
  //     }, 200);
  // });
  //边框设置
  $("#luckysheet-icon-border-all").click(function(){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var type=$(this).attr("type");if(type==null){type="border-all";}var subcolormenuid="luckysheet-icon-borderColor-menuButton";var color=$("#"+subcolormenuid).find(".luckysheet-color-selected").val();var style=$("#luckysheetborderSizepreview").attr("itemvalue");if(color==null||color==""){color="#000";}if(style==null||style==""){style="1";}var cfg=$.extend(true,{},config);if(cfg["borderInfo"]==null){cfg["borderInfo"]=[];}var borderInfo={"rangeType":"range","borderType":type,"color":color,"style":style,"range":luckysheet_select_save};cfg["borderInfo"].push(borderInfo);if(clearjfundo){luckysheet.jfundo=[];var redo=[];redo["type"]="borderChange";redo["config"]=$.extend(true,{},config);redo["curconfig"]=$.extend(true,{},cfg);redo["sheetIndex"]=luckysheet.currentSheetIndex;luckysheet.jfredo.push(redo);}luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,cfg["borderInfo"],{"k":"borderInfo"});config=cfg;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);});$("#luckysheet-icon-border-menu").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var canvasH=10,canvasW=120;var itemdata=[{"text":"上框线","value":"border-top","example":'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-top" style="user-select: none;"> </div> </div>'},{"text":"下框线","value":"border-bottom","example":'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-bottom" style="user-select: none;"> </div> </div>'},{"text":"左框线","value":"border-left","example":'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-left" style="user-select: none;"> </div> </div>'},{"text":"右框线","value":"border-right","example":'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-right" style="user-select: none;"> </div> </div>'},{"text":"","value":"split","example":""},{"text":"无","value":"border-none","example":'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-none" style="user-select: none;"> </div> </div>'},{"text":"所有","value":"border-all","example":'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-all" style="user-select: none;"> </div> </div>'},{"text":"外侧","value":"border-outside","example":'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-outside" style="user-select: none;"> </div> </div>'},{"text":"","value":"split","example":""},{"text":"内侧","value":"border-inside","example":'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-inside" style="user-select: none;"> </div> </div>'},{"text":"内侧横线","value":"border-horizontal","example":'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-horizontal" style="user-select: none;"> </div> </div>'},{"text":"内侧竖线","value":"border-vertical","example":'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-vertical" style="user-select: none;"> </div> </div>'},{"text":"","value":"split","example":""},{"text":"<span id='luckysheet-icon-borderColor-linecolor' class='luckysheet-mousedown-cancel' style='border-bottom:3px solid #000;'>边框颜色</span>","value":"borderColor","example":"more"},{"text":"边框粗细<img id='luckysheetborderSizepreview' width=100 height=10 src='data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==' style='position:absolute;bottom:-5px;right:0px;width:100px;height:10px;'>","value":"borderSize","example":"more"}];var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"border-menu","item":itemset,"subclass":"","sub":""});var subitemdata=[{"text":"无边框","value":"0","example":""},{"text":"<canvas type='Thin' class='border-Thin' width="+canvasW+" height="+canvasH+" style='width:"+canvasW+"px;height:"+canvasH+"px;position:static;'></canvas>","value":"1","example":""},{"text":"<canvas type='Hair' class='border-Hair' width="+canvasW+" height="+canvasH+" style='width:"+canvasW+"px;height:"+canvasH+"px;position:static;'></canvas>","value":"2","example":""},{"text":"<canvas type='Dotted' class='border-Dotted' width="+canvasW+" height="+canvasH+" style='width:"+canvasW+"px;height:"+canvasH+"px;position:static;'></canvas>","value":"3","example":""},{"text":"<canvas type='Dashed' class='border-Dashed' width="+canvasW+" height="+canvasH+" style='width:"+canvasW+"px;height:"+canvasH+"px;position:static;'></canvas>","value":"4","example":""},{"text":"<canvas type='DashDot' class='border-DashDot' width="+canvasW+" height="+canvasH+" style='width:"+canvasW+"px;height:"+canvasH+"px;position:static;'></canvas>","value":"5","example":""},{"text":"<canvas type='DashDotDot' class='border-DashDotDot' width="+canvasW+" height="+canvasH+" style='width:"+canvasW+"px;height:"+canvasH+"px;position:static;'></canvas>","value":"6","example":""},// {"text":"<canvas type='Double' class='border-Double' width="+ canvasW +" height="+ canvasH +" style='width:"+ canvasW +"px;height:"+ canvasH +"px;position:static;'></canvas>", "value":"7", "example":""},
  {"text":"<canvas type='Medium' class='border-Medium' width="+canvasW+" height="+canvasH+" style='width:"+canvasW+"px;height:"+canvasH+"px;position:static;'></canvas>","value":"8","example":""},{"text":"<canvas type='MediumDashed' class='border-MediumDashed' width="+canvasW+" height="+canvasH+" style='width:"+canvasW+"px;height:"+canvasH+"px;position:static;'></canvas>","value":"9","example":""},{"text":"<canvas type='MediumDashDot' class='border-MediumDashDot' width="+canvasW+" height="+canvasH+" style='width:"+canvasW+"px;height:"+canvasH+"px;position:static;'></canvas>","value":"10","example":""},{"text":"<canvas type='MediumDashDotDot' class='border-MediumDashDotDot' width="+canvasW+" height="+canvasH+" style='width:"+canvasW+"px;height:"+canvasH+"px;position:static;'></canvas>","value":"11","example":""},// {"text":"<canvas type='SlantedDashDot' class='border-SlantedDashDot' width="+ canvasW +" height="+ canvasH +" style='width:"+ canvasW +"px;height:"+ canvasH +"px;position:static;'></canvas>", "value":"12", "example":""},
  {"text":"<canvas type='Thick' class='border-Thick' width="+canvasW+" height="+canvasH+" style='width:"+canvasW+"px;height:"+canvasH+"px;position:static;'></canvas>","value":"13","example":""}];var subitemset=_this.createButtonMenu(subitemdata);var submenu=luckysheet.replaceHtml(_this.menu,{"id":"borderSize","item":subitemset,"subclass":"luckysheet-menuButton-sub"});var submenuid="luckysheet-icon-borderSize-menuButton";var subcolormenuid="luckysheet-icon-borderColor-menuButton";var colormenu=luckysheet.replaceHtml(_this.color,{"id":subcolormenuid,"coloritem":"","colorself":"","sub":"luckysheet-menuButton-sub"});$("body").append(menu+colormenu+submenu);$menuButton=$("#"+menuButtonId).width(150);_this.focus($menuButton,"border-all");$("#"+submenuid+" canvas").each(function(i){var type=$(this).attr("type");var itemvalue=$(this).closest(".luckysheet-cols-menuitem").attr("itemvalue");var canvasborder=$(this).addClass("luckysheet-mousedown-cancel").get(0).getContext("2d");canvasborder.translate(0.5,0.5);_this.setLineDash(canvasborder,itemvalue,"h",0,5,100,5);canvasborder.strokeStyle="#000000";canvasborder.stroke();canvasborder.closePath();});$("#"+submenuid+" .luckysheet-cols-menuitem").click(function(){$("#"+submenuid).hide();var $t=$(this),itemvalue=$t.attr("itemvalue");if(itemvalue==0){$("#luckysheetborderSizepreview").attr("src","data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==").attr("itemvalue",null);}else {var bg=$t.find("canvas").get(0).toDataURL("image/png");$("#luckysheetborderSizepreview").attr("src",bg).attr("itemvalue",itemvalue);}_this.focus($("#"+submenuid),itemvalue);});$menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");if(itemvalue=="borderColor"||itemvalue=="borderSize"){return;}var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var color=$("#"+subcolormenuid).find(".luckysheet-color-selected").val();var style=$("#luckysheetborderSizepreview").attr("itemvalue");if(color==null||color==""){color="#000";}if(style==null||style==""){style="1";}var cfg=$.extend(true,{},config);if(cfg["borderInfo"]==null){cfg["borderInfo"]=[];}var borderInfo={"rangeType":"range","borderType":itemvalue,"color":color,"style":style,"range":luckysheet_select_save};cfg["borderInfo"].push(borderInfo);if(clearjfundo){luckysheet.jfundo=[];var redo=[];redo["type"]="borderChange";redo["config"]=$.extend(true,{},config);redo["curconfig"]=$.extend(true,{},cfg);redo["sheetIndex"]=luckysheet.currentSheetIndex;luckysheet.jfredo.push(redo);}luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,cfg["borderInfo"],{"k":"borderInfo"});config=cfg;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);$("#luckysheet-icon-border-all").attr("type",itemvalue);var $icon=$("#luckysheet-icon-border-all").find(".luckysheet-icon-img-container");$icon.removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-"+itemvalue);_this.focus($menuButton,itemvalue);});$("#"+subcolormenuid).find(".luckysheet-color-selected").spectrum({showPalette:true,showPaletteOnly:true,preferredFormat:"hex",clickoutFiresChange:false,showInitial:true,showInput:true,flat:true,hideAfterPaletteSelect:true,showSelectionPalette:true,maxPaletteSize:8,maxSelectionSize:8,color:"#000",cancelText:"取消",chooseText:"确定颜色",togglePaletteMoreText:"自定义",togglePaletteLessText:"收起",togglePaletteOnly:true,clearText:"清除颜色选择",noColorSelectedText:"没有颜色被选择",localStorageKey:"spectrum.bordercolor"+luckysheet.server.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function change(color){var $input=$(this);if(color!=null){color=color.toHexString();}else {color="#000";}$("#luckysheet-icon-borderColor-linecolor").css("border-bottom-color",color);$("#"+subcolormenuid).find(".luckysheet-color-selected").val(color);}});$("#"+subcolormenuid).find(".luckysheet-color-reset").click(function(){var $input=$("#"+subcolormenuid).find(".luckysheet-color-selected");$input.val("#000");$("#luckysheet-icon-cell-color").attr("color",null);$input.spectrum("set","#000");$("#luckysheet-icon-borderColor-linecolor").css("border-bottom-color","#000");// var d = luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);
  // _this.updateFormat(d, "bg", null);
  // $menuButton.hide();
  });}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft-28,$(this).offset().top+25,"lefttop");});//合并单元格
  $("#luckysheet-icon-merge-button").click(function(){if(luckysheet.selectIsOverlap()){if(luckysheet.isEditMode()){alert("不能合并重叠区域");}else {luckysheet.tooltip.info("不能合并重叠区域","");}return;}if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}}var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat_mc(d,"mergeAll");});$("#luckysheet-icon-merge-menu").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var itemdata=[{"text":"全部合并","value":"mergeAll","example":""},{"text":"垂直合并","value":"mergeV","example":""},{"text":"水平合并","value":"mergeH","example":""},{"text":"取消合并","value":"mergeCancel","example":""}];var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"merge-menu","item":itemset,"subclass":"","sub":""});$("body").append(menu);$menuButton=$("#"+menuButtonId).width(100);_this.focus($menuButton);$menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();if(luckysheet.selectIsOverlap()){if(luckysheet.isEditMode()){alert("不能合并重叠区域");}else {luckysheet.tooltip.info("不能合并重叠区域","");}return;}if(config["merge"]!=null){var hasPartMC=false;for(var s=0;s<luckysheet_select_save.length;s++){var r1=luckysheet_select_save[s].row[0],r2=luckysheet_select_save[s].row[1];var c1=luckysheet_select_save[s].column[0],c2=luckysheet_select_save[s].column[1];hasPartMC=luckysheet.hasPartMC(config,r1,r2,c1,c2);if(hasPartMC){break;}}if(hasPartMC){if(luckysheet.isEditMode()){alert("无法对部分合并单元格执行此操作");}else {luckysheet.tooltip.info("无法对部分合并单元格执行此操作","");}return;}}var $t=$(this),itemvalue=$t.attr("itemvalue");_this.focus($menuButton,itemvalue);var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat_mc(d,itemvalue);});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft-28,$(this).offset().top+25,"lefttop");});//水平对齐
  $("#luckysheet-icon-align").click(function(){var itemvalue=$("#luckysheet-icon-align").attr("type");if(itemvalue==null){itemvalue="left";}var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat(d,"ht",itemvalue);});$("#luckysheet-icon-align-menu").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var itemdata=[{"text":"左对齐","value":"left","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-left" style="user-select: none;"> </div> </div>'},{"text":"中间对齐","value":"center","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-center" style="user-select: none;"> </div> </div>'},{"text":"右对齐","value":"right","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-right" style="user-select: none;"> </div> </div>'}];var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"align-menu","item":itemset,"subclass":"","sub":""});$("body").append(menu);$menuButton=$("#"+menuButtonId).width(120);_this.focus($menuButton);$menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");_this.focus($menuButton,itemvalue);var $icon=$("#luckysheet-icon-align").attr("type",itemvalue).find(".luckysheet-icon-img-container");$icon.removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-"+itemvalue);var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat(d,"ht",itemvalue);});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft-28,$(this).offset().top+25,"lefttop");});//垂直对齐
  $("#luckysheet-icon-valign").click(function(){var itemvalue=$("#luckysheet-icon-valign").attr("type");if(itemvalue==null){itemvalue="bottom";}var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat(d,"vt",itemvalue);});$("#luckysheet-icon-valign-menu").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var itemdata=[{"text":"顶部对齐","value":"top","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-top" style="user-select: none;"> </div> </div>'},{"text":"居中对齐","value":"middle","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-middle" style="user-select: none;"> </div> </div>'},{"text":"底部对齐","value":"bottom","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-bottom" style="user-select: none;"> </div> </div>'}];var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"valign-menu","item":itemset,"subclass":"","sub":""});$("body").append(menu);$menuButton=$("#"+menuButtonId).width(120);_this.focus($menuButton,"bottom");$menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");_this.focus($menuButton,itemvalue);var $icon=$("#luckysheet-icon-valign").attr("type",itemvalue).find(".luckysheet-icon-img-container");$icon.removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-"+itemvalue);var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat(d,"vt",itemvalue);});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft-28,$(this).offset().top+25,"lefttop");});//文本换行
  $("#luckysheet-icon-textwrap-menu").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var itemdata=[{"text":"溢出","value":"overflow","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-overflow" style="user-select: none;"> </div> </div>'},{"text":"自动换行","value":"wrap","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-wrap" style="user-select: none;"> </div> </div>'},{"text":"截断","value":"clip","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-clip" style="user-select: none;"> </div> </div>'}];var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"textwrap-menu","item":itemset,"subclass":"","sub":""});$("body").append(menu);$menuButton=$("#"+menuButtonId).width(120);_this.focus($menuButton);$menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");_this.focus($menuButton,itemvalue);var $icon=$("#luckysheet-icon-textwrap").attr("type",itemvalue).find(".luckysheet-icon-img-container");$icon.removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-"+itemvalue);var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat(d,"tb",itemvalue);});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft-28,$(this).offset().top+25,"lefttop");});//文本旋转
  $("#luckysheet-icon-rotation-menu").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var itemdata=[{"text":"无旋转","value":"none","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-none" style="user-select: none;"> </div> </div>'},{"text":"向上倾斜","value":"angleup","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-angleup" style="user-select: none;"> </div> </div>'},{"text":"向下倾斜","value":"angledown","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-angledown" style="user-select: none;"> </div> </div>'},{"text":"竖排文字","value":"vertical","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-vertical" style="user-select: none;"> </div> </div>'},{"text":"向上90°","value":"rotation-up","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-rotation-up" style="user-select: none;"> </div> </div>'},{"text":"向下90°","value":"rotation-down","example":'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-rotation-down" style="user-select: none;"> </div> </div>'}];var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"rotation-menu","item":itemset,"subclass":"","sub":""});$("body").append(menu);$menuButton=$("#"+menuButtonId).width(120);_this.focus($menuButton);$menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");_this.focus($menuButton,itemvalue);var $icon=$("#luckysheet-icon-rotation").attr("type",itemvalue).find(".luckysheet-icon-img-container");$icon.removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-"+itemvalue);var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);_this.updateFormat(d,"tr",itemvalue);});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft-28,$(this).offset().top+25,"lefttop");});//冻结行列
  $("#luckysheet-icon-freezen-menu").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var itemdata=[{"text":"冻结首行","value":"freezenRow","example":''},{"text":"冻结首列","value":"freezenColumn","example":''},{"text":"冻结行列","value":"freezenRC","example":''},{"text":"","value":"split","example":""},{"text":"冻结行到选区","value":"freezenRowRange","example":''},{"text":"冻结列到选区","value":"freezenColumnRange","example":''},{"text":"冻结行列到选区","value":"freezenRCRange","example":''},{"text":"","value":"split","example":""},{"text":"取消冻结","value":"freezenCancel","example":''}];var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"freezen-menu","item":itemset,"subclass":"","sub":""});$("body").append(menu);$menuButton=$("#"+menuButtonId).width(130);$menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");_this.focus($menuButton,itemvalue);if(itemvalue=="freezenRow"){//首行冻结
  var scrollTop=$("#luckysheet-cell-main").scrollTop();var row_st=luckysheet_searcharray(visibledatarow,scrollTop);if(row_st==-1){row_st=0;}var top=visibledatarow[row_st]-2-scrollTop+columeHeaderHeight;var freezenhorizontaldata=[visibledatarow[row_st],row_st+1,scrollTop,luckysheet.freezen.cutVolumn(visibledatarow,row_st+1),top];luckysheet.freezen.saveFreezen(freezenhorizontaldata,top,null,null);if(luckysheet.freezen.freezenverticaldata!=null){luckysheet.freezen.cancelFreezenVertical();luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}luckysheet.freezen.createFreezenHorizontal(freezenhorizontaldata,top);luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}else if(itemvalue=="freezenColumn"){//首列冻结
  var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var col_st=luckysheet_searcharray(visibledatacolumn,scrollLeft);if(col_st==-1){col_st=0;}var left=visibledatacolumn[col_st]-2-scrollLeft+rowHeaderWidth;var freezenverticaldata=[visibledatacolumn[col_st],col_st+1,scrollLeft,luckysheet.freezen.cutVolumn(visibledatacolumn,col_st+1),left];luckysheet.freezen.saveFreezen(null,null,freezenverticaldata,left);if(luckysheet.freezen.freezenhorizontaldata!=null){luckysheet.freezen.cancelFreezenHorizontal();luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}luckysheet.freezen.createFreezenVertical(freezenverticaldata,left);luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}else if(itemvalue=="freezenRC"){//首行列冻结
  var scrollTop=$("#luckysheet-cell-main").scrollTop();var row_st=luckysheet_searcharray(visibledatarow,scrollTop);if(row_st==-1){row_st=0;}var top=visibledatarow[row_st]-2-scrollTop+columeHeaderHeight;var freezenhorizontaldata=[visibledatarow[row_st],row_st+1,scrollTop,luckysheet.freezen.cutVolumn(visibledatarow,row_st+1),top];luckysheet.freezen.saveFreezen(freezenhorizontaldata,top,null,null);luckysheet.freezen.createFreezenHorizontal(freezenhorizontaldata,top);var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var col_st=luckysheet_searcharray(visibledatacolumn,scrollLeft);if(col_st==-1){col_st=0;}var left=visibledatacolumn[col_st]-2-scrollLeft+rowHeaderWidth;var freezenverticaldata=[visibledatacolumn[col_st],col_st+1,scrollLeft,luckysheet.freezen.cutVolumn(visibledatacolumn,col_st+1),left];luckysheet.freezen.saveFreezen(null,null,freezenverticaldata,left);luckysheet.freezen.createFreezenVertical(freezenverticaldata,left);luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}else if(itemvalue=="freezenRowRange"){//选区行冻结
  if(luckysheet_select_save==null||luckysheet_select_save.length==0){if(luckysheet.isEditMode()){alert("没有选区");}else {luckysheet.tooltip.info("没有选区","");}return;}var scrollTop=$("#luckysheet-cell-main").scrollTop();var row_st=luckysheet_searcharray(visibledatarow,scrollTop);var last=luckysheet_select_save[luckysheet_select_save.length-1];var row_focus=last["row_focus"]==null?last["row"][0]:last["row_focus"];if(row_focus>row_st){row_st=row_focus;}if(row_st==-1){row_st=0;}var top=visibledatarow[row_st]-2-scrollTop+columeHeaderHeight;var freezenhorizontaldata=[visibledatarow[row_st],row_st+1,scrollTop,luckysheet.freezen.cutVolumn(visibledatarow,row_st+1),top];luckysheet.freezen.saveFreezen(freezenhorizontaldata,top,null,null);if(luckysheet.freezen.freezenverticaldata!=null){luckysheet.freezen.cancelFreezenVertical();luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}luckysheet.freezen.createFreezenHorizontal(freezenhorizontaldata,top);luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}else if(itemvalue=="freezenColumnRange"){//选区列冻结
  if(luckysheet_select_save==null||luckysheet_select_save.length==0){if(luckysheet.isEditMode()){alert("没有选区");}else {luckysheet.tooltip.info("没有选区","");}return;}var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var col_st=luckysheet_searcharray(visibledatacolumn,scrollLeft);var last=luckysheet_select_save[luckysheet_select_save.length-1];var column_focus=last["column_focus"]==null?last["column"][0]:last["column_focus"];if(column_focus>col_st){col_st=column_focus;}if(col_st==-1){col_st=0;}var left=visibledatacolumn[col_st]-2-scrollLeft+rowHeaderWidth;var freezenverticaldata=[visibledatacolumn[col_st],col_st+1,scrollLeft,luckysheet.freezen.cutVolumn(visibledatacolumn,col_st+1),left];luckysheet.freezen.saveFreezen(null,null,freezenverticaldata,left);if(luckysheet.freezen.freezenhorizontaldata!=null){luckysheet.freezen.cancelFreezenHorizontal();luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}luckysheet.freezen.createFreezenVertical(freezenverticaldata,left);luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}else if(itemvalue=="freezenRCRange"){//选区行列冻结
  if(luckysheet_select_save==null||luckysheet_select_save.length==0){if(luckysheet.isEditMode()){alert("没有选区");}else {luckysheet.tooltip.info("没有选区","");}return;}var scrollTop=$("#luckysheet-cell-main").scrollTop();var row_st=luckysheet_searcharray(visibledatarow,scrollTop);var last=luckysheet_select_save[luckysheet_select_save.length-1];var row_focus=last["row_focus"]==null?last["row"][0]:last["row_focus"];if(row_focus>row_st){row_st=row_focus;}if(row_st==-1){row_st=0;}var top=visibledatarow[row_st]-2-scrollTop+columeHeaderHeight;var freezenhorizontaldata=[visibledatarow[row_st],row_st+1,scrollTop,luckysheet.freezen.cutVolumn(visibledatarow,row_st+1),top];luckysheet.freezen.saveFreezen(freezenhorizontaldata,top,null,null);luckysheet.freezen.createFreezenHorizontal(freezenhorizontaldata,top);var scrollLeft=$("#luckysheet-cell-main").scrollLeft();var col_st=luckysheet_searcharray(visibledatacolumn,scrollLeft);var last=luckysheet_select_save[luckysheet_select_save.length-1];var column_focus=last["column_focus"]==null?last["column"][0]:last["column_focus"];if(column_focus>col_st){col_st=column_focus;}if(col_st==-1){col_st=0;}var left=visibledatacolumn[col_st]-2-scrollLeft+rowHeaderWidth;var freezenverticaldata=[visibledatacolumn[col_st],col_st+1,scrollLeft,luckysheet.freezen.cutVolumn(visibledatacolumn,col_st+1),left];luckysheet.freezen.saveFreezen(null,null,freezenverticaldata,left);luckysheet.freezen.createFreezenVertical(freezenverticaldata,left);luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}else if(itemvalue=="freezenCancel"){//取消冻结
  if(luckysheet.freezen.freezenverticaldata!=null){luckysheet.freezen.cancelFreezenVertical();luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}if(luckysheet.freezen.freezenhorizontaldata!=null){luckysheet.freezen.cancelFreezenHorizontal();luckysheet.freezen.createAssistCanvas();luckysheet.luckysheetrefreshgrid();}luckysheet.freezen.scrollAdapt();}setTimeout(function(){luckysheet.luckysheetsizeauto();},0);});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft-68,$(this).offset().top+25,"lefttop");});//过滤和排序
  $("#luckysheet-icon-autofilter").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var itemdata=[{"text":"升序","value":"asc","example":'<i style="font-size:14px;" class="fa fa-sort-numeric-asc" aria-hidden="true"></i>'},{"text":"降序","value":"desc","example":'<i style="font-size:14px;" class="fa fa-sort-numeric-desc" aria-hidden="true"></i>'},{"text":"自定义排序...","value":"diysort","example":'<i style="font-size:14px;" class="fa fa-sort" aria-hidden="true"></i>'},{"text":"","value":"split","example":""},{"text":"筛选","value":"filter","example":'<i style="font-size:14px;" class="fa fa-filter" aria-hidden="true"></i>'},{"text":"清除筛选","value":"clearfilter","example":'<i style="font-size:14px;" class="fa fa-window-close" aria-hidden="true"></i>'}];var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"autofilter","item":itemset,"subclass":"","sub":""});$("body").append(menu);$menuButton=$("#"+menuButtonId).width(150);//_this.focus($menuButton);
  $menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");//_this.focus($menuButton, itemvalue);
  if(itemvalue=="diysort"){$("#luckysheetorderby").click();}else if(itemvalue=="asc"){luckysheet.sortSelection(true);}else if(itemvalue=="desc"){luckysheet.sortSelection(false);}else if(itemvalue=="filter"){if($('#luckysheet-filter-options-sheet'+luckysheet.currentSheetIndex).length>0){$("#luckysheet-filter-initial").click();}else {luckysheet.createFilter();}}else if(itemvalue=="clearfilter"){$("#luckysheet-filter-initial").click();}});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft,$(this).offset().top+25,"lefttop");});//查找和替换
  $("#luckysheet-icon-seachmore").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var itemdata=[{"text":"查找 ...","value":"search","example":'<i style="font-size:14px;" class="fa fa-search" aria-hidden="true"></i>'},{"text":"替换 ...","value":"replace","example":'<i style="font-size:14px;" class="fa fa-files-o" aria-hidden="true"></i>'},{"text":"转到 ...","value":"goto","example":'<i style="font-size:14px;" class="fa fa-arrow-right" aria-hidden="true"></i>'},{"text":"","value":"split","example":""},{"text":"定位条件 ...","value":"location","example":'<i style="font-size:14px;" class="fa fa-location-arrow" aria-hidden="true"></i>'},{"text":"公式","value":"locationFormula","example":'定位'},{"text":"日期","value":"locationConstantDate","example":'定位'},{"text":"数字","value":"locationConstantNumber","example":'定位'},{"text":"字符","value":"locationConstantString","example":'定位'},{"text":"错误","value":"locationConstantError","example":'定位'},{"text":"条件格式","value":"locationCF","example":'定位'},{"text":"间隔行","value":"locationStepRow","example":'定位'},{"text":"间隔列","value":"locationStepColumn","example":'定位'}];var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"seachmore","item":itemset,"subclass":"","sub":""});$("body").append(menu);$menuButton=$("#"+menuButtonId).width(150);//_this.focus($menuButton);
  $menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");//_this.focus($menuButton, itemvalue);
  if(itemvalue=="search"||itemvalue=="replace"){//查找替换
  if(itemvalue=="search"){luckysheet.searchReplace.createDialog(0);}else if(itemvalue=="replace"){luckysheet.searchReplace.createDialog(1);}luckysheet.searchReplace.init();$("#luckysheet-search-replace #searchInput input").focus();}else if(itemvalue=="location"){//定位条件
  luckysheet.locationCell.createDialog();luckysheet.locationCell.init();}else if(itemvalue=="locationFormula"||itemvalue=="locationConstantDate"||itemvalue=="locationConstantNumber"||itemvalue=="locationConstantString"||itemvalue=="locationConstantError"||itemvalue=="locationCF"){if(luckysheet_select_save.length==0||luckysheet_select_save.length==1&&luckysheet_select_save[0].row[0]==luckysheet_select_save[0].row[1]&&luckysheet_select_save[0].column[0]==luckysheet_select_save[0].column[1]){//单个单元格
  var range=[{"row":[0,luckysheet.flowdata.length-1],"column":[0,luckysheet.flowdata[0].length-1]}];}else {var range=$.extend(true,[],luckysheet_select_save);}if(itemvalue=="locationFormula"){//公式
  luckysheet.locationCell.apply(range,"locationFormula","all");}else if(itemvalue=="locationConstantDate"){//日期
  luckysheet.locationCell.apply(range,"locationConstant","d");}else if(itemvalue=="locationConstantNumber"){//数字
  luckysheet.locationCell.apply(range,"locationConstant","n");}else if(itemvalue=="locationConstantString"){//字符
  luckysheet.locationCell.apply(range,"locationConstant","s,g");}else if(itemvalue=="locationConstantError"){//错误
  luckysheet.locationCell.apply(range,"locationConstant","e");}else if(itemvalue=="locationCF"){//条件格式
  luckysheet.locationCell.apply(range,"locationCF");}}else if(itemvalue=="locationStepRow"){//间隔行
  if(luckysheet_select_save.length==0||luckysheet_select_save.length==1&&luckysheet_select_save[0].row[0]==luckysheet_select_save[0].row[1]){if(luckysheet.isEditMode()){alert("请选择最少两行");}else {luckysheet.tooltip.info("提示","请选择最少两行");}return;}var range=$.extend(true,[],luckysheet_select_save);luckysheet.locationCell.apply(range,"locationStepRow");}else if(itemvalue=="locationStepColumn"){//间隔列
  if(luckysheet_select_save.length==0||luckysheet_select_save.length==1&&luckysheet_select_save[0].column[0]==luckysheet_select_save[0].column[1]){if(luckysheet.isEditMode()){alert("请选择最少两列");}else {luckysheet.tooltip.info("提示","请选择最少两列");}return;}var range=$.extend(true,[],luckysheet_select_save);luckysheet.locationCell.apply(range,"locationStepColumn");}});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft,$(this).offset().top+25,"lefttop");});//公式
  $("#luckysheet-icon-function").click(function(){_this.autoSelectionFormula("SUM");});//公式菜单
  $("#luckysheet-icon-function-menu").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var itemdata=[{"text":"求和","value":"SUM","example":'SUM'},{"text":"平均值","value":"AVERAGE","example":'AVERAGE'},{"text":"计数","value":"COUNT","example":'COUNT'},{"text":"最大值","value":"MAX","example":'MAX'},{"text":"最小值","value":"MIN","example":'MIN'},{"text":"","value":"split","example":""},{"text":"if公式生成器","value":"if","example":'IF'},{"text":"函数查找 ...","value":"formula","example":""}];var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"function-menu","item":itemset,"subclass":"","sub":""});$("body").append(menu);$menuButton=$("#"+menuButtonId).width(150);//_this.focus($menuButton);
  $menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");//_this.focus($menuButton, itemvalue);
  if(itemvalue=="if"){var last=luckysheet_select_save[luckysheet_select_save.length-1];var r=last["row_focus"]==null?last["row"][0]:last["row_focus"];var c=last["column_focus"]==null?last["column"][0]:last["column_focus"];if(!!luckysheet.flowdata[r]&&!!luckysheet.flowdata[r][c]&&!!luckysheet.flowdata[r][c]["f"]){var fp=luckysheet.flowdata[r][c]["f"].toString();if(fp.indexOf("=if(")!=-1){luckysheet.ifFormulaGenerator.ifFormulaDialog(fp);}else {if(luckysheet.isEditMode()){alert("该单元格函数不属于if公式！");}else {luckysheet.tooltip.info("该单元格函数不属于if公式！","");}return;}}else {luckysheet.ifFormulaGenerator.ifFormulaDialog();}luckysheet.ifFormulaGenerator.init();}else if(itemvalue=="formula"){//点击函数查找弹出框
  if(luckysheet_select_save.length==0){if(luckysheet.isEditMode()){alert("请选择单元格插入函数");}else {luckysheet.tooltip.info("请选择单元格插入函数","");}return;}var last=luckysheet_select_save[luckysheet_select_save.length-1];var row_index=last["row_focus"],col_index=last["column_focus"];var row=visibledatarow[row_index],row_pre=row_index-1==-1?0:visibledatarow[row_index-1];var col=visibledatacolumn[col_index],col_pre=col_index-1==-1?0:visibledatacolumn[col_index-1];luckysheet.luckysheetupdateCell(row,row_pre,row_index,col,col_pre,col_index,luckysheet.flowdata);var cell=luckysheet.flowdata[row_index][col_index];if(cell!=null&&cell.f!=null){//单元格有计算
  var functionStr=luckysheet.formula.getfunctionParam(cell.f);if(functionStr.fn!=null){//有函数公式
  luckysheet.insertFormula.formulaParmDialog(functionStr.fn,functionStr.param);}else {//无函数公式
  luckysheet.insertFormula.formulaListDialog();}}else {//单元格无计算
  $("#luckysheet-rich-text-editor").html('<span dir="auto" class="luckysheet-formula-text-color">=</span>');$("#luckysheet-functionbox-cell").html($("#luckysheet-rich-text-editor").html());luckysheet.insertFormula.formulaListDialog();}luckysheet.insertFormula.init();}else {_this.autoSelectionFormula(itemvalue);}});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft-48,$(this).offset().top+25,"lefttop");});//加粗
  $("#luckysheet-icon-bold").click(function(){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var row_index=luckysheet_select_save[0]["row_focus"],col_index=luckysheet_select_save[0]["column_focus"];var foucsStatus=_this.checkstatus(d,row_index,col_index,"bl");if(foucsStatus==1){foucsStatus=0;}else {foucsStatus=1;}_this.updateFormat(d,"bl",foucsStatus);luckysheet.menuButton.menuButtonFocus(d,row_index,col_index);});//斜体
  $("#luckysheet-icon-italic").click(function(){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var row_index=luckysheet_select_save[0]["row_focus"],col_index=luckysheet_select_save[0]["column_focus"];var foucsStatus=_this.checkstatus(d,row_index,col_index,"it");if(foucsStatus==1){foucsStatus=0;}else {foucsStatus=1;}_this.updateFormat(d,"it",foucsStatus);luckysheet.menuButton.menuButtonFocus(d,row_index,col_index);});//删除线
  $("#luckysheet-icon-strikethrough").click(function(){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var row_index=luckysheet_select_save[0]["row_focus"],col_index=luckysheet_select_save[0]["column_focus"];var foucsStatus=_this.checkstatus(d,row_index,col_index,"cl");if(foucsStatus==1){foucsStatus=0;}else {foucsStatus=1;}_this.updateFormat(d,"cl",foucsStatus);luckysheet.menuButton.menuButtonFocus(d,row_index,col_index);});//条件格式
  $("#luckysheet-icon-conditionformat").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);if($menuButton.length==0){var itemdata=[{"text":"突出显示单元格规则","value":"highlightCellRule","example":"more"},{"text":"项目选取规则","value":"projectSelectRule","example":"more"},{"text":"数据条","value":"dataBar","example":"more"},{"text":"色阶","value":"colorGradation","example":"more"},{"text":"图标集","value":"icons","example":""},{"text":"","value":"split","example":""},{"text":"新建规则","value":"newRule","example":""},{"text":"清除规则","value":"deleteRule","example":"more"},{"text":"管理规则","value":"administerRule","example":""}];var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"conditionformat","item":itemset,"subclass":"","sub":""});//突出显示单元格规则子菜单
  var subitemdata=[{"text":"大于","value":"greaterThan","example":">"},{"text":"小于","value":"lessThan","example":"<"},{"text":"介于","value":"betweenness","example":"[]"},{"text":"等于","value":"equal","example":"="},{"text":"文本包含","value":"textContains","example":"()"},{"text":"发生日期","value":"occurrenceDate","example":"昨天"},{"text":"重复值","value":"duplicateValue","example":"##"}];var subitemset=_this.createButtonMenu(subitemdata);var submenu=luckysheet.replaceHtml(_this.menu,{"id":"highlightCellRule","item":subitemset,"subclass":"luckysheet-menuButton-sub"});//项目选取规则子菜单
  var subitemdata2=[{"text":"前 10 项","value":"top10","example":"前10项"},{"text":"前 10%","value":"top10%","example":"前10%"},{"text":"最后 10 项","value":"last10","example":"后10项"},{"text":"最后 10%","value":"last10%","example":"后10%"},{"text":"高于平均值","value":"AboveAverage","example":"高于均值"},{"text":"低于平均值","value":"SubAverage","example":"低于均值"}];var subitemset2=_this.createButtonMenu(subitemdata2);var submenu2=luckysheet.replaceHtml(_this.menu,{"id":"projectSelectRule","item":subitemset2,"subclass":"luckysheet-menuButton-sub"});//数据条子菜单
  var submenu3='<div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-menuButton luckysheet-menuButton-sub luckysheet-mousedown-cancel" id="luckysheet-icon-dataBar-menuButton" style="width: 126px;padding: 5px;top: 118.5px;left: 1321.48px;display: none;">'+'<div itemvalue="0" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 0;" title="蓝-白渐变数据条"></div>'+'</div>'+'<div itemvalue="1" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px 0;" title="绿-白渐变数据条"></div>'+'</div>'+'<div itemvalue="2" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px 0;" title="红-白渐变数据条"></div>'+'</div>'+'<div itemvalue="3" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -36px;" title="橙-白渐变数据条"></div>'+'</div>'+'<div itemvalue="4" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -36px;" title="浅蓝-白渐变数据条"></div>'+'</div>'+'<div itemvalue="5" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -36px;" title="紫-白渐变数据条"></div>'+'</div>'+'<div itemvalue="6" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -72px;" title="蓝色数据条"></div>'+'</div>'+'<div itemvalue="7" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -72px;" title="绿色数据条"></div>'+'</div>'+'<div itemvalue="8" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -72px;" title="红色数据条"></div>'+'</div>'+'<div itemvalue="9" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -108px;" title="橙色数据条"></div>'+'</div>'+'<div itemvalue="10" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -108px;" title="浅蓝色数据条"></div>'+'</div>'+'<div itemvalue="11" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -108px;" title="紫色数据条"></div>'+'</div>'+'</div>';//色阶
  var submenu4='<div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-menuButton luckysheet-menuButton-sub luckysheet-mousedown-cancel" id="luckysheet-icon-colorGradation-menuButton" style="width: 126px;padding: 5px;top: 143.5px;left: 1321.48px;display: none;">'+'<div itemvalue="0" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 0;" title="绿-黄-红色阶"></div>'+'</div>'+'<div itemvalue="1" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px 0;" title="红-黄-绿色阶"></div>'+'</div>'+'<div itemvalue="2" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px 0;" title="绿-白-红色阶"></div>'+'</div>'+'<div itemvalue="3" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -114px 0;" title="红-白-绿色阶"></div>'+'</div>'+'<div itemvalue="4" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -36px;" title="蓝-白-红色阶"></div>'+'</div>'+'<div itemvalue="5" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -36px;" title="红-白-蓝色阶"></div>'+'</div>'+'<div itemvalue="6" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -36px;" title="白-红色阶"></div>'+'</div>'+'<div itemvalue="7" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -114px -36px;" title="红-白色阶"></div>'+'</div>'+'<div itemvalue="8" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -72px;" title="绿-白色阶"></div>'+'</div>'+'<div itemvalue="9" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -72px;" title="白-绿色阶"></div>'+'</div>'+'<div itemvalue="10" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -72px;" title="绿-黄色阶"></div>'+'</div>'+'<div itemvalue="11" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">'+'<div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -114px -72px;" title="黄-绿色阶"></div>'+'</div>'+'</div>';//清除规则子菜单
  var subitemdata6=[// {"text":"清除所选单元格的规则", "value":"", "example":""},
  {"text":"清除整个工作表的规则","value":"delSheet","example":""}];var subitemset6=_this.createButtonMenu(subitemdata6);var submenu6=luckysheet.replaceHtml(_this.menu,{"id":"deleteRule","item":subitemset6,"subclass":"luckysheet-menuButton-sub"});$("body").append(menu+submenu+submenu2+submenu3+submenu4+submenu6);$menuButton=$("#"+menuButtonId).width(190);$("#luckysheet-icon-highlightCellRule-menuButton").width(130);$("#luckysheet-icon-projectSelectRule-menuButton").width(170);$menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");if(itemvalue=="icons"){if(luckysheet_select_save.length==0){if(luckysheet.isEditMode()){alert("请选择应用范围");}else {luckysheet.tooltip.info("请选择应用范围","");}return;}luckysheet.conditionformat.CFiconsDialog();luckysheet.conditionformat.init();}else if(itemvalue=="newRule"){if(luckysheet_select_save.length==0){if(luckysheet.isEditMode()){alert("请选择应用范围");}else {luckysheet.tooltip.info("请选择应用范围","");}return;}luckysheet.conditionformat.newConditionRuleDialog(0);luckysheet.conditionformat.init();}else if(itemvalue=="administerRule"){var loadSheetUrl=luckysheet.server.loadSheetUrl;var file=luckysheet.getluckysheetfile();if(loadSheetUrl!=""&&loadSheetUrl!=null){var sheetindex=[];for(var i=0;i<file.length;i++){sheetindex.push(file[i].index);}$.post(loadSheetUrl,{"gridKey":luckysheet.server.gridKey,"index":sheetindex.join(",")},function(d){var dataset=eval("("+d+")");setTimeout(function(){$("#luckysheetloadingdata").fadeOut().remove();},500);for(var item in dataset){if(item==luckysheet.currentSheetIndex){continue;}var otherfile=file[luckysheet.sheetmanage.getSheetIndex(item)];otherfile.celldata=dataset[item.toString()];otherfile["data"]=luckysheet.sheetmanage.buildGridData(otherfile);}luckysheet.setluckysheetfile(file);luckysheet.conditionformat.fileClone=$.extend(true,[],file);luckysheet.conditionformat.administerRuleDialog();luckysheet.conditionformat.init();});}else {luckysheet.conditionformat.fileClone=$.extend(true,[],file);luckysheet.conditionformat.administerRuleDialog();luckysheet.conditionformat.init();}}});//突出显示单元格规则子菜单点击事件
  $(document).off("click.CFhighlightCellRule").on("click.CFhighlightCellRule","#luckysheet-icon-highlightCellRule-menuButton .luckysheet-cols-menuitem",function(){$menuButton.hide();$("#luckysheet-icon-highlightCellRule-menuButton").hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");if(luckysheet_select_save.length==0){if(luckysheet.isEditMode()){alert("请选择条件格式的应用范围");}else {luckysheet.tooltip.info("请选择条件格式的应用范围","");}return;}else {var textCellColorHtml=luckysheet.conditionformat.textCellColorHtml;switch(itemvalue){case"greaterThan":var title="条件格式——大于";var content='<div class="box" data-itemvalue="greaterThan">'+'<div class="boxTitleOne">为大于以下值的单元格设置格式：</div>'+'<div class="inpbox range">'+'<input id="conditionVal" class="formulaInputFocus"/>'+'<i class="fa fa-table" aria-hidden="true" title="点击选择单元格"></i>'+'</div>'+'<div style="margin: 5px 0;">设置为：</div>'+textCellColorHtml+'</div>';break;case"lessThan":var title="条件格式——小于";var content='<div class="box" data-itemvalue="lessThan">'+'<div class="boxTitleOne">为小于以下值的单元格设置格式：</div>'+'<div class="inpbox range">'+'<input id="conditionVal" class="formulaInputFocus"/>'+'<i class="fa fa-table" aria-hidden="true" title="点击选择单元格"></i>'+'</div>'+'<div style="margin: 5px 0;">设置为：</div>'+textCellColorHtml+'</div>';break;case"betweenness":var title="条件格式——介于";var content='<div class="box" data-itemvalue="betweenness">'+'<div class="boxTitleOne">为介于以下值的单元格设置格式：</div>'+'<div style="height: 30px;line-height: 30px;">'+'<div class="inpbox2 range">'+'<input id="conditionVal" class="formulaInputFocus"/>'+'<i class="fa fa-table" aria-hidden="true" title="点击选择单元格"></i>'+'</div>'+'<div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">到</div>'+'<div class="inpbox2 range">'+'<input id="conditionVal2" class="formulaInputFocus"/>'+'<i class="fa fa-table" aria-hidden="true" title="点击选择单元格"></i>'+'</div>'+'</div>'+'<div style="margin: 5px 0;">设置为：</div>'+textCellColorHtml+'</div>';break;case"equal":var title="条件格式——等于";var content='<div class="box" data-itemvalue="equal">'+'<div class="boxTitleOne">为等于以下值的单元格设置格式：</div>'+'<div class="inpbox range">'+'<input id="conditionVal" class="formulaInputFocus"/>'+'<i class="fa fa-table" aria-hidden="true" title="点击选择单元格"></i>'+'</div>'+'<div style="margin: 5px 0;">设置为：</div>'+textCellColorHtml+'</div>';break;case"textContains":var title="条件格式——文本包含";var content='<div class="box" data-itemvalue="textContains">'+'<div class="boxTitleOne">为包含以下文本的单元格设置格式：</div>'+'<div class="inpbox range">'+'<input id="conditionVal" class="formulaInputFocus"/>'+'<i class="fa fa-table" aria-hidden="true" title="点击选择单元格"></i>'+'</div>'+'<div style="margin: 5px 0;">设置为：</div>'+textCellColorHtml+'</div>';break;case"occurrenceDate":var title="条件格式——发生日期";var content='<div class="box" data-itemvalue="occurrenceDate">'+'<div class="boxTitleOne">为包含以下日期的单元格设置格式：</div>'+'<div class="inpbox">'+'<input id="daterange-btn" class="formulaInputFocus" readonly="readonly" placeholder="请选择日期"/>'+'</div>'+'<div style="margin: 5px 0;">设置为：</div>'+textCellColorHtml+'</div>';break;case"duplicateValue":var title="条件格式——重复值";var content='<div class="box" data-itemvalue="duplicateValue">'+'<div class="boxTitleOne">为包含以下类型值的单元格设置格式：</div>'+'<select id="conditionVal" class="selectbox">'+'<option value="0">重复</option>'+'<option value="1">唯一</option>'+'</select>'+'<span style="margin-left: 5px;">值</span>'+'<div style="margin:5px 0;">设置为：</div>'+textCellColorHtml+'</div>';break;}luckysheet.conditionformat.conditionformatDialog(title,content);}});//项目选取规则子菜单点击事件
  $(document).off("click.CFprojectSelectRule").on("click.CFprojectSelectRule","#luckysheet-icon-projectSelectRule-menuButton .luckysheet-cols-menuitem",function(){$menuButton.hide();$("#luckysheet-icon-projectSelectRule-menuButton").hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");if(luckysheet_select_save.length==0){if(luckysheet.isEditMode()){alert("请选择条件格式的应用范围");}else {luckysheet.tooltip.info("请选择条件格式的应用范围","");}return;}else {var textCellColorHtml=luckysheet.conditionformat.textCellColorHtml;switch(itemvalue){case"top10":var title="条件格式——前 10 项";var content='<div class="box" data-itemvalue="top10">'+'<div class="boxTitleOne">为值最大的那些单元格设置格式：</div>'+'<div style="height: 30px;line-height: 30px;">'+'<div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">前</div>'+'<div class="inpbox2">'+'<input id="conditionVal" class="formulaInputFocus" type="number" value="10"/>'+'</div>'+'<div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">项</div>'+'</div>'+'<div style="margin: 5px 0;">设置为：</div>'+textCellColorHtml+'</div>';break;case"top10%":var title="条件格式——前 10%";var content='<div class="box" data-itemvalue="top10%">'+'<div class="boxTitleOne">为值最大的那些单元格设置格式：</div>'+'<div style="height: 30px;line-height: 30px;">'+'<div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">前</div>'+'<div class="inpbox2">'+'<input id="conditionVal" class="formulaInputFocus" type="number" value="10"/>'+'</div>'+'<div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">%</div>'+'</div>'+'<div style="margin: 5px 0;">设置为：</div>'+textCellColorHtml+'</div>';break;case"last10":var title="条件格式——最后 10 项";var content='<div class="box" data-itemvalue="last10">'+'<div class="boxTitleOne">为值最小的那些单元格设置格式：</div>'+'<div style="height: 30px;line-height: 30px;">'+'<div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">最后</div>'+'<div class="inpbox2">'+'<input id="conditionVal" class="formulaInputFocus" type="number" value="10"/>'+'</div>'+'<div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">项</div>'+'</div>'+'<div style="margin: 5px 0;">设置为：</div>'+textCellColorHtml+'</div>';break;case"last10%":var title="条件格式——最后 10%";var content='<div class="box" data-itemvalue="last10%">'+'<div class="boxTitleOne">为值最小的那些单元格设置格式：</div>'+'<div style="height: 30px;line-height: 30px;">'+'<div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">最后</div>'+'<div class="inpbox2">'+'<input id="conditionVal" class="formulaInputFocus" type="number" value="10"/>'+'</div>'+'<div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">%</div>'+'</div>'+'<div style="margin:5px 0;">设置为：</div>'+textCellColorHtml+'</div>';break;case"AboveAverage":var title="条件格式——高于平均值";var content='<div class="box" data-itemvalue="AboveAverage">'+'<div class="boxTitleOne">为高于平均值的单元格设置格式：</div>'+'<div style="margin: 5px 0;">针对选定区域，设置为：</div>'+textCellColorHtml+'</div>';break;case"SubAverage":var title="条件格式——低于平均值";var content='<div class="box" data-itemvalue="SubAverage">'+'<div class="boxTitleOne">为低于平均值的单元格设置格式：</div>'+'<div style="margin: 5px 0;">针对选定区域，设置为：</div>'+textCellColorHtml+'</div>';break;}luckysheet.conditionformat.conditionformatDialog(title,content);}});//数据条子菜单点击事件
  $(document).off("click.CFdataBar").on("click.CFdataBar","#luckysheet-icon-dataBar-menuButton .luckysheet-cols-menuitem",function(){$menuButton.hide();$("#luckysheet-icon-dataBar-menuButton").hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");if(luckysheet_select_save.length>0){var cellrange=$.extend(true,[],luckysheet_select_save);var format=luckysheet.conditionformat.dataBarList[itemvalue]["format"];luckysheet.conditionformat.updateItem("dataBar",cellrange,format);}});//色阶子菜单点击事件
  $(document).off("click.CFcolorGradation").on("click.CFcolorGradation","#luckysheet-icon-colorGradation-menuButton .luckysheet-cols-menuitem",function(){$menuButton.hide();$("#luckysheet-icon-colorGradation-menuButton").hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");if(luckysheet_select_save.length>0){var cellrange=$.extend(true,[],luckysheet_select_save);var format=luckysheet.conditionformat.colorGradationList[itemvalue]["format"];luckysheet.conditionformat.updateItem("colorGradation",cellrange,format);}});//清除规则子菜单点击事件
  $(document).off("click.CFdeleteRule").on("click.CFdeleteRule","#luckysheet-icon-deleteRule-menuButton .luckysheet-cols-menuitem",function(){$menuButton.hide();$("#luckysheet-icon-deleteRule-menuButton").hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");if(itemvalue=="delSheet"){luckysheet.conditionformat.updateItem("delSheet");}});}var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft,$(this).offset().top+25,"lefttop");});//批注
  $("#luckysheet-icon-postil").click(function(){var menuButtonId=$(this).attr("id")+"-menuButton";var $menuButton=$("#"+menuButtonId);$menuButton.remove();// if($menuButton.length == 0){
  luckysheet.postil.removeActivePs();var last=luckysheet_select_save[luckysheet_select_save.length-1];var row_index=last["row_focus"];if(row_index==null){row_index=last["row"][0];}var col_index=last["column_focus"];if(col_index==null){col_index=last["column"][0];}if(luckysheet.flowdata[row_index][col_index]!=null&&luckysheet.flowdata[row_index][col_index].ps!=null){var itemdata=[{"text":"编辑批注","value":"editPs","example":""},{"text":"删除","value":"delPs","example":""},{"text":"","value":"split","example":""},{"text":"显示/隐藏批注","value":"showHidePs","example":""},{"text":"显示/隐藏所有批注","value":"showHideAllPs","example":""}];}else {var itemdata=[{"text":"新建批注","value":"newPs","example":""},{"text":"","value":"split","example":""},{"text":"显示/隐藏所有批注","value":"showHideAllPs","example":""}];}var itemset=_this.createButtonMenu(itemdata);var menu=luckysheet.replaceHtml(_this.menu,{"id":"postil","item":itemset,"subclass":"","sub":""});$("body").append(menu);$menuButton=$("#"+menuButtonId).width(150);$menuButton.find(".luckysheet-cols-menuitem").click(function(){$menuButton.hide();$("#"+container).attr("tabindex",0).focus();var $t=$(this),itemvalue=$t.attr("itemvalue");if(itemvalue=="newPs"){luckysheet.postil.newPs(row_index,col_index);}else if(itemvalue=="editPs"){luckysheet.postil.editPs(row_index,col_index);}else if(itemvalue=="delPs"){luckysheet.postil.delPs(row_index,col_index);}else if(itemvalue=="showHidePs"){luckysheet.postil.showHidePs(row_index,col_index);}else if(itemvalue=="showHideAllPs"){luckysheet.postil.showHideAllPs();}});// }
  var userlen=$(this).outerWidth();var tlen=$menuButton.outerWidth();var menuleft=$(this).offset().left;if(tlen>userlen&&tlen+menuleft>$("#"+container).width()){menuleft=menuleft-tlen+userlen;}mouseclickposition($menuButton,menuleft,$(this).offset().top+25,"lefttop");});$("body").on("mouseover mouseleave",".luckysheet-menuButton .luckysheet-cols-submenu",function(e){var $t=$(this),attrid=$t.attr("itemvalue"),$attr=$("#luckysheet-icon-"+attrid+"-menuButton");//clearTimeout(_this.submenuhide);
  if(e.type==="mouseover"){var $con=$t.parent();var winW=$(window).width(),winH=$(window).height();var menuW=$con.width(),attrH=$attr.height()+25,attrW=$attr.width()+5;var offset=$t.offset();var top=offset.top,left=offset.left+menuW;if(left+attrW>winW){left=offset.left-attrW;}if(top+attrH>winH){top=winH-attrH;}$attr.css({"top":top,"left":left}).show();_this.rightclickmenu=$t;}else {//var $t = $(this), attrid = $t.attr("itemvalue"), $attr = $("#" + attrid + "_sub");
  _this.submenuhide=setTimeout(function(){$attr.hide();},200);}}).on("mouseover mouseleave",".luckysheet-menuButton-sub",function(e){if(e.type==="mouseover"){_this.rightclickmenu.addClass("luckysheet-cols-menuitem-hover");clearTimeout(_this.submenuhide);}else {_this.rightclickmenu.removeClass("luckysheet-cols-menuitem-hover");$(this).hide();}});},fontarray:["微软雅黑","宋体","黑体","楷体","仿宋","新宋体","华文新魏","华文行楷","华文隶书","Arial","Times New Roman","Tahoma","Verdana"],fontjson:{"微软雅黑":0,"microsoft yahei":0,"宋体":1,"simsun":1,"黑体":2,"simhei":2,"楷体":3,"kaiti":3,"仿宋":4,"fangsong":4,"新宋体":5,"nsimsun":5,"华文新魏":6,"stxinwei":6,"华文行楷":7,"stxingkai":7,"华文隶书":8,"stliti":8,"arial":9,"times new roman":10,"tahoma":11,"verdana":12},getQKBorder:function getQKBorder(width,type,color){var style=0;type=type.toLowerCase();// var bordertype = "solid";
  // if(type=="double"){
  //     style = 2;
  // }
  // else if(type=="dotted"){
  //     style = 2;
  // }
  // else if(type=="dashed"){
  //     style = 2;
  // }
  // else if(type=="solid"){
  //     style = 2;
  // }
  // else{
  //     style = 0;
  // }
  var bordertype="";if(width.indexOf("pt")>-1){var width=parseFloat(width);if(width<1);else if(width<1.5){bordertype="Medium";}else {bordertype="Thick";}}else {var width=parseFloat(width);if(width<2);else if(width<3){bordertype="Medium";}else {bordertype="Thick";}}var bordertype="solid";if(type=="double"){style=2;}else if(type=="dotted"){if(bordertype=="Medium"||bordertype=="Thick"){style=3;}else {style=10;}}else if(type=="dashed"){if(bordertype=="Medium"||bordertype=="Thick"){style=4;}else {style=9;}}else if(type=="solid"){if(bordertype=="Medium"){style=8;}else if(bordertype=="Thick"){style=13;}else {style=1;}}// if(color.indexOf("rgb")>-1){
  //     color = luckysheet.rgbTohex(color);
  // }
  //console.log([style, color]);
  return [style,color];},updateFormat:function updateFormat(d,attr,foucsStatus){var canvasElement=document.createElement('canvas');var canvas=canvasElement.getContext("2d");var cfg=$.extend(true,{},config);if(cfg["rowlen"]==null){cfg["rowlen"]={};}for(var s=0;s<luckysheet_select_save.length;s++){var row_st=luckysheet_select_save[s]["row"][0],row_ed=luckysheet_select_save[s]["row"][1];var col_st=luckysheet_select_save[s]["column"][0],col_ed=luckysheet_select_save[s]["column"][1];if(attr=="ct"){for(var r=row_st;r<=row_ed;r++){if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null){continue;}for(var c=col_st;c<=col_ed;c++){var cell=d[r][c],value=null;if(luckysheet.getObjType(cell)=="object"){value=d[r][c]["v"];}else {value=d[r][c];}if(foucsStatus!="@"&&luckysheet.func_methods.isRealNum(value)){value=parseFloat(value);}var mask=luckysheet.mask.update(foucsStatus,value);var type="n";if(luckysheet.mask.is_date(foucsStatus)||foucsStatus===14||foucsStatus===15||foucsStatus===16||foucsStatus===17||foucsStatus===18||foucsStatus===19||foucsStatus===20||foucsStatus===21||foucsStatus===22||foucsStatus===45||foucsStatus===46||foucsStatus===47){type="d";}else if(foucsStatus=="@"||foucsStatus===49){type="s";}else if(foucsStatus=="General"||foucsStatus===0){type="g";}if(luckysheet.getObjType(cell)=="object"){d[r][c]["m"]=mask;if(d[r][c]["ct"]==null){d[r][c]["ct"]={};}d[r][c]["ct"]["fa"]=foucsStatus;d[r][c]["ct"]["t"]=type;}else {d[r][c]={"ct":{"fa":foucsStatus,"t":type},"v":value,"m":mask};}}}}else {if(attr=="ht"){if(foucsStatus=="left"){foucsStatus="1";}else if(foucsStatus=="center"){foucsStatus="0";}else if(foucsStatus=="right"){foucsStatus="2";}}else if(attr=="vt"){if(foucsStatus=="top"){foucsStatus="1";}else if(foucsStatus=="middle"){foucsStatus="0";}else if(foucsStatus=="bottom"){foucsStatus="2";}}else if(attr=="tb"){if(foucsStatus=="overflow"){foucsStatus="1";}else if(foucsStatus=="clip"){foucsStatus="0";}else if(foucsStatus=="wrap"){foucsStatus="2";}}else if(attr=="tr"){if(foucsStatus=="none"){foucsStatus="0";}else if(foucsStatus=="angleup"){foucsStatus="2";}else if(foucsStatus=="angledown"){foucsStatus="1";}else if(foucsStatus=="vertical"){foucsStatus="3";}else if(foucsStatus=="rotation-up"){foucsStatus="5";}else if(foucsStatus=="rotation-down"){foucsStatus="4";}}for(var r=row_st;r<=row_ed;r++){if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null){continue;}for(var c=col_st;c<=col_ed;c++){var value=d[r][c];if(luckysheet.getObjType(value)=="object"){d[r][c][attr]=foucsStatus;}else {d[r][c]={v:value};d[r][c][attr]=foucsStatus;}if(attr=="tr"&&d[r][c].tb!=null){d[r][c].tb="0";}}}}if(attr=="tb"&&foucsStatus=="2"){//自动换行
  for(var r=row_st;r<=row_ed;r++){if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null){continue;}var currentRowLen=defaultrowlen;if(cfg["rowlen"][r]!=null){currentRowLen=cfg["rowlen"][r];}for(var c=col_st;c<=col_ed;c++){var cell=d[r][c];if(cell!=null&&!luckysheet.func_methods.isRealNull(cell.v)){var fontset=luckysheetfontformat(cell);var oneLineTextHeight=luckysheet.menuButton.getTextSize("田",fontset)[1];canvas.font=fontset;var strValue=cell.m.toString();var tbWidth=canvas.measureText(strValue).width;var cellWidth=luckysheet.colLocationByIndex(c)[1]-luckysheet.colLocationByIndex(c)[0]-8;if(tbWidth>cellWidth){var strArr=[];//文本截断数组
  for(var strI=1;strI<=strValue.length;strI++){var strV=strValue.substring(strArr.join("").length,strI);var strtextMetrics=canvas.measureText(strV).width;if(strtextMetrics>cellWidth){strArr.push(strValue.substring(strArr.join("").length,strI-1));strI=strI-2;}else if(strtextMetrics<=cellWidth&&strI==strValue.length){strArr.push(strV);}}var computeRowlen=oneLineTextHeight*strArr.length;//比较计算高度和当前高度取最大高度
  if(computeRowlen>currentRowLen){currentRowLen=computeRowlen;}}}}if(currentRowLen!=defaultrowlen){cfg["rowlen"][r]=currentRowLen;}}}else if(attr=="tr"){//文本旋转
  for(var r=row_st;r<=row_ed;r++){if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null){continue;}var currentRowLen=defaultrowlen;if(cfg["rowlen"][r]!=null){currentRowLen=cfg["rowlen"][r];}for(var c=col_st;c<=col_ed;c++){var cell=d[r][c];if(cell!=null&&!luckysheet.func_methods.isRealNull(cell.v)){var fontset=luckysheetfontformat(cell);var oneLineTextHeight=luckysheet.menuButton.getTextSize("田",fontset)[1];canvas.font=fontset;var value=cell.m.toString();var textMetrics=canvas.measureText(value).width;var computeRowlen;//计算高度
  if(foucsStatus=="0"){//无旋转
  computeRowlen=oneLineTextHeight;}else if(foucsStatus=="1"||foucsStatus=="2"){//向下倾斜（45 旋转）----向上倾斜（-45 旋转）
  computeRowlen=0.707*(textMetrics+oneLineTextHeight)+4;}else if(foucsStatus=="3"){//竖排文字
  computeRowlen=value.length*oneLineTextHeight+4;}else if(foucsStatus=="4"||foucsStatus=="5"){//向下90（90 旋转）----向上90（-90 旋转）
  computeRowlen=textMetrics+4;}computeRowlen=Math.round(computeRowlen);//比较计算高度和当前高度取最大高度
  if(computeRowlen>currentRowLen){currentRowLen=computeRowlen;}}}if(currentRowLen!=defaultrowlen){cfg["rowlen"][r]=currentRowLen;}}}else if(attr=="fs"){//字体大小
  for(var r=row_st;r<=row_ed;r++){if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null){continue;}var currentRowLen=defaultrowlen;if(cfg["rowlen"][r]!=null){currentRowLen=cfg["rowlen"][r];}for(var c=col_st;c<=col_ed;c++){var cell=d[r][c];if(cell==null){continue;}var fontset=luckysheetfontformat(cell);var oneLineTextHeight=luckysheet.menuButton.getTextSize("田",fontset)[1];canvas.font=fontset;//计算高度
  var computeRowlen;if(luckysheet.func_methods.isRealNull(cell.v)){computeRowlen=oneLineTextHeight;}else {if(cell.tb=="2"){//单元格有自动换行标示
  var strValue=cell.m.toString();var tbWidth=canvas.measureText(strValue).width;var cellWidth=luckysheet.colLocationByIndex(c)[1]-luckysheet.colLocationByIndex(c)[0]-8;if(tbWidth>cellWidth){var strArr=[];//文本截断数组
  for(var strI=1;strI<=strValue.length;strI++){var strV=strValue.substring(strArr.join("").length,strI);var strtextMetrics=canvas.measureText(strV).width;if(strtextMetrics>cellWidth){strArr.push(strValue.substring(strArr.join("").length,strI-1));strI=strI-2;}else if(strtextMetrics<=cellWidth&&strI==strValue.length){strArr.push(strV);}}computeRowlen=oneLineTextHeight*strArr.length;}else {computeRowlen=oneLineTextHeight;}}else if(cell.tr!=null){//单元格有旋转标示
  var tr=cell.tr;var value=cell.m.toString();var textMetrics=canvas.measureText(value).width;if(tr=="0"){//无旋转
  computeRowlen=oneLineTextHeight;}else if(tr=="1"||tr=="2"){//向下倾斜（45 旋转）----向上倾斜（-45 旋转）
  computeRowlen=0.707*(textMetrics+oneLineTextHeight)+4;}else if(tr=="3"){//竖排文字
  computeRowlen=value.length*oneLineTextHeight+4;}else if(tr=="4"||tr=="5"){//向下90（90 旋转）----向上90（-90 旋转）
  computeRowlen=textMetrics+4;}computeRowlen=Math.round(computeRowlen);}else {computeRowlen=oneLineTextHeight;}}//比较计算高度和当前高度取最大高度
  if(computeRowlen>currentRowLen){currentRowLen=computeRowlen;}}if(currentRowLen!=defaultrowlen){cfg["rowlen"][r]=currentRowLen;}}}}if(attr=="tb"&&foucsStatus=="2"||attr=="tr"||attr=="fs"){luckysheet.jfrefreshgrid(d,luckysheet_select_save,cfg,null,true);}else {luckysheet.jfrefreshgrid(d,luckysheet_select_save);}},updateFormat_mc:function updateFormat_mc(d,foucsStatus){var cfg=$.extend(true,{},config);if(cfg["merge"]==null){cfg["merge"]={};}if(foucsStatus=="mergeCancel"){for(var i=0;i<luckysheet_select_save.length;i++){var range=luckysheet_select_save[i];var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];if(r1==r2&&c1==c2){continue;}var fv={};for(var r=r1;r<=r2;r++){for(var c=c1;c<=c2;c++){var cell=d[r][c];if(cell!=null&&cell.mc!=null){var mc_r=cell.mc.r,mc_c=cell.mc.c;if("rs"in cell.mc){delete cell.mc;delete cfg["merge"][mc_r+"_"+mc_c];fv[mc_r+"_"+mc_c]=$.extend(true,{},cell);}else {var cell_clone=fv[mc_r+"_"+mc_c];delete cell_clone.v;delete cell_clone.m;delete cell_clone.ct;delete cell_clone.f;delete cell_clone.spl;d[r][c]=cell_clone;}}}}}}else {var isHasMc=false;//选区是否含有 合并的单元格
  for(var i=0;i<luckysheet_select_save.length;i++){var range=luckysheet_select_save[i];var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];for(var r=r1;r<=r2;r++){for(var c=c1;c<=c2;c++){var cell=d[r][c];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell){isHasMc=true;break;}}}}if(isHasMc){//选区有合并单元格（选区都执行 取消合并）
  for(var i=0;i<luckysheet_select_save.length;i++){var range=luckysheet_select_save[i];var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];if(r1==r2&&c1==c2){continue;}var fv={};for(var r=r1;r<=r2;r++){for(var c=c1;c<=c2;c++){var cell=d[r][c];if(cell!=null&&cell.mc!=null){var mc_r=cell.mc.r,mc_c=cell.mc.c;if("rs"in cell.mc){delete cell.mc;delete cfg["merge"][mc_r+"_"+mc_c];fv[mc_r+"_"+mc_c]=$.extend(true,{},cell);}else {var cell_clone=fv[mc_r+"_"+mc_c];delete cell_clone.v;delete cell_clone.m;delete cell_clone.ct;delete cell_clone.f;delete cell_clone.spl;d[r][c]=cell_clone;}}}}}}else {for(var i=0;i<luckysheet_select_save.length;i++){var range=luckysheet_select_save[i];var r1=range["row"][0],r2=range["row"][1];var c1=range["column"][0],c2=range["column"][1];if(r1==r2&&c1==c2){continue;}if(foucsStatus=="mergeAll"){var fv={},isfirst=false;for(var r=r1;r<=r2;r++){for(var c=c1;c<=c2;c++){var cell=d[r][c];if(cell!=null&&(!luckysheet.func_methods.isRealNull(cell.v)||cell.f!=null)&&!isfirst){fv=$.extend(true,{},cell);isfirst=true;}d[r][c]={"mc":{"r":r1,"c":c1}};}}d[r1][c1]=fv;d[r1][c1].mc={"r":r1,"c":c1,"rs":r2-r1+1,"cs":c2-c1+1};cfg["merge"][r1+"_"+c1]={"r":r1,"c":c1,"rs":r2-r1+1,"cs":c2-c1+1};}else if(foucsStatus=="mergeV"){for(var c=c1;c<=c2;c++){var fv={},isfirst=false;for(var r=r1;r<=r2;r++){var cell=d[r][c];if(cell!=null&&(!luckysheet.func_methods.isRealNull(cell.v)||cell.f!=null)&&!isfirst){fv=$.extend(true,{},cell);isfirst=true;}d[r][c]={"mc":{"r":r1,"c":c}};}d[r1][c]=fv;d[r1][c].mc={"r":r1,"c":c,"rs":r2-r1+1,"cs":1};cfg["merge"][r1+"_"+c]={"r":r1,"c":c,"rs":r2-r1+1,"cs":1};}}else if(foucsStatus=="mergeH"){for(var r=r1;r<=r2;r++){var fv={},isfirst=false;for(var c=c1;c<=c2;c++){var cell=d[r][c];if(cell!=null&&(!luckysheet.func_methods.isRealNull(cell.v)||cell.f!=null)&&!isfirst){fv=$.extend(true,{},cell);isfirst=true;}d[r][c]={"mc":{"r":r,"c":c1}};}d[r][c1]=fv;d[r][c1].mc={"r":r,"c":c1,"rs":1,"cs":c2-c1+1};cfg["merge"][r+"_"+c1]={"r":r,"c":c1,"rs":1,"cs":c2-c1+1};}}}}}if(clearjfundo){luckysheet.jfundo=[];luckysheet.jfredo.push({"type":"mergeChange","sheetIndex":luckysheet.currentSheetIndex,"data":luckysheet.flowdata,"curData":d,"range":$.extend(true,[],luckysheet_select_save),"config":$.extend(true,{},config),"curConfig":cfg});}clearjfundo=false;luckysheet.jfrefreshgrid(d,luckysheet_select_save,cfg);clearjfundo=true;},borderfix:function borderfix(d,r,c){return [-1,-1,2,2];},menuButtonFocus:function menuButtonFocus(d,r,c){var foucsList=["bl","it","cl","ff","ht","vt","fs","tb","tr"];var _this=this;for(var i=0;i<foucsList.length;i++){var attr=foucsList[i];var foucsStatus=_this.checkstatus(d,r,c,attr);if(attr=="bl"){if(foucsStatus!="0"){$("#luckysheet-icon-bold").addClass("luckysheet-toolbar-button-hover");}else {$("#luckysheet-icon-bold").removeClass("luckysheet-toolbar-button-hover");}}else if(attr=="it"){if(foucsStatus!="0"){$("#luckysheet-icon-italic").addClass("luckysheet-toolbar-button-hover");}else {$("#luckysheet-icon-italic").removeClass("luckysheet-toolbar-button-hover");}}else if(attr=="cl"){if(foucsStatus!="0"){$("#luckysheet-icon-strikethrough").addClass("luckysheet-toolbar-button-hover");}else {$("#luckysheet-icon-strikethrough").removeClass("luckysheet-toolbar-button-hover");}}else if(attr=="ff"){var menuButtonId="luckysheet-icon-font-family-menuButton";var $menuButton=$("#"+menuButtonId);var itemname="微软雅黑",itemvalue=0;if(foucsStatus!=null){if(luckysheet.isdatatypemulti(foucsStatus)["num"]){itemvalue=parseInt(foucsStatus);itemname=_this.fontarray[itemvalue];}else {itemvalue=_this.fontjson[foucsStatus];itemname=_this.fontarray[itemvalue];}}_this.focus($menuButton,itemvalue);$("#luckysheet-icon-font-family").find(".luckysheet-toolbar-menu-button-caption").html(" "+itemname+" ");}else if(attr=="fs"){var $menuButton=$("#luckysheet-icon-font-size-menuButton");var itemvalue=foucsStatus,$input=$("#luckysheet-icon-font-size input");_this.focus($menuButton,itemvalue);$("#luckysheet-icon-font-size").attr("itemvalue",itemvalue);$input.val(itemvalue);}else if(attr=="ht"){var $menuButton=$("#luckysheet-icon-align-menu-menuButton");var $t=$("luckysheet-icon-align"),itemvalue="left";if(foucsStatus=="0"){itemvalue="center";}else if(foucsStatus=="2"){itemvalue="right";}_this.focus($menuButton,itemvalue);var $icon=$("#luckysheet-icon-align").attr("type",itemvalue).find(".luckysheet-icon-img-container");$icon.removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-"+itemvalue);$menuButton.hide();}else if(attr=="vt"){var $menuButton=$("#luckysheet-icon-valign-menu-menuButton");var $t=$("luckysheet-icon-valign"),itemvalue="bottom";if(foucsStatus=="1"){itemvalue="top";}else if(foucsStatus=="0"){itemvalue="middle";}_this.focus($menuButton,itemvalue);var $icon=$("#luckysheet-icon-valign").attr("type",itemvalue).find(".luckysheet-icon-img-container");$icon.removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-"+itemvalue);$menuButton.hide();}else if(attr=="tb"){var $menuButton=$("#luckysheet-icon-textwrap-menu-menuButton");var $t=$("luckysheet-icon-textwrap"),itemvalue="clip";if(foucsStatus=="1"){itemvalue="overflow";}else if(foucsStatus=="2"){itemvalue="wrap";}_this.focus($menuButton,itemvalue);var $icon=$("#luckysheet-icon-textwrap").attr("type",itemvalue).find(".luckysheet-icon-img-container");$icon.removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-"+itemvalue);$menuButton.hide();}else if(attr=="tr"){var $menuButton=$("#luckysheet-icon-rotation-menu-menuButton");var $t=$("luckysheet-icon-rotation"),itemvalue="none";if(foucsStatus=="1"){itemvalue="angledown";}else if(foucsStatus=="2"){itemvalue="angleup";}else if(foucsStatus=="3"){itemvalue="vertical";}else if(foucsStatus=="4"){itemvalue="rotation-down";}else if(foucsStatus=="5"){itemvalue="rotation-up";}_this.focus($menuButton,itemvalue);var $icon=$("#luckysheet-icon-rotation").attr("type",itemvalue).find(".luckysheet-icon-img-container");$icon.removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-"+itemvalue);$menuButton.hide();}}},checkstatus:function checkstatus(d,r,c,a){var foucsStatus=d[r][c];var tf={"bl":1,"it":1,"ff":1,"cl":1};if(a in tf){if(foucsStatus==null){foucsStatus="0";}else {foucsStatus=foucsStatus[a];if(foucsStatus==null){foucsStatus="0";}}}else if(a=="fc"){if(foucsStatus==null){foucsStatus="#000000";}else {foucsStatus=foucsStatus[a];if(foucsStatus==null){foucsStatus="#000000";}if(foucsStatus.indexOf("rgba")>-1){foucsStatus=luckysheet.rgbTohex(foucsStatus);}}}else if(a=="bg"){if(foucsStatus==null){foucsStatus="#ffffff";}else {foucsStatus=foucsStatus[a];if(foucsStatus==null){foucsStatus="#ffffff";}if(foucsStatus.toString().indexOf("rgba")>-1){foucsStatus=luckysheet.rgbTohex(foucsStatus);}}}else if(a.substr(0,2)=="bs"){if(foucsStatus==null){foucsStatus="none";}else {foucsStatus=foucsStatus[a];if(foucsStatus==null){foucsStatus="none";}}}else if(a.substr(0,2)=="bc"){//console.log(foucsStatus[a]);
  if(foucsStatus==null){foucsStatus="#000000";}else {foucsStatus=foucsStatus[a];if(foucsStatus==null){foucsStatus="#000000";}}}else if(a=="ht"){if(foucsStatus==null){foucsStatus="1";}else {foucsStatus=foucsStatus[a];if(foucsStatus==null){foucsStatus="1";}}if(["0","1","2"].indexOf(foucsStatus)==-1){foucsStatus="1";}}else if(a=="vt"){if(foucsStatus==null){foucsStatus="2";}else {foucsStatus=foucsStatus[a];if(foucsStatus==null){foucsStatus="2";}}if(["0","1","2"].indexOf(foucsStatus)==-1){foucsStatus="2";}}else if(a=="ct"){if(foucsStatus==null){foucsStatus=null;}else {foucsStatus=foucsStatus[a];if(foucsStatus==null){foucsStatus=null;}}}else if(a=="fs"){if(foucsStatus==null){foucsStatus="10";}else {foucsStatus=foucsStatus[a];if(foucsStatus==null){foucsStatus="10";}}}else if(a=="tb"){if(foucsStatus==null){foucsStatus="0";}else {foucsStatus=foucsStatus[a];if(foucsStatus==null){foucsStatus="0";}}}else if(a=="tr"){if(foucsStatus==null){foucsStatus="0";}else {foucsStatus=foucsStatus[a];if(foucsStatus==null){foucsStatus="0";}}}return foucsStatus;},setLineDash:function setLineDash(canvasborder,type,hv,m_st,m_ed,line_st,line_ed){var borderType={"0":"none","1":"Thin","2":"Hair","3":"Dotted","4":"Dashed","5":"DashDot","6":"DashDotDot","7":"Double","8":"Medium","9":"MediumDashed","10":"MediumDashDot","11":"MediumDashDotDot","12":"SlantedDashDot","13":"Thick"};type=borderType[type.toString()];try{if(type=="Hair"){canvasborder.setLineDash([1,2]);}else if(type.indexOf("DashDotDot")>-1){canvasborder.setLineDash([2,2,5,2,2]);}else if(type.indexOf("DashDot")>-1){canvasborder.setLineDash([2,5,2]);}else if(type.indexOf("Dotted")>-1){canvasborder.setLineDash([2]);}else if(type.indexOf("Dashed")>-1){canvasborder.setLineDash([3]);}else {canvasborder.setLineDash([0]);}}catch(e){console.log(e);}canvasborder.beginPath();if(type.indexOf("Medium")>-1){if(hv=="h"){canvasborder.moveTo(m_st,m_ed-0.5);canvasborder.lineTo(line_st,line_ed-0.5);}else {canvasborder.moveTo(m_st-0.5,m_ed);canvasborder.lineTo(line_st-0.5,line_ed);}canvasborder.lineWidth=2*devicePixelRatio;}else if(type=="Thick"){canvasborder.moveTo(m_st,m_ed);canvasborder.lineTo(line_st,line_ed);canvasborder.lineWidth=3*devicePixelRatio;}else {canvasborder.moveTo(m_st,m_ed);canvasborder.lineTo(line_st,line_ed);canvasborder.lineWidth=devicePixelRatio;}},moveMergeData:function moveMergeData(d,offset_r,offset_c){if(luckysheet.func_methods.isRealNull(d)){return d;}var deleMC=[],insertMC=[],hasMC=false;for(var r=0;r<d.length;r++){for(var c=0;c<d[0].length;c++){var cell=d[r][c];if(luckysheet.getObjType(cell)=="object"&&"mc"in cell){if(cell.mc.rs!=null){//deleMC.push(cell.mc.r + "_" + cell.mc.c);
  deleMC.push({rs:cell.mc.rs,cs:cell.mc.cs,r:cell.mc.r,c:cell.mc.c});//insertMC.push((cell.mc.r+offset_r) + "_" + (cell.mc.c+offset_c));
  insertMC.push({rs:cell.mc.rs,cs:cell.mc.cs,r:cell.mc.r+offset_r,c:cell.mc.c+offset_c});hasMC=true;}d[r][c].mc.r+=offset_r;d[r][c].mc.c+=offset_c;}}}return {"deleMC":deleMC,"insertMC":insertMC,"hasMC":hasMC};},getRangeInMerge:function getRangeInMerge(st_r,rlen,st_c,clen,sheetIndex){var mergelist=[];var cfg=null;if(sheetIndex!=null){//cfg = $.extend(true, {}, luckysheetfile[luckysheet.sheetmanage.getSheetIndex(sheetIndex)].config);
  cfg=$.extend(true,{},luckysheet.sheetmanage.getSheetConfig());}else {cfg=$.extend(true,{},config);}//console.log(cfg);
  if(cfg!=null&&cfg["merge"]!=null){for(var key in cfg["merge"]){var mc=cfg["merge"][key];//console.log(!( (st_r+rlen-1) < mc.r || st_r>(mc.r+mc.rs-1)), !((st_c+clen-1) < mc.c || st_c>(mc.c+mc.cs-1)));
  if(!(st_r+rlen-1<mc.r||st_r>mc.r+mc.rs-1)&&!(st_c+clen-1<mc.c||st_c>mc.c+mc.cs-1)){mergelist.push(mc);}}}return mergelist;},mergeborer:function mergeborer(d,row_index,col_index){var value=d[row_index][col_index];if(luckysheet.getObjType(value)=="object"&&"mc"in value){var margeMaindata=value["mc"];col_index=margeMaindata.c;row_index=margeMaindata.r;var col_rs=d[row_index][col_index].mc.cs;var row_rs=d[row_index][col_index].mc.rs;var scrollWidth=$("#luckysheet-cell-main").scrollLeft();var scrollHeight=$("#luckysheet-cell-main").scrollTop();var start_r,end_r;//var r= row_index, c = col_index;
  var margeMain=d[row_index][col_index].mc;var row_pre,row,col,col_pre;for(var r=row_index;r<margeMain.rs+row_index;r++){if(r==0){start_r=-1;}else {start_r=visibledatarow[r-1]-1;}end_r=visibledatarow[r];if(row_pre==null){row_pre=start_r;row=end_r;}else {row+=end_r-start_r-1;}}var start_c,end_c;for(var c=col_index;c<margeMain.cs+col_index;c++){if(c==0){start_c=0;}else {start_c=visibledatacolumn[c-1];}end_c=visibledatacolumn[c];if(col_pre==null){col_pre=start_c;col=end_c;}else {col+=end_c-start_c;}}return {"row":[row_pre,row,row_index,row_index+row_rs-1],"column":[col_pre,col,col_index,col_index+col_rs-1]};}else {return null;}},mergeMoveData:{},mergeMoveMain:function mergeMoveMain(columnseleted,rowseleted,s,top,height,left,width){var mergesetting=luckysheet.sheetmanage.getSheetMerge();var _this=this;if(mergesetting==null){return;}var mcset=[];for(var key in mergesetting){mcset.push(key);}if(rowseleted[0]>rowseleted[1]){rowseleted[1]=rowseleted[0];}if(columnseleted[0]>columnseleted[1]){columnseleted[1]=columnseleted[0];}var offloop=true;_this.mergeMoveData={};//console.log(rowseleted1);
  while(offloop){offloop=false;for(var i=0;i<mcset.length;i++){var key=mcset[i];var mc=mergesetting[key];if(key in _this.mergeMoveData){continue;}//console.log(rowseleted[0],row_ed , rowseleted[1],row_st , columnseleted[0],col_ed , columnseleted[1],col_st);
  //!(columnseleted[0]<=col_st && columnseleted[1]>=col_ed && rowseleted[0]<=row_st && rowseleted[1]>=row_ed) &&
  var changeparam=_this.mergeMove(mc,columnseleted,rowseleted,s,top,height,left,width);//console.log(key, changeparam);
  if(changeparam!=null){_this.mergeMoveData[key]=mc;columnseleted=changeparam[0];rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];left=changeparam[4];width=changeparam[5];offloop=true;}else {delete _this.mergeMoveData[key];}}}//console.log(rowseleted);
  // if(rowseleted[0]>rowseleted[1]){
  //     rowseleted =  rowseleted1;
  //     height = height1;
  //     top = top1;
  // }
  return [columnseleted,rowseleted,top,height,left,width];},mergeMove:function mergeMove(mc,columnseleted,rowseleted,s,top,height,left,width){var row_st=mc.r,row_ed=mc.r+mc.rs-1;var col_st=mc.c,col_ed=mc.c+mc.cs-1;var ismatch=false;if(columnseleted[1]<columnseleted[0]){columnseleted[0]=columnseleted[1];}if(rowseleted[1]<rowseleted[0]){rowseleted[0]=rowseleted[1];}if(columnseleted[0]<=col_st&&columnseleted[1]>=col_ed&&rowseleted[0]<=row_st&&rowseleted[1]>=row_ed||!(columnseleted[1]<col_st||columnseleted[0]>col_ed)&&!(rowseleted[1]<row_st||rowseleted[0]>row_ed)){var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,mc.r,mc.c);if(!!margeset){var row=margeset.row[1],row_pre=margeset.row[0],row_index=margeset.row[2],col=margeset.column[1],col_pre=margeset.column[0],col_index=margeset.column[2];// var row_edc = row_ed, row_stc = row_st;
  if(!(columnseleted[1]<col_st||columnseleted[0]>col_ed)){//向上滑动
  if(rowseleted[0]<=row_ed&&rowseleted[0]>=row_st){// var fix = luckysheet_select_save.height;
  // if(luckysheet_select_save.row_focus>=row_st && luckysheet_select_save.row_focus<=row_ed){
  //     fix = height;
  // }
  // height = luckysheet_select_save.top + fix - row_pre;
  height+=top-row_pre;top=row_pre;rowseleted[0]=row_st;//console.log("向上滑动");
  }//向下滑动或者居中时往上滑动的向下补齐
  if(rowseleted[1]>=row_st&&rowseleted[1]<=row_ed){if(s.row_focus>=row_st&&s.row_focus<=row_ed){//height =  height + row - luckysheet_select_save.top-luckysheet_select_save.height;
  height=row-top;}else {height=row-top;}rowseleted[1]=row_ed;//console.log("向下滑动");
  }// if(rowseleted[0]>=row_st && rowseleted[1]<=row_ed){
  //     top = row_pre;
  //     height = row - top;
  //     rowseleted[0] = row_st;
  //     rowseleted[1] = row_ed;
  //     console.log("居中");
  // }
  // else if(rowseleted[0]>=row_st){
  //     top = row_pre;
  //     height = luckysheet_select_save.top + height - row_pre;
  // }
  // else if(rowseleted[1]<=row_ed){
  //     height =  height + row - luckysheet_select_save.top;
  // }
  }if(!(rowseleted[1]<row_st||rowseleted[0]>row_ed)){//console.log(columnseleted, col_st, col_ed);
  if(columnseleted[0]<=col_ed&&columnseleted[0]>=col_st){// left = col_pre;
  // var fix = luckysheet_select_save.width;
  // if(luckysheet_select_save.column_focus>=col_st && luckysheet_select_save.column_focus<=col_ed){
  //     fix = width;
  // }
  // width = luckysheet_select_save.left + fix - col_pre;
  width+=left-col_pre;left=col_pre;columnseleted[0]=col_st;}//向右滑动或者居中时往左滑动的向下补齐
  if(columnseleted[1]>=col_st&&columnseleted[1]<=col_ed){if(s.column_focus>=col_st&&s.column_focus<=col_ed){//width =  width + col - luckysheet_select_save.left-luckysheet_select_save.width;
  width=col-left;}else {width=col-left;}columnseleted[1]=col_ed;}// if(columnseleted[0]>=col_st && columnseleted[1]<=col_ed){
  //     left = col_pre;
  //     width = col - left;
  //     columnseleted[0] = col_st;
  //     columnseleted[1] = col_ed;
  // }
  }ismatch=true;}}if(ismatch){return [columnseleted,rowseleted,top,height,left,width];}else {return null;}},getCellRealSize:function getCellRealSize(d,cell_r,cell_c){var width=luckysheet.defaultcollen;var height=luckysheet.defaultrowlen;var celldata=d[cell_r][cell_c];if(!!celldata&&celldata["mc"]!=null){var mc=celldata["mc"];var margeset=luckysheet.menuButton.mergeborer(d,mc.r,mc.c);if(!!margeset){var row=margeset.row[1];var row_pre=margeset.row[0];var row_index=margeset.row[2];var row_index_ed=margeset.row[3];var col=margeset.column[1];var col_pre=margeset.column[0];var col_index=margeset.column[2];var col_index_ed=margeset.column[3];width=col-col_pre-1;height=row-row_pre-1;}}else {var config=luckysheet.getluckysheetfile()[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["config"];if(config["columlen"]!=null&&config["columlen"][cell_c]!=null){width=config["columlen"][cell_c];}if(config["rowlen"]!=null&&config["rowlen"][cell_r]!=null){height=config["rowlen"][cell_r];}}return [width,height];},getTextHeightCache:{},getTextSize:function getTextSize(text,font){var f=font||'10pt 微软雅黑';var _this=this;if(f in _this.getTextHeightCache){return _this.getTextHeightCache[f];}if($("#luckysheetTextSizeTest").length==0){$('<span id="luckysheetTextSizeTest" style="float:left;white-space:nowrap;visibility:hidden">'+text+'</span>').appendTo($('body'));}var o=$("#luckysheetTextSizeTest").text(text).css({'font':f}),w=o.width(),h=o.height();_this.getTextHeightCache[f]=[w,h];return [w,h];},activeFormulaInput:function activeFormulaInput(row_index,col_index,rowh,columnh,formula,isnull){if(isnull==null){isnull=false;}var row_range=luckysheet.rowLocationByIndex(row_index);var col_range=luckysheet.colLocationByIndex(col_index);luckysheet.luckysheetupdateCell(row_range[1],row_range[0],row_index,col_range[1],col_range[0],col_index,luckysheet.flowdata,true);//console.log(row_index, col_index, row, column);
  if(isnull){var formulaTxt='<span dir="auto" class="luckysheet-formula-text-color">=</span><span dir="auto" class="luckysheet-formula-text-color">'+formula.toUpperCase()+'</span><span dir="auto" class="luckysheet-formula-text-color">(</span><span dir="auto" class="luckysheet-formula-text-color">)</span>';$("#luckysheet-rich-text-editor").html(formulaTxt);var currSelection=window.getSelection();var $span=$("#luckysheet-rich-text-editor").find("span");luckysheet.formula.setCaretPosition($span.get($span.length-2),0,1);return;}var row_pre=luckysheet.rowLocationByIndex(rowh[0])[0],row=luckysheet.rowLocationByIndex(rowh[1])[1],col_pre=luckysheet.colLocationByIndex(columnh[0])[0],col=luckysheet.colLocationByIndex(columnh[1])[1];var formulaTxt='<span dir="auto" class="luckysheet-formula-text-color">=</span><span dir="auto" class="luckysheet-formula-text-color">'+formula.toUpperCase()+'</span><span dir="auto" class="luckysheet-formula-text-color">(</span><span class="luckysheet-formula-functionrange-cell" rangeindex="0" dir="auto" style="color:'+luckysheet.jfcolor[0]+';">'+luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,{"row":rowh,"column":columnh},luckysheet.currentSheetIndex)+'</span><span dir="auto" class="luckysheet-formula-text-color">)</span>';$("#luckysheet-rich-text-editor").html(formulaTxt);//$("#luckysheet-rich-text-editor").html("=" + formula.toUpperCase() + "(" + luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex, {"row":row, "column":column }, luckysheet.currentSheetIndex) + ")");
  luckysheet.formula.israngeseleciton();luckysheet.formula.rangestart=true;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;luckysheet.formula.rangechangeindex=0;luckysheet.formula.rangeSetValue({"row":rowh,"column":columnh});luckysheet.formula.func_selectedrange={"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1,"left_move":col_pre,"width_move":col-col_pre-1,"top_move":row_pre,"height_move":row-row_pre-1,"row":[row_index,row_index],"column":[col_index,col_index]};$("#luckysheet-formula-functionrange-select").css({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1}).show();$("#luckysheet-formula-help-c").hide();},backFormulaInput:function backFormulaInput(d,r,c,rowh,columnh,formula){var f='='+formula.toUpperCase()+'('+luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,{"row":rowh,"column":columnh},luckysheet.currentSheetIndex)+')';var v=luckysheet.formula.execfunction(f,r,c);var value={"v":v[1],"f":v[2]};luckysheet.setcellvalue(r,c,d,value);luckysheet.formula.execFunctionExist.push({"r":r,"c":c,"i":luckysheet.currentSheetIndex});luckysheet.server.historyParam(d,luckysheet.currentSheetIndex,{"row":[r,r],"column":[c,c]});},checkNoNullValue:function checkNoNullValue(cell){var v=cell;if(luckysheet.getObjType(v)=="object"){v=v.v;}if(!luckysheet.func_methods.isRealNull(v)&&luckysheet.isdatatypemulti(v).num&&(cell.ct==null||cell.ct.t==null||cell.ct.t=="n"||cell.ct.t=="g")){return true;}else {return false;}},checkNoNullValueAll:function checkNoNullValueAll(cell){var v=cell;if(luckysheet.getObjType(v)=="object"){v=v.v;}if(!luckysheet.func_methods.isRealNull(v)){return true;}else {return false;}},getNoNullValue:function getNoNullValue(d,st_x,ed,type){var hasValueStart=null;var nullNum=0,nullTime=0;var _this=this;for(var r=ed-1;r>=0;r--){var cell;if(type=="c"){cell=d[st_x][r];}else {cell=d[r][st_x];}if(_this.checkNoNullValue(cell)){hasValueStart=r;}else if(cell==null||cell.v==null||cell.v==""){nullNum++;if(nullNum>=40){if(nullTime<=0){nullTime=1;}else {break;}}}else {break;}}return hasValueStart;},singleFormulaInput:function singleFormulaInput(d,_index,fix,st_m,ed_m,formula,type,noNum,noNull){if(type==null){type="r";}if(noNum==null){noNum=true;}if(noNull==null){noNull=true;}var _this=this;var isNull=true,isNum=false;for(var c=st_m;c<=ed_m;c++){var cell=null;if(type=="c"){cell=d[c][fix];}else {cell=d[fix][c];}if(_this.checkNoNullValue(cell)){isNull=false;isNum=true;}else if(_this.checkNoNullValueAll(cell)){isNull=false;}}if(isNull&&noNull){var st_r_r=_this.getNoNullValue(d,_index,fix,type);if(st_r_r==null){if(type=="c"){_this.activeFormulaInput(_index,fix,null,null,formula,true);}else {_this.activeFormulaInput(fix,_index,null,null,formula,true);}}else {if(_index==st_m){for(var c=st_m;c<=ed_m;c++){var st_r_r=_this.getNoNullValue(d,c,fix,type);if(st_r_r==null){break;}if(type=="c"){_this.backFormulaInput(d,c,fix,[c,c],[st_r_r,fix-1],formula);}else {_this.backFormulaInput(d,fix,c,[st_r_r,fix-1],[c,c],formula);}}}else {for(var c=ed_m;c>=st_m;c--){var st_r_r=_this.getNoNullValue(d,c,fix,type);if(st_r_r==null){break;}//_this.backFormulaInput(d, st_r, c, [st_r_r, ed_r-1], [c, c], formula);
  if(type=="c"){_this.backFormulaInput(d,c,fix,[c,c],[st_r_r,fix-1],formula);}else {_this.backFormulaInput(d,fix,c,[st_r_r,fix-1],[c,c],formula);}}}}}else if(isNum&&noNum){var cell=null;if(type=="c"){cell=d[ed_m][fix];}else {cell=d[fix][ed_m];}if(cell!=null&&cell.v!=null&&cell.v.toString().length>0){var c=ed_m;if(type=="c"){cell=d[ed_m][fix];}else {cell=d[fix][ed_m];}while(cell!=null&&cell.v!=null&&cell.v.toString().length>0){c++;var len=null;if(type=="c"){len=d.length;}else {len=d[0].length;}if(c>=len){return;}//cell = d[fix][c];
  if(type=="c"){cell=d[c][fix];}else {cell=d[fix][c];}}if(type=="c"){//_this.backFormulaInput(d, c, fix, [c, c], [st_r_r, fix-1], formula);
  _this.backFormulaInput(d,c,fix,[st_m,ed_m],[fix,fix],formula);}else {_this.backFormulaInput(d,fix,c,[fix,fix],[st_m,ed_m],formula);}}else {if(type=="c"){//_this.backFormulaInput(d, c, fix, [c, c], [st_r_r, fix-1], formula);
  _this.backFormulaInput(d,ed_m,fix,[st_m,ed_m],[fix,fix],formula);}else {_this.backFormulaInput(d,fix,ed_m,[fix,fix],[st_m,ed_m],formula);}}}else {return true;}// luckysheet.formula.execFunctionExist.reverse();
  // luckysheet.formula.execFunctionGroup(null, null, null, null, d);
  // luckysheet.jfrefreshgrid(d, st_r, ed_r, st_c, ed_c);
  // clearTimeout(jfcountfuncTimeout);
  // jfcountfunc();
  },autoSelectionFormula:function autoSelectionFormula(formula){var _this=this;var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var isfalse=true;luckysheet.formula.execFunctionExist=[];var execFormulaInput_c=function execFormulaInput_c(){var st_c_c=_this.getNoNullValue(d,st_r,ed_c,"c");if(st_c_c==null){_this.activeFormulaInput(st_r,st_c,null,null,formula,true);}else {_this.activeFormulaInput(st_r,st_c,[st_r,ed_r],[st_c_c,ed_c-1],formula);}};var execFormulaInput=function execFormulaInput(){var st_r_c=_this.getNoNullValue(d,st_c,ed_r,"r");if(st_r_c==null){execFormulaInput_c();}else {_this.activeFormulaInput(st_r,st_c,[st_r_c,ed_r-1],[st_c,ed_c],formula);}};for(var s=0;s<luckysheet_select_save.length;s++){var st_r=luckysheet_select_save[s].row[0],ed_r=luckysheet_select_save[s].row[1];var st_c=luckysheet_select_save[s].column[0],ed_c=luckysheet_select_save[s].column[1];var row_index=luckysheet_select_save[s].row_focus,col_index=luckysheet_select_save[s].column_focus;if(st_r==ed_r&&st_c==ed_c){if(ed_r-1<0&&ed_c-1<0){_this.activeFormulaInput(st_r,st_c,null,null,formula,true);return;}if(ed_r-1>=0&&_this.checkNoNullValue(d[ed_r-1][st_c])){execFormulaInput();}else if(ed_c-1>=0&&_this.checkNoNullValue(d[st_r][ed_c-1])){execFormulaInput_c();}else {execFormulaInput();}}else if(st_r==ed_r){isfalse=_this.singleFormulaInput(d,col_index,st_r,st_c,ed_c,formula,"r");}else if(st_c==ed_c){isfalse=_this.singleFormulaInput(d,row_index,st_c,st_r,ed_r,formula,"c");}else {var r_false=true;for(var r=st_r;r<=ed_r;r++){r_false=_this.singleFormulaInput(d,col_index,r,st_c,ed_c,formula,"r",true,false)&&r_false;}var c_false=true;for(var c=st_c;c<=ed_c;c++){c_false=_this.singleFormulaInput(d,row_index,c,st_r,ed_r,formula,"c",true,false)&&c_false;}isfalse=!!r_false&&!!c_false;}isfalse=isfalse&&isfalse;}if(!isfalse){luckysheet.formula.execFunctionExist.reverse();luckysheet.formula.execFunctionGroup(null,null,null,null,d);luckysheet.jfrefreshgrid(d,[{"row":[st_r,ed_r],"column":[st_c,ed_c]}]);clearTimeout(jfcountfuncTimeout);jfcountfuncTimeout=setTimeout(function(){luckysheet.jfcountfunc();},500);}},getStyleByCell:function getStyleByCell(d,r,c){var style="";//交替颜色
  var af_compute=luckysheet.alternateformat.getComputeMap();var checksAF=luckysheet.alternateformat.checksAF(r,c,af_compute);//条件格式
  var cf_compute=luckysheet.conditionformat.getComputeMap();var checksCF=luckysheet.conditionformat.checksCF(r,c,cf_compute);var cell=d[r][c];for(var key in cell){var value=luckysheet.menuButton.checkstatus(d,r,c,key);if(checksAF!=null||checksCF!=null&&checksCF["cellColor"]!=null){if(checksCF!=null&&checksCF["cellColor"]!=null){style+="background: "+checksCF["cellColor"]+";";}else if(checksAF!=null){style+="background: "+checksAF[1]+";";}}if(luckysheet.getObjType(value)=="object"){continue;}if(key=="bg"||checksAF!=null||checksCF!=null&&checksCF["cellColor"]!=null){if(checksCF!=null&&checksCF["cellColor"]!=null){style+="background: "+checksCF["cellColor"]+";";}else if(checksAF!=null){style+="background: "+checksAF[1]+";";}else {style+="background: "+value+";";}}if(key=="bl"&&value!="0"){style+="font-weight: bold;";}if(key=="it"&&value!="0"){style+="font-style:italic;";}if(key=="ff"&&value!="0"){var f=value;if(!isNaN(parseInt(value))){f=luckysheet.menuButton.fontarray[parseInt(value)];}style+="font-family: "+f+";";}if(key=="fs"&&value!="10"){style+="font-size: "+value+"pt;";}if(key=="fc"&&value!="#000000"||checksAF!=null||checksCF!=null&&checksCF["textColor"]!=null){if(checksCF!=null&&checksCF["textColor"]!=null){style+="color: "+checksCF["textColor"]+";";}else if(checksAF!=null){style+="color: "+checksAF[0]+";";}else {style+="color: "+value+";";}}if(key=="ht"&&value!="1"){if(value=="0"){style+="text-align: center;";}else if(value=="2"){style+="text-align: right;";}}if(key=="vt"&&value!="0"){if(value=="1"){style+="vertical-align: top;";}else if(value=="2"){style+="vertical-align: bottom;";}}}return style;}};luckysheet.server={gridKey:null,loadUrl:null,updateUrl:null,updateImageUrl:null,title:null,historyParam:function historyParam(data,sheetIndex,range){var _this=this;var r1=range.row[0],r2=range.row[1];var c1=range.column[0],c2=range.column[1];if(r1==r2&&c1==c2){//单个单元格更新
  var v=data[r1][c1];_this.saveParam("v",sheetIndex,v,{"r":r1,"c":c1});}else {//范围单元格更新
  var rowlen=r2-r1+1;var collen=c2-c1+1;var timeR=Math.floor(1000/collen);var n=Math.ceil(rowlen/timeR);//分批次更新，一次最多1000个单元格
  for(var i=0;i<n;i++){var str=r1+timeR*i;if(i==n-1){var edr=r2;}else {var edr=r1+timeR*(i+1)-1;}var v=[];for(var r=str;r<=edr;r++){var v_row=[];for(var c=c1;c<=c2;c++){v_row.push(data[r][c]);}v.push(v_row);}_this.saveParam("rv",sheetIndex,v,{"range":{"row":[str,edr],"column":[c1,c2]}});if(i==n-1){_this.saveParam("rv_end",sheetIndex,null);}}}},saveParam:function saveParam(type,index,value,params){if(!luckysheet.server.allowUpdate){return;}if(value==undefined){value=null;}var d={};d.t=type;d.i=index;d.v=value;if(type=="rv"){//单元格批量更新
  d.range=params.range;}else if(type=="v"||type=="fu"||type=="fm"){d.r=params.r;d.c=params.c;}else if(type=="fc"){d.op=params.op;d.pos=params.pos;}else if(type=="drc"||type=="arc"||type=="h"||type=="wh"){d.rc=params.rc;}else if(type=="c"){d.cid=params.cid;d.op=params.op;}else if(type=="f"){d.op=params.op;d.pos=params.pos;}else if(type=="s");else if(type=="sh"){d.op=params.op;if(params.cur!=null){d.cur=params.cur;}}else if(type=="cg"){d.k=params.k;}else if(type=="all"){d.k=params.k;// d.s = params.s;
  }var msg=pako.gzip(encodeURIComponent(JSON.stringify(d)),{to:"string"});luckysheet.server.websocket.send(msg);// var _this = this;
  // _this.requestlast = moment();
  // _this.setlocaldata(d, function(data){
  //     _this.checksubmit(data);
  // });
  },websocket:null,wxErrorCount:0,openWebSocket:function openWebSocket(){if('WebSocket'in window){luckysheet.server.websocket=new WebSocket(luckysheet.server.updateUrl+"?t=111&g="+encodeURIComponent(luckysheet.server.gridKey));//连接建立时触发
  luckysheet.server.websocket.onopen=function(){console.info('WebSocket连接成功');luckysheet.jfhideloading();luckysheet.server.wxErrorCount=0;setInterval(function(){luckysheet.server.websocket.send("rub");},60000);};//客户端接收服务端数据时触发
  luckysheet.server.websocket.onmessage=function(result){var data=eval('('+result.data+')');console.info(data);var type=data.type;if(type==1);else if(type==2){//更新数据
  var item=JSON.parse(data.data);luckysheet.server.wsUpdateMsg(item);}else if(type==3){//多人操作不同选区("t": "mv")（用不同颜色显示其他人所操作的选区）
  var id=data.id;var username=data.username;var item=JSON.parse(data.data);var type=item.t,index=item.i,value=item.v;if(luckysheet.getObjType(value)!="array"){value=JSON.parse(value);}if(index==luckysheet.currentSheetIndex){var r=value[value.length-1].row[0];var c=value[value.length-1].column[0];luckysheet.server.multipleRangeShow(id,username,r,c);}}else if(type==4){//批量指令更新
  var items=JSON.parse(data.data);for(var i=0;i<items.length;i++){luckysheet.server.wsUpdateMsg(item[i]);}}};//通信发生错误时触发
  luckysheet.server.websocket.onerror=function(){luckysheet.server.wxErrorCount++;if(luckysheet.server.wxErrorCount>3){luckysheet.jfshowloading("WebSocket连接发生错误, 请刷新页面！");}else {luckysheet.jfshowloading("WebSocket连接发生错误, 请耐心等待！");luckysheet.server.openWebSocket();}};//连接关闭时触发
  luckysheet.server.websocket.onclose=function(){console.info('WebSocket连接关闭');alert("服务器通信发生错误，请刷新页面后再试，如若不行请联系管理员！");};}else {alert('当前浏览器 Not Support WebSocket');}},wsUpdateMsg:function wsUpdateMsg(item){var type=item.t,index=item.i,value=item.v;var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(index)];if(file==null){return;}if(type=="v"){//单个单元格数据更新
  if(file.data==null||file.data.length==0){return;}var r=item.r,c=item.c;file.data[r][c]=value;if(index==luckysheet.currentSheetIndex){luckysheet.flowdata=file.data;//如果更新的单元格有批注
  if(value!=null&&value.ps!=null){luckysheet.postil.buildPs(r,c,value.ps);}else {luckysheet.postil.buildPs(r,c,null);}setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}}else if(type=="rv"){//范围单元格数据更新
  if(file.data==null||file.data.length==0){return;}var r1=item.range.row[0],r2=item.range.row[1];var c1=item.range.column[0],c2=item.range.column[1];for(var r=r1;r<=r2;r++){for(var c=c1;c<=c2;c++){file.data[r][c]=value[r-r1][c-c1];}}if(index==luckysheet.currentSheetIndex){luckysheet.flowdata=file.data;//如果更新的单元格有批注
  for(var r=r1;r<=r2;r++){for(var c=c1;c<=c2;c++){if(value[r-r1][c-c1]!=null&&value[r-r1][c-c1].ps!=null){luckysheet.postil.buildPs(r,c,value[r-r1][c-c1].ps);}else {luckysheet.postil.buildPs(r,c,null);}}}setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}}else if(type=="cg"){//config更新（rowhidden，rowlen，columlen，merge，borderInfo）
  var k=item.k;if(k=="borderInfo"){file["config"]["borderInfo"]=value;}else {if(!(k in file["config"])){file["config"][k]={};}for(var key in value){file["config"][k][key]=value[key];}}if(index==luckysheet.currentSheetIndex){config=file["config"];if(k=="rowlen"||k=="columlen"||k=="rowhidden"){luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);}setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}}else if(type=="all"){//通用保存更新
  var k=item.k;file[k]=value;if(k=="name"){//表格名
  $("#luckysheet-sheet-container-c #luckysheet-sheets-item"+index).find("span.luckysheet-sheets-item-name").html(value);}else if(k=="color"){//表格颜色
  var luckysheetcurrentSheetitem=$("#luckysheet-sheet-container-c #luckysheet-sheets-item"+index);luckysheetcurrentSheetitem.find(".luckysheet-sheets-item-color").remove();if(value!=null||value!=""){luckysheetcurrentSheetitem.append('<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+value+';"></div>');}}else if(k=="pivotTable");else if(k=="freezen"){//冻结行列
  if(index==luckysheet.currentSheetIndex){if(file["freezen"].horizontal==null){$("#luckysheet-freezen-btn-horizontal").html('<i class="fa fa-list-alt"></i> 冻结首行');luckysheet.freezen.freezenhorizontaldata=null;$("#luckysheet-freezebar-horizontal").hide();}else {luckysheet.freezen.createFreezenHorizontal(file["freezen"].horizontal.freezenhorizontaldata,file["freezen"].horizontal.top);}if(file["freezen"].vertical==null){$("#luckysheet-freezen-btn-vertical").html('<i class="fa fa-indent"></i> 冻结首列');luckysheet.freezen.freezenverticaldata=null;$("#luckysheet-freezebar-vertical").hide();}else {luckysheet.freezen.createFreezenVertical(file["freezen"].vertical.freezenverticaldata,file["freezen"].vertical.left);}luckysheet.freezen.createAssistCanvas();}}else if(k=="filter_select"){//筛选范围
  if(index==luckysheet.currentSheetIndex){luckysheet.createFilterOptions(value);}}else if(k=="filter"){//筛选保存
  if(index==luckysheet.currentSheetIndex){luckysheet.createFilterOptions(file.filter_select,value);}}else if(k=="luckysheet_conditionformat_save"){//条件格式
  if(index==luckysheet.currentSheetIndex){setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}}else if(k=="luckysheet_alternateformat_save"){//交替颜色
  if(index==luckysheet.currentSheetIndex){setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}}else if(k=="config"){//config
  if(index==luckysheet.currentSheetIndex){config=value;luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);}}else if(k=="dynamicArray"){//动态数组
  if(index==luckysheet.currentSheetIndex){setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}}}else if(type=="fc"){//函数链calc
  var op=item.op,pos=item.pos;if(luckysheet.getObjType(value)!="object"){value=eval('('+value+')');}var r=value.r,c=value.c;var func=value.func;var calcChain=file["calcChain"]==null?[]:file["calcChain"];if(op=="add"){calcChain.push(value);}else if(op=="del"){for(var a=0;a<calcChain.length;a++){if(r==calcChain[a].r&&c==calcChain[a].c&&index==calcChain[a].index){calcChain.splice(a,1);}}}else if(op=="update"){for(var a=0;a<calcChain.length;a++){if(r==calcChain[a].r&&c==calcChain[a].c&&index==calcChain[a].index){calcChain[a].func=func;}}}setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}else if(type=="drc"){//删除行列
  if(file.data==null||file.data.length==0){return;}var rc=item.rc,st_i=value.index,len=value.len,mc=value.mc,borderInfo=value.borderInfo;var data=file.data;if(rc=="r"){file["row"]-=len;data.splice(st_i,len);//空白行模板
  var row=[];for(var c=0;c<data[0].length;c++){row.push(null);}//删除多少行，增加多少行空白行                
  for(var r=0;r<len;r++){data.push(row);}}else {file["column"]-=len;//空白列模板
  var addcol=[];for(var r=0;r<len;r++){addcol.push(null);}for(var i=0;i<data.length;i++){data[i].splice(st_i,len);data[i]=data[i].concat(addcol);}}for(x in mc){var r=mc[x].r,c=mc[x].c;data[r][c].mc=mc[x];}file["config"].merge=mc;file["config"].borderInfo=borderInfo;if(index==luckysheet.currentSheetIndex){luckysheet.flowdata=data;config["merge"]=mc;config["borderInfo"]=borderInfo;setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}}else if(type=="arc"){//增加行列
  if(file.data==null||file.data.length==0){return;}var rc=item.rc,st_i=value.index,len=value.len,addData=value.data,mc=value.mc,borderInfo=value.borderInfo;var data=file.data;if(rc=="r"){file["row"]+=len;var arr=[];for(var i=0;i<len;i++){arr.push(JSON.stringify(addData[i]));}eval('data.splice('+st_i+', 0, '+arr.join(",")+')');}else {file["column"]+=len;for(var i=0;i<data.length;i++){data[i].splice(st_i,0,addData[i]);}}for(x in mc){var r=mc[x].r,c=mc[x].c;data[r][c].mc=mc[x];}file["config"].merge=mc;file["config"].borderInfo=borderInfo;if(index==luckysheet.currentSheetIndex){luckysheet.flowdata=data;config["merge"]=mc;config["borderInfo"]=borderInfo;setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);}}else if(type=="f"){//筛选
  var op=item.op,pos=item.pos;var filter=file.filter;if(filter==null){filter={};}if(op=="upOrAdd"){filter[pos]=value;}else if(op=="del"){delete filter[pos];}if(index==luckysheet.currentSheetIndex){luckysheet.createFilterOptions(file.filter_select,filter);}}else if(type=="fsc"){//清除筛选
  file.filter=null;file.filter_select=null;if(index==luckysheet.currentSheetIndex){$('#luckysheet-filter-selected-sheet'+luckysheet.currentSheetIndex+', #luckysheet-filter-options-sheet'+luckysheet.currentSheetIndex).remove();$("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide();}}else if(type=="fsr"){//恢复筛选
  file.filter=value.filter;file.filter_select=value.filter_select;if(index==luckysheet.currentSheetIndex){luckysheet.createFilterOptions(file.filter_select,file.filter);}}else if(type=="sha"){//新建sheet
  luckysheetfile.push(value);var colorset='';if(value.color!=null){colorset='<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+value.color+';"></div>';}$("#luckysheet-sheet-container-c").append(luckysheet.replaceHtml(sheetHTML,{"index":value.index,"active":"","name":value.name,"style":"","colorset":colorset}));$("#luckysheet-cell-main").append('<div id="luckysheet-datavisual-selection-set-'+value.index+'" class="luckysheet-datavisual-selection-set"></div>');}else if(type=="shc"){//复制sheet
  var copyindex=value.copyindex,name=value.name;var copyarrindex=luckysheet.sheetmanage.getSheetIndex(copyindex);var copyjson=$.extend(true,{},luckysheetfile[copyarrindex]);copyjson.index=index;copyjson.name=name;luckysheetfile.splice(copyarrindex+1,0,copyjson);var copyobject=$("#luckysheet-sheets-item"+copyindex);$("#luckysheet-sheet-container-c").append(luckysheet.replaceHtml(sheetHTML,{"index":copyjson.index,"active":"","name":copyjson.name,"style":"","colorset":""}));$("#luckysheet-sheets-item"+copyjson.index).insertAfter(copyobject);$("#luckysheet-cell-main").append('<div id="luckysheet-datavisual-selection-set-'+copyjson.index+'" class="luckysheet-datavisual-selection-set"></div>');}else if(type=="shd"){//删除sheet
  for(var i=0;i<luckysheetfile.length;i++){if(luckysheetfile[i].index==value.deleIndex){luckysheet.server.sheetDeleSave.push(luckysheetfile[i]);luckysheetfile.splice(i,1);break;}}$("#luckysheet-sheets-item"+value.deleIndex).remove();$("#luckysheet-datavisual-selection-set-"+value.deleIndex).remove();}else if(type=="shr"){//sheet位置
  for(x in value){luckysheetfile[luckysheet.sheetmanage.getSheetIndex(x)].order=value[x];}}else if(type=="shre"){//删除sheet恢复操作
  for(var i=0;i<luckysheet.server.sheetDeleSave.length;i++){if(luckysheet.server.sheetDeleSave[i].index==value.reIndex){var datav=luckysheet.server.sheetDeleSave[i];luckysheetfile.push(datav);var colorset='';if(value.color!=null){colorset='<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+datav.color+';"></div>';}$("#luckysheet-sheet-container-c").append(luckysheet.replaceHtml(sheetHTML,{"index":datav.index,"active":"","name":datav.name,"style":"","colorset":colorset}));$("#luckysheet-cell-main").append('<div id="luckysheet-datavisual-selection-set-'+datav.index+'" class="luckysheet-datavisual-selection-set"></div>');break;}}}else if(type=="sh"){//隐藏sheet
  var op=item.op,cur=item.cur;if(op=="hide"){file.hide=1;$("#luckysheet-sheets-item"+index).hide();if(index==luckysheet.currentSheetIndex){$("#luckysheet-sheets-item"+cur).addClass("luckysheet-sheets-item-active");luckysheet.sheetmanage.changeSheetExec(cur);}}else if(op=="show"){file.hide=0;$("#luckysheet-sheets-item"+index).show();}}else if(type=="c"){//图表操作
  var op=item.op,cid=item.cid;if(op=="add"){//插入
  file.chart.push(value);luckysheet.insertChartTosheet(value.sheetIndex,value.dataSheetIndex,value.option,value.chartType,value.selfOption,value.defaultOption,value.row,value.column,value.chart_selection_color,value.chart_id,value.chart_selection_id,value.chartStyle,value.rangeConfigCheck,value.rangeRowCheck,value.rangeColCheck,value.chartMarkConfig,value.chartTitleConfig,value.winWidth,value.winHeight,value.scrollLeft1,value.scrollTop1,value.chartTheme,value.myWidth,value.myHeight,value.myLeft,value.myTop,value.myindexrank1,true);}else if(op=="xy"||op=="wh"||op=="update"){//移动 缩放 更新
  for(var i=0;i<file.chart.length;i++){var chartjson=file.chart[i];if(chartjson.chart_id==cid){for(var item in chartjson){for(var vitem in value){if(item==vitem){chartjson[item]=value[vitem];}}}luckysheet.sheetmanage.saveChart(chartjson);return;}}}else if(op=="del"){//删除
  for(var i=0;i<file.chart.length;i++){var chartjson=file.chart[i];if(chartjson.chart_id==cid){file.chart.splice(i,1);$("#"+cid).remove();luckysheet.sheetmanage.delChart($("#"+cid).attr("chart_id"),$("#"+cid).attr("sheetIndex"));return;}}}}else if(type=="na"){//表格名称
  $("#luckysheet_info_detail_input").val(value).css("width",luckysheet.getByteLen(value)*10);}},multipleIndex:0,multipleRangeShow:function multipleRangeShow(id,name,r,c){var r1=r2=r;var c1=c2=c;var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1],col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];var margeset=luckysheet.menuButton.mergeborer(luckysheet.flowdata,r1,c1);if(!!margeset){row=margeset.row[1];row_pre=margeset.row[0];col=margeset.column[1];col_pre=margeset.column[0];}if($("#luckysheet-multipleRange-show-"+id).length>0){$("#luckysheet-multipleRange-show-"+id).css({"position":"absolute","left":col_pre-1,"width":col-col_pre-1,"top":row_pre-1,"height":row-row_pre-1});}else {var itemHtml='<div id="luckysheet-multipleRange-show-'+id+'" data-color="'+luckysheet.jfcolor[luckysheet.server.multipleIndex]+'" title="'+name+'" style="position: absolute;left: '+(col_pre-1)+'px;width: '+(col-col_pre-1)+'px;top: '+(row_pre-1)+'px;height: '+(row-row_pre-1)+'px;border: 1px solid '+luckysheet.jfcolor[luckysheet.server.multipleIndex]+';z-index: 15;">'+'<div style="width: 100%;height: 100%;position: absolute;top: 0;right: 0;bottom: 0;left: 0;opacity: 0.03;background-color: '+luckysheet.jfcolor[luckysheet.server.multipleIndex]+'"></div>'+'</div>';$(itemHtml).appendTo($("#luckysheet-cell-main #luckysheet-multipleRange-show"));luckysheet.server.multipleIndex++;}},sheetDeleSave:[],//共享编辑模式下 删除的sheet保存下来，方便恢复时取值
  submitInterval:1000,imagesubmitInterval:5000,submitdatalimit:50,submitcompresslimit:1000,checksubmit:function checksubmit(data){var _this=this;//clearTimeout(_this.requestTimeOut);
  _this.submitTimeout();clearTimeout(_this.imageRequestTimeout);_this.imageRequestTimeout=setTimeout(function(){_this.imageRequest();},_this.imagesubmitInterval);},submitTimeout:function submitTimeout(){var _this=this;clearTimeout(_this.requestTimeOut);//console.log(_this.requestlast, moment(), (_this.requestlast!=null && _this.requestlast.add(10, 'seconds').isBefore(moment()) ) );
  if(!_this.requestLock&&_this.requestlast!=null&&_this.requestlast.clone().add(1,'seconds').isBefore(moment())){_this.request();}// if(!_this.imageRequestLock && (_this.imageRequestLast==null || _this.imageRequestLast.clone().add(30, 'seconds').isBefore(moment()) ) ){
  // }
  _this.requestTimeOut=setTimeout(function(){_this.submitTimeout();},_this.submitInterval);},requestLock:false,requestlast:null,firstchange:true,requestTimeOut:null,request:function request(){var _this=this;var key=this.gridKey;_this.cachelocaldata(function(cahce_key,params){if(params.length==0){return;}console.log(params);params=encodeURIComponent(JSON.stringify(params));var compressBeginLen=params.length;var iscommpress=false;// if (compressBeginLen > _this.submitcompresslimit) {
  //     params = pako.gzip(params, { to: "string" });
  //     iscommpress = true;
  // }
  _this.requestLock=true;//console.log(params);
  console.log("request");if(_this.updateUrl!=""){$.post(_this.updateUrl,{compress:iscommpress,gridKey:_this.gridKey,data:params},function(data){var re=eval('('+data+')');if(re.status){$("#luckysheet_info_detail_update").html("最近存档时间:"+moment().format("M-D H:m:s"));$("#luckysheet_info_detail_save").html("同步成功");_this.clearcachelocaldata();}else {$("#luckysheet_info_detail_save").html("<span style='color:#ff2121'>同步失败</span>");_this.restorecachelocaldata();}_this.requestlast=moment();_this.requestLock=false;});}});},imageRequestLast:null,imageRequestLock:false,imageRequestTimeout:null,imageRequest:function imageRequest(){var _this=this;html2canvas($("#"+container).find(".luckysheet-grid-window").get(0),{onrendered:function onrendered(canvas){//var imgcut = $("#luckysheet-cell-main").find(".luckysheet-grid-window");
  //document.body.appendChild(canvas);
  var old=$(canvas).appendTo("body");old.hide();var newwidth=old.width();var newheight=old.height();var imageData=old.get(0).getContext("2d").getImageData(0,0,newwidth,newheight);var cutW=newwidth,cutH=newheight;if(cutW*0.54>cutH){cutW=cutH/0.54;}else {cutH=cutW*0.54;}var newCanvas=$("<canvas>").attr("width",cutW).attr("height",cutH)[0];newCanvas.getContext("2d").putImageData(imageData,0,0);old.attr("width",350);old.attr("height",189);old.get(0).getContext("2d").drawImage(newCanvas,0,0,350,189);var base64=old.get(0).toDataURL('image/jpeg',0.9);//console.log(base64);
  //console.log("压缩：", pako.gzip(base64, { to: "string" }));
  //console.log("imageRequest");
  var curindex=luckysheet.sheetmanage.getCurSheetnoset();_this.imageRequestLock=true;// var data1 = pako.gzip(encodeURIComponent(JSON.stringify({"t":"thumb", "img": base64, "curindex":curindex })), { to: "string" });
  var data1=encodeURIComponent(JSON.stringify({"t":"thumb","img":base64,"curindex":curindex}));old.remove();//console.log("缩略图", _this.imageRequestLast,base64);
  if(_this.updateImageUrl!=""){// $.post(_this.updateImageUrl, { compress: true, gridKey: _this.gridKey, data:data1  }, function (data) {
  $.post(_this.updateImageUrl,{compress:false,gridKey:_this.gridKey,data:data1},function(data){var re=eval('('+data+')');if(re.status){imageRequestLast=moment();}else {$("#luckysheet_info_detail_save").html("<span style='color:#ff2121'>网络不稳定</span>");}_this.imageRequestLock=true;});}}});},localdata:[],matchOpt:function matchOpt(v,d){for(var vitem in v){if(vitem=="t"&&v["t"]in{"drc":1,"arc":1,"sha":1,"shc":1,"shd":1}){return false;}if(vitem=="v"){continue;}if(!(vitem in d)){return false;}if(d[vitem]!=v[vitem]){return false;}}return true;},deleteRepeatOpt:function deleteRepeatOpt(data,value){//var d = $.extend(true, [], data); //原来
  var d=data;var _this=this;if(value instanceof Array){for(var i=0;i<value.length;i++){var vitem=value[i];for(var a=0;a<d.length;a++){var ditem=data[i];//var ditem = data[a];?
  if(_this.matchOpt(vitem,ditem)){delete d[a];}}}}else {for(var a=0;a<d.length;a++){var ditem=d[a];if(_this.matchOpt(value,ditem)){delete d[a];}}}var ret=[];for(var i=0;i<d.length;i++){if(d[i]!=null){ret.push(d[i]);}}return ret;},setlocaldata:function setlocaldata(value,func){var key=this.gridKey;//!!window.store && store.push(key, data);
  var _this=this;_this.getlocaldata(function(data){if(data==null){data=[];}//此处不去重，在request同步后台时统一循环一次去重
  //var data = _this.deleteRepeatOpt(data, value);
  if(value instanceof Array){data=data.concat(value);}else {data.push(value);}_this.localdata=data;func(_this.localdata);//console.log(value);
  // localforage.setItem(key, data).then(function () {
  //     console.log(data);
  //     func(data);
  // }).catch(function (err) {
  // });
  });},getlocaldata:function getlocaldata(func){var key=this.gridKey;//return !!window.store && store.get(key);
  func(this.localdata);// localforage.getItem(key).then(function(readValue) {
  //     func(readValue);
  // });
  },clearlocaldata:function clearlocaldata(func){var key=this.gridKey;//!!window.store && store.remove(key);
  this.localdata=[];func();// localforage.removeItem(key, function(err,value) {
  //     func();
  // });
  },cachelocaldata:function cachelocaldata(func){var key=this.gridKey;var _this=this;var cahce_key=key+"__qkcache";//!!window.store && store.remove(key);
  //console.log(key, cahce_key);
  //处理localdata去重
  var updatedata=_this.localdata;var uLen=updatedata.length;if(uLen>1){var prevData=[];prevData[0]=updatedata[0];for(var i=1;i<uLen;i++){var value=updatedata[i];var flag=true;for(var a=0;a<prevData.length;a++){var ditem=prevData[a];if(_this.matchOpt(value,ditem)){prevData.splice(a,1,value);flag=false;//如果已匹配重复，则后续无需再加
  break;}}if(flag){prevData=prevData.concat(value);}}updatedata=prevData;}if(updatedata==null||updatedata.length==0){return;}//console.log(key, cahce_key,updatedata);
  _this.clearlocaldata(function(){localforage.setItem(cahce_key,updatedata).then(function(){func(cahce_key,updatedata);});});// localforage.getItem(key).then(function(readValue) {
  //     var updatedata = readValue;
  //     if(readValue==null || readValue.length==0){
  //         return;
  //     }
  //     //console.log(key, cahce_key,updatedata);
  //     _this.clearlocaldata(function(){
  //         localforage.setItem(cahce_key, updatedata).then(function () {
  //             func(cahce_key, updatedata);
  //         });
  //     });
  // });
  },clearcachelocaldata:function clearcachelocaldata(func){var key=this.gridKey;var cahce_key=key+"__qkcache";//!!window.store && store.remove(key);
  localforage.removeItem(cahce_key,function(err,value){if(func&&typeof func=="function"){func();}});},restorecachelocaldata:function restorecachelocaldata(func){var key=this.gridKey;var cahce_key=key+"__qkcache";var _this=this;localforage.getItem(cahce_key).then(function(readValue){var updatedata=readValue;_this.getlocaldata(function(data){if(data==null){data=[];}var newdata=updatedata.concat(data);//data.unshift(updatedata);
  _this.localdata=newdata;if(func instanceof Function){func(_this.localdata);}// localforage.setItem(key, newdata).then(function () {
  //     func(newdata);
  // }).catch(function (err) {
  // });
  });});}};luckysheet.method={//翻页
  addDataAjax:function addDataAjax(param,index,url,func){if(index==null){index=luckysheet.currentSheetIndex;}if(url==null){url=luckysheet.server.loadSheetUrl;}$("#luckysheet-grid-window-1").append(luckysheetlodingHTML);//param.currentPage <=1 ? param.currentPage = 2 :param.currentPage++;
  param.currentPage++;//var arg = {"gridKey" : luckysheet.server.gridKey, "index": index};
  //param = $.extend(true, param, arg);
  var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(index)];var dataType='application/json;charset=UTF-8';// var token = sessionStorage.getItem('token');
  // rptapp
  var token=sessionStorage.getItem('x-auth-token');$.ajax({method:'POST',url:url,// rptapp
  // headers:{"x-auth-token":JSON.parse(token)},
  headers:{"x-auth-token":token},data:JSON.stringify(param),contentType:dataType,success:function success(d){//d可能为json字符串
  if(typeof d=="string"){d=JSON.parse(d);}var dataset=d.data;// var file = dataset[luckysheet.sheetmanage.getSheetIndex(index)];
  // var newData = file.celldata;
  // luckysheet.luckysheetextendData(file["row"], newData);
  // rptapp
  var newData=dataset.celldata;luckysheet.luckysheetextendData(dataset["row"],newData);setTimeout(function(){$("#luckysheetloadingdata").fadeOut().remove();},500);if(func&&typeof func=="function"){func(dataset);}}});},//重载
  reload:function reload(param,index,url,func){if(index==null){index=luckysheet.currentSheetIndex;}if(url==null){url=luckysheet.server.loadSheetUrl;}$("#luckysheet-grid-window-1").append(luckysheetlodingHTML);var arg={"gridKey":luckysheet.server.gridKey,"index":index};param=$.extend(true,param,arg);var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(index)];$.post(url,param,function(d){var dataset=eval("("+d+")");file.celldata=dataset[index.toString()];var data=luckysheet.sheetmanage.buildGridData(file);setTimeout(function(){$("#luckysheetloadingdata").fadeOut().remove();},500);//luckysheet.sheetmanage.setSheetParam();
  file["data"]=data;luckysheet.flowdata=data;luckysheet.editor.webWorkerFlowDataCache(data);//worker存数据
  luckysheet.luckysheetcreatesheet(data[0].length,data.length,data,null,false);file["load"]="1";luckysheet_select_save=[];luckysheet_selection_range=[];luckysheet.server.saveParam("shs",null,luckysheet.currentSheetIndex);luckysheet.sheetmanage.changeSheet(index);if(func&&typeof func=="function"){func();}});},clearSheetByIndex:function clearSheetByIndex(i){var index=luckysheet.sheetmanage.getSheetIndex(i);var sheetfile=luckysheetfile[index];if(!sheetfile.isPivotTable){sheetfile.data=[];sheetfile.row=defaultrowNum;sheetfile.column=defaultcolumnNum;sheetfile.chart=[];sheetfile.config=null;sheetfile.filter=null;sheetfile.filter_select=null;sheetfile.celldata=[];sheetfile.pivotTable={};sheetfile.calcChain=[];sheetfile.status=0;sheetfile.load=0;luckysheet.flowdata=[];luckysheet.editor.webWorkerFlowDataCache(luckysheet.flowdata);//worker存数据
  $("#"+container+" .luckysheet-data-visualization-chart").remove();$("#"+container+" .luckysheet-datavisual-selection-set").remove();$("#luckysheet-row-count-show, #luckysheet-formula-functionrange-select, #luckysheet-row-count-show, #luckysheet-column-count-show, #luckysheet-change-size-line, #luckysheet-cell-selected-focus, #luckysheet-selection-copy, #luckysheet-cell-selected-extend, #luckysheet-cell-selected-move, #luckysheet-cell-selected").hide();delete sheetfile.load;}else {// delete sheetfile;
  delete luckysheetfile[index];}},clear:function clear(index){var _this=this;if(index=="all"){for(var i=0;i<luckysheetfile.length;i++){var sheetfile=luckysheetfile[i];_this.clearSheetByIndex(sheetfile.index);}}else {if(index==null){index=luckysheet.currentSheetIndex;}_this.clearSheetByIndex(index);}luckysheet.sheetmanage.changeSheet(luckysheetfile[0].index);},destroy:function destroy(){$("#"+container).empty();// $("body > .luckysheet-cols-menu, body > .luckysheet-modal-dialog-slider").remove();
  $("body > .luckysheet-cols-menu").remove();$("#luckysheet-modal-dialog-mask, #luckysheetTextSizeTest, #luckysheet-icon-morebtn-div").remove();$("#luckysheet-input-box").parent().remove();$("#luckysheet-formula-help-c").remove();//参数重置
  luckysheet.jfredo=[];luckysheet.jfundo=[];luckysheet.freezen.initialHorizontal=true;luckysheet.freezen.initialVertical=true;luckysheetConfigsetting.pointEdit=false;},editorChart:function editorChart(c){var file=luckysheetfile[0];var chart_selection_color=luckysheet.jfcolor[0];var chart_id="luckysheetEditMode-datav-chart";var chart_selection_id=chart_id+"_selection";c.chart_id=chart_id;var chartTheme=c.chartTheme;chartTheme=chartTheme==null?"default0000":chartTheme;luckysheet.insertChartTosheet(c.sheetIndex,c.dataSheetIndex,c.option,c.chartType,c.selfOption,c.defaultOption,c.row,c.column,chart_selection_color,chart_id,chart_selection_id,c.chartStyle,c.rangeConfigCheck,c.rangeRowCheck,c.rangeColCheck,c.chartMarkConfig,c.chartTitleConfig,c.winWidth,c.winHeight,c.scrollLeft,c.scrollTop,chartTheme,c.myWidth,c.myHeight,c.myLeft!=null?parseFloat(c.myLeft):null,c.myTop!=null?parseFloat(c.myTop):null,c.myindexrank,true);$("#"+chart_id).find(".luckysheet-modal-controll-update").click();}};luckysheet.jfrefreshchartall=function(flowdata1,r_st,r_ed,c_st,c_ed){//chartMix
  !!window.generator&&generator.changeChartCellDataHook(flowdata1,r_st,r_ed,c_st,c_ed);// $("#luckysheet-cell-main .luckysheet-data-visualization-chart[sheetindex='" + luckysheet.currentSheetIndex + "']").each(function () {
  //     luckysheet.jfrefreshchart($(this), flowdata1, r_st, r_ed, c_st, c_ed);    
  // });
  };luckysheet.jfrefreshchart=function($obj,flowdata1,r_st,r_ed,c_st,c_ed){var row=eval('('+$obj.attr("row")+')'),column=eval('('+$obj.attr("column")+')');if(r_st>row[1]||r_ed<row[0]||c_st>column[1]||c_ed<column[0]){return;}//console.log(row[1], row[0], column[1], column[0], r_st, r_ed, c_st, c_ed, r_st > row[1] ,r_ed < row[0], c_st > column[1] , c_ed < column[0]);
  var type=$obj.attr("chartType"),style=$obj.attr("chartStyle"),selfOption=$obj.attr("selfOption"),defaultOption=$obj.attr("defaultOption"),chartMarkConfig=$obj.attr("chartMarkConfig"),chartTitleConfig=$obj.attr("chartTitleConfig"),chartTheme=$obj.attr("chartTheme");//console.log(type, style, selfOption, chartMarkConfig, chartTitleConfig, luckysheet.chartparam.luckysheetcurrentChart);
  luckysheet.chartparam.jgridCurrentChartSelection={"row":row,"column":column};luckysheet.chartparam.jgridCurrentChartData=luckysheet.getdatabyselectionD(flowdata1,luckysheet.chartparam.jgridCurrentChartSelection);if(luckysheet.chartparam.jgridCurrentChartData.length>=luckysheet.chartparam.jgridCurrentChartData[0].length){rangeConfigCheck=false;}else {rangeConfigCheck=true;}if(luckysheet.chartparam.jgridCurrentChartData.length==1){rangeRowCheck=false;}else {rangeRowCheck=true;}if(luckysheet.chartparam.jgridCurrentChartData[0].length==1){rangeColCheck=false;}else {rangeColCheck=true;}luckysheet.range_config(rangeConfigCheck,rangeRowCheck,rangeColCheck);luckysheet.chartparam.luckysheetcurrentChart=echarts.getInstanceById($obj.find(".luckysheet-modal-dialog-content").attr("_echarts_instance_"));if(luckysheet.getObjType(chartMarkConfig)!="object"){chartMarkConfig=eval('('+chartMarkConfig+')');}if(luckysheet.getObjType(chartTitleConfig)!="object"){chartTitleConfig=eval('('+chartTitleConfig+')');}if(luckysheet.getObjType(selfOption)!="object"){selfOption=eval('('+selfOption+')');}luckysheet.chartparam.luckysheet_chart_mark_config=chartMarkConfig;luckysheet.chartparam.luckysheet_chart_title_config=chartTitleConfig;luckysheet.chartparam.luckysheet_chart_self_config=selfOption==null?{}:selfOption;//luckysheet.chartparam.luckysheet_chart_default_config = defaultOption;
  luckysheet.luckysheet_datavisual_item_active("datachange",type,style);// = chartTheme
  if(typeof luckysheet.luckysheetConfigsetting.chartConfigChange=="function"){luckysheet.luckysheetConfigsetting.chartConfigChange({"sheetIndex":$obj.attr("sheetIndex"),"dataSheetIndex":$obj.attr("dataSheetIndex"),"option":luckysheet.chartparam.luckysheetcurrentChart.getOption(),"chartType":type,"selfOption":selfOption,"defaultOption":defaultOption,"row":row,"column":column,"chart_id":$obj.attr("chart_id"),"chart_selection_color":$obj.attr("chart_selection_color"),"chart_selection_id":$obj.attr("chart_selection_id"),"chartStyle":style,"rangeConfigCheck":rangeConfigCheck,"rangeRowCheck":rangeRowCheck,"rangeColCheck":rangeColCheck,"chartMarkConfig":chartMarkConfig,"chartTitleConfig":chartTitleConfig,"chartTheme":chartTheme});}// luckysheet.chartparam.luckysheetcurrentChart = null;
  // luckysheet.chartparam.luckysheet_chart_mark_config = null;
  // luckysheet.chartparam.luckysheet_chart_title_config = null;
  };//得到单元格的值
  luckysheet.getcellvalue=function(r,c,data,type){try{if(type==null){type="v";}if(data==null){data=luckysheet.flowdata;}var d_value;if(r!=null&&c!=null){d_value=data[r][c];}else if(r!=null){d_value=data[r];}else if(c!=null){var newData=data[0].map(function(col,i){return data.map(function(row){return row[i];});});d_value=newData[c];}else {return data;}var retv=d_value;if(luckysheet.getObjType(d_value)=="object"){retv=d_value[type];if(type=="f"&&retv!=null){retv=luckysheet.formula.functionHTMLGenerate(retv);}else if(type=="f"){retv=d_value["v"];}else if(d_value&&d_value.ct&&d_value.ct.fa=='yyyy-MM-dd'){retv=d_value.m;}}if(retv==undefined){retv=null;}return retv;}catch(err){console.log(err);}};//new runze 根据亿万格式autoFormatw和精确度accuracy 转换成 w/w0/w0.00 or 0/0.0格式
  luckysheet.setAccuracy=function(autoFormatw,accuracy){var acc="0.";var fmt;if(autoFormatw=="TRUE"){if(accuracy==undefined){return "w";}else {var alength=parseInt(accuracy);if(alength==0){return "w0";}else {acc="w0.";for(var i=0;i<alength;i++){acc+="0";}fmt=acc;}}}else {if(accuracy==undefined){return "General";}else {var alength=parseInt(accuracy);if(alength==0){return "0";}else {for(var i=0;i<alength;i++){acc+="0";}fmt=acc;}}}return fmt.toString();};//设置单元格的值
  luckysheet.setcellvalue=function(r,c,d,v){var cell=d[r][c];var vupdate;if(luckysheet.getObjType(v)=="object"){cell=v;if(v.f!=null){cell.f=v.f;}if(v.spl!=null){cell.spl=v.spl;}if(luckysheet.getObjType(v.v)=="object"){vupdate=v.v.v;}else {vupdate=v.v;}}else {var vupdate=v;}if(luckysheet.func_methods.isRealNull(vupdate)){if(luckysheet.getObjType(cell)=="object"){delete cell.m;delete cell.v;}else {cell=null;}d[r][c]=cell;return;}if(luckysheet.func_methods.isRealNull(cell)){cell={};}if(vupdate.toString().substr(0,1)=="'"){cell.m=vupdate.toString().substr(1);cell.ct={"fa":"@","t":"s"};cell.v=vupdate.toString().substr(1);}else if(vupdate.toString().toUpperCase()==="TRUE"){cell.m="TRUE";cell.ct={"fa":"General","t":"b"};cell.v=true;}else if(vupdate.toString().toUpperCase()==="FALSE"){cell.m="FALSE";cell.ct={"fa":"General","t":"b"};cell.v=false;}else if(luckysheet.func_methods.valueIsError(vupdate)){cell.m=vupdate.toString();cell.ct={"fa":"General","t":"e"};cell.v=vupdate;}else {if(cell.f!=null&&luckysheet.func_methods.isRealNum(vupdate)&&!/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(vupdate)){cell.v=parseFloat(vupdate);cell.ct={"fa":"General","t":"n"};if(cell.v==Infinity||cell.v==-Infinity){cell.m=cell.v.toString();}else {if(cell.v.toString().indexOf("e")>-1){var len=cell.v.toString().split(".")[1].split("e")[0].length;if(len>5){len=5;}cell.m=cell.v.toExponential(len).toString();}else {var mask=luckysheet.mask.genarate(Math.round(cell.v*1000000000)/1000000000);cell.m=mask[0].toString();}}}else if(cell.ct!=null&&cell.ct.fa=="@"){cell.m=vupdate.toString();cell.v=vupdate;}else if(cell.ct!=null&&cell.ct.fa!=null&&cell.ct.fa!="General"){if(luckysheet.func_methods.isRealNum(vupdate)){vupdate=parseFloat(vupdate);}var mask=luckysheet.mask.update(cell.ct.fa,vupdate);if(mask===vupdate){//若原来单元格格式 应用不了 要更新的值，则获取更新值的 格式
  mask=luckysheet.mask.genarate(vupdate);cell.m=mask[0].toString();cell.ct=mask[1];cell.v=mask[2];}else {cell.m=mask.toString();cell.v=vupdate;}}else {if(luckysheet.func_methods.isRealNum(vupdate)&&!/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(vupdate)){vupdate=parseFloat(vupdate);cell.v=parseFloat(vupdate);cell.ct={"fa":"General","t":"n"};if(cell.v==Infinity||cell.v==-Infinity){cell.m=cell.v.toString();}else {var mask=luckysheet.mask.genarate(cell.v);cell.m=mask[0].toString();}}else {var mask=luckysheet.mask.genarate(vupdate);cell.m=mask[0].toString();cell.ct=mask[1];cell.v=mask[2];}}}if(!luckysheet.server.allowUpdate&&!luckysheetConfigsetting.pointEdit){//报表模式下，强制把四位以上的数字转换成万亿格式
  if(cell.ct!=null&&/^(w|W)((0?)|(0\.0+))$/.test(cell.ct.fa)==false&&cell.ct.t=="n"&&cell.v!=null&&parseInt(cell.v).toString().length>4){// var autoFormatw = luckysheetConfigsetting.autoFormatw.toString().toUpperCase();
  // var accuracy = luckysheetConfigsetting.accuracy;
  // rptapp
  //报表修改，下一页不会转换万亿 如果传的有配置，走用户传的配置，否则走默认配置  
  var autoFormatw="",accuracy;if(luckysheet.rptSetting&&luckysheet.rptSetting.autoFormatw){autoFormatw=luckysheet.rptSetting.autoFormatw.toString().toUpperCase();}else {autoFormatw=luckysheetConfigsetting.autoFormatw.toString().toUpperCase();}if(luckysheet.rptSetting&&luckysheet.rptSetting.accuracy){accuracy=luckysheet.rptSetting.accuracy;}else {accuracy=luckysheetConfigsetting.accuracy;}var sfmt=luckysheet.setAccuracy(autoFormatw,accuracy);if(sfmt!="General"){cell.ct.fa=sfmt;cell.m=luckysheet.mask.update(sfmt,cell.v);}}}d[r][c]=cell;};luckysheet.jfrefreshcell=function(value,ur,uc){if(clearjfundo){luckysheet.jfundo=[];luckysheet.jfredo.push({"type":"cellchange","sheetIndex":luckysheet.currentSheetIndex,"value":luckysheet.flowdata[ur][uc],"curvalue":$.extend(true,{},value),"uprow":ur,"upcolumn":uc});}{var row=[].concat(luckysheet.flowdata[ur]);row[uc]=value;luckysheet.flowdata[ur]=row;}var data=luckysheet.flowdata;var luckysheetTableContent=$("#luckysheetTableContent").get(0).getContext("2d");var scrollWidth=$("#luckysheet-cell-main").scrollLeft(),scrollHeight=$("#luckysheet-cell-main").scrollTop();var start_r,start_c,end_r,end_c;if(ur==0){start_r=0;}else {start_r=visibledatarow[ur-1]-scrollHeight-1;}end_r=visibledatarow[ur]-scrollHeight;if(uc==0){start_c=0;}else {start_c=visibledatacolumn[uc-1]-scrollWidth;}end_c=visibledatacolumn[uc]-scrollWidth;if($("#luckysheet-data-visualization").length>0&&$("#luckysheet-data-visualization").is(":visible")){luckysheet.chartparam.jgridCurrentChartData=luckysheet.getdatabyselectionD(luckysheet.flowdata,luckysheet.chartparam.jgridCurrentChartSelection);luckysheet.luckysheet_datavisual_item_active();}if(data[ur]!=null&&data[ur][uc]!=null){var value=luckysheet.getcellvalue(ur,uc,data);//console.log(config);
  var firstcolumlen=defaultcollen;if(config["columlen"]!=null&&config["columlen"][uc]!=null){firstcolumlen=config["columlen"][uc];}var textMetrics=luckysheetTableContent.measureText(value).width;if(textMetrics>firstcolumlen){var v="",value_array=value.toString().split("");for(var i=0;i<value_array.length;i++){if(luckysheetTableContent.measureText(v+""+value_array[i]).width+12>firstcolumlen){break;}v+=value_array[i];}value=v+"...";}luckysheetTableContent.clearRect(start_c+rowHeaderWidth-1,start_r+columeHeaderHeight-1,end_c-start_c-1,end_r-start_r-2);luckysheetTableContent.fillText(value==null?"":value,start_c+4+rowHeaderWidth,columeHeaderHeight+start_r+(end_r-start_r)/2-1);var rowlen=defaultrowlen;if(config["rowlen"]!=null&&config["rowlen"][ur]!=null){rowlen=config["rowlen"][ur];}luckysheetTableContent.clearRect(start_c+rowHeaderWidth-1+firstcolumlen-1,start_r+columeHeaderHeight-1,3,end_r-start_r-2);//列
  if(!luckysheetcurrentisPivotTable){luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(start_c+rowHeaderWidth-1+firstcolumlen,start_r+columeHeaderHeight-1);luckysheetTableContent.lineTo(start_c+rowHeaderWidth-1+firstcolumlen,start_r+columeHeaderHeight-1+rowlen);luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle=luckysheetdefaultstyle.strokeStyle;luckysheetTableContent.closePath();luckysheetTableContent.stroke();}}luckysheet.server.saveParam("v",luckysheet.currentSheetIndex,value,{"r":ur,"c":uc});luckysheet.jfrefreshchartall(luckysheet.flowdata,ur,ur,uc,uc);//编辑器qksheet表格编辑时
  if(luckysheetConfigsetting.pointEdit){luckysheet.pointEdit_updateData();}};luckysheet.jfrefreshrange=function(data,range,cdformat){//单元格数据更新联动
  luckysheet.formula.execFunctionExist=[];for(var s=0;s<range.length;s++){for(var r=range[s].row[0];r<=range[s].row[1];r++){for(var c=range[s].column[0];c<=range[s].column[1];c++){luckysheet.formula.execFunctionExist.push({"r":r,"c":c,"i":luckysheet.currentSheetIndex});}}}luckysheet.formula.execFunctionExist.reverse();luckysheet.formula.execFunctionGroup(null,null,null,null,data);luckysheet.formula.execFunctionGroupData=null;if(clearjfundo){luckysheet.jfundo=[];luckysheet.jfredo.push({"type":"rangechange","data":luckysheet.flowdata,"curdata":data,"range":range,"sheetIndex":luckysheet.currentSheetIndex,"cdformat":$.extend(true,[],luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]),"curCdformat":cdformat});}//luckysheet.flowdata
  luckysheet.flowdata=data;luckysheet.editor.webWorkerFlowDataCache(luckysheet.flowdata);//worker存数据
  luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].data=luckysheet.flowdata;//条件格式
  if(cdformat!=null){luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]=cdformat;}//刷新表格
  setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);//发送给后台
  for(var s=0;s<range.length;s++){luckysheet.server.historyParam(luckysheet.flowdata,luckysheet.currentSheetIndex,range[s]);luckysheet.jfrefreshchartall(luckysheet.flowdata,range[s].row[0],range[s].row[1],range[s].column[0],range[s].column[1]);}//编辑器qksheet表格编辑时
  if(luckysheetConfigsetting.pointEdit){luckysheet.pointEdit_updateData();}};luckysheet.jfrefreshgrid=function(data,range,cfg,cdformat,RowlChange){//单元格数据更新联动
  luckysheet.formula.execFunctionExist=[];for(var s=0;s<range.length;s++){for(var r=range[s].row[0];r<=range[s].row[1];r++){for(var c=range[s].column[0];c<=range[s].column[1];c++){luckysheet.formula.execFunctionExist.push({"r":r,"c":c,"i":luckysheet.currentSheetIndex});}}}luckysheet.formula.execFunctionExist.reverse();luckysheet.formula.execFunctionGroup(null,null,null,null,data);luckysheet.formula.execFunctionGroupData=null;if(clearjfundo){luckysheet.jfundo=[];if(cfg==null){var curConfig=$.extend(true,{},config);}else {var curConfig=$.extend(true,{},cfg);}if(cdformat==null){var curCdformat=$.extend(true,[],luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]);}else {var curCdformat=cdformat;}luckysheet.jfredo.push({"type":"datachange","data":luckysheet.flowdata,"curdata":data,"sheetIndex":luckysheet.currentSheetIndex,"range":range,"config":$.extend(true,{},config),"curConfig":curConfig,"cdformat":$.extend(true,[],luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]),"curCdformat":curCdformat,"RowlChange":RowlChange});}//luckysheet.flowdata
  luckysheet.flowdata=data;luckysheet.editor.webWorkerFlowDataCache(luckysheet.flowdata);//worker存数据
  luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].data=luckysheet.flowdata;//config
  if(cfg!=null){config=cfg;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,cfg,{"k":"config"});if(RowlChange!=null){luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);}}//条件格式
  if(cdformat!=null){luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]=cdformat;luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,cdformat,{"k":"luckysheet_conditionformat_save"});}//更新数据的范围
  for(var s=0;s<range.length;s++){var r1=range[s].row[0];var c1=range[s].column[0];if(luckysheet.flowdata[r1][c1]!=null&&luckysheet.flowdata[r1][c1].spl!=null){window.luckysheetCurrentRow=r1;window.luckysheetCurrentColumn=c1;window.luckysheetCurrentFunction=luckysheet.flowdata[r1][c1].f;var fp=$.trim(luckysheet.formula.functionParser(luckysheet.flowdata[r1][c1].f));var sparklines=eval(fp);luckysheet.flowdata[r1][c1].spl=sparklines;}if(luckysheet.server.allowUpdate){//共享编辑模式
  luckysheet.server.historyParam(luckysheet.flowdata,luckysheet.currentSheetIndex,range[s]);}luckysheet.jfrefreshchartall(luckysheet.flowdata,range[s].row[0],range[s].row[1],range[s].column[0],range[s].column[1]);}//刷新表格
  setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);window.luckysheet_getcelldata_cache=null;//编辑器qksheet表格编辑时
  if(luckysheetConfigsetting.pointEdit){luckysheet.pointEdit_updateData();}};luckysheet.pointEdit_updateData=function(){var celldata=[];if(luckysheet.flowdata!=null&&luckysheet.flowdata.length>0){celldata=luckysheet.dataToCelldata(luckysheet.flowdata);}var msTable_files=$.extend(true,[],luckysheet.getluckysheetfile());msTable_files[0].celldata=celldata;msTable_files[0].row=luckysheet.flowdata.length;msTable_files[0].column=luckysheet.flowdata[0].length;delete msTable_files[0].data;luckysheetConfigsetting.pointEditUpdate(msTable_files);};luckysheet.dataToCelldata=function(data){var celldata=[];for(var r=0;r<data.length;r++){for(var c=0;c<data[0].length;c++){var cell=data[r][c];if(cell!=null){var obj={"r":r,"c":c,"v":cell};celldata.push(obj);}}}return celldata;};luckysheet.jfrefreshgridall=function(colwidth,rowheight,data,cfg,range,ctrlType,ctrlValue,cdformat,changeSize){var redo={};if(ctrlType=="cellRowChange"){redo["type"]="cellRowChange";redo["config"]=$.extend(true,{},config);redo["curconfig"]=$.extend(true,{},cfg);redo["range"]=$.extend(true,[],luckysheet_select_save);redo["currange"]=range;redo["ctrlType"]=ctrlType;redo["ctrlValue"]=ctrlValue;var setfield=cfg["rowlen"];if(setfield==null){setfield={};}luckysheet.server.saveParam("cg",luckysheet.currentSheetIndex,setfield,{"k":"rowlen"});}else if(ctrlType.indexOf("extend")>-1){redo["type"]="extend";redo["config"]=$.extend(true,{},config);redo["curconfig"]=$.extend(true,{},cfg);redo["range"]=$.extend(true,[],luckysheet_select_save);redo["currange"]=range;redo["ctrlType"]=ctrlType;redo["ctrlValue"]=ctrlValue;luckysheet.server.saveParam("arc",luckysheet.currentSheetIndex,{"index":ctrlValue.index,"len":ctrlValue.len,"direction":ctrlValue.direction,"mc":cfg.merge},{"rc":ctrlValue.type});}else if(ctrlType.indexOf("dele")>-1){redo["type"]="dele";redo["config"]=$.extend(true,{},config);redo["curconfig"]=$.extend(true,{},cfg);redo["range"]=$.extend(true,[],luckysheet_select_save);redo["currange"]=range;redo["ctrlType"]=ctrlType;redo["ctrlValue"]=ctrlValue;luckysheet.server.saveParam("drc",luckysheet.currentSheetIndex,{"index":ctrlValue.index,"len":ctrlValue.len,"mc":cfg.merge,"borderInfo":cfg.borderInfo},{"rc":ctrlValue.type});}else {//单元格数据更新联动
  luckysheet.formula.execFunctionExist=[];for(var s=0;s<range.length;s++){for(var r=range[s].row[0];r<=range[s].row[1];r++){for(var c=range[s].column[0];c<=range[s].column[1];c++){luckysheet.formula.execFunctionExist.push({"r":r,"c":c,"i":luckysheet.currentSheetIndex});}}}luckysheet.formula.execFunctionExist.reverse();luckysheet.formula.execFunctionGroup(null,null,null,null,data);luckysheet.formula.execFunctionGroupData=null;redo["type"]="datachangeAll";redo["range"]=$.extend(true,[],luckysheet_select_save);redo["currange"]=range;redo["ctrlType"]=ctrlType;redo["ctrlValue"]=ctrlValue;for(var s=0;s<range.length;s++){luckysheet.server.historyParam(data,luckysheet.currentSheetIndex,range[s]);}}if(clearjfundo){luckysheet.jfundo=[];redo["data"]=luckysheet.flowdata;redo["curdata"]=data;redo["sheetIndex"]=luckysheet.currentSheetIndex;redo["cdformat"]=$.extend(true,[],luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]);redo["curCdformat"]=cdformat;luckysheet.jfredo.push(redo);}//luckysheet.flowdata
  luckysheet.flowdata=data;luckysheet.editor.webWorkerFlowDataCache(data);//worker存数据
  luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].data=luckysheet.flowdata;//config
  if(cfg!=null){config=cfg;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].config=config;luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,cfg,{"k":"config"});}//条件格式
  if(cdformat!=null){luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["luckysheet_conditionformat_save"]=cdformat;luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,cdformat,{"k":"luckysheet_conditionformat_save"});}//选区
  luckysheet_select_save=$.extend(true,[],range);if(luckysheet_select_save.length>0){//有选区时，刷新一下选区
  luckysheet.selectHightlightShow();}//行高、列宽 刷新  
  luckysheet.jfrefreshgrid_rhcw(rowheight,colwidth);setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);luckysheet.sheetmanage.storeSheetParamALL();if(cfg==null){for(var s=0;s<range.length;s++){luckysheet.jfrefreshchartall(luckysheet.flowdata,range[s].row[0],range[s].row[1],range[s].column[0],range[s].column[1]);}}window.luckysheet_getcelldata_cache=null;//编辑器qksheet表格编辑时
  if(luckysheetConfigsetting.pointEdit){luckysheet.pointEdit_updateData();}};//删除、增加行列 刷新表格
  luckysheet.jfrefreshgrid_adRC=function(data,cfg,ctrlType,ctrlValue,calc,filterObj,cf,af,freezen){var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];//merge改变对应的单元格值改变
  var mcData=[];for(var m in cfg["merge"]){var mc=cfg["merge"][m];for(var r=mc.r;r<=mc.r+mc.rs-1;r++){for(var c=mc.c;c<=mc.c+mc.cs-1;c++){if(data[r][c]==null){data[r][c]={};}if(r==mc.r&&c==mc.c){data[r][c].mc=mc;}else {data[r][c].mc={"r":mc.r,"c":mc.c};}mcData.push({"r":r,"c":c});}}}//公式链中公式范围改变对应单元格值的改变
  var funcData=[];if(calc.length>0){luckysheet.formula.execFunctionGroupData=data;for(var i=0;i<calc.length;i++){var clc=calc[i];var clc_r=clc.r,clc_c=clc.c,clc_i=clc.index,clc_funcStr=clc.func[2];var clc_result=luckysheet.formula.execfunction(clc_funcStr,clc_r,clc_c,null,true);clc.func=clc_result;if(data[clc_r][clc_c].f==clc_funcStr){luckysheet.setcellvalue(clc_r,clc_c,data,clc_result[1]);funcData.push({"r":clc_r,"c":clc_c});}}}if(clearjfundo){luckysheet.jfundo=[];luckysheet.jfredo.push({"type":ctrlType,"sheetIndex":luckysheet.currentSheetIndex,"data":luckysheet.flowdata,"curData":data,"config":$.extend(true,{},config),"curConfig":cfg,"ctrlValue":ctrlValue,"mcData":mcData,"calc":$.extend(true,[],file.calcChain),"curCalc":calc,"funcData":funcData,"filterObj":{"filter_select":$.extend(true,{},file.filter_select),"filter":$.extend(true,{},file.filter)},"curFilterObj":filterObj,"cf":$.extend(true,[],file.luckysheet_conditionformat_save),"curCf":cf,"af":$.extend(true,[],file.luckysheet_alternateformat_save),"curAf":af,"freezen":{"freezenhorizontaldata":luckysheet.freezen.freezenhorizontaldata,"freezenverticaldata":luckysheet.freezen.freezenverticaldata},"curFreezen":freezen});}var index=ctrlValue.index,len=ctrlValue.len,rc=ctrlValue.rc;if(ctrlType=="addRC"){var direction=ctrlValue.direction,restore=ctrlValue.restore;var addData=[];if(restore){if(rc=="r"){if(direction=="lefttop"){var st_r=index;}else if(direction=="rightbottom"){var st_r=index+1;}var ed_r=st_r+len-1;for(var r=st_r;r<=ed_r;r++){var row=[];for(var c=0;c<data[0].length;c++){var cell=data[r][c];row.push(cell);}addData.push(row);}}else if(rc=="c"){if(direction=="lefttop"){var st_c=index;}else if(direction=="rightbottom"){var st_c=index+1;}var ed_c=st_c+len-1;for(var r=0;r<data.length;r++){var row=[];for(var c=st_c;c<=ed_c;c++){var cell=data[r][c];row.push(cell);}addData.push(row);}}}luckysheet.server.saveParam("arc",luckysheet.currentSheetIndex,{"index":index,"len":len,"direction":direction,"data":addData},{"rc":rc});}else if(ctrlType=="delRC"){luckysheet.server.saveParam("drc",luckysheet.currentSheetIndex,{"index":index,"len":len},{"rc":rc});}//luckysheet.flowdata
  luckysheet.flowdata=data;luckysheet.editor.webWorkerFlowDataCache(luckysheet.flowdata);//worker存数据
  file.data=data;//config
  config=cfg;file.config=config;luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,cfg,{"k":"config"});//mcData
  for(var i=0;i<mcData.length;i++){var mcData_r=mcData[i].r,mcData_c=mcData[i].c;luckysheet.server.saveParam("v",luckysheet.currentSheetIndex,luckysheet.flowdata[mcData_r][mcData_c],{"r":mcData_r,"c":mcData_c});}//calc函数链
  file.calcChain=calc;luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,calc,{"k":"calcChain"});for(var i=0;i<funcData.length;i++){var funcData_r=funcData[i].r,funcData_c=funcData[i].c;luckysheet.server.saveParam("v",luckysheet.currentSheetIndex,luckysheet.flowdata[funcData_r][funcData_c],{"r":funcData_r,"c":funcData_c});}//筛选配置
  if(filterObj!=null){file.filter_select=filterObj.filter_select;file.filter=filterObj.filter;}else {file.filter_select=null;file.filter=null;}luckysheet.createFilterOptions(file.filter_select,file.filter);luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,file.filter_select,{"k":"filter_select"});luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,file.filter,{"k":"filter"});//条件格式配置
  file.luckysheet_conditionformat_save=cf;luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,file.luckysheet_conditionformat_save,{"k":"luckysheet_conditionformat_save"});//交替颜色配置
  file.luckysheet_alternateformat_save=af;luckysheet.server.saveParam("all",luckysheet.currentSheetIndex,file.luckysheet_alternateformat_save,{"k":"luckysheet_alternateformat_save"});//冻结配置
  if(freezen!=null){luckysheet.freezen.freezenhorizontaldata=freezen.freezenhorizontaldata;luckysheet.freezen.freezenverticaldata=freezen.freezenverticaldata;}else {luckysheet.freezen.freezenhorizontaldata=null;luckysheet.freezen.freezenverticaldata=null;}//行高、列宽刷新
  luckysheet.jfrefreshgrid_rhcw(luckysheet.flowdata.length,luckysheet.flowdata[0].length);};//行高、列宽改变 刷新表格
  luckysheet.jfrefreshgrid_rhcw=function(rowheight,colwidth){//行高
  if(rowheight!=null){visibledatarow=[];rh_height=0;for(var i=0;i<rowheight;i++){var rowlen=defaultrowlen;if(config["rowlen"]!=null&&config["rowlen"][i]!=null){rowlen=config["rowlen"][i];}if(config["rowhidden"]!=null&&config["rowhidden"][i]!=null){rowlen=config["rowhidden"][i];visibledatarow.push(rh_height);continue;}else {rh_height+=rowlen+1;}visibledatarow.push(rh_height);//行的临时长度分布
  }if(!luckysheetConfigsetting.pointEdit){//非编辑器qksheet表格编辑状态
  rh_height+=110;}}//列宽
  if(colwidth!=null){visibledatacolumn=[];ch_width=0;var maxColumlen=120;for(var i=0;i<colwidth;i++){var firstcolumlen=defaultcollen;if(config["columlen"]!=null&&config["columlen"][i]!=null){firstcolumlen=config["columlen"][i];}else {if(luckysheet.flowdata[0]!=null&&luckysheet.flowdata[0][i]!=null){if(firstcolumlen>300){firstcolumlen=300;}else if(firstcolumlen<defaultcollen){firstcolumlen=defaultcollen;}if(firstcolumlen!=defaultcollen){if(config["columlen"]==null){config["columlen"]={};}config["columlen"][i]=firstcolumlen;}}}ch_width+=firstcolumlen+1;visibledatacolumn.push(ch_width);//列的临时长度分布
  if(maxColumlen<firstcolumlen+1){maxColumlen=firstcolumlen+1;}}if(!luckysheetConfigsetting.pointEdit){//非编辑器qksheet表格编辑状态
  // ch_width += 120;
  ch_width+=maxColumlen;}}luckysheet.sheetmanage.storeSheetParam();//行高列宽改变时 重新计算sparklines
  var calcChain=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].calcChain;if(calcChain!=null&&calcChain.length>0){if(config["rowlen"]==null){config["rowlen"]={};}if(config["columlen"]==null){config["columlen"]={};}for(var i=0;i<calcChain.length;i++){var r=calcChain[i].r,c=calcChain[i].c,index=calcChain[i].index;if(index==luckysheet.currentSheetIndex&&luckysheet.flowdata[r][c]!=null&&luckysheet.flowdata[r][c].spl!=null&&(r in config["rowlen"]||c in config["columlen"])){window.luckysheetCurrentRow=r;window.luckysheetCurrentColumn=c;window.luckysheetCurrentFunction=luckysheet.flowdata[r][c].f;var fp=$.trim(luckysheet.formula.functionParser(luckysheet.flowdata[r][c].f));var sparklines=eval(fp);luckysheet.flowdata[r][c].spl=sparklines;luckysheet.server.saveParam("v",luckysheet.currentSheetIndex,luckysheet.flowdata[r][c],{"r":r,"c":c});}}luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].data=luckysheet.flowdata;}//批注框同步
  luckysheet.postil.positionSync();//选区同步
  luckysheet.selectHightlightShow();//改变单元格行高，复制虚线框同步
  if($(".luckysheet-selection-copy").is(":visible")){luckysheet.selectionCopyShow();}//改变单元格行高，选区下拉icon隐藏
  if($("#luckysheet-dropCell-icon").is(":visible")){$("#luckysheet-dropCell-icon").remove();}//有冻结状态时，同步行高、列宽
  if(luckysheet.freezen.freezenhorizontaldata!=null&&luckysheet.freezen.freezenverticaldata!=null){var row_st=luckysheet.freezen.freezenhorizontaldata[1]-1;var col_st=luckysheet.freezen.freezenverticaldata[1]-1;var scrollTop=luckysheet.freezen.freezenhorizontaldata[2];var scrollLeft=luckysheet.freezen.freezenverticaldata[2];var top=visibledatarow[row_st]-2-scrollTop+columeHeaderHeight;var freezenhorizontaldata=[visibledatarow[row_st],row_st+1,scrollTop,luckysheet.freezen.cutVolumn(visibledatarow,row_st+1),top];var left=visibledatacolumn[col_st]-2-scrollLeft+rowHeaderWidth;var freezenverticaldata=[visibledatacolumn[col_st],col_st+1,scrollLeft,luckysheet.freezen.cutVolumn(visibledatacolumn,col_st+1),left];luckysheet.freezen.saveFreezen(freezenhorizontaldata,top,freezenverticaldata,left);luckysheet.freezen.createFreezenHorizontal(freezenhorizontaldata,top);luckysheet.freezen.createFreezenVertical(freezenverticaldata,left);luckysheet.freezen.createAssistCanvas();}else if(luckysheet.freezen.freezenhorizontaldata!=null){var row_st=luckysheet.freezen.freezenhorizontaldata[1]-1;var scrollTop=luckysheet.freezen.freezenhorizontaldata[2];var top=visibledatarow[row_st]-2-scrollTop+columeHeaderHeight;var freezenhorizontaldata=[visibledatarow[row_st],row_st+1,scrollTop,luckysheet.freezen.cutVolumn(visibledatarow,row_st+1),top];luckysheet.freezen.saveFreezen(freezenhorizontaldata,top,null,null);luckysheet.freezen.createFreezenHorizontal(freezenhorizontaldata,top);luckysheet.freezen.createAssistCanvas();}else if(luckysheet.freezen.freezenverticaldata!=null){var col_st=luckysheet.freezen.freezenverticaldata[1]-1;var scrollLeft=luckysheet.freezen.freezenverticaldata[2];var left=visibledatacolumn[col_st]-2-scrollLeft+rowHeaderWidth;var freezenverticaldata=[visibledatacolumn[col_st],col_st+1,scrollLeft,luckysheet.freezen.cutVolumn(visibledatacolumn,col_st+1),left];luckysheet.freezen.saveFreezen(null,null,freezenverticaldata,left);luckysheet.freezen.createFreezenVertical(freezenverticaldata,left);luckysheet.freezen.createAssistCanvas();}else {//有筛选标志时，同步筛选按钮和筛选范围位置
  if($("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").length>0){$("#luckysheet-filter-options-sheet"+luckysheet.currentSheetIndex+" .luckysheet-filter-options").each(function(i,e){var str=$(e).data("str"),cindex=$(e).data("cindex");var left=visibledatacolumn[cindex]-20;var top=str-1==-1?0:visibledatarow[str-1];$(e).css({"left":left,"top":top});});}}if($("#luckysheet-filter-selected-sheet"+luckysheet.currentSheetIndex).length>0){var luckysheet_filter_save=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].filter_select;var r1=luckysheet_filter_save.row[0],r2=luckysheet_filter_save.row[1];var c1=luckysheet_filter_save.column[0],c2=luckysheet_filter_save.column[1];var row=visibledatarow[r2],row_pre=r1-1==-1?0:visibledatarow[r1-1];var col=visibledatacolumn[c2],col_pre=c1-1==-1?0:visibledatacolumn[c1-1];$("#luckysheet-filter-selected-sheet"+luckysheet.currentSheetIndex).css({"left":col_pre,"width":col-col_pre-1,"top":row_pre,"height":row-row_pre-1});}luckysheet.sheetmanage.showSheet();setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);//编辑器qksheet表格编辑时
  if(luckysheetConfigsetting.pointEdit){luckysheet.pointEdit_updateData();}};//复制剪切 刷新表格
  luckysheet.jfrefreshgrid_pastcut=function(source,target,RowlChange){//单元格数据更新联动
  var execF_rc={};luckysheet.formula.execFunctionExist=[];for(var r=source["range"].row[0];r<=source["range"].row[1];r++){for(var c=source["range"].column[0];c<=source["range"].column[1];c++){if(r+"_"+c+"_"+source["sheetIndex"]in execF_rc){continue;}execF_rc[r+"_"+c+"_"+source["sheetIndex"]]=0;luckysheet.formula.execFunctionExist.push({"r":r,"c":c,"i":source["sheetIndex"]});}}for(var r=target["range"].row[0];r<=target["range"].row[1];r++){for(var c=target["range"].column[0];c<=target["range"].column[1];c++){if(r+"_"+c+"_"+target["sheetIndex"]in execF_rc){continue;}execF_rc[r+"_"+c+"_"+target["sheetIndex"]]=0;luckysheet.formula.execFunctionExist.push({"r":r,"c":c,"i":target["sheetIndex"]});}}luckysheet.formula.execFunctionExist.reverse();luckysheet.formula.execFunctionGroup(null,null,null,null,target["curData"]);luckysheet.formula.execFunctionGroupData=null;if(clearjfundo){luckysheet.jfundo=[];luckysheet.jfredo.push({"type":"pasteCut","source":source,"target":target,"RowlChange":RowlChange});}//config
  if(luckysheet.currentSheetIndex==source["sheetIndex"]){config=source["curConfig"];var rowHeight=source["curData"].length;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(target["sheetIndex"])]["config"]=target["curConfig"];}else if(luckysheet.currentSheetIndex==target["sheetIndex"]){config=target["curConfig"];var rowHeight=target["curData"].length;luckysheetfile[luckysheet.sheetmanage.getSheetIndex(source["sheetIndex"])]["config"]=source["curConfig"];}if(RowlChange){visibledatarow=[];rh_height=0;for(var i=0;i<rowHeight;i++){var rowlen=defaultrowlen;if(config["rowlen"]!=null&&config["rowlen"][i]!=null){rowlen=config["rowlen"][i];}if(config["rowhidden"]!=null&&config["rowhidden"][i]!=null){rowlen=config["rowhidden"][i];visibledatarow.push(rh_height);continue;}else {rh_height+=rowlen+1;}visibledatarow.push(rh_height);//行的临时长度分布
  }rh_height+=110;luckysheet.sheetmanage.showSheet();if(luckysheet.currentSheetIndex==source["sheetIndex"]){var rowlenArr=luckysheet.computeRowlenArr(target["curData"].length,target["curConfig"]);luckysheetfile[luckysheet.sheetmanage.getSheetIndex(target["sheetIndex"])]["visibledatarow"]=rowlenArr;}else if(luckysheet.currentSheetIndex==target["sheetIndex"]){var rowlenArr=luckysheet.computeRowlenArr(source["curData"].length,source["curConfig"]);luckysheetfile[luckysheet.sheetmanage.getSheetIndex(source["sheetIndex"])]["visibledatarow"]=rowlenArr;}}//luckysheet.flowdata
  if(luckysheet.currentSheetIndex==source["sheetIndex"]){luckysheet.flowdata=source["curData"];luckysheetfile[luckysheet.sheetmanage.getSheetIndex(target["sheetIndex"])]["data"]=target["curData"];}else if(luckysheet.currentSheetIndex==target["sheetIndex"]){luckysheet.flowdata=target["curData"];luckysheetfile[luckysheet.sheetmanage.getSheetIndex(source["sheetIndex"])]["data"]=source["curData"];}luckysheet.editor.webWorkerFlowDataCache(luckysheet.flowdata);//worker存数据
  luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)].data=luckysheet.flowdata;//luckysheet_select_save
  if(luckysheet.currentSheetIndex==target["sheetIndex"]){luckysheet_select_save=[{"row":target["range"].row,"column":target["range"].column}];}else {luckysheet_select_save=[{"row":source["range"].row,"column":source["range"].column}];}if(luckysheet_select_save.length>0){//有选区时，刷新一下选区
  luckysheet.selectHightlightShow();}//条件格式
  luckysheetfile[luckysheet.sheetmanage.getSheetIndex(source["sheetIndex"])].luckysheet_conditionformat_save=source["curCdformat"];luckysheetfile[luckysheet.sheetmanage.getSheetIndex(target["sheetIndex"])].luckysheet_conditionformat_save=target["curCdformat"];setTimeout(function(){luckysheet.luckysheetrefreshgrid();},1);luckysheet.sheetmanage.storeSheetParamALL();luckysheet.jfrefreshchartall(luckysheet.flowdata,0,luckysheet.flowdata.length-1,0,luckysheet.flowdata[0].length-1);//saveparam
  //来源表
  luckysheet.server.saveParam("all",source["sheetIndex"],source["curConfig"],{"k":"config"});//目的表
  luckysheet.server.saveParam("all",target["sheetIndex"],target["curConfig"],{"k":"config"});//来源表
  luckysheet.server.historyParam(source["curData"],source["sheetIndex"],{"row":source["range"]["row"],"column":source["range"]["column"]});//目的表
  luckysheet.server.historyParam(target["curData"],target["sheetIndex"],{"row":target["range"]["row"],"column":target["range"]["column"]});//编辑器qksheet表格编辑时
  if(luckysheetConfigsetting.pointEdit){luckysheet.pointEdit_updateData();}};luckysheet.luckysheetcreatesheet=function(colwidth,rowheight,data,cfg,active){if(active==null){active=true;}visibledatarow=[];visibledatacolumn=[];rowsplit=[];ch_width=0;rh_height=0;if(cfg!=null){config=cfg;}else {config={};}if(data.length==0){luckysheet.flowdata=luckysheet.datagridgrowth(data,rowheight,colwidth);}else if(data.length<rowheight&&data[0].length<colwidth){luckysheet.flowdata=luckysheet.datagridgrowth(data,rowheight-data.length,colwidth-data[0].length);}else if(data.length<rowheight){luckysheet.flowdata=luckysheet.datagridgrowth(data,rowheight-data.length,0);}else if(data[0].length<colwidth){luckysheet.flowdata=luckysheet.datagridgrowth(data,0,colwidth-data[0].length);}else {luckysheet.flowdata=data;}luckysheet.editor.webWorkerFlowDataCache(luckysheet.flowdata);//worker存数据
  for(var i=0;i<colwidth;i++){var firstcolumlen=defaultcollen;if(config["columlen"]!=null&&config["columlen"][i]!=null){firstcolumlen=config["columlen"][i];}else {if(data[0]!=null&&data[0][i]!=null){firstcolumlen=Math.ceil(luckysheet.getByteLen(data[0][i])*11.5);if(firstcolumlen>300){firstcolumlen=300;}else if(firstcolumlen<defaultcollen){firstcolumlen=defaultcollen;}if(firstcolumlen!=defaultcollen){if(config["columlen"]==null){config["columlen"]={};}config["columlen"][i]=firstcolumlen;}}}ch_width+=firstcolumlen+1;visibledatacolumn.push(ch_width);//列的临时长度分布
  }for(var i=0;i<rowheight;i++){var rowlen=defaultrowlen;if(config["rowlen"]!=null&&config["rowlen"][i]!=null){rowlen=config["rowlen"][i];}if(config["rowhidden"]!=null&&config["rowhidden"][i]!=null){rowlen=config["rowhidden"][i];visibledatarow.push(rh_height);continue;}else {rh_height+=rowlen+1;}visibledatarow.push(rh_height);//行的临时长度分布
  }rh_height+=110;ch_width+=120;if(active){luckysheet.sheetmanage.showSheet();setTimeout(function(){luckysheet.sheetmanage.restoreCache();luckysheet.formula.execFunctionGroup();luckysheet.sheetmanage.restoreSheetAll(luckysheet.currentSheetIndex);luckysheet.luckysheetrefreshgrid();},1);}// setTimeout(function () {
  //     for (var i = 0; i < refreshcanvas.length; i++) {
  //         refreshcanvas[i].stroke();
  //     }
  // }, 1);
  };//按照scrollHeight, scrollWidth刷新canvas展示数据
  luckysheet.luckysheetrefreshgrid=function(scrollWidth,scrollHeight){luckysheet.formula.groupValuesRefresh();if(scrollWidth==null){scrollWidth=$("#luckysheet-cell-main").scrollLeft();}if(scrollHeight==null){scrollHeight=$("#luckysheet-cell-main").scrollTop();}if(luckysheet.freezen.freezenverticaldata!=null||luckysheet.freezen.freezenhorizontaldata!=null){var freezen_horizon_px,freezen_horizon_ed,freezen_horizon_scrollTop;var freezen_vertical_px,freezen_vertical_ed,freezen_vertical_scrollTop;var drawWidth=luckysheetTableContentHW[0],drawHeight=luckysheetTableContentHW[1];if(luckysheet.freezen.freezenverticaldata!=null&&luckysheet.freezen.freezenhorizontaldata!=null){freezen_horizon_px=luckysheet.freezen.freezenhorizontaldata[0];freezen_horizon_ed=luckysheet.freezen.freezenhorizontaldata[1];freezen_horizon_scrollTop=luckysheet.freezen.freezenhorizontaldata[2];freezen_vertical_px=luckysheet.freezen.freezenverticaldata[0];freezen_vertical_ed=luckysheet.freezen.freezenverticaldata[1];freezen_vertical_scrollTop=luckysheet.freezen.freezenverticaldata[2];//左上canvas freezen_3
  luckysheetDrawMain(freezen_vertical_scrollTop,freezen_horizon_scrollTop,freezen_vertical_px,freezen_horizon_px,1,1,null,null,"freezen_3");//上右canvas freezen_4
  luckysheetDrawMain(scrollWidth+freezen_vertical_px-freezen_vertical_scrollTop,freezen_horizon_scrollTop,drawWidth-freezen_vertical_px+freezen_vertical_scrollTop,freezen_horizon_px,1,1,null,null,"freezen_4");//左下canvas freezen_7
  luckysheetDrawMain(freezen_vertical_scrollTop,scrollHeight+freezen_horizon_px-freezen_horizon_scrollTop,freezen_vertical_px,drawHeight-freezen_horizon_px+freezen_horizon_scrollTop,1,1,null,null,"freezen_7");//右下canvas luckysheetTableContent
  luckysheetDrawMain(scrollWidth+freezen_vertical_px-freezen_vertical_scrollTop,scrollHeight+freezen_horizon_px-freezen_horizon_scrollTop,drawWidth-freezen_vertical_px+freezen_vertical_scrollTop,drawHeight-freezen_horizon_px+freezen_horizon_scrollTop,freezen_vertical_px-freezen_vertical_scrollTop+rowHeaderWidth,freezen_horizon_px-freezen_horizon_scrollTop+columeHeaderHeight);//标题
  luckysheetDrawgridColumnTitle(scrollWidth+freezen_vertical_px-freezen_vertical_scrollTop,drawWidth-freezen_vertical_px+freezen_vertical_scrollTop,freezen_vertical_px-freezen_vertical_scrollTop+rowHeaderWidth);luckysheetDrawgridColumnTitle(freezen_vertical_scrollTop,freezen_vertical_px,rowHeaderWidth);luckysheetDrawgridRowTitle(scrollHeight+freezen_horizon_px-freezen_horizon_scrollTop,drawHeight-freezen_horizon_px+freezen_horizon_scrollTop,freezen_horizon_px-freezen_horizon_scrollTop+columeHeaderHeight);luckysheetDrawgridRowTitle(freezen_horizon_scrollTop,freezen_horizon_px,columeHeaderHeight);}else if(luckysheet.freezen.freezenhorizontaldata!=null){freezen_horizon_px=luckysheet.freezen.freezenhorizontaldata[0];freezen_horizon_ed=luckysheet.freezen.freezenhorizontaldata[1];freezen_horizon_scrollTop=luckysheet.freezen.freezenhorizontaldata[2];luckysheetDrawMain(scrollWidth,freezen_horizon_scrollTop,drawWidth,freezen_horizon_px,1,1,null,null,"freezen_h");luckysheetDrawMain(scrollWidth,scrollHeight+freezen_horizon_px-freezen_horizon_scrollTop,drawWidth,drawHeight-freezen_horizon_px+freezen_horizon_scrollTop,null,freezen_horizon_px-freezen_horizon_scrollTop+columeHeaderHeight);luckysheetDrawgridColumnTitle(scrollWidth,drawWidth,null);luckysheetDrawgridRowTitle(scrollHeight+freezen_horizon_px-freezen_horizon_scrollTop,drawHeight-freezen_horizon_px+freezen_horizon_scrollTop,freezen_horizon_px-freezen_horizon_scrollTop+columeHeaderHeight);luckysheetDrawgridRowTitle(freezen_horizon_scrollTop,freezen_horizon_px,columeHeaderHeight);}else if(luckysheet.freezen.freezenverticaldata!=null){freezen_vertical_px=luckysheet.freezen.freezenverticaldata[0];freezen_vertical_ed=luckysheet.freezen.freezenverticaldata[1];freezen_vertical_scrollTop=luckysheet.freezen.freezenverticaldata[2];luckysheetDrawMain(freezen_vertical_scrollTop,scrollHeight,freezen_vertical_px,drawHeight,1,1,null,null,"freezen_v");luckysheetDrawMain(scrollWidth+freezen_vertical_px-freezen_vertical_scrollTop,scrollHeight,drawWidth-freezen_vertical_px+freezen_vertical_scrollTop,drawHeight,freezen_vertical_px-freezen_vertical_scrollTop+rowHeaderWidth,null);luckysheetDrawgridRowTitle(scrollHeight,drawHeight,null);luckysheetDrawgridColumnTitle(scrollWidth+freezen_vertical_px-freezen_vertical_scrollTop,drawWidth-freezen_vertical_px+freezen_vertical_scrollTop,freezen_vertical_px-freezen_vertical_scrollTop+rowHeaderWidth);luckysheetDrawgridColumnTitle(freezen_vertical_scrollTop,freezen_vertical_px,rowHeaderWidth);}}else {luckysheetDrawgrid(scrollWidth,scrollHeight);}};function luckysheetDrawgrid(scrollWidth,scrollHeight,drawWidth,drawHeight,offsetLeft,offsetTop){if($("#luckysheetTableContent").length==0){return;}if(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["isPivotTable"]){luckysheetDrawMain_back(scrollWidth,scrollHeight,drawWidth,drawHeight,offsetLeft,offsetTop);}else {luckysheetDrawMain(scrollWidth,scrollHeight,drawWidth,drawHeight,offsetLeft,offsetTop);}$("#luckysheetTableContent").get(0).getContext("2d").clearRect(0,0,46,20);luckysheetDrawgridColumnTitle(scrollWidth,drawWidth,offsetLeft);luckysheetDrawgridRowTitle(scrollHeight,drawHeight,offsetTop);}function luckysheetDrawgridRowTitle(scrollHeight,drawHeight,offsetTop){if(scrollHeight==null){scrollHeight=$("#luckysheet-cell-main").scrollTop();}if(drawHeight==null){drawHeight=luckysheetTableContentHW[1];}if(offsetTop==null){offsetTop=columeHeaderHeight;}var luckysheetTableContent=$("#luckysheetTableContent").get(0).getContext("2d");luckysheetTableContent.clearRect(0,offsetTop*devicePixelRatio,(rowHeaderWidth-1)*devicePixelRatio,drawHeight*devicePixelRatio);luckysheetTableContent.font=luckysheetdefaultstyle.font;luckysheetTableContent.textBaseline=luckysheetdefaultstyle.textBaseline;luckysheetTableContent.fillStyle=luckysheetdefaultstyle.fillStyle;var dataset_row_st,dataset_row_ed;dataset_row_st=luckysheet_searcharray(visibledatarow,scrollHeight);dataset_row_ed=luckysheet_searcharray(visibledatarow,scrollHeight+drawHeight);if(dataset_row_st==-1){dataset_row_st=0;}if(dataset_row_ed==-1){dataset_row_ed=visibledatarow.length-1;}var end_r,start_r;for(var r=dataset_row_st;r<=dataset_row_ed;r++){if(r==0){start_r=-scrollHeight-1;}else {start_r=visibledatarow[r-1]-scrollHeight-1;}end_r=visibledatarow[r]-scrollHeight;//若超出绘制区域终止
  if(end_r>scrollHeight+drawHeight){break;}if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null);else {//行标题栏序列号
  var textMetrics=luckysheetTableContent.measureText(r+1);var horizonAlignPos=(rowHeaderWidth*devicePixelRatio-textMetrics.width)/2;var verticalAlignPos=(start_r+(end_r-start_r)/2+offsetTop)*devicePixelRatio;luckysheetTableContent.fillText(r+1,horizonAlignPos,verticalAlignPos);}//行标题栏横线
  luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(-1,(end_r+offsetTop-2+0.5)*devicePixelRatio);luckysheetTableContent.lineTo((rowHeaderWidth-1)*devicePixelRatio,(end_r+offsetTop-2+0.5)*devicePixelRatio);luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle=luckysheetdefaultstyle.strokeStyle;luckysheetTableContent.closePath();luckysheetTableContent.stroke();}//行标题栏竖线
  luckysheetTableContent.beginPath();luckysheetTableContent.moveTo((rowHeaderWidth-2+0.5)*devicePixelRatio,(offsetTop-1)*devicePixelRatio);luckysheetTableContent.lineTo((rowHeaderWidth-2+0.5)*devicePixelRatio,(rh_height+offsetTop)*devicePixelRatio);luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle=luckysheetdefaultstyle.strokeStyle;luckysheetTableContent.closePath();luckysheetTableContent.stroke();//清除canvas左上角区域 防止列标题栏序列号溢出显示
  luckysheetTableContent.clearRect(0,0,rowHeaderWidth*devicePixelRatio,columeHeaderHeight*devicePixelRatio);}function luckysheetDrawgridColumnTitle(scrollWidth,drawWidth,offsetLeft){if(scrollWidth==null){scrollWidth=$("#luckysheet-cell-main").scrollLeft();}if(drawWidth==null){drawWidth=luckysheetTableContentHW[0];}if(offsetLeft==null){offsetLeft=rowHeaderWidth;}var luckysheetTableContent=$("#luckysheetTableContent").get(0).getContext("2d");luckysheetTableContent.clearRect(offsetLeft*devicePixelRatio,-0.5,drawWidth*devicePixelRatio,(columeHeaderHeight-1.5)*devicePixelRatio);luckysheetTableContent.font=luckysheetdefaultstyle.font;luckysheetTableContent.textBaseline=luckysheetdefaultstyle.textBaseline;luckysheetTableContent.fillStyle=luckysheetdefaultstyle.fillStyle;var dataset_col_st,dataset_col_ed;dataset_col_st=luckysheet_searcharray(visibledatacolumn,scrollWidth);dataset_col_ed=luckysheet_searcharray(visibledatacolumn,scrollWidth+drawWidth);if(dataset_col_st==-1){dataset_col_st=0;}if(dataset_col_ed==-1){dataset_col_ed=visibledatacolumn.length-1;}var end_c,start_c;for(var c=dataset_col_st;c<=dataset_col_ed;c++){if(c==0){start_c=-scrollWidth;}else {start_c=visibledatacolumn[c-1]-scrollWidth;}end_c=visibledatacolumn[c]-scrollWidth;//若超出绘制区域终止
  if(end_c>scrollWidth+drawWidth){break;}//列标题栏序列号
  var abc=luckysheet.luckysheetchatatABC(c);var textMetrics=luckysheetTableContent.measureText(abc);var horizonAlignPos=Math.round((start_c+(end_c-start_c)/2+offsetLeft)*devicePixelRatio-textMetrics.width/2);var verticalAlignPos=Math.round(columeHeaderHeight/2*devicePixelRatio);luckysheetTableContent.fillText(abc,horizonAlignPos,verticalAlignPos);//列标题栏竖线
  luckysheetTableContent.beginPath();luckysheetTableContent.moveTo((end_c+offsetLeft-2+0.5)*devicePixelRatio,0.5);luckysheetTableContent.lineTo((end_c+offsetLeft-2+0.5)*devicePixelRatio,(columeHeaderHeight-2)*devicePixelRatio);luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle=luckysheetdefaultstyle.strokeStyle;luckysheetTableContent.closePath();luckysheetTableContent.stroke();}//列标题栏横线
  luckysheetTableContent.beginPath();luckysheetTableContent.moveTo((offsetLeft-1)*devicePixelRatio,(columeHeaderHeight-2+0.5)*devicePixelRatio);luckysheetTableContent.lineTo((ch_width+offsetLeft-2)*devicePixelRatio,(columeHeaderHeight-2+0.5)*devicePixelRatio);luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle=luckysheetdefaultstyle.strokeStyle;luckysheetTableContent.closePath();luckysheetTableContent.stroke();//清除canvas左上角区域 防止列标题栏序列号溢出显示
  luckysheetTableContent.clearRect(0,0,rowHeaderWidth*devicePixelRatio,columeHeaderHeight*devicePixelRatio);}function luckysheetDrawMain(scrollWidth,scrollHeight,drawWidth,drawHeight,offsetLeft,offsetTop,columnOffsetCell,rowOffsetCell,mycanvas,ctx,ctxdata){if(ctxdata!=null){luckysheet.flowdata=ctxdata;}if(luckysheet.flowdata==null){return;}if(scrollWidth==null){scrollWidth=$("#luckysheet-cell-main").scrollLeft();}if(scrollHeight==null){scrollHeight=$("#luckysheet-cell-main").scrollTop();}if(drawWidth==null){drawWidth=luckysheetTableContentHW[0];}if(drawHeight==null){drawHeight=luckysheetTableContentHW[1];}if(offsetLeft==null){offsetLeft=rowHeaderWidth;}if(offsetTop==null){offsetTop=columeHeaderHeight;}if(columnOffsetCell==null){columnOffsetCell=0;}if(rowOffsetCell==null){rowOffsetCell=0;}var luckysheetTableContent=null;if(ctx!=null){var luckysheetTableElement=document.createElement('canvas');luckysheetTableElement.width=drawWidth;luckysheetTableElement.height=drawHeight;luckysheetTableContent=luckysheetTableElement.getContext("2d");}else {if(mycanvas==null){luckysheetTableContent=$("#luckysheetTableContent").get(0).getContext("2d");}else {if(luckysheet.getObjType(mycanvas)=="object"){try{luckysheetTableContent=mycanvas.get(0).getContext("2d");}catch(err){luckysheetTableContent=mycanvas;}}else {luckysheetTableContent=$("#"+mycanvas).get(0).getContext("2d");}}}luckysheetTableContent.clearRect(0,0,luckysheetTableContentHW[0]*devicePixelRatio,luckysheetTableContentHW[1]*devicePixelRatio);//离屏canvas
  var offlinecanvas=null;if(ctx!=null){var offlineElement=document.createElement('canvas');offlineElement.width=drawWidth;offlineElement.height=drawHeight;offlinecanvas=offlineElement.getContext("2d");}else {offlinecanvas=$("#luckysheetTableContentF").get(0).getContext("2d");}//offlinecanvas.clearRect(0, 0, luckysheetTableContentHW[0], luckysheetTableContentHW[1]);
  offlinecanvas.fillStyle="#ffffff";offlinecanvas.fillRect(0,0,luckysheetTableContentHW[0]*devicePixelRatio,luckysheetTableContentHW[1]*devicePixelRatio);offlinecanvas.font=luckysheetdefaultstyle.font;offlinecanvas.textBaseline="top";offlinecanvas.fillStyle=luckysheetdefaultstyle.fillStyle;//
  var dataset_row_st,dataset_row_ed,dataset_col_st,dataset_col_ed;dataset_row_st=luckysheet_searcharray(visibledatarow,scrollHeight);dataset_row_ed=luckysheet_searcharray(visibledatarow,scrollHeight+drawHeight);if(dataset_row_st==-1){dataset_row_st=0;}dataset_row_st+=rowOffsetCell;if(dataset_row_ed==-1){dataset_row_ed=visibledatarow.length-1;}dataset_row_ed+=rowOffsetCell;if(dataset_row_ed>=visibledatarow.length){dataset_row_ed=visibledatarow.length-1;}dataset_col_st=luckysheet_searcharray(visibledatacolumn,scrollWidth);dataset_col_ed=luckysheet_searcharray(visibledatacolumn,scrollWidth+drawWidth);if(dataset_col_st==-1){dataset_col_st=0;}dataset_col_st+=columnOffsetCell;if(dataset_col_ed==-1){dataset_col_ed=visibledatacolumn.length-1;}dataset_col_ed+=columnOffsetCell;if(dataset_col_ed>=visibledatacolumn.length){dataset_col_ed=visibledatacolumn.length-1;}var fill_row_st,fill_row_ed,fill_col_st,fill_col_ed;if(dataset_row_st==0){fill_row_st=0;}else {fill_row_st=visibledatarow[dataset_row_st-1];}fill_row_ed=visibledatarow[dataset_row_ed];if(dataset_col_st==0){fill_col_st=0;}else {fill_col_st=visibledatacolumn[dataset_col_st-1];}fill_col_ed=visibledatacolumn[dataset_col_ed];luckysheetTableContent.fillStyle="#ffffff";luckysheetTableContent.fillRect((offsetLeft-1)*devicePixelRatio,(offsetTop-1)*devicePixelRatio,(fill_col_ed-scrollWidth)*devicePixelRatio,(fill_row_ed-scrollHeight)*devicePixelRatio);luckysheetTableContent.font=luckysheetdefaultstyle.font;luckysheetTableContent.textBaseline="top";luckysheetTableContent.fillStyle=luckysheetdefaultstyle.fillStyle;var end_r,start_r,end_c,start_c;var cellupdate=[];var mergeCache={};var borderOffset={};for(var r=dataset_row_st;r<=dataset_row_ed;r++){if(r==0){start_r=-scrollHeight-1;}else {start_r=visibledatarow[r-1]-scrollHeight-1;}end_r=visibledatarow[r]-scrollHeight;for(var c=dataset_col_st;c<=dataset_col_ed;c++){if(c==0){start_c=-scrollWidth;}else {start_c=visibledatacolumn[c-1]-scrollWidth;}end_c=visibledatacolumn[c]-scrollWidth;//横线
  if(c==dataset_col_ed&&!luckysheetcurrentisPivotTable){luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(offsetLeft-1),devicePixelRatio*(end_r+offsetTop-2+0.5));luckysheetTableContent.lineTo(devicePixelRatio*(fill_col_ed-scrollWidth+offsetLeft-2),devicePixelRatio*(end_r+offsetTop-2+0.5));luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle=luckysheetdefaultstyle.strokeStyle;luckysheetTableContent.closePath();luckysheetTableContent.stroke();}//竖线
  if(r==dataset_row_st&&!luckysheetcurrentisPivotTable){luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(end_c+offsetLeft-2+0.5),devicePixelRatio*(offsetTop-1));luckysheetTableContent.lineTo(devicePixelRatio*(end_c+offsetLeft-2+0.5),devicePixelRatio*(fill_row_ed-scrollHeight+offsetTop-2));luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle=luckysheetdefaultstyle.strokeStyle;luckysheetTableContent.closePath();luckysheetTableContent.stroke();}//数据透视表
  if(!!luckysheetcurrentisPivotTable&&luckysheet.pivotTable.drawPivotTable){if((c==0||c==5)&&r<=11){luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(start_r+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(end_r-2+offsetTop));luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle="#000000";luckysheetTableContent.closePath();luckysheetTableContent.stroke();}if((r==2||r==11)&&c<=5){luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(start_c-1+offsetLeft),devicePixelRatio*(end_r-2+0.5+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c-2+offsetLeft),devicePixelRatio*(end_r-2+0.5+offsetTop));luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle="#000000";luckysheetTableContent.closePath();luckysheetTableContent.stroke();}if(r==6&&c==3){luckysheetTableContent.fillText("数据透视表",devicePixelRatio*(start_c+4+offsetLeft),devicePixelRatio*(start_r+(end_r-start_r)/2-1+offsetTop));}}else if(!!luckysheetcurrentisPivotTable){if(c<luckysheet.pivotTable.pivotTableBoundary[1]&&r<luckysheet.pivotTable.pivotTableBoundary[0]){luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(start_r+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(end_r-2+offsetTop));luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle="#000000";luckysheetTableContent.closePath();luckysheetTableContent.stroke();luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(start_c-1+offsetLeft),devicePixelRatio*(end_r-2+0.5+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c-2+offsetLeft),devicePixelRatio*(end_r-2+0.5+offsetTop));luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle="#000000";luckysheetTableContent.closePath();luckysheetTableContent.stroke();}}if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null);else {var firstcolumlen=defaultcollen;if(config["columlen"]!=null&&config["columlen"][c]!=null){firstcolumlen=config["columlen"][c];}if(luckysheet.flowdata[r]!=null&&luckysheet.flowdata[r][c]!=null){var value=luckysheet.flowdata[r][c];if(luckysheet.getObjType(value)=="object"&&"mc"in value){borderOffset[r+"_"+c]={"start_r":start_r,"start_c":start_c,"end_r":end_r,"end_c":end_c};if("rs"in value["mc"]){var key="r"+r+"c"+c;mergeCache[key]=cellupdate.length;}else {var key="r"+value["mc"].r+"c"+value["mc"].c;var margeMain=cellupdate[mergeCache[key]];if(margeMain==null){mergeCache[key]=cellupdate.length;cellupdate.push({"r":r,"c":c,"start_c":start_c,"start_r":start_r,"end_r":end_r,"end_c":end_c,"firstcolumlen":firstcolumlen,startlist:[]});}else {if(margeMain.c==c){margeMain.end_r+=end_r-start_r-1;margeMain.startlist.push(start_r);// borderOffset[margeMain.r + "_" + margeMain.c].end_r = margeMain.end_r;
  }if(margeMain.r==r){margeMain.end_c+=end_c-start_c;margeMain.firstcolumlen+=firstcolumlen;// borderOffset[margeMain.r + "_" + margeMain.c].end_c = margeMain.end_c;
  }}continue;}}}cellupdate.push({"r":r,"c":c,"start_r":start_r,"start_c":start_c,"end_r":end_r,"end_c":end_c,"firstcolumlen":firstcolumlen,startlist:[]});borderOffset[r+"_"+c]={"start_r":start_r,"start_c":start_c,"end_r":end_r,"end_c":end_c};}}}//动态数组公式计算
  var dynamicArray_compute=luckysheet.dynamicArray_compute(luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["dynamicArray"]);//交替颜色计算
  var af_compute=luckysheet.alternateformat.getComputeMap();//条件格式计算
  var cf_compute=luckysheet.conditionformat.getComputeMap();//sparklines渲染
  var sparklinesRender=function sparklinesRender(r,c,offsetX,offsetY,canvasid,ctx){if(luckysheet.flowdata[r]==null||luckysheet.flowdata[r][c]==null){return;}var sparklines=luckysheet.flowdata[r][c].spl;if(sparklines!=null){if(typeof sparklines=="string"){sparklines=eval('('+sparklines+')');}if(luckysheet.getObjType(sparklines)=="object"){var temp1=sparklines;var x=temp1.offsetX;var y=temp1.offsetY;x=x==null?0:x;y=y==null?0:y;luckysheet.sparkline.render(temp1.shapeseq,temp1.shapes,offsetX+x,offsetY+y,temp1.pixelWidth,temp1.pixelHeight,canvasid,ctx);}else if(luckysheet.getObjType(sparklines)=="array"&&luckysheet.getObjType(sparklines[0])=="object"){for(var i=0;i<sparklines.length;i++){var temp1=sparklines[i];var x=temp1.offsetX;var y=temp1.offsetY;x=x==null?0:x;y=y==null?0:y;luckysheet.sparkline.render(temp1.shapeseq,temp1.shapes,offsetX+x,offsetY+y,temp1.pixelWidth,temp1.pixelHeight,canvasid,ctx);}}}};//空白单元格渲染 
  var nullCellRender=function nullCellRender(r,c,start_r,start_c,end_r,end_c){var checksAF=luckysheet.alternateformat.checksAF(r,c,af_compute);//交替颜色
  var checksCF=luckysheet.conditionformat.checksCF(r,c,cf_compute);//条件格式
  var borderfix=luckysheet.menuButton.borderfix(luckysheet.flowdata,r,c);//背景色
  luckysheetTableContent.fillStyle=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"bg");if(checksAF!=null&&checksAF[1]!=null){//交替颜色 
  luckysheetTableContent.fillStyle=checksAF[1];}if(checksCF!=null&&checksCF["cellColor"]!=null){//条件格式 
  luckysheetTableContent.fillStyle=checksCF["cellColor"];}if(luckysheet.flowdata[r][c]!=null&&luckysheet.flowdata[r][c].tc!=null){//标题色
  luckysheetTableContent.fillStyle=luckysheet.flowdata[r][c].tc;}var cellsize=[devicePixelRatio*(start_c+offsetLeft+borderfix[0]),devicePixelRatio*(start_r+offsetTop+1+borderfix[1]),devicePixelRatio*(end_c-start_c-3+borderfix[2]),devicePixelRatio*(end_r-start_r-3-0.5+borderfix[3])];luckysheetTableContent.fillRect(cellsize[0],cellsize[1],cellsize[2],cellsize[3]);if(r+"_"+c in dynamicArray_compute){var value=dynamicArray_compute[r+"_"+c].v;luckysheetTableContent.fillStyle="#000000";//文本宽度和高度
  var fontset=luckysheetdefaultstyle.font;luckysheetTableContent.font=fontset;var textMetrics=luckysheetTableContent.measureText(value).width;var oneLineTextHeight=luckysheet.menuButton.getTextSize("田",fontset)[1];//水平对齐 (默认为1，左对齐)
  var horizonAlignPos=(start_c+4+offsetLeft)*devicePixelRatio;//垂直对齐 (默认为2，下对齐)
  var verticalFixed=luckysheet.browser.luckysheetrefreshfixed();var verticalAlignPos=(end_r+offsetTop-2+verticalFixed)*devicePixelRatio-oneLineTextHeight;luckysheetTableContent.fillText(value==null?"":value,horizonAlignPos,verticalAlignPos);}//若单元格有批注
  if(luckysheet.flowdata[r][c]!=null&&luckysheet.flowdata[r][c].ps!=null){luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(end_c+offsetLeft-6),devicePixelRatio*(start_r+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c+offsetLeft-1),devicePixelRatio*(start_r+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c+offsetLeft-1),devicePixelRatio*(start_r+offsetTop+5));luckysheetTableContent.fillStyle="#FC6666";luckysheetTableContent.fill();luckysheetTableContent.closePath();}//右边框
  luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(start_r+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(end_r-2+offsetTop));luckysheetTableContent.lineWidth=devicePixelRatio;if(!!luckysheetcurrentisPivotTable&&!luckysheet.pivotTable.drawPivotTable){luckysheetTableContent.strokeStyle="#000000";}else {luckysheetTableContent.strokeStyle=luckysheetdefaultstyle.strokeStyle;}luckysheetTableContent.stroke();luckysheetTableContent.closePath();//下边框
  luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(start_c-2+offsetLeft),devicePixelRatio*(end_r-2+0.5+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c+offsetLeft-2),devicePixelRatio*(end_r-2+0.5+offsetTop));luckysheetTableContent.lineWidth=devicePixelRatio;if(!!luckysheetcurrentisPivotTable&&!luckysheet.pivotTable.drawPivotTable){luckysheetTableContent.strokeStyle="#000000";}else {luckysheetTableContent.strokeStyle=luckysheetdefaultstyle.strokeStyle;}luckysheetTableContent.stroke();luckysheetTableContent.closePath();};//非空白单元格渲染
  var cellRender=function cellRender(r,c,start_r,start_c,end_r,end_c,value,canvasType){var checksAF=luckysheet.alternateformat.checksAF(r,c,af_compute);//交替颜色
  var checksCF=luckysheet.conditionformat.checksCF(r,c,cf_compute);//条件格式
  var borderfix=luckysheet.menuButton.borderfix(luckysheet.flowdata,r,c);//文本宽度和高度
  var fontset=luckysheetfontformat(luckysheet.flowdata[r][c]);luckysheetTableContent.font=fontset;var textMetrics=luckysheetTableContent.measureText(value).width;var oneLineTextHeight=luckysheet.menuButton.getTextSize("田",fontset)[1];if(luckysheet.flowdata[r][c].tb=="2"){var strValue=value.toString();var cellWidth=end_c-start_c-8;var strArr=[];for(var strI=1;strI<=strValue.length;strI++){var strV=strValue.substring(strArr.join("").length,strI);var strtextMetrics=luckysheetTableContent.measureText(strV).width;if(strtextMetrics>cellWidth){strArr.push(strValue.substring(strArr.join("").length,strI-1));strI=strI-2;}else if(strtextMetrics<=cellWidth&&strI==strValue.length){strArr.push(strV);}}var textH=strArr.length*oneLineTextHeight;}else if(luckysheet.flowdata[r][c].tr!=null&&luckysheet.flowdata[r][c].tr!="0"){var tr=luckysheet.flowdata[r][c].tr;if(tr=="1"||tr=="2"){var textW=0.707*(textMetrics+oneLineTextHeight);var textH=0.707*(textMetrics+oneLineTextHeight);}else if(tr=="3"){value=value.toString();if(value.length>1){var vArr=value.split("");}else {var vArr=[];vArr.push(value);}var textW=luckysheetTableContent.measureText(vArr[0]).width;var textH=vArr.length*oneLineTextHeight;}else if(tr=="4"||tr=="5"){var textW=oneLineTextHeight;var textH=textMetrics;}}else {var textW=textMetrics;var textH=oneLineTextHeight;}//水平对齐
  var horizonAlign=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"ht");var horizonAlignPos=(start_c+4+offsetLeft)*devicePixelRatio;//horizonAlign默认为1，左对齐
  if(horizonAlign=="0"){//居中对齐
  horizonAlignPos=(start_c+(end_c-start_c)/2+offsetLeft)*devicePixelRatio-textMetrics/2;}else if(horizonAlign=="2"){//右对齐
  horizonAlignPos=(end_c+offsetLeft-8)*devicePixelRatio-textMetrics;}//垂直对齐
  var verticalAlign=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"vt");var verticalFixed=luckysheet.browser.luckysheetrefreshfixed();var verticalAlignPos=(end_r+offsetTop-2+verticalFixed)*devicePixelRatio-oneLineTextHeight;//verticalAlign默认为2，下对齐
  if(verticalAlign=="0"){//居中对齐
  verticalAlignPos=(start_r+(end_r-start_r)/2+offsetTop+verticalFixed)*devicePixelRatio-oneLineTextHeight/2;}else if(verticalAlign=="1"){//上对齐
  verticalAlignPos=(start_r+offsetTop+verticalFixed)*devicePixelRatio;}//水平对齐方式是 居中或居右对齐 且单元格宽度小于文字宽度 （用离屏canvas渲染） 
  if(luckysheet.browser.BrowserType()!="Safari"&&(canvasType=="offline"||(horizonAlign=="0"||horizonAlign=="2")&&end_c-start_c<textW||(verticalAlign=="0"||verticalAlign=="2")&&end_r-start_r<textH)){// if(canvasType == "offline" || ((horizonAlign == "0" || horizonAlign == "2") && (end_c - start_c) < textW) || ((verticalAlign == "0" || verticalAlign == "2") && (end_r - start_r) < textH) || (luckysheet.flowdata[r][c].tr != null && luckysheet.flowdata[r][c].tr != "0")){
  var canvasName=offlinecanvas;canvasName.font=fontset;var cellsize=[devicePixelRatio*(start_c+offsetLeft+borderfix[0]),devicePixelRatio*(start_r+offsetTop+0.5+borderfix[1]),devicePixelRatio*(end_c-start_c-3+borderfix[2]),devicePixelRatio*(end_r-start_r-3-0.5+borderfix[3])];}else {var canvasName=luckysheetTableContent;var cellsize=[devicePixelRatio*(start_c+offsetLeft+borderfix[0]),devicePixelRatio*(start_r+offsetTop+1+borderfix[1]),devicePixelRatio*(end_c-start_c-3+borderfix[2]),devicePixelRatio*(end_r-start_r-3-0.5+borderfix[3])];}//单元格 背景颜色
  canvasName.fillStyle=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"bg");//若单元格有交替颜色 背景颜色
  if(checksAF!=null&&checksAF[1]!=null){canvasName.fillStyle=checksAF[1];}//若单元格有条件格式 背景颜色
  if(checksCF!=null&&checksCF["cellColor"]!=null){canvasName.fillStyle=checksCF["cellColor"];}//若单元格有标题色
  if(luckysheet.flowdata[r][c]!=null&&luckysheet.flowdata[r][c].tc!=null){luckysheetTableContent.fillStyle=luckysheet.flowdata[r][c].tc;}canvasName.fillRect(cellsize[0],cellsize[1],cellsize[2],cellsize[3]);//若单元格有批注
  if(luckysheet.flowdata[r][c].ps!=null){canvasName.beginPath();canvasName.moveTo(devicePixelRatio*(end_c+offsetLeft-6),devicePixelRatio*(start_r+offsetTop));canvasName.lineTo(devicePixelRatio*(end_c+offsetLeft-1),devicePixelRatio*(start_r+offsetTop));canvasName.lineTo(devicePixelRatio*(end_c+offsetLeft-1),devicePixelRatio*(start_r+offsetTop+5));canvasName.fillStyle="#FC6666";canvasName.fill();canvasName.closePath();}//若单元格有条件格式数据条
  if(checksCF!=null&&checksCF["dataBar"]!=null){var x=devicePixelRatio*(start_c+offsetLeft+borderfix[0]+2);var y=devicePixelRatio*(start_r+offsetTop+0.5+borderfix[1]+2);var w=devicePixelRatio*(end_c-start_c-3+borderfix[2]-4);var h=devicePixelRatio*(end_r-start_r-3-0.5+borderfix[3]-4);var valueType=checksCF["dataBar"]["valueType"];var valueLen=checksCF["dataBar"]["valueLen"];var format=checksCF["dataBar"]["format"];if(format.length>1){//渐变
  if(valueType=="minus"){//负数
  var minusLen=checksCF["dataBar"]["minusLen"];var my_gradient=canvasName.createLinearGradient(x+w*minusLen*(1-valueLen),y,x+w*minusLen,y);my_gradient.addColorStop(0,"#ffffff");my_gradient.addColorStop(1,"#ff0000");canvasName.fillStyle=my_gradient;canvasName.fillRect(x+w*minusLen*(1-valueLen),y,w*minusLen*valueLen,h);canvasName.beginPath();canvasName.moveTo(x+w*minusLen*(1-valueLen),y);canvasName.lineTo(x+w*minusLen*(1-valueLen),y+h);canvasName.lineTo(x+w*minusLen,y+h);canvasName.lineTo(x+w*minusLen,y);canvasName.lineTo(x+w*minusLen*(1-valueLen),y);canvasName.lineWidth=devicePixelRatio;canvasName.strokeStyle="#ff0000";canvasName.stroke();canvasName.closePath();}else if(valueType=="plus"){//正数
  var plusLen=checksCF["dataBar"]["plusLen"];if(plusLen==1){var my_gradient=canvasName.createLinearGradient(x,y,x+w*valueLen,y);my_gradient.addColorStop(0,format[0]);my_gradient.addColorStop(1,format[1]);canvasName.fillStyle=my_gradient;canvasName.fillRect(x,y,w*valueLen,h);canvasName.beginPath();canvasName.moveTo(x,y);canvasName.lineTo(x,y+h);canvasName.lineTo(x+w*valueLen,y+h);canvasName.lineTo(x+w*valueLen,y);canvasName.lineTo(x,y);canvasName.lineWidth=devicePixelRatio;canvasName.strokeStyle=format[0];canvasName.stroke();canvasName.closePath();}else {var minusLen=checksCF["dataBar"]["minusLen"];var my_gradient=canvasName.createLinearGradient(x+w*minusLen,y,x+w*minusLen+w*plusLen*valueLen,y);my_gradient.addColorStop(0,format[0]);my_gradient.addColorStop(1,format[1]);canvasName.fillStyle=my_gradient;canvasName.fillRect(x+w*minusLen,y,w*plusLen*valueLen,h);canvasName.beginPath();canvasName.moveTo(x+w*minusLen,y);canvasName.lineTo(x+w*minusLen,y+h);canvasName.lineTo(x+w*minusLen+w*plusLen*valueLen,y+h);canvasName.lineTo(x+w*minusLen+w*plusLen*valueLen,y);canvasName.lineTo(x+w*minusLen,y);canvasName.lineWidth=devicePixelRatio;canvasName.strokeStyle=format[0];canvasName.stroke();canvasName.closePath();}}}else {//单色
  if(valueType=="minus"){//负数
  var minusLen=checksCF["dataBar"]["minusLen"];canvasName.fillStyle="#ff0000";canvasName.fillRect(x+w*minusLen*(1-valueLen),y,w*minusLen*valueLen,h);canvasName.beginPath();canvasName.moveTo(x+w*minusLen*(1-valueLen),y);canvasName.lineTo(x+w*minusLen*(1-valueLen),y+h);canvasName.lineTo(x+w*minusLen,y+h);canvasName.lineTo(x+w*minusLen,y);canvasName.lineTo(x+w*minusLen*(1-valueLen),y);canvasName.lineWidth=devicePixelRatio;canvasName.strokeStyle="#ff0000";canvasName.stroke();canvasName.closePath();}else if(valueType=="plus"){//正数
  var plusLen=checksCF["dataBar"]["plusLen"];if(plusLen==1){canvasName.fillStyle=format[0];canvasName.fillRect(x,y,w*valueLen,h);canvasName.beginPath();canvasName.moveTo(x,y);canvasName.lineTo(x,y+h);canvasName.lineTo(x+w*valueLen,y+h);canvasName.lineTo(x+w*valueLen,y);canvasName.lineTo(x,y);canvasName.lineWidth=devicePixelRatio;canvasName.strokeStyle=format[0];canvasName.stroke();canvasName.closePath();}else {var minusLen=checksCF["dataBar"]["minusLen"];canvasName.fillStyle=format[0];canvasName.fillRect(x+w*minusLen,y,w*plusLen*valueLen,h);canvasName.beginPath();canvasName.moveTo(x+w*minusLen,y);canvasName.lineTo(x+w*minusLen,y+h);canvasName.lineTo(x+w*minusLen+w*plusLen*valueLen,y+h);canvasName.lineTo(x+w*minusLen+w*plusLen*valueLen,y);canvasName.lineTo(x+w*minusLen,y);canvasName.lineWidth=devicePixelRatio;canvasName.strokeStyle=format[0];canvasName.stroke();canvasName.closePath();}}}}//若单元格有条件格式图标集
  if(checksCF!=null&&checksCF["icons"]!=null){var l=checksCF["icons"]["left"];var t=checksCF["icons"]["top"];canvasName.drawImage(luckysheet_CFiconsImg,l*42,t*32,32,32,cellsize[0],verticalAlignPos+2,oneLineTextHeight-2,oneLineTextHeight-2);if(horizonAlign!="0"&&horizonAlign!="2"){//左对齐时 文本渲染空出一个图标的距离
  horizonAlignPos=horizonAlignPos+oneLineTextHeight-2;}}//单元格 文本颜色
  canvasName.fillStyle=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"fc");//若单元格有交替颜色 文本颜色
  if(checksAF!=null&&checksAF[0]!=null){canvasName.fillStyle=checksAF[0];}//若单元格有条件格式 文本颜色
  if(checksCF!=null&&checksCF["textColor"]!=null){canvasName.fillStyle=checksCF["textColor"];}//单元格有下钻属性，文本颜色变成超链接的颜色
  if(luckysheet.flowdata[r][c].dd!=null){canvasName.fillStyle="#0000ff";canvasName.fillText(value==null?"":value,horizonAlignPos,verticalAlignPos);canvasName.beginPath();canvasName.strokeStyle="#0000ff";canvasName.moveTo(horizonAlignPos,verticalAlignPos+oneLineTextHeight);canvasName.lineTo(horizonAlignPos+textMetrics,verticalAlignPos+oneLineTextHeight);canvasName.closePath();canvasName.stroke();}else {//自动换行、旋转、删除线功能
  if(luckysheet.flowdata[r][c].tb=="2"){var strValue=value.toString();var cellWidth=end_c-start_c-8;var strArr=[];for(var strI=1;strI<=strValue.length;strI++){var strV=strValue.substring(strArr.join("").length,strI);var strtextMetrics=canvasName.measureText(strV).width;if(strtextMetrics>cellWidth){strArr.push(strValue.substring(strArr.join("").length,strI-1));strI=strI-2;}else if(strtextMetrics<=cellWidth&&strI==strValue.length){strArr.push(strV);}}for(var iFill=0;iFill<strArr.length;iFill++){//水平对齐计算
  var strWidth=canvasName.measureText(strArr[iFill]).width;if(horizonAlign=="0"){horizonAlignPos=(start_c+(end_c-start_c)/2+offsetLeft)*devicePixelRatio-strWidth/2;}else if(horizonAlign=="2"){horizonAlignPos=(end_c+offsetLeft-8)*devicePixelRatio-strWidth;}//垂直对齐计算
  if(verticalAlign=="0"){verticalAlignPos=(start_r+(end_r-start_r)/2+offsetTop+verticalFixed)*devicePixelRatio-oneLineTextHeight*strArr.length/2;}else if(verticalAlign=="1"){verticalAlignPos=(start_r+offsetTop+verticalFixed)*devicePixelRatio;}else {verticalAlignPos=(end_r+offsetTop-2+verticalFixed)*devicePixelRatio-oneLineTextHeight*strArr.length;}canvasName.fillText(strArr[iFill],horizonAlignPos,verticalAlignPos+iFill*oneLineTextHeight);}}else if(luckysheet.flowdata[r][c].tr!=null&&luckysheet.flowdata[r][c].tr!="0"){//单元格旋转属性
  var tr=luckysheet.flowdata[r][c].tr;if(tr=="1"||tr=="2"){//旋转重新计算水平、垂直方向坐标
  var textW=0.707*(textMetrics+oneLineTextHeight);var textH=0.707*(textMetrics+oneLineTextHeight);var hAP=(start_c+4+offsetLeft)*devicePixelRatio;if(horizonAlign=="0"){hAP=(start_c+(end_c-start_c)/2+offsetLeft)*devicePixelRatio-textW/2;}else if(horizonAlign=="2"){hAP=(end_c+offsetLeft-8)*devicePixelRatio-textW;}var vAP=(end_r+offsetTop-2+verticalFixed)*devicePixelRatio-textH;if(verticalAlign=="0"){vAP=(start_r+(end_r-start_r)/2+offsetTop+verticalFixed)*devicePixelRatio-textH/2;}else if(verticalAlign=="1"){vAP=(start_r+offsetTop+verticalFixed)*devicePixelRatio;}//向下倾斜（45 旋转）
  if(tr=="1"){canvasName.save();canvasName.translate(hAP,vAP);canvasName.rotate(45*Math.PI/180);canvasName.translate(-hAP,-vAP);canvasName.fillText(value==null?"":value,hAP+0.707*0.707*oneLineTextHeight,vAP-0.707*0.707*oneLineTextHeight);canvasName.restore();//是否有删除线
  var cl=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"cl");if(cl=="1"&&!luckysheet.func_methods.isRealNull(value)){canvasName.beginPath();canvasName.strokeStyle="#000";canvasName.moveTo(hAP+oneLineTextHeight/2,vAP+oneLineTextHeight/2);canvasName.lineTo(hAP+textW-oneLineTextHeight/2,vAP+textH-oneLineTextHeight/2);canvasName.closePath();canvasName.stroke();}}//向上倾斜（-45 旋转）
  if(tr=="2"){canvasName.save();canvasName.translate(hAP,vAP+textH);canvasName.rotate(-45*Math.PI/180);canvasName.translate(-hAP,-(vAP+textH));canvasName.fillText(value==null?"":value,hAP+0.707*0.707*oneLineTextHeight,vAP+textH-0.707*0.707*oneLineTextHeight);canvasName.restore();//是否有删除线
  var cl=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"cl");if(cl=="1"&&!luckysheet.func_methods.isRealNull(value)){canvasName.beginPath();canvasName.strokeStyle="#000";canvasName.moveTo(hAP+oneLineTextHeight/2,vAP+textH-oneLineTextHeight/2);canvasName.lineTo(hAP+textW-oneLineTextHeight/2,vAP+oneLineTextHeight/2);canvasName.closePath();canvasName.stroke();}}}else if(tr=="3"){if(!luckysheet.func_methods.isRealNull(value)){value=value.toString();if(value.length>1){var vArr=value.split("");}else {var vArr=[];vArr.push(value);}var textW=canvasName.measureText(vArr[0]).width;var textH=vArr.length*oneLineTextHeight;for(var i=0;i<vArr.length;i++){var vWidth=canvasName.measureText(vArr[i]).width;//水平对齐计算
  if(horizonAlign=="0"){horizonAlignPos=(start_c+(end_c-start_c)/2+offsetLeft)*devicePixelRatio-vWidth/2;}else if(horizonAlign=="2"){horizonAlignPos=(end_c+offsetLeft-8)*devicePixelRatio-vWidth;}else {horizonAlignPos=(start_c+4+offsetLeft)*devicePixelRatio;}//垂直对齐计算
  if(verticalAlign=="0"){verticalAlignPos=(start_r+(end_r-start_r)/2+offsetTop+verticalFixed)*devicePixelRatio-oneLineTextHeight*vArr.length/2;}else if(verticalAlign=="1"){verticalAlignPos=(start_r+offsetTop+verticalFixed)*devicePixelRatio;}else {verticalAlignPos=(end_r+offsetTop-2+verticalFixed)*devicePixelRatio-oneLineTextHeight*vArr.length;}canvasName.fillText(vArr[i],horizonAlignPos,verticalAlignPos+i*oneLineTextHeight);}//是否有删除线
  var cl=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"cl");if(cl=="1"&&!luckysheet.func_methods.isRealNull(value)){canvasName.beginPath();canvasName.strokeStyle="#000";canvasName.moveTo(horizonAlignPos+textW/2,verticalAlignPos);canvasName.lineTo(horizonAlignPos+textW/2,verticalAlignPos+textH);canvasName.closePath();canvasName.stroke();}}}else if(tr=="4"||tr=="5"){//旋转重新计算水平、垂直方向坐标
  var textW=oneLineTextHeight;var textH=textMetrics;var hAP=(start_c+4+offsetLeft)*devicePixelRatio;if(horizonAlign=="0"){hAP=(start_c+(end_c-start_c)/2+offsetLeft)*devicePixelRatio-textW/2;}else if(horizonAlign=="2"){hAP=(end_c+offsetLeft-8)*devicePixelRatio-textW;}var vAP=(end_r+offsetTop-2+verticalFixed)*devicePixelRatio-textH;if(verticalAlign=="0"){vAP=(start_r+(end_r-start_r)/2+offsetTop+verticalFixed)*devicePixelRatio-textH/2;}else if(verticalAlign=="1"){vAP=(start_r+offsetTop+verticalFixed)*devicePixelRatio;}//向下90（90 旋转）
  if(tr=="4"){canvasName.save();canvasName.translate(hAP,vAP);canvasName.rotate(90*Math.PI/180);canvasName.translate(-hAP,-vAP);canvasName.fillText(value==null?"":value,hAP,vAP-textW);canvasName.restore();//是否有删除线
  var cl=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"cl");if(cl=="1"&&!luckysheet.func_methods.isRealNull(value)){canvasName.beginPath();canvasName.strokeStyle="#000";canvasName.moveTo(hAP+textW/2,vAP);canvasName.lineTo(hAP+textW/2,vAP+textH);canvasName.closePath();canvasName.stroke();}}//向上90（-90 旋转）
  if(tr=="5"){canvasName.save();canvasName.translate(hAP+textH,vAP);canvasName.rotate(-90*Math.PI/180);canvasName.translate(-(hAP+textH),-vAP);canvasName.fillText(value==null?"":value,hAP,vAP-textH);canvasName.restore();//是否有删除线
  var cl=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"cl");if(cl=="1"&&!luckysheet.func_methods.isRealNull(value)){canvasName.beginPath();canvasName.strokeStyle="#000";canvasName.moveTo(hAP+textW/2,vAP);canvasName.lineTo(hAP+textW/2,vAP+textH);canvasName.closePath();canvasName.stroke();}}}}else {canvasName.fillText(value==null?"":value,horizonAlignPos,verticalAlignPos);//是否有删除线
  var cl=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"cl");if(cl=="1"&&!luckysheet.func_methods.isRealNull(value)){canvasName.beginPath();canvasName.strokeStyle="#000";canvasName.moveTo(horizonAlignPos,verticalAlignPos+oneLineTextHeight/2);canvasName.lineTo(horizonAlignPos+textMetrics,verticalAlignPos+oneLineTextHeight/2);canvasName.closePath();canvasName.stroke();}}}//水平对齐方式是 居中或居右对齐 且单元格宽度小于文字宽度 （用离屏canvas渲染）
  if(luckysheet.browser.BrowserType()!="Safari"&&(canvasType=="offline"||(horizonAlign=="0"||horizonAlign=="2")&&end_c-start_c<textW||(verticalAlign=="0"||verticalAlign=="2")&&end_r-start_r<textH)){canvasName.font=luckysheetdefaultstyle.font;if($("#luckysheetTableContentF").length>0){luckysheetTableContent.drawImage($("#luckysheetTableContentF").get(0),cellsize[0],cellsize[1],cellsize[2],cellsize[3],cellsize[0],cellsize[1],cellsize[2],cellsize[3]);}else {luckysheetTableContent.drawImage(offlineElement,cellsize[0],cellsize[1],cellsize[2],cellsize[3],cellsize[0],cellsize[1],cellsize[2],cellsize[3]);}}luckysheetTableContent.font=luckysheetdefaultstyle.font;//右边框
  luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(start_r+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(end_r-2+offsetTop));luckysheetTableContent.lineWidth=devicePixelRatio;if(!!luckysheetcurrentisPivotTable&&!luckysheet.pivotTable.drawPivotTable){luckysheetTableContent.strokeStyle="#000000";}else {luckysheetTableContent.strokeStyle=luckysheetdefaultstyle.strokeStyle;}luckysheetTableContent.stroke();luckysheetTableContent.closePath();//下边框
  luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(start_c-2+offsetLeft),devicePixelRatio*(end_r-2+0.5+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c+offsetLeft-2),devicePixelRatio*(end_r-2+0.5+offsetTop));luckysheetTableContent.lineWidth=devicePixelRatio;if(!!luckysheetcurrentisPivotTable&&!luckysheet.pivotTable.drawPivotTable){luckysheetTableContent.strokeStyle="#000000";}else {luckysheetTableContent.strokeStyle=luckysheetdefaultstyle.strokeStyle;}luckysheetTableContent.stroke();luckysheetTableContent.closePath();};var mcArr=[];for(var cud=0;cud<cellupdate.length;cud++){var item=cellupdate[cud];var r=item.r,c=item.c,start_r=item.start_r,start_c=item.start_c,end_r=item.end_r,end_c=item.end_c;var firstcolumlen=item.firstcolumlen;if(luckysheet.flowdata[r]==null){continue;}if(luckysheet.flowdata[r][c]==null){//空单元格
  nullCellRender(r,c,start_r,start_c,end_r,end_c);}else {var cell=luckysheet.flowdata[r][c];var value=null,er=r,ec=c,end_ec=end_c;if(_typeof(cell)=="object"&&"mc"in cell){mcArr.push(cellupdate[cud]);var margeMaindata=cell["mc"];value=luckysheet.getcellvalue(margeMaindata.r,margeMaindata.c,null,"m");if(value==null){value=luckysheet.getcellvalue(margeMaindata.r,margeMaindata.c);}r=margeMaindata.r;c=margeMaindata.c;er+=margeMaindata.rs;ec+=margeMaindata.rc;if(c==0){start_c=-scrollWidth;}else {start_c=visibledatacolumn[c-1]-scrollWidth;}if(r==0){start_r=-scrollHeight-1;}else {start_r=visibledatarow[r-1]-scrollHeight-1;}end_ec=visibledatacolumn[ec]-scrollWidth;}else {value=luckysheet.getcellvalue(r,c,null,"m");if(value==null){value=luckysheet.getcellvalue(r,c);}}if(value==null||value.toString().length==0){nullCellRender(r,c,start_r,start_c,end_r,end_c);//sparklines渲染
  var borderfix=luckysheet.menuButton.borderfix(luckysheet.flowdata,r,c);var cellsize=[devicePixelRatio*(start_c+offsetLeft+borderfix[0]),devicePixelRatio*(start_r+offsetTop+0.5+borderfix[1]),devicePixelRatio*(end_c-start_c-3+borderfix[2]),devicePixelRatio*(end_r-start_r-3-0.5+borderfix[3])];sparklinesRender(r,c,cellsize[0],cellsize[1],"luckysheetTableContent",luckysheetTableContent);}else {if(r+"_"+c in dynamicArray_compute){//动态数组公式
  value=dynamicArray_compute[r+"_"+c].v;}cellRender(r,c,start_r,start_c,end_r,end_c,value);}}}//合并单元格再处理
  for(var m=0;m<mcArr.length;m++){var item=mcArr[m];var r=item.r,c=item.c,start_r=item.start_r,start_c=item.start_c,end_r=item.end_r,end_c=item.end_c;var firstcolumlen=item.firstcolumlen;var cell=luckysheet.flowdata[r][c];var value=null,er=r,ec=c,end_ec=end_c;var margeMaindata=cell["mc"];value=luckysheet.getcellvalue(margeMaindata.r,margeMaindata.c,null,"m");if(value==null){value=luckysheet.getcellvalue(margeMaindata.r,margeMaindata.c);}r=margeMaindata.r;c=margeMaindata.c;er+=margeMaindata.rs;ec+=margeMaindata.rc;if(c==0){start_c=-scrollWidth;}else {start_c=visibledatacolumn[c-1]-scrollWidth;}if(r==0){start_r=-scrollHeight-1;}else {start_r=visibledatarow[r-1]-scrollHeight-1;}end_ec=visibledatacolumn[ec]-scrollWidth;if(value==null||value.toString().length==0){nullCellRender(r,c,start_r,start_c,end_r,end_c);//sparklines渲染
  var borderfix=luckysheet.menuButton.borderfix(luckysheet.flowdata,r,c);var cellsize=[devicePixelRatio*(start_c+offsetLeft+borderfix[0]),devicePixelRatio*(start_r+offsetTop+0.5+borderfix[1]),devicePixelRatio*(end_c-start_c-3+borderfix[2]),devicePixelRatio*(end_r-start_r-3-0.5+borderfix[3])];sparklinesRender(r,c,cellsize[0],cellsize[1],"luckysheetTableContent",luckysheetTableContent);}else {if(r+"_"+c in dynamicArray_compute){//动态数组公式
  value=dynamicArray_compute[r+"_"+c].v;}cellRender(r,c,start_r,start_c,end_r,end_c,value,"offline");}}//边框单独渲染
  if(config["borderInfo"]!=null&&config["borderInfo"].length>0){//边框渲染
  var borderLeftRender=function borderLeftRender(style,color,start_r,start_c,end_r,end_c,offsetLeft,offsetTop,canvas){var linetype=style;var m_st=devicePixelRatio*(start_c-2+0.5+offsetLeft);var m_ed=devicePixelRatio*(start_r+offsetTop);var line_st=devicePixelRatio*(start_c-2+0.5+offsetLeft);var line_ed=devicePixelRatio*(end_r-2+offsetTop);luckysheet.menuButton.setLineDash(canvas,linetype,"v",m_st,m_ed,line_st,line_ed);canvas.strokeStyle=color;canvas.stroke();canvas.closePath();};var borderRightRender=function borderRightRender(style,color,start_r,start_c,end_r,end_c,offsetLeft,offsetTop,canvas){var linetype=style;var m_st=devicePixelRatio*(end_c-2+0.5+offsetLeft);var m_ed=devicePixelRatio*(start_r+offsetTop);var line_st=devicePixelRatio*(end_c-2+0.5+offsetLeft);var line_ed=devicePixelRatio*(end_r-2+offsetTop);luckysheet.menuButton.setLineDash(canvas,linetype,"v",m_st,m_ed,line_st,line_ed);canvas.strokeStyle=color;canvas.stroke();canvas.closePath();};var borderBottomRender=function borderBottomRender(style,color,start_r,start_c,end_r,end_c,offsetLeft,offsetTop,canvas){var linetype=style;var m_st=devicePixelRatio*(start_c-2+offsetLeft);var m_ed=devicePixelRatio*(end_r-2+0.5+offsetTop);var line_st=devicePixelRatio*(end_c+offsetLeft-2);var line_ed=devicePixelRatio*(end_r-2+0.5+offsetTop);luckysheet.menuButton.setLineDash(canvas,linetype,"h",m_st,m_ed,line_st,line_ed);canvas.strokeStyle=color;canvas.stroke();canvas.closePath();};var borderTopRender=function borderTopRender(style,color,start_r,start_c,end_r,end_c,offsetLeft,offsetTop,canvas){var linetype=style;var m_st=devicePixelRatio*(start_c-2+offsetLeft);var m_ed=devicePixelRatio*(start_r-1+0.5+offsetTop);var line_st=devicePixelRatio*(end_c+offsetLeft-2);var line_ed=devicePixelRatio*(start_r-1+0.5+offsetTop);luckysheet.menuButton.setLineDash(canvas,linetype,"h",m_st,m_ed,line_st,line_ed);canvas.strokeStyle=color;canvas.stroke();canvas.closePath();};var borderInfoCompute=luckysheet.getBorderInfoCompute();for(x in borderInfoCompute){var bd_r=x.split("_")[0],bd_c=x.split("_")[1];if(borderOffset[bd_r+"_"+bd_c]){var start_r=borderOffset[bd_r+"_"+bd_c].start_r;var start_c=borderOffset[bd_r+"_"+bd_c].start_c;var end_r=borderOffset[bd_r+"_"+bd_c].end_r;var end_c=borderOffset[bd_r+"_"+bd_c].end_c;var borderLeft=borderInfoCompute[x].l;if(borderLeft!=null){borderLeftRender(borderLeft.style,borderLeft.color,start_r,start_c,end_r,end_c,offsetLeft,offsetTop,luckysheetTableContent);}var borderRight=borderInfoCompute[x].r;if(borderRight!=null){borderRightRender(borderRight.style,borderRight.color,start_r,start_c,end_r,end_c,offsetLeft,offsetTop,luckysheetTableContent);}var borderTop=borderInfoCompute[x].t;if(borderTop!=null){borderTopRender(borderTop.style,borderTop.color,start_r,start_c,end_r,end_c,offsetLeft,offsetTop,luckysheetTableContent);}var borderBottom=borderInfoCompute[x].b;if(borderBottom!=null){borderBottomRender(borderBottom.style,borderBottom.color,start_r,start_c,end_r,end_c,offsetLeft,offsetTop,luckysheetTableContent);}}}}//渲染表格时有尾列时，清除右边灰色区域，防止表格有值溢出
  if(dataset_col_ed==visibledatacolumn.length-1){luckysheetTableContent.clearRect((fill_col_ed-scrollWidth+offsetLeft-1)*devicePixelRatio,(offsetTop-1)*devicePixelRatio,(ch_width-visibledatacolumn[dataset_col_ed])*devicePixelRatio,(fill_row_ed-scrollHeight)*devicePixelRatio);}if(ctx!=null){ctx.drawImage(luckysheetTableElement,0,0,drawWidth,drawHeight,-drawWidth/2+offsetLeft,-drawHeight/2+offsetTop,drawWidth,drawHeight);}}luckysheet.luckysheetDrawMain=luckysheetDrawMain;//备份luckysheetDrawMain
  function luckysheetDrawMain_back(scrollWidth,scrollHeight,drawWidth,drawHeight,offsetLeft,offsetTop,columnOffsetCell,rowOffsetCell,mycanvas){if(scrollWidth==null){scrollWidth=$("#luckysheet-cell-main").scrollLeft();}if(scrollHeight==null){scrollHeight=$("#luckysheet-cell-main").scrollTop();}if(drawWidth==null){drawWidth=luckysheetTableContentHW[0];}if(drawHeight==null){drawHeight=luckysheetTableContentHW[1];}if(offsetLeft==null){offsetLeft=rowHeaderWidth;}if(offsetTop==null){offsetTop=columeHeaderHeight;}if(columnOffsetCell==null){columnOffsetCell=0;}if(rowOffsetCell==null){rowOffsetCell=0;}var luckysheetTableContent=null;if(mycanvas==null){luckysheetTableContent=$("#luckysheetTableContent").get(0).getContext("2d");}else {if(luckysheet.getObjType(mycanvas)=="object"){try{luckysheetTableContent=mycanvas.get(0).getContext("2d");}catch(err){luckysheetTableContent=mycanvas;}}else {luckysheetTableContent=$("#"+mycanvas).get(0).getContext("2d");}}//luckysheetTableContentHW = [$("#luckysheet-grid-window-1").width() - 13, $("#luckysheet-grid-window-1").height() - 13];
  //var luckysheetTableContent = $("#"+ mycanvas).get(0).getContext("2d");
  luckysheetTableContent.clearRect(offsetLeft*devicePixelRatio,offsetTop*devicePixelRatio,drawWidth*devicePixelRatio,drawHeight*devicePixelRatio);//离屏canvas
  var offlinecanvas=$("#luckysheetTableContentF").get(0).getContext("2d");//offlinecanvas.clearRect(0, 0, luckysheetTableContentHW[0], luckysheetTableContentHW[1]);
  offlinecanvas.fillStyle="#ffffff";offlinecanvas.fillRect(0,0,luckysheetTableContentHW[0]*devicePixelRatio,luckysheetTableContentHW[1]*devicePixelRatio);offlinecanvas.font=luckysheetdefaultstyle.font;offlinecanvas.textBaseline="top";offlinecanvas.fillStyle=luckysheetdefaultstyle.fillStyle;var dataset_row_st,dataset_row_ed,dataset_col_st,dataset_col_ed;dataset_row_st=luckysheet_searcharray(visibledatarow,scrollHeight);dataset_row_ed=luckysheet_searcharray(visibledatarow,scrollHeight+drawHeight);if(dataset_row_st==-1){dataset_row_st=0;}dataset_row_st+=rowOffsetCell;if(dataset_row_ed==-1){dataset_row_ed=visibledatarow.length-1;}dataset_row_ed+=rowOffsetCell;if(dataset_row_ed>=visibledatarow.length){dataset_row_ed=visibledatarow.length-1;}dataset_col_st=luckysheet_searcharray(visibledatacolumn,scrollWidth);dataset_col_ed=luckysheet_searcharray(visibledatacolumn,scrollWidth+drawWidth);if(dataset_col_st==-1){dataset_col_st=0;}dataset_col_st+=columnOffsetCell;if(dataset_col_ed==-1){dataset_col_ed=visibledatacolumn.length-1;}dataset_col_ed+=columnOffsetCell;if(dataset_col_ed>=visibledatacolumn.length){dataset_col_ed=visibledatacolumn.length-1;}var fill_row_st,fill_row_ed,fill_col_st,fill_col_ed;if(dataset_row_st==0){fill_row_st=0;}else {fill_row_st=visibledatarow[dataset_row_st-1];}fill_row_ed=visibledatarow[dataset_row_ed];if(dataset_col_st==0){fill_col_st=0;}else {fill_col_st=visibledatacolumn[dataset_col_st-1];}fill_col_ed=visibledatacolumn[dataset_col_ed];luckysheetTableContent.fillStyle="#ffffff";luckysheetTableContent.fillRect((offsetLeft-1)*devicePixelRatio,(offsetTop-1)*devicePixelRatio,(fill_col_ed-fill_col_st)*devicePixelRatio,(fill_row_ed-fill_row_st)*devicePixelRatio);var end_r,start_r,end_c,start_c;// $("#luckysheet-cell-main").scrollLeft(visibledatarow[dataset_row_st]);
  // $("#luckysheet-cell-main").scrollTop(visibledatacolumn[dataset_col_st]);
  var cellupdate=[];var mergeCache={};for(var r=dataset_row_st;r<=dataset_row_ed;r++){if(r==0){start_r=-scrollHeight-1;}else {start_r=visibledatarow[r-1]-scrollHeight-1;}end_r=visibledatarow[r]-scrollHeight;//行
  //luckysheetTableContent.beginPath();
  //luckysheetTableContent.moveTo(0, end_r + columeHeaderHeight);
  //luckysheetTableContent.lineTo(rowHeaderWidth, end_r + columeHeaderHeight);
  //luckysheetTableContent.lineWidth = 1;
  //luckysheetTableContent.strokeStyle = luckysheetdefaultstyle.strokeStyle;
  //luckysheetTableContent.closePath();
  //luckysheetTableContent.stroke();
  for(var c=dataset_col_st;c<=dataset_col_ed;c++){if(c==0){start_c=-scrollWidth;}else {start_c=visibledatacolumn[c-1]-scrollWidth;}end_c=visibledatacolumn[c]-scrollWidth;if(c==dataset_col_ed){if(!luckysheetcurrentisPivotTable&&end_r<=drawHeight&&start_r>=-1){//行
  luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(offsetLeft-1),devicePixelRatio*(end_r+offsetTop-2+0.5));luckysheetTableContent.lineTo(devicePixelRatio*(end_c+offsetLeft-2),devicePixelRatio*(end_r+offsetTop-2+0.5));luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle=luckysheetdefaultstyle.strokeStyle;luckysheetTableContent.closePath();luckysheetTableContent.stroke();//luckysheetTableContent.beginPath();
  //luckysheetTableContent.moveTo(end_c - 2 + offsetLeft, 0.5 + offsetTop);
  //luckysheetTableContent.lineTo(end_c - 2 + offsetLeft, rh_height + offsetTop);
  //luckysheetTableContent.lineWidth = 1;
  //luckysheetTableContent.strokeStyle = luckysheetdefaultstyle.strokeStyle;
  //luckysheetTableContent.closePath();
  //luckysheetTableContent.stroke();
  }}if(r==dataset_row_st){//var abc = luckysheet.luckysheetchatatABC(c);
  //var textMetrics = luckysheetTableContent.measureText(abc);
  //luckysheetTableContent.fillText(abc, Math.round(start_c + offsetLeft + (end_c - start_c - textMetrics.width) / 2), Math.round(offsetTop / 2 - 2));
  //luckysheetTableContent.clearRect(start_c + offsetLeft - 1, offsetTop-1, end_c - start_c - 1, 1);
  // luckysheetTableContent.clearRect(start_c + offsetLeft - 1, offsetTop+drawHeight, end_c - start_c - 1, 1);
  if(!luckysheetcurrentisPivotTable&&end_c<=drawWidth+18&&start_c>=-1){//列
  luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(end_c+offsetLeft-2+0.5),devicePixelRatio*(offsetTop-1));luckysheetTableContent.lineTo(devicePixelRatio*(end_c+offsetLeft-2+0.5),devicePixelRatio*(fill_row_ed-fill_row_st+offsetTop-2));luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle=luckysheetdefaultstyle.strokeStyle;luckysheetTableContent.closePath();luckysheetTableContent.stroke();//luckysheetTableContent.beginPath();
  //luckysheetTableContent.moveTo(0.5 + offsetLeft, end_r + offsetTop);
  //luckysheetTableContent.lineTo(ch_width + offsetLeft, end_r + offsetTop);
  //luckysheetTableContent.lineWidth = devicePixelRatio;
  //luckysheetTableContent.strokeStyle = luckysheetdefaultstyle.strokeStyle;
  //luckysheetTableContent.closePath();
  //luckysheetTableContent.stroke();
  }}if(!!luckysheetcurrentisPivotTable&&luckysheet.pivotTable.drawPivotTable){if((c==0||c==5)&&r<=11){luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(start_r+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(end_r-2+offsetTop));luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle="#000000";luckysheetTableContent.closePath();luckysheetTableContent.stroke();//luckysheetTableContent.clearRect(end_c - 2 + offsetLeft, offsetTop, 2, offsetTop);
  }if((r==2||r==11)&&c<=5){luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(start_c-1+offsetLeft),devicePixelRatio*(end_r-2+0.5+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c+offsetLeft-2),devicePixelRatio*(end_r-2+0.5+offsetTop));luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle="#000000";luckysheetTableContent.closePath();luckysheetTableContent.stroke();}if(r==6&&c==3){luckysheetTableContent.fillText("数据透视表",devicePixelRatio*(start_c+4+offsetLeft),devicePixelRatio*(start_r+(end_r-start_r)/2-1+offsetTop));}}else if(!!luckysheetcurrentisPivotTable){if(c<luckysheet.pivotTable.pivotTableBoundary[1]&&r<luckysheet.pivotTable.pivotTableBoundary[0]){luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(start_r+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(end_r-2+offsetTop));luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle="#000000";luckysheetTableContent.closePath();luckysheetTableContent.stroke();//luckysheetTableContent.clearRect(end_c + offsetLeft - 2, 0, 2, offsetTop);
  luckysheetTableContent.beginPath();luckysheetTableContent.moveTo(devicePixelRatio*(start_c-1+offsetLeft),devicePixelRatio*(end_r-2+0.5+offsetTop));luckysheetTableContent.lineTo(devicePixelRatio*(end_c+offsetLeft-2),devicePixelRatio*(end_r-2+0.5+offsetTop));luckysheetTableContent.lineWidth=devicePixelRatio;luckysheetTableContent.strokeStyle="#000000";luckysheetTableContent.closePath();luckysheetTableContent.stroke();}}if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null);else {//&& start_r >= -2 && start_c >= -2
  //&& end_r <= drawHeight && end_c <= drawWidth + 18
  if(luckysheet.flowdata[r]!=null&&luckysheet.flowdata[r][c]!=null&&start_r>=-1&&start_c>=-1){var value=luckysheet.flowdata[r][c];var firstcolumlen=defaultcollen;if(config["columlen"]!=null&&config["columlen"][c]!=null){firstcolumlen=config["columlen"][c];}if(luckysheet.getObjType(value)=="object"&&"mc"in value){//console.log(value);
  if("rs"in value["mc"]){var key="r"+r+"c"+c;mergeCache[key]=cellupdate.length;}else {var key="r"+value["mc"].r+"c"+value["mc"].c;var margeMain=cellupdate[mergeCache[key]];if(margeMain==null){mergeCache[key]=cellupdate.length;cellupdate.push({"r":r,"c":c,"start_c":start_c,"start_r":start_r,"end_r":end_r,"end_c":end_c,"firstcolumlen":firstcolumlen,startlist:[]});}else {if(margeMain.c==c){margeMain.end_r+=end_r-start_r-1;margeMain.startlist.push(start_r);}if(margeMain.r==r){margeMain.end_c+=end_c-start_c;margeMain.firstcolumlen+=firstcolumlen;}var margeMaindata=luckysheet.flowdata[margeMain.r][margeMain.c];if(margeMain.c+margeMaindata.mc.cs-1==c&&margeMain.r+margeMaindata.mc.rs-1==r);}continue;}}cellupdate.push({"r":r,"c":c,"start_c":start_c,"start_r":start_r,"end_r":end_r,"end_c":end_c,"firstcolumlen":firstcolumlen,startlist:[]});}//luckysheetTableContent.fillText("111", start_c + 4 + offsetLeft, start_r + (end_r - start_r) / 2 - 1 + offsetTop);
  }//if (r == dataset_row_ed) {
  //    luckysheetTableContent.beginPath();
  //    luckysheetTableContent.moveTo(end_c + rowHeaderWidth, -0.5);
  //    luckysheetTableContent.lineTo(end_c + rowHeaderWidth, columeHeaderHeight+rh_height);
  //    luckysheetTableContent.lineWidth = 1;
  //    luckysheetTableContent.strokeStyle = luckysheetdefaultstyle.strokeStyle;
  //    luckysheetTableContent.closePath();
  //    luckysheetTableContent.stroke();
  //    console.log("end_c, rh_height", dataset_col_st, dataset_col_ed, dataset_row_st, dataset_row_ed, r_set, c_set, rowfix, $("#luckysheetsheettable_" + luckysheet.currentSheetIndex + "_" + r_set + "_" + c_set + ""), end_c, h, r,c);
  //}
  }if(config["rowhidden"]!=null&&config["rowhidden"][r]!=null);}//console.log(cellupdate)
  for(var cud=0;cud<cellupdate.length;cud++){//console.log(i)
  var item=cellupdate[cud];var r=item.r,c=item.c,start_c=item.start_c,start_r=item.start_r,end_c=item.end_c,end_r=item.end_r;var firstcolumlen=item.firstcolumlen;//offlinecanvas.fillStyle="#ffffff";
  //offlinecanvas.fillRect(0, 0, luckysheetTableContentHW[0], luckysheetTableContentHW[1]);
  //var textMetrics = luckysheetTableContent.measureText(luckysheet.flowdata[r][c]);
  var cell=luckysheet.flowdata[r][c];var value=null,er=r,ec=c,end_ec=end_c;if(_typeof(cell)=="object"&&"mc"in cell){var margeMaindata=cell["mc"];value=luckysheet.getcellvalue(margeMaindata.r,margeMaindata.c,null,"m");if(value==null){value=luckysheet.getcellvalue(margeMaindata.r,margeMaindata.c);}r=margeMaindata.r;c=margeMaindata.c;er+=margeMaindata.rs;ec+=margeMaindata.rc;if(c==0){start_c=-scrollWidth;}else {start_c=visibledatacolumn[c-1]-scrollWidth;}if(r==0){start_r=-scrollHeight-1;}else {start_r=visibledatarow[r-1]-scrollHeight-1;}end_ec=visibledatacolumn[ec]-scrollWidth;}else {value=luckysheet.getcellvalue(r,c,null,"m");if(value==null){value=luckysheet.getcellvalue(r,c);}}var borderfix=luckysheet.menuButton.borderfix(luckysheet.flowdata,r,c);//console.log(borderfix);
  //luckysheetTableContent.clearRect(start_c - 1 + offsetLeft, start_r + offsetTop, end_c - start_c - 1, end_r - start_r-3);
  //console.log(borderfix);
  offlinecanvas.fillStyle=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"bg");var cellsize=[devicePixelRatio*(start_c+offsetLeft+borderfix[0]),devicePixelRatio*(start_r+offsetTop+0.5+borderfix[1]),devicePixelRatio*(end_c-start_c-3+borderfix[2]),devicePixelRatio*(end_r-start_r-3-0.5+borderfix[3])];offlinecanvas.fillRect(cellsize[0],cellsize[1],cellsize[2],cellsize[3]);// var fontsize = 13;
  // if((cell instanceof Object) && "fs" in cell){
  //     fontsize = cell.fs;
  // }
  // if (config["columlen"] != null && config["columlen"][c] != null) {
  //     firstcolumlen = config["columlen"][c];
  // }
  //var vformat = luckysheet.getcellformat(r, c);
  offlinecanvas.fillStyle=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"fc");//console.log(fontsize);
  var fontset=luckysheetfontformat(luckysheet.flowdata[r][c]);offlinecanvas.font=fontset;var textMetrics=offlinecanvas.measureText(value).width;//var oneLineTextHeight = offlinecanvas.measureText("田").width;
  var oneLineTextHeight=luckysheet.menuButton.getTextSize("田",fontset)[1];//console.log(oneLineTextHeight,fontset);
  //console.log(textMetrics, firstcolumlen, r, c ,value);
  offlinecanvas.fillStyle=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"fc");var horizonAlign=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"ht");var horizonAlignPos=(start_c+4+offsetLeft)*devicePixelRatio;if(horizonAlign=="0"){// if (textMetrics > firstcolumlen) {
  //     var v = "", value_array = value.toString().split("");
  //     var mid = Math.floor(value_array.length/2), posState = true, i=1, pos = mid;
  //     while (pos>=0 && pos<value_array.length) {
  //         if(posState){
  //             v = value_array[pos] + v;
  //         }
  //         else{
  //             v += value_array[pos];
  //         }
  //         var measureW = offlinecanvas.measureText(v).width;
  //         //console.log(v,measureW , firstcolumlen);
  //         if (measureW > firstcolumlen) {
  //             break;
  //         }
  //         if(posState){
  //             pos = mid + i;
  //         }
  //         else{
  //             pos = mid - i++;
  //         }
  //         posState = !posState;
  //     }
  //     value = v;
  // }
  //textMetrics = offlinecanvas.measureText(value).width;
  horizonAlignPos=(start_c+(end_c-start_c)/2+offsetLeft)*devicePixelRatio-textMetrics/2;// if(horizonAlignPos<start_c + 2 + offsetLeft){
  //     horizonAlignPos = start_c + 2 + offsetLeft;
  // }
  }else if(horizonAlign=="2"){// if (textMetrics+fontsize > firstcolumlen) {
  //     var v = "", value_array = value.toString().split("");
  //     for (var i = value_array.length-1; i >=0; i--) {
  //         v = value_array[i] + v;
  //         var measureW = offlinecanvas.measureText(v).width;
  //         //console.log(v,measureW , firstcolumlen);
  //         if (measureW+fontsize > firstcolumlen) {
  //             break;
  //         }
  //     }
  //     value = v;
  // }
  //textMetrics = offlinecanvas.measureText(value).width;
  horizonAlignPos=(end_c+offsetLeft-8)*devicePixelRatio-textMetrics;// if(horizonAlignPos<start_c + 2 + offsetLeft){
  //     horizonAlignPos = start_c + 2 + offsetLeft;
  // }
  }var verticalAlign=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"vt");var verticalFixed=luckysheet.browser.luckysheetrefreshfixed();var verticalAlignPos=(end_r+offsetTop-2+verticalFixed)*devicePixelRatio-oneLineTextHeight;if(verticalAlign=="0"){verticalAlignPos=(start_r+(end_r-start_r)/2+offsetTop+verticalFixed)*devicePixelRatio-oneLineTextHeight/2;// if(verticalAlignPos<start_r+offsetTop+8){
  //     verticalAlignPos = end_r - oneLineTextHeight + offsetTop + 1;
  // }
  }else if(verticalAlign=="1"){verticalAlignPos=(start_r+offsetTop+verticalFixed)*devicePixelRatio;}//自动换行、旋转、删除线功能
  if(luckysheet.flowdata[r][c].tb=="2"&&textMetrics>end_c-start_c){var strValue=value.toString();var cellWidth=end_c-start_c-8;var strArr=[];for(var strI=1;strI<=strValue.length;strI++){var strV=strValue.substring(strArr.join("").length,strI);var strtextMetrics=offlinecanvas.measureText(strV).width;if(strtextMetrics>cellWidth){strArr.push(strValue.substring(strArr.join("").length,strI-1));strI=strI-2;}else if(strtextMetrics<=cellWidth&&strI==strValue.length){strArr.push(strV);}}for(var iFill=0;iFill<strArr.length;iFill++){//水平对齐计算
  var strWidth=offlinecanvas.measureText(strArr[iFill]).width;if(horizonAlign=="0"){horizonAlignPos=(start_c+(end_c-start_c)/2+offsetLeft)*devicePixelRatio-strWidth/2;}else if(horizonAlign=="2"){horizonAlignPos=(end_c+offsetLeft-8)*devicePixelRatio-strWidth;}else {horizonAlignPos=(start_c+4+offsetLeft)*devicePixelRatio;}//垂直对齐计算
  if(verticalAlign=="0"){verticalAlignPos=(start_r+(end_r-start_r)/2+offsetTop+verticalFixed)*devicePixelRatio-oneLineTextHeight*strArr.length/2;}else if(verticalAlign=="1"){verticalAlignPos=(start_r+offsetTop+verticalFixed)*devicePixelRatio;}else {verticalAlignPos=(end_r+offsetTop-2+verticalFixed)*devicePixelRatio-oneLineTextHeight*strArr.length;}offlinecanvas.fillText(strArr[iFill],horizonAlignPos,verticalAlignPos+iFill*oneLineTextHeight);}}else if(!!luckysheet.flowdata[r][c].tr&&luckysheet.flowdata[r][c].tr!="0"){//单元格旋转属性
  var tr=luckysheet.flowdata[r][c].tr;if(tr=="1"||tr=="2"){//旋转重新计算水平、垂直方向坐标
  var textW=0.707*(textMetrics+oneLineTextHeight);var textH=0.707*(textMetrics+oneLineTextHeight);var hAP=(start_c+4+offsetLeft)*devicePixelRatio;if(horizonAlign=="0"){hAP=(start_c+(end_c-start_c)/2+offsetLeft)*devicePixelRatio-textW/2;}else if(horizonAlign=="2"){hAP=(end_c+offsetLeft-8)*devicePixelRatio-textW;}var vAP=(end_r+offsetTop-2+verticalFixed)*devicePixelRatio-textH;if(verticalAlign=="0"){vAP=(start_r+(end_r-start_r)/2+offsetTop+verticalFixed)*devicePixelRatio-textH/2;}else if(verticalAlign=="1"){vAP=(start_r+offsetTop+verticalFixed)*devicePixelRatio;}//向下倾斜（45 旋转）
  if(tr=="1"){offlinecanvas.save();offlinecanvas.translate(hAP,vAP);offlinecanvas.rotate(45*Math.PI/180);offlinecanvas.translate(-hAP,-vAP);offlinecanvas.fillText(value==null?"":value,hAP+0.707*0.707*oneLineTextHeight,vAP-0.707*0.707*oneLineTextHeight);offlinecanvas.restore();//是否有删除线
  var cl=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"cl");if(cl=="1"&&!!value){offlinecanvas.beginPath();offlinecanvas.moveTo(hAP+oneLineTextHeight/2,vAP+oneLineTextHeight/2);offlinecanvas.lineTo(hAP+textW-oneLineTextHeight/2,vAP+textH-oneLineTextHeight/2);offlinecanvas.closePath();offlinecanvas.stroke();}}//向上倾斜（-45 旋转）
  if(tr=="2"){offlinecanvas.save();offlinecanvas.translate(hAP+textW,vAP);offlinecanvas.rotate(-45*Math.PI/180);offlinecanvas.translate(-(hAP+textW),-vAP);offlinecanvas.fillText(value==null?"":value,hAP-0.707*0.707*oneLineTextHeight,vAP-0.707*0.707*oneLineTextHeight);offlinecanvas.restore();//是否有删除线
  var cl=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"cl");if(cl=="1"&&!!value){offlinecanvas.beginPath();offlinecanvas.moveTo(hAP+oneLineTextHeight/2,vAP+textH-oneLineTextHeight/2);offlinecanvas.lineTo(hAP+textW-oneLineTextHeight/2,vAP+oneLineTextHeight/2);offlinecanvas.closePath();offlinecanvas.stroke();}}}else if(tr=="3"){if(!!value){value=value.toString();if(value.length>1){var vArr=value.split("");}else {var vArr=[];vArr.push(value);}var textW=offlinecanvas.measureText(vArr[0]).width;var textH=vArr.length*oneLineTextHeight;for(var i=0;i<vArr.length;i++){var vWidth=offlinecanvas.measureText(vArr[i]).width;//水平对齐计算
  if(horizonAlign=="0"){horizonAlignPos=(start_c+(end_c-start_c)/2+offsetLeft)*devicePixelRatio-vWidth/2;}else if(horizonAlign=="2"){horizonAlignPos=(end_c+offsetLeft-8)*devicePixelRatio-vWidth;}else {horizonAlignPos=(start_c+4+offsetLeft)*devicePixelRatio;}//垂直对齐计算
  if(verticalAlign=="0"){verticalAlignPos=(start_r+(end_r-start_r)/2+offsetTop+verticalFixed)*devicePixelRatio-oneLineTextHeight*vArr.length/2;}else if(verticalAlign=="1"){verticalAlignPos=(start_r+offsetTop+verticalFixed)*devicePixelRatio;}else {verticalAlignPos=(end_r+offsetTop-2+verticalFixed)*devicePixelRatio-oneLineTextHeight*vArr.length;}offlinecanvas.fillText(vArr[i],horizonAlignPos,verticalAlignPos+i*oneLineTextHeight);}//是否有删除线
  var cl=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"cl");if(cl=="1"&&!!value){offlinecanvas.beginPath();offlinecanvas.moveTo(horizonAlignPos+textW/2,verticalAlignPos);offlinecanvas.lineTo(horizonAlignPos+textW/2,verticalAlignPos+textH);offlinecanvas.closePath();offlinecanvas.stroke();}}}else if(tr=="4"||tr=="5"){//旋转重新计算水平、垂直方向坐标
  var textW=oneLineTextHeight;var textH=textMetrics;var hAP=(start_c+4+offsetLeft)*devicePixelRatio;if(horizonAlign=="0"){hAP=(start_c+(end_c-start_c)/2+offsetLeft)*devicePixelRatio-textW/2;}else if(horizonAlign=="2"){hAP=(end_c+offsetLeft-8)*devicePixelRatio-textW;}var vAP=(end_r+offsetTop-2+verticalFixed)*devicePixelRatio-textH;if(verticalAlign=="0"){vAP=(start_r+(end_r-start_r)/2+offsetTop+verticalFixed)*devicePixelRatio-textH/2;}else if(verticalAlign=="1"){vAP=(start_r+offsetTop+verticalFixed)*devicePixelRatio;}//向下90（90 旋转）
  if(tr=="4"){offlinecanvas.save();offlinecanvas.translate(hAP,vAP);offlinecanvas.rotate(90*Math.PI/180);offlinecanvas.translate(-hAP,-vAP);offlinecanvas.fillText(value==null?"":value,hAP,vAP-textW);offlinecanvas.restore();//是否有删除线
  var cl=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"cl");if(cl=="1"&&!!value){offlinecanvas.beginPath();offlinecanvas.moveTo(hAP+textW/2,vAP);offlinecanvas.lineTo(hAP+textW/2,vAP+textH);offlinecanvas.closePath();offlinecanvas.stroke();}}//向上90（-90 旋转）
  if(tr=="5"){offlinecanvas.save();offlinecanvas.translate(hAP+textH,vAP);offlinecanvas.rotate(-90*Math.PI/180);offlinecanvas.translate(-(hAP+textH),-vAP);offlinecanvas.fillText(value==null?"":value,hAP,vAP-textH);offlinecanvas.restore();//是否有删除线
  var cl=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"cl");if(cl=="1"&&!!value){offlinecanvas.beginPath();offlinecanvas.moveTo(hAP+textW/2,vAP);offlinecanvas.lineTo(hAP+textW/2,vAP+textH);offlinecanvas.closePath();offlinecanvas.stroke();}}}}else {//是否有删除线
  var cl=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"cl");if(cl=="1"&&!!value){luckysheetTableContent.strokeStyle="#000000";offlinecanvas.beginPath();offlinecanvas.moveTo(horizonAlignPos,verticalAlignPos+oneLineTextHeight/2);offlinecanvas.lineTo(horizonAlignPos+textMetrics,verticalAlignPos+oneLineTextHeight/2);offlinecanvas.closePath();offlinecanvas.stroke();offlinecanvas.textBaseline="middle";offlinecanvas.fillText(value==null?"":value,horizonAlignPos,verticalAlignPos+oneLineTextHeight/2);}else {offlinecanvas.textBaseline="top";offlinecanvas.fillText(value==null?"":value,horizonAlignPos,verticalAlignPos);}}offlinecanvas.font=luckysheetdefaultstyle.font;//var imgData= offlinecanvas.getImageData(cellsize[0], cellsize[1], cellsize[2], cellsize[3]);
  //console.log(cellsize[0], cellsize[1], cellsize[2], cellsize[3], horizonAlignPos, verticalAlignPos);
  // luckysheetTableContent.imageSmoothingEnabled = false;
  // luckysheetTableContent.mozImageSmoothingEnabled = false;
  // luckysheetTableContent.webkitImageSmoothingEnabled = false;
  // luckysheetTableContent.msImageSmoothingEnabled = false;
  // luckysheetTableContent.oImageSmoothingEnabled = false;
  luckysheetTableContent.drawImage($("#luckysheetTableContentF").get(0),cellsize[0],cellsize[1],cellsize[2],cellsize[3],cellsize[0],cellsize[1],cellsize[2],cellsize[3]);// luckysheetTableContent.imageSmoothingEnabled = true;
  // luckysheetTableContent.mozImageSmoothingEnabled = true;
  // luckysheetTableContent.webkitImageSmoothingEnabled = true;
  // luckysheetTableContent.msImageSmoothingEnabled = true;
  // luckysheetTableContent.oImageSmoothingEnabled = true;
  //luckysheetTableContent.drawImage($("#luckysheetTableContentF").get(0), start_c - 1 + offsetLeft+borderfix[0], start_r + offsetTop+borderfix[1], end_c - start_c -2+borderfix[2], end_r - start_r-3+borderfix[3], start_c - 1 + offsetLeft+borderfix[0], start_r + offsetTop+borderfix[1], end_c - start_c -2+borderfix[2], end_r - start_r-3+borderfix[3]);
  // luckysheetTableContent.fillStyle= "#fff";
  // var clearNextCellLen = defaultcollen;
  // if (config["columlen"] != null && config["columlen"][ec +1] != null) {
  //     clearNextCellLen = config["columlen"][ec+1];
  // }
  // luckysheetTableContent.fillRect(end_ec - 3 + offsetLeft, start_r + offsetTop, clearNextCellLen, end_r - 2 -start_r-1);
  var bs=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"bs");var bc=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"bc");var bs_t=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"bs_t");var bc_t=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"bc_t");var bs_b=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"bs_b");var bc_b=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"bc_b");var bs_l=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"bs_l");var bc_l=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"bc_l");var bs_r=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"bs_r");var bc_r=luckysheet.menuButton.checkstatus(luckysheet.flowdata,r,c,"bc_r");//左边框
  //console.log(r, c , value, bs_l, bc_l);
  if(bs_l!="none"||bs!="none"){var linetype=bs_l=="none"?bs:bs_l;luckysheet.menuButton.setLineDash(luckysheetTableContent,linetype,"v",devicePixelRatio*(start_c-2+0.5+offsetLeft),devicePixelRatio*(start_r+offsetTop),devicePixelRatio*(start_c-2+0.5+offsetLeft),devicePixelRatio*(end_r-2+offsetTop));// luckysheetTableContent.beginPath();
  // luckysheetTableContent.moveTo(start_c - 2 + offsetLeft, start_r + offsetTop);
  // luckysheetTableContent.lineTo(start_c - 2 + offsetLeft, end_r - 2 + offsetTop);
  // luckysheetTableContent.lineWidth = 1;
  luckysheetTableContent.strokeStyle=bs_l=="none"?bc:bc_l;luckysheetTableContent.stroke();luckysheetTableContent.closePath();}// else{
  //     luckysheetTableContent.beginPath();
  //     luckysheetTableContent.moveTo(devicePixelRatio*(start_c - 2+ 0.5 + offsetLeft), devicePixelRatio*(start_r + offsetTop));
  //     luckysheetTableContent.lineTo(devicePixelRatio*(start_c - 2+ 0.5 + offsetLeft), devicePixelRatio*(end_r - 2 + offsetTop));
  //     luckysheetTableContent.lineWidth = devicePixelRatio;
  //     if (!!luckysheetcurrentisPivotTable && !luckysheet.pivotTable.drawPivotTable) {
  //         luckysheetTableContent.strokeStyle = "#000000";
  //     }
  //     else{
  //         luckysheetTableContent.strokeStyle = luckysheetdefaultstyle.strokeStyle;
  //     }
  //     luckysheetTableContent.stroke();
  //     luckysheetTableContent.closePath();
  // }
  // //右边框
  if(bs_r!="none"||bs!="none"){//console.log(11112222);
  var linetype=bs_r=="none"?bs:bs_r;luckysheet.menuButton.setLineDash(luckysheetTableContent,linetype,"v",devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(start_r+offsetTop),devicePixelRatio*(end_c-2+0.5+offsetLeft),devicePixelRatio*(end_r-2+offsetTop));// luckysheetTableContent.beginPath();
  // luckysheetTableContent.moveTo(end_c - 2 + offsetLeft, start_r + offsetTop);
  // luckysheetTableContent.lineTo(end_c - 2 + offsetLeft, end_r - 2 + offsetTop);
  // luckysheetTableContent.lineWidth = devicePixelRatio;
  luckysheetTableContent.strokeStyle=bs_r=="none"?bc:bc_r;luckysheetTableContent.stroke();luckysheetTableContent.closePath();}// else {
  //     luckysheetTableContent.beginPath();
  //     luckysheetTableContent.moveTo(end_c - 2 + offsetLeft, start_r + offsetTop);
  //     luckysheetTableContent.lineTo(end_c - 2 + offsetLeft, end_r - 2 + offsetTop);
  //     luckysheetTableContent.lineWidth = devicePixelRatio;
  //     luckysheetTableContent.strokeStyle = luckysheetdefaultstyle.strokeStyle;
  //     luckysheetTableContent.stroke();
  //     luckysheetTableContent.closePath();
  // }
  //下边框
  if(bs_b!="none"||bs!="none"){//console.log(11112222);
  var linetype=bs_b=="none"?bs:bs_b;luckysheet.menuButton.setLineDash(luckysheetTableContent,linetype,"h",devicePixelRatio*(start_c-2+offsetLeft),devicePixelRatio*(end_r-2+0.5+offsetTop),devicePixelRatio*(end_c+offsetLeft-2),devicePixelRatio*(end_r-2+0.5+offsetTop));// luckysheetTableContent.beginPath();
  // luckysheetTableContent.moveTo(start_c - 2 + offsetLeft, end_r - 2 + offsetTop);
  // luckysheetTableContent.lineTo(end_c + offsetLeft-2, end_r - 2 + offsetTop);
  // luckysheetTableContent.lineWidth = devicePixelRatio;
  luckysheetTableContent.strokeStyle=bs_b=="none"?bc:bc_b;luckysheetTableContent.stroke();luckysheetTableContent.closePath();}// else{
  //     luckysheetTableContent.beginPath();
  //     luckysheetTableContent.moveTo(devicePixelRatio*(start_c - 2 + offsetLeft), devicePixelRatio*(end_r - 2 + 0.5 + offsetTop));
  //     luckysheetTableContent.lineTo(devicePixelRatio*(end_c + offsetLeft-2), devicePixelRatio*(end_r - 2 + 0.5 + offsetTop));
  //     luckysheetTableContent.lineWidth = devicePixelRatio;
  //     if (!!luckysheetcurrentisPivotTable && !luckysheet.pivotTable.drawPivotTable) {
  //         luckysheetTableContent.strokeStyle = "#000000";
  //     }
  //     else{
  //         luckysheetTableContent.strokeStyle = luckysheetdefaultstyle.strokeStyle;
  //     }
  //     luckysheetTableContent.stroke();
  //     luckysheetTableContent.closePath();
  // }
  //上边框
  if(bs_t!="none"||bs!="none"){//console.log(11112222);
  var linetype=bs_t=="none"?bs:bs_t;luckysheet.menuButton.setLineDash(luckysheetTableContent,linetype,"h",devicePixelRatio*(start_c-2+offsetLeft),devicePixelRatio*(start_r-1+0.5+offsetTop),devicePixelRatio*(end_c+offsetLeft-2),devicePixelRatio*(start_r-1+0.5+offsetTop));// luckysheetTableContent.beginPath();
  // luckysheetTableContent.moveTo(start_c - 2 + offsetLeft, start_r - 1 + offsetTop);
  // luckysheetTableContent.lineTo(end_c + offsetLeft-2, start_r - 1 + offsetTop);
  // luckysheetTableContent.lineWidth = devicePixelRatio;
  luckysheetTableContent.strokeStyle=bs_t=="none"?bc:bc_t;luckysheetTableContent.stroke();luckysheetTableContent.closePath();}//补全缺失的上边框
  // var startlist = item.startlist;
  // //console.log(startlist);
  // for(var i = 0;i<startlist.length;i++){
  //     luckysheetTableContent.beginPath();
  //     luckysheetTableContent.moveTo(end_c + offsetLeft-2, startlist[i] - 1 + offsetTop);
  //     luckysheetTableContent.lineTo(end_c + offsetLeft+ clearNextCellLen, startlist[i] - 1 + offsetTop);
  //     luckysheetTableContent.lineWidth = devicePixelRatio;
  //     luckysheetTableContent.strokeStyle = luckysheetdefaultstyle.strokeStyle;
  //     luckysheetTableContent.stroke();
  //     luckysheetTableContent.closePath();
  // }
  }////竖线
  //luckysheetTableContent.beginPath();
  //luckysheetTableContent.moveTo(offsetLeft - 2 , -0.5);
  //luckysheetTableContent.lineTo(offsetLeft - 2 ,rh_height + offsetTop);
  //luckysheetTableContent.lineWidth = devicePixelRatio;
  //luckysheetTableContent.strokeStyle = luckysheetdefaultstyle.strokeStyle;
  //luckysheetTableContent.closePath();
  //luckysheetTableContent.stroke();
  ////横线
  //luckysheetTableContent.beginPath();
  //luckysheetTableContent.moveTo(-0.5,  -2 + offsetTop);
  //luckysheetTableContent.lineTo(ch_width + offsetLeft, -2 + offsetTop);
  //luckysheetTableContent.lineWidth = devicePixelRatio;
  //luckysheetTableContent.strokeStyle = luckysheetdefaultstyle.strokeStyle;
  //luckysheetTableContent.closePath();
  //luckysheetTableContent.stroke();
  //luckysheetTableContent.clearRect(0, 0, offsetLeft - 2, offsetTop - 2);
  //luckysheetTableContent.clearRect(drawWidth > (ch_width + offsetLeft) ? (ch_width + offsetLeft - 2) : drawWidth - 2 + offsetLeft, offsetTop, drawWidth, drawHeight);
  }luckysheet.luckysheetcreatedom=function(colwidth,rowheight,data,menu,title){if(!luckysheetConfigsetting.pointEdit){//最少30行
  if(rowheight<30){rowheight=30;}//最少22列
  if(colwidth<22){colwidth=22;}}var gh=gridHTML;gh=luckysheet.replaceHtml(gh,{"logotitle":title});//设置title
  gh=luckysheet.replaceHtml(gh,{"menu":menuToolBar});//设置需要显示的菜单
  if(data.length==0){luckysheet.flowdata=luckysheet.datagridgrowth(data,rowheight,colwidth);}else if(data.length<rowheight&&data[0].length<colwidth){luckysheet.flowdata=luckysheet.datagridgrowth(data,rowheight-data.length,colwidth-data[0].length);}else if(data.length<rowheight){luckysheet.flowdata=luckysheet.datagridgrowth(data,rowheight-data.length,0);}else if(data[0].length<colwidth){luckysheet.flowdata=luckysheet.datagridgrowth(data,0,colwidth-data[0].length);}else {luckysheet.flowdata=data;}luckysheet.editor.webWorkerFlowDataCache(luckysheet.flowdata);//worker存数据
  var flowHTML=flow;if(config==null){config={};}//列宽重置
  visibledatacolumn=[];ch_width=0;for(var i=0;i<colwidth;i++){var firstcolumlen=defaultcollen;if(config["columlen"]!=null&&config["columlen"][i]!=null){firstcolumlen=config["columlen"][i];}else {if(data[0]!=null&&data[0][i]!=null){firstcolumlen=Math.ceil(luckysheet.getByteLen(data[0][i].v)*11.5);if(firstcolumlen>300){firstcolumlen=300;}else if(firstcolumlen<defaultcollen){firstcolumlen=defaultcollen;}if(firstcolumlen!=defaultcollen){if(config["columlen"]==null){config["columlen"]={};}config["columlen"][i]=firstcolumlen;}}}ch_width+=firstcolumlen+1;visibledatacolumn.push(ch_width);//列的临时长度分布
  }//行高重置
  visibledatarow=[];rh_height=0;for(var i=0;i<rowheight;i++){var rowlen=defaultrowlen;if(config["rowlen"]!=null&&config["rowlen"][i]!=null){rowlen=config["rowlen"][i];}if(config["rowhidden"]!=null&&config["rowhidden"][i]!=null){rowlen=config["rowhidden"][i];visibledatarow.push(rh_height);continue;}else {rh_height+=rowlen+1;}visibledatarow.push(rh_height);//行的临时长度分布
  }if(!luckysheetConfigsetting.pointEdit){//非编辑器表格编辑状态
  rh_height+=110;ch_width+=120;var addControll='<button id="luckysheet-bottom-add-row" class="btn btn-default">添加</button><input id="luckysheet-bottom-add-row-input" type="text" class="luckysheet-datavisual-config-input luckysheet-mousedown-cancel" placeholder="100"><span style="font-size: 14px;">行</span><span style="font-size: 14px;color: #9c9c9c;">(在底部添加)</span>';var backControll=' <button id="luckysheet-bottom-bottom-top" class="btn btn-default" style="">回到顶部</button>';// var pageControll = ' <span id="luckysheet-bottom-page-info" style="font-size: 14px;color: #f34141;">共'+ luckysheetConfigsetting.pageInfo.totalPage +'页，当前已显示'+ (luckysheetConfigsetting.pageInfo.currentPage) +'页，每页'+ luckysheetConfigsetting.pageInfo.pageSize +'条</span> <button id="luckysheet-bottom-page-next" class="btn btn-danger" style="">下一页</button>';
  var pageControll=' <span id="luckysheet-bottom-page-info" style="font-size: 14px;color: #f34141;">共'+luckysheetConfigsetting.total+'条，'+luckysheetConfigsetting.pageInfo.totalPage+'页，当前已显示'+luckysheetConfigsetting.pageInfo.currentPage+'页</span> <button id="luckysheet-bottom-page-next" class="btn btn-danger" style="">下一页</button>';var pageControll2=' <span id="luckysheet-bottom-page-info" style="font-size: 14px;color: #f34141;">共'+luckysheetConfigsetting.total+'条，'+luckysheetConfigsetting.pageInfo.totalPage+'页，当前已显示'+luckysheetConfigsetting.pageInfo.currentPage+'页</span>';var bottomControll="";if(luckysheetConfigsetting.enableAddRow){bottomControll+=addControll;}if(luckysheetConfigsetting.enablePage){if(parseInt(luckysheetConfigsetting.pageInfo.totalPage)==1){bottomControll+=pageControll2;}else {bottomControll+=pageControll;}}bottomControll+=backControll;var flowstr=luckysheet.replaceHtml('<div id="luckysheetcoltable_0" class="luckysheet-cell-flow-col"> <div id ="luckysheet-sheettable_0" class="luckysheet-cell-sheettable" style="height:${height}px;width:${width}px;"></div><div id="luckysheet-bottom-controll-row" class="luckysheet-bottom-controll-row"> '+bottomControll+' </div> </div>',{"height":rh_height,"width":ch_width-1});}var colsheader=luckysheet.replaceHtml(columnHeaderHTML,{"width":ch_width,"index":0,"column":""});flowHTML=luckysheet.replaceHtml(flowHTML,{"width":ch_width,"flow":flowstr,"index":0});gh=luckysheet.replaceHtml(gh,{"flow":flowHTML,"rowHeader":"<div style='height:"+rh_height+"px' id='luckysheetrowHeader_0' class='luckysheetsheetchange'></div>","columnHeader":colsheader,"functionButton":luckysheetConfigsetting.functionButton});//设置需要显示的菜单
  $("#"+container).append(gh);$("#luckysheet-scrollbar-x div").width(ch_width);$("#luckysheet-scrollbar-y div").height(rh_height-30);//新建行菜单
  $("body").append(maskHTML);$("body").append(colsmenuHTML);$("body").append(rightclickHTML);$("body").append(inputHTML);$("body").append(luckysheet.replaceHtml(filtermenuHTML,{"menuid":"filter"}));$("body").append(luckysheet.replaceHtml(filtersubmenuHTML,{"menuid":"filter"}));$("body").append(sheetconfigHTML);//批注
  luckysheet.postil.buildAllPs(luckysheet.flowdata);};(function(){var createClass=function createClass()/* [baseclass, [mixin, ...]], definition */{var Class,args;Class=function Class(){this.init.apply(this,arguments);};if(arguments.length>1){if(arguments[0]){Class.prototype=$.extend(new arguments[0](),arguments[arguments.length-1]);Class._super=arguments[0].prototype;}else {Class.prototype=arguments[arguments.length-1];}if(arguments.length>2){args=Array.prototype.slice.call(arguments,1,-1);args.unshift(Class.prototype);$.extend.apply($,args);}}else {Class.prototype=arguments[0];}Class.prototype.cls=Class;return Class;};/**
           * Wraps a format string for tooltips
           * {{x}}
           * {{x.2}
           * {{x:months}}
           */var SPFormat=createClass({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function init(format,fclass){this.format=format;this.fclass=fclass;},render:function render(fieldset,lookups,options){var self=this,fields=fieldset,match,token,lookupkey,fieldvalue,prec;return this.format.replace(this.fre,function(){var lookup;token=arguments[1];lookupkey=arguments[3];match=self.precre.exec(token);if(match){prec=match[2];token=match[1];}else {prec=false;}fieldvalue=fields[token];if(fieldvalue===undefined){return '';}if(lookupkey&&lookups&&lookups[lookupkey]){lookup=lookups[lookupkey];if(lookup.get){// RangeMap
  return lookups[lookupkey].get(fieldvalue)||fieldvalue;}else {return lookups[lookupkey][fieldvalue]||fieldvalue;}}if(isNumber(fieldvalue)){if(options.get('numberFormatter')){fieldvalue=options.get('numberFormatter')(fieldvalue);}else {fieldvalue=formatNumber(fieldvalue,prec,options.get('numberDigitGroupCount'),options.get('numberDigitGroupSep'),options.get('numberDecimalMark'));}}return fieldvalue;});}});// convience method to avoid needing the new operator
  $.spformat=function(format,fclass){return new SPFormat(format,fclass);};var clipval=function clipval(val,min,max){if(val<min){return min;}if(val>max){return max;}return val;};var quartile=function quartile(values,q){var vl;if(q===2){vl=Math.floor(values.length/2);return values.length%2?values[vl]:(values[vl-1]+values[vl])/2;}else {if(values.length%2){// odd
  vl=(values.length*q+q)/4;return vl%1?(values[Math.floor(vl)]+values[Math.floor(vl)-1])/2:values[vl-1];}else {//even
  vl=(values.length*q+2)/4;return vl%1?(values[Math.floor(vl)]+values[Math.floor(vl)-1])/2:values[vl-1];}}};var normalizeValue=function normalizeValue(val){var nf;switch(val){case'undefined':val=undefined;break;case'null':val=null;break;case'true':val=true;break;case'false':val=false;break;default:nf=parseFloat(val);if(val==nf){val=nf;}}return val;};var normalizeValues=function normalizeValues(vals){var i,result=[];for(i=vals.length;i--;){result[i]=normalizeValue(vals[i]);}return result;};var all=function all(val,arr,ignoreNull){var i;for(i=arr.length;i--;){if(ignoreNull&&arr[i]===null)continue;if(arr[i]!==val){return false;}}return true;};// sums the numeric values in an array, ignoring other values
  var remove=function remove(vals,filter){var i,vl,result=[];for(i=0,vl=vals.length;i<vl;i++){if(vals[i]!==filter){result.push(vals[i]);}}return result;};var isNumber=function isNumber(num){return !isNaN(parseFloat(num))&&isFinite(num);};var formatNumber=function formatNumber(num,prec,groupsize,groupsep,decsep){var p,i;num=(prec===false?parseFloat(num).toString():num.toFixed(prec)).split('');p=(p=$.inArray('.',num))<0?num.length:p;if(p<num.length){num[p]=decsep;}for(i=p-groupsize;i>0;i-=groupsize){num.splice(i,0,groupsep);}return num.join('');};var RangeMap=createClass({init:function init(map){var key,range,rangelist=[];for(key in map){if(map.hasOwnProperty(key)&&typeof key==='string'&&key.indexOf(':')>-1){range=key.split(':');range[0]=range[0].length===0?-Infinity:parseFloat(range[0]);range[1]=range[1].length===0?Infinity:parseFloat(range[1]);range[2]=map[key];rangelist.push(range);}}this.map=map;this.rangelist=rangelist||false;},get:function get(value){var rangelist=this.rangelist,i,range,result;if((result=this.map[value])!==undefined){return result;}if(rangelist){for(i=rangelist.length;i--;){range=rangelist[i];if(range[0]<=value&&range[1]>=value){return range[2];}}}return undefined;}});// Convenience function
  $.range_map=function(map){return new RangeMap(map);};luckysheet.sparkline={defaultOption:{// Settings common to most/all chart types
  common:{type:'line',lineColor:'#2ec7c9',fillColor:'#CCF3F4',defaultPixelsPerValue:3,width:'auto',height:'auto',composite:false,tagValuesAttribute:'values',tagOptionsPrefix:'spark',enableTagOptions:false,enableHighlight:true,highlightLighten:1.4,tooltipSkipNull:true,tooltipPrefix:'',tooltipSuffix:'',disableHiddenCheck:false,numberFormatter:false,numberDigitGroupCount:3,numberDigitGroupSep:',',numberDecimalMark:'.',disableTooltips:true,disableInteraction:true,offsetX:0,offsetY:0},// Defaults for line charts
  //=LINESPL
  line:{spotColor:0,highlightSpotColor:'#5f5',highlightLineColor:'#f22',spotRadius:1.5,minSpotColor:0,maxSpotColor:0,lineWidth:1,normalRangeMin:undefined,normalRangeMax:undefined,normalRangeColor:'#ccc',drawNormalOnTop:true,chartRangeMin:undefined,chartRangeMax:undefined,chartRangeMinX:undefined,chartRangeMaxX:undefined// tooltipFormat: new SPFormat('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')
  },// Defaults for bar charts
  bar:{barColor:'#fc5c5c',negBarColor:'#97b552',stackedBarColor:["#2ec7c9","#fc5c5c","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],zeroColor:undefined,nullColor:undefined,zeroAxis:true,barWidth:4,barSpacing:1,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:false,colorMap:undefined// tooltipFormat: new SPFormat('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')
  },column:{barColor:'#fc5c5c',negBarColor:'#97b552',stackedBarColor:["#2ec7c9","#fc5c5c","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],zeroColor:undefined,nullColor:undefined,zeroAxis:true,barWidth:4,barSpacing:1,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:false,colorMap:undefined// tooltipFormat: new SPFormat('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')
  },// Defaults for tristate charts
  tristate:{barWidth:4,barSpacing:1,posBarColor:'#fc5c5c',negBarColor:'#97b552',zeroBarColor:'#999',colorMap:{}// tooltipFormat: new SPFormat('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),
  // tooltipValueLookups: { map: { '-1': 'Loss', '0': 'Draw', '1': 'Win' } }
  },// Defaults for discrete charts
  discrete:{lineHeight:'auto',thresholdColor:"#fc5c5c",thresholdValue:0,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:false// tooltipFormat: new SPFormat('{{prefix}}{{value}}{{suffix}}')
  },// Defaults for bullet charts
  bullet:{targetColor:'#f33',targetWidth:3,// width of the target bar in pixels
  performanceColor:'#33f',rangeColors:['#d3dafe','#a8b6ff','#7f94ff','#6D87FF','#5876FF','#4465FF','#2F54FF','#1A43FF','#0532FF'],base:undefined// set this to a number to change the base start number
  // tooltipFormat: new SPFormat('{{fieldkey:fields}} - {{value}}'),
  // tooltipValueLookups: { fields: {r: 'Range', p: 'Performance', t: 'Target'} }
  },// Defaults for pie charts
  pie:{offset:0,sliceColors:["#2ec7c9","#fc5c5c","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],borderWidth:0,borderColor:'#000'// tooltipFormat: new SPFormat('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')
  },// Defaults for box plots
  box:{raw:false,boxLineColor:'#000',boxFillColor:'#cdf',whiskerColor:'#000',outlierLineColor:'#5E5E5E',outlierFillColor:'#fff',medianColor:'#f00',showOutliers:true,outlierIQR:1.5,spotRadius:1.5,target:undefined,targetColor:'#4a2',chartRangeMax:undefined,chartRangeMin:undefined// tooltipFormat: new SPFormat('{{field:fields}}: {{value}}'),
  // tooltipFormatFieldlistKey: 'field',
  // tooltipValueLookups: { fields: { lq: 'Lower Quartile', med: 'Median',
  //     uq: 'Upper Quartile', lo: 'Left Outlier', ro: 'Right Outlier',
  //     lw: 'Left Whisker', rw: 'Right Whisker'} }
  }},line:{type:'line',init:function init(el,values,options,width,height){//line._super.init.call(this, el, values, options, width, height);
  this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues=[];this.yminmax=[];this.hightlightSpotId=null;this.lastShapeId=null;//this.initTarget();
  },getRegion:function getRegion(el,x,y){var i,regionMap=this.regionMap;// maps regions to value positions
  for(i=regionMap.length;i--;){if(regionMap[i]!==null&&x>=regionMap[i][0]&&x<=regionMap[i][1]){return regionMap[i][2];}}return undefined;},getCurrentRegionFields:function getCurrentRegionFields(){var currentRegion=this.currentRegion;return {isNull:this.yvalues[currentRegion]===null,x:this.xvalues[currentRegion],y:this.yvalues[currentRegion],color:this.options.get('lineColor'),fillColor:this.options.get('fillColor'),offset:currentRegion};},renderHighlight:function renderHighlight(){var currentRegion=this.currentRegion,target=this.target,vertex=this.vertices[currentRegion],options=this.options,spotRadius=options.get('spotRadius'),highlightSpotColor=options.get('highlightSpotColor'),highlightLineColor=options.get('highlightLineColor'),highlightSpot,highlightLine;if(!vertex){return;}if(spotRadius&&highlightSpotColor){highlightSpot=target.drawCircle(vertex[0],vertex[1],spotRadius,undefined,highlightSpotColor);this.highlightSpotId=highlightSpot.id;target.insertAfterShape(this.lastShapeId,highlightSpot);}if(highlightLineColor){highlightLine=target.drawLine(vertex[0],this.canvasTop,vertex[0],this.canvasTop+this.canvasHeight,highlightLineColor);this.highlightLineId=highlightLine.id;target.insertAfterShape(this.lastShapeId,highlightLine);}},removeHighlight:function removeHighlight(){var target=this.target;if(this.highlightSpotId){target.removeShapeId(this.highlightSpotId);this.highlightSpotId=null;}if(this.highlightLineId){target.removeShapeId(this.highlightLineId);this.highlightLineId=null;}},scanValues:function scanValues(){var values=this.values,valcount=values.length,xvalues=this.xvalues,yvalues=this.yvalues,yminmax=this.yminmax,i,val,isStr,isArray,sp;for(i=0;i<valcount;i++){val=values[i];isStr=typeof values[i]==='string';isArray=_typeof(values[i])==='object'&&values[i]instanceof Array;sp=isStr&&values[i].split(':');if(isStr&&sp.length===2){// x:y
  xvalues.push(Number(sp[0]));yvalues.push(Number(sp[1]));yminmax.push(Number(sp[1]));}else if(isArray){xvalues.push(val[0]);yvalues.push(val[1]);yminmax.push(val[1]);}else {xvalues.push(i);if(values[i]===null||values[i]==='null'){yvalues.push(null);}else {yvalues.push(Number(val));yminmax.push(Number(val));}}}if(this.options.get('xvalues')){xvalues=this.options.get('xvalues');}this.maxy=this.maxyorg=Math.max.apply(Math,yminmax);this.miny=this.minyorg=Math.min.apply(Math,yminmax);this.maxx=Math.max.apply(Math,xvalues);this.minx=Math.min.apply(Math,xvalues);this.xvalues=xvalues;this.yvalues=yvalues;this.yminmax=yminmax;},processRangeOptions:function processRangeOptions(){var options=this.options,normalRangeMin=options.get('normalRangeMin'),normalRangeMax=options.get('normalRangeMax');if(normalRangeMin!==undefined){if(normalRangeMin<this.miny){this.miny=normalRangeMin;}if(normalRangeMax>this.maxy){this.maxy=normalRangeMax;}}if(options.get('chartRangeMin')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMin')<this.miny)){this.miny=options.get('chartRangeMin');}if(options.get('chartRangeMax')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMax')>this.maxy)){this.maxy=options.get('chartRangeMax');}if(options.get('chartRangeMinX')!==undefined&&(options.get('chartRangeClipX')||options.get('chartRangeMinX')<this.minx)){this.minx=options.get('chartRangeMinX');}if(options.get('chartRangeMaxX')!==undefined&&(options.get('chartRangeClipX')||options.get('chartRangeMaxX')>this.maxx)){this.maxx=options.get('chartRangeMaxX');}},drawNormalRange:function drawNormalRange(canvasLeft,canvasTop,canvasHeight,canvasWidth,rangey){var normalRangeMin=this.options.get('normalRangeMin'),normalRangeMax=this.options.get('normalRangeMax'),ytop=canvasTop+Math.round(canvasHeight-canvasHeight*((normalRangeMax-this.miny)/rangey)),height=Math.round(canvasHeight*(normalRangeMax-normalRangeMin)/rangey);//(x1, y1, x2, y2, lineColor, lineWidth)
  if(height==0&&normalRangeMin==normalRangeMax){height=1;}this.target.drawRect(canvasLeft,ytop,canvasWidth,height,undefined,this.options.get('normalRangeColor')).append();},render:function render(el,userValues){this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues=[];this.yminmax=[];this.hightlightSpotId=null;this.lastShapeId=null;this.values=userValues;var options=this.options,target=this.target,canvasWidth=el.mergedOptions.width,canvasHeight=el.mergedOptions.height,vertices=this.vertices,spotRadius=options.get('spotRadius'),regionMap=this.regionMap,rangex,rangey,yvallast,canvasTop,canvasLeft,vertex,path,paths,x,y,xnext,xpos,xposnext,last,next,yvalcount,lineShapes,fillShapes,plen,valueSpots,hlSpotsEnabled,color,xvalues,yvalues,i;// if (!line._super.render.call(this)) {
  //     return;
  // }
  this.scanValues();this.processRangeOptions();xvalues=this.xvalues;yvalues=this.yvalues;if(!this.yminmax.length||this.yvalues.length<2){// empty or all null valuess
  return;}canvasTop=canvasLeft=0;rangex=this.maxx-this.minx===0?1:this.maxx-this.minx;rangey=this.maxy-this.miny===0?1:this.maxy-this.miny;yvallast=this.yvalues.length-1;if(spotRadius&&(canvasWidth<spotRadius*4||canvasHeight<spotRadius*4)){spotRadius=0;}if(spotRadius){// adjust the canvas size as required so that spots will fit
  hlSpotsEnabled=options.get('highlightSpotColor')&&!options.get('disableInteraction');if(hlSpotsEnabled||options.get('minSpotColor')||options.get('spotColor')&&yvalues[yvallast]===this.miny){canvasHeight-=Math.ceil(spotRadius);}if(hlSpotsEnabled||options.get('maxSpotColor')||options.get('spotColor')&&yvalues[yvallast]===this.maxy){canvasHeight-=Math.ceil(spotRadius);canvasTop+=Math.ceil(spotRadius);}if(hlSpotsEnabled||(options.get('minSpotColor')||options.get('maxSpotColor'))&&(yvalues[0]===this.miny||yvalues[0]===this.maxy)){canvasLeft+=Math.ceil(spotRadius);canvasWidth-=Math.ceil(spotRadius);}if(hlSpotsEnabled||options.get('spotColor')||options.get('minSpotColor')||options.get('maxSpotColor')&&(yvalues[yvallast]===this.miny||yvalues[yvallast]===this.maxy)){canvasWidth-=Math.ceil(spotRadius);}}canvasHeight--;if(options.get('normalRangeMin')!==undefined&&!options.get('drawNormalOnTop')){this.drawNormalRange(canvasLeft,canvasTop,canvasHeight,canvasWidth,rangey);}path=[];paths=[path];last=next=null;yvalcount=yvalues.length;for(i=0;i<yvalcount;i++){x=xvalues[i];xnext=xvalues[i+1];y=yvalues[i];xpos=canvasLeft+Math.round((x-this.minx)*(canvasWidth/rangex));xposnext=i<yvalcount-1?canvasLeft+Math.round((xnext-this.minx)*(canvasWidth/rangex)):canvasWidth;next=xpos+(xposnext-xpos)/2;regionMap[i]=[last||0,next,i];last=next;if(y===null){if(i){if(yvalues[i-1]!==null){path=[];paths.push(path);}vertices.push(null);}}else {if(y<this.miny){y=this.miny;}if(y>this.maxy){y=this.maxy;}if(!path.length){// previous value was null
  path.push([xpos,canvasTop+canvasHeight]);}vertex=[xpos,canvasTop+Math.round(canvasHeight-canvasHeight*((y-this.miny)/rangey))];path.push(vertex);vertices.push(vertex);}}lineShapes=[];fillShapes=[];plen=paths.length;for(i=0;i<plen;i++){path=paths[i];if(path.length){if(options.get('fillColor')){path.push([path[path.length-1][0],canvasTop+canvasHeight]);fillShapes.push(path.slice(0));path.pop();}// if there's only a single point in this path, then we want to display it
  // as a vertical line which means we keep path[0]  as is
  if(path.length>2){// else we want the first value
  path[0]=[path[0][0],path[1][1]];}lineShapes.push(path);}}// draw the fill first, then optionally the normal range, then the line on top of that
  plen=fillShapes.length;for(i=0;i<plen;i++){target.drawShape(fillShapes[i],options.get('fillColor'),options.get('fillColor')).append();}plen=lineShapes.length;for(i=0;i<plen;i++){target.drawShape(lineShapes[i],options.get('lineColor'),undefined,options.get('lineWidth')).append();}if(options.get('normalRangeMin')!==undefined&&options.get('drawNormalOnTop')){this.drawNormalRange(canvasLeft,canvasTop,canvasHeight,canvasWidth,rangey);}if(spotRadius&&options.get('valueSpots')){valueSpots=options.get('valueSpots');if(valueSpots.get===undefined){valueSpots=new RangeMap(valueSpots);}for(i=0;i<yvalcount;i++){color=valueSpots.get(yvalues[i]);if(color){target.drawCircle(canvasLeft+Math.round((xvalues[i]-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-canvasHeight*((yvalues[i]-this.miny)/rangey)),spotRadius,undefined,color).append();}}}if(spotRadius&&options.get('spotColor')&&yvalues[yvallast]!==null){target.drawCircle(canvasLeft+Math.round((xvalues[xvalues.length-1]-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-canvasHeight*((yvalues[yvallast]-this.miny)/rangey)),spotRadius,undefined,options.get('spotColor')).append();}if(this.maxy!==this.minyorg){if(spotRadius&&options.get('minSpotColor')){x=xvalues[$.inArray(this.minyorg,yvalues)];target.drawCircle(canvasLeft+Math.round((x-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-canvasHeight*((this.minyorg-this.miny)/rangey)),spotRadius,undefined,options.get('minSpotColor')).append();}if(spotRadius&&options.get('maxSpotColor')){x=xvalues[$.inArray(this.maxyorg,yvalues)];target.drawCircle(canvasLeft+Math.round((x-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-canvasHeight*((this.maxyorg-this.miny)/rangey)),spotRadius,undefined,options.get('maxSpotColor')).append();}}// this.lastShapeId = target.getLastShapeId();
  // this.canvasTop = canvasTop;
  // target.render();
  }},bar:{type:'bar',init:function init(el,values){var options=this.options;var width=el.mergedOptions.height;var height=el.mergedOptions.width;this.canvasWidth=el.mergedOptions.height;this.canvasHeight=el.mergedOptions.width;var barWidth=parseInt(options.get('barWidth'),10),barSpacing=parseInt(options.get('barSpacing'),10),chartRangeMin=options.get('chartRangeMin'),chartRangeMax=options.get('chartRangeMax'),chartRangeClip=options.get('chartRangeClip'),stackMin=Infinity,stackMax=-Infinity,isStackString,groupMin,groupMax,stackRanges,numValues,i,vlen,range,zeroAxis,xaxisOffset,min,max,clipMin,clipMax,stacked,vlist,j,slen,svals,val,yoffset;//bar._super.init.call(this, el, values, options, width, height);
  this.values=values;// scan values to determine whether to stack bars
  for(i=0,vlen=values.length;i<vlen;i++){val=values[i];isStackString=typeof val==='string'&&val.indexOf(':')>-1;if(isStackString||$.isArray(val)){stacked=true;if(isStackString){val=values[i]=normalizeValues(val.split(':'));}val=remove(val,null);// min/max will treat null as zero
  groupMin=Math.min.apply(Math,val);groupMax=Math.max.apply(Math,val);if(groupMin<stackMin){stackMin=groupMin;}if(groupMax>stackMax){stackMax=groupMax;}}}this.stacked=stacked;this.regionShapes={};this.barWidth=Math.floor(width/values.length)-barSpacing;this.barSpacing=barSpacing;this.totalBarWidth=this.barWidth+barSpacing;//this.width = width = (values.length * barWidth) + ((values.length - 1) * barSpacing);
  this.width=width;//this.initTarget();
  if(chartRangeClip){clipMin=chartRangeMin===undefined?-Infinity:chartRangeMin;clipMax=chartRangeMax===undefined?Infinity:chartRangeMax;}numValues=[];stackRanges=stacked?[]:numValues;var stackTotals=[];var stackRangesNeg=[];for(i=0,vlen=values.length;i<vlen;i++){if(stacked){vlist=values[i];values[i]=svals=[];stackTotals[i]=0;stackRanges[i]=stackRangesNeg[i]=0;for(j=0,slen=vlist.length;j<slen;j++){val=svals[j]=chartRangeClip?clipval(vlist[j],clipMin,clipMax):vlist[j];if(val!==null){if(val>0){stackTotals[i]+=val;}if(stackMin<0&&stackMax>0){if(val<0){stackRangesNeg[i]+=Math.abs(val);}else {stackRanges[i]+=val;}}else {stackRanges[i]+=Math.abs(val);// stackRanges[i] += Math.abs(val - (val < 0 ? stackMax : stackMin));
  }numValues.push(val);}}}else {val=chartRangeClip?clipval(values[i],clipMin,clipMax):values[i];val=values[i]=normalizeValue(val);if(val!==null){numValues.push(val);}}}this.max=max=Math.max.apply(Math,numValues);this.min=min=Math.min.apply(Math,numValues);this.stackMax=stackMax=stacked?Math.max.apply(Math,stackTotals):max;this.stackMin=stackMin=stacked?Math.min.apply(Math,numValues):min;if(options.get('chartRangeMin')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMin')<min)){min=options.get('chartRangeMin');}if(options.get('chartRangeMax')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMax')>max)){max=options.get('chartRangeMax');}this.zeroAxis=zeroAxis=options.get('zeroAxis',true);if(min<=0&&max>=0&&zeroAxis){xaxisOffset=0;}else if(zeroAxis==false){xaxisOffset=min;}else if(min>0){xaxisOffset=0;}else {xaxisOffset=max;}this.xaxisOffset=xaxisOffset;range=stacked?Math.max.apply(Math,stackRanges)+Math.max.apply(Math,stackRangesNeg):max-xaxisOffset;// as we plot zero/min values a single pixel line, we add a pixel to all other
  // values - Reduce the effective canvas size to suit
  this.canvasHeightEf=zeroAxis&&min<0?this.canvasHeight-2:this.canvasHeight-1;this.isNeg=false;if(min<xaxisOffset){// yMaxCalc = (stacked && max >= 0) ? stackMax : max;
  // yoffset = (yMaxCalc - xaxisOffset) / range * this.canvasHeight;
  yoffset=Math.floor(this.canvasHeight/2);this.isNeg=true;if(yoffset!==Math.ceil(yoffset)){this.canvasHeightEf-=2;yoffset=Math.ceil(yoffset);}}else {yoffset=0;}this.yoffset=yoffset;if($.isArray(options.get('colorMap'))){this.colorMapByIndex=options.get('colorMap');this.colorMapByValue=null;}else {this.colorMapByIndex=null;this.colorMapByValue=options.get('colorMap');if(this.colorMapByValue&&this.colorMapByValue.get===undefined){this.colorMapByValue=new RangeMap(this.colorMapByValue);}}this.range=range;},getRegion:function getRegion(el,x,y){var result=Math.floor(x/this.totalBarWidth);return result<0||result>=this.values.length?undefined:result;},getCurrentRegionFields:function getCurrentRegionFields(){var currentRegion=this.currentRegion,values=ensureArray(this.values[currentRegion]),result=[],value,i;for(i=values.length;i--;){value=values[i];result.push({isNull:value===null,value:value,color:this.calcColor(i,value,currentRegion),offset:currentRegion});}return result;},calcColor:function calcColor(stacknum,value,valuenum){var colorMapByIndex=this.colorMapByIndex,colorMapByValue=this.colorMapByValue,options=this.options,color,newColor;if(this.stacked){color=options.get('stackedBarColor');}else {color=value<0?options.get('negBarColor'):options.get('barColor');}if(value===0&&options.get('zeroColor')!==undefined){color=options.get('zeroColor');}if(colorMapByValue&&(newColor=colorMapByValue.get(value))){color=newColor;}else if(colorMapByIndex&&colorMapByIndex.length>valuenum){color=colorMapByIndex[valuenum];}return $.isArray(color)?color[stacknum%color.length]:color;},/**
                   * Render bar(s) for a region
                   */renderRegion:function renderRegion(valuenum,highlight){var vals=this.values[valuenum],options=this.options,xaxisOffset=this.xaxisOffset,result=[],range=this.range,stacked=this.stacked,target=this.target,x=valuenum*this.totalBarWidth,canvasHeightEf=this.canvasHeightEf,yoffset=this.yoffset,y,height,color,isNull,yoffsetNeg,i,valcount,val,minPlotted,allMin;vals=$.isArray(vals)?vals:[vals];valcount=vals.length;val=vals[0];isNull=all(null,vals);allMin=all(xaxisOffset,vals,true);if(isNull){if(options.get('nullColor')){color=highlight?options.get('nullColor'):this.calcHighlightColor(options.get('nullColor'),options);y=yoffset>0?yoffset-1:yoffset;return target.drawRect(y,x,0,this.barWidth-1,color,color);}else {return undefined;}}yoffsetNeg=yoffset;if(this.isNeg){canvasHeightEf=Math.floor(canvasHeightEf/2);}for(i=0;i<valcount;i++){val=vals[i];if(stacked&&val===xaxisOffset){if(!allMin||minPlotted){continue;}minPlotted=true;}if(range>0){height=Math.floor(canvasHeightEf*(Math.abs(val-xaxisOffset)/range));}else {height=canvasHeightEf;}if(val<xaxisOffset||val===xaxisOffset&&yoffset===0){y=yoffsetNeg-height;yoffsetNeg+=height;}else {if(stacked){y=yoffset;yoffset+=height;}else {y=yoffset;yoffset-=height;}}color=this.calcColor(i,val,valuenum);if(highlight){color=this.calcHighlightColor(color,options);}result.push(target.drawRect(y,x,height-1,this.barWidth-1,color,color));}if(result.length===1){return result[0];}return result;}},column:{type:'column',init:function init(el,values){var options=this.options;var width=el.mergedOptions.width;var height=el.mergedOptions.height;this.canvasWidth=el.mergedOptions.width;this.canvasHeight=el.mergedOptions.height;var barWidth=parseInt(options.get('barWidth'),10),barSpacing=parseInt(options.get('barSpacing'),10),chartRangeMin=options.get('chartRangeMin'),chartRangeMax=options.get('chartRangeMax'),chartRangeClip=options.get('chartRangeClip'),stackMin=Infinity,stackMax=-Infinity,isStackString,groupMin,groupMax,stackRanges,numValues,i,vlen,range,zeroAxis,xaxisOffset,min,max,clipMin,clipMax,stacked,vlist,j,slen,svals,val,yoffset;//bar._super.init.call(this, el, values, options, width, height);
  this.values=values;// scan values to determine whether to stack bars
  for(i=0,vlen=values.length;i<vlen;i++){val=values[i];isStackString=typeof val==='string'&&val.indexOf(':')>-1;if(isStackString||$.isArray(val)){stacked=true;if(isStackString){val=values[i]=normalizeValues(val.split(':'));}val=remove(val,null);// min/max will treat null as zero
  groupMin=Math.min.apply(Math,val);groupMax=Math.max.apply(Math,val);if(groupMin<stackMin){stackMin=groupMin;}if(groupMax>stackMax){stackMax=groupMax;}}}this.stacked=stacked;this.regionShapes={};this.barWidth=Math.floor(width/values.length)-barSpacing;this.barSpacing=barSpacing;this.totalBarWidth=this.barWidth+barSpacing;//this.width = width = (values.length * barWidth) + ((values.length - 1) * barSpacing);
  this.width=width;//this.initTarget();
  if(chartRangeClip){clipMin=chartRangeMin===undefined?-Infinity:chartRangeMin;clipMax=chartRangeMax===undefined?Infinity:chartRangeMax;}numValues=[];stackRanges=stacked?[]:numValues;var stackTotals=[];var stackRangesNeg=[];for(i=0,vlen=values.length;i<vlen;i++){if(stacked){vlist=values[i];values[i]=svals=[];stackTotals[i]=0;stackRanges[i]=stackRangesNeg[i]=0;for(j=0,slen=vlist.length;j<slen;j++){val=svals[j]=chartRangeClip?clipval(vlist[j],clipMin,clipMax):vlist[j];if(val!==null){if(val>0){stackTotals[i]+=val;}if(stackMin<0&&stackMax>0){if(val<0){stackRangesNeg[i]+=Math.abs(val);}else {stackRanges[i]+=val;}}else {stackRanges[i]+=Math.abs(val);// stackRanges[i] += Math.abs(val - (val < 0 ? stackMax : stackMin));
  }numValues.push(val);}}}else {val=chartRangeClip?clipval(values[i],clipMin,clipMax):values[i];val=values[i]=normalizeValue(val);if(val!==null){numValues.push(val);}}}this.max=max=Math.max.apply(Math,numValues);this.min=min=Math.min.apply(Math,numValues);this.stackMax=stackMax=stacked?Math.max.apply(Math,stackTotals):max;this.stackMin=stackMin=stacked?Math.min.apply(Math,numValues):min;if(options.get('chartRangeMin')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMin')<min)){min=options.get('chartRangeMin');}if(options.get('chartRangeMax')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMax')>max)){max=options.get('chartRangeMax');}this.zeroAxis=zeroAxis=options.get('zeroAxis',true);if(min<=0&&max>=0&&zeroAxis){xaxisOffset=0;}else if(zeroAxis==false){xaxisOffset=min;}else if(min>0){xaxisOffset=0;}else {xaxisOffset=max;}this.xaxisOffset=xaxisOffset;range=stacked?Math.max.apply(Math,stackRanges)+Math.max.apply(Math,stackRangesNeg):max-xaxisOffset;// as we plot zero/min values a single pixel line, we add a pixel to all other
  // values - Reduce the effective canvas size to suit
  this.canvasHeightEf=zeroAxis&&min<0?this.canvasHeight-2:this.canvasHeight-1;this.isNeg=false;if(min<xaxisOffset){// yMaxCalc = (stacked && max >= 0) ? stackMax : max;
  // yoffset = (yMaxCalc - xaxisOffset) / range * this.canvasHeight;
  yoffset=Math.floor(this.canvasHeight/2);this.isNeg=true;if(yoffset!==Math.ceil(yoffset)){this.canvasHeightEf-=2;yoffset=Math.ceil(yoffset);}}else {yoffset=this.canvasHeight;}this.yoffset=yoffset;if($.isArray(options.get('colorMap'))){this.colorMapByIndex=options.get('colorMap');this.colorMapByValue=null;}else {this.colorMapByIndex=null;this.colorMapByValue=options.get('colorMap');if(this.colorMapByValue&&this.colorMapByValue.get===undefined){this.colorMapByValue=new RangeMap(this.colorMapByValue);}}this.range=range;},getRegion:function getRegion(el,x,y){var result=Math.floor(x/this.totalBarWidth);return result<0||result>=this.values.length?undefined:result;},getCurrentRegionFields:function getCurrentRegionFields(){var currentRegion=this.currentRegion,values=ensureArray(this.values[currentRegion]),result=[],value,i;for(i=values.length;i--;){value=values[i];result.push({isNull:value===null,value:value,color:this.calcColor(i,value,currentRegion),offset:currentRegion});}return result;},calcColor:function calcColor(stacknum,value,valuenum){var colorMapByIndex=this.colorMapByIndex,colorMapByValue=this.colorMapByValue,options=this.options,color,newColor;if(this.stacked){color=options.get('stackedBarColor');}else {color=value<0?options.get('negBarColor'):options.get('barColor');}if(value===0&&options.get('zeroColor')!==undefined){color=options.get('zeroColor');}if(colorMapByValue&&(newColor=colorMapByValue.get(value))){color=newColor;}else if(colorMapByIndex&&colorMapByIndex.length>valuenum){color=colorMapByIndex[valuenum];}return $.isArray(color)?color[stacknum%color.length]:color;},/**
                   * Render bar(s) for a region
                   */renderRegion:function renderRegion(valuenum,highlight){var vals=this.values[valuenum],options=this.options,xaxisOffset=this.xaxisOffset,result=[],range=this.range,stacked=this.stacked,target=this.target,x=valuenum*this.totalBarWidth,canvasHeightEf=this.canvasHeightEf,yoffset=this.yoffset,y,height,color,isNull,yoffsetNeg,i,valcount,val,minPlotted,allMin;vals=$.isArray(vals)?vals:[vals];valcount=vals.length;val=vals[0];isNull=all(null,vals);allMin=all(xaxisOffset,vals,true);if(isNull){if(options.get('nullColor')){color=highlight?options.get('nullColor'):this.calcHighlightColor(options.get('nullColor'),options);y=yoffset>0?yoffset-1:yoffset;return target.drawRect(x,y,this.barWidth-1,0,color,color);}else {return undefined;}}yoffsetNeg=yoffset;if(this.isNeg){canvasHeightEf=Math.floor(canvasHeightEf/2);}for(i=0;i<valcount;i++){val=vals[i];if(stacked&&val===xaxisOffset){if(!allMin||minPlotted){continue;}minPlotted=true;}if(range>0){height=Math.floor(canvasHeightEf*(Math.abs(val-xaxisOffset)/range));}else {height=canvasHeightEf;}if(val<xaxisOffset||val===xaxisOffset&&yoffset===0){y=yoffsetNeg;yoffsetNeg+=height;}else {y=yoffset-height;yoffset-=height;}color=this.calcColor(i,val,valuenum);if(highlight){color=this.calcHighlightColor(color,options);}result.push(target.drawRect(x,y,this.barWidth-1,height-1,color,color));}if(result.length===1){return result[0];}return result;}},tristate:{type:'tristate',init:function init(el,values){var options=this.options;var width=el.mergedOptions.width;var height=el.mergedOptions.height;this.canvasWidth=el.mergedOptions.width;this.canvasHeight=el.mergedOptions.height;var barWidth=parseInt(options.get('barWidth'),10),barSpacing=parseInt(options.get('barSpacing'),10);//tristate._super.init.call(this, el, values, options, width, height);
  this.regionShapes={};this.barWidth=barWidth;this.barSpacing=barSpacing;this.totalBarWidth=barWidth+barSpacing;this.values=$.map(values,Number);this.width=width=values.length*barWidth+(values.length-1)*barSpacing;if($.isArray(options.get('colorMap'))){this.colorMapByIndex=options.get('colorMap');this.colorMapByValue=null;}else {this.colorMapByIndex=null;this.colorMapByValue=options.get('colorMap');if(this.colorMapByValue&&this.colorMapByValue.get===undefined){this.colorMapByValue=new RangeMap(this.colorMapByValue);}}//this.initTarget();
  },getRegion:function getRegion(el,x,y){return Math.floor(x/this.totalBarWidth);},getCurrentRegionFields:function getCurrentRegionFields(){var currentRegion=this.currentRegion;return {isNull:this.values[currentRegion]===undefined,value:this.values[currentRegion],color:this.calcColor(this.values[currentRegion],currentRegion),offset:currentRegion};},calcColor:function calcColor(value,valuenum){var values=this.values,options=this.options,colorMapByIndex=this.colorMapByIndex,colorMapByValue=this.colorMapByValue,color,newColor;if(colorMapByValue&&(newColor=colorMapByValue.get(value))){color=newColor;}else if(colorMapByIndex&&colorMapByIndex.length>valuenum){color=colorMapByIndex[valuenum];}else if(values[valuenum]<0){color=options.get('negBarColor');}else if(values[valuenum]>0){color=options.get('posBarColor');}else {color=options.get('zeroBarColor');}return color;},renderRegion:function renderRegion(valuenum,highlight){var values=this.values,options=this.options,target=this.target,canvasHeight,height,halfHeight,x,y,color;canvasHeight=this.canvasHeight;halfHeight=Math.round(canvasHeight/2);x=valuenum*this.totalBarWidth;if(values[valuenum]<0){y=halfHeight;height=halfHeight-1;}else if(values[valuenum]>0){y=0;height=halfHeight-1;}else {y=halfHeight-1;height=2;}color=this.calcColor(values[valuenum],valuenum);if(color===null){return;}if(highlight){color=this.calcHighlightColor(color,options);}return target.drawRect(x,y,this.barWidth-1,height-1,color,color);}},discrete:{type:'discrete',init:function init(el,values){var options=this.options;var width=el.mergedOptions.width;var height=el.mergedOptions.height;this.canvasWidth=el.mergedOptions.width;this.canvasHeight=el.mergedOptions.height;this.regionShapes={};this.values=values=$.map(values,Number);this.min=Math.min.apply(Math,values);this.max=Math.max.apply(Math,values);this.range=this.max-this.min;this.width=width;this.interval=Math.floor(width/values.length);this.itemWidth=width/values.length;if(options.get('chartRangeMin')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMin')<this.min)){this.min=options.get('chartRangeMin');}if(options.get('chartRangeMax')!==undefined&&(options.get('chartRangeClip')||options.get('chartRangeMax')>this.max)){this.max=options.get('chartRangeMax');}//this.initTarget();
  if(this.target){this.lineHeight=options.get('lineHeight')==='auto'?Math.round(this.canvasHeight*0.3):options.get('lineHeight');}},getRegion:function getRegion(el,x,y){return Math.floor(x/this.itemWidth);},getCurrentRegionFields:function getCurrentRegionFields(){var currentRegion=this.currentRegion;return {isNull:this.values[currentRegion]===undefined,value:this.values[currentRegion],offset:currentRegion};},renderRegion:function renderRegion(valuenum,highlight){var values=this.values,options=this.options,min=this.min,max=this.max,range=this.range,interval=this.interval,target=this.target,canvasHeight=this.canvasHeight,lineHeight=this.lineHeight,pheight=canvasHeight-lineHeight,ytop,val,color,x;val=clipval(values[valuenum],min,max);x=valuenum*interval;ytop=Math.round(pheight-pheight*((val-min)/range));color=options.get('thresholdColor')&&val<options.get('thresholdValue')?options.get('thresholdColor'):options.get('lineColor');if(highlight){color=this.calcHighlightColor(color,options);}//return target.drawLine(x, ytop, x, ytop + lineHeight, color);
  return this.target.drawRect(x,ytop,interval<=2?1:interval-2,lineHeight,color,color);}},bullet:{type:'bullet',init:function init(el,values){var options=this.options;var width=el.mergedOptions.width;var height=el.mergedOptions.height;this.canvasWidth=el.mergedOptions.width;this.canvasHeight=el.mergedOptions.height;var min,max,vals;//bullet._super.init.call(this, el, values, options, width, height);
  // values: target, performance, range1, range2, range3
  this.values=values=normalizeValues(values);// target or performance could be null
  vals=values.slice();vals[0]=vals[0]===null?vals[2]:vals[0];vals[1]=values[1]===null?vals[2]:vals[1];min=Math.min.apply(Math,values);max=Math.max.apply(Math,values);if(options.get('base')===undefined){min=min<0?min:0;}else {min=options.get('base');}this.min=min;this.max=max;this.range=max-min;this.shapes={};this.valueShapes={};this.regiondata={};this.width=width;//this.target = this.$el.simpledraw(width, height, options.get('composite'));
  if(!values.length){this.disabled=true;}//this.initTarget();
  },getRegion:function getRegion(el,x,y){var shapeid=this.target.getShapeAt(el,x,y);return shapeid!==undefined&&this.shapes[shapeid]!==undefined?this.shapes[shapeid]:undefined;},getCurrentRegionFields:function getCurrentRegionFields(){var currentRegion=this.currentRegion;return {fieldkey:currentRegion.substr(0,1),value:this.values[currentRegion.substr(1)],region:currentRegion};},changeHighlight:function changeHighlight(highlight){var currentRegion=this.currentRegion,shapeid=this.valueShapes[currentRegion],shape;delete this.shapes[shapeid];switch(currentRegion.substr(0,1)){case'r':shape=this.renderRange(currentRegion.substr(1),highlight);break;case'p':shape=this.renderPerformance(highlight);break;case't':shape=this.renderTarget(highlight);break;}this.valueShapes[currentRegion]=shape.id;this.shapes[shape.id]=currentRegion;this.target.replaceWithShape(shapeid,shape);},renderRange:function renderRange(rn,highlight){var rangeval=this.values[rn],rangewidth=Math.round(this.canvasWidth*((rangeval-this.min)/this.range)),color=this.options.get('rangeColors')[rn-2];if(highlight){color=this.calcHighlightColor(color,this.options);}return this.target.drawRect(0,0,rangewidth-1,this.canvasHeight-1,color,color);},renderPerformance:function renderPerformance(highlight){var perfval=this.values[1],perfwidth=Math.round(this.canvasWidth*((perfval-this.min)/this.range)),color=this.options.get('performanceColor');if(highlight){color=this.calcHighlightColor(color,this.options);}return this.target.drawRect(0,Math.round(this.canvasHeight*0.3),perfwidth-1,Math.round(this.canvasHeight*0.4)-1,color,color);},renderTarget:function renderTarget(highlight){var targetval=this.values[0],x=Math.round(this.canvasWidth*((targetval-this.min)/this.range)-this.options.get('targetWidth')/2),targettop=Math.round(this.canvasHeight*0.10),targetheight=this.canvasHeight-targettop*2,color=this.options.get('targetColor');if(highlight){color=this.calcHighlightColor(color,this.options);}return this.target.drawRect(x,targettop,this.options.get('targetWidth')-1,targetheight-1,color,color);},render:function render(el,userValues){this.init(el,userValues);var vlen=this.values.length,target=this.target,i,shape;// if (!bullet._super.render.call(this)) {
  //     return;
  // }
  for(i=2;i<vlen;i++){shape=this.renderRange(i).append();this.shapes[shape.id]='r'+i;this.valueShapes['r'+i]=shape.id;}if(this.values[1]!==null){shape=this.renderPerformance().append();this.shapes[shape.id]='p1';this.valueShapes.p1=shape.id;}if(this.values[0]!==null){shape=this.renderTarget().append();this.shapes[shape.id]='t0';this.valueShapes.t0=shape.id;}//target.render();
  }},pie:{type:'pie',init:function init(el,values){var options=this.options;var width=el.mergedOptions.width;var height=el.mergedOptions.height;this.canvasWidth=el.mergedOptions.width;this.canvasHeight=el.mergedOptions.height;var total=0,i;//pie._super.init.call(this, el, values, options, width, height);
  this.shapes={};// map shape ids to value offsets
  this.valueShapes={};// maps value offsets to shape ids
  this.values=values=$.map(values,Number);if(options.get('width')==='auto'){this.width=this.height;}if(values.length>0){for(i=values.length;i--;){total+=values[i];}}this.total=total;//this.initTarget();
  this.radius=Math.floor(Math.min(this.canvasWidth,this.canvasHeight)/2);},getRegion:function getRegion(el,x,y){var shapeid=this.target.getShapeAt(el,x,y);return shapeid!==undefined&&this.shapes[shapeid]!==undefined?this.shapes[shapeid]:undefined;},getCurrentRegionFields:function getCurrentRegionFields(){var currentRegion=this.currentRegion;return {isNull:this.values[currentRegion]===undefined,value:this.values[currentRegion],percent:this.values[currentRegion]/this.total*100,color:this.options.get('sliceColors')[currentRegion%this.options.get('sliceColors').length],offset:currentRegion};},changeHighlight:function changeHighlight(highlight){var currentRegion=this.currentRegion,newslice=this.renderSlice(currentRegion,highlight),shapeid=this.valueShapes[currentRegion];delete this.shapes[shapeid];this.target.replaceWithShape(shapeid,newslice);this.valueShapes[currentRegion]=newslice.id;this.shapes[newslice.id]=currentRegion;},renderSlice:function renderSlice(valuenum,highlight){var target=this.target,options=this.options,radius=this.radius,borderWidth=options.get('borderWidth'),offset=options.get('offset'),circle=2*Math.PI,values=this.values,total=this.total,next=offset?2*Math.PI*(offset/360):0,start,end,i,vlen,color;vlen=values.length;for(i=0;i<vlen;i++){start=next;end=next;if(total>0){// avoid divide by zero
  end=next+circle*(values[i]/total);}if(valuenum===i){color=options.get('sliceColors')[i%options.get('sliceColors').length];if(highlight){color=this.calcHighlightColor(color,options);}return target.drawPieSlice(radius,radius,radius-borderWidth,start,end,undefined,color);}next=end;}},render:function render(el,userValues){this.init(el,userValues);var target=this.target,values=this.values,options=this.options,radius=this.radius,borderWidth=options.get('borderWidth'),shape,i;// if (!pie._super.render.call(this)) {
  //     return;
  // }
  if(borderWidth){target.drawCircle(radius,radius,Math.floor(radius-borderWidth/2),options.get('borderColor'),undefined,borderWidth).append();}for(i=values.length;i--;){if(values[i]){// don't render zero values
  shape=this.renderSlice(i).append();this.valueShapes[i]=shape.id;// store just the shapeid
  this.shapes[shape.id]=i;}}//target.render();
  }},box:{type:'box',init:function init(el,values){var options=this.options;var width=el.mergedOptions.width;var height=el.mergedOptions.height;this.canvasWidth=el.mergedOptions.width;this.canvasHeight=el.mergedOptions.height;//box._super.init.call(this, el, values, options, width, height);
  this.values=$.map(values,Number);this.width=options.get('width')==='auto'?'4.0em':width;//this.initTarget();
  if(!this.values.length){this.disabled=1;}},/**
                   * Simulate a single region
                   */getRegion:function getRegion(){return 1;},getCurrentRegionFields:function getCurrentRegionFields(){var result=[{field:'lq',value:this.quartiles[0]},{field:'med',value:this.quartiles[1]},{field:'uq',value:this.quartiles[2]}];if(this.loutlier!==undefined){result.push({field:'lo',value:this.loutlier});}if(this.routlier!==undefined){result.push({field:'ro',value:this.routlier});}if(this.lwhisker!==undefined){result.push({field:'lw',value:this.lwhisker});}if(this.rwhisker!==undefined){result.push({field:'rw',value:this.rwhisker});}return result;},render:function render(el,userValues){this.init(el,userValues);var target=this.target,values=this.values,vlen=values.length,options=this.options,canvasWidth=this.canvasWidth,canvasHeight=this.canvasHeight,minValue=options.get('chartRangeMin')===undefined?Math.min.apply(Math,values):options.get('chartRangeMin'),maxValue=options.get('chartRangeMax')===undefined?Math.max.apply(Math,values):options.get('chartRangeMax'),canvasLeft=0,lwhisker,loutlier,iqr,q1,q2,q3,rwhisker,routlier,i,size,unitSize;// if (!box._super.render.call(this)) {
  //     return;
  // }
  if(options.get('raw')){if(options.get('showOutliers')&&values.length>5){loutlier=values[0];lwhisker=values[1];q1=values[2];q2=values[3];q3=values[4];rwhisker=values[5];routlier=values[6];}else {lwhisker=values[0];q1=values[1];q2=values[2];q3=values[3];rwhisker=values[4];}}else {values.sort(function(a,b){return a-b;});q1=quartile(values,1);q2=quartile(values,2);q3=quartile(values,3);iqr=q3-q1;if(options.get('showOutliers')){lwhisker=rwhisker=undefined;for(i=0;i<vlen;i++){if(lwhisker===undefined&&values[i]>q1-iqr*options.get('outlierIQR')){lwhisker=values[i];}if(values[i]<q3+iqr*options.get('outlierIQR')){rwhisker=values[i];}}loutlier=values[0];routlier=values[vlen-1];}else {lwhisker=values[0];rwhisker=values[vlen-1];}}this.quartiles=[q1,q2,q3];this.lwhisker=lwhisker;this.rwhisker=rwhisker;this.loutlier=loutlier;this.routlier=routlier;unitSize=canvasWidth/(maxValue-minValue+1);if(options.get('showOutliers')){canvasLeft=Math.ceil(options.get('spotRadius'));canvasWidth-=2*Math.ceil(options.get('spotRadius'));unitSize=canvasWidth/(maxValue-minValue+1);if(loutlier<lwhisker){target.drawCircle((loutlier-minValue)*unitSize+canvasLeft,canvasHeight/2,options.get('spotRadius'),options.get('outlierLineColor'),options.get('outlierFillColor')).append();}if(routlier>rwhisker){target.drawCircle((routlier-minValue)*unitSize+canvasLeft,canvasHeight/2,options.get('spotRadius'),options.get('outlierLineColor'),options.get('outlierFillColor')).append();}}// box
  target.drawRect(Math.round((q1-minValue)*unitSize+canvasLeft),Math.round(canvasHeight*0.1),Math.round((q3-q1)*unitSize),Math.round(canvasHeight*0.8),options.get('boxLineColor'),options.get('boxFillColor')).append();// left whisker
  target.drawLine(Math.round((lwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),Math.round((q1-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),options.get('lineColor')).append();target.drawLine(Math.round((lwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/4),Math.round((lwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight-canvasHeight/4),options.get('whiskerColor')).append();// right whisker
  target.drawLine(Math.round((rwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),Math.round((q3-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),options.get('lineColor')).append();target.drawLine(Math.round((rwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/4),Math.round((rwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight-canvasHeight/4),options.get('whiskerColor')).append();// median line
  target.drawLine(Math.round((q2-minValue)*unitSize+canvasLeft),Math.round(canvasHeight*0.1),Math.round((q2-minValue)*unitSize+canvasLeft),Math.round(canvasHeight*0.9),options.get('medianColor')).append();if(options.get('target')){size=Math.ceil(options.get('spotRadius'));target.drawLine(Math.round((options.get('target')-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2-size),Math.round((options.get('target')-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2+size),options.get('targetColor')).append();target.drawLine(Math.round((options.get('target')-minValue)*unitSize+canvasLeft-size),Math.round(canvasHeight/2),Math.round((options.get('target')-minValue)*unitSize+canvasLeft+size),Math.round(canvasHeight/2),options.get('targetColor')).append();}//target.render();
  }},shapeCount:0,shapes:{},shapeseq:[],lastShapeId:null,mergedOptions:null,init:function init(userValues,userOptions){var extendedOptions,defaults,base;var userOptions=userOptions||{};var _this=this;defaults=this.defaultOption;base=defaults.common;extendedOptions=defaults[userOptions.type||base.type];_this.shapeCount=0;_this.shapes={};_this.shapeseq=[];_this.lastShapeId=null;_this.mergedOptions=$.extend({},base,extendedOptions,userOptions);_this.mergedOptions.width=devicePixelRatio*_this.mergedOptions.width;_this.mergedOptions.height=devicePixelRatio*_this.mergedOptions.height;_this[_this.mergedOptions.type].render(_this,userValues);return {shapes:_this.shapes,shapeseq:_this.shapeseq,offsetX:_this.mergedOptions.offsetX,offsetY:_this.mergedOptions.offsetY,pixelWidth:_this.mergedOptions.width,pixelHeight:_this.mergedOptions.height};},_getContext:function _getContext(lineColor,fillColor,lineWidth){if(this.ctx!=null){var context=this.ctx;}else {var context=$("#"+this._canvasID).get(0).getContext('2d');}if(lineColor!==undefined){context.strokeStyle=lineColor;}context.lineWidth=lineWidth===undefined?1:lineWidth;if(fillColor!==undefined){context.fillStyle=fillColor;}return context;},reset:function reset(){var context=this._getContext();context.clearRect(0,0,this.pixelWidth,this.pixelHeight);this.shapes={};this.shapeseq=[];this.currentTargetShapeId=undefined;},_drawShape:function _drawShape(shapeid,path,lineColor,fillColor,lineWidth){var context=this._getContext(lineColor,fillColor,lineWidth),i,plen;context.beginPath();context.moveTo(path[0][0]+0.5+this.offsetX,path[0][1]+0.5+this.offsetY);for(i=1,plen=path.length;i<plen;i++){context.lineTo(path[i][0]+0.5+this.offsetX,path[i][1]+0.5+this.offsetY);// the 0.5 offset gives us crisp pixel-width lines
  }if(lineColor!==undefined){context.stroke();}if(fillColor!==undefined){context.fill();}if(this.targetX!==undefined&&this.targetY!==undefined&&context.isPointInPath(this.targetX+this.offsetX,this.targetY+this.offsetY)){this.currentTargetShapeId=shapeid;}},_drawCircle:function _drawCircle(shapeid,x,y,radius,lineColor,fillColor,lineWidth){var context=this._getContext(lineColor,fillColor,lineWidth);context.beginPath();x+=this.offsetX;y+=this.offsetY;context.arc(x,y,radius,0,2*Math.PI,false);if(this.targetX!==undefined&&this.targetY!==undefined&&context.isPointInPath(this.targetX+this.offsetX,this.targetY+this.offsetY)){this.currentTargetShapeId=shapeid;}if(lineColor!==undefined){context.stroke();}if(fillColor!==undefined){context.fill();}},_drawPieSlice:function _drawPieSlice(shapeid,x,y,radius,startAngle,endAngle,lineColor,fillColor){var context=this._getContext(lineColor,fillColor);x+=this.offsetX;y+=this.offsetY;context.beginPath();context.moveTo(x,y);context.arc(x,y,radius,startAngle,endAngle,false);context.lineTo(x,y);context.closePath();if(lineColor!==undefined){context.stroke();}if(fillColor){context.fill();}if(this.targetX!==undefined&&this.targetY!==undefined&&context.isPointInPath(this.targetX+this.offsetX,this.targetY+this.offsetY)){this.currentTargetShapeId=shapeid;}},_drawRect:function _drawRect(shapeid,x,y,width,height,lineColor,fillColor){// x+=this.offsetX;
  // y+=this.offsetY;
  return this._drawShape(shapeid,[[x,y],[x+width,y],[x+width,y+height],[x,y+height],[x,y]],lineColor,fillColor);},appendShape:function appendShape(shape){this.shapes[shape.id]=shape;this.shapeseq.push(shape.id);this.lastShapeId=shape.id;return shape.id;},replaceWithShape:function replaceWithShape(shapeid,shape){var shapeseq=this.shapeseq,i;this.shapes[shape.id]=shape;for(i=shapeseq.length;i--;){if(shapeseq[i]==shapeid){shapeseq[i]=shape.id;}}delete this.shapes[shapeid];},replaceWithShapes:function replaceWithShapes(shapeids,shapes){var shapeseq=this.shapeseq,shapemap={},sid,i,first;for(i=shapeids.length;i--;){shapemap[shapeids[i]]=true;}for(i=shapeseq.length;i--;){sid=shapeseq[i];if(shapemap[sid]){shapeseq.splice(i,1);delete this.shapes[sid];first=i;}}for(i=shapes.length;i--;){shapeseq.splice(first,0,shapes[i].id);this.shapes[shapes[i].id]=shapes[i];}},insertAfterShape:function insertAfterShape(shapeid,shape){var shapeseq=this.shapeseq,i;for(i=shapeseq.length;i--;){if(shapeseq[i]===shapeid){shapeseq.splice(i+1,0,shape.id);this.shapes[shape.id]=shape;return;}}},removeShapeId:function removeShapeId(shapeid){var shapeseq=this.shapeseq,i;for(i=shapeseq.length;i--;){if(shapeseq[i]===shapeid){shapeseq.splice(i,1);break;}}delete this.shapes[shapeid];},getShapeAt:function getShapeAt(el,x,y){this.targetX=x;this.targetY=y;this.render();return this.currentTargetShapeId;},_canvasID:"luckysheetTableContent",render:function render(shapeseq,shapes,offsetX,offsetY,pixelWidth,pixelHeight,canvasid,ctx){if(canvasid==null){canvasid="luckysheetTableContent";}this._canvasID=canvasid;if(ctx!=null){this.ctx=ctx;}var shapeCount=shapeseq.length,context=this._getContext(),shapeid,shape,i;this.offsetX=offsetX;this.offsetY=offsetY;this.pixelWidth=pixelWidth;this.pixelHeight=pixelHeight;//context.clearRect(this.offsetX, this.offsetY, this.pixelWidth, this.pixelHeight);
  // qkSparkSetting.currentSparkVlaue = {
  //     shapeseq : shapeseq,
  //     shapes:shapes,
  //     shapeCount:shapeCount,
  //     el:this
  // }
  for(i=0;i<shapeCount;i++){shapeid=shapeseq[i];shape=shapes[shapeid];this['_draw'+shape.type].apply(this,shape.args);}// if (!this.interact) {
  //     // not interactive so no need to keep the shapes array
  //     this.shapes = {};
  //     this.shapeseq = [];
  // }
  },drawLine:function drawLine(x1,y1,x2,y2,lineColor,lineWidth){return this.drawShape([[x1,y1],[x2,y2]],lineColor,lineWidth);},drawShape:function drawShape(path,lineColor,fillColor,lineWidth){return this._genShape('Shape',[path,lineColor,fillColor,lineWidth]);},drawCircle:function drawCircle(x,y,radius,lineColor,fillColor,lineWidth){return this._genShape('Circle',[x,y,radius,lineColor,fillColor,lineWidth]);},drawPieSlice:function drawPieSlice(x,y,radius,startAngle,endAngle,lineColor,fillColor){return this._genShape('PieSlice',[x,y,radius,startAngle,endAngle,lineColor,fillColor]);},drawRect:function drawRect(x,y,width,height,lineColor,fillColor){return this._genShape('Rect',[x,y,width,height,lineColor,fillColor]);},_genShape:function _genShape(shapetype,shapeargs){var id=this.shapeCount++;shapeargs.unshift(id);// return new VShape(this, id, shapetype, shapeargs);
  // this.target = target;
  // this.id = id;
  // this.type = type;
  // this.args = args;
  var shape={id:id,type:shapetype,args:shapeargs};this.shapes[id]=shape;this.shapeseq.push(id);this.lastShapeId=id;return {append:function append(){return shape;},get:function get(){return id;}};}};var barHighlightMixin={changeHighlight:function changeHighlight(highlight){var currentRegion=this.currentRegion,target=this.target,shapeids=this.regionShapes[currentRegion],newShapes;// will be null if the region value was null
  if(shapeids){newShapes=this.renderRegion(currentRegion,highlight);if($.isArray(newShapes)||$.isArray(shapeids)){target.replaceWithShapes(shapeids,newShapes);this.regionShapes[currentRegion]=$.map(newShapes,function(newShape){return newShape.id;});}else {target.replaceWithShape(shapeids,newShapes);this.regionShapes[currentRegion]=newShapes.id;}}},render:function render(el,userValues){this.init(el,userValues);var values=this.values,target=this.target,regionShapes=this.regionShapes,shapes,ids,i,j;// if (!this.cls._super.render.call(this)) {
  //     return;
  // }
  for(i=values.length;i--;){shapes=this.renderRegion(i);if(shapes){if($.isArray(shapes)){ids=[];for(j=shapes.length;j--;){shapes[j].append();ids.push(shapes[j].id);}regionShapes[i]=ids;}else {shapes.append();regionShapes[i]=shapes.id;// store just the shapeid
  }}else {// null value
  regionShapes[i]=null;}}//target.render();
  }};var _luckysheetSparkLineOptions={get:function get(type){return luckysheet.sparkline.mergedOptions[type];}};var _luckysheetSparkLineTarget={drawLine:function drawLine(x1,y1,x2,y2,lineColor,lineWidth){return luckysheet.sparkline.drawLine(x1,y1,x2,y2,lineColor,lineWidth);},drawShape:function drawShape(path,lineColor,fillColor,lineWidth){return luckysheet.sparkline.drawShape(path,lineColor,fillColor,lineWidth);},drawCircle:function drawCircle(x,y,radius,lineColor,fillColor,lineWidth){return luckysheet.sparkline.drawCircle(x,y,radius,lineColor,fillColor,lineWidth);},drawPieSlice:function drawPieSlice(x,y,radius,startAngle,endAngle,lineColor,fillColor){return luckysheet.sparkline.drawPieSlice(x,y,radius,startAngle,endAngle,lineColor,fillColor);},drawRect:function drawRect(x,y,width,height,lineColor,fillColor){return luckysheet.sparkline.drawRect(x,y,width,height,lineColor,fillColor);}};// luckysheet.sparkline.line.options = _luckysheetSparkLineOptions;
  // luckysheet.sparkline.line.target = _luckysheetSparkLineTarget;
  // luckysheet.sparkline.bar.options = _luckysheetSparkLineOptions;
  // luckysheet.sparkline.bar.target = _luckysheetSparkLineTarget;
  for(var item in luckysheet.sparkline){if(item in{"line":null,"bar":null,"column":null,"tristate":null,"discrete":null,"bullet":null,"pie":null,"box":null}){luckysheet.sparkline[item].options=_luckysheetSparkLineOptions;luckysheet.sparkline[item].target=_luckysheetSparkLineTarget;}if(item in{"bar":null,"column":null,"tristate":null,"discrete":null}){luckysheet.sparkline[item].changeHighlight=barHighlightMixin.changeHighlight;luckysheet.sparkline[item].render=barHighlightMixin.render;}}// setTimeout(function(){
  //     var temp1 = luckysheet.sparkline.init([ 1, 3, 5, 8, 10, 15, 18 ], { height:20,width:100,offsetX:100,offsetY:50, type:'box', raw: true, showOutliers:true, target: 6 }) ; luckysheet.sparkline.render(temp1.shapeseq,temp1.shapes,temp1.offsetX*devicePixelRatio,temp1.offsetY*devicePixelRatio,temp1.pixelWidth,temp1.pixelHeight);
  //     var temp1 = luckysheet.sparkline.init([20,50,80], { height:60,width:60,offsetX:100,offsetY:150, type: 'pie' }) ; luckysheet.sparkline.render(temp1.shapeseq,temp1.shapes,temp1.offsetX*devicePixelRatio,temp1.offsetY*devicePixelRatio,temp1.pixelWidth,temp1.pixelHeight);
  //     var temp1 = luckysheet.sparkline.init([10,12,12,9,7], { height:20,width:100,offsetX:100,offsetY:250, type: 'bullet' }) ; luckysheet.sparkline.render(temp1.shapeseq,temp1.shapes,temp1.offsetX*devicePixelRatio,temp1.offsetY*devicePixelRatio,temp1.pixelWidth,temp1.pixelHeight);
  //     var temp1 = luckysheet.sparkline.init([4,6,7,7,4,3,2,1,4,4,5,6,7,6,6,2,4,5], { height:20,width:100,offsetX:100,offsetY:350, type: 'discrete', thresholdValue: 4  }) ; luckysheet.sparkline.render(temp1.shapeseq,temp1.shapes,temp1.offsetX*devicePixelRatio,temp1.offsetY*devicePixelRatio,temp1.pixelWidth,temp1.pixelHeight);
  //     var temp1 = luckysheet.sparkline.init([1,2,0,5,-1,-2,1,-4,0,0,1,1], { type: 'tristate',height:20,width:100,offsetX:300,offsetY:150, colorMap: {'-2': '#fa7', '2': '#44f'}  }) ; luckysheet.sparkline.render(temp1.shapeseq,temp1.shapes,temp1.offsetX*devicePixelRatio,temp1.offsetY*devicePixelRatio,temp1.pixelidth,temp1.pixelHeight);
  //     var temp1 = luckysheet.sparkline.init([10,5,3], { type: 'bar',height:30,width:20,offsetX:300,offsetY:250 }) ; luckysheet.sparkline.render(temp1.shapeseq,temp1.shapes,temp1.offsetX*devicePixelRatio,temp1.offsetY*devicePixelRatio,temp1.pixelWidth,temp1.pixelHeight);
  //     var temp1 = luckysheet.sparkline.init([4,1,5,7,9,9,8,7,6,6,4,7,8,4,3,2,2,5,6,7], { height:50,width:90,normalRangeMin:6,normalRangeMax:6,normalRangeColor:"#000" });luckysheet.sparkline.render(temp1.shapeseq,temp1.shapes,300*devicePixelRatio,50*devicePixelRatio,temp1.pixelWidth,temp1.pixelHeight);
  //     var temp1 = luckysheet.sparkline.init([10,8,3,-5,5,8,-9], { type: 'bar',height:40,width:60,offsetX:300,offsetY:350 }) ; luckysheet.sparkline.render(temp1.shapeseq,temp1.shapes,temp1.offsetX*devicePixelRatio,temp1.offsetY*devicePixelRatio,temp1.pixelWidth,temp1.pixelHeight);
  //     var temp1 = luckysheet.sparkline.init(["0:2:12","2:6:10","7:2:5","4:10:8","10:1:4"], { type: 'bar',height:40,width:60,offsetX:500,offsetY:50 }) ; luckysheet.sparkline.render(temp1.shapeseq,temp1.shapes,temp1.offsetX*devicePixelRatio,temp1.offsetY*devicePixelRatio,temp1.pixelWidth,temp1.pixelHeight);
  //     var temp1 = luckysheet.sparkline.init(["0:2","2:4","4:2","4:1"], { type: 'bar',height:40,width:60,offsetX:500,offsetY:150 }) ; luckysheet.sparkline.render(temp1.shapeseq,temp1.shapes,temp1.offsetX*devicePixelRatio,temp1.offsetY*devicePixelRatio,temp1.pixelWidth,temp1.pixelHeight);
  //     var temp1 = luckysheet.sparkline.init(["0:2","2:4","4:2","4:1"], { type: 'column',height:40,width:60,offsetX:500,offsetY:250 }) ; luckysheet.sparkline.render(temp1.shapeseq,temp1.shapes,temp1.offsetX*devicePixelRatio,temp1.offsetY*devicePixelRatio,temp1.pixelWidth,temp1.pixelHeight);
  // },3000);
  })();// window.luckysheet = luckysheet;
  // })();

  // console.log = function(){};
  window.luckysheet_compareWith=function(){//函数功能：比较或运算 第一个参数和第三个参数，返回比较结果的布尔值或者运算值
  //luckysheet.formula.operatorjson; 存储运算符和比较符
  var sp=arguments[1];//操作符
  //参数一
  var data_fp=arguments[0];var fp;if(luckysheet.getObjType(data_fp)=="object"&&data_fp.startCell!=null){//参数是选区
  if(sp=="&"){fp=luckysheet.func_methods.getCellDataDyadicArr(data_fp,"text");}else {fp=luckysheet.func_methods.getCellDataDyadicArr(data_fp,"number");}if(fp.length==1&&fp[0].length==1){fp=fp[0][0];}}else {fp=data_fp;}//参数二
  var data_tp=arguments[2];var tp;if(luckysheet.getObjType(data_tp)=="object"&&data_tp.startCell!=null){//参数是选区
  if(sp=="&"){tp=luckysheet.func_methods.getCellDataDyadicArr(data_tp,"text");}else {tp=luckysheet.func_methods.getCellDataDyadicArr(data_tp,"number");}if(tp.length==1&&tp[0].length==1){tp=tp[0][0];}}else {tp=data_tp;}if(luckysheet.func_methods.valueIsError(fp)){return fp;}if(luckysheet.func_methods.valueIsError(tp)){return tp;}//参数是不规则二维数组 时 return #VALUE! 错误
  if(luckysheet.getObjType(fp)=="array"&&luckysheet.getObjType(fp[0])=="array"&&!luckysheet.func_methods.isDyadicArr(fp)){return luckysheet.formula.error.v;}if(luckysheet.getObjType(tp)=="array"&&luckysheet.getObjType(tp[0])=="array"&&!luckysheet.func_methods.isDyadicArr(tp)){return luckysheet.formula.error.v;}if(sp=="<>"){sp="!=";}if(sp=="="){sp="==";}if(sp=="-"&&fp==null){fp=0;}//计算result
  function booleanOperation(a,operator,b){if(luckysheet.func_methods.isRealNum(a)){a=parseFloat(a);}if(luckysheet.func_methods.isRealNum(b)){b=parseFloat(b);}if(operator=="=="){if(a==b){return true;}else {return false;}}else if(operator=="!="){if(a!=b){return true;}else {return false;}}else if(operator==">="){if(a>=b){return true;}else {return false;}}else if(operator=="<="){if(a<=b){return true;}else {return false;}}else if(operator==">"){if(a>b){return true;}else {return false;}}else if(operator=="<"){if(a<b){return true;}else {return false;}}}//布尔值对应数字（true = 1, false = 1）
  function booleanToNum(v){if(v==null){return v;}if(v.toString().toLowerCase()=="true"){return 1;}if(v.toString().toLowerCase()=="false"){return 0;}return v;}if(sp=="*"){//乘
  if(luckysheet.getObjType(fp)=="array"&&luckysheet.getObjType(tp)=="array"){var result=[];if(luckysheet.getObjType(fp[0])=="array"&&luckysheet.getObjType(tp[0])=="array"){//二维数组相乘（m*n 与 m*n 等于 m*n；m*p 与 p*n 等于 m*n；其它错误） 
  if(fp.length==tp.length&&fp[0].length==tp[0].length){for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){fp[m][n]=booleanToNum(fp[m][n]);tp[m][n]=booleanToNum(tp[m][n]);if(luckysheet.func_methods.isRealNum(fp[m][n])&&luckysheet.func_methods.isRealNum(tp[m][n])){var value=parseFloat(fp[m][n])*parseFloat(tp[m][n]);}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else if(fp[0].length==tp.length){var rowlen=fp.length;var collen=tp[0].length;for(var m=0;m<rowlen;m++){var rowArr=[];for(var n=0;n<collen;n++){var value=0;for(var p=0;p<fp[0].length;p++){fp[m][p]=booleanToNum(fp[m][p]);tp[p][n]=booleanToNum(tp[p][n]);if(luckysheet.func_methods.isRealNum(fp[m][p])&&luckysheet.func_methods.isRealNum(tp[p][n])){value+=parseFloat(fp[m][p])*parseFloat(tp[p][n]);}else {value+=luckysheet.formula.error.v;}}if(value.toString()=="NaN"){value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else if(fp.length==tp[0].length){var rowlen=tp.length;var collen=fp[0].length;for(var m=0;m<rowlen;m++){var rowArr=[];for(var n=0;n<collen;n++){var value=0;for(var p=0;p<tp[0].length;p++){fp[p][n]=booleanToNum(fp[p][n]);tp[m][p]=booleanToNum(tp[m][p]);if(luckysheet.func_methods.isRealNum(tp[m][p])&&luckysheet.func_methods.isRealNum(fp[p][n])){value+=parseFloat(tp[m][p])*parseFloat(fp[p][n]);}else {value+=luckysheet.formula.error.v;}}if(value.toString()=="NaN"){value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {return luckysheet.formula.error.na;}}else if(luckysheet.getObjType(fp[0])=="array"){//二维数组与一维数组相乘（m*n 与 n 等于 m*n；m*1 与 n 等于 m*n；其它错误）
  if(fp[0].length==tp.length){for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){fp[m][n]=booleanToNum(fp[m][n]);tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp[m][n])&&luckysheet.func_methods.isRealNum(tp[n])){var value=parseFloat(fp[m][n])*parseFloat(tp[n]);}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else if(fp[0].length==1){var rowlen=fp.length;var collen=tp.length;for(var m=0;m<rowlen;m++){var rowArr=[];for(var n=0;n<collen;n++){fp[m][0]=booleanToNum(fp[m][0]);tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp[m][0])&&luckysheet.func_methods.isRealNum(tp[n])){var value=parseFloat(fp[m][0])*parseFloat(tp[n]);}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {return luckysheet.formula.error.na;}}else if(luckysheet.getObjType(tp[0])=="array"){//二维数组与一维数组相乘（m*n 与 n 等于 m*n；m*1 与 n 等于 m*n；其它错误）
  if(tp[0].length==fp.length){for(var m=0;m<tp.length;m++){var rowArr=[];for(var n=0;n<tp[m].length;n++){fp[n]=booleanToNum(fp[n]);tp[m][n]=booleanToNum(tp[m][n]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp[m][n])){var value=parseFloat(fp[n])*parseFloat(tp[m][n]);}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else if(tp[0].length==1){var rowlen=tp.length;var collen=fp.length;for(var m=0;m<rowlen;m++){var rowArr=[];for(var n=0;n<collen;n++){fp[n]=booleanToNum(fp[n]);tp[m][0]=booleanToNum(tp[m][0]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp[m][0])){var value=parseFloat(fp[n])*parseFloat(tp[m][0]);}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {return luckysheet.formula.error.na;}}else {//一维数组与一维数组相乘时，数组大小不一样是错误
  if(fp.length!=tp.length){return luckysheet.formula.error.na;}for(var n=0;n<fp.length;n++){fp[n]=booleanToNum(fp[n]);tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp[n])){var value=parseFloat(fp[n])*parseFloat(tp[n]);}else {var value=luckysheet.formula.error.v;}result.push(value);}}return result;}else if(luckysheet.getObjType(fp)=="array"){tp=booleanToNum(tp);var result=[];if(luckysheet.getObjType(fp[0])=="array"){for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){fp[m][n]=booleanToNum(fp[m][n]);if(luckysheet.func_methods.isRealNum(fp[m][n])&&luckysheet.func_methods.isRealNum(tp)){var value=parseFloat(fp[m][n])*parseFloat(tp);}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {for(var n=0;n<fp.length;n++){fp[n]=booleanToNum(fp[n]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp)){var value=parseFloat(fp[n])*parseFloat(tp);}else {var value=luckysheet.formula.error.v;}result.push(value);}}return result;}else if(luckysheet.getObjType(tp)=="array"){fp=booleanToNum(fp);var result=[];if(luckysheet.getObjType(tp[0])=="array"){for(var m=0;m<tp.length;m++){var rowArr=[];for(var n=0;n<tp[m].length;n++){tp[m][n]=booleanToNum(tp[m][n]);if(luckysheet.func_methods.isRealNum(fp)&&luckysheet.func_methods.isRealNum(tp[m][n])){var value=parseFloat(fp)*parseFloat(tp[m][n]);}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {for(var n=0;n<tp.length;n++){tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp)&&luckysheet.func_methods.isRealNum(tp[n])){var value=parseFloat(fp)*parseFloat(tp[n]);}else {var value=luckysheet.formula.error.v;}result.push(value);}}return result;}else {fp=booleanToNum(fp);tp=booleanToNum(tp);if(luckysheet.func_methods.isRealNum(fp)&&luckysheet.func_methods.isRealNum(tp)){var result=parseFloat(fp)*parseFloat(tp);}else {var result=luckysheet.formula.error.v;}return result;}}else if(sp=="/"){//除
  if(luckysheet.getObjType(fp)=="array"&&luckysheet.getObjType(tp)=="array"){var result=[];if(luckysheet.getObjType(fp[0])=="array"&&luckysheet.getObjType(tp[0])=="array"){//二维数组相除（m*n 与 m*n 等于 m*n；m*p 与 p*n 等于 m*n；其它错误） 
  if(fp.length==tp.length&&fp[0].length==tp[0].length){for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){fp[m][n]=booleanToNum(fp[m][n]);tp[m][n]=booleanToNum(tp[m][n]);if(luckysheet.func_methods.isRealNum(fp[m][n])&&luckysheet.func_methods.isRealNum(tp[m][n])){if(parseFloat(tp[m][n])==0){var value=luckysheet.formula.error.d;}else {var value=parseFloat(fp[m][n])/parseFloat(tp[m][n]);}}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else if(fp[0].length==tp.length){var tp_inverse=luckysheet.matrix_methods.inverse(tp);var rowlen=fp.length;var collen=tp_inverse[0].length;for(var m=0;m<rowlen;m++){var rowArr=[];for(var n=0;n<collen;n++){var value=0;for(var p=0;p<fp[0].length;p++){fp[m][p]=booleanToNum(fp[m][p]);tp_inverse[p][n]=booleanToNum(tp_inverse[p][n]);if(luckysheet.func_methods.isRealNum(fp[m][p])&&luckysheet.func_methods.isRealNum(tp_inverse[p][n])){value+=parseFloat(fp[m][p])*parseFloat(tp_inverse[p][n]);}else {value+=luckysheet.formula.error.v;}}if(value.toString()=="NaN"){value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {return luckysheet.formula.error.na;}}else if(luckysheet.getObjType(fp[0])=="array"){//二维数组与一维数组相除（m*n 与 n 等于 m*n；m*1 与 n 等于 m*n；其它错误）
  if(fp[0].length==tp.length){for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){fp[m][n]=booleanToNum(fp[m][n]);tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp[m][n])&&luckysheet.func_methods.isRealNum(tp[n])){if(parseFloat(tp[n])==0){var value=luckysheet.formula.error.d;}else {var value=parseFloat(fp[m][n])/parseFloat(tp[n]);}}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else if(fp[0].length==1){var rowlen=fp.length;var collen=tp.length;for(var m=0;m<rowlen;m++){var rowArr=[];for(var n=0;n<collen;n++){fp[m][0]=booleanToNum(fp[m][0]);tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp[m][0])&&luckysheet.func_methods.isRealNum(tp[n])){if(parseFloat(tp[n])==0){var value=luckysheet.formula.error.d;}else {var value=parseFloat(fp[m][0])/parseFloat(tp[n]);}}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {return luckysheet.formula.error.na;}}else if(luckysheet.getObjType(tp[0])=="array"){//二维数组与一维数组相除（m*n 与 n 等于 m*n；m*1 与 n 等于 m*n；其它错误）
  if(tp[0].length==fp.length){for(var m=0;m<tp.length;m++){var rowArr=[];for(var n=0;n<tp[m].length;n++){fp[n]=booleanToNum(fp[n]);tp[m][n]=booleanToNum(tp[m][n]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp[m][n])){if(parseFloat(tp[m][n])==0){var value=luckysheet.formula.error.d;}else {var value=parseFloat(fp[n])/parseFloat(tp[m][n]);}}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else if(tp[0].length==1){var rowlen=tp.length;var collen=fp.length;for(var m=0;m<rowlen;m++){var rowArr=[];for(var n=0;n<collen;n++){fp[n]=booleanToNum(fp[n]);tp[m][0]=booleanToNum(tp[m][0]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp[m][0])){if(parseFloat(tp[m][0])==0){var value=luckysheet.formula.error.d;}else {var value=parseFloat(fp[n])/parseFloat(tp[m][0]);}}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {return luckysheet.formula.error.na;}}else {//一维数组与一维数组相除时，数组大小不一样是错误
  if(fp.length!=tp.length){return luckysheet.formula.error.na;}for(var n=0;n<fp.length;n++){fp[n]=booleanToNum(fp[n]);tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp[n])){if(parseFloat(tp[n])==0){var value=luckysheet.formula.error.d;}else {var value=parseFloat(fp[n])/parseFloat(tp[n]);}}else {var value=luckysheet.formula.error.v;}result.push(value);}}return result;}else if(luckysheet.getObjType(fp)=="array"){tp=booleanToNum(tp);var result=[];if(luckysheet.getObjType(fp[0])=="array"){for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){fp[m][n]=booleanToNum(fp[m][n]);if(luckysheet.func_methods.isRealNum(fp[m][n])&&luckysheet.func_methods.isRealNum(tp)){if(parseFloat(tp)==0){var value=luckysheet.formula.error.d;}else {var value=parseFloat(fp[m][n])/parseFloat(tp);}}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {for(var n=0;n<fp.length;n++){fp[n]=booleanToNum(fp[n]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp)){if(parseFloat(tp)==0){var value=luckysheet.formula.error.d;}else {var value=parseFloat(fp[n])/parseFloat(tp);}}else {var value=luckysheet.formula.error.v;}result.push(value);}}return result;}else if(luckysheet.getObjType(tp)=="array"){fp=booleanToNum(fp);var result=[];if(luckysheet.getObjType(tp[0])=="array"){for(var m=0;m<tp.length;m++){var rowArr=[];for(var n=0;n<tp[m].length;n++){tp[m][n]=booleanToNum(tp[m][n]);if(luckysheet.func_methods.isRealNum(fp)&&luckysheet.func_methods.isRealNum(tp[m][n])){if(parseFloat(tp[m][n])==0){var value=luckysheet.formula.error.d;}else {var value=parseFloat(fp)/parseFloat(tp[m][n]);}}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {for(var n=0;n<tp.length;n++){tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp)&&luckysheet.func_methods.isRealNum(tp[n])){if(parseFloat(tp[n])==0){var value=luckysheet.formula.error.d;}else {var value=parseFloat(fp)/parseFloat(tp[n]);}}else {var value=luckysheet.formula.error.v;}result.push(value);}}return result;}else {fp=booleanToNum(fp);tp=booleanToNum(tp);if(luckysheet.func_methods.isRealNum(fp)&&luckysheet.func_methods.isRealNum(tp)){if(parseFloat(tp)==0){var result=luckysheet.formula.error.d;}else {var result=parseFloat(fp)/parseFloat(tp);}}else {var result=luckysheet.formula.error.v;}return result;}}else if(sp=="+"||sp=="-"||sp=="%"){//加 减 取余
  if(luckysheet.getObjType(fp)=="array"&&luckysheet.getObjType(tp)=="array"){var result=[];if(luckysheet.getObjType(fp[0])=="array"&&luckysheet.getObjType(tp[0])=="array"){if(fp.length!=tp.length&&fp[0].length!=tp[0].length){return luckysheet.formula.error.na;}for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){fp[m][n]=booleanToNum(fp[m][n]);tp[m][n]=booleanToNum(tp[m][n]);if(luckysheet.func_methods.isRealNum(fp[m][n])&&luckysheet.func_methods.isRealNum(tp[m][n])){if(sp=="%"&&parseFloat(tp[m][n])==0){var value=luckysheet.formula.error.d;}else {var value=eval(parseFloat(fp[m][n])+sp+parseFloat(tp[m][n]));}}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else if(luckysheet.getObjType(fp[0])=="array"){if(fp[0].length!=tp.length){return luckysheet.formula.error.na;}for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){fp[m][n]=booleanToNum(fp[m][n]);tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp[m][n])&&luckysheet.func_methods.isRealNum(tp[n])){if(sp=="%"&&parseFloat(tp[n])==0){var value=luckysheet.formula.error.d;}else {var value=eval(parseFloat(fp[m][n])+sp+parseFloat(tp[n]));}}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else if(luckysheet.getObjType(tp[0])=="array"){if(tp[0].length!=fp.length){return luckysheet.formula.error.na;}for(var m=0;m<tp.length;m++){var rowArr=[];for(var n=0;n<tp[m].length;n++){fp[n]=booleanToNum(fp[n]);tp[m][n]=booleanToNum(tp[m][n]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp[m][n])){if(sp=="%"&&parseFloat(tp[m][n])==0){var value=luckysheet.formula.error.d;}else {var value=eval(parseFloat(fp[n])+sp+parseFloat(tp[m][n]));}}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {if(fp.length!=tp.length){return luckysheet.formula.error.na;}for(var n=0;n<fp.length;n++){fp[n]=booleanToNum(fp[n]);tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp[n])){if(sp=="%"&&parseFloat(tp[n])==0){var value=luckysheet.formula.error.d;}else {var value=eval(parseFloat(fp[n])+sp+parseFloat(tp[n]));}}else {var value=luckysheet.formula.error.v;}result.push(value);}}return result;}else if(luckysheet.getObjType(fp)=="array"){tp=booleanToNum(tp);var result=[];if(luckysheet.getObjType(fp[0])=="array"){for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){fp[m][n]=booleanToNum(fp[m][n]);if(luckysheet.func_methods.isRealNum(fp[m][n])&&luckysheet.func_methods.isRealNum(tp)){if(sp=="%"&&parseFloat(tp)==0){var value=luckysheet.formula.error.d;}else {var value=eval(parseFloat(fp[m][n])+sp+parseFloat(tp));}}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {for(var n=0;n<fp.length;n++){fp[n]=booleanToNum(fp[n]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp)){if(sp=="%"&&parseFloat(tp)==0){var value=luckysheet.formula.error.d;}else {var value=eval(parseFloat(fp[n])+sp+parseFloat(tp));}}else {var value=luckysheet.formula.error.v;}result.push(value);}}return result;}else if(luckysheet.getObjType(tp)=="array"){fp=booleanToNum(fp);var result=[];if(luckysheet.getObjType(tp[0])=="array"){for(var m=0;m<tp.length;m++){var rowArr=[];for(var n=0;n<tp[m].length;n++){tp[m][n]=booleanToNum(tp[m][n]);if(luckysheet.func_methods.isRealNum(fp)&&luckysheet.func_methods.isRealNum(tp[m][n])){if(sp=="%"&&parseFloat(tp[m][n])==0){var value=luckysheet.formula.error.d;}else {var value=eval(parseFloat(fp)+sp+parseFloat(tp[m][n]));}}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {for(var n=0;n<tp.length;n++){tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp)&&luckysheet.func_methods.isRealNum(tp[n])){if(sp=="%"&&parseFloat(tp[n])==0){var value=luckysheet.formula.error.d;}else {var value=eval(parseFloat(fp)+sp+parseFloat(tp[n]));}}else {var value=luckysheet.formula.error.v;}result.push(value);}}return result;}else {fp=booleanToNum(fp);tp=booleanToNum(tp);if(luckysheet.func_methods.isRealNum(fp)&&luckysheet.func_methods.isRealNum(tp)){if(sp=="%"&&parseFloat(tp)==0){var result=luckysheet.formula.error.d;}else {var result=eval(parseFloat(fp)+sp+parseFloat(tp));}}else {var result=luckysheet.formula.error.v;}return result;}}else if(sp=="=="||sp=="!="||sp==">="||sp=="<="||sp==">"||sp=="<"){//比较运算符
  if(luckysheet.getObjType(fp)=="array"&&luckysheet.getObjType(tp)=="array"){var result=[];if(luckysheet.getObjType(fp[0])=="array"&&luckysheet.getObjType(tp[0])=="array"){if(fp.length!=tp.length&&fp[0].length!=tp[0].length){return luckysheet.formula.error.na;}for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){var value=booleanOperation(fp[m][n],sp,tp[m][n]);rowArr.push(value);}result.push(rowArr);}}else if(luckysheet.getObjType(fp[0])=="array"){if(fp[0].length!=tp.length){return luckysheet.formula.error.na;}for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){var value=booleanOperation(fp[m][n],sp,tp[n]);rowArr.push(value);}result.push(rowArr);}}else if(luckysheet.getObjType(tp[0])=="array"){if(tp[0].length!=fp.length){return luckysheet.formula.error.na;}for(var m=0;m<tp.length;m++){var rowArr=[];for(var n=0;n<tp[m].length;n++){var value=booleanOperation(fp[n],sp,tp[m][n]);rowArr.push(value);}result.push(rowArr);}}else {if(fp.length!=tp.length){return luckysheet.formula.error.na;}for(var n=0;n<fp.length;n++){var value=booleanOperation(fp[n],sp,tp[n]);result.push(value);}}return result;}else if(luckysheet.getObjType(fp)=="array"){var result=[];if(luckysheet.getObjType(fp[0])=="array"){for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){var value=booleanOperation(fp[m][n],sp,tp);rowArr.push(value);}result.push(rowArr);}}else {for(var n=0;n<fp.length;n++){var value=booleanOperation(fp[n],sp,tp);result.push(value);}}return result;}else if(luckysheet.getObjType(tp)=="array"){var result=[];if(luckysheet.getObjType(tp[0])=="array"){for(var m=0;m<tp.length;m++){var rowArr=[];for(var n=0;n<tp[m].length;n++){var value=booleanOperation(fp,sp,tp[m][n]);rowArr.push(value);}result.push(rowArr);}}else {for(var n=0;n<tp.length;n++){var value=booleanOperation(fp,sp,tp[n]);result.push(value);}}return result;}else {return booleanOperation(fp,sp,tp);}}else if(sp=="&"){//连接符
  if(luckysheet.getObjType(fp)=="array"&&luckysheet.getObjType(tp)=="array"){var result=[];if(luckysheet.getObjType(fp[0])=="array"&&luckysheet.getObjType(tp[0])=="array"){if(fp.length!=tp.length&&fp[0].length!=tp[0].length){return luckysheet.formula.error.na;}for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){rowArr.push(fp[m][n]+""+tp[m][n]);}result.push(rowArr);}}else if(luckysheet.getObjType(fp[0])=="array"){if(fp[0].length!=tp.length){return luckysheet.formula.error.na;}for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){rowArr.push(fp[m][n]+""+tp[n]);}result.push(rowArr);}}else if(luckysheet.getObjType(tp[0])=="array"){if(tp[0].length!=fp.length){return luckysheet.formula.error.na;}for(var m=0;m<tp.length;m++){var rowArr=[];for(var n=0;n<tp[m].length;n++){rowArr.push(fp[n]+""+tp[m][n]);}result.push(rowArr);}}else {if(fp.length!=tp.length){return luckysheet.formula.error.na;}for(var n=0;n<fp.length;n++){result.push(fp[n]+""+tp[n]);}}return result;}else if(luckysheet.getObjType(fp)=="array"){var result=[];if(luckysheet.getObjType(fp[0])=="array"){for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){rowArr.push(fp[m][n]+""+tp);}result.push(rowArr);}}else {for(var n=0;n<fp.length;n++){result.push(fp[n]+""+tp);}}return result;}else if(luckysheet.getObjType(tp)=="array"){var result=[];if(luckysheet.getObjType(tp[0])=="array"){for(var m=0;m<tp.length;m++){var rowArr=[];for(var n=0;n<tp[m].length;n++){rowArr.push(fp+""+tp[m][n]);}result.push(rowArr);}}else {for(var n=0;n<tp.length;n++){result.push(fp+""+tp[n]);}}return result;}else {return fp+""+tp;}}else if(sp=="^"){//幂
  if(luckysheet.getObjType(fp)=="array"&&luckysheet.getObjType(tp)=="array"){var result=[];if(luckysheet.getObjType(fp[0])=="array"&&luckysheet.getObjType(tp[0])=="array"){if(fp.length!=tp.length&&fp[0].length!=tp[0].length){return luckysheet.formula.error.na;}for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){fp[m][n]=booleanToNum(fp[m][n]);tp[m][n]=booleanToNum(tp[m][n]);if(luckysheet.func_methods.isRealNum(fp[m][n])&&luckysheet.func_methods.isRealNum(tp[m][n])){var value=Math.pow(parseFloat(fp[m][n]),parseFloat(tp[m][n]));}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else if(luckysheet.getObjType(fp[0])=="array"){if(fp[0].length!=tp.length){return luckysheet.formula.error.na;}for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){fp[m][n]=booleanToNum(fp[m][n]);tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp[m][n])&&luckysheet.func_methods.isRealNum(tp[n])){var value=Math.pow(parseFloat(fp[m][n]),parseFloat(tp[n]));}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else if(luckysheet.getObjType(tp[0])=="array"){if(tp[0].length!=fp.length){return luckysheet.formula.error.na;}for(var m=0;m<tp.length;m++){var rowArr=[];for(var n=0;n<tp[m].length;n++){fp[n]=booleanToNum(fp[n]);tp[m][n]=booleanToNum(tp[m][n]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp[m][n])){var value=Math.pow(parseFloat(fp[n]),parseFloat(tp[m][n]));}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {if(fp.length!=tp.length){return luckysheet.formula.error.na;}for(var n=0;n<fp.length;n++){fp[n]=booleanToNum(fp[n]);tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp[n])){var value=Math.pow(parseFloat(fp[n]),parseFloat(tp[n]));}else {var value=luckysheet.formula.error.v;}result.push(value);}}return result;}else if(luckysheet.getObjType(fp)=="array"){tp=booleanToNum(tp);var result=[];if(luckysheet.getObjType(fp[0])=="array"){for(var m=0;m<fp.length;m++){var rowArr=[];for(var n=0;n<fp[m].length;n++){fp[m][n]=booleanToNum(fp[m][n]);if(luckysheet.func_methods.isRealNum(fp[m][n])&&luckysheet.func_methods.isRealNum(tp)){var value=Math.pow(parseFloat(fp[m][n]),parseFloat(tp));}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {for(var n=0;n<fp.length;n++){fp[n]=booleanToNum(fp[n]);if(luckysheet.func_methods.isRealNum(fp[n])&&luckysheet.func_methods.isRealNum(tp)){var value=Math.pow(parseFloat(fp[n]),parseFloat(tp));}else {var value=luckysheet.formula.error.v;}result.push(value);}}return result;}else if(luckysheet.getObjType(tp)=="array"){fp=booleanToNum(fp);var result=[];if(luckysheet.getObjType(tp[0])=="array"){for(var m=0;m<tp.length;m++){var rowArr=[];for(var n=0;n<tp[m].length;n++){tp[m][n]=booleanToNum(tp[m][n]);if(luckysheet.func_methods.isRealNum(fp)&&luckysheet.func_methods.isRealNum(tp[m][n])){var value=Math.pow(parseFloat(fp),parseFloat(tp[m][n]));}else {var value=luckysheet.formula.error.v;}rowArr.push(value);}result.push(rowArr);}}else {for(var n=0;n<tp.length;n++){tp[n]=booleanToNum(tp[n]);if(luckysheet.func_methods.isRealNum(fp)&&luckysheet.func_methods.isRealNum(tp[n])){var value=Math.pow(parseFloat(fp),parseFloat(tp[n]));}else {var value=luckysheet.formula.error.v;}result.push(value);}}return result;}else {fp=booleanToNum(fp);tp=booleanToNum(tp);if(luckysheet.func_methods.isRealNum(fp)&&luckysheet.func_methods.isRealNum(tp)){var result=Math.pow(parseFloat(fp),parseFloat(tp));}else {var result=luckysheet.formula.error.v;}return result;}}};window.luckysheet_getarraydata=function(){var fp=arguments[0];fp=fp.replace("{","").replace("}","").replace(/\"/g,'');var arr=[];if(fp.indexOf(";")>-1){arr=fp.split(";");for(var i=0;i<arr.length;i++){arr[i]=arr[i].split(",");}}else {arr=fp.split(",");}return arr;};window.luckysheet_getcelldata=function(txt){if(window.luckysheet_getcelldata_cache==null){window.luckysheet_getcelldata_cache={};}if(txt in window.luckysheet_getcelldata_cache){return window.luckysheet_getcelldata_cache[txt];}var luckysheetfile=luckysheet.getluckysheetfile();var val=txt.split("!");var sheettxt="",rangetxt="",sheetIndex=-1,sheetdata=null;if(val.length>1){sheettxt=val[0];rangetxt=val[1];for(var i in luckysheetfile){if(sheettxt==luckysheetfile[i].name){sheetIndex=luckysheetfile[i].index;sheetdata=luckysheetfile[i].data;break;}}if(sheetIndex==-1){sheetIndex=0;}}else {var index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);sheettxt=luckysheetfile[index].name;sheetIndex=luckysheetfile[index].index;sheetdata=luckysheet.flowdata;rangetxt=val[0];if(luckysheet.formula.execFunctionGroupData!=null){sheetdata=luckysheet.formula.execFunctionGroupData;}}if(rangetxt.indexOf(":")==-1){var row=parseInt(rangetxt.replace(/[^0-9]/g,""))-1;var col=luckysheet.luckysheetABCatNum(rangetxt.replace(/[^A-Za-z]/g,""));if(!isNaN(row)&&!isNaN(col)){var ret=luckysheet.getdatabyselectionD(sheetdata,{"row":[row,row],"column":[col,col]})[0][0];/*
                  if (ret instanceof Object) {
                      if(luckysheet.datecontroll.isdatetime(ret.m)){ //如果是时间格式，则获取m
                          ret = ret.m;
                      }else{
                          ret = ret.v; 
                      }
                      
                  }
                  */ // 获取对象，包含格式（ct）用于后续计算
  /*if (ret instanceof Object) {
                          ret = ret.v; //时间格式亦获取v
                  }*/ //return ret;
  //runze.liu New
  //范围的长宽
  var rowl=1;var coll=1;var retAll={"sheetName":sheettxt,"startCell":rangetxt,"rowl":rowl,"coll":coll,"data":ret};window.luckysheet_getcelldata_cache[txt]=retAll;return retAll;//runze.liu         
  }else {return [];}}else {rangetxt=rangetxt.split(":");var row=[],col=[];//console.log(rangetxt[0].replace(/[^0-9]/, ""), rangetxt[1].replace(/[^0-9]/, ""), rangetxt);
  row[0]=parseInt(rangetxt[0].replace(/[^0-9]/g,""))-1;row[1]=parseInt(rangetxt[1].replace(/[^0-9]/g,""))-1;if(isNaN(row[0])){row[0]=0;}if(isNaN(row[1])){row[1]=sheetdata.length-1;}if(row[0]>row[1]){luckysheet.tooltip.info("选择失败","输入范围错误！");return [];}col[0]=luckysheet.luckysheetABCatNum(rangetxt[0].replace(/[^A-Za-z]/g,""));col[1]=luckysheet.luckysheetABCatNum(rangetxt[1].replace(/[^A-Za-z]/g,""));if(isNaN(col[0])){col[0]=0;}if(isNaN(col[1])){col[1]=sheetdata[0].length-1;}if(col[0]>col[1]){luckysheet.tooltip.info("选择失败","输入范围错误！");return [];}//if (!isNaN(row)) {
  //    return luckysheet.getdatabyselectionD(sheetdata, { "row": [row, row], "column": [0, sheetdata[0].length - 1] });
  //}
  //else if (!isNaN(col)) {
  //    return luckysheet.getdatabyselectionD(sheetdata, { "row": [0, sheetdata.length - 1], "column": [col, col] });
  //}
  //console.log("sheetData::",sheetdata);
  var ret=luckysheet.getdatabyselectionD(sheetdata,{"row":row,"column":col});//return ret;
  //runze.liu New
  //范围的长宽
  var rowl=row[1]-row[0]+1;var coll=col[1]-col[0]+1;var retAll={"sheetName":sheettxt,"startCell":rangetxt[0],"rowl":rowl,"coll":coll,"data":ret};window.luckysheet_getcelldata_cache[txt]=retAll;//console.log("所有的："+retAll.sheetName,retAll.startCell,retAll.rowl,retAll.coll,retAll.data);
  return retAll;//runze.liu
  }};//解析单个取得的值，有字符串，数字，引用单元格或者函数
  window.luckysheet_parseData=function(value){if(_typeof(value)==="object"){if(value==null){return "";}else if(Array.isArray(value)){//函数返回的带期望格式的数组，可提取格式
  var v=luckysheet.mask.genarate(value[0]);return v[2];}else {//getcelldat引用单元格对象，带有格式
  if(Array.isArray(value.data)){//单元格区域
  return luckysheet.formula.error.v;}else {//单个单元格
  if(value.data.v===undefined){return "";}else {return value.data.v;}}}}else if(!luckysheet.formula.isCompareOperator(value).flag){var v=luckysheet.mask.genarate(value);return v[2];}else if(typeof value==="string"||typeof value==="number"){return value;}return luckysheet.formula.error.v;};window.luckysheet_getValue=function(){//解析获取函数参数，无格式，且可包含带操作符的">5"
  //数据类型：1.手动输入或函数返回的字符串，普通字符串或数字直接取值，特殊格式需转化 如："2019-1-1"（特殊格式转化为数字）、">5"或数字
  //2.引用单元格对象，取得二维数组或单个的v 如：A1
  //3.函数返回的带期望格式的数组，取得第一个参数，转化为数字 如：["2019-1-1",true]
  var args=arguments[0];for(var i=0;i<args.length;i++){var value=args[i];if(_typeof(value)==="object"){if(value==null){value="";}else if(Array.isArray(value)){//函数返回的带期望格式的数组，可提取格式
  var v=luckysheet.mask.genarate(value[0]);value=v[2];}else {//getcelldat引用单元格对象，带有格式
  if(Array.isArray(value.data)){//单元格区域
  value=value.data;}else {//单个单元格
  if(value.data.v===undefined){//空白单元格
  value="";}else {value=value.data.v;}}}}else if(!luckysheet.formula.isCompareOperator(value).flag){var v=luckysheet.mask.genarate(value);value=v[2];}args[i]=value;}};luckysheet.formula={error:{v:"#VALUE!",//错误的参数或运算符
  n:"#NAME?",//公式名称错误
  na:"#N/A",//函数或公式中没有可用数值
  r:"#REF!",//删除了由其他公式引用的单元格
  d:"#DIV/0!",//除数是0或空单元格
  nm:"#NUM!",//当公式或函数中某个数字有问题时
  nl:"#NULL!",//交叉运算符（空格）使用不正确
  sp:"#SPILL!"//数组范围有其它值
  },errorInfo:function errorInfo(err){return err;},errorParamCheck:function errorParamCheck(thisp,data,i){if(i<thisp.length){var type=thisp[i].type;var require=thisp[i].require;}else {var type=thisp[thisp.length-1].type;var require=thisp[thisp.length-1].require;}if(require=="o"&&(data==null||data=="")){return [true,"成功"];}if(type.indexOf("all")>-1){return [true,"成功"];}else {if(type.indexOf("range")>-1&&(luckysheet.getObjType(data)=="object"||luckysheet.getObjType(data)=="array")){return [true,"成功"];}if(type.indexOf("number")>-1&&(luckysheet.func_methods.isRealNum(data)||luckysheet.getObjType(data)=="boolean")){return [true,"成功"];}if(type.indexOf("string")>-1&&luckysheet.getObjType(data)=="string"){return [true,"成功"];}if(type.indexOf("date")>-1&&luckysheet.datecontroll.isdatetime(data)){return [true,"成功"];}return [false,"参数类型错误"];}},getPureValueByData:function getPureValueByData(data){if(data.length==0){return [];}var output=[];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"){for(var r=0;r<data.length;r++){var row=[];for(var c=0;c<data[0].length;c++){var cell=data[r][c];if(luckysheet.getObjType(cell)=="object"){row.push(cell.v);}else {row.push(cell);}}output.push(row);}}else {for(var i=0;i<data.length;i++){var cell=data[i];if(luckysheet.getObjType(cell)=="object"){output.push(cell.v);}else {output.push(cell);}}}}else {var cell=data;if(luckysheet.getObjType(cell)=="object"){output.push(cell.v);}else {output.push(cell);}}return output;},//sparklines添加
  readCellDataToOneArray:function readCellDataToOneArray(rangeValue){if(rangeValue==null){return [];}if(luckysheet.getObjType(rangeValue)!="object"){return [rangeValue];}var dataformat=[];var data=[];if(rangeValue!=null&&rangeValue.data!=null){data=rangeValue.data;}else if(rangeValue!=null&&!luckysheet.func_methods.isRealNull(rangeValue.v)){return [rangeValue.v];}else {return [];}//适配excel的动态数组格式，{1，2，3，4，5}或者{{1，2，3}，{4，5，6}，{7，8，9}}
  if(luckysheet.getObjType(data)=="array"){data=luckysheet.formula.getPureValueByData(data);}else if(luckysheet.getObjType(data)=="object"){data=data.v;return [data];}else {if(/\{.*?\}/.test(data)){data=data.replace(/\{/g,"[").replace(/\}/g,"]");}data=eval('('+data+')');}//把二维数组转换为一维数组，sparklines要求数据格式为一维数组
  //var dataformat = [];
  if(luckysheet.getObjType(data[0])=="array"){for(var i=0;i<data.length;i++){dataformat=dataformat.concat(data[i]);}}else {dataformat=data;}return dataformat;},//sparklines添加
  //获得函数里某个参数的值，使用此函数需要在函数中执行luckysheet_getValue方法
  getValueByFuncData:function getValueByFuncData(value,arg){if(value==null){return null;}if(luckysheet.getObjType(value)=="array"){if(arg=="avg"){return window.luckysheet_function.AVERAGE.f.apply(window.luckysheet_function.AVERAGE,value);}else if(arg=="sum"){return window.luckysheet_function.SUM.f.apply(window.luckysheet_function.SUM,value);}else {if(luckysheet.getObjType(value[0])=="object"){return luckysheet.mask.getValueByFormat(value[0]);}else {return value[0];}}}else if(luckysheet.getObjType(value)=="object"){return luckysheet.mask.getValueByFormat(value);}else {return value;}},//sparklines添加
  sparklinesColorMap:function sparklinesColorMap(args,len){var colorLists=null;if(len==null){len=5;}if(args.length>len){for(var i=len;i<args.length;i++){var colorMap=args[i];var colorListArray=luckysheet.formula.readCellDataToOneArray(colorMap);for(var a=0;a<colorListArray.length;a++){var ca=colorListArray[a];if(ca.indexOf(":")>-1){if(!colorLists){colorLists={};}var calist=ca.split(":");if(calist.length==2){colorLists[calist[0]]=calist[1];}else if(calist.length>1){colorLists[calist[0]+":"+calist[1]]=calist[2];}}else {if(!colorLists){colorLists=[];}colorLists.push(ca);}}}}return colorLists;},//sparklines添加
  colorList:["#2ec7c9","#fc5c5c","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],classlist:{"province":{11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"}},oldvalue:null,dontupdate:function dontupdate(){luckysheetCellUpdate.length=0;//clear array
  $("#luckysheet-functionbox-cell, #luckysheet-rich-text-editor").html(this.oldvalue);//luckysheet.formula.rangestart = false;
  this.cancelNormalSelected();if(luckysheet.formula.rangetosheet!=luckysheet.currentSheetIndex){luckysheet.sheetmanage.changeSheetExec(luckysheet.formula.rangetosheet);}//luckysheetMoveHighlightCell("down", 0);
  },fucntionboxshow:function fucntionboxshow(r,c){var d=luckysheet.flowdata;var value="";if(d[r]!=null&&d[r][c]!=null&&d[r][c].v!=null){var cell=d[r][c];if(cell.f!=null){value=luckysheet.getcellvalue(r,c,d,"f");}else {value=luckysheet.mask.valueShowEs(r,c,d);}}this.oldvalue=value;$("#luckysheet-functionbox-cell").html(value);},//获得某个单元格或区域的偏移一定距离后的单元格( Sheet1!B6:C8 格式)
  cellOffset:function cellOffset(range,rows,cols,height,width){// 参数：range or cell , rows,cols,height,width
  var startCell=range.startCell;var rowl=range.rowl;var coll=range.coll;var startCellRow=parseInt(startCell.replace(/[^0-9]/g,""));var startCellCol=luckysheet.luckysheetABCatNum(startCell.replace(/[^A-Za-z]/g,""));var row=[],col=[],offsetRange;row[0]=startCellRow+rows;col[0]=startCellCol+cols;row[1]=row[0]+height-1;col[1]=col[0]+width-1;col[0]=luckysheet.luckysheetchatatABC(col[0]);col[1]=luckysheet.luckysheetchatatABC(col[1]);var cellF=col[0]+row[0];var cellL=col[1]+row[1];if(cellF==cellL){offsetRange=range.sheetName+"!"+cellF;}else {offsetRange=range.sheetName+"!"+cellF+":"+cellL;}return offsetRange;},parseDatetoNum:function parseDatetoNum(date){//函数中获取到时间格式或者数字形式统一转化为数字进行运算 
  if(_typeof(date)=="object"&&typeof date.v=="number"){date=date.v;}else if(luckysheet.isdatatype(date)=="num"){date=parseFloat(date);}else if(luckysheet.isdatatype(date)=="date"){date=luckysheet.mask.genarate(date)[2];}else {return luckysheet.formula.error.v;}return date;},//获取一维数组
  getRangeArray:function getRangeArray(range){var rangeNow=[];var fmt="General";if(range.length==1){//一行
  for(var c=0;c<range[0].length;c++){if(range[0][c]!=null&&range[0][c].v){rangeNow.push(range[0][c].v);var f=range[0][c].ct.fa;fmt=fmt=="General"?f:fmt;}else {//若单元格为null或为空，此处推入null（待考虑是否使用"null"）
  rangeNow.push(null);}}}else if(range[0].length==1){//一列
  for(var r=0;r<range.length;r++){if(range[r][0]!=null&&range[r][0].v){rangeNow.push(range[r][0].v);var f=range[r][0].ct.fa;fmt=fmt=="General"?f:fmt;}else {rangeNow.push(null);}}}else {for(var r=0;r<range.length;r++){for(var c=0;c<range[r].length;c++){if(range[r][c]!=null&&range[r][c].v){rangeNow.push(range[r][c].v);var f=range[r][c].ct.fa;fmt=fmt=="General"?f:fmt;}else {rangeNow.push(null);}}}}range=rangeNow;return [range,fmt];},//获取二维数组：qksheet格式[[{v,m,ct}] ==> [1]
  getRangeArrayTwo:function getRangeArrayTwo(range){var data=$.extend(true,[],range);if(data.length==1){//一行
  for(var c=0;c<data[0].length;c++){if(data[0][c]instanceof Object){if(data[0][c]!=null&&data[0][c]instanceof Object&&!!data[0][c].m){data[0][c]=data[0][c].m;}else {if(data[0][c]!=null&&data[0][c]instanceof Object&&!!data[0][c].v){data[0][c]=data[0][c].v;}else {data[0][c]=null;}}}}}else if(data[0].length==1){//一列
  for(var r=0;r<data.length;r++){if(data[r][0]instanceof Object){if(data[r][0]!=null&&data[r][0]instanceof Object&&!!data[r][0].m){data[r][0]=data[r][0].m;}else {if(data[r][0]!=null&&data[r][0]instanceof Object&&!!data[r][0].v){data[r][0]=data[r][0].v;}else {data[r][0]=null;}}}}}else {for(var r=0;r<data.length;r++){for(var c=0;c<data[r].length;c++){if(data[r][c]instanceof Object){if(data[r][c]!=null&&data[r][c]instanceof Object&&!!data[r][c].m){data[r][c]=data[r][c].m;}else {if(data[r][c]!=null&&data[r][c]instanceof Object&&!!data[r][c].v){data[r][c]=data[r][c].v;}else {data[r][c]=null;}}}}}}return data;},isWildcard:function isWildcard(a,b){//正则匹配通配符: * ? ~* ~?,a目标参数，b通配符
  a=a.toString();b=b.toString();if(luckysheet.formula.isCompareOperator(b).flag){b=luckysheet.formula.isCompareOperator(b).num;}var str="";for(var i=0;i<b.length;i++){var v=b.charAt(i);if(v=="*"){str+=".*";}else if(v=="?"){str+=".";}else if(v=="~"){if(b.charAt(i+1)=="*"){str+="\\*";i++;}else if(b.charAt(i+1)=="?"){str+="\\?";i++;}else {str+="~";}}else {str+=v;}}var reg=new RegExp("^"+str+"$","g");return !!a.match(reg);},isCompareOperator:function isCompareOperator(str){//判断前一个或者两个字符是否是比较运算符
  str=str.toString();var ope="";//存放比较运算符
  var num="";//截取比较运算符之后的数字用于实际比较
  var strOne=str.substr(0,1);var strTwo=str.substr(1,1);var flag=false;var ret;if(strOne==">"){if(strTwo=="="){ope=str.substr(0,2);num=str.substr(2);flag=true;}else if(strTwo!="="){ope=str.substr(0,1);num=str.substr(1);flag=true;}}else if(strOne=="<"){if(strTwo=="="||strTwo==">"){ope=str.substr(0,2);num=str.substr(2);flag=true;}else if(strTwo!="="&&strTwo!=">"){ope=str.substr(0,1);num=str.substr(1);flag=true;}}else if(strOne=="="&&strTwo!="="){ope=str.substr(0,1);num=str.substr(1);flag=true;}ret={"flag":flag,"ope":ope,"num":num};//console.log("字符串：",flag,ope,num);
  return ret;},acompareb:function acompareb(a,b){//a 与 b比较，b可为含比较符，通配符
  var flag=false;// if(luckysheet.isdatatype(b) == "num"){
  if(luckysheet.func_methods.isRealNum(b)){flag=luckysheet_compareWith(a,"==",b);}else if(typeof b=="string"){//条件输入字符串，如：">233"
  if(b.indexOf("*")!=-1||b.indexOf("?")!=-1){// 正则匹配：输入通配符："黑*","白?",以及"白?黑*~*"
  //通配符函数
  return luckysheet.formula.isWildcard(a,b);}else if(luckysheet.formula.isCompareOperator(b).flag){//"黑糖"
  var ope=luckysheet.formula.isCompareOperator(b).ope;var num=luckysheet.formula.isCompareOperator(b).num;flag=luckysheet_compareWith(a,ope,num);}else {flag=luckysheet_compareWith(a,"==",b);}}return flag;},compareParams:function compareParams(fp,sp,sym){//比较两个字符串或者数字的大小，支持比较对象,暂不支持数组
  var flag=false;//判断a和b的数据类型
  var classNameA=toString.call(fp),classNameB=toString.call(sp);if(sym==">"){if(fp>sp){flag=true;}}else if(sym==">="){if(fp>=sp){flag=true;}}else if(sym=="<"){if(fp<sp){flag=true;}}else if(sym=="<="){if(fp<=sp){flag=true;}}else if(sym=="="){if(fp==sp){flag=true;}}else if(sym=="<>"){if(fp!=sp){flag=true;}}//对象类型比较相等
  if(classNameA=='[object Object]'&&classNameB=='[object Object]'){//获取a和b的属性长度
  var propsA=Object.getOwnPropertyNames(fp),propsB=Object.getOwnPropertyNames(sp);if(propsA.length!=propsB.length){return false;}for(var i=0;i<propsA.length;i++){var propName=propsA[i];//如果对应属性对应值不相等，则返回false
  if(fp[propName]!==sp[propName]){return false;}}return true;}//数组类型
  if(classNameA=='[object Array]'&&classNameB=='[object Array]'){if(fp.toString()==sp.toString()){return true;}return false;}return flag;},parseDecimal:function parseDecimal(num){var num=parseFloat(num);var d=parseInt(num,10);if(d==0){return num;}num=num%d;return num;},getcellrange:function getcellrange(txt){var val=txt.split("!");var sheettxt="",rangetxt="",sheetIndex=-1,sheetdata=null;var luckysheetfile=luckysheet.getluckysheetfile();if(val.length>1){sheettxt=val[0];rangetxt=val[1];for(var i in luckysheetfile){if(sheettxt==luckysheetfile[i].name){sheetIndex=luckysheetfile[i].index;sheetdata=luckysheetfile[i].data;break;}}}else {var index=luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex);sheettxt=luckysheetfile[index].name;sheetIndex=luckysheetfile[index].index;sheetdata=luckysheet.flowdata;rangetxt=val[0];}if(rangetxt.indexOf(":")==-1){var row=parseInt(rangetxt.replace(/[^0-9]/g,""))-1;var col=luckysheet.luckysheetABCatNum(rangetxt.replace(/[^A-Za-z]/g,""));if(!isNaN(row)&&!isNaN(col)){return {"row":[row,row],"column":[col,col],"sheetIndex":sheetIndex};}//else if (!isNaN(row)) {
  //    return { "row": [row, row], "column": [0, sheetdata[0].length - 1], "sheetIndex": sheetIndex };
  //}
  //else if (!isNaN(col)) {
  //    return { "row": [0, sheetdata.length - 1], "column": [col, col], "sheetIndex": sheetIndex };
  //}
  else {return null;}}else {rangetxt=rangetxt.split(":");var row=[],col=[];//console.log(rangetxt[0].replace(/[^0-9]/, ""), rangetxt[1].replace(/[^0-9]/, ""), rangetxt);
  row[0]=parseInt(rangetxt[0].replace(/[^0-9]/g,""))-1;row[1]=parseInt(rangetxt[1].replace(/[^0-9]/g,""))-1;if(isNaN(row[0])){row[0]=0;}if(isNaN(row[1])){row[1]=sheetdata.length-1;}if(row[0]>row[1]){return null;}col[0]=luckysheet.luckysheetABCatNum(rangetxt[0].replace(/[^A-Za-z]/g,""));col[1]=luckysheet.luckysheetABCatNum(rangetxt[1].replace(/[^A-Za-z]/g,""));if(isNaN(col[0])){col[0]=0;}if(isNaN(col[1])){col[1]=sheetdata[0].length-1;}if(col[0]>col[1]){return null;}return {"row":row,"column":col,"sheetIndex":sheetIndex};}},rangeHightlightHTML:'<div id="luckysheet-formula-functionrange-highlight-${id}" rangeindex="${id}"  class="luckysheet-selection-highlight luckysheet-formula-functionrange-highlight"><div data-type="top" class="luckysheet-selection-copy-top luckysheet-copy"></div><div data-type="right" class="luckysheet-selection-copy-right luckysheet-copy"></div><div data-type="bottom" class="luckysheet-selection-copy-bottom luckysheet-copy"></div><div data-type="left" class="luckysheet-selection-copy-left luckysheet-copy"></div><div class="luckysheet-selection-copy-hc"></div><div data-type="lt" class="luckysheet-selection-highlight-topleft luckysheet-highlight"></div><div data-type="rt" class="luckysheet-selection-highlight-topright luckysheet-highlight"></div><div data-type="lb" class="luckysheet-selection-highlight-bottomleft luckysheet-highlight"></div><div data-type="rb" class="luckysheet-selection-highlight-bottomright luckysheet-highlight"></div></div>',createRangeHightlight:function createRangeHightlight(){var $span=$("#luckysheet-rich-text-editor").find("span.luckysheet-formula-functionrange-cell");$("#luckysheet-formula-functionrange .luckysheet-formula-functionrange-highlight").remove();$span.each(function(){var rangeindex=$(this).attr("rangeindex"),range=$(this).text();$("#luckysheet-formula-functionrange").append(luckysheet.replaceHtml(luckysheet.formula.rangeHightlightHTML,{"id":rangeindex}));var cellrange=luckysheet.formula.getcellrange(range);var rangeid="luckysheet-formula-functionrange-highlight-"+rangeindex;if(cellrange==null);else if(cellrange.sheetIndex==luckysheet.currentSheetIndex||cellrange.sheetIndex==-1&&luckysheet.formula.rangetosheet==luckysheet.currentSheetIndex){$("#"+rangeid).data("range",cellrange).find(".luckysheet-copy").css({"background":luckysheet.jfcolor[rangeindex]}).end().find(".luckysheet-highlight").css({"background":luckysheet.jfcolor[rangeindex]}).end().find(".luckysheet-selection-copy-hc").css({"background":luckysheet.jfcolor[rangeindex]});luckysheet.seletedHighlistByindex(rangeid,cellrange.row[0],cellrange.row[1],cellrange.column[0],cellrange.column[1]);}});$("#luckysheet-formula-functionrange .luckysheet-formula-functionrange-highlight").show();},searchHTML:'<div id="luckysheet-formula-search-c" class="luckysheet-formula-search-c"></div>',helpHTML:'<div id="luckysheet-formula-help-c" class="luckysheet-formula-help-c"> <div class="luckysheet-formula-help-close" title="关闭"><i class="fa fa-times" aria-hidden="true"></i></div> <div class="luckysheet-formula-help-collapse" title="收起"><i class="fa fa-angle-up" aria-hidden="true"></i></div> <div class="luckysheet-formula-help-title"><div class="luckysheet-formula-help-title-formula"> <span class="luckysheet-arguments-help-function-name">SUM</span> <span class="luckysheet-arguments-paren">(</span> <span class="luckysheet-arguments-parameter-holder"> <span class="luckysheet-arguments-help-parameter luckysheet-arguments-help-parameter-active" dir="auto">A2:A100</span>, <span class="luckysheet-arguments-help-parameter" dir="auto">101</span> </span> <span class="luckysheet-arguments-paren">)</span> </div></div> <div class="luckysheet-formula-help-content"> <div class="luckysheet-formula-help-content-example"> <div class="luckysheet-arguments-help-section-title">示例</div> <div class="luckysheet-arguments-help-formula"> <span class="luckysheet-arguments-help-function-name">SUM</span> <span class="luckysheet-arguments-paren">(</span> <span class="luckysheet-arguments-parameter-holder"> <span class="luckysheet-arguments-help-parameter luckysheet-arguments-help-parameter-active" dir="auto">A2:A100</span>, <span class="luckysheet-arguments-help-parameter" dir="auto">101</span> </span> <span class="luckysheet-arguments-paren">)</span> </div> </div> <div class="luckysheet-formula-help-content-detail"> <div class="luckysheet-arguments-help-section"> <div class="luckysheet-arguments-help-section-title luckysheet-arguments-help-parameter-name">摘要</div> <span class="luckysheet-arguments-help-parameter-content">${detail}</span> </div> </div> <div class="luckysheet-formula-help-content-param"> ${param} </div> </div> <div class="luckysheet-formula-help-foot"></div></div>',getrangeseleciton:function getrangeseleciton(){var currSelection=window.getSelection();var anchor=$(currSelection.anchorNode);var anchorOffset=currSelection.anchorOffset;//console.log(anchor,anchorOffset, anchor.is("#luckysheet-functionbox-cell"), anchor.attr("id"));
  if(anchor.parent().is("span")&&anchorOffset!=0){var txt=$.trim(anchor.text()),lasttxt="";if(txt.length==0&&anchor.parent().prev().length>0){var ahr=anchor.parent().prev();txt=$.trim(ahr.text());lasttxt=txt.substr(txt.length-1,1);return ahr;}else {lasttxt=txt.substr(anchorOffset-1,1);return anchor.parent();}}else if(anchor.is("#luckysheet-rich-text-editor")||anchor.is("#luckysheet-functionbox-cell")){var txt=$.trim(anchor.find("span").last().text()),lasttxt;if(txt.length==0&&anchor.find("span").length>1){var ahr=anchor.find("span");txt=$.trim(ahr.eq(ahr.length-2).text());return ahr;}else {return anchor.find("span").last();}}else if(anchor.parent().is("#luckysheet-rich-text-editor")||anchor.parent().is("#luckysheet-functionbox-cell")||anchorOffset==0){if(anchorOffset==0){anchor=anchor.parent();}if(anchor.prev().length>0){var txt=$.trim(anchor.prev().text());var lasttxt=txt.substr(txt.length-1,1);return anchor.prev();}}return null;},searchFunctionPosition:function searchFunctionPosition($menu,$editor,x,y,isparam){var winH=$(window).height(),winW=$(window).width();var menuW=$menu.outerWidth(),menuH=$menu.outerHeight();if(isparam==null){isparam=false;}var top=y,left=x;if(x+menuW>winW){left=x-menuW+$editor.outerWidth();}else {left=x;}if(y+menuH>winH){top=y-menuH;}else {top=y+$editor.outerHeight();if(!isparam){$menu.html($menu.find(".luckysheet-formula-search-item").get().reverse());}}if(top<0){top=0;}if(left<0){left=0;}$menu.css({"top":top,"left":left}).show();},searchFunctionCell:null,searchFunction:function searchFunction($editer){//$editer.closest(".luckysheet-formula-text-color")
  var $cell=this.getrangeseleciton();this.searchFunctionCell=$cell;if($cell==null||$editer==null){return;}var searchtxt=$cell.text().toUpperCase();var reg=/^[a-zA-Z]|[a-zA-Z_]+$/;//console.log(searchtxt, !reg.test(searchtxt), $editer);
  if(!reg.test(searchtxt)){return;}var result={"f":[],"s":[],"t":[]},result_i=0;for(var i=0;i<luckysheet.functionlist.length;i++){var item=luckysheet.functionlist[i],n=item.n;//console.log(n, searchtxt);
  if(n==searchtxt){result.f.unshift(item);result_i++;}else if(n.substr(0,searchtxt.length)==searchtxt){result.s.unshift(item);result_i++;}else if(n.indexOf(searchtxt)>-1){result.t.unshift(item);result_i++;}if(result_i>=10){break;}}//console.log(result, result_i);
  var list=result.t.concat(result.s.concat(result.f));if(list.length<=0){return;}var listHTML=this.searchFunctionHTML(list);$("#luckysheet-formula-search-c").html(listHTML).show();$("#luckysheet-formula-help-c").hide();var $c=$editer.parent(),offset=$c.offset();this.searchFunctionPosition($("#luckysheet-formula-search-c"),$c,offset.left,offset.top);},searchFunctionEnter:function searchFunctionEnter($obj){var functxt=$obj.data("func");luckysheet.formula.searchFunctionCell.text(functxt).after('<span dir="auto" class="luckysheet-formula-text-color">(</span>');luckysheet.formula.setCaretPosition(luckysheet.formula.searchFunctionCell.next().get(0),0,1);$("#luckysheet-formula-search-c").hide();this.helpFunctionExe(luckysheet.formula.searchFunctionCell.closest("div"),luckysheet.formula.searchFunctionCell.next());},searchFunctionHTML:function searchFunctionHTML(list){if($("#luckysheet-formula-search-c").length==0){$("body").append(this.searchHTML);$("#luckysheet-formula-search-c").on("mouseover",".luckysheet-formula-search-item",function(){$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").removeClass("luckysheet-formula-search-item-active");$(this).addClass("luckysheet-formula-search-item-active");}).on("mouseout",".luckysheet-formula-search-item",function(){}).on("click",".luckysheet-formula-search-item",function(){if(luckysheet.formula.searchFunctionCell==null){return;}luckysheet.formula.searchFunctionEnter($(this));});}var itemHTML='<div data-func="${n}" class="luckysheet-formula-search-item ${class}"><div class="luckysheet-formula-search-func">${n}</div><div class="luckysheet-formula-search-detail">${a}</div></div>';var retHTML="";for(var i=0;i<list.length;i++){var item=list[i];if(i==list.length-1){retHTML+=luckysheet.replaceHtml(itemHTML,{"class":"luckysheet-formula-search-item-active","n":item.n,"a":item.a});}else {retHTML+=luckysheet.replaceHtml(itemHTML,{"class":"","n":item.n,"a":item.a});}}return retHTML;},functionlistPosition:{},helpFunction:function helpFunction($editer,funcname,paramIndex){var $func=luckysheet.functionlist[this.functionlistPosition[$.trim(funcname).toUpperCase()]];//console.log();
  if($func==null){return;}$("#luckysheet-formula-help-c .luckysheet-arguments-help-function-name").html($func.n);$("#luckysheet-formula-help-c .luckysheet-arguments-help-parameter-content").html($func.d);var helpformulaArg='<div class="luckysheet-arguments-help-section"><div class="luckysheet-arguments-help-section-title">${param}</div><span class="luckysheet-arguments-help-parameter-content">${content}</span></div>';//"n": "AVERAGE",
  //"t": "1",
  //"d": "返回数据集的算术平均值，对文本忽略不计。",
  //"a": "返回数据集的算术平均值",
  //"p": [{ "name": "数值1", "example": "A2:A100", "detail": "计算平均值时用到的第一个数值或范围。", "require": "m", "repeat": "n", "type": "rangenumber" },
  //    { "name": "数值2", "example": "B2:B100", "detail": "计算平均值时用到的其他数值或范围。", "require": "o", "repeat": "y", "type": "rangenumber" }
  //]
  var fht="",ahf="",fhcp="";for(var i=0;i<$func.p.length;i++){var paramitem=$func.p[i];var name=paramitem.name,nameli=paramitem.name;if(paramitem.repeat=="y"){name+=", ...";nameli+='<span class="luckysheet-arguments-help-argument-info">...-可重复</span>';}if(paramitem.require=="o"){name="["+name+"]";nameli+='<span class="luckysheet-arguments-help-argument-info">-[可选]</span>';}fht+='<span class="luckysheet-arguments-help-parameter" dir="auto">'+name+'</span>, ';ahf+='<span class="luckysheet-arguments-help-parameter" dir="auto">'+paramitem.example+'</span>, ';fhcp+=luckysheet.replaceHtml(helpformulaArg,{"param":nameli,"content":paramitem.detail});}fht=fht.substr(0,fht.length-2);ahf=ahf.substr(0,ahf.length-2);$("#luckysheet-formula-help-c .luckysheet-formula-help-title .luckysheet-arguments-parameter-holder").html(fht);//介绍
  $("#luckysheet-formula-help-c .luckysheet-arguments-help-formula .luckysheet-arguments-parameter-holder").html(ahf);//示例
  $("#luckysheet-formula-help-c .luckysheet-formula-help-content-param").html(fhcp);//参数
  if(paramIndex==null){$("#luckysheet-formula-help-c .luckysheet-formula-help-title-formula .luckysheet-arguments-help-function-name").css("font-weight","bold");}else {$("#luckysheet-formula-help-c .luckysheet-formula-help-title-formula .luckysheet-arguments-help-function-name").css("font-weight","normal");var index=paramIndex>=$func.p.length?$func.p.length-1:paramIndex;$("#luckysheet-formula-help-c .luckysheet-formula-help-title .luckysheet-arguments-parameter-holder .luckysheet-arguments-help-parameter").removeClass("luckysheet-arguments-help-parameter-active");$("#luckysheet-formula-help-c .luckysheet-formula-help-title .luckysheet-arguments-parameter-holder .luckysheet-arguments-help-parameter").eq(index).addClass("luckysheet-arguments-help-parameter-active");$("#luckysheet-formula-help-c .luckysheet-arguments-help-formula .luckysheet-arguments-parameter-holder .luckysheet-arguments-help-parameter").removeClass("luckysheet-arguments-help-parameter-active");$("#luckysheet-formula-help-c .luckysheet-arguments-help-formula .luckysheet-arguments-parameter-holder .luckysheet-arguments-help-parameter").eq(index).addClass("luckysheet-arguments-help-parameter-active");$("#luckysheet-formula-help-c .luckysheet-formula-help-content-param .luckysheet-arguments-help-section").removeClass("luckysheet-arguments-help-parameter-active");$("#luckysheet-formula-help-c .luckysheet-formula-help-content-param .luckysheet-arguments-help-section").eq(index).addClass("luckysheet-arguments-help-parameter-active");}var $c=$editer.parent(),offset=$c.offset();this.searchFunctionPosition($("#luckysheet-formula-help-c"),$c,offset.left,offset.top,true);},helpFunctionExe:function helpFunctionExe($editer,currSelection){if($("#luckysheet-formula-help-c").length==0){$("body").after(this.helpHTML);$("#luckysheet-formula-help-c .luckysheet-formula-help-close").click(function(){$("#luckysheet-formula-help-c").hide();});$("#luckysheet-formula-help-c .luckysheet-formula-help-collapse").click(function(){var $content=$("#luckysheet-formula-help-c .luckysheet-formula-help-content");$content.slideToggle(100,function(){var $c=luckysheet.formula.rangeResizeTo.parent(),offset=$c.offset();luckysheet.formula.searchFunctionPosition($("#luckysheet-formula-help-c"),$c,offset.left,offset.top,true);});if($content.is(":hidden")){$(this).html('<i class="fa fa-angle-up" aria-hidden="true"></i>');}else {$(this).html('<i class="fa fa-angle-down" aria-hidden="true"></i>');}});for(var i=0;i<luckysheet.functionlist.length;i++){this.functionlistPosition[luckysheet.functionlist[i].n]=i;}}if(!currSelection){return;}var $prev=currSelection,funcLen=$editer.length,$span=$editer.find("span"),currentIndex=currSelection.index(),i=currentIndex;if($prev==null){return;}// while ($prev.text() != "(" && $prev.text() != "=" && $prev.length > 0) {
  //     // if (i > 0 && this.iscelldata($prev.text())) {
  //     //     paramindex++;
  //     // }
  //     if (i > 0 && $prev.attr("rangeindex") != null) {
  //         paramindex++;
  //     }
  //     $prev = $prev.prev();
  //     i++;
  // }
  var funcName=null,paramindex=null;if($span.eq(i).is(".luckysheet-formula-text-func")){funcName=$span.eq(i).text();}else {var $cur=null,exceptIndex=[-1,-1];while(--i>0){$cur=$span.eq(i);if($cur.is(".luckysheet-formula-text-func")||$.trim($cur.text()).toUpperCase()in this.functionlistPosition){funcName=$cur.text();paramindex=null;var endstate=true;for(var a=i;a<=currentIndex;a++){if(!paramindex){paramindex=0;}if(a>=exceptIndex[0]&&a<=exceptIndex[1]){continue;}$cur=$span.eq(a);if($cur.is(".luckysheet-formula-text-rpar")){exceptIndex=[i,a];funcName=null;endstate=false;break;}if($cur.is(".luckysheet-formula-text-comma")){paramindex++;}}if(endstate){break;}}}}if(funcName==null){return;}this.helpFunction($editer,funcName,paramindex);},rangeHightlightselected:function rangeHightlightselected($editer,kcode){var currSelection=this.getrangeseleciton();$("#luckysheet-formula-search-c, #luckysheet-formula-help-c").hide();$("#luckysheet-formula-functionrange .luckysheet-formula-functionrange-highlight .luckysheet-selection-copy-hc").css("opacity","0.03");$("#luckysheet-formula-search-c, #luckysheet-formula-help-c").hide();this.helpFunctionExe($editer,currSelection);if($(currSelection).closest(".luckysheet-formula-functionrange-cell").length==0){this.searchFunction($editer);return;}var $anchorOffset=$(currSelection).closest(".luckysheet-formula-functionrange-cell");//if (luckysheet.formula.israngeseleciton(true)) {
  //    var searchHTML = this.searchFunction($(currSelection));
  //    $("#luckysheet-formula-search-c").html(searchHTML);
  //}
  var rangeindex=$anchorOffset.attr("rangeindex");var rangeid="luckysheet-formula-functionrange-highlight-"+rangeindex;$("#"+rangeid).find(".luckysheet-selection-copy-hc").css({"opacity":"0.13"});},updatecell:function updatecell(r,c){var $input=$("#luckysheet-rich-text-editor"),value=$input.text();if(luckysheet.formula.rangetosheet!=luckysheet.currentSheetIndex){luckysheet.sheetmanage.changeSheetExec(luckysheet.formula.rangetosheet);}var curv=luckysheet.flowdata[r][c];if(luckysheet.func_methods.isRealNull(value)){if(curv==null||luckysheet.func_methods.isRealNull(curv.v)){this.cancelNormalSelected();return;}}else {if(luckysheet.getObjType(curv)=="object"&&(value==curv.f||value==curv.v||value==curv.m)){this.cancelNormalSelected();return;}else if(value==curv){this.cancelNormalSelected();return;}}if(value.slice(0,1)=="="&&value.length>1);else if(luckysheet.getObjType(curv)=="object"&&curv.ct!=null&&curv.ct.fa!=null&&curv.ct.fa!="@"&&!luckysheet.func_methods.isRealNull(value)){delete curv.m;//更新时间m处理 ， 会实际删除单元格数据的参数（flowdata时已删除）
  if(curv.f!=null){//如果原来是公式，而更新的数据不是公式，则把公式删除
  delete curv.f;delete curv.spl;//删除单元格的sparklines的配置串
  }}window.luckysheet_getcelldata_cache=null;var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);if(luckysheet.getObjType(curv)=="object"){if(luckysheet.getObjType(value)=="string"&&value.slice(0,1)=="="&&value.length>1){var v=this.execfunction(value,r,c,true);curv=this.execFunctionGroupData[r][c];curv.f=v[2];//打进单元格的sparklines的配置串， 报错需要单独处理。
  if(v.length==4&&v[3].type=="sparklines"){delete curv.m;delete curv.v;var curCalv=v[3].data;if(luckysheet.getObjType(curCalv)=="array"&&luckysheet.getObjType(curCalv[0])!="object"){curv.v=curCalv[0];}else {curv.spl=v[3].data;}}}else {this.delFunctionGroup(r,c);this.execFunctionGroup(r,c,value);curv=this.execFunctionGroupData[r][c];delete curv.f;delete curv.spl;}value=curv;}else {if(luckysheet.getObjType(value)=="string"&&value.slice(0,1)=="="&&value.length>1){var v=this.execfunction(value,r,c,true);value={"v":v[1],"f":v[2]};//打进单元格的sparklines的配置串， 报错需要单独处理。
  if(v.length==4&&v[3].type=="sparklines"){var curCalv=v[3].data;if(luckysheet.getObjType(curCalv)=="array"&&luckysheet.getObjType(curCalv[0])!="object"){value.v=curCalv[0];}else {value.spl=v[3].data;}}}else {this.delFunctionGroup(r,c);this.execFunctionGroup(r,c,value);}}luckysheet.setcellvalue(r,c,d,value);this.cancelNormalSelected();var RowlChange=false;if(d[r][c].tb=="2"&&d[r][c].v!=null){//自动换行
  var cfg=$.extend(true,{},luckysheet.getluckysheetfile()[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["config"]);if(cfg["rowlen"]==null){cfg["rowlen"]={};}var defaultrowlen=19;var offlinecanvas=$("#luckysheetTableContentF").get(0).getContext("2d");var fontset=luckysheet.luckysheetfontformat(d[r][c]);offlinecanvas.font=fontset;var currentRowLen=defaultrowlen;if(cfg["rowlen"][r]!=null){currentRowLen=cfg["rowlen"][r];}var strValue=luckysheet.getcellvalue(r,c,d).toString();var tbWidth=offlinecanvas.measureText(strValue).width;var cellWidth=luckysheet.colLocationByIndex(c)[1]-luckysheet.colLocationByIndex(c)[0]-8;if(tbWidth>cellWidth){var strArr=[];//文本截断数组
  for(var strI=1;strI<=strValue.length;strI++){var strV=strValue.substring(strArr.join("").length,strI);var strtextMetrics=offlinecanvas.measureText(strV).width;if(strtextMetrics>cellWidth){strArr.push(strValue.substring(strArr.join("").length,strI-1));strI=strI-2;}else if(strtextMetrics<=cellWidth&&strI==strValue.length){strArr.push(strV);}}var oneLineTextHeight=luckysheet.menuButton.getTextSize("田",fontset)[1];currentRowLen=oneLineTextHeight*strArr.length;}if(currentRowLen!=defaultrowlen){cfg["rowlen"][r]=currentRowLen;RowlChange=true;}}if(RowlChange){luckysheet.jfrefreshgrid(d,[{"row":[r,r],"column":[c,c]}],cfg,null,RowlChange);}else {luckysheet.jfrefreshgrid(d,[{"row":[r,r],"column":[c,c]}]);}luckysheetCellUpdate.length=0;//clear array
  this.execFunctionGroupData=null;//销毁
  },cancelNormalSelected:function cancelNormalSelected(){this.canceFunctionrangeSelected();$("#luckysheet-formula-functionrange .luckysheet-formula-functionrange-highlight").remove();$("#luckysheet-input-box").removeAttr("style");$("#luckysheet-input-box-index").hide();$("#luckysheet-wa-functionbox-cancel, #luckysheet-wa-functionbox-confirm").removeClass("luckysheet-wa-calculate-active");luckysheet.formula.rangestart=false;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;},canceFunctionrangeSelected:function canceFunctionrangeSelected(){$("#luckysheet-formula-functionrange-select").hide();$("#luckysheet-row-count-show, #luckysheet-column-count-show").hide();// $("#luckysheet-cols-h-selected, #luckysheet-rows-h-selected").hide();
  $("#luckysheet-formula-search-c, #luckysheet-formula-help-c").hide();},iscellformat:function iscellformat(txt){},iscelldata:function iscelldata(txt){//判断是否为单元格格式
  var val=txt.split("!"),rangetxt;if(val.length>1){rangetxt=val[1];}else {rangetxt=val[0];}// var reg_cell = /^[a-zA-Z]+[0-9]+$/g; //增加正则判断单元格为字母+数字的格式：如 A1:B3
  var reg_cell=/^(([a-zA-Z]+)|([$][a-zA-Z]+))(([0-9]+)|([$][0-9]+))$/g;//增加正则判断单元格为字母+数字的格式：如 A1:B3
  // var reg_cellRange = /^(([a-zA-Z]+[0-9]+)|([a-zA-Z]+))$/g;//增加正则判断单元格为字母+数字或字母的格式：如 A1:B3，A:A
  var reg_cellRange=/^(((([a-zA-Z]+)|([$][a-zA-Z]+))(([0-9]+)|([$][0-9]+)))|((([a-zA-Z]+)|([$][a-zA-Z]+))))$/g;//增加正则判断单元格为字母+数字或字母的格式：如 A1:B3，A:A
  if(rangetxt.indexOf(":")==-1){var row=parseInt(rangetxt.replace(/[^0-9]/g,""))-1;var col=luckysheet.luckysheetABCatNum(rangetxt.replace(/[^A-Za-z]/g,""));if(!isNaN(row)&&!isNaN(col)&&rangetxt.toString().match(reg_cell)){return true;}else if(!isNaN(row)){return false;}else if(!isNaN(col)){return false;}else {return false;}}else {// reg_cellRange = /^(([a-zA-Z]+[0-9]+)|([a-zA-Z]+)|([0-9]+))$/g;
  reg_cellRange=/^(((([a-zA-Z]+)|([$][a-zA-Z]+))(([0-9]+)|([$][0-9]+)))|((([a-zA-Z]+)|([$][a-zA-Z]+)))|((([0-9]+)|([$][0-9]+s))))$/g;rangetxt=rangetxt.split(":");var row=[],col=[];//console.log(rangetxt[0].replace(/[^0-9]/, ""), rangetxt[1].replace(/[^0-9]/, ""), rangetxt);
  row[0]=parseInt(rangetxt[0].replace(/[^0-9]/g,""))-1;row[1]=parseInt(rangetxt[1].replace(/[^0-9]/g,""))-1;if(row[0]>row[1]){return false;}col[0]=luckysheet.luckysheetABCatNum(rangetxt[0].replace(/[^A-Za-z]/g,""));col[1]=luckysheet.luckysheetABCatNum(rangetxt[1].replace(/[^A-Za-z]/g,""));if(col[0]>col[1]){return false;}if(rangetxt[0].toString().match(reg_cellRange)&&rangetxt[1].toString().match(reg_cellRange)){return true;}else {return false;}}},operator:'==|!=|<>|<=|>=|=|+|-|>|<|/|*|%|&|^',operatorjson:null,functionCopy:function functionCopy(txt,mode,step){if(luckysheet.formula.operatorjson==null){var arr=luckysheet.formula.operator.split("|"),op={};for(var i=0;i<arr.length;i++){op[arr[i].toString()]=1;}luckysheet.formula.operatorjson=op;}if(mode==null){mode="down";}if(step==null){step=1;}if(txt.substr(0,1)=="="){txt=txt.substr(1);}var funcstack=txt.split("");//var i=0;i<funcstack.length;i++
  var i=0,str="",function_str="";var matchConfig={"bracket":0,"comma":0,"squote":0,"dquote":0};while(i<funcstack.length){var s=funcstack[i];if(s=="("&&matchConfig.dquote==0){matchConfig.bracket+=1;if(str.length>0){function_str+=str+"(";}else {function_str+="(";}str="";}else if(s==")"&&matchConfig.dquote==0){matchConfig.bracket-=1;//if (matchConfig.bracket == 0) {
  function_str+=luckysheet.formula.functionCopy(str,mode,step)+")";str="";//}
  }//else if (s == "'" && matchConfig.dquote == 0) {
  //    if (matchConfig.squote > 0) {
  //        function_str += str + "'";
  //        matchConfig.squote -= 1;
  //        str = "";
  //    }
  //    else {
  //        matchConfig.squote += 1;
  //        str += "'";
  //    }
  //}
  else if(s=='"'&&matchConfig.squote==0){if(matchConfig.dquote>0){function_str+=str+'"';matchConfig.dquote-=1;str="";}else {matchConfig.dquote+=1;str+='"';}}else if(s==','&&matchConfig.dquote==0){//matchConfig.comma += 1;
  function_str+=luckysheet.formula.functionCopy(str,mode,step)+',';str="";}else if(s=='&'&&matchConfig.dquote==0){if(str.length>0){function_str+=luckysheet.formula.functionCopy(str,mode,step)+"&";str="";}else {function_str+="&";}}else if(s in luckysheet.formula.operatorjson&&matchConfig.dquote==0){var s_next="";if(i+1<funcstack.length){s_next=funcstack[i+1];}var p=i-1,s_pre=null;if(p>=0){do{s_pre=funcstack[p--];}while(p>=0&&s_pre==" ");}if(s+s_next in luckysheet.formula.operatorjson){if(str.length>0){function_str+=luckysheet.formula.functionCopy(str,mode,step)+s+s_next;str="";}else {function_str+=s+s_next;}i++;}else if(!/[^0-9]/.test(s_next)&&s=="-"&&(s_pre=="("||s_pre==null||s_pre==","||s_pre==" "||s_pre in luckysheet.formula.operatorjson)){str+=s;}else {if(str.length>0){function_str+=luckysheet.formula.functionCopy(str,mode,step)+s;str="";}else {function_str+=s;}}}else {str+=s;}if(i==funcstack.length-1){//function_str += str;
  if(luckysheet.formula.iscelldata($.trim(str))){if(mode=="down"){function_str+=luckysheet.formula.downparam($.trim(str),step);}else if(mode=="up"){function_str+=luckysheet.formula.upparam($.trim(str),step);}else if(mode=="left"){function_str+=luckysheet.formula.leftparam($.trim(str),step);}else if(mode=="right"){function_str+=luckysheet.formula.rightparam($.trim(str),step);}}else {function_str+=$.trim(str);}}i++;}return function_str;},isfreezonFuc:function isfreezonFuc(txt){var row=txt.replace(/[^0-9]/g,"");var col=txt.replace(/[^A-Za-z]/g,"");var row$=txt.substr(txt.indexOf(row)-1,1);var col$=txt.substr(txt.indexOf(col)-1,1);var ret=[false,false];if(row$=="$"){ret[0]=true;}if(col$=="$"){ret[1]=true;}return ret;},setfreezonFuceExe:function setfreezonFuceExe(rangetxt){var row=parseInt(rangetxt.replace(/[^0-9]/g,""));var col=luckysheet.luckysheetABCatNum(rangetxt.replace(/[^A-Za-z]/g,""));var freezonFuc=this.isfreezonFuc(rangetxt);var $row="$",$col="$";if(!isNaN(row)&&!isNaN(col)){return $col+luckysheet.luckysheetchatatABC(col)+$row+row;}else if(!isNaN(row)){return $row+row;}else if(!isNaN(col)){return $col+luckysheet.luckysheetchatatABC(col);}else {return txt;}},setfreezonFuc:function setfreezonFuc(event){var obj=this.getrangeseleciton();if(!this.iscelldata(obj.text())){return;}var txt=obj.text(),pos=window.getSelection().anchorOffset;var val=txt.split("!"),rangetxt,prefix="";if(val.length>1){rangetxt=val[1];prefix=val[0]+"!";}else {rangetxt=val[0];}var newtxt="",newpos="";var rangetxtIndex=rangetxt.indexOf(":");if(rangetxtIndex==-1){//return [this.setfreezonFuceExe(rangetxt), rangetxt.length];
  newtxt=prefix+this.setfreezonFuceExe(rangetxt);newpos=newtxt.length;}else {rangetxt=rangetxt.split(":");if(pos>rangetxtIndex){var ret=prefix+rangetxt[0]+":"+this.setfreezonFuceExe(rangetxt[1]);//return [ret, ret.length];
  newtxt=ret;newpos=ret.length;}else {var firsttxt=prefix+this.setfreezonFuceExe(rangetxt[0]);var ret=firsttxt+":"+rangetxt[1];//return [ret, firsttxt.length];
  newtxt=ret;newpos=firsttxt.length;}}obj.text(prefix+newtxt);this.setCaretPosition(obj.get(0),0,newpos);},updateparam:function updateparam(orient,txt,step){var val=txt.split("!"),rangetxt,prefix="";if(val.length>1){rangetxt=val[1];prefix=val[0]+"!";}else {rangetxt=val[0];}if(rangetxt.indexOf(":")==-1){var row=parseInt(rangetxt.replace(/[^0-9]/g,""));var col=luckysheet.luckysheetABCatNum(rangetxt.replace(/[^A-Za-z]/g,""));var freezonFuc=this.isfreezonFuc(rangetxt);var $row=freezonFuc[0]?"$":"",$col=freezonFuc[1]?"$":"";if(orient=="u"&&!freezonFuc[0]){row-=step;}else if(orient=="r"&&!freezonFuc[1]){col+=step;}else if(orient=="l"&&!freezonFuc[1]){col-=step;}else if(!freezonFuc[0]){row+=step;}console.log(prefix+$col+luckysheet.luckysheetchatatABC(col)+$row+row);if(row[0]<0||col[0]<0){return luckysheet.formula.error.r;}if(!isNaN(row)&&!isNaN(col)){return prefix+$col+luckysheet.luckysheetchatatABC(col)+$row+row;}else if(!isNaN(row)){return prefix+$row+row;}else if(!isNaN(col)){return prefix+$col+luckysheet.luckysheetchatatABC(col);}else {return txt;}}else {rangetxt=rangetxt.split(":");var row=[],col=[];//console.log(rangetxt[0].replace(/[^0-9]/, ""), rangetxt[1].replace(/[^0-9]/, ""), rangetxt);
  row[0]=parseInt(rangetxt[0].replace(/[^0-9]/g,""));row[1]=parseInt(rangetxt[1].replace(/[^0-9]/g,""));var freezonFuc0=this.isfreezonFuc(rangetxt[0]);if(row[0]>row[1]){return txt;}var freezonFuc1=this.isfreezonFuc(rangetxt[1]);col[0]=luckysheet.luckysheetABCatNum(rangetxt[0].replace(/[^A-Za-z]/g,""));col[1]=luckysheet.luckysheetABCatNum(rangetxt[1].replace(/[^A-Za-z]/g,""));if(col[0]>col[1]){return txt;}var $row0=freezonFuc0[0]?"$":"",$col0=freezonFuc0[1]?"$":"";var $row1=freezonFuc1[0]?"$":"",$col1=freezonFuc1[1]?"$":"";if(orient=="u"){if(!freezonFuc0[0]){row[0]-=step;}if(!freezonFuc1[0]){row[1]-=step;}}else if(orient=="r"){if(!freezonFuc0[1]){col[0]+=step;}if(!freezonFuc1[1]){col[1]+=step;}}else if(orient=="l"){//col[0] -= step;
  //col[1] -= step;
  if(!freezonFuc0[1]){col[0]-=step;}if(!freezonFuc1[1]){col[1]-=step;}}else {//row[0] += step;
  //row[1] += step;
  if(!freezonFuc0[0]){row[0]+=step;}if(!freezonFuc1[0]){row[1]+=step;}}if(row[0]<0||col[0]<0){return luckysheet.formula.error.r;}if(isNaN(col[0])&&isNaN(col[1])){return prefix+$row0+row[0]+":"+$row1+row[1];}else if(isNaN(row[0])&&isNaN(row[1])){return prefix+$col0+luckysheet.luckysheetchatatABC(col[0])+":"+$col1+luckysheet.luckysheetchatatABC(col[1]);}else {return prefix+$col0+luckysheet.luckysheetchatatABC(col[0])+$row0+row[0]+":"+$col1+luckysheet.luckysheetchatatABC(col[1])+$row1+row[1];}}},downparam:function downparam(txt,step){return this.updateparam("d",txt,step);},upparam:function upparam(txt,step){return this.updateparam("u",txt,step);},leftparam:function leftparam(txt,step){return this.updateparam("l",txt,step);},rightparam:function rightparam(txt,step){return this.updateparam("r",txt,step);},functionStrChange:function functionStrChange(txt,type,rc,orient,stindex,step){if(luckysheet.formula.operatorjson==null){var arr=luckysheet.formula.operator.split("|"),op={};for(var i=0;i<arr.length;i++){op[arr[i].toString()]=1;}luckysheet.formula.operatorjson=op;}if(txt.substr(0,1)=="="){txt=txt.substr(1);}var funcstack=txt.split("");var i=0,str="",function_str="";var matchConfig={"bracket":0,//括号
  "comma":0,//逗号
  "squote":0,//单引号
  "dquote":0//双引号
  };while(i<funcstack.length){var s=funcstack[i];if(s=="("&&matchConfig.dquote==0){matchConfig.bracket+=1;if(str.length>0){function_str+=str+"(";}else {function_str+="(";}str="";}else if(s==")"&&matchConfig.dquote==0){matchConfig.bracket-=1;//if (matchConfig.bracket == 0) {
  function_str+=luckysheet.formula.functionStrChange(str,type,rc,orient,stindex,step)+")";str="";//}
  }//else if (s == "'" && matchConfig.dquote == 0) {
  //    if (matchConfig.squote > 0) {
  //        function_str += str + "'";
  //        matchConfig.squote -= 1;
  //        str = "";
  //    }
  //    else {
  //        matchConfig.squote += 1;
  //        str += "'";
  //    }
  //}
  else if(s=='"'&&matchConfig.squote==0){if(matchConfig.dquote>0){function_str+=str+'"';matchConfig.dquote-=1;str="";}else {matchConfig.dquote+=1;str+='"';}}else if(s==','&&matchConfig.dquote==0){function_str+=luckysheet.formula.functionStrChange(str,type,rc,orient,stindex,step)+',';str="";}else if(s=='&'&&matchConfig.dquote==0){if(str.length>0){function_str+=luckysheet.formula.functionStrChange(str,type,rc,orient,stindex,step)+"&";str="";}else {function_str+="&";}}else if(s in luckysheet.formula.operatorjson&&matchConfig.dquote==0){var s_next="";if(i+1<funcstack.length){s_next=funcstack[i+1];}var p=i-1,s_pre=null;if(p>=0){do{s_pre=funcstack[p--];}while(p>=0&&s_pre==" ");}if(s+s_next in luckysheet.formula.operatorjson){if(str.length>0){function_str+=luckysheet.formula.functionStrChange(str,type,rc,orient,stindex,step)+s+s_next;str="";}else {function_str+=s+s_next;}i++;}else if(!/[^0-9]/.test(s_next)&&s=="-"&&(s_pre=="("||s_pre==null||s_pre==","||s_pre==" "||s_pre in luckysheet.formula.operatorjson)){str+=s;}else {if(str.length>0){function_str+=luckysheet.formula.functionStrChange(str,type,rc,orient,stindex,step)+s;str="";}else {function_str+=s;}}}else {str+=s;}if(i==funcstack.length-1){if(luckysheet.formula.iscelldata($.trim(str))){function_str+=luckysheet.formula.functionStrChange_range($.trim(str),type,rc,orient,stindex,step);}else {function_str+=$.trim(str);}}i++;}return function_str;},functionStrChange_range:function functionStrChange_range(txt,type,rc,orient,stindex,step){var val=txt.split("!"),rangetxt,prefix="";if(val.length>1){rangetxt=val[1];prefix=val[0]+"!";}else {rangetxt=val[0];}var r1,r2,c1,c2;var $row0,$row1,$col0,$col1;if(rangetxt.indexOf(":")==-1){r1=r2=parseInt(rangetxt.replace(/[^0-9]/g,""))-1;c1=c2=luckysheet.luckysheetABCatNum(rangetxt.replace(/[^A-Za-z]/g,""));var freezonFuc=this.isfreezonFuc(rangetxt);$row0=$row1=freezonFuc[0]?"$":"",$col0=$col1=freezonFuc[1]?"$":"";}else {rangetxt=rangetxt.split(":");r1=parseInt(rangetxt[0].replace(/[^0-9]/g,""))-1;r2=parseInt(rangetxt[1].replace(/[^0-9]/g,""))-1;if(r1>r2){return txt;}c1=luckysheet.luckysheetABCatNum(rangetxt[0].replace(/[^A-Za-z]/g,""));c2=luckysheet.luckysheetABCatNum(rangetxt[1].replace(/[^A-Za-z]/g,""));if(c1>c2){return txt;}var freezonFuc0=this.isfreezonFuc(rangetxt[0]);$row0=freezonFuc0[0]?"$":"";$col0=freezonFuc0[1]?"$":"";var freezonFuc1=this.isfreezonFuc(rangetxt[1]);$row1=freezonFuc1[0]?"$":"";$col1=freezonFuc1[1]?"$":"";}if(type=="del"){if(rc=="row"){if(r1>=stindex&&r2<=stindex+step-1){return luckysheet.formula.error.r;}if(r1>stindex+step-1){r1-=step;}else if(r1>=stindex){r1=stindex;}if(r2>stindex+step-1){r2-=step;}else if(r2>=stindex){r2=stindex-1;}if(r1<0){r1=0;}if(r2<r1){r2=r1;}}else if(rc=="col"){if(c1>=stindex&&c2<=stindex+step-1){return luckysheet.formula.error.r;}if(c1>stindex+step-1){c1-=step;}else if(c1>=stindex){c1=stindex;}if(c2>stindex+step-1){c2-=step;}else if(c2>=stindex){c2=stindex-1;}if(c1<0){c1=0;}if(c2<c1){c2=c1;}}if(r1==r2&&c1==c2){if(!isNaN(r1)&&!isNaN(c1)){return prefix+$col0+luckysheet.luckysheetchatatABC(c1)+$row0+(r1+1);}else if(!isNaN(r1)){return prefix+$row0+(r1+1);}else if(!isNaN(c1)){return prefix+$col0+luckysheet.luckysheetchatatABC(c1);}else {return txt;}}else {if(isNaN(c1)&&isNaN(c2)){return prefix+$row0+(r1+1)+":"+$row1+(r2+1);}else if(isNaN(r1)&&isNaN(r2)){return prefix+$col0+luckysheet.luckysheetchatatABC(c1)+":"+$col1+luckysheet.luckysheetchatatABC(c2);}else {return prefix+$col0+luckysheet.luckysheetchatatABC(c1)+$row0+(r1+1)+":"+$col1+luckysheet.luckysheetchatatABC(c2)+$row1+(r2+1);}}}else if(type=="add"){if(rc=="row"){if(orient=="lefttop"){if(r1>=stindex){r1+=step;}if(r2>=stindex){r2+=step;}}else if(orient=="rightbottom"){if(r1>stindex){r1+=step;}if(r2>stindex){r2+=step;}}}else if(rc=="col"){if(orient=="lefttop"){if(c1>=stindex){c1+=step;}if(c2>=stindex){c2+=step;}}else if(orient=="rightbottom"){if(c1>stindex){c1+=step;}if(c2>stindex){c2+=step;}}}if(r1==r2&&c1==c2){if(!isNaN(r1)&&!isNaN(c1)){return prefix+$col0+luckysheet.luckysheetchatatABC(c1)+$row0+(r1+1);}else if(!isNaN(r1)){return prefix+$row0+(r1+1);}else if(!isNaN(c1)){return prefix+$col0+luckysheet.luckysheetchatatABC(c1);}else {return txt;}}else {if(isNaN(c1)&&isNaN(c2)){return prefix+$row0+(r1+1)+":"+$row1+(r2+1);}else if(isNaN(r1)&&isNaN(r2)){return prefix+$col0+luckysheet.luckysheetchatatABC(c1)+":"+$col1+luckysheet.luckysheetchatatABC(c2);}else {return prefix+$col0+luckysheet.luckysheetchatatABC(c1)+$row0+(r1+1)+":"+$col1+luckysheet.luckysheetchatatABC(c2)+$row1+(r2+1);}}}},israngeseleciton:function israngeseleciton(istooltip){if(luckysheet.formula.operatorjson==null){var arr=luckysheet.formula.operator.split("|"),op={};for(var i=0;i<arr.length;i++){op[arr[i].toString()]=1;}luckysheet.formula.operatorjson=op;}if(istooltip==null){istooltip=false;}var currSelection=window.getSelection();var anchor=$(currSelection.anchorNode);var anchorOffset=currSelection.anchorOffset;if(anchor.parent().is("span")&&anchorOffset!=0){var txt=$.trim(anchor.text()),lasttxt="";if(txt.length==0&&anchor.parent().prev().length>0){var ahr=anchor.parent().prev();txt=$.trim(ahr.text());lasttxt=txt.substr(txt.length-1,1);this.rangeSetValueTo=ahr;}else {lasttxt=txt.substr(anchorOffset-1,1);this.rangeSetValueTo=anchor.parent();}if(istooltip&&(lasttxt=="("||lasttxt==",")||!istooltip&&(lasttxt=="("||lasttxt==","||lasttxt=="="||lasttxt in luckysheet.formula.operatorjson||lasttxt=="&")){return true;}}else if(anchor.is("#luckysheet-rich-text-editor")||anchor.is("#luckysheet-functionbox-cell")){var txt=$.trim(anchor.find("span").last().text()),lasttxt;this.rangeSetValueTo=anchor.find("span").last();if(txt.length==0&&anchor.find("span").length>1){var ahr=anchor.find("span");txt=$.trim(ahr.eq(ahr.length-2).text());this.rangeSetValueTo=ahr;}lasttxt=txt.substr(txt.length-1,1);if(istooltip&&(lasttxt=="("||lasttxt==",")||!istooltip&&(lasttxt=="("||lasttxt==","||lasttxt=="="||lasttxt in luckysheet.formula.operatorjson||lasttxt=="&")){return true;}}else if(anchor.parent().is("#luckysheet-rich-text-editor")||anchor.parent().is("#luckysheet-functionbox-cell")||anchorOffset==0){if(anchorOffset==0){anchor=anchor.parent();}if(anchor.prev().length>0){var txt=$.trim(anchor.prev().text());var lasttxt=txt.substr(txt.length-1,1);this.rangeSetValueTo=anchor.prev();if(istooltip&&(lasttxt=="("||lasttxt==",")||!istooltip&&(lasttxt=="("||lasttxt==","||lasttxt=="="||lasttxt in luckysheet.formula.operatorjson||lasttxt=="&")){return true;}}}return false;},rangechangeindex:null,rangestart:false,rangetosheet:null,rangeSetValueTo:null,func_selectedrange:{},//函数选区范围
  rangeSetValue:function rangeSetValue(selected,obj){var range=luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,selected,this.rangetosheet);var $editor;if(luckysheet.formula.rangestart||luckysheet.formula.rangedrag_column_start||luckysheet.formula.rangedrag_row_start){if($("#luckysheet-search-formula-parm").is(":visible")||$("#luckysheet-search-formula-parm-select").is(":visible")){//公式参数框选取范围
  $editor=$("#luckysheet-rich-text-editor");$("#luckysheet-search-formula-parm-select-input").val(range);$("#luckysheet-search-formula-parm .parmBox").eq(luckysheet.formula.data_parm_index).find(".txt input").val(range);//参数对应值显示
  var txtdata=window.luckysheet_getcelldata(range).data;if(txtdata instanceof Array){//参数为多个单元格选区
  var txtArr=[];for(var i=0;i<txtdata.length;i++){for(var j=0;j<txtdata[i].length;j++){if(txtdata[i][j]==null){txtArr.push(null);}else {txtArr.push(txtdata[i][j].v);}}}$("#luckysheet-search-formula-parm .parmBox").eq(luckysheet.formula.data_parm_index).find(".val").text(" = {"+txtArr.join(",")+"}");}else {//参数为单个单元格选区
  $("#luckysheet-search-formula-parm .parmBox").eq(luckysheet.formula.data_parm_index).find(".val").text(" = {"+txtdata.v+"}");}//计算结果显示
  var isVal=true;//参数不为空
  var parmValArr=[];//参数值集合
  var lvi=-1;//最后一个有值的参数索引
  $("#luckysheet-search-formula-parm .parmBox").each(function(i,e){var parmtxt=$(e).find(".txt input").val();if(parmtxt==""&&$(e).find(".txt input").attr("data_parm_require")=="m"){isVal=false;}if(parmtxt!=""){lvi=i;}});//单元格显示
  if(lvi==-1){var functionHtmlTxt="="+$("#luckysheet-search-formula-parm .luckysheet-modal-dialog-title-text").text()+"()";}else if(lvi==0){var functionHtmlTxt="="+$("#luckysheet-search-formula-parm .luckysheet-modal-dialog-title-text").text()+"("+$("#luckysheet-search-formula-parm .parmBox").eq(0).find(".txt input").val()+")";}else {for(var j=0;j<=lvi;j++){parmValArr.push($("#luckysheet-search-formula-parm .parmBox").eq(j).find(".txt input").val());}var functionHtmlTxt="="+$("#luckysheet-search-formula-parm .luckysheet-modal-dialog-title-text").text()+"("+parmValArr.join(",")+")";}var function_str=luckysheet.formula.functionHTMLGenerate(functionHtmlTxt);$("#luckysheet-rich-text-editor").html(function_str);$("#luckysheet-functionbox-cell").html($("#luckysheet-rich-text-editor").html());if(isVal==true){//公式计算
  var fp=$.trim(luckysheet.formula.functionParser($("#luckysheet-rich-text-editor").text()));var result=eval(fp);$("#luckysheet-search-formula-parm .result span").text(result);}}else {var currSelection=window.getSelection();var anchorOffset=currSelection.anchorNode;$editor=$(anchorOffset).closest("div");var $span=$editor.find("span[rangeindex='"+this.rangechangeindex+"']").html(range);luckysheet.formula.setCaretPosition($span.get(0),0,range.length);}}else {var function_str='<span class="luckysheet-formula-functionrange-cell" rangeindex="'+this.functionHTMLIndex+'" dir="auto" style="color:'+luckysheet.jfcolor[this.functionHTMLIndex]+';">'+range+'</span>';var $t=$(function_str).insertAfter(this.rangeSetValueTo);this.rangechangeindex=this.functionHTMLIndex;$editor=$(this.rangeSetValueTo).closest("div");luckysheet.formula.setCaretPosition($editor.find("span[rangeindex='"+luckysheet.formula.rangechangeindex+"']").get(0),0,range.length);this.functionHTMLIndex++;}if($editor.attr("id")=="luckysheet-rich-text-editor"){$("#luckysheet-functionbox-cell").html($("#luckysheet-rich-text-editor").html());}else {$("#luckysheet-rich-text-editor").html($("#luckysheet-functionbox-cell").html());}},rangedrag:function rangedrag(event){var mouse=luckysheet.mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();// var x = mouse[0] + $("#luckysheet-scrollbar-x").scrollLeft();
  // var y = mouse[1] + $("#luckysheet-scrollbar-y").scrollTop();
  // console.log($("#luckysheet-cell-main").scrollTop(), $("#luckysheet-scrollbar-y").scrollTop());
  var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];var top=0,height=0,rowseleted=[];if(this.func_selectedrange.top>row_pre){top=row_pre;height=this.func_selectedrange.top+this.func_selectedrange.height-row_pre;rowseleted=[row_index,this.func_selectedrange.row[1]];}else if(this.func_selectedrange.top==row_pre){top=row_pre;height=this.func_selectedrange.top+this.func_selectedrange.height-row_pre;rowseleted=[row_index,this.func_selectedrange.row[0]];}else {top=this.func_selectedrange.top;height=row-this.func_selectedrange.top-1;rowseleted=[this.func_selectedrange.row[0],row_index];}var left=0,width=0,columnseleted=[];if(this.func_selectedrange.left>col_pre){left=col_pre;width=this.func_selectedrange.left+this.func_selectedrange.width-col_pre;columnseleted=[col_index,this.func_selectedrange.column[1]];}else if(this.func_selectedrange.left==col_pre){left=col_pre;width=this.func_selectedrange.left+this.func_selectedrange.width-col_pre;columnseleted=[col_index,this.func_selectedrange.column[0]];}else {left=this.func_selectedrange.left;width=col-this.func_selectedrange.left-1;columnseleted=[this.func_selectedrange.column[0],col_index];}rowseleted[0]=luckysheet.freezen.changeFreezenIndex(rowseleted[0],"h");rowseleted[1]=luckysheet.freezen.changeFreezenIndex(rowseleted[1],"h");columnseleted[0]=luckysheet.freezen.changeFreezenIndex(columnseleted[0],"v");columnseleted[1]=luckysheet.freezen.changeFreezenIndex(columnseleted[1],"v");var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,rowseleted,this.func_selectedrange,top,height,left,width);if(changeparam!=null){columnseleted=changeparam[0];rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];left=changeparam[4];width=changeparam[5];}this.func_selectedrange["row"]=rowseleted;this.func_selectedrange["column"]=columnseleted;this.func_selectedrange["left_move"]=left;this.func_selectedrange["width_move"]=width;this.func_selectedrange["top_move"]=top;this.func_selectedrange["height_move"]=height;luckysheet.luckysheet_count_show(left,top,width,height,rowseleted,columnseleted);$("#luckysheet-formula-functionrange-select").css({"left":left,"width":width,"top":top,"height":height}).show();if($("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){//if公式生成器 选择范围
  var range=luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,{"row":rowseleted,"column":columnseleted},luckysheet.currentSheetIndex);$("#luckysheet-ifFormulaGenerator-multiRange-dialog input").val(range);}else {this.rangeSetValue({"row":rowseleted,"column":columnseleted});}setTimeout(function(){luckysheetautoadjustmousedown=1;},1);luckysheet.freezen.scrollFreezen(rowseleted,columnseleted);},rangedrag_column_start:false,rangedrag_row_start:false,rangedrag_column:function rangedrag_column(event){var mouse=luckysheet.mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();// var x = mouse[0] + $("#luckysheet-scrollbar-x").scrollLeft();
  // var y = mouse[1] + $("#luckysheet-scrollbar-y").scrollTop();
  var visibledatarow=luckysheet.getvisibledatarow();//var rowLocation = luckysheet.rowLocation(y), row = rowLocation[1], row_pre = rowLocation[0], row_index = rowLocation[2];
  var row_index=visibledatarow.length-1,row=visibledatarow[row_index],row_pre=0;var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];var left=0,width=0,columnseleted=[];if(this.func_selectedrange.left>col_pre){left=col_pre;width=this.func_selectedrange.left+this.func_selectedrange.width-col_pre;columnseleted=[col_index,this.func_selectedrange.column[1]];}else if(this.func_selectedrange.left==col_pre){left=col_pre;width=this.func_selectedrange.left+this.func_selectedrange.width-col_pre;columnseleted=[col_index,this.func_selectedrange.column[0]];}else {left=this.func_selectedrange.left;width=col-this.func_selectedrange.left-1;columnseleted=[this.func_selectedrange.column[0],col_index];}//rowseleted[0] = luckysheet.freezen.changeFreezenIndex(rowseleted[0], "h");
  //rowseleted[1] = luckysheet.freezen.changeFreezenIndex(rowseleted[1], "h");
  columnseleted[0]=luckysheet.freezen.changeFreezenIndex(columnseleted[0],"v");columnseleted[1]=luckysheet.freezen.changeFreezenIndex(columnseleted[1],"v");var changeparam=luckysheet.menuButton.mergeMoveMain(columnseleted,[0,row_index],this.func_selectedrange,row_pre,row-row_pre-1,left,width);if(changeparam!=null){columnseleted=changeparam[0];// rowseleted= changeparam[1];
  // top = changeparam[2];
  // height = changeparam[3];
  left=changeparam[4];width=changeparam[5];}this.func_selectedrange["column"]=columnseleted;this.func_selectedrange["left_move"]=left;this.func_selectedrange["width_move"]=width;luckysheet.luckysheet_count_show(left,row_pre,width,row-row_pre-1,[0,row_index],columnseleted);this.rangeSetValue({"row":[null,null],"column":columnseleted});$("#luckysheet-formula-functionrange-select").css({"left":left,"width":width,"top":row_pre,"height":row-row_pre-1}).show();setTimeout(function(){luckysheetautoadjustmousedown=1;},1);luckysheet.freezen.scrollFreezen([0,row_index],columnseleted);},rangedrag_row:function rangedrag_row(event){var mouse=luckysheet.mouseposition(event.pageX,event.pageY);var x=mouse[0]+$("#luckysheet-cell-main").scrollLeft();var y=mouse[1]+$("#luckysheet-cell-main").scrollTop();// var x = mouse[0] + $("#luckysheet-scrollbar-x").scrollLeft();
  // var y = mouse[1] + $("#luckysheet-scrollbar-y").scrollTop();
  var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var visibledatacolumn=luckysheet.getvisibledatacolumn();//var colLocation = luckysheet.colLocation(x), col = colLocation[1], col_pre = colLocation[0], col_index = colLocation[2];
  var col_index=visibledatacolumn.length-1,col=visibledatacolumn[col_index],col_pre=0;var top=0,height=0,rowseleted=[];if(this.func_selectedrange.top>row_pre){top=row_pre;height=this.func_selectedrange.top+this.func_selectedrange.height-row_pre;rowseleted=[row_index,this.func_selectedrange.row[1]];}else if(this.func_selectedrange.top==row_pre){top=row_pre;height=this.func_selectedrange.top+this.func_selectedrange.height-row_pre;rowseleted=[row_index,this.func_selectedrange.row[0]];}else {top=this.func_selectedrange.top;height=row-this.func_selectedrange.top-1;rowseleted=[this.func_selectedrange.row[0],row_index];}rowseleted[0]=luckysheet.freezen.changeFreezenIndex(rowseleted[0],"h");rowseleted[1]=luckysheet.freezen.changeFreezenIndex(rowseleted[1],"h");// columnseleted[0] = luckysheet.freezen.changeFreezenIndex(columnseleted[0], "v");
  // columnseleted[1] = luckysheet.freezen.changeFreezenIndex(columnseleted[1], "v");
  var changeparam=luckysheet.menuButton.mergeMoveMain([0,col_index],rowseleted,this.func_selectedrange,top,height,col_pre,col-col_pre-1);if(changeparam!=null){// columnseleted = changeparam[0];
  rowseleted=changeparam[1];top=changeparam[2];height=changeparam[3];// left = changeparam[4];
  // width = changeparam[5];
  }this.func_selectedrange["row"]=rowseleted;this.func_selectedrange["top_move"]=top;this.func_selectedrange["height_move"]=height;luckysheet.luckysheet_count_show(col_pre,top,col-col_pre-1,height,rowseleted,[0,col_index]);this.rangeSetValue({"row":rowseleted,"column":[null,null]});$("#luckysheet-formula-functionrange-select").css({"left":col_pre,"width":col-col_pre-1,"top":top,"height":height}).show();setTimeout(function(){luckysheetautoadjustmousedown=1;},1);luckysheet.freezen.scrollFreezen(rowseleted,[0,col_index]);},rangedragged:function rangedragged(){},rangeResizeObj:null,rangeResize:null,rangeResizeIndex:null,rangeResizexy:null,rangeResizeWinH:null,rangeResizeWinW:null,rangeResizeTo:null,rangeResizeDraging:function rangeResizeDraging(event,luckysheetCurrentChartResizeObj,luckysheetCurrentChartResizeXy,luckysheetCurrentChartResize,luckysheetCurrentChartResizeWinW,luckysheetCurrentChartResizeWinH,ch_width,rh_height){var scrollTop=$("#luckysheet-scrollbar-y").scrollTop(),scrollLeft=$("#luckysheet-scrollbar-x").scrollLeft();var mouse=luckysheet.mouseposition(event.pageX,event.pageY);var x=mouse[0]+scrollLeft;var y=mouse[1]+scrollTop;var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];if(x<0||y<0){return false;}var myh=luckysheetCurrentChartResizeObj.height(),myw=luckysheetCurrentChartResizeObj.width();var topchange=row_pre-luckysheetCurrentChartResizeXy[1],leftchange=col_pre-luckysheetCurrentChartResizeXy[0];var top=luckysheetCurrentChartResizeXy[5],height=luckysheetCurrentChartResizeXy[3],left=luckysheetCurrentChartResizeXy[4],width=luckysheetCurrentChartResizeXy[2];if(luckysheetCurrentChartResize=="lt"||luckysheetCurrentChartResize=="lb"){if(luckysheetCurrentChartResizeXy[0]+luckysheetCurrentChartResizeXy[2]<col_pre){return;}left=col_pre;width=luckysheetCurrentChartResizeXy[2]-leftchange;if(left>luckysheetCurrentChartResizeXy[2]+luckysheetCurrentChartResizeXy[4]-col+col_pre){left=luckysheetCurrentChartResizeXy[2]+luckysheetCurrentChartResizeXy[4]-col+col_pre;width=luckysheetCurrentChartResizeXy[2]-(luckysheetCurrentChartResizeXy[2]+luckysheetCurrentChartResizeXy[4]-col+col_pre-luckysheetCurrentChartResizeXy[0]);}else if(left<=0){left=0;width=luckysheetCurrentChartResizeXy[2]+luckysheetCurrentChartResizeXy[0];}}if(luckysheetCurrentChartResize=="rt"||luckysheetCurrentChartResize=="rb"){if(luckysheetCurrentChartResizeXy[6]-luckysheetCurrentChartResizeXy[2]>col){return;}width=luckysheetCurrentChartResizeXy[2]+col-luckysheetCurrentChartResizeXy[6];if(width<col-col_pre-1){width=col-col_pre-1;}else if(width>=ch_width-left){width=ch_width-left;}}if(luckysheetCurrentChartResize=="lt"||luckysheetCurrentChartResize=="rt"){if(luckysheetCurrentChartResizeXy[1]+luckysheetCurrentChartResizeXy[3]<row_pre){return;}top=row_pre;height=luckysheetCurrentChartResizeXy[3]-topchange;if(top>luckysheetCurrentChartResizeXy[3]+luckysheetCurrentChartResizeXy[5]-row+row_pre){top=luckysheetCurrentChartResizeXy[3]+luckysheetCurrentChartResizeXy[5]-row+row_pre;height=luckysheetCurrentChartResizeXy[3]-(luckysheetCurrentChartResizeXy[3]+luckysheetCurrentChartResizeXy[5]-row+row_pre-luckysheetCurrentChartResizeXy[1]);}else if(top<=0){top=0;height=luckysheetCurrentChartResizeXy[3]+luckysheetCurrentChartResizeXy[1];}}if(luckysheetCurrentChartResize=="lb"||luckysheetCurrentChartResize=="rb"){if(luckysheetCurrentChartResizeXy[7]-luckysheetCurrentChartResizeXy[3]>row){return;}height=luckysheetCurrentChartResizeXy[3]+row-luckysheetCurrentChartResizeXy[7];if(height<row-row_pre-1){height=row-row_pre-1;}else if(height>=rh_height-top){height=rh_height-top;}}var rangeindex=luckysheet.formula.rangeResizeIndex;var selected={"top":top,"left":left,"height":height,"width":width};var range=this.getSelectedFromRange(selected);var rangetxt=luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,range,this.rangetosheet);var $span=luckysheet.formula.rangeResizeTo.find("span[rangeindex='"+rangeindex+"']").html(rangetxt);luckysheet.luckysheetRangeLast(luckysheet.formula.rangeResizeTo[0]);luckysheetCurrentChartResizeObj.css(selected).data("range",range);},getSelectedFromRange:function getSelectedFromRange(obj){var row_st=obj.top+2,row_ed=obj.top+obj.height-2;var col_st=obj.left+2,col_ed=obj.left+obj.width-2;var ret={"row":[],"column":[]};var rowLocation=luckysheet.rowLocation(row_st),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(col_st),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];ret.row[0]=row_index;ret.column[0]=col_index;var rowLocation=luckysheet.rowLocation(row_ed),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(col_ed),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];ret.row[1]=row_index;ret.column[1]=col_index;return ret;},rangeResizeDragged:function rangeResizeDragged(event,luckysheetCurrentChartResizeObj,luckysheetCurrentChartResizeXy,luckysheetCurrentChartResize,luckysheetCurrentChartResizeWinW,luckysheetCurrentChartResizeWinH){luckysheet.formula.rangeResize=null;$("#luckysheet-formula-functionrange-highlight-"+luckysheet.formula.rangeResizeIndex).find(".luckysheet-selection-copy-hc").css("opacity",0.03);},rangeMovexy:null,rangeMove:false,rangeMoveObj:null,rangeMoveIndex:null,rangeMoveRangedata:null,rangeMoveDraging:function rangeMoveDraging(event,luckysheet_cell_selected_move_index,luckysheet_select_save,obj,sheetBarHeight,statisticBarHeight){var mouse=luckysheet.mouseposition(event.pageX,event.pageY);var scrollLeft=$("#luckysheet-scrollbar-x").scrollLeft();var scrollTop=$("#luckysheet-scrollbar-y").scrollTop();var x=mouse[0]+scrollLeft;var y=mouse[1]+scrollTop;var winH=$(window).height()+scrollTop-sheetBarHeight-statisticBarHeight,winW=$(window).width()+scrollLeft;var rowLocation=luckysheet.rowLocation(y),row=rowLocation[1],row_pre=rowLocation[0],row_index=rowLocation[2];var colLocation=luckysheet.colLocation(x),col=colLocation[1],col_pre=colLocation[0],col_index=colLocation[2];var row_index_original=luckysheet_cell_selected_move_index[0],col_index_original=luckysheet_cell_selected_move_index[1];var row_s=luckysheet_select_save["row"][0]-row_index_original+row_index,row_e=luckysheet_select_save["row"][1]-row_index_original+row_index;var col_s=luckysheet_select_save["column"][0]-col_index_original+col_index,col_e=luckysheet_select_save["column"][1]-col_index_original+col_index;//console.log(row_index_original, row_index,col_index_original,col_index);
  if(row_s<0||y<0){row_s=0;row_e=luckysheet_select_save["row"][1]-luckysheet_select_save["row"][0];}if(col_s<0||x<0){col_s=0;col_e=luckysheet_select_save["column"][1]-luckysheet_select_save["column"][0];}//console.log(row_s, row_e,col_s,col_e, x, y);
  var visibledatarow=luckysheet.getvisibledatarow();if(row_e>=visibledatarow[visibledatarow.length-1]||y>winH){row_s=visibledatarow.length-1-luckysheet_select_save["row"][1]+luckysheet_select_save["row"][0];row_e=visibledatarow.length-1;}var visibledatacolumn=luckysheet.getvisibledatacolumn();if(col_e>=visibledatacolumn[visibledatacolumn.length-1]||x>winW){col_s=visibledatacolumn.length-1-luckysheet_select_save["column"][1]+luckysheet_select_save["column"][0];col_e=visibledatacolumn.length-1;}//console.log(row_s, row_e,visibledatarow.length,luckysheet_select_save["row"][1] - luckysheet_select_save["row"][0]);
  var col_pre=col_s-1==-1?0:visibledatacolumn[col_s-1],col=visibledatacolumn[col_e];var row_pre=row_s-1==-1?0:visibledatarow[row_s-1],row=visibledatarow[row_e];var rangeindex=luckysheet.formula.rangeMoveIndex;var selected={"left":col_pre,"width":col-col_pre-2,"top":row_pre,"height":row-row_pre-2,"display":"block"};var range=this.getSelectedFromRange(selected);var rangetxt=luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex,range,this.rangetosheet);var $span=luckysheet.formula.rangeResizeTo.find("span[rangeindex='"+rangeindex+"']").html(rangetxt);luckysheet.luckysheetRangeLast(luckysheet.formula.rangeResizeTo[0]);luckysheet.formula.rangeMoveRangedata=range;obj.css(selected);},rangeMoveDragged:function rangeMoveDragged(obj){luckysheet.formula.rangeMove=false;$("#luckysheet-formula-functionrange-highlight-"+luckysheet.formula.rangeMoveIndex).data("range",luckysheet.formula.rangeMoveRangedata).find(".luckysheet-selection-copy-hc").css("opacity",0.03);},functionHTMLIndex:0,functionRangeIndex:null,findrangeindex:function findrangeindex(v,vp){var re=/<span.*?>/g;var v_a=v.replace(re,""),vp_a=vp.replace(re,"");v_a=v_a.split('</span>');vp_a=vp_a.split('</span>');v_a.pop();vp_a.pop();var pfri=luckysheet.formula.functionRangeIndex;var i=0;var spanlen=vp_a.length>v_a.length?v_a.length:vp_a.length;var vplen=vp_a.length,vlen=v_a.length;//不增加元素输入
  if(vplen==vlen){var i=pfri[0];var p=vp_a[i],n=v_a[i];if(p==null){if(vp_a.length<=i){pfri=[vp_a.length-1,vp_a.length-1];}else if(v_a.length<=i){pfri=[v_a.length-1,v_a.length-1];}return pfri;}else if(p.length==n.length){//pfri[1] = pfri[1] - 1;
  // if(pfri[1]<0){
  //     pfri[1] = 0;
  // }
  if(vp_a[i+1]!=null&&v_a[i+1]!=null&&vp_a[i+1].length<v_a[i+1].length){pfri[0]=pfri[0]+1;pfri[1]=1;}return pfri;}else if(p.length>n.length){//pfri[1] = pfri[1] - 1;
  if(p!=null&&v_a[i+1]!=null&&v_a[i+1].substr(0,1)=='"'&&(p.indexOf("{")>-1||p.indexOf("}")>-1)){pfri[0]=pfri[0]+1;pfri[1]=1;}return pfri;}else if(p.length<n.length){//pfri[1] = pfri[1];
  if(pfri[1]>n.length){pfri[1]=n.length;}return pfri;}}//减少元素输入
  else if(vplen>vlen){var i=pfri[0];var p=vp_a[i],n=v_a[i];if(n==null){if(v_a[i-1].indexOf("{")>-1){pfri[0]=pfri[0]-1;var start=v_a[i-1].search("{");pfri[1]=pfri[1]+start;}else {pfri[0]=0;pfri[1]=0;}}else if(p.length==n.length){if(v_a[i+1]!=null&&(v_a[i+1].substr(0,1)=='"'||v_a[i+1].substr(0,1)=='{'||v_a[i+1].substr(0,1)=='}')){pfri[0]=pfri[0]+1;pfri[1]=1;}else if(p!=null&&p.length>2&&p.substr(0,1)=='"'&&p.substr(p.length-1,1)=='"');else if(v_a[i]!=null&&v_a[i]=='")'){pfri[1]=1;}else if(v_a[i]!=null&&v_a[i]=='"}'){pfri[1]=1;}else if(v_a[i]!=null&&v_a[i]=='{)'){pfri[1]=1;}else {pfri[1]=n.length;}// if(pfri[1]==0){
  //     pfri[1] = 1;
  // }
  return pfri;}else if(p.length>n.length){if(v_a[i+1]!=null&&(v_a[i+1].substr(0,1)=='"'||v_a[i+1].substr(0,1)=='{'||v_a[i+1].substr(0,1)=='}')){pfri[0]=pfri[0]+1;pfri[1]=1;}return pfri;}else if(p.length<n.length){return pfri;}// if(pfri[0]>=v_a.length-1){
  //     pfri[0] = v_a.length-1;
  //     if(pfri[0]<0){
  //         pfri[0] = 0;
  //     }
  // }
  // else{
  //     if(v_a[pfri[0]+1]!=null && v_a[pfri[0]+1].substr(0,1)=='"'){
  //         pfri[0] = pfri[0] + 1;
  //     }
  //     else if(v_a[pfri[0]]!=null && v_a[pfri[0]].substr(v_a[pfri[0]].length-1,1)=='"'){
  //         pfri[0] = pfri[0] + 1;
  //     }
  //     else{
  //         pfri[0] = pfri[0];
  //     }
  // }
  // var i = pfri[0];
  // if(v_a[i]==null){
  //     pfri[1] = 0;
  // }
  // else{
  //     if(v_a[pfri[0]].length>1 && vp_a[pfri[0]+1]==","){
  //         if(vp_a[pfri[0]]=='""'){
  //             pfri[1] = 1;
  //         }
  //         else{
  //             if(vp_a[pfri[0]].substr(vp_a[pfri[0]].length-1,1)=='"'){
  //                 pfri[1] = vp_a[pfri[0]].length-1;
  //             }
  //             else{
  //                 pfri[1] = vp_a[pfri[0]].length;
  //             }
  //         }
  //     }
  //     else{
  //         if(v_a[pfri[0]+1]!=null && v_a[pfri[0]+1].substr(0,1)=='"'){
  //             pfri[1] = 1;
  //         }
  //         else if(v_a[pfri[0]]!=null && v_a[pfri[0]].substr(v_a[pfri[0]].length-1,1)=='"'){
  //             pfri[1] = 1;
  //         }
  //         else{
  //             pfri[1] = v_a[i].length;
  //         }
  //     }
  // }
  return pfri;}//增加元素输入
  else if(vplen<vlen){var i=pfri[0];var p=vp_a[i],n=v_a[i];if(p==null){pfri[0]=v_a.length-1;if(n!=null){pfri[1]=n.length;}else {pfri[1]=1;}}else if(p.length==n.length){if(vp_a[i+1]!=null&&(vp_a[i+1].substr(0,1)=='"'||vp_a[i+1].substr(0,1)=='{'||vp_a[i+1].substr(0,1)=='}')){pfri[1]=n.length;}else if(v_a[i+1]!=null&&v_a[i+1].substr(0,1)=='"'&&(v_a[i+1].substr(0,1)=='{'||v_a[i+1].substr(0,1)=='}')){pfri[0]=pfri[0]+1;pfri[1]=1;}// else if(n!=null && n.length>2 && n.substr(0,1)=='"' && n.substr(n.length-1,1)=='"'){
  //     pfri[1] = n.length;
  // }
  else if(n!=null&&n.substr(0,1)=='"'&&n.substr(n.length-1,1)=='"'&&p.substr(0,1)=='"'&&p.substr(p.length-1,1)==')'){pfri[1]=n.length;}else if(n!=null&&n.substr(0,1)=='{'&&n.substr(n.length-1,1)=='}'&&p.substr(0,1)=='{'&&p.substr(p.length-1,1)==')'){pfri[1]=n.length;}// else if(p!=null && (p.indexOf("{") >-1 || p.indexOf("}") >-1)){
  // }
  else {pfri[0]=pfri[0]+vlen-vplen;if(v_a.length>vp_a.length){pfri[1]=v_a[i+1].length;}else {pfri[1]=1;}// pfri[0] = pfri[0] + vlen - vplen - p.length + 1;
  // pfri[1] = p.length;
  }return pfri;}else if(p.length>n.length){if(p!=null&&p.substr(0,1)=='"'){pfri[1]=n.length;}else if(v_a[i+1]!=null&&/{.*?}/.test(v_a[i+1])){pfri[0]=pfri[0]+1;pfri[1]=v_a[i+1].length;}else if(p!=null&&v_a[i+1].substr(0,1)=='"'&&(p.indexOf("{")>-1||p.indexOf("}")>-1)){pfri[0]=pfri[0]+1;pfri[1]=1;}else if(p!=null&&(p.indexOf("{")>-1||p.indexOf("}")>-1));else {pfri[0]=pfri[0]+vlen-vplen-1;pfri[1]=v_a[i-1].length;}return pfri;}else if(p.length<n.length){return pfri;}// if(pfri[0]>=v_a.length-1 || vplen==0){
  //     pfri[0] = v_a.length-1;
  //     pfri[1] = 1;
  // }
  // else{
  //     if(v_a[pfri[0]+1]!=null && v_a[pfri[0]+1].substr(0,1)=='"'){
  //         pfri[0] = pfri[0] + 1;
  //         pfri[1] = 1;
  //     }
  //     else if(v_a[pfri[0]]!=null && v_a[pfri[0]].substr(v_a[pfri[0]].length-1,1)=='"'){
  //         pfri[0] = pfri[0];
  //         pfri[1] = v_a[pfri[0]].length;
  //     }
  //     else if(vp_a[pfri[0]+1]!=null && vp_a[pfri[0]+1].substr(0,1)=='"'){
  //         pfri[0] = pfri[0];
  //         pfri[1] = 1;
  //     }
  //     else{
  //         var cutfix = 0;
  //         //处理在sum之间输入N个','产生2个span的情况
  //         if(vp_a[pfri[0]].length>1 && v_a[pfri[0]+1]=="," && v_a[pfri[0]+2]!=null && !(v_a[pfri[0]+2] in {"(":0, ")":0}) ){
  //             cutfix = 1;
  //         }
  //         pfri[0] = pfri[0] + vlen - vplen - cutfix;
  //         pfri[1] = 1;
  //     }
  // }
  return pfri;}return null;while(i<spanlen){var p=vp_a[i],n=v_a[i];//console.log(p, n, i, p.length, n.length);
  }},setCaretPosition:function setCaretPosition(textDom,children,pos){try{var el=textDom;var range=document.createRange();var sel=window.getSelection();//console.log(el.childNodes[children], pos);
  range.setStart(el.childNodes[children],pos);range.collapse(true);sel.removeAllRanges();sel.addRange(range);el.focus();//if (textDom.setSelectionRange) {
  //    // IE Support
  //    textDom.focus();
  //    textDom.setSelectionRange(pos, pos);
  //} else if (textDom.createTextRange) {
  //    // Firefox support
  //    var range = textDom.createTextRange();
  //    range.collapse(true);
  //    range.moveEnd('character', pos);
  //    range.moveStart('character', pos);
  //    range.select();
  //}
  }catch(err){luckysheet.luckysheetRangeLast(luckysheet.formula.rangeResizeTo[0]);}},functionRange:function functionRange(obj,v,vp){// console.log(v, vp);
  if(window.getSelection){//ie11 10 9 ff safari
  var currSelection=window.getSelection();var fri=luckysheet.formula.findrangeindex(v,vp);//luckysheet.formula.functionRangeIndex = fri;
  //console.log(fri);
  if(fri==null){//luckysheet.formula.functionRangeIndex = currSelection.rangeCount;
  currSelection.selectAllChildren(obj.get(0));currSelection.collapseToEnd();}else {//obj = obj.find("span")[fri[0]];
  //currSelection.selectAllChildren(obj);
  //currSelection.collapse(obj, fri[1]);
  this.setCaretPosition(obj.find("span").get(fri[0]),0,fri[1]);}//currSelection.collapse(obj,luckysheet.formula.functionRangeIndex);
  }else if(document.selection){//ie10 9 8 7 6 5
  //var range = document.selection.createRange();//创建选择对象
  //var range = document.body.createTextRange();
  luckysheet.formula.functionRangeIndex.moveToElementText(obj);//range定位到obj
  luckysheet.formula.functionRangeIndex.collapse(false);//光标移至最后
  luckysheet.formula.functionRangeIndex.select();}},functionInputHanddler:function functionInputHanddler($to,$input,kcode){if(luckysheet.luckysheetConfigsetting.editMode){//此模式下禁用公式栏
  return;}var $functionbox=$to,$editer=$input;var value1=$editer.html(),value1txt=$editer.text();setTimeout(function(){var value=$editer.text();if(value.length>0&&value.substr(0,1)=="="&&(kcode!=229||value.length==1)){value=luckysheet.formula.functionHTMLGenerate(value);value1=luckysheet.formula.functionHTMLGenerate(value1txt);if(window.getSelection){// all browsers, except IE before version 9
  var currSelection=window.getSelection();if($(currSelection.anchorNode).is("div")){var editorlen=$("#luckysheet-rich-text-editor span").length;luckysheet.formula.functionRangeIndex=[editorlen-1,$("#luckysheet-rich-text-editor").find("span").eq(editorlen-1).text().length];}else {luckysheet.formula.functionRangeIndex=[$(currSelection.anchorNode).parent().index(),currSelection.anchorOffset];}}else {// Internet Explorer before version 9
  var textRange=document.selection.createRange();luckysheet.formula.functionRangeIndex=textRange;}$editer.html(value);luckysheet.formula.functionRange($editer,value,value1);// if (luckysheet.formula.functionRangeIndex != null) {
  //     luckysheet.formula.functionRange($("#luckysheet-functionbox-cell"), value, value1);
  // }
  // else{
  //     luckysheetRangeLast($("#luckysheet-functionbox-cell")[0]);
  // }
  luckysheet.formula.canceFunctionrangeSelected();luckysheet.formula.createRangeHightlight();}luckysheet.formula.rangestart=false;luckysheet.formula.rangedrag_column_start=false;luckysheet.formula.rangedrag_row_start=false;$functionbox.html(value);luckysheet.formula.rangeHightlightselected($editer,kcode);},1);},functionHTMLGenerate:function functionHTMLGenerate(txt){if(txt.length==0||txt.substr(0,1)!="="){return txt;}this.functionHTMLIndex=0;return '<span dir="auto" class="luckysheet-formula-text-color">=</span>'+this.functionHTML(txt);},functionHTML:function functionHTML(txt){if(luckysheet.formula.operatorjson==null){var arr=luckysheet.formula.operator.split("|"),op={};for(var i=0;i<arr.length;i++){op[arr[i].toString()]=1;}luckysheet.formula.operatorjson=op;}if(txt.substr(0,1)=="="){txt=txt.substr(1);}var funcstack=txt.split("");//var i=0;i<funcstack.length;i++
  var i=0,str="",function_str="";var matchConfig={"bracket":0,"comma":0,"squote":0,"dquote":0,"braces":0};while(i<funcstack.length){var s=funcstack[i];if(s=="("&&matchConfig.dquote==0&&matchConfig.braces==0){matchConfig.bracket+=1;if(str.length>0){function_str+='<span dir="auto" class="luckysheet-formula-text-func">'+str+'</span><span dir="auto" class="luckysheet-formula-text-lpar">(</span>';}else {function_str+='<span dir="auto" class="luckysheet-formula-text-lpar">(</span>';}str="";}else if(s==")"&&matchConfig.dquote==0&&matchConfig.braces==0){matchConfig.bracket-=1;//if (matchConfig.bracket == 0) {
  function_str+=luckysheet.formula.functionHTML(str)+'<span dir="auto" class="luckysheet-formula-text-rpar">)</span>';str="";}// else if (s == "'" && matchConfig.dquote == 0) {
  //     if (matchConfig.squote > 0) {
  //         function_str += str + "'</span>";
  //         if(str.length>0){
  //          function_str += '<span dir="auto" class="luckysheet-formula-text-color">' + str + "<span dir='auto' class='luckysheet-formula-text-color'>'</span>";
  //      }
  //      else{
  //          function_str += "<span dir='auto' class='luckysheet-formula-text-color'>'</span>";
  //      }
  //         matchConfig.squote -= 1;
  //         str = "";
  //     }
  //     else {
  //         matchConfig.squote += 1;
  //         str += "<span dir='auto' class='luckysheet-formula-text-color'>'</span>";
  //     }
  // }
  else if(s=="{"&&matchConfig.dquote==0){str+='{';matchConfig.braces+=1;}else if(s=="}"&&matchConfig.dquote==0){str+='}';matchConfig.braces-=1;}else if(s=='"'&&matchConfig.squote==0){if(matchConfig.dquote>0){if(str.length>0){function_str+=str+'"</span>';}else {function_str+='"</span>';}matchConfig.dquote-=1;str="";}else {matchConfig.dquote+=1;if(str.length>0){function_str+=luckysheet.formula.functionHTML(str)+'<span dir="auto" class="luckysheet-formula-text-string">"';}else {function_str+='<span dir="auto" class="luckysheet-formula-text-string">"';}//if (i == funcstack.length - 1) {
  //    function_str += "</span>";
  //}
  str="";}}else if(s==','&&matchConfig.dquote==0&&matchConfig.braces==0){//matchConfig.comma += 1;
  function_str+=luckysheet.formula.functionHTML(str)+'<span dir="auto" class="luckysheet-formula-text-comma">,</span>';str="";}else if(s=='&'&&matchConfig.dquote==0&&matchConfig.braces==0){if(str.length>0){function_str+=luckysheet.formula.functionHTML(str)+'<span dir="auto" class="luckysheet-formula-text-calc">'+'&'+'</span>';str="";}else {function_str+='<span dir="auto" class="luckysheet-formula-text-calc">'+'&'+'</span>';}}// else if (s == " " && matchConfig.dquote == 0){
  //  if(str.indexOf("</span>") == -1 && str.length>0){
  //      function_str += str + '</span>';
  //  }
  //  str = "<span dir='auto' class='luckysheet-formula-text-color'> ";
  //  if((i+1) < funcstack.length){
  //      while((i+1)<funcstack.length){
  //          if(funcstack[i+1]==" "){
  //              str += " ";
  //              i++;
  //          }
  //          else{
  //              break;
  //          }
  //      }
  //  }
  //  function_str += str + "</span>";
  // }
  else if(s in luckysheet.formula.operatorjson&&matchConfig.dquote==0&&matchConfig.braces==0){var s_next="";if(i+1<funcstack.length){s_next=funcstack[i+1];}var p=i-1,s_pre=null;if(p>=0){do{s_pre=funcstack[p--];}while(p>=0&&s_pre==" ");}if(s+s_next in luckysheet.formula.operatorjson){if(str.length>0){function_str+=luckysheet.formula.functionHTML(str)+'<span dir="auto" class="luckysheet-formula-text-calc">'+s+s_next+'</span>';str="";}else {function_str+='<span dir="auto" class="luckysheet-formula-text-calc">'+s+s_next+'</span>';}i++;}else if(!/[^0-9]/.test(s_next)&&s=="-"&&(s_pre=="("||s_pre==null||s_pre==","||s_pre==" "||s_pre in luckysheet.formula.operatorjson)){str+=s;}else {if(str.length>0){function_str+=luckysheet.formula.functionHTML(str)+'<span dir="auto" class="luckysheet-formula-text-calc">'+s+'</span>';str="";}else {function_str+='<span dir="auto" class="luckysheet-formula-text-calc">'+s+'</span>';}}}else {str+=s;}if(i==funcstack.length-1){//function_str += str;
  if(luckysheet.formula.iscelldata($.trim(str))){function_str+='<span class="luckysheet-formula-functionrange-cell" rangeindex="'+this.functionHTMLIndex+'" dir="auto" style="color:'+luckysheet.jfcolor[this.functionHTMLIndex]+';">'+str+'</span>';this.functionHTMLIndex++;}else if(matchConfig.dquote>0){function_str+=str+'</span>';}else if(str.indexOf("</span>")==-1&&str.length>0){var regx=/{.*?}/;if(regx.test($.trim(str))){var arraytxt=regx.exec(str)[0];var arraystart=str.search(regx);var alltxt="";if(arraystart>0){alltxt+='<span dir="auto" class="luckysheet-formula-text-color">'+str.substr(0,arraystart)+'</span>';}alltxt+='<span dir="auto" style="color:#959a05" class="luckysheet-formula-text-array">'+arraytxt+'</span>';if(arraystart+arraytxt.length<str.length){alltxt+='<span dir="auto" class="luckysheet-formula-text-color">'+str.substr(arraystart+arraytxt.length,str.length)+'</span>';}function_str+=alltxt;}else {function_str+='<span dir="auto" class="luckysheet-formula-text-color">'+str+'</span>';}// if(!isNaN(str)){
  //     function_str += '<span dir="auto" class="luckysheet-formula-text-color">' + str + '</span>';
  // }
  // else{
  //     function_str += '<span dir="auto" class="luckysheet-formula-text-color">' + str + '</span>';  
  // }
  }}//console.log(i, str, function_str, s);
  i++;}//console.log(function_str);
  return function_str;},getfunctionParam:function getfunctionParam(txt){if(luckysheet.formula.operatorjson==null){var arr=luckysheet.formula.operator.split("|"),op={};for(var i=0;i<arr.length;i++){op[arr[i].toString()]=1;}luckysheet.formula.operatorjson=op;}if(txt.substr(0,1)=="="){txt=txt.substr(1);}var funcstack=txt.split("");//var i=0;i<funcstack.length;i++
  var i=0,str="";var matchConfig={"bracket":0,"comma":0,"squote":0,"dquote":0,"compare":0};//bracket 0为运算符括号、1为函数括号
  var fn=null,param=[],bracket=[];while(i<funcstack.length){var s=funcstack[i];if(s=="("&&matchConfig.dquote==0){if(str.length>0&&bracket.length==0){fn=str.toUpperCase();bracket.push(1);str="";}else if(bracket.length==0){//function_str += "(";
  bracket.push(0);str="";}else {bracket.push(0);str+=s;}}else if(s==")"&&matchConfig.dquote==0){var bt=bracket.pop();if(bracket.length==0){//function_str += luckysheet.formula.functionParser(str) + ")";
  param.push(str);str="";}else {str+=s;}}else if(s=='"'){str+='"';if(matchConfig.dquote>0){matchConfig.dquote-=1;str="";}else {matchConfig.dquote+=1;}}else if(s==','&&matchConfig.dquote==0){if(bracket.length<=1){//function_str += luckysheet.formula.functionParser(str) + ",";
  param.push(str);str="";}else {str+=",";}}else if(s in luckysheet.formula.operatorjson&&matchConfig.dquote==0){var s_next="";if(i+1<funcstack.length){s_next=funcstack[i+1];}var p=i-1,s_pre=null;if(p>=0){do{s_pre=funcstack[p--];}while(p>=0&&s_pre==" ");}if(!/[^0-9]/.test(s_next)&&s=="-"&&(s_pre=="("||s_pre==null||s_pre==","||s_pre==" "||s_pre in luckysheet.formula.operatorjson)){if(matchConfig.dquote==0){str+=$.trim(s);}else {str+=s;}}else {str="";}}else {if(matchConfig.dquote==0){str+=$.trim(s);}else {str+=s;}}i++;}// console.log({"fn":fn, "param":param});
  return {"fn":fn,"param":param};},functionParser1:function functionParser1(txt){if(luckysheet.formula.operatorjson==null){var arr=luckysheet.formula.operator.split("|"),op={};for(var i=0;i<arr.length;i++){op[arr[i].toString()]=1;}luckysheet.formula.operatorjson=op;}if(txt.substr(0,1)=="="){txt=txt.substr(1);}var funcstack=txt.split("");//var i=0;i<funcstack.length;i++
  var i=0,str="",function_str="";var matchConfig={"bracket":0,"comma":0,"squote":0,"dquote":0,"compare":0};while(i<funcstack.length){var s=funcstack[i];if(s=="("&&matchConfig.dquote==0){matchConfig.bracket+=1;if(str.length>0){function_str+="luckysheet_function."+str.toUpperCase()+".f(";}else {function_str+="(";}str="";}else if(s==")"&&matchConfig.dquote==0){matchConfig.bracket-=1;//console.log(function_str, "#####",str);
  function_str+=luckysheet.formula.functionParser(str);console.log(matchConfig.compare);if(matchConfig.compare==1){function_str+='))';matchConfig.compare=0;}else {function_str+=')';}//console.log(function_str, "#####",str);
  str="";}//else if (s == "'" && matchConfig.dquote==0) {
  //  if(matchConfig.squote>0){
  //      function_str += str + "'";
  //        matchConfig.squote -= 1;
  //        str = "";
  //  }
  //  else{
  //      matchConfig.squote += 1;
  //      str += "'";
  //  }
  //}
  else if(s=='"'&&matchConfig.squote==0){if(matchConfig.dquote>0){function_str+=str+'"';matchConfig.dquote-=1;str="";}else {matchConfig.dquote+=1;str+='"';}}else if(s==','&&matchConfig.dquote==0){//matchConfig.comma += 1;
  //console.log(function_str, "#####",str);
  function_str+=luckysheet.formula.functionParser(str);if(matchConfig.compare==1){function_str+='),';matchConfig.compare=0;}else {function_str+=',';}//console.log(function_str, "#####",str);
  str="";}// else if (s == '&' && matchConfig.dquote == 0) {
  //     if (str.length > 0) {
  //         function_str += luckysheet.formula.functionParser(str) + "+";
  //         str = "";
  //     } else {
  //         function_str += "+";
  //     }
  // } 
  else if(s in luckysheet.formula.operatorjson&&matchConfig.dquote==0){var s_next="";if(i+1<funcstack.length){s_next=funcstack[i+1];}if(s+s_next in luckysheet.formula.operatorjson){if(str.length>0){matchConfig.compare=1;function_str+="luckysheet_compareWith("+luckysheet.formula.functionParser(str)+",'"+s+s_next+"', ";str="";}else {function_str+=s+s_next;}i++;}else {if(str.length>0){matchConfig.compare=1;function_str+="luckysheet_compareWith("+luckysheet.formula.functionParser(str)+",'"+s+"', ";str="";}else {function_str+=s;}}}else {str+=s;}if(i==funcstack.length-1){//function_str += str;
  if(luckysheet.formula.iscelldata($.trim(str))){function_str+="luckysheet_getcelldata('"+$.trim(str)+"')";}else {function_str+=$.trim(str);}}//console.log(i, str, function_str, s);
  i++;}console.log(function_str);return function_str;},calPostfixExpression:function calPostfixExpression(cal){if(cal.length==0){return "";}var stack=[];for(var i=cal.length-1;i>=0;i--){var c=cal[i];if(c in luckysheet.formula.operatorjson){var s2=stack.pop();var s1=stack.pop();var str="luckysheet_compareWith("+s1+",'"+c+"', "+s2+")";stack.push(str);}else {stack.push(c);}}if(stack.length>0){return stack[0];}else {return "";}},checkBracketNum:function checkBracketNum(fp){var bra_l=fp.match(/\(/g),bra_r=fp.match(/\)/g),//bra_tl_txt = fp.match(/".*?\(.*?"/g),
  //bra_tr_txt = fp.match(/".*?\).*?"/g);
  /*new runze*/bra_tl_txt=fp.match(/(['"])(?:(?!\1).)*?\1/g);bra_tr_txt=fp.match(/(['"])(?:(?!\1).)*?\1/g);var bra_l_len=0,bra_r_len=0;if(bra_l!=null){bra_l_len+=bra_l.length;}if(bra_r!=null){bra_r_len+=bra_r.length;}var bra_tl_len=0,bra_tr_len=0;if(bra_tl_txt!=null){for(var i=0;i<bra_tl_txt.length;i++){var bra_tl=bra_tl_txt[i].match(/\(/g);if(bra_tl!=null){bra_tl_len+=bra_tl.length;}}}if(bra_tr_txt!=null){for(var i=0;i<bra_tr_txt.length;i++){var bra_tr=bra_tr_txt[i].match(/\)/g);if(bra_tr!=null){bra_tr_len+=bra_tr.length;}}}bra_l_len-=bra_tl_len;bra_r_len-=bra_tr_len;if(bra_l_len!=bra_r_len){return false;}else {return true;}},operatorPriority:{"^":0,"%":1,"*":1,"/":1,"+":2,"-":2},functionParser:function functionParser(txt){if(luckysheet.formula.operatorjson==null){var arr=luckysheet.formula.operator.split("|"),op={};for(var i=0;i<arr.length;i++){op[arr[i].toString()]=1;}luckysheet.formula.operatorjson=op;}if(txt.substr(0,1)=="="){txt=txt.substr(1);}var funcstack=txt.split("");//var i=0;i<funcstack.length;i++
  var i=0,str="",function_str="";var matchConfig={"bracket":0,"comma":0,"squote":0,"dquote":0,"compare":0,"braces":0};//=(sum(b1:c10)+10)*5-100
  //=MAX(B1:C10,10)*5-100
  // =(sum(max(B1:C10,10)*5-100,((1+1)*2+5)/2,10)+count(B1:C10,10*5-100))*5-100
  //=SUM(MAX(B1:C10,10)*5-100,((1+1)*2+5)/2,10)+COUNT(B1:C10,10*5-100)
  //=SUM(MAX(B1:C10,10)*5-100,((1+1)*2+5)/2,10)
  //=SUM(10,((1+1)*2+5)/2,10)
  //=SUM(MAX(B1:C10,10)*5-100)
  //bracket 0为运算符括号、1为函数括号
  var cal1=[],cal2=[],bracket=[];while(i<funcstack.length){var s=funcstack[i];if(s=="("&&matchConfig.dquote==0&&matchConfig.braces==0){if(str.length>0&&bracket.length==0){function_str+="luckysheet_function."+str.toUpperCase()+".f(";bracket.push(1);str="";}else if(bracket.length==0){function_str+="(";bracket.push(0);str="";}else {bracket.push(0);str+=s;}}else if(s==")"&&matchConfig.dquote==0&&matchConfig.braces==0){var bt=bracket.pop();if(bracket.length==0){function_str+=luckysheet.formula.functionParser(str)+")";str="";}else {str+=s;}}else if(s=="{"&&matchConfig.dquote==0){str+='{';matchConfig.braces+=1;}else if(s=="}"&&matchConfig.dquote==0){str+='}';matchConfig.braces-=1;}else if(s=='"'){str+='"';if(matchConfig.dquote>0){matchConfig.dquote-=1;}else {matchConfig.dquote+=1;}}else if(s==','&&matchConfig.dquote==0&&matchConfig.braces==0){if(bracket.length<=1){function_str+=luckysheet.formula.functionParser(str)+",";str="";}else {str+=",";}}else if(s in luckysheet.formula.operatorjson&&matchConfig.dquote==0&&matchConfig.braces==0){var s_next="";var op=luckysheet.formula.operatorPriority;if(i+1<funcstack.length){s_next=funcstack[i+1];}if(s+s_next in luckysheet.formula.operatorjson){if(bracket.length==0){if($.trim(str).length>0){cal2.unshift(luckysheet.formula.functionParser($.trim(str)));}else if($.trim(function_str).length>0){cal2.unshift($.trim(function_str));}if(cal1[0]in luckysheet.formula.operatorjson){var stackCeilPri=op[cal1[0]];while(cal1.length>0&&stackCeilPri!=null){cal2.unshift(cal1.shift());stackCeilPri=op[cal1[0]];}}cal1.unshift(s+s_next);function_str="";str="";}else {str+=s+s_next;}i++;}else {if(bracket.length==0){if($.trim(str).length>0){cal2.unshift(luckysheet.formula.functionParser($.trim(str)));}else if($.trim(function_str).length>0){cal2.unshift($.trim(function_str));}if(cal1[0]in luckysheet.formula.operatorjson){var stackCeilPri=op[cal1[0]];stackCeilPri=stackCeilPri==null?1000:stackCeilPri;var sPri=op[s];sPri=sPri==null?1000:sPri;while(cal1.length>0&&sPri>=stackCeilPri){cal2.unshift(cal1.shift());stackCeilPri=op[cal1[0]];stackCeilPri=stackCeilPri==null?1000:stackCeilPri;}}cal1.unshift(s);function_str="";str="";}else {str+=s;}}}else {if(matchConfig.dquote==0){str+=$.trim(s);}else {str+=s;}}if(i==funcstack.length-1){var endstr="";if(luckysheet.formula.iscelldata($.trim(str))){endstr="luckysheet_getcelldata('"+$.trim(str)+"')";}else {str=$.trim(str);var regx=/{.*?}/;if(regx.test(str)&&str.substr(0,1)!='"'&&str.substr(str.length-1,1)!='"'){var arraytxt=regx.exec(str)[0];var arraystart=str.search(regx);if(arraystart>0){endstr+=str.substr(0,arraystart);}endstr+="luckysheet_getarraydata('"+arraytxt+"')";if(arraystart+arraytxt.length<str.length){endstr+=str.substr(arraystart+arraytxt.length,str.length);}}else {endstr=str;}}if(endstr.length>0){cal2.unshift(endstr);}if(cal1.length>0){if(function_str.length>0){cal2.unshift(function_str);function_str="";}while(cal1.length>0){cal2.unshift(cal1.shift());}}if(cal2.length>0){function_str=luckysheet.formula.calPostfixExpression(cal2);}else {function_str+=endstr;}}i++;}return function_str;},addFunctionGroup:function addFunctionGroup(r,c,func,index){if(index==null){index=luckysheet.currentSheetIndex;}var luckysheetfile=luckysheet.getluckysheetfile();var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(index)];if(file.calcChain==null){file.calcChain=[];}var cc={"r":r,"c":c,"index":index,"func":func};file.calcChain.push(cc);luckysheet.server.saveParam("fc",index,JSON.stringify(cc),{"op":"add","pos":file.calcChain.length-1});luckysheet.setluckysheetfile(luckysheetfile);},getFunctionGroup:function getFunctionGroup(index){if(index==null){index=luckysheet.currentSheetIndex;}var luckysheetfile=luckysheet.getluckysheetfile();var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(index)];if(file.calcChain==null){return [];}return file.calcChain;},updateFunctionGroup:function updateFunctionGroup(r,c,func,index){if(index==null){index=luckysheet.currentSheetIndex;}var luckysheetfile=luckysheet.getluckysheetfile();var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(index)];var calcChain=file.calcChain;if(calcChain!=null){for(var i=0;i<calcChain.length;i++){var calc=calcChain[i];if(calc.r==r&&calc.c==c&&calc.index==index){calcChain[i].func=func;luckysheet.server.saveParam("fc",index,JSON.stringify(calc),{"op":"update","pos":i});break;}}}luckysheet.setluckysheetfile(luckysheetfile);},insertUpdateFunctionGroup:function insertUpdateFunctionGroup(r,c,func,index){if(index==null){index=luckysheet.currentSheetIndex;}if(func==null){this.delFunctionGroup(r,c,index);return;}var luckysheetfile=luckysheet.getluckysheetfile();var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(index)];var calcChain=file.calcChain;if(calcChain==null){calcChain=[];}for(var i=0;i<calcChain.length;i++){var calc=calcChain[i];if(calc.r==r&&calc.c==c&&calc.index==index){calc.func=func;luckysheet.server.saveParam("fc",index,JSON.stringify(calc),{"op":"update","pos":i});return;}}var cc={"r":r,"c":c,"index":index,"func":func};calcChain.push(cc);file.calcChain=calcChain;luckysheet.server.saveParam("fc",index,JSON.stringify(cc),{"op":"add","pos":file.calcChain.length-1});luckysheet.setluckysheetfile(luckysheetfile);},isFunctionRangeSave:false,isFunctionRange:function isFunctionRange(txt,r,c){if(luckysheet.formula.operatorjson==null){var arr=luckysheet.formula.operator.split("|"),op={};for(var i=0;i<arr.length;i++){op[arr[i].toString()]=1;}luckysheet.formula.operatorjson=op;}if(txt.substr(0,1)=="="){txt=txt.substr(1);}var funcstack=txt.split("");//var i=0;i<funcstack.length;i++
  var i=0,str="",function_str="";var matchConfig={"bracket":0,"comma":0,"squote":0,"dquote":0};var luckysheetfile=luckysheet.getluckysheetfile();var dynamicArray_compute=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["dynamicArray_compute"]==null?{}:luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)]["dynamicArray_compute"];while(i<funcstack.length){var s=funcstack[i];if(s=="("&&matchConfig.dquote==0){matchConfig.bracket+=1;if(str.length>0){function_str+="luckysheet_function."+str.toUpperCase()+".f(";}else {function_str+="(";}str="";}else if(s==")"&&matchConfig.dquote==0){matchConfig.bracket-=1;//if (matchConfig.bracket == 0) {
  function_str+=luckysheet.formula.isFunctionRange(str,r,c)+")";str="";//}
  }else if(s==','&&matchConfig.dquote==0){//matchConfig.comma += 1;
  function_str+=luckysheet.formula.isFunctionRange(str,r,c)+',';str="";}else if(s in luckysheet.formula.operatorjson&&matchConfig.dquote==0){var s_next="";if(i+1<funcstack.length){s_next=funcstack[i+1];}if(s+s_next in luckysheet.formula.operatorjson){if(str.length>0){function_str+=luckysheet.formula.isFunctionRange(str,r,c)+s+s_next;str="";}else {function_str+=s+s_next;}i++;}else {if(str.length>0){function_str+=luckysheet.formula.isFunctionRange(str,r,c)+s;str="";}else {function_str+=s;}}}else {str+=s;}if(i==funcstack.length-1){//function_str += str;
  if(luckysheet.formula.iscelldata($.trim(str))){//function_str += "luckysheet_getcelldata('" + $.trim(str) + "')";
  if(r!=null&&c!=null){var range=this.getcellrange($.trim(str));var row=range.row,col=range.column;if(r+"_"+c in dynamicArray_compute){var isd_range=false;for(var d_r=row[0];d_r<=row[1];d_r++){for(var d_c=col[0];d_c<=col[1];d_c++){if(d_r+"_"+d_c in dynamicArray_compute&&dynamicArray_compute[d_r+"_"+d_c].r==r&&dynamicArray_compute[d_r+"_"+d_c].c==c){isd_range=true;}}}if(isd_range){this.isFunctionRangeSave=this.isFunctionRangeSave||true;}else {this.isFunctionRangeSave=this.isFunctionRangeSave||false;}}else {if(r>=row[0]&&r<=row[1]&&c>=col[0]&&c<=col[1]){this.isFunctionRangeSave=this.isFunctionRangeSave||true;}else {this.isFunctionRangeSave=this.isFunctionRangeSave||false;}}}else {var sheetlen=$.trim(str).split("!");if(sheetlen.length>1){this.isFunctionRangeSave=this.isFunctionRangeSave||true;}else {this.isFunctionRangeSave=this.isFunctionRangeSave||false;}}}//else {
  //    function_str += $.trim(str);
  //}
  }i++;}return function_str;},execvertex:{},execFunctionGroupData:null,execFunctionExist:null,execFunctionGroup:function execFunctionGroup(origin_r,origin_c,value,index,data){if(data==null){data=luckysheet.flowdata;}this.execFunctionGroupData=$.extend(true,[],data);if(value!=null){//此处setcellvalue 中this.execFunctionGroupData会保存想要更新的值，本函数结尾不要设为null,以备后续函数使用
  luckysheet.setcellvalue(origin_r,origin_c,this.execFunctionGroupData,value);}if(index==null){index=luckysheet.currentSheetIndex;}//{ "r": r, "c": c, "index": index, "func": func}
  var group=this.getFunctionGroup(index),vertex1={},stack=[],count=0;this.execvertex={};if(this.execFunctionExist==null){var luckysheetfile=luckysheet.getluckysheetfile();for(var i=0;i<group.length;i++){var item=group[i];var cell=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(item["index"])].data[item.r][item.c];if(cell!=null&&cell.f!=null&&cell.f==item.func[2]){if(!(item instanceof Object)){item=eval('('+item+')');}item.color="w";item.parent=null;item.chidren={};item.times=0;vertex1["r"+item.r.toString()+"c"+item.c.toString()]=item;this.isFunctionRangeSave=false;if(origin_r!=null&&origin_c!=null){this.isFunctionRange(item.func[2],origin_r,origin_c);}else {this.isFunctionRange(item.func[2]);}if(this.isFunctionRangeSave){stack.push(item);this.execvertex["r"+item.r.toString()+"c"+item.c.toString()]=item;count++;}//var v = luckysheet.formula.execfunction(f);
  //value = { "v": v[1], "f": v[2] };
  //data[item.r][item.c] = value;
  }}}else {for(var x=0;x<this.execFunctionExist.length;x++){var cell=this.execFunctionExist[x];if("r"+cell.r.toString()+"c"+cell.c.toString()in vertex1){continue;}for(var i=0;i<group.length;i++){var item=group[i];item.color="w";item.parent=null;item.chidren={};item.times=0;vertex1["r"+item.r.toString()+"c"+item.c.toString()]=item;this.isFunctionRangeSave=false;this.isFunctionRange(item.func[2],cell.r,cell.c);if(this.isFunctionRangeSave){stack.push(item);this.execvertex["r"+item.r.toString()+"c"+item.c.toString()]=item;count++;}}}}var x=0;while(stack.length>0){var u=stack.shift();for(var name in vertex1){if(u.r==vertex1[name].r&&u.c==vertex1[name].c){continue;}this.isFunctionRangeSave=false;//this.isFunctionRange(u.func[2], vertex1[name].r, vertex1[name].c);
  this.isFunctionRange(vertex1[name].func[2],u.r,u.c);if(this.isFunctionRangeSave){var v=vertex1[name];if(!(name in this.execvertex)){stack.push(v);this.execvertex[name]=v;}count++;this.execvertex[name].chidren["r"+u.r.toString()+"c"+u.c.toString()]=1;}}}this.groupValuesRefreshData=[];var i=0;while(i<count){for(var name in this.execvertex){var u=this.execvertex[name];if(u.color=="w"){this.functionDFS(u);}else if(u.color=="b"){i++;}}}//保留this.execFunctionGroupData用于传输更新结果
  //this.execFunctionGroupData = null;
  this.execFunctionExist=null;},//深度优先算法，处理多级调用函数
  functionDFS:function functionDFS(u){u.color="g";u.times+=1;for(var chd in u.chidren){var v=this.execvertex[chd];if(v.color=="w"){v.parent="r"+u.r.toString()+"c"+u.c.toString();this.functionDFS(v);}}u.color="b";window.luckysheet_getcelldata_cache=null;var v=luckysheet.formula.execfunction(u.func[2],u.r,u.c);var value=this.execFunctionGroupData[u.r][u.c];if(value==null){value={};}value.v=v[1];value.f=v[2];if(value.spl!=null){window.luckysheetCurrentRow=u.r;window.luckysheetCurrentColumn=u.c;window.luckysheetCurrentFunction=this.execFunctionGroupData[u.r][u.c].f;var fp=$.trim(luckysheet.formula.functionParser(this.execFunctionGroupData[u.r][u.c].f));var sparklines=eval(fp);value.spl=sparklines;}this.groupValuesRefreshData.push({"r":u.r,"c":u.c,"v":value,"i":luckysheet.currentSheetIndex});this.execFunctionGroupData[u.r][u.c]=value;},groupValuesRefreshData:[],groupValuesRefresh:function groupValuesRefresh(){if(this.groupValuesRefreshData.length>0){for(var i=0;i<this.groupValuesRefreshData.length;i++){var item=this.groupValuesRefreshData[i];if(item.i!=luckysheet.currentSheetIndex){continue;}luckysheet.setcellvalue(item.r,item.c,luckysheet.flowdata,item.v);luckysheet.server.saveParam("v",luckysheet.currentSheetIndex,item.v,{"r":item.r,"c":item.c});}luckysheet.editor.webWorkerFlowDataCache(luckysheet.flowdata);//worker存数据
  }},delFunctionGroup:function delFunctionGroup(r,c,index){if(index==null){index=luckysheet.currentSheetIndex;}var luckysheetfile=luckysheet.getluckysheetfile();var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(index)];var calcChain=file.calcChain;if(calcChain!=null){for(var i=0;i<calcChain.length;i++){var calc=calcChain[i];if(calc.r==r&&calc.c==c&&calc.index==index){calcChain.splice(i,1);luckysheet.server.saveParam("fc",index,null,{"op":"del","pos":i});break;}}}luckysheet.setluckysheetfile(luckysheetfile);},execfunction1:function execfunction1(txt,r,c,isrefresh){var fp=$.trim(this.functionParser(txt));var funcf=fp.match(/luckysheet_function/g),funcg=fp.match(/luckysheet_getcelldata/g),funcc=fp.match(/luckysheet_compareWith/g),funclen=0;if(isrefresh==null){isrefresh=false;}if(funcf!=null){funclen+=funcf.length;}if(funcg!=null){funclen+=funcg.length;}if(funcc!=null){funclen+=funcc.length;}var quota1=fp.match(/\(/g),quota2=fp.match(/\)/g),quotalen=0;if(quota1!=null){quotalen+=quota1.length;}if(quota2!=null){quotalen+=quota2.length;}//var funclen = fp.match(/luckysheet_function/g).length + fp.match(/luckysheet_getcelldata/g).length;
  //var quotalen = fp.match(/\(/g).length + fp.match(/\)/g).length;
  //if(fp.substr(0, 16)=="luckysheet_function." && (fp.substr(fp.length-1, 1)!=")" || funclen!=quotalen/2 )  ){
  //console.log("fp.substr(0, 18)",fp.substr(0, 18));
  if((fp.substr(0,16)=="luckysheet_function."||fp.substr(0,18)=="luckysheet_compareWith")&&funclen!=quotalen/2){fp+=")";if(fp.substr(0,16)=="luckysheet_function."){txt+=")";}this.functionHTMLIndex=0;$("#luckysheet-functionbox-cell").html('<span dir="auto" class="luckysheet-formula-text-color">=</span>'+this.functionHTML(txt));}if(!this.testFunction(txt,fp)){luckysheet.tooltip.info("提示","公式存在错误");return [false,this.error.n,txt];}var result=null;window.luckysheetCurrentRow=r;window.luckysheetCurrentColumn=c;window.luckysheetCurrentFunction=txt;try{result=eval(fp);}catch(e){var err=e;//err错误提示处理
  console.log(e);err=luckysheet.formula.errorInfo(err);result=[luckysheet.formula.error.n,err];}if(result instanceof Array){result=result[0];//错误处理
  }else if(result instanceof Object){result=result.data;if(result instanceof Array){result=result[0];}}window.luckysheetCurrentRow=null;window.luckysheetCurrentColumn=null;window.luckysheetCurrentFunction=null;if(fp.substr(0,19)=="luckysheet_getcelldata("){if(result instanceof Array){result=result.join(",");}else if(result instanceof Object){result=result.v;}}if(r!=null&&c!=null){//luckysheet.flowdata[r][c] = result;
  if(isrefresh){this.execFunctionGroup(r,c,result);}this.insertUpdateFunctionGroup(r,c,[true,result,txt]);}return [true,result,txt];},execfunction:function execfunction(txt,r,c,isrefresh,notInsertFunc){if(txt.indexOf(this.error.r)>-1){return [false,this.error.r,txt];}if(!this.checkBracketNum(txt)){txt+=")";}var fp=$.trim(this.functionParser(txt));if(fp.substr(0,16)=="luckysheet_function."||fp.substr(0,18)=="luckysheet_compareWith"){this.functionHTMLIndex=0;// $("#luckysheet-functionbox-cell").html('<span dir="auto" class="luckysheet-formula-text-color">=</span>' + this.functionHTML(txt));
  }if(!this.testFunction(txt,fp)||fp==""){luckysheet.tooltip.info("提示","公式存在错误");return [false,this.error.n,txt];}var result=null;window.luckysheetCurrentRow=r;window.luckysheetCurrentColumn=c;window.luckysheetCurrentFunction=txt;var sparklines=null;try{if(fp.indexOf("luckysheet_getcelldata")>-1){var funcg=fp.split("luckysheet_getcelldata('");for(var i=1;i<funcg.length;i++){var funcgStr=funcg[i].split("')")[0];var funcgRange=luckysheet.formula.getcellrange(funcgStr);if(funcgRange.row[0]<0||funcgRange.column[0]<0){return [true,luckysheet.formula.error.r,txt];}if(funcgRange.sheetIndex==luckysheet.currentSheetIndex&&r>=funcgRange.row[0]&&r<=funcgRange.row[1]&&c>=funcgRange.column[0]&&c<=funcgRange.column[1]){if(luckysheet.luckysheetConfigsetting.editMode){alert("公式不可引用其本身的单元格");}else {luckysheet.tooltip.info("公式不可引用其本身的单元格，会导致计算结果不准确","");}return [false,0,txt];}}}result=eval(fp);//加入sparklines的参数项目
  if(fp.indexOf("SPLINES")>-1){sparklines=result;result="";}}catch(e){var err=e;//err错误提示处理
  console.log(e);err=luckysheet.formula.errorInfo(err);result=[luckysheet.formula.error.n,err];}//公式结果是对象，则表示只是选区。如果是单个单元格，则返回其值；如果是多个单元格，则返回 #VALUE!。
  if(luckysheet.getObjType(result)=="object"&&result.startCell!=null){if(luckysheet.getObjType(result.data)=="array"){result=luckysheet.formula.error.v;}else {if(result.data==null||luckysheet.func_methods.isRealNull(result.data.v)){result=0;}else {result=result.data.v;}}}//公式结果是数组，分错误值 和 动态数组 两种情况
  if(luckysheet.getObjType(result)=="array"){var isErr=false;if(luckysheet.getObjType(result[0])!="array"&&result.length==2){isErr=luckysheet.func_methods.valueIsError(result[0]);}if(!isErr){if(luckysheet.getObjType(result[0])=="array"&&result.length==1&&result[0].length==1){result=result[0][0];}else {var luckysheetfile=luckysheet.getluckysheetfile();var file=luckysheetfile[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];var dynamicArray=file["dynamicArray"]==null?[]:file["dynamicArray"];dynamicArray.push({"r":r,"c":c,"f":txt,"data":result});file["dynamicArray"]=dynamicArray;luckysheet.setluckysheetfile(luckysheetfile);result="";}}else {result=result[0];}}window.luckysheetCurrentRow=null;window.luckysheetCurrentColumn=null;window.luckysheetCurrentFunction=null;if(r!=null&&c!=null){if(isrefresh){this.execFunctionGroup(r,c,result);}if(!notInsertFunc){this.insertUpdateFunctionGroup(r,c,[true,result,txt]);}}if(!!sparklines){return [true,result,txt,{type:"sparklines",data:sparklines}];}return [true,result,txt];},testFunction:function testFunction(txt,fp){if(txt.substr(0,1)=="="){return true;}else {return false;}},functionResizeData:{},functionResizeStatus:false,functionResizeTimeout:null,data_parm_index:0//选择公式后参数索引标记
  };//{"0":"数学","1":"统计","2":"查找","3":"Luckysheet内置","4":"数据挖掘","5":"数据源","6":"日期","7":"过滤器","8":"财务","9":"工程计算","10":"逻辑","11":"运算符","12":"文本","13":"转换工具","14":"数组"}
  luckysheet.functionlist=[{'n':'SUMIF','t':0,'d':'对范围中符合指定条件的值求和。','a':'对范围中符合指定条件的值求和。','m':[2,3],'p':[{'name':'范围','detail':'要根据条件进行检测的范围。','example':'A1:A10','require':'m','repeat':'n','type':'range'},{'name':'条件','detail':'要应用于范围的模式或测试条件。\n\n如果范围包含的是要检测的文本，则条件必须为字符串。条件可以包含通配符，包括用于匹配单个字符的?或用于匹配零个或连续多个字符的*。要匹配问号星号本身，请在该字符前面加上波浪号(~)前缀（即~?和~*）。字符串条件必须用引号括起来。函数会检查范围中的每个单元格与条件是否相等或匹配（如果使用了通配符）。\n\n如果范围包含的是要检测的数字，则条件可以是字符串也可以是数字。如果给定的条件是一个数字，则检查范围中的每个单元格是否等于条件。另外，条件也可能是包含数字的字符串（也将对其进行相等检测），或者带有以下前缀的数字：=（检查是否相等）、>（检查范围单元格的值是否大于条件值）或<（检查范围单元格的值是否小于条件值）','example':'">20"','require':'m','repeat':'n','type':'rangeall'},{'name':'求和范围','detail':'要求和的范围（如果与范围不同）。','example':'B1:B10','require':'o','repeat':'n','type':'range'}]},{'n':'TAN','t':0,'d':'返回已知角度的正切值。','a':'返回已知角度的正切值。','m':[1,1],'p':[{'name':'角度','detail':'要求其正切值的角度，以弧度表示。','example':'45*PI()/180','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'TANH','t':0,'d':'返回给定实数的双曲正切值。','a':'返回给定实数的双曲正切值。','m':[1,1],'p':[{'name':'值','detail':'要计算其双曲正切值的实数。','example':'A2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'CEILING','t':0,'d':'将数值向上取整为最接近的指定因数的倍数。','a':'将数值向上取整为最接近的指定因数的倍数。','m':[2,2],'p':[{'name':'值','detail':'要向上舍入的数值。','example':'23.25','require':'m','repeat':'n','type':'rangenumber'},{'name':'因数','detail':'要将值舍入到此数的整数倍。','example':'0.1','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ATAN','t':0,'d':'返回数值的反正切值，以弧度表示。','a':'返回数值的反正切值','m':[1,1],'p':[{'name':'值','detail':'要计算其反正切值的数值。','example':'0','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ASINH','t':0,'d':'返回数值的反双曲正弦值。','a':'返回数值的反双曲正弦值。','m':[1,1],'p':[{'name':'值','detail':'要计算其反双曲正弦值的数值。','example':'0.9','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ABS','t':0,'d':'返回数值的绝对值。','a':'返回数值的绝对值。','m':[1,1],'p':[{'name':'value','detail':'要返回其绝对值的数。','example':'-2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ACOS','t':0,'d':'返回数值的反余弦值，以弧度表示。','a':'返回数值的反余弦值','m':[1,1],'p':[{'name':'值','detail':'要计算其反余弦值的数值。必须介于-1和1之间，包括两端值。','example':'0','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ACOSH','t':0,'d':'返回数值的反双曲余弦值。','a':'返回数值的反双曲余弦值。','m':[1,1],'p':[{'name':'值','detail':'要计算其反双曲余弦值的数值。必须大于等于1。','example':'2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'MULTINOMIAL','t':0,'d':'返回参数和的阶乘除以各参数阶乘的乘积后得到的值。','a':'返回参数和的阶乘除以各参数阶乘的乘积后得到的值。','m':[1,255],'p':[{'name':'值1','detail':'用于计算的第一项数值或范围。','example':'1','require':'m','repeat':'n','type':'rangeall'},{'name':'值2','detail':'用于计算的其他数值或范围。','example':'2','require':'o','repeat':'y','type':'rangeall'}]},{'n':'ATANH','t':0,'d':'返回数值的反双曲正切值。','a':'返回数值的反双曲正切值。','m':[1,1],'p':[{'name':'值','detail':'要计算其反双曲正切值的数值。必须介于-1和1之间（不包括-1和1）。','example':'0.9','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ATAN2','t':0,'d':'以弧度为单位返回 x 轴与从原点 (0,0) 到指定坐标点 (`x`,`y`) 之间连线的夹角。','a':'以弧度为单位返回 x 轴与从原点 (0,0) 到指定坐标点 (`x`,`y`) 之间连线的夹角。','m':[2,2],'p':[{'name':'x','detail':'要计算其与x轴夹角大小的线段的终点x坐标。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'y','detail':'要计算其与x轴夹角大小的线段的终点y坐标。','example':'3','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'COUNTBLANK','t':1,'d':'返回给定范围内的空单元格数。','a':'返回给定范围内的空单元格数。','m':[1,1],'p':[{'name':'范围','detail':'要统计空白单元格数量的范围。','example':'A2:C100','require':'m','repeat':'n','type':'range'}]},{'n':'COSH','t':0,'d':'返回给定实数的双曲余弦值。','a':'返回给定实数的双曲余弦值。','m':[1,1],'p':[{'name':'值','detail':'要计算其双曲余弦值的实数值。','example':'A2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'INT','t':0,'d':'将数值向下取整为小于或等于该数的最接近的整数。','a':'将数值向下取整为小于或等于该数的最接近的整数。','m':[1,1],'p':[{'name':'值','detail':'要向下取整为最接近的整数的数值。','example':'99.44','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ISEVEN','t':0,'d':'检查所提供的数值是否为偶数。','a':'检查所提供的数值是否为偶数。','m':[1,1],'p':[{'name':'值','detail':'要验证其是否为偶数的数值。\n\n如果值为偶数或指向包含偶数的单元格的引用，ISEVEN将返回TRUE，否则返回FALSE。','example':'4','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ISODD','t':0,'d':'检查所提供的数值是否为奇数。','a':'检查所提供的数值是否为奇数。','m':[1,1],'p':[{'name':'值','detail':'要验证其是否为奇数的数值。\n\n如果值为奇数或指向包含奇数的单元格，ISODD将返回TRUE，否则返回FALSE。','example':'4','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'LCM','t':0,'d':'返回一个或多个整数的最小公倍数。','a':'返回一个或多个整数的最小公倍数。','m':[1,255],'p':[{'name':'值1','detail':'要在求最小公倍数数的计算中检查其因数的第一项数值或范围。','example':'A2:A5','require':'m','repeat':'n','type':'rangeall'},{'name':'值2','detail':'[可选] - 在求最小公倍数时要考虑其因数的其他数值或范围。','example':'3','require':'o','repeat':'y','type':'rangeall'}]},{'n':'LN','t':0,'d':'返回数值以 e（欧拉数）为底的对数。','a':'返回数值以 e（欧拉数）为底的对数。','m':[1,1],'p':[{'name':'值','detail':'要以 e 为底数计算其对数的值。\n\n值必须为正数。','example':'100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'LOG','t':0,'d':'根据指定底数返回数字的对数。','a':'根据指定底数返回数字的对数。','m':[1,2],'p':[{'name':'值','detail':'想要计算其对数的正实数。','example':'128','require':'m','repeat':'n','type':'rangenumber'},{'name':'底数','detail':'[可选] - 对数的底数。','example':'2','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'LOG10','t':0,'d':'返回数值以10为底的对数。','a':'返回数值以10为底的对数。','m':[1,1],'p':[{'name':'值','detail':'要计算其以10为底的对数的数值。\n\n值必须为正值。','example':'100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'MOD','t':0,'d':'返回两数相除的余数, 结果的符号与除数相同。','a':'返回两数相除的余数。','m':[2,2],'p':[{'name':'被除数','detail':'要将其相除以得到余数的数值。','example':'10','require':'m','repeat':'n','type':'rangenumber'},{'name':'除数','detail':'用于除其他数的数值。','example':'4','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'MROUND','t':0,'d':'将数值取整为另一整数最接近的整数倍。','a':'将数值取整为另一整数最接近的整数倍。','m':[2,2],'p':[{'name':'值','detail':'要取整为另一整数最接近的整数倍的数值。','example':'21','require':'m','repeat':'n','type':'rangenumber'},{'name':'因数','detail':'值将取此因数的整数倍。','example':'14','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ODD','t':0,'d':'将数值向上取整为最接近的奇整数。','a':'将数值向上取整为最接近的奇整数。','m':[1,1],'p':[{'name':'值','detail':'要向上取整的数值，取整值为大于此值的最接近的奇数。\n\n如果值为负数，则将其取整为绝对值大于该值的相邻负奇数。','example':'2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SUMSQ','t':0,'d':'返回一组数值和/或单元格的平方总和。','a':'返回一组数值和/或单元格的平方总和。','m':[1,255],'p':[{'name':'值1','detail':'要将其平方相加的第一个数值或范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangeall'},{'name':'值2, ...','detail':'[可选] - 要将其平方与值1的平方相加的其他数值或范围。','example':'2','require':'o','repeat':'y','type':'rangeall'}]},{'n':'COMBIN','t':0,'d':'给定集合中的对象总数和要选择的对象数量，返回共有多少种不同选择方式。','a':'给定集合中的对象总数和要选择的对象数量','m':[2,2],'p':[{'name':'n','detail':'要从中进行选择的对象集合的大小。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'k','detail':'要选择的对象数量。','example':'2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SUM','t':0,'d':'返回一组数值和/或单元格的总和。','a':'返回一组数值和/或单元格的总和。','m':[1,255],'p':[{'name':'值1','detail':'要相加的第一个数值或范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangeall'},{'name':'值2','detail':'[可选] - 要相加的其他数值或范围。','example':'2','require':'o','repeat':'y','type':'rangeall'}]},{'n':'SUBTOTAL','t':0,'d':'使用指定的汇总函数，返回一系列纵向单元格的分类汇总。','a':'使用指定的汇总函数','m':[2,256],'p':[{'name':'函数代码','detail':'用于计算分类汇总的函数。\n\n1代表AVERAGE\n\n2代表COUNT\n\n3代表COUNTA\n\n4代表MAX\n\n5代表MIN\n\n6代表PRODUCT\n\n7代表STDEV\n\n8代表STDEVP\n\n9代表SUM\n\n10代表VAR\n\n11代表VARP\n\n通过在这些2位代码前附加10（对于1位代码）或1（对于2位代码），可以将隐藏值忽略。例如，102代表忽略隐藏单元格的COUNT，而110则代表忽略隐藏值的VAR。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'范围1','detail':'要计算分类汇总的第一个范围。','example':'A2:A5','require':'m','repeat':'n','type':'range'},{'name':'范围2','detail':'[可选] - 要计算分类汇总的其他范围。','example':'B2:B8','require':'o','repeat':'y','type':'range'}]},{'n':'ASIN','t':0,'d':'返回数值的反正弦值，以弧度表示。','a':'返回数值的反正弦值','m':[1,1],'p':[{'name':'值','detail':'要计算其反正弦值的数值。必须介于-1和1之间，包括两端值。','example':'0','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'COUNTIF','t':1,'d':'返回范围内满足某个条件的单元格的数量。','a':'返回范围内满足某个条件的单元格的数量。','m':[2,2],'p':[{'name':'范围','detail':'要根据条件进行检测的范围。','example':'A1:A10','require':'m','repeat':'n','type':'range'},{'name':'条件','detail':'要应用于范围的模式或测试条件。\n\n如果范围包含的是要检测的文本，则条件必须为字符串。条件可以包含通配符，包括用于匹配单个字符的?或用于匹配零个或连续多个字符的*。要匹配问号星号本身，请在该字符前面加上波浪号(~)前缀（即~?和~*）。字符串条件必须用引号括起来。函数会检查范围中的每个单元格与条件是否相等或匹配（如果使用了通配符）。\n\n如果范围包含的是要检测的数字，则条件可以是字符串也可以是数字。如果给定的条件是一个数字，则检查范围中的每个单元格是否等于条件。另外，条件也可能是包含数字的字符串（也将对其进行相等检测），或者带有以下前缀的数字：=、>、>=、<或<=，这些条件将分别用于检查范围中的单元格是否等于、大于、大于等于、小于、小于等于条件值。','example':'">20"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'RADIANS','t':0,'d':'将以度表示的角度值转换为弧度。','a':'将以度表示的角度值转换为弧度。','m':[1,1],'p':[{'name':'角度','detail':'要从度转换为弧度的角度。','example':'180','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'RAND','t':0,'d':'返回一个介于0和1之间（包括0但不包括1）的随机数。','a':'返回一个介于0和1之间（包括0但不包括1）的随机数。','m':[0,0],'p':[]},{'n':'COUNTUNIQUE','t':0,'d':'计算一列指定值和范围中不重复数值的个数。','a':'计算一列指定值和范围中不重复数值的个数。','m':[1,255],'p':[{'name':'值1','detail':'要检查其是否唯一的第一个值或范围。','example':'A1:C100','require':'m','repeat':'n','type':'rangeall'},{'name':'值2','detail':'[可选] - 要检查是否唯一的其他值或范围。','example':'1','require':'o','repeat':'n','type':'rangeall'}]},{'n':'DEGREES','t':0,'d':'将以弧度表示的角度值转换为度。','a':'将以弧度表示的角度值转换为度。','m':[1,1],'p':[{'name':'角度','detail':'要从弧度转换为度的角度。','example':'PI()','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ERFC','t':9,'d':'返回数值的互补高斯误差函数。','a':'返回数值的互补高斯误差函数。','m':[1,1],'p':[{'name':'z','detail':'要为其计算互补高斯误差函数的数值。','example':'2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'EVEN','t':0,'d':'将数值向上取整为最接近的偶整数。','a':'将数值向上取整为最接近的偶整数。','m':[1,1],'p':[{'name':'值','detail':'要向上取整的数值，取整值为大于此值的最接近的偶数。\n\n如果值为负数，则将其取整为绝对值大于该值的相邻负偶数。','example':'3','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'EXP','t':0,'d':'返回欧拉数 e (~2.718) 的指定次幂。','a':'返回欧拉数 e (~2.718) 的指定次幂。','m':[1,1],'p':[{'name':'指数','detail':'指定e的自乘幂次值。','example':'2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'FACT','t':0,'d':'返回数值的阶乘。','a':'返回数值的阶乘。','m':[1,1],'p':[{'name':'值','detail':'要计算并返回其阶乘的数字或对数字（所在单元格）的引用。','example':'3','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'FACTDOUBLE','t':0,'d':'返回数值的“双阶乘”。','a':'返回数值的“双阶乘”。','m':[1,1],'p':[{'name':'值','detail':'要计算并返回其双阶乘的数字或对数字（所在单元格）的引用。','example':'6','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'PI','t':0,'d':'返回带有14位小数的 PI 值。','a':'返回带有14位小数的 PI 值。','m':[0,0],'p':[]},{'n':'FLOOR','t':0,'d':'将数值向下取整为指定因数的最接近的整数倍。','a':'将数值向下取整为指定因数的最接近的整数倍。','m':[2,2],'p':[{'name':'值','detail':'要向下舍入为因数的最接近整数倍的数值。','example':'23.25','require':'m','repeat':'n','type':'rangenumber'},{'name':'因数','detail':'要将值舍入到此数的整数倍。\n\n因数不得为0。','example':'0.1','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'GCD','t':0,'d':'返回一个或多个整数的最大公约数。','a':'返回一个或多个整数的最大公约数。','m':[1,255],'p':[{'name':'值1','detail':'要在查找最大公约数的计算中检查其因数的第一项数值或范围。','example':'A2:A5','require':'m','repeat':'n','type':'rangeall'},{'name':'值2','detail':'[可选] - 在求最大公约数时要考虑其因数的其他数值或范围。','example':'96','require':'o','repeat':'y','type':'rangeall'}]},{'n':'RANDBETWEEN','t':0,'d':'返回介于两个整数之间（包括这两个整数）的随机数。','a':'返回介于两个整数之间（包括这两个整数）的随机数。','m':[2,2],'p':[{'name':'下界','detail':'随机值范围的下界。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'上界','detail':'随机值范围的上界。','example':'10','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ROUND','t':0,'d':'将数字四舍五入到指定的位数。','a':'将数字四舍五入到指定的位数。','m':[2,2],'p':[{'name':'值','detail':'要四舍五入的数字。','example':'99.44','require':'m','repeat':'n','type':'rangenumber'},{'name':'位数','detail':'要进行四舍五入运算的位数。\n\n位数可以取负值，在这种情况下会将值的小数点左侧部分舍入到指定的位数。','example':'1','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ROUNDDOWN','t':0,'d':'朝着零的方向将数字进行向下舍入。','a':'朝着零的方向将数字进行向下舍入。','m':[2,2],'p':[{'name':'值','detail':'需要向下舍入的任意实数。','example':'99.44','require':'m','repeat':'n','type':'rangenumber'},{'name':'位数','detail':'要通过舍入达到的小数位数。\n\n位数可以取负值，在这种情况下会将值的小数点左侧部分舍入到指定的位数。','example':'1','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ROUNDUP','t':0,'d':'朝着远离 0（零）的方向将数字进行向上舍入。','a':'朝着远离 0（零）的方向将数字进行向上舍入。','m':[2,2],'p':[{'name':'值','detail':'要将其舍入为位数位数字的值，始终向上舍入。','example':'99.44','require':'m','repeat':'n','type':'rangenumber'},{'name':'位数','detail':'要通过舍入达到的小数位数。\n\n位数可以取负值，在这种情况下会将值的小数点左侧部分舍入到指定的位数。','example':'1','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SERIESSUM','t':0,'d':'给定参数 x、n、m 和 a，返回幂级数的和 a1xn + a2x(n+m) + ... + aix(n+(i-1)m)，其中 i 为范围 a 中的项数。','a':'给定参数 x、n、m 和 a','m':[4,4],'p':[{'name':'x','detail':'幂级数的输入值。随相应的近似类型而变，有可能为角度、指数或其他一些值。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'n','detail':'在幂级数中x的初始自乘幂次。','example':'0','require':'m','repeat':'n','type':'rangenumber'},{'name':'m','detail':'x的幂次中的附加增量。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'a','detail':'包含幂级数系数的数组或范围。','example':'{FACT(0)','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SIGN','t':0,'d':'给定输入数值，如果为负返回-1；如果为正返回1；如果为零则返回0。','a':'给定输入数值','m':[1,1],'p':[{'name':'值','detail':'要返回其符号的数值。','example':'-42','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SIN','t':0,'d':'给定角度（以弧度表示），返回其正弦值。','a':'给定角度（以弧度表示）','m':[1,1],'p':[{'name':'角度','detail':'要返回其正弦值的角度，以弧度表示。','example':'PI()','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SINH','t':0,'d':'返回给定实数的双曲正弦值。','a':'返回给定实数的双曲正弦值。','m':[1,1],'p':[{'name':'值','detail':'要计算其双曲正弦值的实数值。','example':'A2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SQRT','t':0,'d':'返回一个正数的正平方根。','a':'返回一个正数的正平方根。','m':[1,1],'p':[{'name':'值','detail':'要计算其正平方根的数值。\n\n值必须为正数；如果为负，SQRT 将返回 #NUM! 错误。','example':'9','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SQRTPI','t':0,'d':'返回 PI 与给定正数乘积的正平方根。','a':'返回 PI 与给定正数乘积的正平方根。','m':[1,1],'p':[{'name':'值','detail':'要将其与 PI 相乘并返回该乘积的平方根的数值\n\n值必须为正数；如果为负数，SQRTPI 将返回 #NUM! 错误。','example':'9','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'GAMMALN','t':1,'d':'返回指定伽玛函数的以 e（欧拉数）为底的对数。','a':'返回指定伽玛函数的以 e（欧拉数）为底的对数。','m':[1,1],'p':[{'name':'值','detail':'伽玛函数的输入值。返回的将是伽玛 (值) 的自然对数。\n\n值必须为正数。','example':'4','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'COS','t':0,'d':'返回给定角度的余弦值（角度以弧度表示）。','a':'返回给定角度的余弦值（角度以弧度表示）。','m':[1,1],'p':[{'name':'角度','detail':'要取其余弦值的角度，以弧度表示。','example':'PI()','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'TRUNC','t':0,'d':'截除指定有效位之外的部分，取数据的指定有效位。','a':'截除指定有效位之外的部分','m':[1,2],'p':[{'name':'值','detail':'要截取的数据。','example':'3.141592654','require':'m','repeat':'n','type':'rangenumber'},{'name':'位数','detail':'[可选 - 默认值为0] - 小数点右侧要保留的有效位数。\n\n如果位数大于值中的有效位数，则将“值”原样返回。\n\n位数可以取负值，在这种情况下会将小数点左侧指定位数的值更改为零。小数点右侧的所有位数都会被舍弃。如果值的所有位都被更改为零，则TRUNC会返回0。','example':'2','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'QUOTIENT','t':0,'d':'返回以一个数除以另一个数所得的结果，不包含余数。','a':'返回以一个数除以另一个数所得的结果','m':[2,2],'p':[{'name':'被除数','detail':'要被除的数值。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'除数','detail':'用于除其他数的数值。\n\n除数不得为0。','example':'2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'POWER','t':0,'d':'返回数值的指定次幂。','a':'返回数值的指定次幂。','m':[2,2],'p':[{'name':'底数','detail':'要计算其指数次幂的数值。\n\n如果底数为负，则指数必须为整数。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'指数','detail':'指定底数的自乘幂次值。','example':'0.5','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SUMIFS','t':0,'d':'根据多项条件返回范围之和。','a':'根据多项条件返回范围之和。','m':[3,257],'p':[{'name':'求和范围','detail':'要对其求和的范围。','example':'A1:A10','require':'m','repeat':'n','type':'range'},{'name':'条件范围1','detail':'要在哪个范围内检查条件1。','example':' B1:B10','require':'m','repeat':'n','type':'range'},{'name':'条件1','detail':'要应用于条件范围1的模式或测试条件。','example':' ">20"','require':'m','repeat':'n','type':'rangeall'},{'name':'条件范围2, 条件2...','detail':'[ 可选 ] - 要检查的其他范围和条件。','example':' C1:C10','require':'o','repeat':'y','type':'rangeall'}]},{'n':'COUNTIFS','t':1,'d':'根据多项条件返回范围中的单元格数量。','a':'根据多项条件返回范围中的单元格数量。','m':[2,256],'p':[{'name':'条件范围1','detail':'要在哪个范围内检查条件1。','example':'A1:A10','require':'m','repeat':'n','type':'range'},{'name':'条件1','detail':'要应用于条件范围1的模式或测试条件。','example':' ">20"','require':'m','repeat':'n','type':'rangeall'},{'name':'条件范围2, 条件2...','detail':'[ 可选 ] - 要检查的其他范围和条件，可重复。','example':' B1:B10','require':'o','repeat':'y','type':'rangeall'}]},{'n':'PRODUCT','t':0,'d':'返回将一组数相乘所得的结果。','a':'返回将一组数相乘所得的结果。','m':[1,255],'p':[{'name':'乘数1','detail':'用于计算乘积的第一个数值或范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'乘数2 ... 乘数30','detail':'[可选] - 要相乘的其他数值。','example':'2','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'HARMEAN','t':1,'d':'计算数据集的调和平均值。','a':'计算数据集的调和平均值。','m':[1,255],'p':[{'name':'值1','detail':'样本中的第一项值或范围。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2, ...','detail':'[可选] - 数据集中包含的其他数值或范围。','example':'2','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'HYPGEOMDIST','t':1,'d':'返回超几何分布。 如果已知样本量、总体成功次数和总体大小，则 HYPGEOM.DIST 返回样本取得已知成功次数的概率。','a':'返回超几何分布。','m':[5,5],'p':[{'name':'Sample_s','detail':'样本中成功的次数。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'Number_sample','detail':'样本量。','example':'12','require':'m','repeat':'n','type':'rangenumber'},{'name':'Population_s','detail':'总体中成功的次数。','example':'20','require':'m','repeat':'n','type':'rangenumber'},{'name':'Number_pop','detail':'总体大小。','example':'40','require':'m','repeat':'n','type':'rangenumber'},{'name':'cumulative','detail':'决定函数形式的逻辑值。\n\n如果 cumulative 为 TRUE()，则 HYPGEOM.DIST 返回累积分布函数；\n\n如果为 FALSE()，则返回概率密度函数。','example':'TRUE()','require':'m','repeat':'n','type':'rangeall'}]},{'n':'INTERCEPT','t':1,'d':'计算数据集的线性回归方程直线与 Y 轴的相交点 (x=0) 的 y 值。','a':'计算数据集的线性回归方程直线与 Y 轴的相交点 (x=0) 的 y 值。','m':[2,2],'p':[{'name':'数据_y','detail':'代表因变量数据数组或矩阵的范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'数据_x','detail':'代表自变量数据数组或矩阵的范围。','example':'B2:B100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'KURT','t':1,'d':'计算数据集的峭度，该指标指示数据集（分布）的形态，尤其是该形态的陡峭程度。','a':'计算数据集的峭度','m':[1,255],'p':[{'name':'值1','detail':'数据集中的第一个值或范围。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2, ...','detail':'[可选] - 数据集中包含的其他值或范围。','example':'2','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'LARGE','t':1,'d':'返回数据集中第 n 个最大元素，n 由用户指定。','a':'返回数据集中第 n 个最大元素','m':[2,2],'p':[{'name':'数据','detail':'包含相关数据集的数组或范围。','example':'A2:B100','require':'m','repeat':'n','type':'rangenumber'},{'name':'n','detail':'要返回的元素的排行位置（从大到小顺序）。\n\n例如，将n设为4将使LARGE返回数据中排名第4的最大元素。','example':'4','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'STDEVA','t':1,'d':'基于样本计算标准偏差，将文本取值为0。','a':'基于样本计算标准偏差','m':[1,255],'p':[{'name':'值1','detail':'样本中的第一项值或范围。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2,…','detail':'[可选] - 样本中包含的其他值或范围。','example':'2','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'STDEVP','t':1,'d':'基于样本总体计算标准偏差。','a':'基于样本总体计算标准偏差。','m':[1,255],'p':[{'name':'值1','detail':'数据集中的第一个值或范围。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2, ...','detail':'[可选] - 数据集中包含的其他值或范围。','example':'2','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'GEOMEAN','t':1,'d':'计算数据集的几何平均值。','a':'计算数据集的几何平均值。','m':[1,255],'p':[{'name':'值1','detail':'样本中的第一项值或范围。','example':'1','require':'m','repeat':'n','type':'rangeall'},{'name':'值2, ...','detail':'[可选] - 数据集中包含的其他数值或范围。','example':'2','require':'o','repeat':'y','type':'rangeall'}]},{'n':'RANK_EQ','t':1,'d':'返回指定值在数据集中的排名。如果相同的值在数据集中存在多项，则返回其中的最高排名。','a':'返回指定值在数据集中的排名。如果相同的值在数据集中存在多项，则返回其中的最高排名。','m':[2,3],'p':[{'name':'number','detail':'要确定其排名的值。','example':'A10','require':'m','repeat':'n','type':'rangenumber'},{'name':'ref','detail':'包含相关数据集的数组或范围。','example':'A1:A100','require':'m','repeat':'n','type':'range'},{'name':'order','detail':'[可选 - 默认为按降序 (FALSE()) ] - 要按升序还是按降序考虑“data”中的值。','example':'TRUE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'RANK_AVG','t':1,'d':'返回指定值在数据集中的排名。如果相同的值在数据集中存在多项，则返回这些项排名的平均值。','a':'返回指定值在数据集中的排名。如果相同的值在数据集中存在多项，则返回这些项排名的平均值。','m':[2,3],'p':[{'name':'number','detail':'要确定其排名的值。','example':'A10','require':'m','repeat':'n','type':'rangenumber'},{'name':'ref','detail':'包含相关数据集的数组或范围。','example':'A1:A100','require':'m','repeat':'n','type':'range'},{'name':'order','detail':'[可选 - 默认为按降序 (FALSE()) ] - 要按升序还是按降序考虑“data”中的值。','example':'TRUE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'PERCENTRANK_EXC','t':1,'d':'以百分数形式返回指定值在给定数据集中的百分比排名（介于0和1之间，不包括两端值）。','a':'以百分数形式返回指定值在给定数据集中的百分比排名（介于0和1之间，不包括两端值）。','m':[2,3],'p':[{'name':'data','detail':'包含相关数据集的数组或范围。','example':'A1:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'x','detail':'要确定其百分比排位的值。','example':'A2','require':'m','repeat':'n','type':'rangenumber'},{'name':'significance','detail':'[可选 - 默认值为 3] - 要在计算中使用的有效位数。','example':'4','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'PERCENTRANK_INC','t':1,'d':'以百分比形式返回指定值在给定数据集中的百分比排名（介于0和1之间，包括两端值）。','a':'以百分比形式返回指定值在给定数据集中的百分比排名（介于0和1之间，包括两端值）。','m':[2,3],'p':[{'name':'data','detail':'包含相关数据集的数组或范围。','example':'A1:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'x','detail':'要确定其百分比排位的值。','example':' A2','require':'m','repeat':'n','type':'rangenumber'},{'name':'significance','detail':'[可选 - 默认值为 3] - 要在计算中使用的有效位数。','example':'4','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'FORECAST','t':1,'d':'基于数据集的线性回归，计算指定 x 的预期 y 值。','a':'基于数据集的线性回归','m':[3,3],'p':[{'name':'x','detail':'x轴上用于预测的值。','example':'A1','require':'m','repeat':'n','type':'rangenumber'},{'name':'数据_y','detail':'代表因变量数据数组或矩阵的范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'数据_x','detail':'代表自变量数据数组或矩阵的范围。','example':'B2:B100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'FISHERINV','t':1,'d':'返回指定数值的 Fisher 逆变换。','a':'返回指定数值的 Fisher 逆变换。','m':[1,1],'p':[{'name':'y','detail':'要计算其Fisher逆变换的数值。','example':'0.962','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'FISHER','t':1,'d':'返回指定数值的 Fisher 变换。','a':'返回指定数值的 Fisher 变换。','m':[1,1],'p':[{'name':'x','detail':'要计算其Fisher变换的数值。','example':'0.962','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'MODE_SNGL','t':1,'d':'返回数据集中出现次数最多的值。','a':'返回数据集中出现次数最多的值。','m':[1,255],'p':[{'name':'值1','detail':'计算模式时要检查的第一个值或范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2, ...','detail':'[可选] - 在计算模式时要考虑的其他数值或范围。','example':'B2:B100','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'WEIBULL_DIST','t':1,'d':'给定形状和尺度，返回韦伯分布函数（或韦伯累积分布函数）的值。','a':'给定形状和尺度','m':[4,4],'p':[{'name':'x','detail':'WEIBULL 分布函数的输入值。','example':'2.4','require':'m','repeat':'n','type':'rangenumber'},{'name':'alpha','detail':'Weibull 分布函数的形状参数。\n\nalpha 值必须大于 0。','example':'2','require':'m','repeat':'n','type':'rangenumber'},{'name':'beta','detail':'Weibull 分布函数的尺度参数。\n\nbeta 值必须大于 0。','example':'3','require':'m','repeat':'n','type':'rangenumber'},{'name':'cumulative','detail':'TRUE() 表示使用累积分布函数，FALSE() 则表示使用概率密度函数。','example':'TRUE()','require':'m','repeat':'n','type':'rangeall'}]},{'n':'COUNT','t':1,'d':'返回数据集中数值的个数。','a':'返回数据集中数值的个数。','m':[1,255],'p':[{'name':'值1','detail':'计数时要检查的第一个值或范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangeall'},{'name':'值2, ...','detail':'[可选] - 在计数时要检查的其他值或范围。','example':'B2:B100','require':'o','repeat':'y','type':'rangeall'}]},{'n':'COUNTA','t':1,'d':'返回数据集中值的数量。','a':'返回数据集中值的数量。','m':[1,255],'p':[{'name':'值1','detail':'计数时要检查的第一个值或范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangeall'},{'name':'值2, ...','detail':'[可选] - 在计数时要检查的其他值或范围。','example':'B2:B100','require':'o','repeat':'y','type':'rangeall'}]},{'n':'AVEDEV','t':1,'d':'计算数据与数据集均值之间的偏差大小的平均值。','a':'计算数据与数据集均值之间的偏差大小的平均值。','m':[1,255],'p':[{'name':'值1','detail':'样本中的第一项值或范围。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2, ...','detail':'[可选] - 样本中包含的其他值或范围。','example':'2','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'AVERAGE','t':1,'d':'返回数据集的算术平均值，对文本忽略不计。','a':'返回数据集的算术平均值','m':[1,255],'p':[{'name':'值1','detail':'计算平均值时用到的第一个数值或范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangeall'},{'name':'值2, ...','detail':'[可选] - 在计算平均值时要考虑的其他数值或范围。','example':'B2:B100','require':'o','repeat':'y','type':'rangeall'}]},{'n':'AVERAGEA','t':1,'d':'返回数据集的算术平均值。','a':'返回数据集的算术平均值。','m':[1,255],'p':[{'name':'值1','detail':'计算平均值时用到的第一个数值或范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangeall'},{'name':'值2, ...','detail':'[可选] - 在计算平均值时要考虑的其他数值或范围。','example':'B2:B100','require':'o','repeat':'y','type':'rangeall'}]},{'n':'BINOM_DIST','t':1,'d':'返回一元二项式分布的概率。','a':'返回一元二项式分布的概率。','m':[4,4],'p':[{'name':'number_s','detail':'试验的成功次数。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'trials','detail':'独立检验的次数。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'probability_s','detail':'任一给定检验的成功概率。','example':'0.005','require':'m','repeat':'n','type':'rangenumber'},{'name':'cumulative','detail':'是否使用二项式累积分布。','example':'FALSE()','require':'m','repeat':'n','type':'rangeall'}]},{'n':'BINOM_INV','t':1,'d':'计算累积二项式分布大于或等于指定条件的最小值。','a':'计算累积二项式分布大于或等于指定条件的最小值。','m':[3,3],'p':[{'name':'trials','detail':'贝努利试验次数。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'probability_s','detail':'任一次给定检验的成功概率。','example':'0.005','require':'m','repeat':'n','type':'rangenumber'},{'name':'alpha','detail':'期望的临界概率。','example':'0.8','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'CONFIDENCE_NORM','t':1,'d':'计算正态分布的置信区间的一半宽度。','a':'计算正态分布的置信区间的一半宽度。','m':[3,3],'p':[{'name':'alpha','detail':'用来计算置信水平的显著性水平。\n\n置信水平等于 100*(1 - alpha)%，亦即，如果 alpha 为 0.05，则置信水平为 95%。','example':'0.05','require':'m','repeat':'n','type':'rangenumber'},{'name':'standard_dev','detail':'数据区域的总体标准偏差。','example':'1.6','require':'m','repeat':'n','type':'rangenumber'},{'name':'size','detail':'样本总量的大小。','example':'250','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'CORREL','t':1,'d':'计算给定数据集的皮尔逊积矩相关系数 r。','a':'计算给定数据集的皮尔逊积矩相关系数 r。','m':[2,2],'p':[{'name':'数据_y','detail':'代表因变量数据数组或矩阵的范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'数据_x','detail':'代表自变量数据数组或矩阵的范围。','example':'B2:B100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'COVARIANCE_P','t':1,'d':'计算数据集的总体协方差。','a':'计算数据集的总体协方差。','m':[2,2],'p':[{'name':'数据_x','detail':'代表自变量数据数组或矩阵的范围。','example':'B2:B100','require':'m','repeat':'n','type':'rangenumber'},{'name':'数据_y','detail':'代表因变量数据数组或矩阵的范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'COVARIANCE_S','t':1,'d':'计算数据集的样本协方差。','a':'计算数据集的样本协方差。','m':[2,2],'p':[{'name':'数据_x','detail':'代表自变量数据数组或矩阵的范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'数据_y','detail':'代表因变量数据数组或矩阵的范围。','example':'B2:B100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'DEVSQ','t':1,'d':'基于样本计算其偏差的平方和。','a':'基于样本计算其偏差的平方和。','m':[1,255],'p':[{'name':'值1','detail':'样本中的第一项值或范围。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2, ...','detail':'[可选] - 样本中包含的其他值或范围。','example':'2','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'EXPON_DIST','t':1,'d':'返回带有指定 Lambda 和指定值的指数分布函数的值。','a':'返回带有指定 Lambda 和指定值的指数分布函数的值。','m':[3,3],'p':[{'name':'x','detail':'指数分布函数的输入值。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'lambda','detail':'用于指定指数分布函数的 lambda 值。','example':'0.5','require':'m','repeat':'n','type':'rangenumber'},{'name':'cumulative','detail':'是否使用指数累积分布。','example':'FALSE()','require':'m','repeat':'n','type':'rangeall'}]},{'n':'AVERAGEIF','t':1,'d':'根据条件返回范围的平均值。','a':'根据条件返回范围的平均值。','m':[2,3],'p':[{'name':'criteria_range','detail':'要对其检查 criterion 的范围。','example':'A1:A10','require':'m','repeat':'n','type':'rangeall'},{'name':'criterion','detail':'要应用于 criteria_range 的模式或测试条件。\n\n等于："文本" 或 1 或 "=文本" 或 "=1"\n\n大于：">1"\n\n大于等于：">=1"\n\n小于："<1"\n\n小于等于："<=1"\n\n不等于："<>1"或"<>文本"','example':'">20"','require':'m','repeat':'n','type':'rangeall'},{'name':'average_range','detail':'[可选] - 要计算平均值的范围。如果未提供此参数，则改用 criteria_range 来计算平均值。','example':'B1:B10','require':'o','repeat':'n','type':'rangeall'}]},{'n':'AVERAGEIFS','t':1,'d':'根据多项条件返回范围的平均值。','a':'根据多项条件返回范围的平均值。','m':[2,255],'p':[{'name':'average_range','detail':'要计算平均值的范围。','example':'A1:A10','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria_range1','detail':'要对其检查 criterion1 的范围。','example':' B1:B10','require':'m','repeat':'n','type':'rangeall'},{'name':'criterion1','detail':'要应用于 criteria_range1 的模式或测试条件。','example':' ">20"','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria_range2, criterion2, ...','detail':'[可选] - 要检查的其他范围和条件。','example':' C1:C10','require':'m','repeat':'n','type':'rangeall'}]},{'n':'PERMUT','t':1,'d':'返回可从数字对象中选择的给定数目对象的排列数。','a':'返回可从数字对象中选择的给定数目对象的排列数。','m':[2,2],'p':[{'name':'number','detail':'表示对象个数的整数。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'number_chosen','detail':'表示每个排列中对象个数的整数。','example':'2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'TRIMMEAN','t':1,'d':'在排除数据集高低两端的部分数据之后计算所得的均值。','a':'在排除数据集高低两端的部分数据之后计算所得的均值。','m':[2,2],'p':[{'name':'数据','detail':'包含相关数据集的数组或范围。','example':'A2:A100','require':'m','repeat':'n','type':'range'},{'name':'排除比例','detail':'要从数据集的极值部分排除的数据占数据集的比例。\n\n排除比例必须大于等于0且小于1。','example':'0.1','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'PERCENTILE_EXC','t':1,'d':'返回数组的 K 百分点值，K 介于 0 到 1 之间，不含 0 与 1。','a':'返回数组的 K 百分点值，K 介于 0 到 1 之间，不含 0 与 1。','m':[2,2],'p':[{'name':'array','detail':'定义相对位置的数组或数据区域。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'k','detail':'0 到 1 之间的百分点值，不包含 0 和 1。','example':'0.25','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'PERCENTILE_INC','t':1,'d':'返回数组的 K 百分点值，K 介于 0 到 1 之间，包含 0 与 1。','a':'返回数组的 K 百分点值，K 介于 0 到 1 之间，包含 0 与 1。','m':[2,2],'p':[{'name':'array','detail':'定义相对位置的数组或数据区域。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'k','detail':'0 到 1 之间的百分点值，包含 0 和 1。','example':'0.25','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'PEARSON','t':1,'d':'返回皮尔生(Pearson)乘积矩相关系数 r。','a':'返回皮尔生(Pearson)乘积矩相关系数 r。','m':[2,2],'p':[{'name':'数据_x','detail':'代表自变量数据数组或矩阵的范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'数据_y','detail':'代表因变量数据数组或矩阵的范围。','example':'B2:B100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'NORM_S_INV','t':1,'d':'返回标准正态累积分布函数的反函数值。 该分布的平均值为 0，标准偏差为 1。','a':'返回标准正态累积分布函数的反函数值。 该分布的平均值为 0，标准偏差为 1。','m':[1,1],'p':[{'name':'probability','detail':'对应于正态分布的概率。','example':'0.75','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'NORM_S_DIST','t':1,'d':'返回标准正态分布函数（该分布的平均值为 0，标准偏差为 1）。','a':'返回标准正态分布函数（该分布的平均值为 0，标准偏差为 1）。','m':[2,2],'p':[{'name':'z','detail':'需要计算其分布的数值。','example':'2.4','require':'m','repeat':'n','type':'rangenumber'},{'name':'cumulative','detail':'决定函数形式的逻辑值。\n\n如果为 TRUE()，则返回累积分布函数；\n\n如果为 FALSE()，则返回概率密度函数。','example':'FALSE()','require':'m','repeat':'n','type':'rangeall'}]},{'n':'NORM_INV','t':1,'d':'返回指定平均值和标准偏差的正态累积分布函数的反函数值。','a':'返回指定平均值和标准偏差的正态累积分布函数的反函数值。','m':[3,3],'p':[{'name':'probability','detail':'对应于正态分布的概率。','example':'0.75','require':'m','repeat':'n','type':'rangenumber'},{'name':'mean','detail':'分布的算术平均值。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'standard_dev','detail':'分布的标准偏差。','example':'4','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'NORM_DIST','t':1,'d':'返回指定平均值和标准偏差的正态分布函数。','a':'返回指定平均值和标准偏差的正态分布函数。','m':[4,4],'p':[{'name':'x','detail':'需要计算其分布的数值。','example':'2.4','require':'m','repeat':'n','type':'rangenumber'},{'name':'mean','detail':'分布的算术平均值。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'standard_dev','detail':'分布的标准偏差。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'cumulative','detail':'决定函数形式的逻辑值。\n\n如果为 TRUE()，则返回累积分布函数；\n\n如果为 FALSE()，则返回概率密度函数。','example':'FALSE()','require':'m','repeat':'n','type':'rangeall'}]},{'n':'NEGBINOM_DIST','t':1,'d':'返回负二项式分布。','a':'返回负二项式分布。','m':[4,4],'p':[{'name':'number_f','detail':'要模拟的失败次数。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'number_s','detail':'要模拟的成功次数。','example':'2','require':'m','repeat':'n','type':'rangenumber'},{'name':'probability_s','detail':'任一次给定检验的成功概率。','example':'0.1','require':'m','repeat':'n','type':'rangenumber'},{'name':'cumulative','detail':'决定函数形式的逻辑值。\n\n如果为 TRUE()，则返回累积分布函数；\n\n如果为 FALSE()，则返回概率密度函数。','example':'FALSE()','require':'m','repeat':'n','type':'rangeall'}]},{'n':'MINA','t':1,'d':'返回数据集中的最小数值。','a':'返回数据集中的最小数值。','m':[1,255],'p':[{'name':'值1','detail':'计算最小值时所用的第一个值或范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2','detail':'[可选] - 在计算最小值时要考虑的其他数值或范围。','example':'B2:B100','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'MIN','t':1,'d':'返回数值数据集中的最小值。','a':'返回数值数据集中的最小值。','m':[1,255],'p':[{'name':'值1','detail':'计算最小值时所用的第一个值或范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2','detail':'[可选] - 在计算最小值时要考虑的其他数值或范围。','example':'B2:B100','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'MEDIAN','t':1,'d':'返回数值数据集中的中值。','a':'返回数值数据集中的中值。','m':[1,255],'p':[{'name':'值1','detail':'计算中值时所用的第一个数值或范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2','detail':'[可选] - 在计算中值时要考虑的其他数值或范围。','example':'B2:B100','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'MAXA','t':1,'d':'返回数据集中的最大数值。','a':'返回数据集中的最大数值。','m':[1,255],'p':[{'name':'值1','detail':'计算最大值时所用的第一个值或范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2, ...','detail':'[可选] - 在计算最大值时要考虑的其他数值或范围。','example':'B2:B100','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'MAX','t':1,'d':'返回数值数据集中的最大值。','a':'返回数值数据集中的最大值。','m':[1,255],'p':[{'name':'值1','detail':'计算最大值时所用的第一个值或范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2','detail':'[可选] - 在计算最大值时要考虑的其他数值或范围。','example':'B2:B100','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'LOGNORM_INV','t':1,'d':'返回 x 的对数累积分布函数的反函数值。','a':'返回 x 的对数累积分布函数的反函数值。','m':[3,3],'p':[{'name':'probability','detail':'与对数分布相关的概率，介于 0 与 1 之间（不含 0 与 1）。','example':'0.4','require':'m','repeat':'n','type':'rangenumber'},{'name':'mean','detail':'ln(x) 的平均值。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'standard_dev','detail':'ln(x) 的标准偏差，正数。','example':'6','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'LOGNORM_DIST','t':1,'d':'返回 x 的对数分布函数。','a':'返回 x 的对数分布函数。','m':[4,4],'p':[{'name':'x','detail':'用来计算函数的值。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'mean','detail':'ln(x) 的平均值。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'standard_dev','detail':'ln(x) 的标准偏差，正数。','example':'6','require':'m','repeat':'n','type':'rangenumber'},{'name':'cumulative','detail':'决定函数形式的逻辑值。\n\n如果为 TRUE()，则返回累积分布函数；\n\n如果为 FALSE()，则返回概率密度函数。','example':'FALSE()','require':'m','repeat':'n','type':'rangeall'}]},{'n':'Z_TEST','t':1,'d':'返回 z 检验的单尾 P 值。','a':'返回 z 检验的单尾 P 值。','m':[2,3],'p':[{'name':'array','detail':'用来检验 x 的数组或数据区域。','example':'A2:A100','require':'m','repeat':'n','type':'range'},{'name':'x','detail':'要测试的值。','example':'B2','require':'m','repeat':'n','type':'rangenumber'},{'name':'sigma','detail':'[可选] - 总体（已知）标准偏差。 如果省略，则使用样本标准偏差。','example':'3','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'PROB','t':1,'d':'返回区域中的数值落在指定区间内的概率。','a':'返回区域中的数值落在指定区间内的概率。','m':[3,4],'p':[{'name':'x_range','detail':'具有各自相应概率值的 x 数值区域。','example':'A3:A6','require':'m','repeat':'n','type':'range'},{'name':'prob_range','detail':'与 x_range 中的值相关联的一组概率值。','example':'2','require':'m','repeat':'n','type':'range'},{'name':'lower_limit','detail':'要计算其概率的数值下界。','example':'3','require':'m','repeat':'n','type':'rangenumber'},{'name':'upper_limit','detail':'[可选 - 默认值为下界] - 要计算其概率的可选数值上界。\n\n如果省略上界，PROB则计算随机选取相应值的次数恰好等于下界的概率。','example':'4','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'QUARTILE_EXC','t':1,'d':'基于 0 到 1 之间（不包括 0 和 1）的百分点值返回数据集的四分位数。','a':'基于 0 到 1 之间（不包括 0 和 1）的百分点值返回数据集的四分位数。','m':[2,2],'p':[{'name':'array','detail':'要求得四分位数值的数组或数字型单元格区域。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'quart','detail':'要返回第几个四分位值。\n\n1返回数据中最靠近第一个四分位值的值（25%标记）。\n\n2返回数据中最接近中值的值（50%标记）。\n\n3返回数据中最接近第三个四分位值的值（75%标记）。','example':'3','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'QUARTILE_INC','t':1,'d':'根据 0 到 1 之间的百分点值（包含 0 和 1）返回数据集的四分位数。','a':'根据 0 到 1 之间的百分点值（包含 0 和 1）返回数据集的四分位数。','m':[2,2],'p':[{'name':'array','detail':'要求得四分位数值的数组或数字型单元格区域。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'quart','detail':'要返回第几个四分位值。\n\n0返回数据中的最小值（0%标记）。\n\n1返回数据中最靠近第一个四分位值的值（25%标记）。\n\n2返回数据中最接近中值的值（50%标记）。\n\n3返回数据中最接近第三个四分位值的值（75%标记）。\n\n4返回数据中的最大值（100%标记）。','example':'3','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'POISSON_DIST','t':1,'d':'返回泊松分布。','a':'返回泊松分布。','m':[3,3],'p':[{'name':'x','detail':'事件数。','example':'2','require':'m','repeat':'n','type':'rangenumber'},{'name':'mean','detail':'期望值。非负数','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'cumulative','detail':'一逻辑值，确定所返回的概率分布的形式。\n\n如果为 TRUE()，则返回发生的随机事件数在零（含零）和 x（含 x）之间的累积泊松概率；\n\n如果为 FALSE()，则返回发生的事件数正好是 x 的泊松概率密度函数。','example':'FALSE()','require':'m','repeat':'n','type':'rangeall'}]},{'n':'RSQ','t':1,'d':'返回皮尔生(Pearson)乘积矩相关系数 r 的平方。','a':'返回皮尔生(Pearson)乘积矩相关系数 r 的平方。','m':[2,2],'p':[{'name':'数据_y','detail':'代表因变量数据数组或矩阵的范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'数据_x','detail':'代表自变量数据数组或矩阵的范围。','example':'B2:B100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'T_DIST','t':1,'d':'返回学生的左尾 t 分布。','a':'返回学生的左尾 t 分布。','m':[3,3],'p':[{'name':'x','detail':'T-分布函数的输入。','example':'A2','require':'m','repeat':'n','type':'rangenumber'},{'name':'degrees_freedom','detail':'自由度数值。','example':'30','require':'m','repeat':'n','type':'rangenumber'},{'name':'tails','detail':'决定函数形式的逻辑值。\n\n如果 cumulative 为 TRUE()，则 HYPGEOM.DIST 返回累积分布函数；\n\n如果为 FALSE()，则返回概率密度函数。','example':'TRUE()','require':'m','repeat':'n','type':'rangeall'}]},{'n':'T_DIST_2T','t':1,'d':'返回学生的双尾 t 分布。','a':'返回学生的双尾 t 分布。','m':[2,2],'p':[{'name':'x','detail':'T-分布函数的输入。','example':'A2','require':'m','repeat':'n','type':'rangenumber'},{'name':'degrees_freedom','detail':'自由度数值。','example':'30','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'T_DIST_RT','t':1,'d':'返回学生的右尾 t 分布。','a':'返回学生的右尾 t 分布。','m':[2,2],'p':[{'name':'x','detail':'T-分布函数的输入。','example':'A2','require':'m','repeat':'n','type':'rangenumber'},{'name':'degrees_freedom','detail':'自由度数值。','example':'30','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'T_INV','t':1,'d':'返回学生的 t 分布的左尾反函数。','a':'返回学生的 t 分布的左尾反函数。','m':[2,2],'p':[{'name':'probability','detail':'与学生的 t 分布相关的概率。\n\n必须大于 0 且小于 1。','example':'0.35','require':'m','repeat':'n','type':'rangenumber'},{'name':'deg_freedom','detail':'自由度数值。\n\n如果所提供的参数不是整数，将截取其整数部分。\n\n必须大于等于 1。','example':'1','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'T_INV_2T','t':1,'d':'返回学生 t 分布的双尾反函数。','a':'返回学生 t 分布的双尾反函数。','m':[2,2],'p':[{'name':'probability','detail':'与学生的 t 分布相关的概率。\n\n必须大于 0 且小于1。','example':'0.35','require':'m','repeat':'n','type':'rangenumber'},{'name':'deg_freedom','detail':'自由度数值。\n\n如果所提供的参数不是整数，将截取其整数部分。\n\n必须大于等于 1。','example':'1','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'T_TEST','t':1,'d':'返回与t-检验相关的概率。用于判断两个样本是否可能是出自平均值相同的两个样本总体。','a':'返回与t-检验相关的概率。用于判断两个样本是否可能是出自平均值相同的两个样本总体。','m':[4,4],'p':[{'name':'array1','detail':'将用于 t 检验的第一个数据样本或第一组单元格。','example':'A1:A4','require':'m','repeat':'n','type':'rangenumber'},{'name':'array2','detail':'将用于 t 检验的第二个数据样本或第二组单元格。','example':'B1:B4','require':'m','repeat':'n','type':'rangenumber'},{'name':'tails','detail':'指定分布的尾数。\n\n如果为 1：使用单尾分布。\n\n如果为 2：使用双尾分布。','example':'2','require':'m','repeat':'n','type':'rangenumber'},{'name':'type','detail':'指定 t 检验的类型。\n\n如果为 1：执行配对检验。\n\n如果为 2：执行双样本等方差（同方差）检验。\n\n如果为3：执行双样本不等方差（异方差）检验。','example':'1','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'F_DIST','t':1,'d':'给定输入值 x，计算两个数据集的左尾 F 概率分布（差异程度）。此分布也称为 Fisher-Snedecor 分布或 Snedecor F 分布。','a':'给定输入值 x','m':[4,4],'p':[{'name':'x','detail':'用来计算函数的值。','example':'15.35','require':'m','repeat':'n','type':'rangenumber'},{'name':'degrees_freedom1','detail':'分子自由度。','example':'7','require':'m','repeat':'n','type':'rangenumber'},{'name':'degrees_freedom2','detail':'分母自由度。','example':'6','require':'m','repeat':'n','type':'rangenumber'},{'name':'cumulative','detail':'用于确定函数形式的逻辑值。默认值为 FALSE。\n\n如果为 TRUE()：F.DIST 将返回累积分布函数值。\n\n如果为 FALSE()：F.DIST 将返回概率密度函数值。','example':'TRUE()','require':'m','repeat':'n','type':'rangeall'}]},{'n':'F_DIST_RT','t':1,'d':'给定输入x，计算两个数据集的右尾F概率分布（差异程度）。 此分布也称为Fisher-Snedecor分布或Snedecor F分布。','a':'给定输入x','m':[3,3],'p':[{'name':'x','detail':'用来计算函数的值。','example':'15.35','require':'m','repeat':'n','type':'rangenumber'},{'name':'degrees_freedom1','detail':'分子自由度。','example':'7','require':'m','repeat':'n','type':'rangenumber'},{'name':'degrees_freedom2','detail':'分母自由度。','example':'6','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'VAR_P','t':1,'d':'基于样本总体计算方差。','a':'基于样本总体计算方差。','m':[1,255],'p':[{'name':'值1','detail':'数据集中的第一个值或范围。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2, …','detail':'[可选] - 数据集中包含的其他值或范围。','example':'2','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'VAR_S','t':1,'d':'基于样本计算方差。','a':'基于样本计算方差。','m':[1,255],'p':[{'name':'值1','detail':'样本中的第一项值或范围。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2, …','detail':'[可选] - 样本中包含的其他值或范围。','example':'2','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'VARA','t':1,'d':'基于样本计算方差，将文本取值为0。','a':'基于样本计算方差','m':[1,255],'p':[{'name':'value1','detail':'样本中的第一项值或范围。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'value2, ...','detail':'[可选] - 样本中包含的其他值或范围。','example':'2','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'VARPA','t':1,'d':'基于样本总体计算方差，将文本取值为0。','a':'基于样本总体计算方差','m':[1,255],'p':[{'name':'值1','detail':'样本中的第一项值或范围。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'值2, ...','detail':'[可选] - 数据集中包含的其他数值或范围。','example':'2','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'STEYX','t':1,'d':'返回通过线性回归法预测每个 x 的 y 值时所产生的标准误差。','a':'返回通过线性回归法预测每个 x 的 y 值时所产生的标准误差。','m':[2,2],'p':[{'name':'数据_y','detail':'代表因变量数据数组或矩阵的范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'数据_x','detail':'代表自变量数据数组或矩阵的范围。','example':'B2:B100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'STANDARDIZE','t':1,'d':'给定分布的均值和标准偏差，计算一个随机变量正态化的相应值。','a':'给定分布的均值和标准偏差，计算一个随机变量正态化的相应值。','m':[3,3],'p':[{'name':'x','detail':'要正态化的随机变量值。','example':'96','require':'m','repeat':'n','type':'rangenumber'},{'name':'mean','detail':'分布的均值。','example':'80','require':'m','repeat':'n','type':'rangenumber'},{'name':'standard_dev','detail':'分布的标准偏差。','example':'6.7','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SMALL','t':1,'d':'返回数据集中的第 k 个最小值。','a':'返回数据集中的第 k 个最小值。','m':[2,2],'p':[{'name':'array','detail':'需要找到第 k 个最小值的数组或数值数据区域。','example':'A2:B100','require':'m','repeat':'n','type':'range'},{'name':'k','detail':'要返回的数据在数组或数据区域里的位置（从小到大）。','example':'4','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SLOPE','t':1,'d':'计算通过数据集的线性回归得到的直线的斜率。','a':'计算通过数据集的线性回归得到的直线的斜率。','m':[2,2],'p':[{'name':'数据_y','detail':'代表因变量数据数组或矩阵的范围。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'数据_x','detail':'代表自变量数据数组或矩阵的范围。','example':'B2:B100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SKEW','t':1,'d':'返回分布的偏斜度。 偏斜度表明分布相对于平均值的不对称程度。 正偏斜度表明分布的不对称尾部趋向于更多正值。 负偏斜度表明分布的不对称尾部趋向于更多负值。','a':'返回分布的偏斜度。','m':[1,255],'p':[{'name':'值1','detail':'数据集中的第一个值或范围。','example':'1','require':'m','repeat':'n','type':'rangeall'},{'name':'值2, ...','detail':'[可选] - 数据集中包含的其他值或范围。','example':'2','require':'o','repeat':'y','type':'rangeall'}]},{'n':'SKEW_P','t':1,'d':'返回基于样本总体的分布不对称度：表明分布相对于平均值的不对称程度。','a':'返回基于样本总体的分布不对称度：表明分布相对于平均值的不对称程度。','m':[1,255],'p':[{'name':'值1','detail':'数据集中的第一个值或范围。','example':'1','require':'m','repeat':'n','type':'rangeall'},{'name':'值2, ...','detail':'[可选] - 数据集中包含的其他值或范围。','example':'2','require':'o','repeat':'y','type':'rangeall'}]},{'n':'VLOOKUP','t':2,'d':'纵向查找。在范围的第一列中自上而下搜索某个键值，并返回所找到的行中指定单元格的值。','a':'纵向查找。在范围的第一列中自上而下搜索某个键值','m':[3,4],'p':[{'name':'搜索键值','detail':'要搜索的值，如 42、"Cats" 或 I24。','example':'10003','require':'m','repeat':'n','type':'rangeall'},{'name':'范围','detail':'要进行搜索的范围。VLOOKUP 将在该范围的第一列中搜索搜索键值中指定的键值。','example':'A2:B26','require':'m','repeat':'n','type':'rangeall'},{'name':'索引','detail':'要返回的值的列索引，范围中的第一列编号为 1。\n\n如果索引不是介于 1 和范围中的列数之间，将返回 #VALUE! 。','example':'2','require':'m','repeat':'n','type':'rangenumber'},{'name':'已排序','detail':'[默认值为 TRUE() ] - 指示要搜索的列（指定范围的第一列）是否已排序。大多数情况下，建议设为 FALSE()。\n\n建议将已排序设为 FALSE。如果设为 FALSE，将返回完全匹配项。如果存在多个匹配值，将返回找到的第一个值对应的单元格的内容，如果找不到匹配值，则返回 #N/A。\n\n如果将已排序设为 TRUE 或省略，将返回（小于或等于搜索键值的）最接近的匹配项。如果搜索的列中所有的值均大于搜索键值，则返回 #N/A。','example':'FALSE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'HLOOKUP','t':2,'d':'横向查找。在范围的第一行中搜索某个键值，并返回所找到的列中指定单元格的值。','a':'横向查找。在范围的第一行中搜索某个键值','m':[3,4],'p':[{'name':'搜索键值','detail':'要搜索的值。例如，42、"Cats"或I24。','example':'10003','require':'m','repeat':'n','type':'rangeall'},{'name':'范围','detail':'要进行搜索的范围。将在该范围的第一行中搜索在搜索键值中指定的键值。','example':'A2:Z6','require':'m','repeat':'n','type':'rangeall'},{'name':'索引','detail':'要返回的值的行索引，范围中的第一行编号为1。\n\n如果索引不是介于1和范围中的行数之间，将返回#VALUE!。','example':'2','require':'m','repeat':'n','type':'rangenumber'},{'name':'已排序','detail':'[可选 - 默认值为TRUE()] - 指示要搜索的行（指定范围的第一行）是否已排序。\n\n如果将已排序设为TRUE或省略，将返回最接近的匹配值（小于或等于搜索键值）。如果在搜索的行中所有的值均大于搜索键值，则返回#N/A。\n\n如果将已排序设为TRUE或将其省略，而范围的首行并非处于已排序状态，则返回值可能会是错误的。\n\n如果将已排序设为FALSE，则仅返回完全匹配。如果存在多个匹配值，将返回与找到的第一个值对应的单元格的内容，如果找不到匹配值则返回#N/A。','example':'FALSE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'LOOKUP','t':2,'d':'在行或列中查找相应键，并将相应单元格的值返回到与搜索行或列所在位置相同的结果范围中。','a':'在行或列中查找相应键','m':[2,3],'p':[{'name':'搜索键值','detail':'要在行或列中搜索的值。例如，42、"Cats" 或 I24。','example':'10003','require':'m','repeat':'n','type':'rangeall'},{'name':'搜索范围 | 搜索结果数组','detail':'使用 LOOKUP 的一种方法是给定单行或单列形式的搜索范围进行搜索查找，这种方式要用到另一个参数结果范围。另一种方式是将这两个参数合并为一个搜索结果数组，其中第一行或第一列用于搜索，并将返回值放在该数组的最后一行或最后一列中。','example':'A1:A100','require':'m','repeat':'n','type':'rangeall'},{'name':'结果范围','detail':'[ 可选 ] - 用于存放返回结果的范围。返回值对应于在搜索范围中找到搜索键值的位置。此范围必须仅为单行或单列，而如果您使用的是搜索结果数组方式，则不应提供此参数。','example':'B1:B100','require':'o','repeat':'n','type':'rangeall'}]},{'n':'ADDRESS','t':2,'d':'返回字符串形式的单元格引用。','a':'返回字符串形式的单元格引用。','m':[2,5],'p':[{'name':'row_num','detail':'一个数值，指定要在单元格引用中使用的行号。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'column_num','detail':'一个数值，指定要在单元格引用中使用的列号（而非名称）。A列的编号为1。','example':'2','require':'m','repeat':'n','type':'rangenumber'},{'name':'abs_num','detail':'[可选 - 默认值为1] - 一个数值，指定要返回的引用类型。\n\n1 表示行列均采用绝对值（例如$A$1）；\n\n2 表示采用绝对行号，相对列标（例如A$1）；\n\n3 表示采用相对行号，绝对列标（例如$A1）；\n\n4 表示行列均采用相对值（例如A1）。','example':'4','require':'o','repeat':'n','type':'rangenumber'},{'name':'A1','detail':'[可选 - 默认值为TRUE()] - 一个布尔值，指示采用A1标记形式(TRUE)还是R1C1标记形式(FALSE)。','example':'FALSE()','require':'o','repeat':'n','type':'rangeall'},{'name':'sheet_text','detail':'[可选 - 默认缺省] - 用于指定地址所指向的工作表名称。','example':'"Sheet2"','require':'o','repeat':'n','type':'rangeall'}]},{'n':'INDIRECT','t':2,'d':'返回以字符串指定的单元格引用。','a':'返回以字符串指定的单元格引用。','m':[1,2],'p':[{'name':'ref_text','detail':'以带引号的字符串形式提供的单元格引用。','example':'"Sheet2!"&B10','require':'m','repeat':'n','type':'rangeall'},{'name':'A1','detail':'[可选 - 默认值为TRUE()] - 一个布尔值，指示采用A1标记形式(TRUE)还是R1C1标记形式(FALSE)。','example':'FALSE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'ROW','t':2,'d':'返回指定单元格的行号','a':'返回指定单元格的行号','m':[0,1],'p':[{'name':'reference','detail':'[可选 - 默认为此公式所在的单元格] - 要返回其行号的单元格。\n\n如果单元格引用指向的范围其宽度大于一个单元格，而此公式不是用作数组公式的，这时会仅返回单元格引用中首行的编号值。','example':'A9','require':'o','repeat':'n','type':'rangeall'}]},{'n':'ROWS','t':2,'d':'返回指定数组或范围中的行数。','a':'返回指定数组或范围中的行数。','m':[1,1],'p':[{'name':'array','detail':'要返回其行数的范围。','example':'A9:A62','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'COLUMN','t':2,'d':'按照 `A=1` 的规则返回指定单元格的列号。','a':'按照 `A=1` 的规则返回指定单元格的列号。','m':[0,1],'p':[{'name':'reference','detail':'[可选 - 默认为包含此公式的单元格] - 要返回其列号的单元格。A列对应的编号为1。\n\n如果单元格引用是宽度超过一个单元格的范围，而此公式不是作为数组公式来使用的，因此将返回单元格引用中的第一列的位置。','example':'A9','require':'o','repeat':'n','type':'rangeall'}]},{'n':'COLUMNS','t':2,'d':'返回指定数组或范围中的列数。','a':'返回指定数组或范围中的列数。','m':[1,1],'p':[{'name':'array','detail':'要返回其列数的范围。','example':'A9:W62','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'OFFSET','t':2,'d':'给定某范围的起始单元格引用以及该范围涵盖的行列数量，返回该范围的引用。','a':'给定某范围的起始单元格引用以及该范围涵盖的行列数量，返回该范围的引用。','m':[3,5],'p':[{'name':'reference','detail':'用于计算行列偏移量的起点。','example':'A2','require':'m','repeat':'n','type':'range'},{'name':'rows','detail':'要偏移的行数。\n\n行偏移量必须是整数，但也可以是负数。如果提供的参数带有小数，小数部分将被截去。','example':'3','require':'m','repeat':'n','type':'rangenumber'},{'name':'cols','detail':'要偏移的列数。\n\n列偏移量必须是整数，但也可以是负数。如果提供的参数带有小数，小数部分将被截去。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'height','detail':'[可选] - 要从偏移目标开始返回的范围的高度。','example':'2','require':'o','repeat':'n','type':'rangenumber'},{'name':'width','detail':'[可选] - 要从偏移目标开始返回的范围的宽度。','example':'2','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'MATCH','t':2,'d':'在单元格中搜索指定项，然后返回该项在单元格区域中的相对位置。','a':'在单元格中搜索指定项，然后返回该项在单元格区域中的相对位置。','m':[2,3],'p':[{'name':'lookup_value','detail':'要在 lookup_array 中匹配的值。','example':'"Sunday"','require':'m','repeat':'n','type':'rangeall'},{'name':'lookup_array','detail':'要搜索的单元格区域。\n\n如果所用的范围的高度和宽度均大于1，MATCH将返回#N/A!。','example':'A2:A9','require':'m','repeat':'n','type':'range'},{'name':'match_type','detail':'[可选 - 默认值为1] - 要采用的搜索方式。\n\n1为默认类型，此时MATCH会假设范围已按升序排序，并返回小于等于搜索键值的最大值。\n\n0表示完全匹配，在范围未排序的情况下需要使用此方式。\n\n-1让MATCH假设范围是按降序排序的，并返回大于等于搜索键值的最小值。','example':'0','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'INDEX','t':2,'d':'返回表格或中的元素值，此元素由行号和列号的索引值给定。','a':'返回表格或中的元素值，此元素由行号和列号的索引值给定。','m':[3,3],'p':[{'name':'array','detail':'单元格区域或数组常量。','example':'A1:C20','require':'m','repeat':'n','type':'range'},{'name':'row_num','detail':'选择数组中的某行，函数从该行返回数值。','example':'5','require':'m','repeat':'n','type':'rangenumber'},{'name':'column_num','detail':'选择数组中的某列，函数从该列返回数值。','example':'1','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'GETPIVOTDATA','t':2,'d':'从与指定行和列标题对应的数据透视表中提取汇总值。','a':'从与指定行和列标题对应的数据透视表中提取汇总值。','m':[2,254],'p':[{'name':'data_field','detail':'您想从数据透视表中获取其数据的值名称。\n值名称必须括在引号中或是指向包含相关文本的任何单元格的引用。\n如果有多个值字段，则必须使用数据透视表中显示的确切名称（如“销售总额”）。','example':'"SUM of number of units"','require':'m','repeat':'n','type':'rangeall'},{'name':'pivot_table','detail':'目标数据透视表中的任何单元格的引用（推荐位于顶角的单元格）。','example':"'Pivot table'!A1",'require':'m','repeat':'n','type':'rangeall'},{'name':'field1','detail':'[可选] - 源数据集（不是数据透视表）中列的名称。','example':'"division"','require':'o','repeat':'y','type':'rangeall'},{'name':'item1','detail':'[可选] - 数据透视表中显示的与您要检索的字段名称 1 相对应的行或列的名称。','example':'"east"','require':'o','repeat':'y','type':'rangeall'}]},{'n':'CHOOSE','t':2,'d':'基于索引返回选项列表中的元素。','a':'基于索引返回选项列表中的元素。','m':[2,255],'p':[{'name':'index_num','detail':'指定要返回哪一项。\n\n如果索引为零、负值或大于提供的选择数量，将返回#VALUE!错误。','example':'2','require':'m','repeat':'n','type':'rangenumber'},{'name':'value1','detail':'一项可能的返回值。必须提供。可以是单元格引用或单独的值。','example':'"A"','require':'m','repeat':'n','type':'rangeall'},{'name':'value2','detail':'[可选] - 其他可以选择的值。选择','example':'"B"','require':'o','repeat':'y','type':'rangeall'}]},{'n':'HYPERLINK','t':2,'d':'在单元格内创建一个超链接。','a':'在单元格内创建一个超链接。','p':[{'name':'网址','detail':'以引号括住的链接位置的完整网址，或对包含这种网址的单元格的引用。\n\n仅允许某些链接类型。其中包括：http://、https://、mailto:、aim:、ftp://、gopher://、telnet://和news://，明确禁用使用其他协议。如果指定的是其他协议，将会在单元格中显示链接标签，但该标签不会以链接形式呈现。\n\n如果未指定协议，则假设使用http://，并将其作为网址的前缀。','example':'"http://www.google.com/"','require':'m','repeat':'n','type':'rangeall'},{'name':'链接标签','detail':'[可选 - 默认为网址] - 要在单元格中作为链接显示的文本（用引号括起来的），或者指向包含这种标签的单元格的引用。\n\n如果链接标签是指向某个空单元格的引用，如果网址有效，就将其作为链接显示，否则作为纯文本显示。\n\n如果链接标签为空字符串常量("")，所在单元格显示的内容将为空白，但通过点击该单元格或转入该单元格仍然可以访问链接。','example':'"Google"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'TIME','t':6,'d':'将给定的小时、分钟和秒转换为时间。','a':'将给定的小时、分钟和秒转换为时间。','m':[3,3],'p':[{'name':'小时','detail':'0（零）到 32767 之间的数字，代表小时。\n\n任何大于 23 的值都会除以 24，余数将作为小时值。','example':'11','require':'m','repeat':'n','type':'rangenumber'},{'name':'分钟','detail':'0（零）到 32767 之间的数字，代表分钟。\n\n任何大于 59 的值将转换为小时和分钟。','example':'40','require':'m','repeat':'n','type':'rangenumber'},{'name':'秒','detail':'0（零）到 32767 之间的数字，代表秒。\n\n任何大于 59 的值将转换为小时、分钟和秒。','example':'59','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'TIMEVALUE','t':6,'d':'按一天24小时返回该时间的分数表示。','a':'按一天24小时返回该时间的分数表示。','m':[1,1],'p':[{'name':'time_text','detail':'用于表示时间的字符串。','example':'"2:15 PM"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'EOMONTH','t':6,'d':'返回某个月份最后一天的序列号，该月份在另一个日期之前或之后的数个月（月数由参数指定）。','a':'返回某个月份最后一天的序列号','m':[2,2],'p':[{'name':'start_date','detail':'用于计算结果的参照日期。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'},{'name':'months','detail':'用于计算的起始日期之前（负）或之后（正）的月数。返回的是计算所得月份的最后那天。','example':'7','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'EDATE','t':6,'d':'返回表示某个日期的序列号，该日期在另一个日期的数月之前/之后。','a':'返回表示某个日期的序列号','m':[2,2],'p':[{'name':'start_date','detail':'用于计算结果的参照日期。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'},{'name':'months','detail':'用于计算的起始日期之前（负）或之后（正）的月数。','example':'7','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SECOND','t':6,'d':'返回时间值的秒数。 秒数是 0（零）到 59 范围内的整数。','a':'返回时间值的秒数。 秒数是 0（零）到 59 范围内的整数。','m':[1,1],'p':[{'name':'时间','detail':'用于计算秒钟部分的时间。必须为以下值之一：指向包含日期/时间值的单元格的引用、返回日期/时间的函数或者数字。','example':'TIME(11','require':'m','repeat':'n','type':'rangeall'}]},{'n':'MINUTE','t':6,'d':'以数字格式返回特定时间的分钟部分。','a':'以数字格式返回特定时间的分钟部分。','m':[1,1],'p':[{'name':'时间','detail':'用于计算分钟部分的时间。必须为以下值之一：指向包含日期/时间值的单元格的引用、返回日期/时间的函数或者数字。','example':'TIME(11','require':'m','repeat':'n','type':'rangeall'}]},{'n':'HOUR','t':6,'d':'以数字格式返回特定时间的小时部分。','a':'以数字格式返回特定时间的小时部分。','m':[1,1],'p':[{'name':'时间','detail':'用于计算小时部分的时间。必须为以下值之一：指向包含日期/时间值的单元格的引用、返回日期/时间的函数或者数字。','example':'TIME(11','require':'m','repeat':'n','type':'rangeall'}]},{'n':'NOW','t':6,'d':'以日期值格式返回当前日期和时间。','a':'以日期值格式返回当前日期和时间。','m':[0,0],'p':[]},{'n':'NETWORKDAYS','t':6,'d':'返回所提供的两个日期之间的净工作日天数。','a':'返回所提供的两个日期之间的净工作日天数。','m':[2,3],'p':[{'name':'start_date','detail':'用于计算净工作日天数的时间段开始日期。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'},{'name':'end_date','detail':'用于计算净工作日天数的时间段结束日期。','example':'7','require':'m','repeat':'n','type':'rangeall'},{'name':'holidays','detail':'[可选] - 一个范围或数组常量，其中包含作为节假日的日期序号。\n\n在节假日数组中提供的值必须是日期序号值（例如由N所返回的值）或日期值（例如由DATE、DATEVALUE或TO_DATE返回的值）。由范围指定的值应该是标准的日期值或日期序数值。','example':'16)','require':'o','repeat':'n','type':'rangeall'}]},{'n':'NETWORKDAYS_INTL','t':6,'d':'返回给定的两个日期之间的净工作日天数（排除指定的周末和节假日）。','a':'返回给定的两个日期之间的净工作日天数（排除指定的周末和节假日）。','m':[2,4],'p':[{'name':'start_date','detail':'用于计算净工作日天数的时间段开始日期。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'},{'name':'end_date','detail':'用于计算净工作日天数的时间段结束日期。','example':'7','require':'m','repeat':'n','type':'rangeall'},{'name':'weekend','detail':'[可选 - 默认值为1] - 用于表示哪些天为周末的数字或字符串。\n字符串方式：可以使用由0和1组成的字符串来指定周末，串中的第一个数字字符代表周一，最后一个则代表周日。零表示这一天是工作日，1表示这一天为周末。例如，“0000011”表示将周六和周日作为周末。\n数字方式：这种方式不使用上述字符串形式，而是使用一个数字。1 =周六/周日为周末，2 =周日/周一为周末，依此类推则7 =周五/周六。11 =周日为唯一周末，12 =周一为唯一周末，依此类推则17 =周六为唯一周末。','example':'16)','require':'o','repeat':'n','type':'rangeall'},{'name':'holidays','detail':'[ 可选 ] - 这是一个范围或数组常量，其中包含作为节假日的日期。\n在节假日数组内提供的值必须为日期序数值（例如N的返回值）或日期值（例如DATE、DATEVALUE或TO_DATE的返回值）。由范围指定的值应该是标准的日期值或日期序数值。','example':'DATE(1969','require':'o','repeat':'n','type':'rangeall'}]},{'n':'ISOWEEKNUM','t':6,'d':'返回给定日期在全年中的 ISO 周数。','a':'返回给定日期在全年中的 ISO 周数。','m':[1,1],'p':[{'name':'date','detail':'用于日期和时间计算的日期-时间代码。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'}]},{'n':'WEEKNUM','t':6,'d':'返回特定日期的周数。','a':'返回特定日期的周数。','m':[1,2],'p':[{'name':'serial_number','detail':'要确定其位于第几周的日期，必须是对包含日期的单元格的引用、返回日期类型的函数或者数字。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'},{'name':'return_type','detail':'[可选 - 默认值为 1 ] - 代表一周起始日的数字，系统也使用该数字来确定一年的第一周（1=周日，2=周一）。','example':'7','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'WEEKDAY','t':6,'d':'返回一个数字，对应于给定日期所在的星期几。','a':'返回一个数字，对应于给定日期所在的星期几。','m':[1,2],'p':[{'name':'serial_number','detail':'要为其确定星期几的日期。必须是对包含日期的单元格的引用、返回日期类型的函数或者数字。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'},{'name':'return_type','detail':'[可选 - 默认值为 1] - 以数字指示使用哪种编号顺序来表示星期几。默认情况下，按星期日 (= 1) 开始计算。\n\n如果类型为 1，则星期值将从星期日开始算起，并且星期日的值为 1，因此星期六的值就是 7。\n\n如果类型为 2，则星期值将从星期一开始算起，并且星期一的值为 1，因此星期日的值就是 7。\n\n如果类型为 3，则星期值将从星期一算起，并且星期一的值为 0，因此星期日的值就是 6。','example':'7','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'DAY','t':6,'d':'以数字格式返回特定日期所在的当月几号。','a':'以数字格式返回特定日期所在的当月几号。','m':[1,1],'p':[{'name':'serial_number','detail':'要从中提取具体几号的日期。必须是以下一种：对包含日期的单元格的引用、返回日期类型的函数或者数字。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'}]},{'n':'DAYS','t':6,'d':'返回两个日期之间的天数。','a':'返回两个日期之间的天数。','m':[2,2],'p':[{'name':'end_date','detail':'计算中要使用的结束日期。必须是以下一种：对包含日期的单元格的引用、返回日期类型的函数或者数字。','example':'2011-3-15','require':'m','repeat':'n','type':'rangeall'},{'name':'start_date','detail':'计算中要使用的开始日期。必须是以下一种：对包含日期的单元格的引用、返回日期类型的函数或者数字。','example':'2011-2-1','require':'m','repeat':'n','type':'rangeall'}]},{'n':'DAYS360','t':6,'d':'按照每年360天，返回两个日期之间的差（用于计算利息）。','a':'按照每年360天，返回两个日期之间的差（用于计算利息）。','m':[2,3],'p':[{'name':'start_date','detail':'计算中要使用的开始日期。必须是以下一种：对包含日期的单元格的引用、返回日期类型的函数或者数字。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'},{'name':'end_date','detail':'计算中要使用的结束日期。必须是以下一种：对包含日期的单元格的引用、返回日期类型的函数或者数字。','example':'7','require':'m','repeat':'n','type':'rangeall'},{'name':'method','detail':'[可选 - 默认为FALSE()] - 指示要使用哪种天数计算方法。\n\nFALSE - 采用美国 (NASD) 方法时，如果起始日期为某月的最后一天，为便于计算，会将起始日期的当月几号更改为30。此外，如果结束日期是所在月份的最后一天，而且起始日期在其所在月的30号之前，则将结束日期更改为结束日期之后那个月的第一天，否则将结束日期更改为该月的30号。\n\nTRUE - 采用欧洲方法时，会将所有日期在31号的起始日期或结束日期更改为当月的30号。','example':'FALSE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'DATE','t':6,'d':'将提供的年、月、日转换为日期。','a':'将提供的年、月、日转换为日期。','m':[3,3],'p':[{'name':'year','detail':'日期的年份部分，包含一到四位数字。\n\n介于 0（零）到 1899 之间，会将该值与 1900 相加来计算年份；\n\n介于 1900 到 9999 之间，将使用该数值作为年份；\n\n小于 0 或大于等于 10000，返回 错误值 #NUM!。','example':'1969','require':'m','repeat':'n','type':'rangenumber'},{'name':'month','detail':'日期的月份部分，一个正整数或负整数。\n\n如果 month 大于 12，则 month 会将该月份数与指定年中的第一个月相加。\n\n如果 month 小于 1，month 则从指定年份的一月份开始递减该月份数，然后再加上 1 个月。','example':'7','require':'m','repeat':'n','type':'rangenumber'},{'name':'day','detail':'日期的日部分，一个正整数或负整数。\n\n如果 day 大于月中指定的天数，则 day 会将天数与该月中的第一天相加。\n\n如果 day 小于 1，则 day 从指定月份的第一天开始递减该天数，然后再加上 1 天。','example':'20','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'DATEVALUE','t':6,'d':'将提供的日期字符串转换为日期的序列号。','a':'将提供的日期字符串转换为日期的序列号。','m':[1,1],'p':[{'name':'date_text','detail':'表示日期的字符串。','example':'"1969-7-20"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'DATEDIF','t':6,'d':'计算两个日期之间的天数、月数或年数。','a':'计算两个日期之间的天数、月数或年数。','m':[3,3],'p':[{'name':'起始日期','detail':'计算中要使用的开始日期。必须是对包含DATE值的单元格的引用、返回DATE类型的函数或数字。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'},{'name':'结束日期','detail':'计算中要使用的结束日期。必须是对包含DATE值的单元格的引用、返回DATE类型的函数或数字。','example':'7','require':'m','repeat':'n','type':'rangeall'},{'name':'单位','detail':'时间单位的缩写文字。例如 "M" 代表月。有效值包括："Y"、"M"、"D"、"MD"、"YM" 和 "YD"。\n\n"Y"：返回起始日期和结束日期之间的整年数。\n\n"M"：返回起始日期和结束日期之间的整月数。\n\n"D"：返回起始日期和结束日期之间的天数。\n\n"MD"：返回起始日期和结束日期之间的天数（不计整月数）。\n\n"YM"：返回起始日期和结束日期之间的整月数（不计整年数）。\n\n"YD"：返回起始日期和结束日期之间的天数（假设起始日期和结束日期的间隔不超过一年）。','example':'16)','require':'m','repeat':'n','type':'rangeall'}]},{'n':'WORKDAY','t':6,'d':'指定工作日天数，计算结束日期。','a':'指定工作日天数，计算结束日期。','m':[2,3],'p':[{'name':'start_date','detail':'计算的开始日期。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'},{'name':'days','detail':'start_date 之前或之后不含周末及节假日的天数。\n\n为正值将生成未来日期；\n\n为负值生成过去日期。','example':'7','require':'m','repeat':'n','type':'rangenumber'},{'name':'holidays','detail':'[可选] - 一个范围或数组常量，其中包含作为节假日的日期序号。\n\n在节假日数组中提供的值必须是日期序号值（例如由N所返回的值）或日期值（例如由DATE、DATEVALUE或TO_DATE返回的值）。由范围指定的值应该是标准的日期值或日期序数值。','example':'16)','require':'o','repeat':'n','type':'rangeall'}]},{'n':'WORKDAY_INTL','t':6,'d':'返回指定的若干个工作日之前或之后的日期的序列号（使用自定义周末参数）。 ','a':'返回指定的若干个工作日之前或之后的日期的序列号（使用自定义周末参数）。 ','m':[2,4],'p':[{'name':'start_date','detail':'开始日期（将被截尾取整）。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'},{'name':'days','detail':'start_date 之前或之后的工作日的天数。\n\n正值表示未来日期；\n\n负值表示过去日期；\n\n零值表示开始日期。','example':'7','require':'m','repeat':'n','type':'rangenumber'},{'name':'weekend','detail':'[可选 - 默认值为1] - 用于表示哪些天为周末的数字或字符串。\n字符串方式：可以使用由0和1组成的字符串来指定周末，串中的第一个数字字符代表周一，最后一个则代表周日。零表示这一天是工作日，1表示这一天为周末。例如，“0000011”表示将周六和周日作为周末。\n数字方式：这种方式不使用上述字符串形式，而是使用一个数字。1 =周六/周日为周末，2 =周日/周一为周末，依此类推则7 =周五/周六。11 =周日为唯一周末，12 =周一为唯一周末，依此类推则17 =周六为唯一周末。','example':'16)','require':'o','repeat':'n','type':'rangeall'},{'name':'holidays','detail':'[ 可选 ] - 这是一个范围或数组常量，其中包含作为节假日的日期。\n在节假日数组内提供的值必须为日期序数值（例如N的返回值）或日期值（例如DATE、DATEVALUE或TO_DATE的返回值）。由范围指定的值应该是标准的日期值或日期序数值。','example':'DATE(1969','require':'o','repeat':'n','type':'rangeall'}]},{'n':'YEAR','t':6,'d':'返回对应于某个日期的年份。 Year 作为 1900 - 9999 之间的整数返回。','a':'返回对应于某个日期的年份。 Year 作为 1900 - 9999 之间的整数返回。','m':[1,1],'p':[{'name':'serial_number','detail':'用于计算年份的日期。必须是以下一种：对包含日期的单元格的引用、返回日期类型的函数或者数字。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'}]},{'n':'YEARFRAC','t':6,'d':'返回 start_date 和 end_date 之间的天数占全年天数的百分比。','a':'返回 start_date 和 end_date 之间的天数占全年天数的百分比。','m':[2,3],'p':[{'name':'start_date','detail':'计算中要使用的开始日期。必须是以下一种：对包含日期的单元格的引用、返回日期类型的函数或者数字。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'},{'name':'end_date','detail':'计算中要使用的结束日期。必须是以下一种：对包含日期的单元格的引用、返回日期类型的函数或者数字。','example':'7','require':'m','repeat':'n','type':'rangeall'},{'name':'basis','detail':'[可选 - 默认为0] - 要使用的日计数基准类型。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'16)','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'TODAY','t':6,'d':'以日期值格式返回当前日期。','a':'以日期值格式返回当前日期。','m':[0,0],'p':[]},{'n':'MONTH','t':6,'d':'返回日期（以序列数表示）中的月份。 月份是介于 1（一月）到 12（十二月）之间的整数。','a':'返回日期（以序列数表示）中的月份。 月份是介于 1（一月）到 12（十二月）之间的整数。','m':[1,1],'p':[{'name':'serial_number','detail':'要从中提取月份的日期。必须是以下一种：对包含日期的单元格的引用、返回日期类型的函数或者数字。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'}]},{'n':'EFFECT','t':8,'d':'根据名义利率及每年的复利计息期数来计算实际年利率。','a':'根据名义利率及每年的复利计息期数来计算实际年利率。','m':[2,2],'p':[{'name':'nominal_rate','detail':'每年的名义利率。','example':'0.99','require':'m','repeat':'n','type':'rangenumber'},{'name':'npery','detail':'每年的复利计算期数。','example':'12','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'DOLLAR','t':12,'d':'将数字格式设置为与语言区域相对应的货币格式。','a':'将数字格式设置为与语言区域相对应的货币格式。','m':[1,2],'p':[{'name':'number','detail':'要设置格式的值。','example':'1.2351','require':'m','repeat':'n','type':'rangenumber'},{'name':'decimals','detail':'[可选 - 默认值为 2] - 要显示的小数位数。\n\n如果这是负数，则将数字四舍五入到小数点左侧。','example':'4','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'DOLLARDE','t':8,'d':'将以整数部分和分数部分转换为以小数部分表示的金额数字','a':'将以整数部分和分数部分转换为以小数部分表示的金额数字','m':[2,2],'p':[{'name':'fractional_dollar','detail':'以整数部份和分数部分表示的数字，用小数点隔开。','example':'100.10','require':'m','repeat':'n','type':'rangenumber'},{'name':'fraction','detail':'用作分数中的分母的整数。','example':'32','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'DOLLARFR','t':8,'d':'将小数转换为分数表示的金额数字。','a':'将小数转换为分数表示的金额数字。','m':[2,2],'p':[{'name':'decimal_dollar','detail':'小数。','example':'100.125','require':'m','repeat':'n','type':'rangenumber'},{'name':'fraction','detail':'用作分数中的分母的整数。','example':'32','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'DB','t':8,'d':'使用固定余额递减法，返回指定期间内某项固定资产的折旧值。','a':'使用固定余额递减法，返回指定期间内某项固定资产的折旧值。','m':[4,5],'p':[{'name':'cost','detail':'资产原值。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'salvage','detail':'折旧末尾时的值（有时也称为资产残值）。','example':'50','require':'m','repeat':'n','type':'rangenumber'},{'name':'life','detail':'资产的折旧期数（有时也称作资产的使用寿命）。','example':'10','require':'m','repeat':'n','type':'rangenumber'},{'name':'period','detail':'在使用期限内要计算折旧的折旧期。','example':'2','require':'m','repeat':'n','type':'rangenumber'},{'name':'month','detail':'[可选 - 默认值为12] - 折旧第一年中的月数。','example':'10','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'DDB','t':8,'d':'用双倍余额递减法，返回指定期间内某项固定资产的折旧值。','a':'用双倍余额递减法，返回指定期间内某项固定资产的折旧值。','m':[4,5],'p':[{'name':'cost','detail':'资产原值。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'salvage','detail':'折旧末尾时的值（有时也称为资产残值）。','example':'50','require':'m','repeat':'n','type':'rangenumber'},{'name':'life','detail':'资产的折旧期数（有时也称作资产的使用寿命）。','example':'10','require':'m','repeat':'n','type':'rangenumber'},{'name':'period','detail':'在使用期限内要计算折旧的折旧期。','example':'2','require':'m','repeat':'n','type':'rangenumber'},{'name':'factor','detail':'[可选 - 默认值为2] - 折旧的递减系数。','example':'2.25','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'RATE','t':8,'d':'返回年金每期的利率。','a':'返回年金每期的利率。','m':[3,6],'p':[{'name':'nper','detail':'年金的付款总期数。','example':'12','require':'m','repeat':'n','type':'rangenumber'},{'name':'pmt','detail':'每期的付款金额，在年金周期内不能更改。','example':'-100','require':'m','repeat':'n','type':'rangenumber'},{'name':'pv','detail':'现值即一系列未来付款当前值的总和。','example':'400','require':'m','repeat':'n','type':'rangenumber'},{'name':'fv','detail':'[可选 - 默认值为0] - 未来值，或在最后一次付款后希望得到的现金余额。','example':'0','require':'o','repeat':'n','type':'rangenumber'},{'name':'type','detail':'[可选 - 默认值为0] - 指定各期的付款时间是在期初还是期末。\n\n0 表示期末；\n\n1 表示期初。','example':'0','require':'o','repeat':'n','type':'rangenumber'},{'name':'guess','detail':'[可选 - 默认值为0.1] - 预期利率。','example':'0.1','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'CUMPRINC','t':8,'d':'基于等额分期付款和固定利率，计算投资在多个付款期内的累计本金偿还额。','a':'基于等额分期付款和固定利率，计算投资在多个付款期内的累计本金偿还额。','m':[6,6],'p':[{'name':'rate','detail':'利率。','example':'0.12','require':'m','repeat':'n','type':'rangenumber'},{'name':'nper','detail':'总付款期数。','example':'12','require':'m','repeat':'n','type':'rangenumber'},{'name':'pv','detail':'年金的现值。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'start_period','detail':'开始累计计算的付款期序号。\n\n首期必须大于等于1。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'end_period','detail':'结束累计计算的付款期序号。\n\n末期必须大于首期。','example':'5','require':'m','repeat':'n','type':'rangenumber'},{'name':'type','detail':'指定各期的付款时间是在期初还是期末。\n\n0 表示期末；\n\n1 表示期初。','example':'0','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'COUPNUM','t':8,'d':'返回在结算日和到期日之间的付息次数，向上舍入到最近的整数。','a':'返回在结算日和到期日之间的付息次数，向上舍入到最近的整数。','m':[3,4],'p':[{'name':'settlement','detail':'有价证券的结算日。有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。到期日是有价证券有效期截止时的日期。','example':'02','require':'m','repeat':'n','type':'rangeall'},{'name':'frequency','detail':'年付息次数。\n\n如果按年支付，frequency = 1；\n\n按半年期支付，frequency = 2；\n\n按季支付，frequency = 4。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'0','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'SYD','t':8,'d':'返回在指定期间内资产按年限总和折旧法计算的折旧。','a':'返回在指定期间内资产按年限总和折旧法计算的折旧。','m':[4,4],'p':[{'name':'cost','detail':'资产原值。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'salvage','detail':'折旧末尾时的值（有时也称为资产残值）。','example':'50','require':'m','repeat':'n','type':'rangenumber'},{'name':'life','detail':'资产的折旧期数（有时也称作资产的使用寿命）。','example':'10','require':'m','repeat':'n','type':'rangenumber'},{'name':'period','detail':'在使用期限内要计算折旧的折旧期。','example':'2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'TBILLEQ','t':8,'d':'基于贴现率计算美国政府短期债券的等效年化收益率。','a':'基于贴现率计算美国政府短期债券的等效年化收益率。','m':[3,3],'p':[{'name':'settlement','detail':'债券的结算日期，此日期为债券发行后交付给买家的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'债券的到期或结束日期，届时可将其以面值或票面价值赎回。','example':'1','require':'m','repeat':'n','type':'rangeall'},{'name':'discount','detail':'债券购买时的贴现率。','example':'2)','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'TBILLYIELD','t':8,'d':'基于价格计算美国政府短期债券的收益率。','a':'基于价格计算美国政府短期债券的收益率。','m':[3,3],'p':[{'name':'settlement','detail':'债券的结算日期，此日期为债券发行后交付给买家的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'债券的到期或结束日期，届时可将其以面值或票面价值赎回。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'pr','detail':'债券的购买价格。','example':'95','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'TBILLPRICE','t':8,'d':'基于贴现率计算美国政府短期债券的价格。','a':'基于贴现率计算美国政府短期债券的价格。','m':[3,3],'p':[{'name':'settlement','detail':'债券的结算日期，此日期为债券发行后交付给买家的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'债券的到期或结束日期，届时可将其以面值或票面价值赎回。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'discount','detail':'债券购买时的贴现率。','example':'0.09','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'PV','t':8,'d':'基于等额分期付款和固定利率，计算年金投资的现值。','a':'基于等额分期付款和固定利率，计算年金投资的现值。','m':[3,5],'p':[{'name':'rate','detail':'各期利率。','example':'2','require':'m','repeat':'n','type':'rangenumber'},{'name':'nper','detail':'年金的付款总期数。','example':'12','require':'m','repeat':'n','type':'rangenumber'},{'name':'pmt','detail':'每期的付款金额，在年金周期内不能更改。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'fv','detail':'[可选] - 未来值，或在最后一次付款后希望得到的现金余额。','example':'D2','require':'o','repeat':'n','type':'rangenumber'},{'name':'type','detail':'[可选 - 默认值为0] - 指定各期的付款时间是在期初还是期末。\n\n0 表示期末；\n\n1 表示期初。','example':'1','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'ACCRINT','t':8,'d':'返回定期付息证券的应计利息。','a':'返回定期付息证券的应计利息。','m':[6,8],'p':[{'name':'issue','detail':'有价证券的发行日。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'first_interest','detail':'有价证券的首次计息日。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'rate','detail':'有价证券的年息票利率。','example':'0.1','require':'m','repeat':'n','type':'rangenumber'},{'name':'par','detail':'证券的票面值。','example':'10000','require':'m','repeat':'n','type':'rangenumber'},{'name':'frequency','detail':'年付息次数。\n\n如果按年支付，frequency = 1；\n\n按半年期支付，frequency = 2；\n\n按季支付，frequency = 4。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示““欧洲30/360”方法” - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'0','require':'o','repeat':'n','type':'rangenumber'},{'name':'calc_method','detail':'[可选 - 默认为TRUE()] - 一个逻辑值，指定当结算日期晚于首次计息日期时用于计算总应计利息的方法。\n\n如果值为 TRUE，则返回从发行日到结算日的总应计利息。\n\n如果值为 FALSE，则返回从首次计息日到结算日的应计利息。','example':'TRUE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'ACCRINTM','t':8,'d':'返回在到期日支付利息的有价证券的应计利息。','a':'返回在到期日支付利息的有价证券的应计利息。','m':[4,5],'p':[{'name':'issue','detail':'有价证券的发行日。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'},{'name':'settlement','detail':'有价证券的到期日。','example':'DATE(1969','require':'m','repeat':'n','type':'rangeall'},{'name':'rate','detail':'有价证券的年息票利率。','example':'0.1','require':'m','repeat':'n','type':'rangenumber'},{'name':'par','detail':'证券的票面值。','example':'1000','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'12','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'COUPDAYBS','t':8,'d':'返回从付息期开始到结算日的天数。','a':'返回从付息期开始到结算日的天数。','m':[3,4],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'frequency','detail':'年付息次数。\n\n如果按年支付，frequency = 1；\n\n按半年期支付，frequency = 2；\n\n按季支付，frequency = 4。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'0','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'COUPDAYS','t':8,'d':'返回结算日所在的付息期的天数。','a':'返回结算日所在的付息期的天数。','m':[3,4],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'frequency','detail':'年付息次数。\n\n如果按年支付，frequency = 1；\n\n按半年期支付，frequency = 2；\n\n按季支付，frequency = 4。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'0','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'COUPDAYSNC','t':8,'d':'返回从结算日到下一票息支付日之间的天数。','a':'返回从结算日到下一票息支付日之间的天数。','m':[3,4],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'frequency','detail':'年付息次数。\n\n如果按年支付，frequency = 1；\n\n按半年期支付，frequency = 2；\n\n按季支付，frequency = 4。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'0','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'COUPNCD','t':8,'d':'计算结算日之后的下一票息或利息派发日期。','a':'计算结算日之后的下一票息或利息派发日期。','m':[3,4],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'frequency','detail':'年付息次数。\n\n如果按年支付，frequency = 1；\n\n按半年期支付，frequency = 2；\n\n按季支付，frequency = 4。','example':'01)','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'DATE(2019','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'COUPPCD','t':8,'d':'计算结算日之前的最后一个票息或利息支付日。','a':'计算结算日之前的最后一个票息或利息支付日。','m':[3,4],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'frequency','detail':'年付息次数。\n\n如果按年支付，frequency = 1；\n\n按半年期支付，frequency = 2；\n\n按季支付，frequency = 4。','example':'01)','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'DATE(2019','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'FV','t':8,'d':'基于等额分期付款和固定利率，计算年金投资的未来价值。','a':'基于等额分期付款和固定利率，计算年金投资的未来价值。','m':[3,5],'p':[{'name':'rate','detail':'各期利率。','example':'0.12','require':'m','repeat':'n','type':'rangenumber'},{'name':'nper','detail':'年金的付款总期数。','example':'12','require':'m','repeat':'n','type':'rangenumber'},{'name':'pmt','detail':'各期所应支付的金额，在整个年金期间保持不变。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'pv','detail':'[可选 - 默认值为 0 ] - 现值，或一系列未来付款的当前值的累积和。','example':'400','require':'m','repeat':'n','type':'rangenumber'},{'name':'type','detail':'[可选 - 默认值为 0 ] - 指定各期的付款时间是在期初还是期末。\n\n0 表示期末；\n\n1 表示期初。','example':'1','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'FVSCHEDULE','t':8,'d':'返回应用一系列复利率计算的初始本金的未来值。','a':'返回应用一系列复利率计算的初始本金的未来值。','m':[2,2],'p':[{'name':'principal','detail':'现值。','example':'10000','require':'m','repeat':'n','type':'rangenumber'},{'name':'schedule','detail':'用于计算本金复利的一组利率。\n\n利率表必须是范围或数组，其中包含要用于计算复利的一组利率。这些利率值应该以十进制小数形式表示，或者使用UNARY_PERCENT以百分比形式表示，即表示为0.09或UNARY_PERCENT(9)，而不要表示为9。','example':'A2:A100','require':'m','repeat':'n','type':'range'}]},{'n':'YIELD','t':8,'d':'返回定期支付利息的债券的收益率。','a':'返回定期支付利息的债券的收益率。','m':[6,7],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'rate','detail':'有价证券的年息票利率。','example':'0.057','require':'m','repeat':'n','type':'rangenumber'},{'name':'pr','detail':'有价证券的价格。','example':'95','require':'m','repeat':'n','type':'rangenumber'},{'name':'redemption','detail':'有价证券的清偿价值。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'frequency','detail':'年付息次数。\n\n如果按年支付，frequency = 1；\n\n按半年期支付，frequency = 2；\n\n按季支付，frequency = 4。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'0','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'YIELDDISC','t':8,'d':'基于价格计算折价发行的（不带息）债券的年收益率。','a':'基于价格计算折价发行的（不带息）债券的年收益率。','m':[4,5],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'pr','detail':'有价证券的价格。','example':'95','require':'m','repeat':'n','type':'rangenumber'},{'name':'redemption','detail':'有价证券的清偿价值。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'0','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'NOMINAL','t':8,'d':'基于给定的实际利率和年复利期数，返回名义年利率。','a':'基于给定的实际利率和年复利期数，返回名义年利率。','m':[2,2],'p':[{'name':'effect_rate','detail':'每年的实际利率。','example':'0.85','require':'m','repeat':'n','type':'rangenumber'},{'name':'npery','detail':'每年的复利期数。','example':'12','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'XIRR','t':8,'d':'返回一组不一定定期发生的现金流的内部收益率。','a':'返回一组不一定定期发生的现金流的内部收益率。','m':[2,3],'p':[{'name':'values','detail':'其中含有投资相关收益或支出的数组或范围。\n\n现金流数额中必须至少包含一项负的和一项正的现金流金额才能计算回报率。','example':'B2:B25','require':'m','repeat':'n','type':'range'},{'name':'dates','detail':'与现金流数额参数中的现金流对应的日期数组或范围。','example':'C2:C25','require':'m','repeat':'n','type':'range'},{'name':'guess','detail':'[可选 - 默认值为0.1] - 对内部回报率的估算值。','example':'250','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'MIRR','t':8,'d':'返回一系列定期现金流的修改后内部收益率。','a':'返回一系列定期现金流的修改后内部收益率。','m':[3,3],'p':[{'name':'values','detail':'其中含有投资相关收益或支出的数组或范围。\n\n现金流数额中必须至少包含一项负的和一项正的现金流金额才能计算回报率。','example':'A2:A25','require':'m','repeat':'n','type':'range'},{'name':'finance_rate','detail':'现金流中使用的资金支付的利率。','example':'0.1','require':'m','repeat':'n','type':'rangenumber'},{'name':'reinvest_rate','detail':'将现金流再投资的收益率。','example':'0.12','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'IRR','t':8,'d':'返回由值中的数字表示的一系列现金流的内部收益率。 ','a':'返回由值中的数字表示的一系列现金流的内部收益率。 ','m':[1,2],'p':[{'name':'values','detail':'其中含有投资相关收益或支出的数组或范围。\n\n现金流数额中必须至少包含一项负的和一项正的现金流金额才能计算回报率。','example':'A2:A25','require':'m','repeat':'n','type':'range'},{'name':'guess','detail':'[可选 - 默认为 0.1] - 内部收益率的估值。','example':'200','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'NPV','t':8,'d':'使用贴现率和一系列未来支出（负值）和收益（正值）来计算一项投资的净现值。','a':'使用贴现率和一系列未来支出（负值）和收益（正值）来计算一项投资的净现值。','m':[2,255],'p':[{'name':'rate','detail':'某一期间的贴现率。','example':'0.1','require':'m','repeat':'n','type':'rangenumber'},{'name':'value1','detail':'第一笔支出（负值）和收益（正值）。','example':'200','require':'m','repeat':'n','type':'rangeall'},{'name':'value2, ...','detail':'[可选] - 其他支出（负值）和收益（正值）。','example':'250','require':'o','repeat':'y','type':'rangeall'}]},{'n':'XNPV','t':8,'d':'返回一组现金流的净现值，这些现金流不一定定期发生。','a':'返回一组现金流的净现值，这些现金流不一定定期发生。','m':[3,3],'p':[{'name':'rate','detail':'应用于现金流的贴现率。','example':'A2','require':'m','repeat':'n','type':'rangenumber'},{'name':'values','detail':'与 dates 中的支付时间相对应的一系列现金流。','example':'B2:B25','require':'m','repeat':'n','type':'range'},{'name':'dates','detail':'与现金流支付相对应的支付日期表。','example':'C2:C25','require':'m','repeat':'n','type':'range'}]},{'n':'CUMIPMT','t':8,'d':'基于等额分期付款和固定利率，计算投资在一系列付款期内的累计利息。','a':'基于等额分期付款和固定利率，计算投资在一系列付款期内的累计利息。','m':[6,6],'p':[{'name':'rate','detail':'利息率。','example':'0.12','require':'m','repeat':'n','type':'rangenumber'},{'name':'nper','detail':'总付款期数。','example':'12','require':'m','repeat':'n','type':'rangenumber'},{'name':'pv','detail':'现值。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'start_period','detail':'开始累计计算的付款期序号。\n\n首期必须大于等于1。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'end_period','detail':'结束累计计算的付款期序号。\n\n末期必须大于首期。','example':'5','require':'m','repeat':'n','type':'rangenumber'},{'name':'type','detail':'指定各期的付款时间是在期初还是期末。\n\n0 表示期末；\n\n1 表示期初。','example':'0','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'PMT','t':8,'d':'用于根据固定付款额和固定利率计算贷款的付款额。','a':'用于根据固定付款额和固定利率计算贷款的付款额。','m':[3,5],'p':[{'name':'rate','detail':'贷款利率。','example':'0.08','require':'m','repeat':'n','type':'rangenumber'},{'name':'nper','detail':'该项贷款的付款总数。','example':'12','require':'m','repeat':'n','type':'rangenumber'},{'name':'pv','detail':'现值，或一系列未来付款额现在所值的总额，也叫本金。','example':' 100000','require':'m','repeat':'n','type':'rangenumber'},{'name':'fv','detail':'[可选 - 默认值为 0] - 未来值，或在最后一次付款后希望得到的现金余额。','example':'D2','require':'m','repeat':'n','type':'rangenumber'},{'name':'type','detail':'[可选 - 默认值为 0] - 指定各期的付款时间是在期初还是期末。\n\n0 表示期末；\n\n1 表示期初。','example':'1','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'IPMT','t':8,'d':'基于固定利率及等额分期付款方式，返回给定期数内对投资的利息偿还额。','a':'基于固定利率及等额分期付款方式，返回给定期数内对投资的利息偿还额。','m':[4,6],'p':[{'name':'rate','detail':'各期利率。','example':'0.1','require':'m','repeat':'n','type':'rangenumber'},{'name':'per','detail':'用于计算其利息数额的期数，必须在 1 到 nper 之间。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'nper','detail':'年金的付款总期数。','example':'12','require':'m','repeat':'n','type':'rangenumber'},{'name':'pv','detail':'现值，或一系列未来付款的当前值的累积和。','example':'80000','require':'m','repeat':'n','type':'rangenumber'},{'name':'fv','detail':'[可选 - 默认值为 0] - 未来值，或在最后一次付款后希望得到的现金余额。','example':'E2','require':'m','repeat':'n','type':'rangenumber'},{'name':'type','detail':'[可选 - 默认值为 0] - 指定各期的付款时间是在期初还是期末。\n\n0 表示期末；\n\n1 表示期初。','example':'1','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'PPMT','t':8,'d':'返回根据定期固定付款和固定利率而定的投资在已知期间内的本金偿付额。','a':'返回根据定期固定付款和固定利率而定的投资在已知期间内的本金偿付额。','m':[4,6],'p':[{'name':'rate','detail':'各期利率。','example':'0.1','require':'m','repeat':'n','type':'rangenumber'},{'name':'per','detail':'指定期数，该值必须在 1 到 nper 范围内。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'nper','detail':'年金的付款总期数。','example':'3*12','require':'m','repeat':'n','type':'rangenumber'},{'name':'pv','detail':'现值即一系列未来付款当前值的总和。','example':'100000','require':'m','repeat':'n','type':'rangenumber'},{'name':'fv','detail':'[可选 - 默认值为 0] - 未来值，或在最后一次付款后希望得到的现金余额。','example':'0','require':'o','repeat':'n','type':'rangenumber'},{'name':'type','detail':'[可选 - 默认值为 0] - 指定各期的付款时间是在期初还是期末。\n\n0 表示期末；\n\n1 表示期初。','example':'0','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'INTRATE','t':8,'d':'返回完全投资型证券的利率。','a':'返回完全投资型证券的利率。','m':[4,5],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'investment','detail':'有价证券的投资额。','example':'100000','require':'m','repeat':'n','type':'rangenumber'},{'name':'redemption','detail':'有价证券到期时的兑换值。','example':'101200','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'12','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'PRICE','t':8,'d':'返回定期付息的面值 ￥100 的有价证券的价格。','a':'返回定期付息的面值 ￥100 的有价证券的价格。','m':[6,7],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'rate','detail':'有价证券的年息票利率。','example':'0.057','require':'m','repeat':'n','type':'rangenumber'},{'name':'yld','detail':'有价证券的年收益率。','example':'0.065','require':'m','repeat':'n','type':'rangenumber'},{'name':'redemption','detail':'面值 ￥100 的有价证券的清偿价值。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'frequency','detail':'年付息次数。\n\n如果按年支付，frequency = 1；\n\n按半年期支付，frequency = 2；\n\n按季支付，frequency = 4。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'0','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'PRICEDISC','t':8,'d':'返回折价发行的面值 ￥100 的有价证券的价格。','a':'返回折价发行的面值 ￥100 的有价证券的价格。','m':[4,5],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'discount','detail':'有价证券的贴现率。','example':'0.0525','require':'m','repeat':'n','type':'rangenumber'},{'name':'redemption','detail':'面值 ￥100 的有价证券的清偿价值。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'0','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'PRICEMAT','t':8,'d':'返回到期付息的面值 ￥100 的有价证券的价格。','a':'返回到期付息的面值 ￥100 的有价证券的价格。','m':[5,6],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'issue','detail':'有价证券的发行日。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'rate','detail':'有价证券在发行日的利率。','example':'0.061','require':'m','repeat':'n','type':'rangenumber'},{'name':'yld','detail':'有价证券的年收益率。','example':'0.061','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'0','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'RECEIVED','t':8,'d':'返回一次性付息的有价证券到期收回的金额。','a':'返回一次性付息的有价证券到期收回的金额。','m':[4,5],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'investment','detail':'有价证券的投资额。','example':'10000000','require':'m','repeat':'n','type':'rangenumber'},{'name':'discount','detail':'有价证券的贴现率。','example':'0.0575','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'12','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'DISC','t':8,'d':'返回有价证券的贴现率。','a':'返回有价证券的贴现率。','m':[4,5],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'pr','detail':'有价证券的价格（按面值为 ￥100 计算）。','example':'97.975','require':'m','repeat':'n','type':'rangenumber'},{'name':'redemption','detail':'面值 ￥100 的有价证券的清偿价值。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'12','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'NPER','t':8,'d':'基于固定利率及等额分期付款方式，返回某项投资的总期数。','a':'基于固定利率及等额分期付款方式，返回某项投资的总期数。','m':[3,5],'p':[{'name':'rate','detail':'各期利率。','example':'0.12','require':'m','repeat':'n','type':'rangenumber'},{'name':'pmt','detail':'各期所应支付的金额，在整个年金期间保持不变。','example':'500','require':'m','repeat':'n','type':'rangenumber'},{'name':'pv','detail':'现值，或一系列未来付款的当前值的累积和。','example':'40000','require':'m','repeat':'n','type':'rangenumber'},{'name':'fv','detail':'[可选 - 默认值为0] - 未来值，或在最后一次付款后希望得到的现金余额。','example':'0','require':'o','repeat':'n','type':'rangenumber'},{'name':'type','detail':'[可选 - 默认值为0] - 指定各期的付款时间是在期初还是期末。\n\n0 表示期末；\n\n1 表示期初。','example':'0','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'SLN','t':8,'d':'返回一个期间内的资产的直线折旧。','a':'返回一个期间内的资产的直线折旧。','m':[3,3],'p':[{'name':'cost','detail':'资产原值。','example':'300000','require':'m','repeat':'n','type':'rangenumber'},{'name':'salvage','detail':'折旧末尾时的值（有时也称为资产残值）。','example':'75000','require':'m','repeat':'n','type':'rangenumber'},{'name':'life','detail':'资产的折旧期数（有时也称作资产的使用寿命）。','example':'10','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'DURATION','t':8,'d':'返回假设面值 ￥100 的定期付息有价证券的修正期限。','a':'返回假设面值 ￥100 的定期付息有价证券的修正期限。','m':[5,6],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'coupon','detail':'有价证券的年息票利率。','example':'0.08','require':'m','repeat':'n','type':'rangenumber'},{'name':'yld','detail':'有价证券的年收益率。','example':'0.09','require':'m','repeat':'n','type':'rangenumber'},{'name':'frequency','detail':'年付息次数。\n\n如果按年支付，frequency = 1；\n\n按半年期支付，frequency = 2；\n\n按季支付，frequency = 4。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'0','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'MDURATION','t':8,'d':'返回假设面值 ￥100 的有价证券的 Macauley 修正期限。','a':'返回假设面值 ￥100 的有价证券的 Macauley 修正期限。','m':[5,6],'p':[{'name':'settlement','detail':'有价证券的结算日。 有价证券结算日是在发行日之后，有价证券卖给购买者的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'maturity','detail':'有价证券的到期日。 到期日是有价证券有效期截止时的日期。','example':'DATE(2010','require':'m','repeat':'n','type':'rangeall'},{'name':'coupon','detail':'有价证券的年息票利率。','example':'0.08','require':'m','repeat':'n','type':'rangenumber'},{'name':'yld','detail':'有价证券的年收益率。','example':'0.09','require':'m','repeat':'n','type':'rangenumber'},{'name':'frequency','detail':'年付息次数。\n\n如果按年支付，frequency = 1；\n\n按半年期支付，frequency = 2；\n\n按季支付，frequency = 4。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'basis','detail':'[可选 - 默认为0] - 指示要使用哪种天数计算方法。\n\n0表示“美国(NASD) 30/360”方法 - 此方法按照美国全国证券交易商协会标准，假设每月30天、每年360天，并对所输入的月末日期进行具体调整。\n\n1表示“实际/实际”方法 - 此方法计算基于指定日期之间的实际天数和所涉及的年份中的实际天数进行计算。此方法用于美国长期债券，也是在非财经用途方面使用最多的方法。\n\n2表示“实际/360”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为360天。\n\n3表示“实际/365”方法 - 此方法基于指定日期之间的实际天数进行计算，但假定每年为365天。\n\n4表示“欧洲30/360”方法 - 类似于0，此方法基于每月30天、每年360天进行计算，但按照欧洲金融惯例对月末日期进行调整。','example':'0','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'BIN2DEC','t':9,'d':'将二进制数转换为十进制数。','a':'将二进制数转换为十进制数。','m':[1,1],'p':[{'name':'number','detail':'要转换为十进制数的带符号的10位二进制数值（以字符串形式提供）。\n\n带符号的二进制数的最高位是符号位；也就是说，负数是以二的补码形式表示的。\n\n对于此函数，最大的正数输入值为0111111111，最小的负数输入值为1000000000。\n\n如果所提供的带符号的二进制数是有效的二进制数，会自动将其转换为相应的字符串输入。例如，BIN2DEC(100)和BIN2DEC("100")得出的结果相同，均为4。','example':'101','require':'m','repeat':'n','type':'rangeall'}]},{'n':'BIN2HEX','t':9,'d':'将二进制数转换为十六进制数。','a':'将二进制数转换为十六进制数。','m':[1,2],'p':[{'name':'number','detail':'要转换为带符号的十六进制数的带符号的10位二进制数值（以字符串形式提供）。\n\n带符号的二进制数的最高位是符号位；也就是说，负数是以二的补码形式表示的。\n\n对于此函数，最大的正数输入值为0111111111，最小的负数输入值为1000000000。\n\n如果所提供的带符号的二进制数是有效的二进制数，会自动将其转换为相应的字符串输入。例如，BIN2HEX(11111)和BIN2HEX("11111")得出 的结果相同，均为1F。','example':'101','require':'m','repeat':'n','type':'rangeall'},{'name':'places','detail':'[ 可选 ] - 结果中要确保的有效位数。\n\n如果设置的有效位数大于结果中的有效位数，则在结果的左侧填充0，使总有效位数达到有效位数。例如，BIN2HEX("11111",8)所得的结果值为0000001F。\n\n如果带符号的二进制数的最高位为1，则忽略此值；即当提供的带符号的二进制数大于等于1000000000时忽略此值。','example':'8','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'BIN2OCT','t':9,'d':'将二进制数转换为八进制数。','a':'将二进制数转换为八进制数。','m':[1,2],'p':[{'name':'number','detail':'要转换为带符号的八进制数的带符号的10位二进制数值（以字符串形式提供）。\n\n带符号的二进制数的最高位是符号位；也就是说，负数是以二的补码形式表示的。\n\n对于此函数，最大的正数输入值为0111111111，最小的负数输入值为1000000000。\n\n如果所提供的带符号的二进制数是有效的二进制数，会自动将其转换为相应的字符串输入。例如，BIN2OCT(11111)和BIN2OCT("11111")得出的结果相同，均为37。','example':'101','require':'m','repeat':'n','type':'rangeall'},{'name':'places','detail':'[ 可选 ] - 结果中要确保的有效位数。\n\n如果设置的有效位数大于结果中的有效位数，则在结果的左侧填充0，使总有效位数达到有效位数。例如，BIN2OCT("11111")得到的结果值为00000037。\n\n如果带符号的二进制数的最高位为1，则忽略此值；即当提供的带符号的二进制数大于等于1000000000时忽略此值。','example':'8','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'DEC2BIN','t':9,'d':'将十进制数转换为二进制数。','a':'将十进制数转换为二进制数。','m':[1,2],'p':[{'name':'number','detail':'要转换为带符号的二进制数的十进制数值（以字符串形式提供）。\n\n对于此函数，最大的正数输入值为511，最小的负数输入值为-512。\n\n如果所提供的十进制数是有效的十进制数，会自动将其转换为相应的字符串输入。例如，DEC2BIN(199)和DEC2BIN("199")得出的结果相同，均为11000111。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'places','detail':'[ 可选 ] - 结果中要确保的有效位数。\n\n如果设置的有效位数大于结果中的有效位数，则在结果的左侧填充0，使总有效位数达到有效位数。\n\n如果十进制数为负数，则忽略此值。','example':'8','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'DEC2HEX','t':9,'d':'将十进制数转换为十六进制数。','a':'将十进制数转换为十六进制数。','m':[1,2],'p':[{'name':'number','detail':'要转换为带符号的十六进制数的十进制数值（以字符串形式提供）。\n\n此函数可接受的最大正数值为549755813887，最小负数值为-549755814888。\n\n如果所提供的十进制数是有效的十进制数，会自动将其转换为相应的字符串输入。例如，DEC2HEX(100)和DEC2HEX("100")得出的结果相同，均为64。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'places','detail':'[ 可选 ] - 结果中要确保的有效位数。\n\n如果设置的有效位数大于结果中的有效位数，则在结果的左侧填充0，使总有效位数达到有效位数。\n\n如果十进制数为负数，则忽略此值。','example':'8','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'DEC2OCT','t':9,'d':'将十进制数转换为八进制数。','a':'将十进制数转换为八进制数。','m':[1,2],'p':[{'name':'number','detail':'要转换为带符号的八进制数的十进制数值（以字符串形式提供）。\n\n此函数可接受的最大正数值为536870911，最小负数值为-53687092。\n\n如果所提供的十进制数是有效的十进制数，会自动将其转换为相应的字符串输入。例如，DEC2OCT(199)和DEC2OCT("199")得出的结果相同，均为307。','example':'100','require':'m','repeat':'n','type':'rangenumber'},{'name':'places','detail':'[ 可选 ] - 结果中要确保的有效位数。\n\n如果设置的有效位数大于结果中的有效位数，则在结果的左侧填充0，使总有效位数达到有效位数。\n\n如果十进制数为负数，则忽略此值。','example':'8','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'HEX2BIN','t':9,'d':'将十六进制数转换为二进制数。','a':'将十六进制数转换为二进制数。','m':[1,2],'p':[{'name':'number','detail':'要转换为带符号的二进制数的带符号的40位十六进制数值（以字符串形式提供）。\n\n带符号的十六进制数的最高位是符号位；也就是说，负数是以二的补码形式表示的。\n\n此函数可接受的最大正数值为1FF，最小负数值为FFFFFFFE00。\n\n如果所提供的带符号的十六进制数是有效的十六进制数，函数会自动将其转换为相应的字符串输入。例如，HEX2BIN(199)和HEX2BIN("199")得出的结果相同，均为110011001。','example':'"f3"','require':'m','repeat':'n','type':'rangeall'},{'name':'places','detail':'[ 可选 ] - 结果中要确保的有效位数。\n\n如果设置的有效位数大于结果中的有效位数，则在结果的左侧填充0，使总有效位数达到有效位数。\n\n如果带符号的十六进制数的最高位为1，则忽略此值；即当提供的带符号的十六进制数大于等于8000000000时忽略此值。','example':'8','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'HEX2DEC','t':9,'d':'将十六进制数转换为十进制数。','a':'将十六进制数转换为十进制数。','m':[1,1],'p':[{'name':'number','detail':'要转换为十进制数的带符号的40位十六进制数值（以字符串形式提供）。\n\n带符号的十六进制数的最高位是符号位；也就是说，负数是以二的补码形式表示的。\n\n此函数可接受的最大正数值为7fffffffff，最小负数值为8000000000。\n\n如果所提供的带符号的十六进制数是有效的十六进制数，函数会自动将其转换为相应的字符串输入。例如，HEX2DEC(199)和HEX2DEC("199")得出的结果相同，均为409。','example':'"f3"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'HEX2OCT','t':9,'d':'将十六进制数转换为八进制数。','a':'将十六进制数转换为八进制数。','m':[1,2],'p':[{'name':'number','detail':'要转换为带符号的八进制数的带符号的40位十六进制数值（以字符串形式提供）。\n\n带符号的十六进制数的最高位是符号位；也就是说，负数是以二的补码形式表示的。\n\n此函数可接受的最大正数值为1FFFFFFF，最小负数值为FFE0000000。\n\n如果所提供的带符号的十六进制数是有效的十六进制数，函数会自动将其转换为相应的字符串输入。例如，HEX2OCT(199)和HEX2OCT("199")得出的结果相同，均为631。','example':'"f3"','require':'m','repeat':'n','type':'rangeall'},{'name':'places','detail':'[ 可选 ] - 结果中要确保的有效位数。\n\n如果设置的有效位数大于结果中的有效位数，则在结果的左侧填充0，使总有效位数达到有效位数。\n\n如果带符号的十六进制数的最高位为1，则忽略此值；即当给定的带符号的十六进制数大于等于8000000000时忽略此值。','example':'8','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'OCT2BIN','t':9,'d':'将八进制数转换为二进制数。','a':'将八进制数转换为二进制数。','m':[1,2],'p':[{'name':'number','detail':'要转换为带符号的二进制数的带符号的30位八进制数值（以字符串形式提供）。\n\n带符号的八进制数的最高位是符号位；也就是说，负数是以二的补码形式表示的。\n\n此函数可接受的最大正数值为777，最小负数值为7777777000。\n\n如果所提供的带符号的八进制数是有效的八进制数，函数会自动将其转换为相应的字符串输入。例如，OCT2BIN(177)和OCT2BIN("177")得出的结果相同，均为1111111。','example':'37','require':'m','repeat':'n','type':'rangeall'},{'name':'places','detail':'[ 可选 ] - 结果中要确保的有效位数。\n\n如果设置的有效位数大于结果中的有效位数，则在结果的左侧填充0，使总有效位数达到有效位数。\n\n如果带符号的八进制数的最高位为1，则忽略此值；即当给定的带符号的八进制数大于等于4000000000时忽略此值。','example':'8','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'OCT2DEC','t':9,'d':'将八进制数转换为十进制数。','a':'将八进制数转换为十进制数。','m':[1,1],'p':[{'name':'number','detail':'要转换为十进制数的带符号的30位八进制数值（以字符串形式提供）。\n\n带符号的ba进制数的最高位是符号位；也就是说，负数是以二的补码形式表示的。\n\n此函数可接受的最大正数值为3777777777，最小负数值为4000000000。\n\n如果所提供的带符号的八进制数是有效的八进制数，函数会自动将其转换为相应的字符串输入。例如，OCT2DEC(177)和OCT2DEC("177")得出的结果相同，均为127。','example':'37','require':'m','repeat':'n','type':'rangeall'}]},{'n':'OCT2HEX','t':9,'d':'将八进制数转换为十六进制数。','a':'将八进制数转换为十六进制数。','m':[1,2],'p':[{'name':'number','detail':'要转换为带符号的十六进制数的带符号的30位八进制数值（以字符串形式提供）。\n\n带符号的ba进制数的最高位是符号位；也就是说，负数是以二的补码形式表示的。\n\n此函数可接受的最大正数值为3777777777，最小负数值为4000000000。\n\n如果所提供的带符号的八进制数是有效的八进制数，函数会自动将其转换为相应的字符串输入。例如，OCT2HEX(177)和OCT2HEX("177")得出的结果相同，均为7F。','example':'37','require':'m','repeat':'n','type':'rangeall'},{'name':'places','detail':'[ 可选 ] - 结果中要确保的有效位数。\n\n如果设置的有效位数大于结果中的有效位数，则在结果的左侧填充0，使总有效位数达到有效位数。\n\n如果带符号的八进制数的最高位为1，则忽略此值；即当给定的带符号的八进制数大于等于4000000000时忽略此值。','example':'8','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'COMPLEX','t':9,'d':'将实系数及虚系数转换为 x+yi 或 x+yj 形式的复数。','a':'将实系数及虚系数转换为 x+yi 或 x+yj 形式的复数。','m':[2,3],'p':[{'name':'real_num','detail':'复数的实系数。','example':'3','require':'m','repeat':'n','type':'rangenumber'},{'name':'i_num','detail':'复数的虚系数。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'suffix','detail':'[可选 - 默认为 "i"] - 复数中虚系数的后缀。','example':'"j"','require':'o','repeat':'n','type':'rangestring'}]},{'n':'IMREAL','t':9,'d':'返回以 x+yi 或 x+yj 文本格式表示的复数的实系数。','a':'返回以 x+yi 或 x+yj 文本格式表示的复数的实系数。','m':[1,1],'p':[{'name':'inumber','detail':'需要计算其实系数的复数。','example':'"4+5i"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'IMAGINARY','t':9,'d':'返回以 x+yi 或 x+yj 文本格式表示的复数的虚系数。','a':'返回以 x+yi 或 x+yj 文本格式表示的复数的虚系数。','m':[1,1],'p':[{'name':'inumber','detail':'需要计算其虚系数的复数。','example':'"4+5i"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'IMCONJUGATE','t':9,'d':'返回以 x+yi 或 x+yj 文本格式表示的复数的共轭复数。','a':'返回以 x+yi 或 x+yj 文本格式表示的复数的共轭复数。','m':[1,1],'p':[{'name':'inumber','detail':'需要计算其共轭数的复数。','example':'"3+4i"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'IMABS','t':9,'d':'返回以 x+yi 或 x+yj 文本格式表示的复数的绝对值（模）。','a':'返回以 x+yi 或 x+yj 文本格式表示的复数的绝对值（模）。','m':[1,1],'p':[{'name':'inumber','detail':'要计算其绝对值的复数。','example':'"3+4i"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'DELTA','t':9,'d':'检验两个值是否相等。 如果 number1=number2，则返回 1；否则返回 0。','a':'检验两个值是否相等。 如果 number1=number2，则返回 1；否则返回 0。','m':[1,2],'p':[{'name':'number1','detail':'第一个数字。','example':'2','require':'m','repeat':'n','type':'rangenumber'},{'name':'number2','detail':'[可选 - 默认为 0] - 第二个数字。','example':'1','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'IMSUM','t':9,'d':'返回以 x+yi 或 x+yj 文本格式表示的 1 至 255 个复数的和。','a':'返回以 x+yi 或 x+yj 文本格式表示的 1 至 255 个复数的和。','m':[1,255],'p':[{'name':'inumber1','detail':'要相加的第一个复数','example':'"3+4i"','require':'m','repeat':'n','type':'rangeall'},{'name':'inumber2, …','detail':'[可选] - 要与值1 相加的其他复数','example':'"5-3i"','require':'o','repeat':'y','type':'rangeall'}]},{'n':'IMSUB','t':9,'d':'返回以 x+yi 或 x+yj 文本格式表示的两个复数的差。','a':'返回以 x+yi 或 x+yj 文本格式表示的两个复数的差。','m':[2,2],'p':[{'name':'inumber1','detail':'从（复）数中减去 inumber2。','example':'"6+5i"','require':'m','repeat':'n','type':'rangeall'},{'name':'inumber2','detail':'从 inumber1 中减（复）数。','example':'"2+3i"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'IMPRODUCT','t':9,'d':'返回以 x+yi 或 x+yj 文本格式表示的 1 至 255 个复数的乘积。','a':'返回以 x+yi 或 x+yj 文本格式表示的 1 至 255 个复数的乘积。','m':[1,255],'p':[{'name':'inumber1','detail':'用于计算乘积的第一个复数','example':'"3+4i"','require':'m','repeat':'n','type':'rangeall'},{'name':'inumber2, …','detail':'[可选] - 要相乘的其他复数。','example':'"5-3i"','require':'o','repeat':'y','type':'rangeall'}]},{'n':'IMDIV','t':9,'d':'返回以 x+yi 或 x+yj 文本格式表示的两个复数的商。','a':'返回以 x+yi 或 x+yj 文本格式表示的两个复数的商。','m':[2,2],'p':[{'name':'inumber1','detail':'复数分子或被除数。','example':'"11+16i"','require':'m','repeat':'n','type':'rangeall'},{'name':'inumber2','detail':'复数分母或除数。','example':'"3+2i"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'NOT','t':10,'d':'返回某个逻辑值的相反值 - “NOT(TRUE())”将返回 FALSE；“NOT(FALSE())”将返回 TRUE。','a':'返回某个逻辑值的相反值 - “NOT(TRUE())”将返回 FALSE；“NOT(FALSE())”将返回 TRUE。','m':[1,1],'p':[{'name':'logical','detail':'计算结果为 TRUE 或 FALSE 的任何值或表达式。','example':'A2','require':'m','repeat':'n','type':'rangeall'}]},{'n':'TRUE','t':10,'d':'返回逻辑值 TRUE。','a':'返回逻辑值 TRUE。','m':[0,0],'p':[]},{'n':'FALSE','t':10,'d':'返回逻辑值 FALSE。','a':'返回逻辑值 FALSE。','m':[0,0],'p':[]},{'n':'AND','t':10,'d':'所有参数的计算结果为 TRUE 时，返回 TRUE；只要有一个参数的计算结果为 FALSE，即返回 FALSE。','a':'所有参数的计算结果为 TRUE 时，返回 TRUE；只要有一个参数的计算结果为 FALSE，即返回 FALSE。','m':[1,255],'p':[{'name':'logical1','detail':'要测试的第一个条件，其计算结果可以为 TRUE 或 FALSE。','example':'A2 = "foo"','require':'m','repeat':'n','type':'rangeall'},{'name':'logical2,...','detail':'[可选] - 要测试的其他条件，其计算结果可以为 TRUE 或 FALSE，最多可包含 255 个条件。','example':'A3 = "bar"','require':'o','repeat':'y','type':'rangeall'}]},{'n':'IFERROR','t':10,'d':'如果第一个参数不是错误值，就返回第一个参数；否则，返回第二个参数。','a':'如果第一个参数不是错误值','m':[2,2],'p':[{'name':'value','detail':'检查是否存在错误的参数。','example':'A1','require':'m','repeat':'n','type':'rangeall'},{'name':'value_if_error','detail':'公式的计算结果错误时返回的值。 计算以下错误类型：#N/A、#VALUE!、#REF!、#DIV/0!、#NUM!、#NAME? 或 #NULL!。','example':'"Error in cell A1"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'IF','t':10,'d':'当逻辑表达式的值为 TRUE 时返回一个值，而当其为 FALSE 时返回另一个值。','a':'当逻辑表达式的值为 TRUE 时返回一个值，而当其为 FALSE 时返回另一个值。','m':[2,3],'p':[{'name':'logical_test','detail':'一个表达式或对包含表达式的单元格的引用，该表达式代表某种逻辑值（即TRUE或FALSE）。','example':'A2 = "foo"','require':'m','repeat':'n','type':'rangeall'},{'name':'value_if_true','detail':'当逻辑表达式为TRUE时的返回值。','example':'"A2 is foo"','require':'m','repeat':'n','type':'rangeall'},{'name':'value_if_false','detail':'[可选 - 默认为空白] - 当逻辑表达式等于FALSE时的函数返回值。','example':'"A2 was false"','require':'o','repeat':'n','type':'rangeall'}]},{'n':'OR','t':10,'d':'只要有一个参数的计算结果为 TRUE 时，返回 TRUE；所有参数的计算结果为 FALSE，即返回 FALSE。','a':'只要有一个参数的计算结果为 TRUE 时，返回 TRUE；所有参数的计算结果为 FALSE，即返回 FALSE。','m':[1,255],'p':[{'name':'logical1','detail':'要测试的第一个条件，其计算结果可以为 TRUE 或 FALSE。','example':'A2 = "foo"','require':'m','repeat':'n','type':'rangeall'},{'name':'逻辑表达式2','detail':'[可选] - 其他表达式或对包含表达式的单元格的引用，这些表达式代表某种逻辑值（即TRUE或FALSE）或者可以强制转换为逻辑值。','example':' A3 = "bar"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'NE','t':11,'d':'如果指定的值不相等，则返回“TRUE”；否则返回“FALSE”。相当于“<>”运算符。','a':'如果指定的值不相等，则返回“TRUE”；否则返回“FALSE”。相当于“<>”运算符。','m':[2,2],'p':[{'name':'value1','detail':'第一个值。','example':'A2','require':'m','repeat':'n','type':'rangeall'},{'name':'value2','detail':'要检查是否与 value1 不相等的值。','example':'A3','require':'m','repeat':'n','type':'rangeall'}]},{'n':'EQ','t':11,'d':'如果指定的值相等，则返回“TRUE”；否则返回“FALSE”。相当于“=”运算符。','a':'如果指定的值相等，则返回“TRUE”；否则返回“FALSE”。相当于“=”运算符。','m':[2,2],'p':[{'name':'value1','detail':'第一个值。','example':'A2','require':'m','repeat':'n','type':'rangeall'},{'name':'value2','detail':'要检查是否与 value1 相等的值。','example':'A3','require':'m','repeat':'n','type':'rangeall'}]},{'n':'GT','t':11,'d':'如果第一个参数严格大于第二个，则返回 TRUE；否则返回 FALSE。相当于“>”运算符。','a':'如果第一个参数严格大于第二个，则返回 TRUE；否则返回 FALSE。相当于“>”运算符。','m':[2,2],'p':[{'name':'value1','detail':'要测试其是否大于 value2 的值。','example':'A2','require':'m','repeat':'n','type':'rangeall'},{'name':'value2','detail':'第二个值。','example':'A3','require':'m','repeat':'n','type':'rangeall'}]},{'n':'GTE','t':11,'d':'如果第一个参数大于或等于第二个，则返回 TRUE；否则返回 FALSE。相当于“>=”运算符。','a':'如果第一个参数大于或等于第二个，则返回 TRUE；否则返回 FALSE。相当于“>=”运算符。','m':[2,2],'p':[{'name':'value1','detail':'要测试其是否大于等于 value2 的值。','example':'A2','require':'m','repeat':'n','type':'rangeall'},{'name':'value2','detail':'第二个值。','example':'A3','require':'m','repeat':'n','type':'rangeall'}]},{'n':'LT','t':11,'d':'如果第一个参数严格小于第二个，则返回 TRUE；否则返回 FALSE。相当于“<”运算符。','a':'如果第一个参数严格小于第二个，则返回 TRUE；否则返回 FALSE。相当于“<”运算符。','m':[2,2],'p':[{'name':'value1','detail':'要测试其是否小于 value2 的值。','example':'A2','require':'m','repeat':'n','type':'rangeall'},{'name':'value2','detail':'第二个值。','example':'A3','require':'m','repeat':'n','type':'rangeall'}]},{'n':'LTE','t':11,'d':'如果第一个参数小于或等于第二个，则返回 TRUE；否则返回 FALSE。相当于“<=”运算符。','a':'如果第一个参数小于或等于第二个，则返回 TRUE；否则返回 FALSE。相当于“<=”运算符。','m':[2,2],'p':[{'name':'value1','detail':'要测试其是否小于等于 value2 的值。','example':'A2','require':'m','repeat':'n','type':'rangeall'},{'name':'value2','detail':'第二个值。','example':'A3','require':'m','repeat':'n','type':'rangeall'}]},{'n':'ADD','t':11,'d':'返回两个数值之和。相当于 `+` 运算符。','a':'返回两个数值之和。相当于 `+` 运算符。','m':[2,2],'p':[{'name':'value1','detail':'第一个加数。','example':'A2','require':'m','repeat':'n','type':'rangenumber'},{'name':'value2','detail':'第二个加数。','example':'A3','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'MINUS','t':11,'d':'返回两个数值之差。相当于“-”运算符。','a':'返回两个数值之差。相当于“-”运算符。','m':[2,2],'p':[{'name':'value1','detail':'被减数，即要对其计减的数值。','example':'A2','require':'m','repeat':'n','type':'rangenumber'},{'name':'value2','detail':'减数，即要从 value1 中减除的数值。','example':'A3','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'MULTIPLY','t':11,'d':'返回两个数的乘积。相当于“*”运算符。','a':'返回两个数的乘积。相当于“*”运算符。','m':[2,2],'p':[{'name':'value1','detail':'第一个乘数。','example':'A2','require':'m','repeat':'n','type':'rangenumber'},{'name':'value2','detail':'第二个乘数。','example':'B2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'DIVIDE','t':11,'d':'返回两个参数相除所得的结果。相当于 `/` 运算符。','a':'返回两个参数相除所得的结果。相当于 `/` 运算符。','m':[2,2],'p':[{'name':'value1','detail':'要被除的数值。','example':'4','require':'m','repeat':'n','type':'rangenumber'},{'name':'value2','detail':'用于除其他数的数值。\n\n除数不得为0。','example':'2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'CONCAT','t':11,'d':'返回两个值的串联。相当于 `&` 运算符。','a':'返回两个值的串联。相当于 `&` 运算符。','m':[2,2],'p':[{'name':'value1','detail':'value2 将附于其后的值。','example':'"de"','require':'m','repeat':'n','type':'rangeall'},{'name':'value2','detail':'要附于 value1 之后的值。','example':'"mystify"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'UNARY_PERCENT','t':11,'d':'返回按百分比解释的数值。例如，“UNARY_PERCENT(100)”等于1。','a':'返回按百分比解释的数值。例如，“UNARY_PERCENT(100)”等于1。','m':[1,1],'p':[{'name':'number','detail':'要作为百分比解释的数值。','example':'A2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'CONCATENATE','t':12,'d':'将两个或多个文本字符串联接为一个字符串。','a':'将两个或多个文本字符串联接为一个字符串。','m':[1,255],'p':[{'name':'text1','detail':'初始字符串。','example':'"Super"','require':'m','repeat':'n','type':'rangeall'},{'name':'text2 ...','detail':'[可选] - 要按顺序连接在一起的其他字符串。','example':'"calla"','require':'o','repeat':'y','type':'rangeall'}]},{'n':'CODE','t':12,'d':'返回所提供的字符串中首字符的 Unicode 映射值。','a':'返回所提供的字符串中首字符的 Unicode 映射值。','m':[1,1],'p':[{'name':'text','detail':'要返回其首字符的Unicode映射值的字符串。','example':'"a"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'CHAR','t':12,'d':'按照当前 Unicode 编码表，将数字转换为对应的字符。','a':'按照当前 Unicode 编码表，将数字转换为对应的字符。','m':[1,1],'p':[{'name':'number','detail':'介于 1 到 255 之间的数字。','example':'97','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'ARABIC','t':12,'d':'将罗马数字转换为阿拉伯数字。','a':'将罗马数字转换为阿拉伯数字。','m':[1,1],'p':[{'name':'text','detail':'要转换格式的罗马数字','example':'"XIV"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'ROMAN','t':12,'d':'将数字格式设置为罗马数字形式。','a':'将数字格式设置为罗马数字形式。','m':[1,1],'p':[{'name':'number','detail':'要设置格式的数字，介于1到3999之间（包括这两个数字）。','example':'499','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'REGEXEXTRACT','t':12,'d':'按照正则表达式提取匹配的子串。','a':'按照正则表达式提取匹配的子串。','m':[2,2],'p':[{'name':'text','detail':'输入文本。','example':'"Needle in a haystack"','require':'m','repeat':'n','type':'rangeall'},{'name':'regular_expression','detail':'此函数将返回文本中符合此表达式的第一个子串。','example':'".e{2}dle"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'REGEXMATCH','t':12,'d':'判断一段文本是否与正则表达式相匹配。','a':'判断一段文本是否与正则表达式相匹配。','m':[2,2],'p':[{'name':'text','detail':'要用正则表达式测试的文本。','example':'"Spreadsheets"','require':'m','repeat':'n','type':'rangeall'},{'name':'regular_expression','detail':'用来测试文本的正则表达式。','example':'"S.r"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'REGEXREPLACE','t':12,'d':'使用正则表达式将文本字符串中的一部分替换为其他文本字符串。','a':'使用正则表达式将文本字符串中的一部分替换为其他文本字符串。','m':[3,3],'p':[{'name':'text','detail':'要对其局部进行替换操作的文本。','example':'"Spreadsheets"','require':'m','repeat':'n','type':'rangeall'},{'name':'regular_expression','detail':'正则表达式。 text 中所有匹配的实例都将被替换。','example':'"S.*d"','require':'m','repeat':'n','type':'rangeall'},{'name':'replacement','detail':'要插入到原有文本中的文本。','example':'"Bed"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'T','t':12,'d':'返回文本格式的字符串参数。','a':'返回文本格式的字符串参数。','m':[1,1],'p':[{'name':'value','detail':'要转换为文本的参数。\n\n如果值为文本，T将返回值本身。\n\n如果值为指向包含文本的单元格的引用，T将返回值中的内容。\n\n如果值为错误值或包含错误值的单元格，T将返回该错误值。\n\n对于所有其他情况，T将返回空串。','example':'A2','require':'m','repeat':'n','type':'rangeall'}]},{'n':'FIXED','t':12,'d':'以固定的小数位数设置数字的格式。','a':'以固定的小数位数设置数字的格式。','m':[1,3],'p':[{'name':'number','detail':'要进行舍入并转换为文本的数字。','example':'3.141592653','require':'m','repeat':'n','type':'rangenumber'},{'name':'decimals','detail':'[可选 - 默认值为2] - 结果中要显示的小数位数。\n\n如果数值的有效位数小于小数位数，将以零填充。如果数值的有效位数大于小数位数，则将其舍入到所需的小数位数而不是将其截断。','example':'2','require':'o','repeat':'n','type':'rangenumber'},{'name':'no_commas','detail':'[可选 - 默认值为FALSE()] - 一个逻辑值，如果为 TRUE()，则会禁止 FIXED 在返回的文本中包含逗号。','example':'FALSE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'FIND','t':12,'d':'返回字符串在文本中首次出现的位置（区分大小写）。','a':'返回字符串在文本中首次出现的位置（区分大小写）。','m':[2,3],'p':[{'name':'find_text','detail':'要在要搜索的文本中查找的字符串。','example':'"n"','require':'m','repeat':'n','type':'rangeall'},{'name':'within_text','detail':'要在其中搜索搜索字符串的首次出现位置的文本。','example':'A2','require':'m','repeat':'n','type':'rangeall'},{'name':'start_num','detail':'[可选 - 默认值为1] - 要在要搜索的文本中开始搜索的字符位置。','example':'14','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'FINDB','t':12,'d':'返回某个字符串在文本中首次出现的位置（每个双字节字符占两个位置）。','a':'返回某个字符串在文本中首次出现的位置（每个双字节字符占两个位置）。','m':[2,3],'p':[{'name':'find_text','detail':'要在要搜索的文本中查找的字符串。','example':'"新"','require':'m','repeat':'n','type':'rangeall'},{'name':'within_text','detail':'要在其中搜索搜索字符串的首次出现位置的文本。','example':'"农历新年"','require':'m','repeat':'n','type':'rangeall'},{'name':'start_num','detail':'[可选 - 默认值为 1] - 要在要搜索的文本中开始搜索的字符位置。','example':'2','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'JOIN','t':12,'d':'将一个或多个使用指定定界符的一维数组的元素连接到一起。','a':'将一个或多个使用指定定界符的一维数组的元素连接到一起。','m':[2,255],'p':[{'name':'separator','detail':'置于相互连接的值之间的字符或字符串。\n\n定界符可以为空，例如JOIN(,{1,2,3})。','example':'" and-a "','require':'m','repeat':'n','type':'rangeall'},{'name':'array1','detail':'要使用定界符连接的一个或多个值。','example':'{1','require':'m','repeat':'n','type':'rangeall'},{'name':'array2, ...','detail':'[可选] - 要使用定界符连接的其他值或数组。','example':'2','require':'o','repeat':'y','type':'rangeall'}]},{'n':'LEFT','t':12,'d':'从文本字符串的第一个字符开始返回指定个数的字符。','a':'从文本字符串的第一个字符开始返回指定个数的字符。','m':[1,2],'p':[{'name':'text','detail':'包含要提取的字符的文本字符串。','example':'A2','require':'m','repeat':'n','type':'rangeall'},{'name':'num_chars','detail':'[可选 - 默认值为1] - 指定要由 LEFT 提取的字符的数量。','example':'2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'RIGHT','t':12,'d':'根据所指定的字符数返回文本字符串中最后一个或多个字符。','a':'根据所指定的字符数返回文本字符串中最后一个或多个字符。','m':[1,2],'p':[{'name':'text','detail':'包含要提取的字符的文本字符串。','example':'A2','require':'m','repeat':'n','type':'rangeall'},{'name':'num_chars','detail':'[可选 - 默认值为1] - 指定要由 RIGHT 提取的字符的数量。','example':'2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'MID','t':12,'d':'返回文本字符串中从指定位置开始的特定数目的字符。','a':'返回文本字符串中从指定位置开始的特定数目的字符。','m':[3,3],'p':[{'name':'text','detail':'包含要提取的字符的文本字符串。','example':'"get this"','require':'m','repeat':'n','type':'rangeall'},{'name':'start_num','detail':'要从字符串中开始提取的位置。字符串中第一个字符的索引为1。','example':'5','require':'m','repeat':'n','type':'rangenumber'},{'name':'num_chars','detail':'指定要由 MID 提取的字符的数量。\n\n如果提取的字符数尚不足提取长度个字符时就到达了字符串尾部，则MID返回从开始位置到字符串尾部的字符。','example':'4','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'LEN','t':12,'d':'返回给定字符串的长度。','a':'返回给定字符串的长度。','m':[1,1],'p':[{'name':'text','detail':'要返回其长度的字符串。','example':'A2','require':'m','repeat':'n','type':'rangeall'}]},{'n':'LENB','t':12,'d':'返回文本中所包含的字符数。与双字节字符集(DBCS)一起使用。','a':'返回文本中所包含的字符数。与双字节字符集(DBCS)一起使用。','m':[1,1],'p':[{'name':'text','detail':'要返回其字节数的字符串。（一个汉字为两个字节数）','example':'A2','require':'m','repeat':'n','type':'rangeall'}]},{'n':'LOWER','t':12,'d':'将指定字符串中的字母转换为小写。','a':'将指定字符串中的字母转换为小写。','m':[1,1],'p':[{'name':'text','detail':'要转换为小写的字符串。','example':'"LOREM IPSUM"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'UPPER','t':12,'d':'将指定字符串中的字母转换为大写。','a':'将指定字符串中的字母转换为大写。','m':[1,1],'p':[{'name':'text','detail':'要转换为大写的字符串。','example':'"lorem ipsum"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'EXACT','t':12,'d':'比较两个字符串是否相同。','a':'比较两个字符串是否相同。','m':[2,2],'p':[{'name':'text1','detail':'要比较的第一个字符串。','example':'A1','require':'m','repeat':'n','type':'rangeall'},{'name':'text2','detail':'要比较的第二个字符串。','example':'A2','require':'m','repeat':'n','type':'rangeall'}]},{'n':'REPLACE','t':12,'d':'将文本字符串的一部分替换为其他文本字符串。','a':'将文本字符串的一部分替换为其他文本字符串。','m':[4,4],'p':[{'name':'old_text','detail':'要对其局部进行替换操作的文本。','example':'"Spreadsheets"','require':'m','repeat':'n','type':'rangeall'},{'name':'start_num','detail':'开始进行替换操作的位置（文本开头位置为 1）。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'num_chars','detail':'要在文本中替换的字符个数。','example':'6','require':'m','repeat':'n','type':'rangenumber'},{'name':'new_text','detail':'要插入到原有文本中的文本。','example':'"Bed"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'REPT','t':12,'d':'返回指定文本的多次重复。','a':'返回指定文本的多次重复。','m':[2,2],'p':[{'name':'text','detail':'要重复的字符或字符串。','example':'"ha"','require':'m','repeat':'n','type':'rangeall'},{'name':'number_times','detail':'要重复的文本要在返回值中出现的次数。\n\n最大重复次数为100。即使重复次数大于100，REPT也仅将相应文本重复100次。','example':'4','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SEARCH','t':12,'d':'返回字符串在文本中首次出现的位置（不区分大小写）。','a':'返回字符串在文本中首次出现的位置（不区分大小写）。','m':[2,3],'p':[{'name':'find_text','detail':'要在要搜索的文本中查找的字符串。','example':'"n"','require':'m','repeat':'n','type':'rangeall'},{'name':'within_text','detail':'要在其中搜索搜索字符串的首次出现位置的文本。','example':'A2','require':'m','repeat':'n','type':'rangeall'},{'name':'start_num','detail':'[ 可选 - 默认值为1 ] - 要在要搜索的文本中开始搜索的字符位置。','example':'14','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SUBSTITUTE','t':12,'d':'在文本字符串中用 new_text 替换 old_text。','a':'在文本字符串中用 new_text 替换 old_text。','m':[3,4],'p':[{'name':'text','detail':'需要替换其中字符的文本，或对含有文本（需要替换其中字符）的单元格的引用。','example':'"search for it"','require':'m','repeat':'n','type':'rangeall'},{'name':'old_text','detail':'需要替换的文本。','example':'"search for"','require':'m','repeat':'n','type':'rangeall'},{'name':'new_text','detail':'用于替换 old_text 的文本。','example':'"Google"','require':'m','repeat':'n','type':'rangeall'},{'name':'instance_num','detail':'[ 可选 ] - 指定要用 new_text 替换 old_text 的事件。 如果指定了 instance_num，则只有满足要求的 old_text 被替换。 否则，文本中出现的所有 old_text 都会更改为 new_text。','example':'3','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'CLEAN','t':12,'d':'移除文本中的不可打印 ASCII 字符后将其返回。','a':'移除文本中的不可打印 ASCII 字符后将其返回。','m':[1,1],'p':[{'name':'text','detail':'要移除其中不可打印字符的文本。','example':'"AF"&CHAR(31)','require':'m','repeat':'n','type':'rangeall'}]},{'n':'TEXT','t':12,'d':'按照指定格式将数字转换为文本。','a':'按照指定格式将数字转换为文本。','m':[2,2],'p':[{'name':'value','detail':'要设置格式的数字、日期或时间。','example':'1.23','require':'m','repeat':'n','type':'rangenumber'},{'name':'format_text','detail':'以括号括起来的模式串，将按该模式设置数字的格式。\n\n0表示在数值位数少于格式指定的位数时必定以零填充。例如，TEXT(12.3,"000.00")将返回012.30。当数值的小数位数超过模式指定的小数位数时，四舍五入为指定的小数位数。例如，TEXT(12.305,"00.00")将返回12.31。\n\n#类似于0，但并不是在小数点的两侧都以零填充。例如，TEXT(12.3,"###.##")将返回12.3。','example':'"$0.00"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'TRIM','t':12,'d':'删除指定字符串前后的空格。','a':'删除指定字符串前后的空格。','m':[1,1],'p':[{'name':'text','detail':'要修剪的字符串或指向包含该字符串的单元格的引用。','example':'" lorem ipsum"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'VALUE','t':12,'d':'将可识别的任何日期、时间或数字格式的字符串转换为数字。','a':'将可识别的任何日期、时间或数字格式的字符串转换为数字。','m':[1,1],'p':[{'name':'text','detail':'包含要转换的值的字符串。','example':'"123"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'PROPER','t':12,'d':'将指定字符串中每个单词的首字母转为大写。','a':'将指定字符串中每个单词的首字母转为大写。','m':[1,1],'p':[{'name':'text','detail':'要转换的文本，其中每个单词的首字母都将转为大写，所有其他字母则转为小写。','example':'"united states"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'CONVERT','t':13,'d':'将数字从一种度量系统转换为另一种度量系统。','a':'将数字从一种度量系统转换为另一种度量系统。','m':[3,3],'p':[{'name':'number','detail':'是以 from_unit 为单位的需要进行转换的数值。','example':'5.1','require':'m','repeat':'n','type':'rangenumber'},{'name':'from_unit','detail':'是数值的单位。','example':'"g"','require':'m','repeat':'n','type':'rangeall'},{'name':'to_unit','detail':'是结果的单位。','example':'"kg"','require':'m','repeat':'n','type':'rangeall'}]},{'n':'SUMX2MY2','t':14,'d':'返回两数组中对应数值的平方差之和。','a':'返回两数组中对应数值的平方差之和。','m':[2,2],'p':[{'name':'array_x','detail':'第一个数组或数值区域。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'array_y','detail':'第二个数组或数值区域。','example':'B2:B100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SUMX2PY2','t':14,'d':'返回两数组中对应数值的平方和之和。','a':'返回两数组中对应数值的平方和之和。','m':[2,2],'p':[{'name':'array_x','detail':'第一个数组或数值区域。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'array_y','detail':'第二个数组或数值区域。','example':'B2:B100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SUMXMY2','t':14,'d':'返回两数组中对应数值之差的平方和。','a':'返回两数组中对应数值之差的平方和。','m':[2,2],'p':[{'name':'array_x','detail':'第一个数组或数值区域。','example':'A2:A100','require':'m','repeat':'n','type':'rangenumber'},{'name':'array_y','detail':'第二个数组或数值区域。','example':'B2:B100','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'TRANSPOSE','t':14,'d':'将数组或单元格范围的行列转置。','a':'将数组或单元格范围的行列转置。','m':[1,1],'p':[{'name':'array','detail':'要将其行列互换的数组或范围。','example':'{1,2}','require':'m','repeat':'n','type':'range'}]},{'n':'TREND','t':14,'d':'返回线性趋势值。','a':'返回线性趋势值。','m':[1,4],'p':[{'name':'known_y','detail':'关系表达式 y = mx + b 中已知的 y 值集合。\n\n如果 known_y 为二维数组或范围，则 known_x 的维数必须与之相同，或者省略此参数。\n\n如果 known_y 为一维数组或范围，known_x 则可代表二维数组或范围中的多个自变量。也就是说，如果 known_y 为单行，则将 known_x 中的每行解释为各自独立的值，类似情况也适用于 known_y 为单列的情况。','example':'B2:B10','require':'m','repeat':'n','type':'rangenumber'},{'name':'known_x','detail':'[可选 - 默认该数组为{1,2,3,...},其大小与 known_y 相同] - 关系表达式 y = mx + b 中已知的可选 x 值集合。\n\n如果 known_y 为一维数组或范围，known_x 则可代表二维数组或范围中的多个自变量。也就是说，如果 known_y 为单行，则将 known_x 中的每行解释为各自独立的值，类似情况也适用于 known_y 为单列的情况。','example':'A2:A10','require':'o','repeat':'n','type':'rangenumber'},{'name':'new_x','detail':'[可选 - 默认与 known_x 相同] -  需要函数 TREND 返回对应 y 值的新 x 值。','example':'A11:A13','require':'o','repeat':'n','type':'rangenumber'},{'name':'const','detail':'[可选 - 默认值为TRUE()] - 一个逻辑值，用于指定是否将常量 b 强制设为 0。\n\nTRUE() 表示 b 将按正常计算；\n\nFALSE() 表示 b 将被设为 0（零），m 将被调整以使 y = mx。','example':'TRUE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'FREQUENCY','t':14,'d':'计算数值在某个区域内的出现频率，然后返回一个垂直数组。','a':'计算数值在某个区域内的出现频率，然后返回一个垂直数组。','m':[2,2],'p':[{'name':'data_array','detail':'要对其频率进行计数的一组数值或对这组数值的引用。','example':'A2:A40','require':'m','repeat':'n','type':'rangenumber'},{'name':'bins_array','detail':'要将 data_array 中的值插入到的间隔数组或对间隔的引用。\n\n为清晰起见，应将类别排序，但如果未排序，FREQUENCY会在内部对这些指定的值进行排序并返回正确结果。','example':'B2:B5','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'GROWTH','t':14,'d':'使用现有数据计算预测的指数等比。','a':'使用现有数据计算预测的指数等比。','m':[1,4],'p':[{'name':'known_y','detail':'关系表达式 y = b*m^x 中已知的 y 值集合。\n\n如果已知数据_y为二维数组或范围，则已知数据_x的维数必须与之相同，或者省略此参数。\n\n如果已知数据_y为一维数组或范围，已知数据_x则可代表二维数组或范围中的多个自变量。也就是说，如果已知数据_y为单行，则将已知数据_x中的每行解释为各自独立的值，类似情况也适用于已知数据_y为单列的情况。','example':'B2:B10','require':'m','repeat':'n','type':'rangenumber'},{'name':'known_x','detail':'[可选 - 默认该数组为{1,2,3,...},其大小与 known_y 相同] - 关系表达式 y = b*m^x 中已知的可选 x 值集合。\n\n如果已知数据_y为一维数组或范围，已知数据_x则可代表二维数组或范围中的多个自变量。也就是说，如果已知数据_y为单行，则将已知数据_x中的每行解释为各自独立的值，类似情况也适用于已知数据_y为单列的情况。','example':'A2:A10','require':'o','repeat':'n','type':'rangenumber'},{'name':'new_x','detail':'[可选 - 默认与 known_x 相同] - 需要函数 GROWTH 返回对应 y 值的新 x 值。','example':'A11:A13','require':'o','repeat':'n','type':'rangenumber'},{'name':'const','detail':'[可选 - 默认值为TRUE()] -一个逻辑值，用于指定是否将常量 b 强制设为 1。\n\nTRUE() 表示 b 将按正常计算；\n\nFALSE() 表示 b 将被设为 1，m 将被调整以使 y = m^x。','example':'TRUE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'LINEST','t':14,'d':'可通过使用最小二乘法计算与现有数据最佳拟合的直线，来计算某直线的统计值，然后返回描述此直线的数组。','a':'可通过使用最小二乘法计算与现有数据最佳拟合的直线，来计算某直线的统计值，然后返回描述此直线的数组。','m':[1,4],'p':[{'name':'known_y','detail':'关系表达式 y = mx + b 中已知的 y 值集合。\n\n如果 known_y 为二维数组或范围，则 known_x 的维数必须与之相同，或者省略此参数。\n\n如果 known_y 为一维数组或范围，known_x 则可代表二维数组或范围中的多个自变量。也就是说，如果 known_y 为单行，则将 known_x 中的每行解释为各自独立的值，类似情况也适用于 known_y 为单列的情况。','example':'B2:B10','require':'m','repeat':'n','type':'rangenumber'},{'name':'known_x','detail':'[可选 - 默认该数组为{1,2,3,...},其大小与 known_y 相同] - 关系表达式 y = mx + b 中已知的可选 x 值集合。\n\n如果 known_y 为一维数组或范围，known_x 则可代表二维数组或范围中的多个自变量。也就是说，如果 known_y 为单行，则将 known_x 中的每行解释为各自独立的值，类似情况也适用于 known_y 为单列的情况。','example':'A2:A10','require':'o','repeat':'n','type':'rangenumber'},{'name':'const','detail':'[可选 - 默认值为TRUE()] - 一个逻辑值，用于指定是否将常量 b 强制设为 0。\n\nTRUE() 表示 b 将按正常计算；\n\nFALSE() 表示 b 将被设为 0（零），m 将被调整以使 y = mx。','example':'TRUE()','require':'o','repeat':'n','type':'rangeall'},{'name':'stats','detail':'[可选 - 默认值为FALSE()] - 一个逻辑值，用于指定是否返回附加回归统计值。\n\n如果详细为TRUE，除了对应于每个自变量的一组线性系数和y截距之外，LINEST还返回以下信息：\n\n每项系数和截距的标准误差、\n\n限定系数（介于0和1之间，1表示完全相关）、\n\n因变量值的标准误差、\n\nF统计或F观测值，指示所观测到的因变量和自变量变量之间的关系是随机的还是线性的、\n\n自由度，用于在参照表中查找F统计值以估算可信度、\n\n回归平方和，以及\n\n残差平方和。','example':'TRUE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'LOGEST','t':14,'d':'在回归分析中，计算最符合数据的指数回归拟合曲线，并返回描述该曲线的数值数组。','a':'在回归分析中，计算最符合数据的指数回归拟合曲线，并返回描述该曲线的数值数组。','m':[1,4],'p':[{'name':'known_y','detail':'关系表达式 y = mx + b 中已知的 y 值集合。\n\n如果 known_y 为二维数组或范围，则 known_x 的维数必须与之相同，或者省略此参数。\n\n如果 known_y 为一维数组或范围，known_x 则可代表二维数组或范围中的多个自变量。也就是说，如果 known_y 为单行，则将 known_x 中的每行解释为各自独立的值，类似情况也适用于 known_y 为单列的情况。','example':'B2:B10','require':'m','repeat':'n','type':'rangenumber'},{'name':'known_x','detail':'[可选 - 默认该数组为{1,2,3,...},其大小与 known_y 相同] - 关系表达式 y = mx + b 中已知的可选 x 值集合。\n\n如果 known_y 为一维数组或范围，known_x 则可代表二维数组或范围中的多个自变量。也就是说，如果 known_y 为单行，则将 known_x 中的每行解释为各自独立的值，类似情况也适用于 known_y 为单列的情况。','example':'A2:A10','require':'o','repeat':'n','type':'rangenumber'},{'name':'const','detail':'[可选 - 默认值为TRUE()] - 一个逻辑值，用于指定是否将常量 b 强制设为 0。\n\nTRUE() 表示 b 将按正常计算；\n\nFALSE() 表示 b 将被设为 0（零），m 将被调整以使 y = mx。','example':'TRUE()','require':'o','repeat':'n','type':'rangeall'},{'name':'stats','detail':'[可选 - 默认值为FALSE()] - 一个逻辑值，用于指定是否返回附加回归统计值。\n\n如果详细为TRUE，则除了为每个自变量和系数 b 返回一组指数值之外，LOGEST 还将返回以下数据：\n\n每项指数和系数的标准误差、\n\n限定系数（介于 0 和 1 之间，1 表示完全相关）、\n\n因变量值的标准误差、\n\nF 统计或 F 观测值，指示所观测到的因变量和自变量之间的关系是随机的还是指数的、\n\n自由度 - 用于在参照表中查找 F 统计值以估算可信度、\n\n回归平方和，以及\n\n残差平方和。','example':'TRUE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'MDETERM','t':14,'d':'返回一个数组的矩阵行列式的值。','a':'返回一个数组的矩阵行列式的值。','m':[1,1],'p':[{'name':'array','detail':'行数和列数相等的数值数组。','example':'A1:D4','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'MINVERSE','t':14,'d':'返回数组中存储的矩阵的逆矩阵。','a':'返回数组中存储的矩阵的逆矩阵。','m':[1,1],'p':[{'name':'array','detail':'行数和列数相等的数值数组。','example':'A1:D4','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'MMULT','t':14,'d':'返回两个数组的矩阵乘积。结果矩阵的行数与 array1 的行数相同，矩阵的列数与 array2 的列数相同。','a':'返回两个数组的矩阵乘积。结果矩阵的行数与 array1 的行数相同，矩阵的列数与 array2 的列数相同。','m':[2,2],'p':[{'name':'array1','detail':'要进行矩阵乘法运算的第一个矩阵数组。\n\narray1 列数必须与 array2 的行数相同','example':'A1:B3','require':'m','repeat':'n','type':'rangenumber'},{'name':'array2','detail':'要进行矩阵乘法运算的第二个矩阵数组。\n\narray2 的行数必须与 array1 列数相同','example':'C1:F2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'SUMPRODUCT','t':14,'d':'在给定的几组数组中，将数组间对应的元素相乘，并返回乘积之和。','a':'在给定的几组数组中，将数组间对应的元素相乘，并返回乘积之和。','m':[1,255],'p':[{'name':'array1','detail':'其相应元素需要进行相乘并求和的第一个数组参数。','example':'A2:C5','require':'m','repeat':'n','type':'rangenumber'},{'name':'array2','detail':'[可选] - 其相应元素需要进行相乘并求和的其它数组参数。','example':'D2:F5','require':'o','repeat':'y','type':'rangenumber'}]},{'n':'ISFORMULA','t':15,'d':'检查公式是否位于引用的单元格中。','a':'检查公式是否位于引用的单元格中。','m':[1,1],'p':[{'name':'cell','detail':'要检查是否存在公式的单元格。\n\n如果 cell 为包含公式的单元格，则 ISFORMULA 将返回 TRUE。如果 cell 为相应单元格范围，则当该范围内的首个单元格包含公式时，系统会返回 TRUE。如果是任何其他值，系统都将返回 FALSE。','example':'A2','require':'m','repeat':'n','type':'range'}]},{'n':'CELL','t':15,'d':'返回有关单元格的格式、位置或内容的信息。','a':'返回有关单元格的格式、位置或内容的信息。','m':[2,2],'p':[{'name':'info_type','detail':'一个文本值，指定要返回的单元格信息的类型。','example':'"type"','require':'m','repeat':'n','type':'rangeall'},{'name':'reference','detail':'需要其相关信息的单元格。','example':'C2','require':'m','repeat':'n','type':'range'}]},{'n':'NA','t':15,'d':'返回错误值 #N/A。','a':'返回错误值 #N/A。','m':[0,0],'p':[]},{'n':'ERROR_TYPE','t':15,'d':'返回与其他单元格中的错误值相对应的数字。','a':'返回与其他单元格中的错误值相对应的数字。','m':[1,1],'p':[{'name':'error_val','detail':'用于查找错误号的单元格，虽然您也可以直接提供错误值。','example':'A3','require':'m','repeat':'n','type':'rangeall'}]},{'n':'ISBLANK','t':15,'d':'检查所引用的单元格是否为空。','a':'检查所引用的单元格是否为空。','m':[1,1],'p':[{'name':'value','detail':'对要检查其是否为空的单元格的引用。\n\n如果是空单元格，则 TRUE；否则返回 FALSE。','example':'A2','require':'m','repeat':'n','type':'range'}]},{'n':'ISERR','t':15,'d':'检查某个值是否为 #N/A 以外的错误值。','a':'检查某个值是否为 #N/A 以外的错误值。','m':[1,1],'p':[{'name':'value','detail':'要验证其是否为#N/A以外的错误类型的值。\n\n如果值是除#N/A之外的任何错误（包括#DIV/0!、#NAME?、#NULL!、#NUM!、#VALUE!和#REF!），ISERR将返回TRUE。','example':'A2','require':'m','repeat':'n','type':'rangeall'}]},{'n':'ISERROR','t':15,'d':'检查某个值是否为错误值。','a':'检查某个值是否为错误值。','m':[1,1],'p':[{'name':'value','detail':'要验证其是否为错误类型的值。\n\n只要值是某种错误值（包括#DIV/0!、#N/A、#NAME?、#NULL!、#NUM!、#VALUE!和#REF!），ISERROR就会返回TRUE。','example':'A2','require':'m','repeat':'n','type':'rangeall'}]},{'n':'ISLOGICAL','t':15,'d':'检查某个值是 TRUE 还是 FALSE。','a':'检查某个值是 TRUE 还是 FALSE。','m':[1,1],'p':[{'name':'value','detail':'要验证其为逻辑TRUE还是逻辑FALSE的值。\n\n*如果值为TRUE或FALSE，或为指向值为TRUE或FALSE的单元格的引用，ISLOGICAL将返回TRUE。','example':'A2','require':'m','repeat':'n','type':'rangeall'}]},{'n':'ISNA','t':15,'d':'检查某个值是否为错误值 #N/A。','a':'检查某个值是否为错误值 #N/A。','m':[1,1],'p':[{'name':'value','detail':'要与错误值#N/A进行比较的值。\n\n*如果值为#N/A或指向包含#N/A的单元格的引用，则ISNA将返回TRUE，否则返回FALSE。','example':'A2','require':'m','repeat':'n','type':'rangeall'}]},{'n':'ISNONTEXT','t':15,'d':'检查某个值是否为非文本。','a':'检查某个值是否为非文本。','m':[1,1],'p':[{'name':'value','detail':'要检查的文本。\n\n*如果参数为文本值或指向包含文本的单元格的引用，ISNONTEXT将返回FALSE，否则返回TRUE。\n\n当值为指向空单元格的引用时，ISNONTEXT会返回TRUE。\n\n当值为空字符串时，ISNONTEXT将返回FALSE，因为空串被视作文本。','example':'A2','require':'m','repeat':'n','type':'rangeall'}]},{'n':'ISNUMBER','t':15,'d':'检查某个值是否为数字。','a':'检查某个值是否为数字。','m':[1,1],'p':[{'name':'value','detail':'要验证其是否为数字的值。\n\n*如果参数为数字或指向内容为数字值的单元格的引用，ISNUMBER将返回TRUE，否则返回FALSE。','example':'A2','require':'m','repeat':'n','type':'rangeall'}]},{'n':'ISREF','t':15,'d':'检查某个值是否为有效的单元格引用。','a':'检查某个值是否为有效的单元格引用。','m':[1,1],'p':[{'name':'value','detail':'要验证其是否为单元格引用的值。\n\n*如果参数是有效的单元格引用，ISREF将返回TRUE，否则返回FALSE。','example':'A2','require':'m','repeat':'n','type':'range'}]},{'n':'ISTEXT','t':15,'d':'检查某个值是否为文本。','a':'检查某个值是否为文本。','m':[1,1],'p':[{'name':'value','detail':'要验证其是否为文本的值。\n\n如果参数为文本值或指向包含文本值的单元格的引用，ISTEXT将返回TRUE，否则返回FALSE。','example':'A2','require':'m','repeat':'n','type':'rangeall'}]},{'n':'TYPE','t':15,'d':'返回数值的类型。','a':'返回数值的类型。','m':[1,1],'p':[{'name':'value','detail':'要确定其类型的数据。\n\n数字 返回 1;\n\n文本 返回 2;\n\n逻辑值 返回 4;\n\n错误值 返回 16;\n\n数组 返回 64;','example':'C4','require':'m','repeat':'n','type':'rangeall'}]},{'n':'N','t':15,'d':'返回转化为数值后的值。','a':'返回转化为数值后的值。','m':[1,1],'p':[{'name':'value','detail':'要转换为数字的参数。\n\n如果值为数字，则返回该数字。\n\n如果值为日期，则返回该日期的序列号。\n\n如果值为TRUE，则返回1。\n\n如果值为FALSE，则返回0。\n\n如果值为错误值，则返回错误值。\n\n如果值为其他值，则返回0。','example':'A2','require':'m','repeat':'n','type':'rangeall'}]},{'n':'TO_DATE','t':16,'d':'将指定的数字转换为日期。','a':'将指定的数字转换为日期。','m':[1,1],'p':[{'name':'value','detail':'要转换为日期的参数或其单元格引用。\n\n如果值为数字或指向内容为数值的单元格的引用，TO_DATE会将值转换为相应的日期并返回，值代表从十二月30日到对应的日期之间的天数，\n\n负值表示对应的日期在十二月30日之前，而小数值则代表一天中从午夜算起的时间。\n如果值不是数字或指向内容为数值的单元格的引用，则TO_DATE将在不做任何修改的情况下返回值。','example':'25405','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'TO_PURE_NUMBER','t':16,'d':'将给定的日期/时间、百分比、货币金额或其他格式的数值转换为不带格式的纯数字。','a':'将给定的日期/时间、百分比、货币金额或其他格式的数值转换为不带格式的纯数字。','m':[1,1],'p':[{'name':'value','detail':'要转换为纯数字的参数或其单元格引用。\n\n如果值为数字或指向包含数值的单元格的引用，TO_PURE_NUMBER将以不带任何格式与解释的形式返回值。\n\n如果值不是数字或指向内容为数值的单元格的引用，则TO_PERCENT将在不做任何修改的情况下返回值。','example':'50%','require':'m','repeat':'n','type':'rangeall'}]},{'n':'TO_TEXT','t':16,'d':'将给定的数字值转换为文本格式。','a':'将给定的数字值转换为文本格式。','m':[1,1],'p':[{'name':'value','detail':'要转换为文本的参数或其单元格引用。\n\n如果值为数字或指向包含数值的单元格的引用，TO_TEXT将返回字符串形式的值，并保持现有格式。即原为货币的仍为货币，原为十进制数的仍为十进制数，原为百分比的仍为百分比，原为日期的仍为日期。\n\n如果值不是数字或指向内容为数值的单元格的引用，则TO_TEXT将在不做任何修改的情况下返回值。','example':'24','require':'m','repeat':'n','type':'rangeall'}]},{'n':'TO_DOLLARS','t':16,'d':'将指定的数字转换为美元金额。','a':'将指定的数字转换为美元金额。','m':[1,1],'p':[{'name':'value','detail':'要转换为美元金额的参数或其单元格引用。\n\n如果值不是数字或指向内容为数值的单元格的引用，则 TO_DOLLARS 将在不做任何修改的情况下返回值。','example':'A2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'TO_PERCENT','t':16,'d':'将指定的数字转换为百分比。','a':'将指定的数字转换为百分比。','m':[1,1],'p':[{'name':'value','detail':'要转换为百分比的参数或其单元格引用。\n\n如果值为数字或指向包含数值的单元格的引用，TO_PERCENT会以1 = 100%为标准，将值转换为百分比。\n\n如果值不是数字或指向内容为数值的单元格的引用，则TO_PERCENT将在不做任何修改的情况下返回值。','example':'A2','require':'m','repeat':'n','type':'rangenumber'}]},{'n':'DGET','t':17,'d':'使用 SQL 式查询，从列表或数据库的列中提取符合指定条件的单个值。','a':'使用 SQL 式查询，从列表或数据库的列中提取符合指定条件的单个值。','m':[3,3],'p':[{'name':'database','detail':'构成列表或数据库的单元格区域，列表的第一行包含每一列的标签。','example':'A2:F20','require':'m','repeat':'n','type':'range'},{'name':'field','detail':'指定 database 中的哪一列包含要提取和用于计算的值。\n\nfield 可以是与 database 第一行中某个列标题对应的文本标签，也可以是指定相关列的数字索引，第一列的索引值为 1。','example':'G2','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria','detail':'包含所指定条件的单元格区域。计算之前将使用这些条件来过滤 database 中的值。','example':'A22:D23','require':'m','repeat':'n','type':'range'}]},{'n':'DMAX','t':17,'d':'使用 SQL 式查询，返回列表或数据库中满足指定条件的记录字段（列）中的最大数字。','a':'使用 SQL 式查询，返回列表或数据库中满足指定条件的记录字段（列）中的最大数字。','m':[3,3],'p':[{'name':'database','detail':'构成列表或数据库的单元格区域，列表的第一行包含每一列的标签。','example':'A2:F20','require':'m','repeat':'n','type':'range'},{'name':'field','detail':'指定 database 中的哪一列包含要提取和用于计算的值。\n\nfield 可以是与 database 第一行中某个列标题对应的文本标签，也可以是指定相关列的数字索引，第一列的索引值为 1。','example':'G2','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria','detail':'包含所指定条件的单元格区域。计算之前将使用这些条件来过滤 database 中的值。','example':'A22:D23','require':'m','repeat':'n','type':'range'}]},{'n':'DMIN','t':17,'d':'使用 SQL 式查询，返回列表或数据库中满足指定条件的记录字段（列）中的最小数字。','a':'使用 SQL 式查询，返回列表或数据库中满足指定条件的记录字段（列）中的最小数字。','m':[3,3],'p':[{'name':'database','detail':'构成列表或数据库的单元格区域，列表的第一行包含每一列的标签。','example':'A2:F20','require':'m','repeat':'n','type':'range'},{'name':'field','detail':'指定 database 中的哪一列包含要提取和用于计算的值。\n\nfield 可以是与 database 第一行中某个列标题对应的文本标签，也可以是指定相关列的数字索引，第一列的索引值为 1。','example':'G2','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria','detail':'包含所指定条件的单元格区域。计算之前将使用这些条件来过滤 database 中的值。','example':'A22:D23','require':'m','repeat':'n','type':'range'}]},{'n':'DAVERAGE','t':17,'d':'使用 SQL 式查询，对列表或数据库中满足指定条件的记录字段（列）中的数值求平均值。','a':'使用 SQL 式查询，对列表或数据库中满足指定条件的记录字段（列）中的数值求平均值。','m':[3,3],'p':[{'name':'database','detail':'构成列表或数据库的单元格区域，列表的第一行包含每一列的标签。','example':'A2:F20','require':'m','repeat':'n','type':'range'},{'name':'field','detail':'指定 database 中的哪一列包含要提取和用于计算的值。\n\nfield 可以是与 database 第一行中某个列标题对应的文本标签，也可以是指定相关列的数字索引，第一列的索引值为 1。','example':'G2','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria','detail':'包含所指定条件的单元格区域。计算之前将使用这些条件来过滤 database 中的值。','example':'A22:D23','require':'m','repeat':'n','type':'range'}]},{'n':'DCOUNT','t':17,'d':'使用 SQL 式查询，返回列表或数据库中满足指定条件的记录字段（列）中包含数字的单元格的个数。','a':'使用 SQL 式查询，返回列表或数据库中满足指定条件的记录字段（列）中包含数字的单元格的个数。','m':[3,3],'p':[{'name':'database','detail':'构成列表或数据库的单元格区域，列表的第一行包含每一列的标签。','example':'A2:F20','require':'m','repeat':'n','type':'range'},{'name':'field','detail':'指定 database 中的哪一列包含要提取和用于计算的值。\n\nfield 可以是与 database 第一行中某个列标题对应的文本标签，也可以是指定相关列的数字索引，第一列的索引值为 1。','example':'G2','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria','detail':'包含所指定条件的单元格区域。计算之前将使用这些条件来过滤 database 中的值。','example':'A22:D23','require':'m','repeat':'n','type':'range'}]},{'n':'DCOUNTA','t':17,'d':'使用 SQL 式查询，返回列表或数据库中满足指定条件的记录字段（列）中的非空单元格的个数。','a':'使用 SQL 式查询，返回列表或数据库中满足指定条件的记录字段（列）中的非空单元格的个数。','m':[3,3],'p':[{'name':'database','detail':'构成列表或数据库的单元格区域，列表的第一行包含每一列的标签。','example':'A2:F20','require':'m','repeat':'n','type':'range'},{'name':'field','detail':'指定 database 中的哪一列包含要提取和用于计算的值。\n\nfield 可以是与 database 第一行中某个列标题对应的文本标签，也可以是指定相关列的数字索引，第一列的索引值为 1。','example':'G2','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria','detail':'包含所指定条件的单元格区域。计算之前将使用这些条件来过滤 database 中的值。','example':'A22:D23','require':'m','repeat':'n','type':'range'}]},{'n':'DPRODUCT','t':17,'d':'使用 SQL 式查询，返回列表或数据库中满足指定条件的记录字段（列）中的数值的乘积。','a':'使用 SQL 式查询，返回列表或数据库中满足指定条件的记录字段（列）中的数值的乘积。','m':[3,3],'p':[{'name':'database','detail':'构成列表或数据库的单元格区域，列表的第一行包含每一列的标签。','example':'A2:F20','require':'m','repeat':'n','type':'range'},{'name':'field','detail':'指定 database 中的哪一列包含要提取和用于计算的值。\n\nfield 可以是与 database 第一行中某个列标题对应的文本标签，也可以是指定相关列的数字索引，第一列的索引值为 1。','example':'G2','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria','detail':'包含所指定条件的单元格区域。计算之前将使用这些条件来过滤 database 中的值。','example':'A22:D23','require':'m','repeat':'n','type':'range'}]},{'n':'DSTDEV','t':17,'d':'使用 SQL 式查询，返回利用列表或数据库中满足指定条件的记录字段（列）中的数字作为一个样本估算出的总体标准偏差。','a':'使用 SQL 式查询，返回利用列表或数据库中满足指定条件的记录字段（列）中的数字作为一个样本估算出的总体标准偏差。','m':[3,3],'p':[{'name':'database','detail':'构成列表或数据库的单元格区域，列表的第一行包含每一列的标签。','example':'A2:F20','require':'m','repeat':'n','type':'range'},{'name':'field','detail':'指定 database 中的哪一列包含要提取和用于计算的值。\n\nfield 可以是与 database 第一行中某个列标题对应的文本标签，也可以是指定相关列的数字索引，第一列的索引值为 1。','example':'G2','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria','detail':'包含所指定条件的单元格区域。计算之前将使用这些条件来过滤 database 中的值。','example':'A22:D23','require':'m','repeat':'n','type':'range'}]},{'n':'DSTDEVP','t':17,'d':'使用 SQL 式查询，返回利用列表或数据库中满足指定条件的记录字段（列）中的数字作为样本总体计算出的总体标准偏差。','a':'使用 SQL 式查询，返回利用列表或数据库中满足指定条件的记录字段（列）中的数字作为样本总体计算出的总体标准偏差。','m':[3,3],'p':[{'name':'database','detail':'构成列表或数据库的单元格区域，列表的第一行包含每一列的标签。','example':'A2:F20','require':'m','repeat':'n','type':'range'},{'name':'field','detail':'指定 database 中的哪一列包含要提取和用于计算的值。\n\nfield 可以是与 database 第一行中某个列标题对应的文本标签，也可以是指定相关列的数字索引，第一列的索引值为 1。','example':'G2','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria','detail':'包含所指定条件的单元格区域。计算之前将使用这些条件来过滤 database 中的值。','example':'A22:D23','require':'m','repeat':'n','type':'range'}]},{'n':'DSUM','t':17,'d':'使用 SQL 式查询，返回列表或数据库中满足指定条件的记录字段（列）中的数字之和。','a':'使用 SQL 式查询，返回列表或数据库中满足指定条件的记录字段（列）中的数字之和。','m':[3,3],'p':[{'name':'database','detail':'构成列表或数据库的单元格区域，列表的第一行包含每一列的标签。','example':'A2:F20','require':'m','repeat':'n','type':'range'},{'name':'field','detail':'指定 database 中的哪一列包含要提取和用于计算的值。\n\nfield 可以是与 database 第一行中某个列标题对应的文本标签，也可以是指定相关列的数字索引，第一列的索引值为 1。','example':'G2','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria','detail':'包含所指定条件的单元格区域。计算之前将使用这些条件来过滤 database 中的值。','example':'A22:D23','require':'m','repeat':'n','type':'range'}]},{'n':'DVAR','t':17,'d':'使用 SQL 式查询，返回利用列表或数据库中满足指定条件的记录字段（列）中的数字作为一个样本估算出的总体方差。','a':'使用 SQL 式查询，返回利用列表或数据库中满足指定条件的记录字段（列）中的数字作为一个样本估算出的总体方差。','m':[3,3],'p':[{'name':'database','detail':'构成列表或数据库的单元格区域，列表的第一行包含每一列的标签。','example':'A2:F20','require':'m','repeat':'n','type':'range'},{'name':'field','detail':'指定 database 中的哪一列包含要提取和用于计算的值。\n\nfield 可以是与 database 第一行中某个列标题对应的文本标签，也可以是指定相关列的数字索引，第一列的索引值为 1。','example':'G2','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria','detail':'包含所指定条件的单元格区域。计算之前将使用这些条件来过滤 database 中的值。','example':'A22:D23','require':'m','repeat':'n','type':'range'}]},{'n':'DVARP','t':17,'d':'使用 SQL 式查询，通过使用列表或数据库中满足指定条件的记录字段（列）中的数字计算样本总体的样本总体方差。','a':'使用 SQL 式查询，通过使用列表或数据库中满足指定条件的记录字段（列）中的数字计算样本总体的样本总体方差。','m':[3,3],'p':[{'name':'database','detail':'构成列表或数据库的单元格区域，列表的第一行包含每一列的标签。','example':'A2:F20','require':'m','repeat':'n','type':'range'},{'name':'field','detail':'指定 database 中的哪一列包含要提取和用于计算的值。\n\nfield 可以是与 database 第一行中某个列标题对应的文本标签，也可以是指定相关列的数字索引，第一列的索引值为 1。','example':'G2','require':'m','repeat':'n','type':'rangeall'},{'name':'criteria','detail':'包含所指定条件的单元格区域。计算之前将使用这些条件来过滤 database 中的值。','example':'A22:D23','require':'m','repeat':'n','type':'range'}]},{"n":"AGE_BY_IDCARD","t":"3","d":"根据中国身份证号计算出年龄。支持15为或18位身份证","a":"根据身份证号得到年龄。","m":[1,2],"p":[{"name":"身份证号","example":"A1","detail":"15位或者18位的身份证号或范围。","require":"m","repeat":"n","type":"rangeall"},{"name":"截止日期","example":'"2017-10-01"',"detail":"年龄计算的截止日期或范围，默认为当日。","require":"o","repeat":"n","type":"rangedatetime"}]},// SEX_BY_IDCARD
  {"n":"SEX_BY_IDCARD","t":"3","d":"根据中国身份证号计算出性别。支持15为或18位身份证","a":"根据身份证号得到性别。","m":[1,1],"p":[{"name":"身份证号","example":'"31033519900101XXXX"',"detail":"15位或者18位的身份证号或范围。","require":"m","repeat":"n","type":"rangeall"}]},// BIRTHDAY_BY_IDCARD
  {"n":"BIRTHDAY_BY_IDCARD","t":"3","d":"根据中国身份证号计算出生日。支持15为或18位身份证","a":"根据身份证号得到生日。","m":[1,2],"p":[{"name":"身份证号","example":'"31033519900101XXXX"',"detail":"15位或者18位的身份证号或范围。","require":"m","repeat":"n","type":"rangeall"},{"name":"生日格式","example":'0',"detail":"日期类型,默认0:[1900/01/01], 1:[1900-01-01], 2:[1900年1月1日]","require":"o","repeat":"n","type":"rangeall"}]},// PROVINCE_BY_IDCARD
  {"n":"PROVINCE_BY_IDCARD","t":"3","d":"根据中国身份证号计算出籍贯的省份。支持15为或18位身份证","a":"根据身份证号得到籍贯的省份。","m":[1,1],"p":[{"name":"身份证号","example":'"31033519900101XXXX"',"detail":"15位或者18位的身份证号或范围。","require":"m","repeat":"n","type":"rangeall"}]},// CITY_BY_IDCARD
  {"n":"CITY_BY_IDCARD","t":"3","d":"根据中国身份证号计算出籍贯的城市。支持15为或18位身份证","a":"根据身份证号得到籍贯的城市。","m":[1,1],"p":[{"name":"身份证号","example":'"31033519900101XXXX"',"detail":"15位或者18位的身份证号或范围。","require":"m","repeat":"n","type":"rangeall"}]},// STAR_BY_IDCARD
  {"n":"STAR_BY_IDCARD","t":"3","d":"根据中国身份证号计算出星座。支持15为或18位身份证","a":"根据身份证号得到星座。","m":[1,1],"p":[{"name":"身份证号","example":'"31033519900101XXXX"',"detail":"15位或者18位的身份证号或范围。","require":"m","repeat":"n","type":"rangeall"}]},// ANIMAL_BY_IDCARD
  {"n":"ANIMAL_BY_IDCARD","t":"3","d":"根据中国身份证号计算出生肖（鼠、牛、虎、兔...）。支持15为或18位身份证","a":"根据身份证号得到生肖。","m":[1,1],"p":[{"name":"身份证号","example":'"31033519900101XXXX"',"detail":"15位或者18位的身份证号或范围。","require":"m","repeat":"n","type":"rangeall"}]},// ISIDCARD
  {"n":"ISIDCARD","t":"3","d":"验证身份证的格式是否正确。支持15为或18位身份证","a":"验证身份证格式正确性。","m":[1,1],"p":[{"name":"身份证号","example":'"31033519900101XXXX"',"detail":"15位或者18位的身份证号或范围。","require":"m","repeat":"n","type":"rangeall"}]},// DM_TEXT_CUTWORD
  {"n":"DM_TEXT_CUTWORD","t":"4","d":"文本分词。把一连串文字拆分为一系列单独词语","a":"中文文本分词。","m":[1,2],"p":[{"name":"文本","example":'"我来到北京清华大学"',"detail":"任意需要分词的文本。","require":"m","repeat":"n","type":"rangeall"},{"name":"分词模式","example":'0',"detail":"默认为0[精确模式], 1[全模式], 2[搜索引擎模式]。","require":"o","repeat":"n","type":"rangenumber"}]},// DM_TEXT_TFIDF
  {"n":"DM_TEXT_TFIDF","t":"4","d":"采用tf-idf算法进行关键词提取。从一连串文字中识别关键词","a":"tf-idf关键词识别。","m":[1,3],"p":[{"name":"文本","example":'"我来到北京清华大学"',"detail":"任意需要分词的文本。","require":"m","repeat":"n","type":"rangeall"},{"name":"关键词个数","example":'20',"detail":"算法返回的关键词个数，默认20","require":"o","repeat":"n","type":"rangenumber"},{"name":"语料库","example":'1',"detail":"选择特定领域的语料库，默认0[通用], 1[金融], 2[医疗]","require":"o","repeat":"n","type":"rangenumber"}]},// DM_TEXT_TEXTRANK
  {"n":"DM_TEXT_TEXTRANK","t":"4","d":"采用TextRank算法进行关键词提取。从一连串文字中识别关键词","a":"TextRank关键词识别。","m":[1,3],"p":[{"name":"文本","example":'"我来到北京清华大学"',"detail":"任意需要分词的文本。","require":"m","repeat":"n","type":"rangeall"},{"name":"关键词个数","example":'20',"detail":"算法返回的关键词个数，默认20","require":"o","repeat":"n","type":"rangenumber"},{"name":"语料库","example":'1',"detail":"选择特定领域的语料库，默认0[通用], 1[金融], 2[医疗]","require":"o","repeat":"n","type":"rangenumber"}]},// DATA_CN_STOCK_CLOSE
  {"n":"DATA_CN_STOCK_CLOSE","t":"5","d":"根据股票代码和日期，返回A股对应股票收盘价。","a":"返回A股对应股票收盘价。","m":[1,3],"p":[{"name":"股票代码","example":'"000001"',"detail":"6位股票代码，必填项。","require":"m","repeat":"n","type":"rangeall"},{"name":"日期","example":'2015-01-08',"detail":"股票的交易日，默认为最新交易日","require":"o","repeat":"n","type":"rangedate"},{"name":"复权除权","example":'0',"detail":"选择股票的除权复权类型，默认0[前复权], 1[原始价格], 2[后复权]","require":"o","repeat":"n","type":"rangenumber"}]},// DATA_CN_STOCK_OPEN
  {"n":"DATA_CN_STOCK_OPEN","t":"5","d":"根据股票代码和日期，返回A股对应股票开盘价。","a":"返回A股对应股票开盘价。","m":[1,3],"p":[{"name":"股票代码","example":'"000001"',"detail":"6位股票代码，必填项。","require":"m","repeat":"n","type":"rangeall"},{"name":"日期","example":'2015-01-08',"detail":"股票的交易日，默认为最新交易日","require":"o","repeat":"n","type":"rangedate"},{"name":"复权除权","example":'0',"detail":"选择股票的除权复权类型，默认0[前复权], 1[原始价格], 2[后复权]","require":"o","repeat":"n","type":"rangenumber"}]},// DATA_CN_STOCK_MAX
  {"n":"DATA_CN_STOCK_MAX","t":"5","d":"根据股票代码和日期，返回A股对应股票最高价。","a":"返回A股对应股票最高价。","m":[1,3],"p":[{"name":"股票代码","example":'"000001"',"detail":"6位股票代码，必填项。","require":"m","repeat":"n","type":"rangeall"},{"name":"日期","example":'2015-01-08',"detail":"股票的交易日，默认为最新交易日","require":"o","repeat":"n","type":"rangedate"},{"name":"复权除权","example":'0',"detail":"选择股票的除权复权类型，默认0[前复权], 1[原始价格], 2[后复权]","require":"o","repeat":"n","type":"rangenumber"}]},// DATA_CN_STOCK_MIN
  {"n":"DATA_CN_STOCK_MIN","t":"5","d":"根据股票代码和日期，返回A股对应股票最低价。","a":"返回A股对应股票最低价。","m":[1,3],"p":[{"name":"股票代码","example":'"000001"',"detail":"6位股票代码，必填项。","require":"m","repeat":"n","type":"rangeall"},{"name":"日期","example":'2015-01-08',"detail":"股票的交易日，默认为最新交易日","require":"o","repeat":"n","type":"rangedate"},{"name":"复权除权","example":'0',"detail":"选择股票的除权复权类型，默认0[前复权], 1[原始价格], 2[后复权]","require":"o","repeat":"n","type":"rangenumber"}]},// DATA_CN_STOCK_VOLUMN
  {"n":"DATA_CN_STOCK_VOLUMN","t":"5","d":"根据股票代码和日期，返回A股对应股票成交量。","a":"返回A股对应股票成交量。","m":[1,3],"p":[{"name":"股票代码","example":'"000001"',"detail":"6位股票代码，必填项。","require":"m","repeat":"n","type":"rangeall"},{"name":"日期","example":'2015-01-08',"detail":"股票的交易日，默认为最新交易日","require":"o","repeat":"n","type":"rangedate"},{"name":"复权除权","example":'0',"detail":"选择股票的除权复权类型，默认0[前复权], 1[原始价格], 2[后复权]","require":"o","repeat":"n","type":"rangenumber"}]},// DATA_CN_STOCK_AMOUNT
  {"n":"DATA_CN_STOCK_AMOUNT","t":"5","d":"根据股票代码和日期，返回A股对应股票成交额。","a":"返回A股对应股票成交额。","m":[1,3],"p":[{"name":"股票代码","example":'"000001"',"detail":"6位股票代码，必填项。","require":"m","repeat":"n","type":"rangeall"},{"name":"日期","example":'2015-01-08',"detail":"股票的交易日，默认为最新交易日","require":"o","repeat":"n","type":"rangedate"},{"name":"复权除权","example":'0',"detail":"选择股票的除权复权类型，默认0[前复权], 1[原始价格], 2[后复权]","require":"o","repeat":"n","type":"rangenumber"}]},// ISDATE
  {"n":"ISDATE","t":"6","d":"验证日期的格式是否正确。支持多种日期格式","a":"验证日期格式正确性。","m":[1,1],"p":[{"name":"日期","example":'"1990-01-01"',"detail":"日期值，例如1990/01/01, 1990年1月1日等。","require":"m","repeat":"n","type":"rangeall"}]},//sparklines函数，线图
  {"n":"LINESPLINES","t":"3","d":"生成嵌入在单元格内的折线图sparklines，用于描述数据的连续走势","a":"生成单元格折线图","m":[1,8],"p":[//data
  {"name":"数据范围","example":'A1:A20',"detail":"数据范围，数值才能被有效计算，例如A1:A20， {1,2,3,4,5}等。","require":"m","repeat":"n","type":"rangeall"},//lineColor
  {"name":"线条颜色","example":'#2ec7c9',"detail":"线图的线条颜色，可以是否个范围A1、色表索引数值或者具体颜色值，设置为0或false则不显示，支持regx、rgb、rgba等。默认#2ec7c9","require":"o","repeat":"n","type":"rangeall"},// {
  //     "name": "填充颜色",
  //     "example": '#CCF3F4',
  //     "detail": "形成面积图，同线条颜色配置，默认0不显示",
  //     "require": "o",
  //     "repeat": "n",
  //     "type": "rangeall"
  // },
  //lineWidth
  {"name":"线条粗细","example":'1',"detail":"折线图线段粗细，默认为1px","require":"o","repeat":"n","type":"rangeall"},//normalRangeMin和normalRangeMax设为相同的值，min、max、avg、median需要计算
  {"name":"辅助线","example":'avg',"detail":"一条横线，可以是min、max、avg、median、范围或自定义数值，默认0无","require":"o","repeat":"n","type":"rangeall"},//normalRangeColor
  {"name":"辅助线颜色","example":'#000',"detail":"辅助线的颜色设置，同线条颜色配置，默认#000","require":"o","repeat":"n","type":"rangeall"},//maxSpotColor
  {"name":"最大值标识","example":'#fc5c5c',"detail":"标识线图最大值，同线条颜色配置，默认0不显示","require":"o","repeat":"n","type":"rangeall"},//minSpotColor
  {"name":"最小值标识","example":'#fc5c5c',"detail":"标识线图最大值，同线条颜色配置，默认0不显示","require":"o","repeat":"n","type":"rangeall"},//spotRadius
  {"name":"标识大小","example":'1.5',"detail":"最大值和最小值的标识大小设置，默认为1.5","require":"o","repeat":"n","type":"rangeall"}]},//sparklines面积图
  {"n":"AREASPLINES","t":"3","d":"生成嵌入在单元格内的面积图sparklines，一般用于描述数据的连续累积值走势","a":"生成单元格面积图","m":[1,5],"p":[//data
  {"name":"数据范围","example":'A1:A20',"detail":"数据范围，数值才能被有效计算，例如A1:A20， {1,2,3,4,5}等。","require":"m","repeat":"n","type":"rangeall"},//lineColor
  {"name":"线条颜色","example":'#2ec7c9',"detail":"线图的线条颜色，可以是否个范围A1、色表索引数值或者具体颜色值，设置为0或false则不显示，支持regx、rgb、rgba等。默认#2ec7c9","require":"o","repeat":"n","type":"rangeall"},//fillColor
  {"name":"填充颜色","example":'#CCF3F4',"detail":"形成面积图，同线条颜色配置，默认0不显示","require":"o","repeat":"n","type":"rangeall"},//lineWidth
  {"name":"线条粗细","example":'1',"detail":"折线图线段粗细，默认为1px","require":"o","repeat":"n","type":"rangeall"},//normalRangeMin和normalRangeMax设为相同的值，min、max、avg、median需要计算
  {"name":"辅助线","example":'avg',"detail":"一条横线，可以是min、max、avg、median、范围或自定义数值，默认0无","require":"o","repeat":"n","type":"rangeall"},//normalRangeColor
  {"name":"辅助线颜色","example":'#000',"detail":"辅助线的颜色设置，同线条颜色配置，默认#000","require":"o","repeat":"n","type":"rangeall"}// //maxSpotColor
  // {
  //     "name": "最大值标识",
  //     "example": '#fc5c5c',
  //     "detail": "标识线图最大值，同线条颜色配置，默认0不显示",
  //     "require": "o",
  //     "repeat": "n",
  //     "type": "rangeall"
  // },
  // //minSpotColor
  // {
  //     "name": "最小值标识",
  //     "example": '#fc5c5c',
  //     "detail": "标识线图最大值，同线条颜色配置，默认0不显示",
  //     "require": "o",
  //     "repeat": "n",
  //     "type": "rangeall"
  // },
  // //spotRadius
  // {
  //     "name": "标识大小",
  //     "example": '1.5',
  //     "detail": "最大值和最小值的标识大小设置，默认为1.5",
  //     "require": "o",
  //     "repeat": "n",
  //     "type": "rangeall"
  // }
  ]},//sparklines柱状图
  {"n":"COLUMNSPLINES","t":"3","d":"生成嵌入在单元格内的垂直柱状图sparklines，一般用于描述离散数据之间的大小情况","a":"生成单元格垂直柱状图","m":[1,6],"p":[//data
  {"name":"数据范围","example":'A1:A20',"detail":"数据范围，数值才能被有效计算，例如A1:A20， {1,2,3,4,5}等。","require":"m","repeat":"n","type":"rangeall"},//barSpacing
  {"name":"柱条间隔","example":'1',"detail":"柱条之间的间隔距离，默认为1","require":"o","repeat":"n","type":"rangeall"},//barColor
  {"name":"柱条颜色","example":'#fc5c5c',"detail":"线图的线条颜色，可以是否个范围A1、色表索引数值或者具体颜色值，设置为0或false则不显示，支持regx、rgb、rgba等。默认#fc5c5c","require":"o","repeat":"n","type":"rangeall"},//negBarColor
  {"name":"负向柱条颜色","example":'#97b552',"detail":"负向柱条颜色设置，代表负值的颜色，同柱条颜色配置，默认#97b552","require":"o","repeat":"n","type":"rangeall"},//chartRangeMax
  {"name":"最大值","example":'100',"detail":"柱图最大值，用于规范柱图长度，默认为自动计算false、auto、null","require":"o","repeat":"n","type":"rangeall"},//colorMap
  {"name":"色板","example":'#97b552',"detail":"调色板可以单独设置每个柱条的颜色，可设置多个，支持两种格式：1颜色例如#000，代表第一个柱的颜色是黑色；2数值范围:颜色，例如-2:#000表示数值为-2的柱为黑色，0:5:#000表示数值0-5的柱为黑色，默认为空","require":"o","repeat":"y","type":"rangeall"}]},//sparklines累积柱状图
  {"n":"STACKCOLUMNSPLINES","t":"3","d":"生成嵌入在单元格内的累积垂直柱状图sparklines，一般用于描述离散数据多个维度的数值大小","a":"生成单元格累积垂直柱状图","m":[1,5],"p":[//data
  {"name":"数据范围","example":'A1:A20',"detail":"数据范围，数值才能被有效计算，例如A1:A20， {1,2,3,4,5}等。","require":"m","repeat":"n","type":"rangeall"},//stackconfig
  {"name":"按列堆积","example":'1',"detail":"如果需要按行堆积则本项设为false或0，默认为是1","require":"o","repeat":"n","type":"rangeall"},//barSpacing
  {"name":"柱条间隔","example":'1',"detail":"柱条之间的间隔距离，默认为1","require":"o","repeat":"n","type":"rangeall"},//chartRangeMax
  {"name":"最大值","example":'100',"detail":"累积柱图最大值，用于规范柱图长度，默认为自动计算false、auto、null","require":"o","repeat":"n","type":"rangeall"},//stackedBarColor
  {"name":"累积色板","example":'#97b552',"detail":"调色板可以单独设置每个维度的柱条颜色，可设置为A1:A10等范围，默认为#2ec7c9, #fc5c5c, #5ab1ef, #ffb980...","require":"o","repeat":"y","type":"rangeall"}]},//sparklines条形图
  {"n":"BARSPLINES","t":"3","d":"生成嵌入在单元格内的横向条形图sparklines，一般用于描述离散数据之间的大小情况","a":"生成单元格横向条形图","m":[1,6],"p":[//data
  {"name":"数据范围","example":'A1:A20',"detail":"数据范围，数值才能被有效计算，例如A1:A20， {1,2,3,4,5}等。","require":"m","repeat":"n","type":"rangeall"},//barSpacing
  {"name":"柱条间隔","example":'1',"detail":"柱条之间的间隔距离，默认为1","require":"o","repeat":"n","type":"rangeall"},//barColor
  {"name":"柱条颜色","example":'#fc5c5c',"detail":"线图的线条颜色，可以是否个范围A1、色表索引数值或者具体颜色值，设置为0或false则不显示，支持regx、rgb、rgba等。默认#fc5c5c","require":"o","repeat":"n","type":"rangeall"},//negBarColor
  {"name":"负向柱条颜色","example":'#97b552',"detail":"负向柱条颜色设置，代表负值的颜色，同柱条颜色配置，默认#97b552","require":"o","repeat":"n","type":"rangeall"},//chartRangeMax
  {"name":"最大值","example":'100',"detail":"柱图最大值，用于规范柱图长度，默认为自动计算false、auto、null","require":"o","repeat":"n","type":"rangeall"},//colorMap
  {"name":"色板","example":'#97b552',"detail":"调色板可以单独设置每个柱条的颜色，可设置多个，支持两种格式：1颜色例如#000，代表第一个柱的颜色是黑色；2数值范围:颜色，例如-2:#000表示数值为-2的柱为黑色，0:5:#000表示数值0-5的柱为黑色，默认为空","require":"o","repeat":"y","type":"rangeall"}]},//sparklines累积条形图
  {"n":"STACKBARSPLINES","t":"3","d":"生成嵌入在单元格内的累积横向条形图sparklines，一般用于描述离散数据多个维度的数值大小","a":"生成单元格累积横向条形图","m":[1,5],"p":[//data
  {"name":"数据范围","example":'A1:A20',"detail":"数据范围，数值才能被有效计算，例如A1:A20， {1,2,3,4,5}等。","require":"m","repeat":"n","type":"rangeall"},//stackconfig
  {"name":"按列堆积","example":'1',"detail":"如果需要按行堆积则本项设为false或0，默认为是1","require":"o","repeat":"n","type":"rangeall"},//barSpacing
  {"name":"柱条间隔","example":'1',"detail":"柱条之间的间隔距离，默认为1","require":"o","repeat":"n","type":"rangeall"},//chartRangeMax
  {"name":"最大值","example":'100',"detail":"累积柱图最大值，用于规范柱图长度，默认为自动计算false、auto、null","require":"o","repeat":"n","type":"rangeall"},//stackedBarColor
  {"name":"累积色板","example":'#97b552',"detail":"调色板可以单独设置每个维度的柱条颜色，可设置为A1:A10等范围，默认为#2ec7c9, #fc5c5c, #5ab1ef, #ffb980...","require":"o","repeat":"y","type":"rangeall"}]},//sparklines离散图
  {"n":"DISCRETESPLINES","t":"3","d":"生成嵌入在单元格内的离散图sparklines，一般用于描述离散数据走势","a":"生成单元格离散图","m":[1,4],"p":[//data
  {"name":"数据范围","example":'A1:A20',"detail":"数据范围，数值才能被有效计算，例如A1:A20， {1,2,3,4,5}等。","require":"m","repeat":"n","type":"rangeall"},//thresholdValue
  {"name":"分割阈值","example":'1',"detail":"离散图柱形颜色的区分，例如：该值为0，则大于0为蓝色，小于0为红色，默认为0","require":"o","repeat":"n","type":"rangeall"},//lineColor
  {"name":"阈值以上颜色","example":'#2ec7c9',"detail":"线图的线条颜色，可以是否个范围A1、色表索引数值或者具体颜色值，设置为0或false则不显示，支持regx、rgb、rgba等。默认#2ec7c9","require":"o","repeat":"n","type":"rangeall"},//thresholdColor
  {"name":"阈值以下颜色","example":'#fc5c5c',"detail":"阈值以下柱条颜色设置，同阈值以上颜色，默认#fc5c5c","require":"o","repeat":"n","type":"rangeall"}]},//sparklines三态图
  {"n":"TRISTATESPLINES","t":"3","d":"生成嵌入在单元格内的三态图sparklines，一般用于描述三种态势的走势例如胜负平","a":"生成单元格离散图","m":[1,6],"p":[//data
  {"name":"数据范围","example":'A1:A20',"detail":"数据范围，数值才能被有效计算，例如A1:A20， {1,2,3,4,5}等。","require":"m","repeat":"n","type":"rangeall"},//barSpacing
  {"name":"柱条间隔","example":'1',"detail":"柱条之间的间隔距离，默认为1","require":"o","repeat":"n","type":"rangeall"},//posBarColor
  {"name":"柱条颜色","example":'#fc5c5c',"detail":"线图的线条颜色，可以是否个范围A1、色表索引数值或者具体颜色值，设置为0或false则不显示，支持regx、rgb、rgba等。默认#fc5c5c","require":"o","repeat":"n","type":"rangeall"},//negBarColor
  {"name":"负向柱条颜色","example":'#97b552',"detail":"负向柱条颜色设置，代表负值的颜色，同柱条颜色配置，默认#97b552","require":"o","repeat":"n","type":"rangeall"},//zeroBarColor
  {"name":"零值柱条颜色","example":'#999',"detail":"零值柱条颜色设置，代表0值颜色，同柱条颜色配置，默认#999","require":"o","repeat":"n","type":"rangeall"},//colorMap
  {"name":"色板","example":'#97b552',"detail":"调色板可以单独设置每个柱条的颜色，可设置多个，支持两种格式：1颜色例如#000，代表第一个柱的颜色是黑色；2数值范围:颜色，例如-2:#000表示数值为-2的柱为黑色，0-5:#000表示数值0-5的柱为黑色，默认为空","require":"o","repeat":"y","type":"rangeall"}]},//sparklines饼图
  {"n":"PIESPLINES","t":"3","d":"生成嵌入在单元格内的饼图sparklines，一般用于描述数据占比","a":"生成单元格饼图","m":[1,5],"p":[//data
  {"name":"数据范围","example":'A1:A20',"detail":"数据范围，数值才能被有效计算，例如A1:A20， {1,2,3,4,5}等。","require":"m","repeat":"n","type":"rangeall"},//offset
  {"name":"旋转角度","example":'0',"detail":"饼图的旋转角度，默认为0","require":"o","repeat":"n","type":"rangeall"},//borderWidth
  {"name":"饼图边框","example":'0',"detail":"饼图边框大小，默认为无0","require":"o","repeat":"n","type":"rangeall"},//borderColor
  {"name":"边框颜色","example":'#000',"detail":"饼图边框颜色，默认为#000","require":"o","repeat":"n","type":"rangeall"},//sliceColors
  {"name":"饼图色板","example":'#97b552',"detail":"调色板可以设置切片的颜色，可设置为A1:A10等范围，默认为#2ec7c9, #fc5c5c, #5ab1ef, #ffb980...","require":"o","repeat":"y","type":"rangeall"}]},//sparklines箱线图
  {"n":"BOXSPLINES","t":"3","d":"生成嵌入在单元格内的箱线图sparklines，一般用于描述数据集的统计分布","a":"生成单元格箱线图","m":[1,4],"p":[//data
  {"name":"数据范围","example":'A1:A20',"detail":"数据范围，数值才能被有效计算，例如A1:A20， {1,2,3,4,5}等。","require":"m","repeat":"n","type":"rangeall"},//outlierIQR，如果为0或false则showOutliers设为false，否则为true
  {"name":"离群点比例","example":'1.5',"detail":"离群点的阈值范围，如果为0或false则不显示，默认为1.5倍","require":"o","repeat":"n","type":"rangeall"},//target
  {"name":"目标点值","example":'10',"detail":"箱线图上的目标值设置，默认为false不显示","require":"o","repeat":"n","type":"rangeall"},//spotRadius
  {"name":"数据点大小","example":'1.5',"detail":"目标点和利群点的半径大小设置，默认为1.5","require":"o","repeat":"n","type":"rangeall"}]},//sparklines子弹图
  {"n":"BULLETSPLINES","t":"3","d":"生成嵌入在单元格内的子弹图sparklines，一般用于描述任务达成率","a":"生成单元格子弹图","m":[2,3],"p":[//目标data1
  {"name":"目标","example":'10',"detail":"达成的目标值，数值才能被有效计算，例如A1， 100等。","require":"m","repeat":"n","type":"rangeall"},//目前达成data2
  {"name":"实际完成","example":'8',"detail":"目前完成值，数值才能被有效计算，例如A1， 100等。","require":"m","repeat":"n","type":"rangeall"},//对比值datax
  {"name":"对比值","example":'12',"detail":"对比值，例如超额、最低、获奖底线等，数值才能被有效计算，例如A1， 100等。可以设置最多9个对比值","require":"o","repeat":"y","type":"rangeall"}]},//sparklines组合图，支持多个类型的图画在同一个单元格
  {"n":"COMPOSESPLINES","t":"3","d":"支持多个类型的图画在同一个单元格,每个参数代表一个sparklines图","a":"组合sparklines图到一个单元格","m":[1,1],"p":[//data
  {"name":"图设置","example":'PIESPLINES(A1:A20)',"detail":"sparklines图设置，例如A1:A20， 一个完成的饼图、线图设置等。","require":"m","repeat":"y","type":"rangeall"}]},//动态数组公式
  {'n':'SORT','t':'14','d':'返回数组中元素的排序数组。返回的数组与提供的数组参数形状相同。','a':'返回数组中元素的排序数组。返回的数组与提供的数组参数形状相同。','m':[1,4],'p':[{'name':'array','detail':'要排序的范围或数组。','example':'A2:A17','require':'m','repeat':'n','type':'rangenumber'},{'name':'sort_index','detail':'[可选] - 表示要排序的行或列的数字。（默认row1/col1）','example':'1','require':'o','repeat':'n','type':'rangenumber'},{'name':'sort_order','detail':'[可选] - 表示所需排序顺序的数字；1表示升序（默认），-1表示降序。','example':'-1','require':'o','repeat':'n','type':'rangenumber'},{'name':'by_col','detail':'[可选] - 表示所需排序方向的逻辑值；按行排序为FALSE()（默认），按列排序为TRUE()。','example':'TRUE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'FILTER','t':'14','d':'基于一个布尔（真/假）数组过滤一个数组。','a':'基于一个布尔（真/假）数组过滤一个数组。','m':[2,3],'p':[{'name':'array','detail':'要筛选的数组或范围。','example':'A5:D20','require':'m','repeat':'n','type':'range'},{'name':'include','detail':'布尔数组，其高度或宽度与数组相同','example':'1','require':'m','repeat':'n','type':'range'},{'name':'if_empty','detail':'[可选] - 如果包含数组中的所有值都为空(filter不返回任何值)，则返回的值。','example':'""','require':'o','repeat':'n','type':'rangeall'}]},{'n':'UNIQUE','t':'14','d':'返回列表或区域中的唯一值的列表。','a':'返回列表或区域中的唯一值的列表。','m':[1,3],'p':[{'name':'array','detail':'从其返回唯一值的数组或区域。','example':'A2:B26','require':'m','repeat':'n','type':'rangenumber'},{'name':'by_col','detail':'[可选] - 逻辑值，指示如何比较；按行 = FALSE() 或省略；按列 = TRUE()。','example':'TRUE()','require':'o','repeat':'n','type':'rangeall'},{'name':'occurs_once','detail':'[可选] - 逻辑值，仅返回唯一值中出现一次 = TRUE()；包括所有唯一值 = FALSE() 或省略。','example':'FALSE()','require':'o','repeat':'n','type':'rangeall'}]},{'n':'RANDARRAY','t':'14','d':'返回 0 到 1 之间的随机数字数组。','a':'返回 0 到 1 之间的随机数字数组。','m':[0,2],'p':[{'name':'rows','detail':'[可选] - 要返回的行数。','example':'1','require':'o','repeat':'n','type':'rangenumber'},{'name':'cols','detail':'[可选] - 要返回的列数。','example':'1','require':'o','repeat':'n','type':'rangenumber'}]},{'n':'SEQUENCE','t':'14','d':'生成数字序列的列表。','a':'生成数字序列的列表。','m':[1,4],'p':[{'name':'rows','detail':'要返回的行数。','example':'1','require':'m','repeat':'n','type':'rangenumber'},{'name':'cols','detail':'[可选] - 要返回的列数。','example':'1','require':'o','repeat':'n','type':'rangenumber'},{'name':'start','detail':'[可选] - 序列中的第一个数字。','example':'1','require':'o','repeat':'n','type':'rangenumber'},{'name':'step','detail':'[可选] - 序列中每个序列值的增量。','example':'1','require':'o','repeat':'n','type':'rangenumber'}]}];luckysheet.functionImplementation={"SUM":function SUM(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(!luckysheet.func_methods.isRealNum(data)){if(luckysheet.getObjType(data)=="boolean"){if(data.toString().toLowerCase()=="true"){dataArr.push(1);}else if(data.toString().toLowerCase()=="false"){dataArr.push(0);}}else {return luckysheet.formula.error.v;}}else {dataArr.push(data);}}}var sum=0;if(dataArr.length>0){for(var i=0;i<dataArr.length;i++){if(luckysheet.func_methods.valueIsError(dataArr[i])){return dataArr[i];}if(!luckysheet.func_methods.isRealNum(dataArr[i])){continue;}sum+=parseFloat(dataArr[i]);}}return sum;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"AVERAGE":function AVERAGE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else {dataArr=dataArr.concat(data);}}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"text",true));}else {dataArr.push(data);}}var sum=0,count=0;for(var i=0;i<dataArr.length;i++){if(luckysheet.func_methods.valueIsError(dataArr[i])){return dataArr[i];}else if(!luckysheet.func_methods.isRealNum(dataArr[i])){return luckysheet.formula.error.v;}sum+=parseFloat(dataArr[i]);count++;}if(count==0){return luckysheet.formula.error.d;}return sum/count;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COUNT":function COUNT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else {dataArr=dataArr.concat(data);}}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"text",true));}else {if(luckysheet.getObjType(data)=="boolean"){if(data.toString().toLowerCase()=="true"){dataArr.push(1);}else if(data.toString().toLowerCase()=="false"){dataArr.push(0);}}else {dataArr.push(data);}}}var count=0;for(var i=0;i<dataArr.length;i++){if(luckysheet.func_methods.isRealNum(dataArr[i])){count++;}}return count;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COUNTA":function COUNTA(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data));}else {dataArr=dataArr.concat(data);}}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"text",true));}else {dataArr.push(data);}}return dataArr.length;}catch(err){//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MAX":function MAX(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else {dataArr=dataArr.concat(data);}}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {dataArr.push(data);}}var max=null;for(var i=0;i<dataArr.length;i++){if(luckysheet.func_methods.valueIsError(dataArr[i])){return dataArr[i];}if(!luckysheet.func_methods.isRealNum(dataArr[i])){continue;}if(max==null||parseFloat(dataArr[i])>max){max=parseFloat(dataArr[i]);}}return max==null?0:max;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MIN":function MIN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else {dataArr=dataArr.concat(data);}}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {dataArr.push(data);}}var min=null;for(var i=0;i<dataArr.length;i++){if(luckysheet.func_methods.valueIsError(dataArr[i])){return dataArr[i];}if(!luckysheet.func_methods.isRealNum(dataArr[i])){continue;}if(min==null||parseFloat(dataArr[i])<min){min=parseFloat(dataArr[i]);}}return min==null?0:min;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"AGE_BY_IDCARD":function AGE_BY_IDCARD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//身份证号
  var UUserCard=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(UUserCard)){return UUserCard;}if(!window.luckysheet_function.ISIDCARD.f(UUserCard)){return luckysheet.formula.error.v;}var birthday=window.luckysheet_function.BIRTHDAY_BY_IDCARD.f(UUserCard);if(luckysheet.func_methods.valueIsError(birthday)){return birthday;}birthday=moment(birthday);var cuurentdate=moment();if(arguments.length==2){cuurentdate=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(cuurentdate)){return cuurentdate;}cuurentdate=moment(cuurentdate);}var age=cuurentdate.diff(birthday,"years");if(age<0||age.toString()=="NaN"){return luckysheet.formula.error.v;}return age;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SEX_BY_IDCARD":function SEX_BY_IDCARD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//身份证号
  var UUserCard=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(UUserCard)){return UUserCard;}if(!window.luckysheet_function.ISIDCARD.f(UUserCard)){return luckysheet.formula.error.v;}if(parseInt(UUserCard.substr(16,1))%2==1){return "男";}else {return "女";}}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"BIRTHDAY_BY_IDCARD":function BIRTHDAY_BY_IDCARD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//身份证号
  var UUserCard=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(UUserCard)){return UUserCard;}if(!window.luckysheet_function.ISIDCARD.f(UUserCard)){return luckysheet.formula.error.v;}var birthday="";if(UUserCard.length==15){var year="19"+UUserCard.substring(6,8)+"/"+UUserCard.substring(8,10)+"/"+UUserCard.substring(10,12);birthday=year;}else if(UUserCard.length==18){var year=UUserCard.substring(6,10)+"/"+UUserCard.substring(10,12)+"/"+UUserCard.substring(12,14);birthday=year;}//生日格式
  var datetype=0;if(arguments[1]!=null){datetype=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(datetype)){return datetype;}}if(!luckysheet.func_methods.isRealNum(datetype)){return luckysheet.formula.error.v;}datetype=parseInt(datetype);if(datetype<0||datetype>2){return luckysheet.formula.error.v;}if(parseInt(datetype)==0){return birthday;}else if(parseInt(datetype)==1){return moment(birthday).format("YYYY-MM-DD");}else if(parseInt(datetype)==2){return moment(birthday).format("YYYY年M月D日");}}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PROVINCE_BY_IDCARD":function PROVINCE_BY_IDCARD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//身份证号
  var UUserCard=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(UUserCard)){return UUserCard;}if(!window.luckysheet_function.ISIDCARD.f(UUserCard)){return luckysheet.formula.error.v;}var _native="未知";var provinceArray=luckysheet.formula.classlist.province;if(UUserCard.substring(0,2)in provinceArray){_native=provinceArray[UUserCard.substring(0,2)];}return _native;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CITY_BY_IDCARD":function CITY_BY_IDCARD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//身份证号
  var UUserCard=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(UUserCard)){return UUserCard;}if(!window.luckysheet_function.ISIDCARD.f(UUserCard)){return luckysheet.formula.error.v;}var dataNum=cityData.length,_native2="未知";for(var i=0;i<dataNum;i++){if(UUserCard.substring(0,6)==cityData[i].code){_native2=cityData[i].title;break;}}return _native2;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"STAR_BY_IDCARD":function STAR_BY_IDCARD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//身份证号
  var UUserCard=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(UUserCard)){return UUserCard;}if(!window.luckysheet_function.ISIDCARD.f(UUserCard)){return luckysheet.formula.error.v;}var birthday=window.luckysheet_function.BIRTHDAY_BY_IDCARD.f(UUserCard);if(luckysheet.func_methods.valueIsError(birthday)){return birthday;}birthday=new Date(birthday);var month=birthday.getMonth(),day=birthday.getDate();var d=new Date(1999,month,day,0,0,0);var arr=[];arr.push(["魔羯座",new Date(1999,0,1,0,0,0)]);arr.push(["水瓶座",new Date(1999,0,20,0,0,0)]);arr.push(["双鱼座",new Date(1999,1,19,0,0,0)]);arr.push(["白羊座",new Date(1999,2,21,0,0,0)]);arr.push(["金牛座",new Date(1999,3,21,0,0,0)]);arr.push(["双子座",new Date(1999,4,21,0,0,0)]);arr.push(["巨蟹座",new Date(1999,5,22,0,0,0)]);arr.push(["狮子座",new Date(1999,6,23,0,0,0)]);arr.push(["处女座",new Date(1999,7,23,0,0,0)]);arr.push(["天秤座",new Date(1999,8,23,0,0,0)]);arr.push(["天蝎座",new Date(1999,9,23,0,0,0)]);arr.push(["射手座",new Date(1999,10,22,0,0,0)]);arr.push(["魔羯座",new Date(1999,11,22,0,0,0)]);//console.log(birthday, arr, i);
  for(var i=arr.length-1;i>=0;i--){if(d>=arr[i][1]){return arr[i][0];}}return "未找到匹配星座信息";}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ANIMAL_BY_IDCARD":function ANIMAL_BY_IDCARD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//身份证号
  var UUserCard=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(UUserCard)){return UUserCard;}if(!window.luckysheet_function.ISIDCARD.f(UUserCard)){return luckysheet.formula.error.v;}var birthday=window.luckysheet_function.BIRTHDAY_BY_IDCARD.f(UUserCard);if(luckysheet.func_methods.valueIsError(birthday)){return birthday;}birthday=new Date(birthday);var list=new Array("猪","鼠","牛","虎","兔","龙","蛇","马","羊","猴","鸡","狗");var index=(parseInt(birthday.getFullYear())+9)%12;if(index!=null&&!isNaN(index)){return list[index];}else {return "未找到匹配生肖信息";}}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISIDCARD":function ISIDCARD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var idcard=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(idcard)){return idcard;}var reg=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;if(reg.test(idcard)){return true;}else {return false;}}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DM_TEXT_CUTWORD":function DM_TEXT_CUTWORD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//任意需要分词的文本
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}//分词模式
  var datetype=0;if(arguments[1]!=null){datetype=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(datetype)){return datetype;}}if(!luckysheet.func_methods.isRealNum(datetype)){return luckysheet.formula.error.v;}datetype=parseInt(datetype);if(datetype!=0&&datetype!=1&&datetype!=2){return luckysheet.formula.error.v;}//luckysheet.jfrefreshcell({ "v": "load...", "f": cell_fp }, cell_r, cell_c);
  $.post("/dataqk/tu/api/cutword",{"text":text,"type":datetype},function(data){var d=[].concat(luckysheet.flowdata);luckysheet.formula.execFunctionGroup(cell_r,cell_c,data);d[cell_r][cell_c]={"v":data,"f":cell_fp};luckysheet.jfrefreshgrid(d,[{"row":[cell_r,cell_r],"column":[cell_c,cell_c]}]);});return "loading...";}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DM_TEXT_TFIDF":function DM_TEXT_TFIDF(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//任意需要分词的文本
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}//关键词个数
  var count=20;if(arguments[1]!=null){count=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(count)){return count;}}if(!luckysheet.func_methods.isRealNum(count)){return luckysheet.formula.error.v;}count=parseInt(count);//语料库
  var set=0;if(arguments[2]!=null){set=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(set)){return set;}}if(!luckysheet.func_methods.isRealNum(set)){return luckysheet.formula.error.v;}set=parseInt(set);if(count<0){return luckysheet.formula.error.v;}if(set!=0&&set!=1&&set!=2){return luckysheet.formula.error.v;}//luckysheet.jfrefreshcell({ "v": "load...", "f": cell_fp }, cell_r, cell_c);
  $.post("/dataqk/tu/api/tfidf",{"text":text,"count":count,"set":set},function(data){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);luckysheet.formula.execFunctionGroup(cell_r,cell_c,data);d[cell_r][cell_c]={"v":data,"f":cell_fp};luckysheet.jfrefreshgrid(d,[{"row":[cell_r,cell_r],"column":[cell_c,cell_c]}]);});return "loading...";}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DM_TEXT_TEXTRANK":function DM_TEXT_TEXTRANK(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//任意需要分词的文本
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}//关键词个数
  var count=20;if(arguments[1]!=null){count=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(count)){return count;}}if(!luckysheet.func_methods.isRealNum(count)){return luckysheet.formula.error.v;}count=parseInt(count);//语料库
  var set=0;if(arguments[2]!=null){set=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(set)){return set;}}if(!luckysheet.func_methods.isRealNum(set)){return luckysheet.formula.error.v;}set=parseInt(set);if(count<0){return luckysheet.formula.error.v;}if(set!=0&&set!=1&&set!=2){return luckysheet.formula.error.v;}//luckysheet.jfrefreshcell({ "v": "load...", "f": cell_fp }, cell_r, cell_c);
  $.post("/dataqk/tu/api/tfidf",{"text":text,"count":count,"set":set},function(data){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);luckysheet.formula.execFunctionGroup(cell_r,cell_c,data);d[cell_r][cell_c]={"v":data,"f":cell_fp};luckysheet.jfrefreshgrid(d,[{"row":[cell_r,cell_r],"column":[cell_c,cell_c]}]);});return "loading...";}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DATA_CN_STOCK_CLOSE":function DATA_CN_STOCK_CLOSE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//股票代码
  var stockcode=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(stockcode)){return stockcode;}//日期
  var date=null;if(arguments[1]!=null){var data_date=arguments[1];if(luckysheet.getObjType(data_date)=="array"){return luckysheet.formula.error.v;}else if(luckysheet.getObjType(data_date)=="object"&&data_date.startCell!=null){if(data_date.data!=null&&luckysheet.getObjType(data_date.data)!="array"&&data_date.data.ct!=null&&data_date.data.ct.t=="d"){date=luckysheet.mask.update("yyyy-mm-dd",data_date.data.v);}else {return luckysheet.formula.error.v;}}else {date=data_date;}if(!luckysheet.datecontroll.isdatetime(date)){return [luckysheet.formula.error.v,"日期错误"];}date=moment(date).format("YYYY-MM-DD");}//复权除权
  var price=0;if(arguments[2]!=null){price=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(price)){return price;}}if(!luckysheet.func_methods.isRealNum(price)){return luckysheet.formula.error.v;}price=parseInt(price);if(price!=0&&price!=1&&price!=2){return luckysheet.formula.error.v;}//luckysheet.jfrefreshcell({ "v": "load...", "f": cell_fp }, cell_r, cell_c);
  $.post("/dataqk/tu/api/getstockinfo",{"stockCode":stockcode,"date":date,"price":price,type:"0"},function(data){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);var v=luckysheet.numFormat(data);if(v==null){v=data;}luckysheet.formula.execFunctionGroup(cell_r,cell_c,v);d[cell_r][cell_c]={"v":v,"f":cell_fp};luckysheet.jfrefreshgrid(d,[{"row":[cell_r,cell_r],"column":[cell_c,cell_c]}]);});return "loading...";}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DATA_CN_STOCK_OPEN":function DATA_CN_STOCK_OPEN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//股票代码
  var stockcode=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(stockcode)){return stockcode;}//日期
  var date=null;if(arguments[1]!=null){var data_date=arguments[1];if(luckysheet.getObjType(data_date)=="array"){return luckysheet.formula.error.v;}else if(luckysheet.getObjType(data_date)=="object"&&data_date.startCell!=null){if(data_date.data!=null&&luckysheet.getObjType(data_date.data)!="array"&&data_date.data.ct!=null&&data_date.data.ct.t=="d"){date=luckysheet.mask.update("yyyy-mm-dd",data_date.data.v);}else {return luckysheet.formula.error.v;}}else {date=data_date;}if(!luckysheet.datecontroll.isdatetime(date)){return [luckysheet.formula.error.v,"日期错误"];}date=moment(date).format("YYYY-MM-DD");}//复权除权
  var price=0;if(arguments[2]!=null){price=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(price)){return price;}}if(!luckysheet.func_methods.isRealNum(price)){return luckysheet.formula.error.v;}price=parseInt(price);if(price!=0&&price!=1&&price!=2){return luckysheet.formula.error.v;}//luckysheet.jfrefreshcell({ "v": "load...", "f": cell_fp }, cell_r, cell_c);
  $.post("/dataqk/tu/api/getstockinfo",{"stockCode":stockcode,"date":date,"price":price,type:"1"},function(data){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);luckysheet.formula.execFunctionGroup(cell_r,cell_c,data);d[cell_r][cell_c]={"v":data,"f":cell_fp};luckysheet.jfrefreshgrid(d,[{"row":[cell_r,cell_r],"column":[cell_c,cell_c]}]);});return "loading...";}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DATA_CN_STOCK_MAX":function DATA_CN_STOCK_MAX(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//股票代码
  var stockcode=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(stockcode)){return stockcode;}//日期
  var date=null;if(arguments[1]!=null){var data_date=arguments[1];if(luckysheet.getObjType(data_date)=="array"){return luckysheet.formula.error.v;}else if(luckysheet.getObjType(data_date)=="object"&&data_date.startCell!=null){if(data_date.data!=null&&luckysheet.getObjType(data_date.data)!="array"&&data_date.data.ct!=null&&data_date.data.ct.t=="d"){date=luckysheet.mask.update("yyyy-mm-dd",data_date.data.v);}else {return luckysheet.formula.error.v;}}else {date=data_date;}if(!luckysheet.datecontroll.isdatetime(date)){return [luckysheet.formula.error.v,"日期错误"];}date=moment(date).format("YYYY-MM-DD");}//复权除权
  var price=0;if(arguments[2]!=null){price=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(price)){return price;}}if(!luckysheet.func_methods.isRealNum(price)){return luckysheet.formula.error.v;}price=parseInt(price);if(price!=0&&price!=1&&price!=2){return luckysheet.formula.error.v;}//luckysheet.jfrefreshcell({ "v": "load...", "f": cell_fp }, cell_r, cell_c);
  $.post("/dataqk/tu/api/getstockinfo",{"stockCode":stockcode,"date":date,"price":price,type:"2"},function(data){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);luckysheet.formula.execFunctionGroup(cell_r,cell_c,data);d[cell_r][cell_c]={"v":data,"f":cell_fp};luckysheet.jfrefreshgrid(d,[{"row":[cell_r,cell_r],"column":[cell_c,cell_c]}]);});return "loading...";}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DATA_CN_STOCK_MIN":function DATA_CN_STOCK_MIN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//股票代码
  var stockcode=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(stockcode)){return stockcode;}//日期
  var date=null;if(arguments[1]!=null){var data_date=arguments[1];if(luckysheet.getObjType(data_date)=="array"){return luckysheet.formula.error.v;}else if(luckysheet.getObjType(data_date)=="object"&&data_date.startCell!=null){if(data_date.data!=null&&luckysheet.getObjType(data_date.data)!="array"&&data_date.data.ct!=null&&data_date.data.ct.t=="d"){date=luckysheet.mask.update("yyyy-mm-dd",data_date.data.v);}else {return luckysheet.formula.error.v;}}else {date=data_date;}if(!luckysheet.datecontroll.isdatetime(date)){return [luckysheet.formula.error.v,"日期错误"];}date=moment(date).format("YYYY-MM-DD");}//复权除权
  var price=0;if(arguments[2]!=null){price=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(price)){return price;}}if(!luckysheet.func_methods.isRealNum(price)){return luckysheet.formula.error.v;}price=parseInt(price);if(price!=0&&price!=1&&price!=2){return luckysheet.formula.error.v;}//luckysheet.jfrefreshcell({ "v": "load...", "f": cell_fp }, cell_r, cell_c);
  $.post("/dataqk/tu/api/getstockinfo",{"stockCode":stockcode,"date":date,"price":price,type:"3"},function(data){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);luckysheet.formula.execFunctionGroup(cell_r,cell_c,data);d[cell_r][cell_c]={"v":data,"f":cell_fp};luckysheet.jfrefreshgrid(d,[{"row":[cell_r,cell_r],"column":[cell_c,cell_c]}]);});return "loading...";}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DATA_CN_STOCK_VOLUMN":function DATA_CN_STOCK_VOLUMN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//股票代码
  var stockcode=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(stockcode)){return stockcode;}//日期
  var date=null;if(arguments[1]!=null){var data_date=arguments[1];if(luckysheet.getObjType(data_date)=="array"){return luckysheet.formula.error.v;}else if(luckysheet.getObjType(data_date)=="object"&&data_date.startCell!=null){if(data_date.data!=null&&luckysheet.getObjType(data_date.data)!="array"&&data_date.data.ct!=null&&data_date.data.ct.t=="d"){date=luckysheet.mask.update("yyyy-mm-dd",data_date.data.v);}else {return luckysheet.formula.error.v;}}else {date=data_date;}if(!luckysheet.datecontroll.isdatetime(date)){return [luckysheet.formula.error.v,"日期错误"];}date=moment(date).format("YYYY-MM-DD");}//复权除权
  var price=0;if(arguments[2]!=null){price=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(price)){return price;}}if(!luckysheet.func_methods.isRealNum(price)){return luckysheet.formula.error.v;}price=parseInt(price);if(price!=0&&price!=1&&price!=2){return luckysheet.formula.error.v;}//luckysheet.jfrefreshcell({ "v": "load...", "f": cell_fp }, cell_r, cell_c);
  $.post("/dataqk/tu/api/getstockinfo",{"stockCode":stockcode,"date":date,"price":price,type:"4"},function(data){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);luckysheet.formula.execFunctionGroup(cell_r,cell_c,data);d[cell_r][cell_c]={"v":data,"f":cell_fp};luckysheet.jfrefreshgrid(d,[{"row":[cell_r,cell_r],"column":[cell_c,cell_c]}]);});return "loading...";}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DATA_CN_STOCK_AMOUNT":function DATA_CN_STOCK_AMOUNT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//股票代码
  var stockcode=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(stockcode)){return stockcode;}//日期
  var date=null;if(arguments[1]!=null){var data_date=arguments[1];if(luckysheet.getObjType(data_date)=="array"){return luckysheet.formula.error.v;}else if(luckysheet.getObjType(data_date)=="object"&&data_date.startCell!=null){if(data_date.data!=null&&luckysheet.getObjType(data_date.data)!="array"&&data_date.data.ct!=null&&data_date.data.ct.t=="d"){date=luckysheet.mask.update("yyyy-mm-dd",data_date.data.v);}else {return luckysheet.formula.error.v;}}else {date=data_date;}if(!luckysheet.datecontroll.isdatetime(date)){return [luckysheet.formula.error.v,"日期错误"];}date=moment(date).format("YYYY-MM-DD");}//复权除权
  var price=0;if(arguments[2]!=null){price=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(price)){return price;}}if(!luckysheet.func_methods.isRealNum(price)){return luckysheet.formula.error.v;}price=parseInt(price);if(price!=0&&price!=1&&price!=2){return luckysheet.formula.error.v;}//luckysheet.jfrefreshcell({ "v": "load...", "f": cell_fp }, cell_r, cell_c);
  $.post("/dataqk/tu/api/getstockinfo",{"stockCode":stockcode,"date":date,"price":price,type:"5"},function(data){var d=luckysheet.editor.deepCopyFlowData(luckysheet.flowdata);luckysheet.formula.execFunctionGroup(cell_r,cell_c,data);d[cell_r][cell_c]={"v":data,"f":cell_fp};luckysheet.jfrefreshgrid(d,[{"row":[cell_r,cell_r],"column":[cell_c,cell_c]}]);});return "loading...";}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISDATE":function ISDATE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//日期
  var date=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(date)){return date;}return luckysheet.datecontroll.isdatetime(date);}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SUMIF":function SUMIF(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//=SUMIF(A2:A5,">1600000",B2:B5)
  //=SUMIF(A2:A5,">1600000")
  //=SUMIF(A2:A5,3000000,B2:B5)
  //找出range中匹配的字符串
  var sum=0;var rangeData=arguments[0].data;var rangeRow=arguments[0].rowl;var rangeCol=arguments[0].coll;var criteria=luckysheet_parseData(arguments[1]);rangeData=luckysheet.formula.getRangeArray(rangeData)[0];//如果有第三个参数
  if(arguments[2]){var sumRangeData=[];//根据选择的目标的区域确定实际目标区域
  //初始位置
  var sumRangeStart=arguments[2].startCell;var sumRangeRow=arguments[2].rowl;var sumRangeCol=arguments[2].coll;var sumRangeSheet=arguments[2].sheetName;if(rangeRow==sumRangeRow&&rangeCol==sumRangeCol){sumRangeData=arguments[2].data;}else {var row=[],col=[];var sumRangeEnd="";var realSumRange="";//console.log("开始位置！！！",sumRangeStart,typeof(sumRangeStart));
  row[0]=parseInt(sumRangeStart.replace(/[^0-9]/g,""))-1;col[0]=luckysheet.luckysheetABCatNum(sumRangeStart.replace(/[^A-Za-z]/g,""));//根据第一个范围的长宽确定目标范围的末尾位置
  row[1]=row[0]+rangeRow-1;col[1]=col[0]+rangeCol-1;//console.log(row[0],col[0],row[1],col[1]);
  //末尾位置转化为sheet格式：如 F4 
  var real_ABC=luckysheet.luckysheetchatatABC(col[1]);var real_Num=row[1]+1;sumRangeEnd=real_ABC+real_Num;//console.log("合成新的末尾位置：" + sumRangeEnd);
  realSumRange=sumRangeSheet+"!"+sumRangeStart+":"+sumRangeEnd;sumRangeData=luckysheet_getcelldata(realSumRange).data;//console.log("最终的目标范围：",sumRangeData);
  }sumRangeData=luckysheet.formula.getRangeArray(sumRangeData)[0];//循环遍历查找匹配项
  for(var i=0;i<rangeData.length;i++){var v=rangeData[i];if(!!v&&luckysheet.formula.acompareb(v,criteria)){if(!luckysheet.func_methods.isRealNum(sumRangeData[i])){continue;}sum+=parseFloat(sumRangeData[i]);}}}else {//循环遍历查找匹配项
  for(var i=0;i<rangeData.length;i++){var v=rangeData[i];if(!!v&&luckysheet.formula.acompareb(v,criteria)){if(!luckysheet.func_methods.isRealNum(v)){continue;}sum+=parseFloat(v);}}}return sum;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TAN":function TAN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);return Math.tan(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TANH":function TANH(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);var e2=Math.exp(2*number);return (e2-1)/(e2+1);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CEILING":function CEILING(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//number
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//significance
  var significance=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(significance)){return significance;}if(!luckysheet.func_methods.isRealNum(significance)){return luckysheet.formula.error.v;}significance=parseFloat(significance);if(significance==0){return 0;}if(number>0&&significance<0){return luckysheet.formula.error.nm;}return Math.ceil(number/significance)*significance;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ATAN":function ATAN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);return Math.atan(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ASINH":function ASINH(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);return Math.log(number+Math.sqrt(number*number+1));}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ABS":function ABS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);return Math.abs(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ACOS":function ACOS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);if(number<-1||number>1){return luckysheet.formula.error.nm;}return Math.acos(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ACOSH":function ACOSH(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);if(number<1){return luckysheet.formula.error.nm;}return Math.log(number+Math.sqrt(number*number-1));}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MULTINOMIAL":function MULTINOMIAL(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {dataArr.push(data);}}var sum=0,divisor=1;for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);if(number<0){return luckysheet.formula.error.nm;}sum+=number;divisor*=luckysheet.func_methods.factorial(number);}return luckysheet.func_methods.factorial(sum)/divisor;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ATANH":function ATANH(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);if(number<=-1||number>=1){return luckysheet.formula.error.nm;}return Math.log((1+number)/(1-number))/2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ATAN2":function ATAN2(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要计算其与x轴夹角大小的线段的终点x坐标
  var number_x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number_x)){return number_x;}if(!luckysheet.func_methods.isRealNum(number_x)){return luckysheet.formula.error.v;}number_x=parseFloat(number_x);//要计算其与x轴夹角大小的线段的终点y坐标
  var number_y=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(number_y)){return number_y;}if(!luckysheet.func_methods.isRealNum(number_y)){return luckysheet.formula.error.v;}number_y=parseFloat(number_y);if(number_x==0&&number_y==0){return luckysheet.formula.error.d;}return Math.atan2(number_y,number_x);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COUNTBLANK":function COUNTBLANK(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var data=arguments[0];var sum=0;if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){if(data.data==null){return 1;}if(luckysheet.getObjType(data.data)=="array"){for(var r=0;r<data.data.length;r++){for(var c=0;c<data.data[r].length;c++){if(data.data[r][c]==null||luckysheet.func_methods.isRealNull(data.data[r][c].v)){sum++;}}}}else {if(luckysheet.func_methods.isRealNull(data.data.v)){sum++;}}}return sum;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COSH":function COSH(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);return (Math.exp(number)+Math.exp(-number))/2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"INT":function INT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var data=arguments[0];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}if(!luckysheet.func_methods.isRealNum(data[0][0])){return luckysheet.formula.error.v;}return Math.floor(parseFloat(data[0][0]));}else {if(!luckysheet.func_methods.isRealNum(data[0])){return luckysheet.formula.error.v;}return Math.floor(parseFloat(data[0]));}}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){if(data.coll>1){return luckysheet.formula.error.v;}if(data.rowl>1){var cellrange=luckysheet.formula.getcellrange(data.startCell);var str=cellrange.row[0];if(window.luckysheetCurrentRow<str||window.luckysheetCurrentRow>str+data.rowl-1){return luckysheet.formula.error.v;}var cell=data.data[window.luckysheetCurrentRow-str][0];}else {var cell=data.data;}if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){return 0;}if(!luckysheet.func_methods.isRealNum(cell.v)){return luckysheet.formula.error.v;}return Math.floor(parseFloat(cell.v));}else {if(luckysheet.getObjType(data)=="boolean"){if(data.toString().toLowerCase()=="true"){return 1;}if(data.toString().toLowerCase()=="false"){return 0;}}if(!luckysheet.func_methods.isRealNum(data)){return luckysheet.formula.error.v;}return Math.floor(parseFloat(data));}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISEVEN":function ISEVEN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseInt(number);return Math.abs(number)&1?false:true;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISODD":function ISODD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseInt(number);return Math.abs(number)&1?true:false;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LCM":function LCM(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var o=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}o=o.concat(luckysheet.func_methods.getDataArr(data));}else {o=o.concat(data);}}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){o=o.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {o.push(data);}}for(var y=0;y<o.length;y++){var number=o[y];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseInt(number);if(number<0){return luckysheet.formula.error.nm;}o[y]=number;}for(var i,j,n,d,r=1;(n=o.pop())!==undefined;){if(n==0){r=0;}while(n>1){if(n%2){for(i=3,j=Math.floor(Math.sqrt(n));i<=j&&n%i;i+=2){//empty
  }d=i<=j?i:n;}else {d=2;}for(n/=d,r*=d,i=o.length;i;o[--i]%d===0&&(o[i]/=d)===1&&o.splice(i,1)){//empty
  }}}if(r>=Math.pow(2,53)){return luckysheet.formula.error.nm;}return r;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LN":function LN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);if(number<=0){return luckysheet.formula.error.nm;}return Math.log(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LOG":function LOG(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);if(number<=0){return luckysheet.formula.error.nm;}if(arguments.length==2){var base=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(base)){return base;}if(!luckysheet.func_methods.isRealNum(base)){return luckysheet.formula.error.v;}base=parseFloat(base);if(base<=0){return luckysheet.formula.error.nm;}}else {var base=10;}return Math.log(number)/Math.log(base);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LOG10":function LOG10(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);if(number<=0){return luckysheet.formula.error.nm;}return Math.log(number)/Math.log(10);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MOD":function MOD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//被除数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//除数
  var divisor=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(divisor)){return divisor;}if(!luckysheet.func_methods.isRealNum(divisor)){return luckysheet.formula.error.v;}divisor=parseFloat(divisor);if(divisor==0){return luckysheet.formula.error.d;}//计算结果
  var modulus=Math.abs(number%divisor);return divisor>0?modulus:-modulus;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MROUND":function MROUND(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要舍入的值
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//要舍入到的倍数
  var multiple=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(multiple)){return multiple;}if(!luckysheet.func_methods.isRealNum(multiple)){return luckysheet.formula.error.v;}multiple=parseFloat(multiple);if(number*multiple<0){return luckysheet.formula.error.nm;}//计算结果
  return Math.round(number/multiple)*multiple;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ODD":function ODD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);var temp=Math.ceil(Math.abs(number));temp=temp&1?temp:temp+1;return number>=0?temp:-temp;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SUMSQ":function SUMSQ(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {dataArr.push(data);}}var sum=0;if(dataArr.length>0){for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);sum+=number*number;}}return sum;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COMBIN":function COMBIN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//项目的数量
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseInt(number);//每一组合中项目的数量
  var number_chosen=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(number_chosen)){return number_chosen;}if(!luckysheet.func_methods.isRealNum(number_chosen)){return luckysheet.formula.error.v;}number_chosen=parseInt(number_chosen);if(number<0||number_chosen<0||number<number_chosen){return luckysheet.formula.error.nm;}//计算结果
  return luckysheet.func_methods.factorial(number)/(luckysheet.func_methods.factorial(number_chosen)*luckysheet.func_methods.factorial(number-number_chosen));}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SUBTOTAL":function SUBTOTAL(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var compute=function compute(function_num){switch(function_num){case 1://AVERAGE
  case 101:return window.luckysheet_function.AVERAGE.f.apply(window.luckysheet_function.AVERAGE,arr);break;case 2://COUNT
  case 102:return window.luckysheet_function.COUNT.f.apply(window.luckysheet_function.COUNT,arr);break;case 3://COUNTA
  case 103:return window.luckysheet_function.COUNTA.f.apply(window.luckysheet_function.COUNTA,arr);break;case 4://MAX
  case 104:return window.luckysheet_function.MAX.f.apply(window.luckysheet_function.MAX,arr);break;case 5://MIN
  case 105:return window.luckysheet_function.MIN.f.apply(window.luckysheet_function.MIN,arr);break;case 6://PRODUCT
  case 106:return window.luckysheet_function.PRODUCT.f.apply(window.luckysheet_function.PRODUCT,arr);break;case 7://STDEV
  case 107:return window.luckysheet_function.STDEVA.f.apply(window.luckysheet_function.STDEVA,arr);break;case 8://STDEVP
  case 108:return window.luckysheet_function.STDEVP.f.apply(window.luckysheet_function.STDEVP,arr);break;case 9://SUM
  case 109:return window.luckysheet_function.SUM.f.apply(window.luckysheet_function.SUM,arr);break;case 10://VAR
  case 110:return window.luckysheet_function.VAR_S.f.apply(window.luckysheet_function.VAR_S,arr);break;case 11://VARP
  case 111:return window.luckysheet_function.VAR_P.f.apply(window.luckysheet_function.VAR_P,arr);break;}};//数字 1-11 或 101-111，用于指定要为分类汇总使用的函数
  var data_function_num=arguments[0];var function_num;if(luckysheet.getObjType(data_function_num)=="array"){if(luckysheet.getObjType(data_function_num[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_function_num)){return luckysheet.formula.error.v;}function_num=[];for(var i=0;i<data_function_num.length;i++){var rowArr=[];for(var j=0;j<data_function_num[i].length;j++){rowArr.push(data_function_num[i][j]);}function_num.push(rowArr);}}else {function_num=[];for(var i=0;i<data_function_num.length;i++){function_num.push(data_function_num[i]);}}}else if(luckysheet.getObjType(data_function_num)=="object"&&data_function_num.startCell!=null){function_num=luckysheet.func_methods.getFirstValue(data_function_num);}else {function_num=data_function_num;}var arr=Array.prototype.slice.apply(arguments);arr.shift();//计算结果
  if(luckysheet.getObjType(function_num)=="array"){var result=[];if(luckysheet.getObjType(function_num[0])=="array"){for(var i=0;i<function_num.length;i++){var rowArr=[];for(var j=0;j<function_num[i].length;j++){var value=function_num[i][j];if(luckysheet.func_methods.valueIsError(value)){rowArr.push(value);}else if(!luckysheet.func_methods.isRealNum(value)){rowArr.push(luckysheet.formula.error.v);}else {value=parseInt(value);if(value<1||value>111||value>11&&value<101){rowArr.push(luckysheet.formula.error.v);}else {rowArr.push(compute(value));}}}result.push(rowArr);}}else {for(var i=0;i<function_num.length;i++){var value=function_num[i];if(luckysheet.func_methods.valueIsError(value)){result.push(value);}else if(!luckysheet.func_methods.isRealNum(value)){result.push(luckysheet.formula.error.v);}else {value=parseInt(value);if(value<1||value>111||value>11&&value<101){result.push(luckysheet.formula.error.v);}else {result.push(compute(value));}}}}return result;}else {if(luckysheet.func_methods.valueIsError(function_num)){return function_num;}if(!luckysheet.func_methods.isRealNum(function_num)){return luckysheet.formula.error.v;}function_num=parseInt(function_num);if(function_num<1||function_num>111||function_num>11&&function_num<101){return luckysheet.formula.error.v;}return compute(function_num);}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ASIN":function ASIN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);if(number<-1||number>1){return luckysheet.formula.error.nm;}return Math.asin(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COUNTIF":function COUNTIF(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var getCriteriaResult=function getCriteriaResult(range,criter){if(!/[<>=!*?]/.test(criter)){criter='=="'+criter+'"';}criter=criter.replace("<>","!=");var matches=0;if(luckysheet.getObjType(range)=="array"){for(var i=0;i<range.length;i++){for(var j=0;j<range[i].length;j++){if(range[i][j]!=null&&!luckysheet.func_methods.isRealNull(range[i][j].v)){var value=range[i][j].v;if(criter.indexOf("*")>-1||criter.indexOf("?")>-1){if(luckysheet.formula.isWildcard(value,criter)){matches++;}}else {if(typeof value!=='string'){if(eval(value+criter)){matches++;}}else {if(eval('"'+value+'"'+criter)){matches++;}}}}}}}else {if(range!=null&&!luckysheet.func_methods.isRealNull(range.v)){var value=range.v;if(criter.indexOf("*")>-1||criter.indexOf("?")>-1){if(luckysheet.formula.isWildcard(value,criter)){matches++;}}else {if(typeof value!=='string'){if(eval(value+criter)){matches++;}}else {if(eval('"'+value+'"'+criter)){matches++;}}}}}return matches;};//范围
  var data_range=arguments[0];var range;if(luckysheet.getObjType(data_range)=="object"&&data_range.startCell!=null){range=data_range.data;}else {return luckysheet.formula.error.v;}//条件
  var data_criteria=arguments[1];var criteria;if(luckysheet.getObjType(data_criteria)=="array"){criteria=[];if(luckysheet.getObjType(data_criteria[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_criteria)){return luckysheet.formula.error.v;}for(var i=0;i<data_criteria.length;i++){var rowArr=[];for(var j=0;j<data_criteria[i].length;j++){rowArr.push(data_criteria[i][j]);}criteria.push(rowArr);}}else {for(var i=0;i<data_criteria.length;i++){criteria.push(data_criteria[i]);}}}else if(luckysheet.getObjType(data_criteria)=="object"&&data_criteria.startCell!=null){if(data_criteria.rowl>1||data_criteria.coll>1){return 0;}criteria=data_criteria.data;}else {criteria=data_criteria;}//计算
  if(luckysheet.getObjType(criteria)=="array"){var result=[];if(luckysheet.getObjType(criteria[0])=="array"){for(var i=0;i<criteria.length;i++){var rowArr=[];for(var j=0;j<criteria[i].length;j++){rowArr.push(getCriteriaResult(range,criteria[i][j]));}result.push(rowArr);}}else {for(var i=0;i<criteria.length;i++){result.push(getCriteriaResult(range,criteria[i]));}}return result;}else {return getCriteriaResult(range,criteria);}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"RADIANS":function RADIANS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);return number*Math.PI/180;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"RAND":function RAND(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}try{return Math.floor(Math.random()*1000000000)/1000000000;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COUNTUNIQUE":function COUNTUNIQUE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"text",true));}else {dataArr.push(data);}}return window.luckysheet_function.UNIQUE.f(dataArr);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DEGREES":function DEGREES(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);return number*180/Math.PI;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ERFC":function ERFC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);return jStat.erfc(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"EVEN":function EVEN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);var temp=Math.ceil(Math.abs(number));temp=temp&1?temp+1:temp;return number>0?temp:-temp;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"EXP":function EXP(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);return Math.exp(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FACT":function FACT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){if(luckysheet.getObjType(number)=="boolean"){if(number.toString().toLowerCase()=="true"){number=1;}else if(number.toString().toLowerCase()=="false"){number=0;}}else {return luckysheet.formula.error.v;}}number=parseInt(number);if(number<0){return luckysheet.formula.error.nm;}return luckysheet.func_methods.factorial(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FACTDOUBLE":function FACTDOUBLE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){if(luckysheet.getObjType(number)=="boolean"){if(number.toString().toLowerCase()=="true"){number=1;}else if(number.toString().toLowerCase()=="false"){number=0;}}else {return luckysheet.formula.error.v;}}number=parseInt(number);if(number<0){return luckysheet.formula.error.nm;}return luckysheet.func_methods.factorialDouble(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PI":function PI(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}try{return Math.PI;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FLOOR":function FLOOR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//number
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//significance
  var significance=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(significance)){return significance;}if(!luckysheet.func_methods.isRealNum(significance)){return luckysheet.formula.error.v;}significance=parseFloat(significance);if(significance==0){return luckysheet.formula.error.d;}if(number>0&&significance<0){return luckysheet.formula.error.nm;}//计算
  var precision=-Math.floor(Math.log(Math.abs(significance))/Math.log(10));if(number>=0){return Math.floor(number/significance)*significance*Math.pow(10,precision)/Math.pow(10,precision);}else {return -(Math.ceil(Math.abs(number)/significance)*significance*Math.pow(10,precision))/Math.pow(10,precision);}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"GCD":function GCD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,false));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",false));}else {dataArr.push(data);}}if(!luckysheet.func_methods.isRealNum(dataArr[0])){return luckysheet.formula.error.v;}var x=parseInt(dataArr[0]);if(x<0||x>=Math.pow(2,53)){return luckysheet.formula.error.nm;}for(var i=1;i<dataArr.length;i++){var y=dataArr[i];if(!luckysheet.func_methods.isRealNum(y)){return luckysheet.formula.error.v;}y=parseInt(y);if(y<0||y>=Math.pow(2,53)){return luckysheet.formula.error.nm;}while(x&&y){if(x>y){x%=y;}else {y%=x;}}x+=y;}return x;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"RANDBETWEEN":function RANDBETWEEN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//下界
  var bottom=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(bottom)){return bottom;}if(!luckysheet.func_methods.isRealNum(bottom)){return luckysheet.formula.error.v;}bottom=parseInt(bottom);//上界
  var top=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(top)){return top;}if(!luckysheet.func_methods.isRealNum(top)){return luckysheet.formula.error.v;}top=parseInt(top);if(bottom>top){return luckysheet.formula.error.nm;}//计算
  return bottom+Math.ceil((top-bottom+1)*Math.random())-1;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ROUND":function ROUND(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//四舍五入的数字
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//位数
  var digits=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(digits)){return digits;}if(!luckysheet.func_methods.isRealNum(digits)){return luckysheet.formula.error.v;}digits=parseInt(digits);//计算
  var sign=number>0?1:-1;return sign*Math.round(Math.abs(number)*Math.pow(10,digits))/Math.pow(10,digits);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ROUNDDOWN":function ROUNDDOWN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//四舍五入的数字
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//位数
  var digits=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(digits)){return digits;}if(!luckysheet.func_methods.isRealNum(digits)){return luckysheet.formula.error.v;}digits=parseInt(digits);//计算
  var sign=number>0?1:-1;return sign*Math.floor(Math.abs(number)*Math.pow(10,digits))/Math.pow(10,digits);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ROUNDUP":function ROUNDUP(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//四舍五入的数字
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//位数
  var digits=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(digits)){return digits;}if(!luckysheet.func_methods.isRealNum(digits)){return luckysheet.formula.error.v;}digits=parseInt(digits);//计算
  var sign=number>0?1:-1;return sign*Math.ceil(Math.abs(number)*Math.pow(10,digits))/Math.pow(10,digits);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SERIESSUM":function SERIESSUM(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//幂级数的输入值
  var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);//x 的首项乘幂
  var n=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(n)){return n;}if(!luckysheet.func_methods.isRealNum(n)){return luckysheet.formula.error.v;}n=parseFloat(n);//级数中每一项的乘幂 n 的步长增加值
  var m=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(m)){return m;}if(!luckysheet.func_methods.isRealNum(m)){return luckysheet.formula.error.v;}m=parseFloat(m);//与 x 的每个连续乘幂相乘的一组系数
  var data_coefficients=arguments[3];var coefficients=[];if(luckysheet.getObjType(data_coefficients)=="array"){if(luckysheet.getObjType(data_coefficients[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_coefficients)){return luckysheet.formula.error.v;}coefficients=coefficients.concat(luckysheet.func_methods.getDataArr(data_coefficients,false));}else if(luckysheet.getObjType(data_coefficients)=="object"&&data_coefficients.startCell!=null){coefficients=coefficients.concat(luckysheet.func_methods.getCellDataArr(data_coefficients,"number",false));}else {coefficients.push(data_coefficients);}//计算
  if(!luckysheet.func_methods.isRealNum(coefficients[0])){return luckysheet.formula.error.v;}var result=parseFloat(coefficients[0])*Math.pow(x,n);for(var i=1;i<coefficients.length;i++){var number=coefficients[i];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);result+=number*Math.pow(x,n+i*m);}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SIGN":function SIGN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);if(number>0){return 1;}else if(number==0){return 0;}else if(number<0){return -1;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SIN":function SIN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);return Math.sin(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SINH":function SINH(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);return (Math.exp(number)-Math.exp(-number))/2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SQRT":function SQRT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);if(number<0){return luckysheet.formula.error.nm;}return Math.sqrt(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SQRTPI":function SQRTPI(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);if(number<0){return luckysheet.formula.error.nm;}return Math.sqrt(number*Math.PI);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"GAMMALN":function GAMMALN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);if(number<=0){return luckysheet.formula.error.nm;}return jStat.gammaln(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COS":function COS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);return Math.cos(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TRUNC":function TRUNC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要截取的数据
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//位数
  if(arguments.length==2){var digits=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(digits)){return digits;}if(!luckysheet.func_methods.isRealNum(digits)){return luckysheet.formula.error.v;}digits=parseInt(digits);}else {var digits=0;}//计算
  var sign=number>0?1:-1;return sign*Math.floor(Math.abs(number)*Math.pow(10,digits))/Math.pow(10,digits);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"QUOTIENT":function QUOTIENT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//被除数
  var numerator=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(numerator)){return numerator;}if(!luckysheet.func_methods.isRealNum(numerator)){return luckysheet.formula.error.v;}numerator=parseFloat(numerator);//除数
  var denominator=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(denominator)){return denominator;}if(!luckysheet.func_methods.isRealNum(denominator)){return luckysheet.formula.error.v;}denominator=parseFloat(denominator);if(denominator==0){return luckysheet.formula.error.d;}//计算
  return parseInt(numerator/denominator,10);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"POWER":function POWER(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//底数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//指数
  var power=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(power)){return power;}if(!luckysheet.func_methods.isRealNum(power)){return luckysheet.formula.error.v;}power=parseFloat(power);if(number==0&&power==0){return luckysheet.formula.error.nm;}if(number<0&&power.toString().indexOf(".")>-1){return luckysheet.formula.error.nm;}return Math.pow(number,power);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SUMIFS":function SUMIFS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var sum=0;var args=arguments;luckysheet_getValue(args);var rangeData=luckysheet.formula.getRangeArray(args[0])[0];var results=new Array(rangeData.length);for(var i=0;i<results.length;i++){results[i]=true;}for(var i=1;i<args.length;i+=2){var range=luckysheet.formula.getRangeArray(args[i])[0];var criteria=args[i+1];for(var j=0;j<range.length;j++){var v=range[j];results[j]=results[j]&&!!v&&luckysheet.formula.acompareb(v,criteria);}}for(var i=0;i<rangeData.length;i++){if(results[i]){sum+=parseFloat(rangeData[i]);}}return sum;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COUNTIFS":function COUNTIFS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var args=arguments;luckysheet_getValue(args);var results=new Array(luckysheet.formula.getRangeArray(args[0])[0].length);for(var i=0;i<results.length;i++){results[i]=true;}for(var i=0;i<args.length;i+=2){var range=luckysheet.formula.getRangeArray(args[i])[0];var criteria=args[i+1];for(var j=0;j<range.length;j++){var v=range[j];results[j]=results[j]&&!!v&&luckysheet.formula.acompareb(v,criteria);}}var result=0;for(var i=0;i<results.length;i++){if(results[i]){result++;}}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PRODUCT":function PRODUCT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {dataArr.push(data);}}var result=1;for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);result*=number;}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"HARMEAN":function HARMEAN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {dataArr.push(data);}}var den=0,len=0;for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);if(number<=0){return luckysheet.formula.error.nm;}den+=1/number;len++;}return len/den;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"HYPGEOMDIST":function HYPGEOMDIST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//计算
  var pdf=function pdf(x,n,M,N){var a=luckysheet.func_methods.factorial(M)/(luckysheet.func_methods.factorial(x)*luckysheet.func_methods.factorial(M-x));var b=luckysheet.func_methods.factorial(N-M)/(luckysheet.func_methods.factorial(n-x)*luckysheet.func_methods.factorial(N-M-n+x));var c=luckysheet.func_methods.factorial(N)/(luckysheet.func_methods.factorial(n)*luckysheet.func_methods.factorial(N-n));return a*b/c;};var cdf=function cdf(x,n,M,N){var sum=0;for(var i=0;i<=x;i++){sum+=pdf(i,n,M,N);}return sum;};//样本中成功的次数
  var sample_s=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(sample_s)){return sample_s;}if(!luckysheet.func_methods.isRealNum(sample_s)){return luckysheet.formula.error.v;}sample_s=parseInt(sample_s);//样本量
  var number_sample=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(number_sample)){return number_sample;}if(!luckysheet.func_methods.isRealNum(number_sample)){return luckysheet.formula.error.v;}number_sample=parseInt(number_sample);//总体中成功的次数
  var population_s=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(population_s)){return population_s;}if(!luckysheet.func_methods.isRealNum(population_s)){return luckysheet.formula.error.v;}population_s=parseInt(population_s);//总体大小
  var number_pop=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(number_pop)){return number_pop;}if(!luckysheet.func_methods.isRealNum(number_pop)){return luckysheet.formula.error.v;}number_pop=parseInt(number_pop);//决定函数形式的逻辑值
  var cumulative=luckysheet.func_methods.getCellBoolen(arguments[4]);if(luckysheet.func_methods.valueIsError(cumulative)){return cumulative;}if(sample_s<0||sample_s>Math.min(number_sample,population_s)||sample_s<Math.max(0,number_sample-number_pop+population_s)){return luckysheet.formula.error.nm;}if(number_sample<=0||number_sample>number_pop){return luckysheet.formula.error.nm;}if(population_s<=0||population_s>number_pop){return luckysheet.formula.error.nm;}if(number_pop<=0){return luckysheet.formula.error.nm;}return cumulative?cdf(sample_s,number_sample,population_s,number_pop):pdf(sample_s,number_sample,population_s,number_pop);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"INTERCEPT":function INTERCEPT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//x轴上用于预测的值
  var x=0;//代表因变量数据数组或矩阵的范围
  var data_known_y=arguments[0];var known_y=[];if(luckysheet.getObjType(data_known_y)=="array"){if(luckysheet.getObjType(data_known_y[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_y)){return luckysheet.formula.error.v;}known_y=known_y.concat(luckysheet.func_methods.getDataArr(data_known_y,false));}else if(luckysheet.getObjType(data_known_y)=="object"&&data_known_y.startCell!=null){known_y=known_y.concat(luckysheet.func_methods.getCellDataArr(data_known_y,"text",false));}else {known_y.push(data_known_y);}//代表自变量数据数组或矩阵的范围
  var data_known_x=arguments[1];var known_x=[];if(luckysheet.getObjType(data_known_x)=="array"){if(luckysheet.getObjType(data_known_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_x)){return luckysheet.formula.error.v;}known_x=known_x.concat(luckysheet.func_methods.getDataArr(data_known_x,false));}else if(luckysheet.getObjType(data_known_x)=="object"&&data_known_x.startCell!=null){known_x=known_x.concat(luckysheet.func_methods.getCellDataArr(data_known_x,"text",false));}else {known_x.push(data_known_x);}if(known_y.length!=known_x.length){return luckysheet.formula.error.na;}//known_y 和 known_x 只取数值
  var data_y=[],data_x=[];for(var i=0;i<known_y.length;i++){var num_y=known_y[i];var num_x=known_x[i];if(luckysheet.func_methods.isRealNum(num_y)&&luckysheet.func_methods.isRealNum(num_x)){data_y.push(parseFloat(num_y));data_x.push(parseFloat(num_x));}}if(luckysheet.func_methods.variance_s(data_x)==0){return luckysheet.formula.error.d;}//计算
  var xmean=jStat.mean(data_x);var ymean=jStat.mean(data_y);var n=data_x.length;var num=0;var den=0;for(var i=0;i<n;i++){num+=(data_x[i]-xmean)*(data_y[i]-ymean);den+=Math.pow(data_x[i]-xmean,2);}var b=num/den;var a=ymean-b*xmean;return a+b*x;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"KURT":function KURT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"text",true));}else {dataArr.push(data);}}//剔除不是数值类型的值
  var dataArr_n=[];for(var j=0;j<dataArr.length;j++){var number=dataArr[j];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);dataArr_n.push(number);}if(dataArr_n.length<4||luckysheet.func_methods.standardDeviation_s(dataArr_n)==0){return luckysheet.formula.error.d;}//计算
  var mean=jStat.mean(dataArr_n);var n=dataArr_n.length;var sigma=0;for(var i=0;i<n;i++){sigma+=Math.pow(dataArr_n[i]-mean,4);}sigma=sigma/Math.pow(jStat.stdev(dataArr_n,true),4);return n*(n+1)/((n-1)*(n-2)*(n-3))*sigma-3*(n-1)*(n-1)/((n-2)*(n-3));}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LARGE":function LARGE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数组或范围
  var dataArr=[];if(luckysheet.getObjType(arguments[0])=="array"){if(luckysheet.getObjType(arguments[0][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[0])){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(arguments[0],true));}else if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(arguments[0],"text",true));}else {dataArr.push(arguments[0]);}var dataArr_n=[];for(var j=0;j<dataArr.length;j++){var number=dataArr[j];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);dataArr_n.push(number);}//要返回的元素的排行位置
  var n;if(luckysheet.getObjType(arguments[1])=="array"){if(luckysheet.getObjType(arguments[1][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[1])){return luckysheet.formula.error.v;}n=luckysheet.func_methods.getDataArr(arguments[1]);}else if(luckysheet.getObjType(arguments[1])=="object"&&arguments[1].startCell!=null){if(arguments[1].rowl>1||arguments[1].coll>1){return luckysheet.formula.error.v;}var cell=arguments[1].data;if(cell==null||luckysheet.func_methods.isRealNull(cell.v)){var n=0;}else {var n=cell.v;}}else {n=arguments[1];}//计算
  if(luckysheet.getObjType(n)=="array"){if(dataArr_n.length==0){return luckysheet.formula.error.nm;}var result=[];for(var i=0;i<n.length;i++){if(!luckysheet.func_methods.isRealNum(n[i])){result.push(luckysheet.formula.error.v);continue;}n[i]=Math.ceil(parseFloat(n[i]));if(n[i]<=0||n[i]>dataArr_n.length){result.push(luckysheet.formula.error.nm);continue;}result.push(dataArr.sort(function(a,b){return b-a;})[n[i]-1]);}return result;}else {if(!luckysheet.func_methods.isRealNum(n)){return luckysheet.formula.error.v;}n=Math.ceil(parseFloat(n));if(dataArr_n.length==0){return luckysheet.formula.error.nm;}if(n<=0||n>dataArr_n.length){return luckysheet.formula.error.nm;}return dataArr.sort(function(a,b){return b-a;})[n-1];}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"STDEVA":function STDEVA(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,false));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"text",false));}else {dataArr.push(data);}}//不是数值类型的值转化成数字（true为1，false和文本为0）
  var dataArr_n=[];for(var j=0;j<dataArr.length;j++){var number=dataArr[j];if(!luckysheet.func_methods.isRealNum(number)){if(number.toString().toLowerCase()=="true"){number=1;}else {number=0;}}else {number=parseFloat(number);}dataArr_n.push(number);}if(dataArr_n.length==0){return 0;}if(dataArr_n.length==1){return luckysheet.formula.error.d;}return luckysheet.func_methods.standardDeviation_s(dataArr_n);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"STDEVP":function STDEVP(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"text",true));}else {dataArr.push(data);}}//剔除不是数值类型的值
  var dataArr_n=[];for(var j=0;j<dataArr.length;j++){var number=dataArr[j];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);dataArr_n.push(number);}if(dataArr_n.length==0){return 0;}if(dataArr_n.length==1){return luckysheet.formula.error.d;}return luckysheet.func_methods.standardDeviation(dataArr_n);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"GEOMEAN":function GEOMEAN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"text",true));}else {if(luckysheet.getObjType(data)=="boolean"){if(data.toString().toLowerCase()=="true"){dataArr.push(1);}else if(data.toString().toLowerCase()=="false"){dataArr.push(0);}}else if(luckysheet.func_methods.isRealNum(data)){dataArr.push(data);}else {return luckysheet.formula.error.v;}}}//剔除不是数值类型的值
  var dataArr_n=[];for(var j=0;j<dataArr.length;j++){var number=dataArr[j];if(!luckysheet.func_methods.isRealNum(number)){continue;}number=parseFloat(number);if(number<=0){return luckysheet.formula.error.nm;}dataArr_n.push(number);}if(dataArr_n.length==0){return luckysheet.formula.error.nm;}return jStat.geomean(dataArr_n);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"RANK_EQ":function RANK_EQ(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要确定其排名的值
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//包含相关数据集的数组或范围
  var data_ref=arguments[1];var ref=[];if(luckysheet.getObjType(data_ref)=="array"){if(luckysheet.getObjType(data_ref[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_ref)){return luckysheet.formula.error.v;}ref=ref.concat(luckysheet.func_methods.getDataArr(data_ref,true));}else if(luckysheet.getObjType(data_ref)=="object"&&data_ref.startCell!=null){ref=ref.concat(luckysheet.func_methods.getCellDataArr(data_ref,"number",true));}else {ref.push(data_ref);}var ref_n=[];for(var j=0;j<ref.length;j++){var num=ref[j];if(!luckysheet.func_methods.isRealNum(num)){return luckysheet.formula.error.v;}num=parseFloat(num);ref_n.push(num);}//要按升序还是按降序考虑“data”中的值
  if(arguments.length==3){var order=luckysheet.func_methods.getCellBoolen(arguments[2]);if(luckysheet.func_methods.valueIsError(order)){return order;}}else {var order=false;}//计算
  var sort=order?function(a,b){return a-b;}:function(a,b){return b-a;};ref_n=ref_n.sort(sort);var index=ref_n.indexOf(number);if(index==-1){return luckysheet.formula.error.na;}else {return index+1;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"RANK_AVG":function RANK_AVG(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要确定其排名的值
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//包含相关数据集的数组或范围
  var data_ref=arguments[1];var ref=[];if(luckysheet.getObjType(data_ref)=="array"){if(luckysheet.getObjType(data_ref[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_ref)){return luckysheet.formula.error.v;}ref=ref.concat(luckysheet.func_methods.getDataArr(data_ref,true));}else if(luckysheet.getObjType(data_ref)=="object"&&data_ref.startCell!=null){ref=ref.concat(luckysheet.func_methods.getCellDataArr(data_ref,"number",true));}else {ref.push(data_ref);}var ref_n=[];for(var j=0;j<ref.length;j++){var num=ref[j];if(!luckysheet.func_methods.isRealNum(num)){return luckysheet.formula.error.v;}num=parseFloat(num);ref_n.push(num);}//要按升序还是按降序考虑“data”中的值
  if(arguments.length==3){var order=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(order)){return order;}if(luckysheet.getObjType(order)=="boolean"){}else if(luckysheet.getObjType(order)=="string"&&(order.toLowerCase()=="true"||order.toLowerCase()=="false")){if(order.toLowerCase()=="true"){order=true;}if(order.toLowerCase()=="false"){order=false;}}else if(luckysheet.func_methods.isRealNum(order)){order=parseFloat(order);order=order==0?false:true;}else {return luckysheet.formula.error.v;}}else {var order=false;}//计算
  var sort=order?function(a,b){return a-b;}:function(a,b){return b-a;};ref_n=ref_n.sort(sort);var count=0;for(var i=0;i<ref_n.length;i++){if(ref_n[i]==number){count++;}}return count>1?(2*ref_n.indexOf(number)+count+1)/2:ref_n.indexOf(number)+1;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PERCENTRANK_EXC":function PERCENTRANK_EXC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//包含相关数据集的数组或范围
  var data_ref=arguments[0];var ref=[];if(luckysheet.getObjType(data_ref)=="array"){if(luckysheet.getObjType(data_ref[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_ref)){return luckysheet.formula.error.v;}ref=ref.concat(luckysheet.func_methods.getDataArr(data_ref,true));}else if(luckysheet.getObjType(data_ref)=="object"&&data_ref.startCell!=null){ref=ref.concat(luckysheet.func_methods.getCellDataArr(data_ref,"number",true));}else {ref.push(data_ref);}var ref_n=[];for(var j=0;j<ref.length;j++){var number=ref[j];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);ref_n.push(number);}//要确定其百分比排位的值
  var x=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);//要在计算中使用的有效位数
  if(arguments.length==3){var significance=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(significance)){return significance;}if(!luckysheet.func_methods.isRealNum(significance)){return luckysheet.formula.error.v;}significance=parseInt(significance);}else {var significance=3;}if(ref_n.length==0){return luckysheet.formula.error.nm;}if(significance<1){return luckysheet.formula.error.nm;}//计算
  if(ref_n.length==1&&ref_n[0]==x){return 1;}ref_n=ref_n.sort(function(a,b){return a-b;});var uniques=window.luckysheet_function.UNIQUE.f(ref_n)[0];var n=ref_n.length;var m=uniques.length;var power=Math.pow(10,significance);var result=0;var match=false;var i=0;while(!match&&i<m){if(x===uniques[i]){result=(ref_n.indexOf(uniques[i])+1)/(n+1);match=true;}else if(x>=uniques[i]&&(x<uniques[i+1]||i===m-1)){result=(ref_n.lastIndexOf(uniques[i])+1+(x-uniques[i])/(uniques[i+1]-uniques[i]))/(n+1);match=true;}i++;}if(isNaN(result)){return luckysheet.formula.error.na;}else {return Math.floor(result*power)/power;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PERCENTRANK_INC":function PERCENTRANK_INC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//包含相关数据集的数组或范围
  var data_ref=arguments[0];var ref=[];if(luckysheet.getObjType(data_ref)=="array"){if(luckysheet.getObjType(data_ref[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_ref)){return luckysheet.formula.error.v;}ref=ref.concat(luckysheet.func_methods.getDataArr(data_ref,true));}else if(luckysheet.getObjType(data_ref)=="object"&&data_ref.startCell!=null){ref=ref.concat(luckysheet.func_methods.getCellDataArr(data_ref,"number",true));}else {ref.push(data_ref);}var ref_n=[];for(var j=0;j<ref.length;j++){var number=ref[j];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);ref_n.push(number);}//要确定其百分比排位的值
  var x=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);//要在计算中使用的有效位数
  if(arguments.length==3){var significance=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(significance)){return significance;}if(!luckysheet.func_methods.isRealNum(significance)){return luckysheet.formula.error.v;}significance=parseInt(significance);}else {var significance=3;}if(ref_n.length==0){return luckysheet.formula.error.nm;}if(significance<1){return luckysheet.formula.error.nm;}//计算
  if(ref_n.length==1&&ref_n[0]==x){return 1;}ref_n=ref_n.sort(function(a,b){return a-b;});var uniques=window.luckysheet_function.UNIQUE.f(ref_n)[0];var n=ref_n.length;var m=uniques.length;var power=Math.pow(10,significance);var result=0;var match=false;var i=0;while(!match&&i<m){if(x===uniques[i]){result=ref_n.indexOf(uniques[i])/(n-1);match=true;}else if(x>=uniques[i]&&(x<uniques[i+1]||i===m-1)){result=(ref_n.lastIndexOf(uniques[i])+(x-uniques[i])/(uniques[i+1]-uniques[i]))/(n-1);match=true;}i++;}if(isNaN(result)){return luckysheet.formula.error.na;}else {return Math.floor(result*power)/power;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FORECAST":function FORECAST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//x轴上用于预测的值
  var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);//代表因变量数据数组或矩阵的范围
  var data_known_y=arguments[1];var known_y=[];if(luckysheet.getObjType(data_known_y)=="array"){if(luckysheet.getObjType(data_known_y[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_y)){return luckysheet.formula.error.v;}known_y=known_y.concat(luckysheet.func_methods.getDataArr(data_known_y,false));}else if(luckysheet.getObjType(data_known_y)=="object"&&data_known_y.startCell!=null){known_y=known_y.concat(luckysheet.func_methods.getCellDataArr(data_known_y,"text",false));}else {known_y.push(data_known_y);}//代表自变量数据数组或矩阵的范围
  var data_known_x=arguments[2];var known_x=[];if(luckysheet.getObjType(data_known_x)=="array"){if(luckysheet.getObjType(data_known_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_x)){return luckysheet.formula.error.v;}known_x=known_x.concat(luckysheet.func_methods.getDataArr(data_known_x,false));}else if(luckysheet.getObjType(data_known_x)=="object"&&data_known_x.startCell!=null){known_x=known_x.concat(luckysheet.func_methods.getCellDataArr(data_known_x,"text",false));}else {known_x.push(data_known_x);}if(known_y.length!=known_x.length){return luckysheet.formula.error.na;}//known_y 和 known_x 只取数值
  var data_y=[],data_x=[];for(var i=0;i<known_y.length;i++){var num_y=known_y[i];var num_x=known_x[i];if(luckysheet.func_methods.isRealNum(num_y)&&luckysheet.func_methods.isRealNum(num_x)){data_y.push(parseFloat(num_y));data_x.push(parseFloat(num_x));}}if(luckysheet.func_methods.variance_s(data_x)==0){return luckysheet.formula.error.d;}//计算
  var xmean=jStat.mean(data_x);var ymean=jStat.mean(data_y);var n=data_x.length;var num=0;var den=0;for(var i=0;i<n;i++){num+=(data_x[i]-xmean)*(data_y[i]-ymean);den+=Math.pow(data_x[i]-xmean,2);}var b=num/den;var a=ymean-b*xmean;return a+b*x;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FISHERINV":function FISHERINV(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var y=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(y)){return y;}if(!luckysheet.func_methods.isRealNum(y)){return luckysheet.formula.error.v;}y=parseFloat(y);var e2y=Math.exp(2*y);return (e2y-1)/(e2y+1);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FISHER":function FISHER(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);if(x<=-1||x>=1){return luckysheet.formula.error.nm;}return Math.log((1+x)/(1-x))/2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MODE_SNGL":function MODE_SNGL(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(!luckysheet.func_methods.isRealNum(data)){return luckysheet.formula.error.v;}dataArr.push(data);}}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}}var count={};var maxItems=[];var max=0;var currentItem;for(var i=0;i<dataArr_n.length;i++){currentItem=dataArr_n[i];count[currentItem]=count[currentItem]?count[currentItem]+1:1;if(count[currentItem]>max){max=count[currentItem];maxItems=[];}if(count[currentItem]==max){maxItems[maxItems.length]=currentItem;}}if(max<=1){return luckysheet.formula.error.na;}var resultIndex=dataArr_n.indexOf(maxItems[0]);for(var j=0;j<maxItems.length;j++){var index=dataArr_n.indexOf(maxItems[j]);if(index<resultIndex){resultIndex=index;}}return dataArr_n[resultIndex];}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"WEIBULL_DIST":function WEIBULL_DIST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//WEIBULL 分布函数的输入值
  var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);//Weibull 分布函数的形状参数
  var alpha=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(alpha)){return alpha;}if(!luckysheet.func_methods.isRealNum(alpha)){return luckysheet.formula.error.v;}alpha=parseFloat(alpha);//Weibull 分布函数的尺度参数
  var beta=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(beta)){return beta;}if(!luckysheet.func_methods.isRealNum(beta)){return luckysheet.formula.error.v;}beta=parseFloat(beta);//决定函数形式的逻辑值
  var cumulative=luckysheet.func_methods.getCellBoolen(arguments[3]);if(luckysheet.func_methods.valueIsError(cumulative)){return cumulative;}if(x<0||alpha<=0||beta<=0){return luckysheet.formula.error.nm;}return cumulative?1-Math.exp(-Math.pow(x/beta,alpha)):Math.pow(x,alpha-1)*Math.exp(-Math.pow(x/beta,alpha))*alpha/Math.pow(beta,alpha);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"AVEDEV":function AVEDEV(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(!luckysheet.func_methods.isRealNum(data)){return luckysheet.formula.error.v;}dataArr.push(data);}}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}}if(dataArr_n.length==0){return luckysheet.formula.error.nm;}return jStat.sum(jStat(dataArr_n).subtract(jStat.mean(dataArr_n)).abs()[0])/dataArr_n.length;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"AVERAGEA":function AVERAGEA(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,false));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(number.toString.toLowerCase()=="true"){dataArr.push(1);}else if(number.toString.toLowerCase()=="false"){dataArr.push(0);}else if(luckysheet.func_methods.isRealNum(data)){dataArr.push(data);}else {return luckysheet.formula.error.v;}}}var sum=0,count=0;for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){sum+=parseFloat(number);}else {if(number.toString().toLowerCase()=="true"){sum+=1;}else {sum+=0;}}count++;}if(count==0){return luckysheet.formula.error.d;}return sum/count;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"BINOM_DIST":function BINOM_DIST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//试验的成功次数
  var number_s=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number_s)){return number_s;}if(!luckysheet.func_methods.isRealNum(number_s)){return luckysheet.formula.error.v;}number_s=parseInt(number_s);//独立检验的次数
  var trials=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(trials)){return trials;}if(!luckysheet.func_methods.isRealNum(trials)){return luckysheet.formula.error.v;}trials=parseInt(trials);//任一给定检验的成功概率
  var probability_s=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(probability_s)){return probability_s;}if(!luckysheet.func_methods.isRealNum(probability_s)){return luckysheet.formula.error.v;}probability_s=parseFloat(probability_s);//是否使用二项式累积分布
  var cumulative=luckysheet.func_methods.getCellBoolen(arguments[3]);if(luckysheet.func_methods.valueIsError(cumulative)){return cumulative;}if(number_s<0||number_s>trials){return luckysheet.formula.error.nm;}if(probability_s<0||probability_s>1){return luckysheet.formula.error.nm;}return cumulative?jStat.binomial.cdf(number_s,trials,probability_s):jStat.binomial.pdf(number_s,trials,probability_s);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"BINOM_INV":function BINOM_INV(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//贝努利试验次数
  var trials=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(trials)){return trials;}if(!luckysheet.func_methods.isRealNum(trials)){return luckysheet.formula.error.v;}trials=parseInt(trials);//任一次给定检验的成功概率
  var probability_s=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(probability_s)){return probability_s;}if(!luckysheet.func_methods.isRealNum(probability_s)){return luckysheet.formula.error.v;}probability_s=parseFloat(probability_s);//期望的临界概率
  var alpha=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(alpha)){return alpha;}if(!luckysheet.func_methods.isRealNum(alpha)){return luckysheet.formula.error.v;}alpha=parseFloat(alpha);if(trials<0){return luckysheet.formula.error.nm;}if(probability_s<0||probability_s>1){return luckysheet.formula.error.nm;}if(alpha<0||alpha>1){return luckysheet.formula.error.nm;}//计算
  var x=0;while(x<=trials){if(jStat.binomial.cdf(x,trials,probability_s)>=alpha){return x;}x++;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CONFIDENCE_NORM":function CONFIDENCE_NORM(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//置信水平
  var alpha=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(alpha)){return alpha;}if(!luckysheet.func_methods.isRealNum(alpha)){return luckysheet.formula.error.v;}alpha=parseFloat(alpha);//数据区域的总体标准偏差
  var standard_dev=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(standard_dev)){return standard_dev;}if(!luckysheet.func_methods.isRealNum(standard_dev)){return luckysheet.formula.error.v;}standard_dev=parseFloat(standard_dev);//样本总量的大小
  var size=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(size)){return size;}if(!luckysheet.func_methods.isRealNum(size)){return luckysheet.formula.error.v;}size=parseInt(size);if(alpha<=0||alpha>=1){return luckysheet.formula.error.nm;}if(standard_dev<=0){return luckysheet.formula.error.nm;}if(size<1){return luckysheet.formula.error.nm;}return jStat.normalci(1,alpha,standard_dev,size)[1]-1;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CORREL":function CORREL(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//代表因变量数据数组或矩阵的范围
  var data_known_y=arguments[0];var known_y=[];if(luckysheet.getObjType(data_known_y)=="array"){if(luckysheet.getObjType(data_known_y[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_y)){return luckysheet.formula.error.v;}known_y=known_y.concat(luckysheet.func_methods.getDataArr(data_known_y,false));}else if(luckysheet.getObjType(data_known_y)=="object"&&data_known_y.startCell!=null){known_y=known_y.concat(luckysheet.func_methods.getCellDataArr(data_known_y,"text",false));}else {known_y.push(data_known_y);}//代表自变量数据数组或矩阵的范围
  var data_known_x=arguments[1];var known_x=[];if(luckysheet.getObjType(data_known_x)=="array"){if(luckysheet.getObjType(data_known_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_x)){return luckysheet.formula.error.v;}known_x=known_x.concat(luckysheet.func_methods.getDataArr(data_known_x,false));}else if(luckysheet.getObjType(data_known_x)=="object"&&data_known_x.startCell!=null){known_x=known_x.concat(luckysheet.func_methods.getCellDataArr(data_known_x,"text",false));}else {known_x.push(data_known_x);}if(known_y.length!=known_x.length){return luckysheet.formula.error.na;}//known_y 和 known_x 只取数值
  var data_y=[],data_x=[];for(var i=0;i<known_y.length;i++){var num_y=known_y[i];var num_x=known_x[i];if(luckysheet.func_methods.isRealNum(num_y)&&luckysheet.func_methods.isRealNum(num_x)){data_y.push(parseFloat(num_y));data_x.push(parseFloat(num_x));}}if(data_y.length==0||data_x.length==0||luckysheet.func_methods.standardDeviation(data_y)==0||luckysheet.func_methods.standardDeviation(data_x)==0){return luckysheet.formula.error.d;}return jStat.corrcoeff(data_y,data_x);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COVARIANCE_P":function COVARIANCE_P(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//代表自变量数据数组或矩阵的范围
  var data_known_x=arguments[0];var known_x=[];if(luckysheet.getObjType(data_known_x)=="array"){if(luckysheet.getObjType(data_known_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_x)){return luckysheet.formula.error.v;}known_x=known_x.concat(luckysheet.func_methods.getDataArr(data_known_x,false));}else if(luckysheet.getObjType(data_known_x)=="object"&&data_known_x.startCell!=null){known_x=known_x.concat(luckysheet.func_methods.getCellDataArr(data_known_x,"text",false));}else {known_x.push(data_known_x);}//代表因变量数据数组或矩阵的范围
  var data_known_y=arguments[1];var known_y=[];if(luckysheet.getObjType(data_known_y)=="array"){if(luckysheet.getObjType(data_known_y[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_y)){return luckysheet.formula.error.v;}known_y=known_y.concat(luckysheet.func_methods.getDataArr(data_known_y,false));}else if(luckysheet.getObjType(data_known_y)=="object"&&data_known_y.startCell!=null){known_y=known_y.concat(luckysheet.func_methods.getCellDataArr(data_known_y,"text",false));}else {known_y.push(data_known_y);}if(known_x.length!=known_y.length){return luckysheet.formula.error.na;}//known_y 和 known_x 只取数值
  var data_x=[],data_y=[];for(var i=0;i<known_x.length;i++){var num_x=known_x[i];var num_y=known_y[i];if(luckysheet.func_methods.isRealNum(num_x)&&luckysheet.func_methods.isRealNum(num_y)){data_x.push(parseFloat(num_x));data_y.push(parseFloat(num_y));}}if(data_x.length==0||data_y.length==0){return luckysheet.formula.error.d;}//计算
  var mean1=jStat.mean(data_x);var mean2=jStat.mean(data_y);var result=0;for(var i=0;i<data_x.length;i++){result+=(data_x[i]-mean1)*(data_y[i]-mean2);}result=result/data_x.length;return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COVARIANCE_S":function COVARIANCE_S(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//代表自变量数据数组或矩阵的范围
  var data_known_x=arguments[0];var known_x=[];if(luckysheet.getObjType(data_known_x)=="array"){if(luckysheet.getObjType(data_known_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_x)){return luckysheet.formula.error.v;}known_x=known_x.concat(luckysheet.func_methods.getDataArr(data_known_x,false));}else if(luckysheet.getObjType(data_known_x)=="object"&&data_known_x.startCell!=null){known_x=known_x.concat(luckysheet.func_methods.getCellDataArr(data_known_x,"text",false));}else {known_x.push(data_known_x);}//代表因变量数据数组或矩阵的范围
  var data_known_y=arguments[1];var known_y=[];if(luckysheet.getObjType(data_known_y)=="array"){if(luckysheet.getObjType(data_known_y[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_y)){return luckysheet.formula.error.v;}known_y=known_y.concat(luckysheet.func_methods.getDataArr(data_known_y,false));}else if(luckysheet.getObjType(data_known_y)=="object"&&data_known_y.startCell!=null){known_y=known_y.concat(luckysheet.func_methods.getCellDataArr(data_known_y,"text",false));}else {known_y.push(data_known_y);}if(known_x.length!=known_y.length){return luckysheet.formula.error.na;}//known_y 和 known_x 只取数值
  var data_x=[],data_y=[];for(var i=0;i<known_x.length;i++){var num_x=known_x[i];var num_y=known_y[i];if(luckysheet.func_methods.isRealNum(num_x)&&luckysheet.func_methods.isRealNum(num_y)){data_x.push(parseFloat(num_x));data_y.push(parseFloat(num_y));}}if(data_x.length==0||data_y.length==0){return luckysheet.formula.error.d;}return jStat.covariance(data_x,data_y);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DEVSQ":function DEVSQ(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(!luckysheet.func_methods.isRealNum(data)){if(luckysheet.getObjType(data)=="boolean"){if(data.toString().toLowerCase()=="true"){dataArr.push(1);}else if(data.toString().toLowerCase()=="false"){dataArr.push(0);}}else {return luckysheet.formula.error.v;}}else {dataArr.push(data);}}}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}}var mean=jStat.mean(dataArr_n);var result=0;for(var i=0;i<dataArr_n.length;i++){result+=Math.pow(dataArr_n[i]-mean,2);}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"EXPON_DIST":function EXPON_DIST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//指数分布函数的输入值
  var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);//用于指定指数分布函数的 lambda 值
  var lambda=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(lambda)){return lambda;}if(!luckysheet.func_methods.isRealNum(lambda)){return luckysheet.formula.error.v;}lambda=parseFloat(lambda);//是否使用指数累积分布
  var cumulative=luckysheet.func_methods.getCellBoolen(arguments[2]);if(luckysheet.func_methods.valueIsError(cumulative)){return cumulative;}if(x<0){return luckysheet.formula.error.nm;}if(lambda<0){return luckysheet.formula.error.nm;}return cumulative?jStat.exponential.cdf(x,lambda):jStat.exponential.pdf(x,lambda);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"AVERAGEIF":function AVERAGEIF(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var sum=0;var count=0;var rangeData=arguments[0].data;var rangeRow=arguments[0].rowl;var rangeCol=arguments[0].coll;var criteria=luckysheet_parseData(arguments[1]);var sumRangeData=[];//如果有第三个参数
  if(arguments[2]){//根据选择的目标的区域确定实际目标区域
  //初始位置
  var sumRangeStart=arguments[2].startCell;var sumRangeRow=arguments[2].rowl;var sumRangeCol=arguments[2].coll;var sumRangeSheet=arguments[2].sheetName;if(rangeRow==sumRangeRow&&rangeCol==sumRangeCol){sumRangeData=arguments[2].data;}else {var row=[],col=[];var sumRangeEnd="";var realSumRange="";//console.log("开始位置！！！",sumRangeStart,typeof(sumRangeStart));
  row[0]=parseInt(sumRangeStart.replace(/[^0-9]/g,""))-1;col[0]=luckysheet.luckysheetABCatNum(sumRangeStart.replace(/[^A-Za-z]/g,""));//根据第一个范围的长宽确定目标范围的末尾位置
  row[1]=row[0]+rangeRow-1;col[1]=col[0]+rangeCol-1;//console.log(row[0],col[0],row[1],col[1]);
  //末尾位置转化为sheet格式：如 F4 
  var real_ABC=luckysheet.luckysheetchatatABC(col[1]);var real_Num=row[1]+1;sumRangeEnd=real_ABC+real_Num;//console.log("合成新的末尾位置：" + sumRangeEnd);
  realSumRange=sumRangeSheet+"!"+sumRangeStart+":"+sumRangeEnd;sumRangeData=luckysheet_getcelldata(realSumRange).data;//console.log("最终的目标范围：",sumRangeData);
  }sumRangeData=luckysheet.formula.getRangeArray(sumRangeData)[0];}rangeData=luckysheet.formula.getRangeArray(rangeData)[0];//循环遍历查找匹配项
  for(var i=0;i<rangeData.length;i++){var v=rangeData[i];if(!!v&&luckysheet.formula.acompareb(v,criteria)){var vnow=sumRangeData[i]||v;if(!luckysheet.func_methods.isRealNum(vnow)){continue;}sum+=parseFloat(vnow);count++;}}if(sum==0||count==0){return luckysheet.formula.error.d;}else {return luckysheet.numFormat(sum/count);}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"AVERAGEIFS":function AVERAGEIFS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var sum=0;var count=0;var args=arguments;luckysheet_getValue(args);var rangeData=luckysheet.formula.getRangeArray(args[0])[0];var results=new Array(rangeData.length);for(var i=0;i<results.length;i++){results[i]=true;}for(var i=1;i<args.length;i+=2){var range=luckysheet.formula.getRangeArray(args[i])[0];var criteria=args[i+1];for(var j=0;j<range.length;j++){var v=range[j];results[j]=results[j]&&!!v&&luckysheet.formula.acompareb(v,criteria);}}for(var i=0;i<rangeData.length;i++){if(results[i]&&luckysheet.func_methods.isRealNum(rangeData[i])){sum+=parseFloat(rangeData[i]);count++;}}if(sum==0||count==0){return luckysheet.formula.error.d;}else {return luckysheet.numFormat(sum/count);}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PERMUT":function PERMUT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//表示对象个数的整数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseInt(number);//表示每个排列中对象个数的整数
  var number_chosen=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(number_chosen)){return number_chosen;}if(!luckysheet.func_methods.isRealNum(number_chosen)){return luckysheet.formula.error.v;}number_chosen=parseInt(number_chosen);if(number<=0||number_chosen<0){return luckysheet.formula.error.nm;}if(number<number_chosen){return luckysheet.formula.error.nm;}return luckysheet.func_methods.factorial(number)/luckysheet.func_methods.factorial(number-number_chosen);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TRIMMEAN":function TRIMMEAN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//计算
  var _rest=function _rest(array,idx){idx=idx||1;if(!array||typeof array.slice!=='function'){return array;}return array.slice(idx);};var initial=function initial(array,idx){idx=idx||1;if(!array||typeof array.slice!=='function'){return array;}return array.slice(0,array.length-idx);};//包含相关数据集的数组或范围
  var data_dataArr=arguments[0];var dataArr=[];if(luckysheet.getObjType(data_dataArr)=="array"){if(luckysheet.getObjType(data_dataArr[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_dataArr)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data_dataArr,false));}else if(luckysheet.getObjType(data_dataArr)=="object"&&data_dataArr.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data_dataArr,"number",false));}else {dataArr.push(data_dataArr);}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}}//排除比例
  var percent=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(percent)){return percent;}if(!luckysheet.func_methods.isRealNum(percent)){return luckysheet.formula.error.v;}percent=parseFloat(percent);if(dataArr_n.length==0){return luckysheet.formula.error.nm;}if(percent<0||percent>1){return luckysheet.formula.error.nm;};;dataArr_n.sort(function(a,b){return a-b;});var trim=window.luckysheet_function.FLOOR.f(dataArr_n.length*percent,2)/2;var result=_rest(dataArr_n,trim);result=initial(result,trim);result=jStat.mean(result);return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PERCENTILE_EXC":function PERCENTILE_EXC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//定义相对位置的数组或数据区域
  var data_dataArr=arguments[0];var dataArr=[];if(luckysheet.getObjType(data_dataArr)=="array"){if(luckysheet.getObjType(data_dataArr[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_dataArr)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data_dataArr,false));}else if(luckysheet.getObjType(data_dataArr)=="object"&&data_dataArr.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data_dataArr,"number",false));}else {dataArr.push(data_dataArr);}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}}//0 到 1 之间的百分点值，不包含 0 和 1
  var k=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(k)){return k;}if(!luckysheet.func_methods.isRealNum(k)){return luckysheet.formula.error.v;}k=parseFloat(k);if(dataArr_n.length==0){return luckysheet.formula.error.nm;}if(k<=0||k>=1){return luckysheet.formula.error.nm;}//计算
  dataArr_n=dataArr_n.sort(function(a,b){return a-b;});var n=dataArr_n.length;if(k<1/(n+1)||k>1-1/(n+1)){return luckysheet.formula.error.nm;}var l=k*(n+1)-1;var fl=Math.floor(l);return l===fl?dataArr_n[l]:dataArr_n[fl]+(l-fl)*(dataArr_n[fl+1]-dataArr_n[fl]);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PERCENTILE_INC":function PERCENTILE_INC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//定义相对位置的数组或数据区域
  var data_dataArr=arguments[0];var dataArr=[];if(luckysheet.getObjType(data_dataArr)=="array"){if(luckysheet.getObjType(data_dataArr[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_dataArr)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data_dataArr,false));}else if(luckysheet.getObjType(data_dataArr)=="object"&&data_dataArr.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data_dataArr,"number",false));}else {dataArr.push(data_dataArr);}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}}//0 到 1 之间的百分点值，不包含 0 和 1
  var k=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(k)){return k;}if(!luckysheet.func_methods.isRealNum(k)){return luckysheet.formula.error.v;}k=parseFloat(k);if(dataArr_n.length==0){return luckysheet.formula.error.nm;}if(k<0||k>1){return luckysheet.formula.error.nm;}//计算
  dataArr_n=dataArr_n.sort(function(a,b){return a-b;});var n=dataArr_n.length;var l=k*(n-1);var fl=Math.floor(l);return l===fl?dataArr_n[l]:dataArr_n[fl]+(l-fl)*(dataArr_n[fl+1]-dataArr_n[fl]);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PEARSON":function PEARSON(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//代表自变量数据数组或矩阵的范围
  var data_known_x=arguments[0];var known_x=[];if(luckysheet.getObjType(data_known_x)=="array"){if(luckysheet.getObjType(data_known_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_x)){return luckysheet.formula.error.v;}known_x=known_x.concat(luckysheet.func_methods.getDataArr(data_known_x,false));}else if(luckysheet.getObjType(data_known_x)=="object"&&data_known_x.startCell!=null){known_x=known_x.concat(luckysheet.func_methods.getCellDataArr(data_known_x,"text",false));}else {known_x.push(data_known_x);}//代表因变量数据数组或矩阵的范围
  var data_known_y=arguments[1];var known_y=[];if(luckysheet.getObjType(data_known_y)=="array"){if(luckysheet.getObjType(data_known_y[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_y)){return luckysheet.formula.error.v;}known_y=known_y.concat(luckysheet.func_methods.getDataArr(data_known_y,false));}else if(luckysheet.getObjType(data_known_y)=="object"&&data_known_y.startCell!=null){known_y=known_y.concat(luckysheet.func_methods.getCellDataArr(data_known_y,"text",false));}else {known_y.push(data_known_y);}if(known_x.length!=known_y.length){return luckysheet.formula.error.na;}//known_y 和 known_x 只取数值
  var data_x=[],data_y=[];for(var i=0;i<known_x.length;i++){var num_x=known_x[i];var num_y=known_y[i];if(luckysheet.func_methods.isRealNum(num_x)&&luckysheet.func_methods.isRealNum(num_y)){data_x.push(parseFloat(num_x));data_y.push(parseFloat(num_y));}}if(data_y.length==0||data_x.length==0){return luckysheet.formula.error.d;}//计算
  var xmean=jStat.mean(data_x);var ymean=jStat.mean(data_y);var n=data_x.length;var num=0;var den1=0;var den2=0;for(var i=0;i<n;i++){num+=(data_x[i]-xmean)*(data_y[i]-ymean);den1+=Math.pow(data_x[i]-xmean,2);den2+=Math.pow(data_y[i]-ymean,2);}return num/Math.sqrt(den1*den2);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NORM_S_INV":function NORM_S_INV(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//对应于正态分布的概率
  var probability=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(probability)){return probability;}if(!luckysheet.func_methods.isRealNum(probability)){return luckysheet.formula.error.v;}probability=parseFloat(probability);if(probability<=0||probability>=1){return luckysheet.formula.error.nm;}return jStat.normal.inv(probability,0,1);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NORM_S_DIST":function NORM_S_DIST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//需要计算其分布的数值
  var z=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(z)){return z;}if(!luckysheet.func_methods.isRealNum(z)){return luckysheet.formula.error.v;}z=parseFloat(z);//决定函数形式的逻辑值
  var cumulative=luckysheet.func_methods.getCellBoolen(arguments[1]);if(luckysheet.func_methods.valueIsError(cumulative)){return cumulative;}return cumulative?jStat.normal.cdf(z,0,1):jStat.normal.pdf(z,0,1);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NORM_INV":function NORM_INV(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//对应于正态分布的概率
  var probability=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(probability)){return probability;}if(!luckysheet.func_methods.isRealNum(probability)){if(luckysheet.getObjType(probability)=="boolean"){if(probability.toString().toLowerCase()=="true"){probability=1;}else if(probability.toString().toLowerCase()=="false"){probability=0;}}else {return luckysheet.formula.error.v;}}probability=parseFloat(probability);//分布的算术平均值
  var mean=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(mean)){return mean;}if(!luckysheet.func_methods.isRealNum(mean)){if(luckysheet.getObjType(mean)=="boolean"){if(mean.toString().toLowerCase()=="true"){mean=1;}else if(mean.toString().toLowerCase()=="false"){mean=0;}}else {return luckysheet.formula.error.v;}}mean=parseFloat(mean);//分布的标准偏差
  var standard_dev=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(standard_dev)){return standard_dev;}if(!luckysheet.func_methods.isRealNum(standard_dev)){if(luckysheet.getObjType(standard_dev)=="boolean"){if(standard_dev.toString().toLowerCase()=="true"){standard_dev=1;}else if(standard_dev.toString().toLowerCase()=="false"){standard_dev=0;}}else {return luckysheet.formula.error.v;}}standard_dev=parseFloat(standard_dev);if(probability<=0||probability>=1){return luckysheet.formula.error.nm;}if(standard_dev<=0){return luckysheet.formula.error.nm;}//计算
  return jStat.normal.inv(probability,mean,standard_dev);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NORM_DIST":function NORM_DIST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//需要计算其分布的数值
  var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){if(luckysheet.getObjType(x)=="boolean"){if(x.toString().toLowerCase()=="true"){x=1;}else if(x.toString().toLowerCase()=="false"){x=0;}}else {return luckysheet.formula.error.v;}}x=parseFloat(x);//分布的算术平均值 
  var mean=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(mean)){return mean;}if(!luckysheet.func_methods.isRealNum(mean)){return luckysheet.formula.error.v;}mean=parseFloat(mean);//分布的标准偏差
  var standard_dev=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(standard_dev)){return standard_dev;}if(!luckysheet.func_methods.isRealNum(standard_dev)){return luckysheet.formula.error.v;}standard_dev=parseFloat(standard_dev);//决定函数形式的逻辑值
  var cumulative=luckysheet.func_methods.getCellBoolen(arguments[3]);if(luckysheet.func_methods.valueIsError(cumulative)){return cumulative;}if(standard_dev<=0){return luckysheet.formula.error.nm;}return cumulative?jStat.normal.cdf(x,mean,standard_dev):jStat.normal.pdf(x,mean,standard_dev);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NEGBINOM_DIST":function NEGBINOM_DIST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要模拟的失败次数
  var number_f=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number_f)){return number_f;}if(!luckysheet.func_methods.isRealNum(number_f)){return luckysheet.formula.error.v;}number_f=parseInt(number_f);//要模拟的成功次数 
  var number_s=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(number_s)){return number_s;}if(!luckysheet.func_methods.isRealNum(number_s)){return luckysheet.formula.error.v;}number_s=parseInt(number_s);//任一次给定检验的成功概率
  var probability_s=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(probability_s)){return probability_s;}if(!luckysheet.func_methods.isRealNum(probability_s)){return luckysheet.formula.error.v;}probability_s=parseFloat(probability_s);//决定函数形式的逻辑值
  var cumulative=luckysheet.func_methods.getCellBoolen(arguments[3]);if(luckysheet.func_methods.valueIsError(cumulative)){return cumulative;}if(probability_s<0||probability_s>1){return luckysheet.formula.error.nm;}if(number_f<0||number_s<1){return luckysheet.formula.error.nm;}return cumulative?jStat.negbin.cdf(number_f,number_s,probability_s):jStat.negbin.pdf(number_f,number_s,probability_s);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MINA":function MINA(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,false));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(number.toString.toLowerCase()=="true"){dataArr.push(1);}else if(number.toString.toLowerCase()=="false"){dataArr.push(0);}else if(luckysheet.func_methods.isRealNum(data)){dataArr.push(data);}else {return luckysheet.formula.error.v;}}}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}else {if(number.toString().toLowerCase()=="true"){dataArr_n.push(1);}else {dataArr_n.push(0);}}}return dataArr_n.length===0?0:Math.min.apply(Math,dataArr_n);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MEDIAN":function MEDIAN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(!luckysheet.func_methods.isRealNum(data)){return luckysheet.formula.error.v;}dataArr.push(data);}}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}}return jStat.median(dataArr_n);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MAXA":function MAXA(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,false));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(number.toString.toLowerCase()=="true"){dataArr.push(1);}else if(number.toString.toLowerCase()=="false"){dataArr.push(0);}else if(luckysheet.func_methods.isRealNum(data)){dataArr.push(data);}else {return luckysheet.formula.error.v;}}}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}else {if(number.toString().toLowerCase()=="true"){dataArr_n.push(1);}else {dataArr_n.push(0);}}}return dataArr_n.length===0?0:Math.max.apply(Math,dataArr_n);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LOGNORM_INV":function LOGNORM_INV(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//与对数分布相关的概率
  var probability=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(probability)){return probability;}if(!luckysheet.func_methods.isRealNum(probability)){return luckysheet.formula.error.v;}probability=parseFloat(probability);//ln(x) 的平均值
  var mean=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(mean)){return mean;}if(!luckysheet.func_methods.isRealNum(mean)){return luckysheet.formula.error.v;}mean=parseFloat(mean);//ln(x) 的标准偏差
  var standard_dev=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(standard_dev)){return standard_dev;}if(!luckysheet.func_methods.isRealNum(standard_dev)){return luckysheet.formula.error.v;}standard_dev=parseFloat(standard_dev);if(probability<=0||probability>=1){return luckysheet.formula.error.nm;}if(standard_dev<=0){return luckysheet.formula.error.nm;}return jStat.lognormal.inv(probability,mean,standard_dev);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LOGNORM_DIST":function LOGNORM_DIST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//与对数分布相关的概率
  var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);//ln(x) 的平均值
  var mean=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(mean)){return mean;}if(!luckysheet.func_methods.isRealNum(mean)){return luckysheet.formula.error.v;}mean=parseFloat(mean);//ln(x) 的标准偏差
  var standard_dev=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(standard_dev)){return standard_dev;}if(!luckysheet.func_methods.isRealNum(standard_dev)){return luckysheet.formula.error.v;}standard_dev=parseFloat(standard_dev);//决定函数形式的逻辑值
  var cumulative=luckysheet.func_methods.getCellBoolen(arguments[3]);if(luckysheet.func_methods.valueIsError(cumulative)){return cumulative;}if(x<=0||standard_dev<=0){return luckysheet.formula.error.nm;}return cumulative?jStat.lognormal.cdf(x,mean,standard_dev):jStat.lognormal.pdf(x,mean,standard_dev);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"Z_TEST":function Z_TEST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//用来检验 x 的数组或数据区域
  var dataArr=[];if(luckysheet.getObjType(arguments[0])=="array"){if(luckysheet.getObjType(arguments[0][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[0])){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(arguments[0],true));}else if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(arguments[0],"text",true));}else {dataArr.push(arguments[0]);}var dataArr_n=[];for(var j=0;j<dataArr.length;j++){var number=dataArr[j];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}}//要测试的值
  var x=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);if(dataArr_n.length==0){return luckysheet.formula.error.na;}//总体（已知）标准偏差。 如果省略，则使用样本标准偏差
  var sigma=luckysheet.func_methods.standardDeviation_s(dataArr_n);if(arguments.length==3){sigma=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(sigma)){return sigma;}if(!luckysheet.func_methods.isRealNum(sigma)){return luckysheet.formula.error.v;}sigma=parseFloat(sigma);}//计算
  var n=dataArr_n.length;var mean=window.luckysheet_function.AVERAGE.f.apply(window.luckysheet_function.AVERAGE,dataArr_n);return 1-window.luckysheet_function.NORM_S_DIST.f((mean-x)/(sigma/Math.sqrt(n)),"true");}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PROB":function PROB(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//x_range
  var data_x_range=[];if(luckysheet.getObjType(arguments[0])=="array"){if(luckysheet.getObjType(arguments[0][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[0])){return luckysheet.formula.error.v;}data_x_range=data_x_range.concat(luckysheet.func_methods.getDataArr(arguments[0],false));}else if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){data_x_range=data_x_range.concat(luckysheet.func_methods.getCellDataArr(arguments[0],"text",false));}else {data_x_range.push(arguments[0]);}//prob_range
  var data_prob_range=[];if(luckysheet.getObjType(arguments[1])=="array"){if(luckysheet.getObjType(arguments[1][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[1])){return luckysheet.formula.error.v;}data_prob_range=data_prob_range.concat(luckysheet.func_methods.getDataArr(arguments[1],false));}else if(luckysheet.getObjType(arguments[1])=="object"&&arguments[1].startCell!=null){data_prob_range=data_prob_range.concat(luckysheet.func_methods.getCellDataArr(arguments[1],"text",false));}else {data_prob_range.push(arguments[1]);}if(data_x_range.length!=data_prob_range.length){return luckysheet.formula.error.na;}//data_x_range 和 data_prob_range 只取数值
  var x_range=[],prob_range=[],prob_range_sum=0;for(var i=0;i<data_x_range.length;i++){var num_x_range=data_x_range[i];var num_prob_range=data_prob_range[i];if(luckysheet.func_methods.isRealNum(num_x_range)&&luckysheet.func_methods.isRealNum(num_prob_range)){x_range.push(parseFloat(num_x_range));prob_range.push(parseFloat(num_prob_range));prob_range_sum+=parseFloat(num_prob_range);if(parseFloat(num_prob_range)<=0||parseFloat(num_prob_range)>1){return luckysheet.formula.error.nm;}}}if(prob_range_sum!=1){return luckysheet.formula.error.nm;}//要计算其概率的数值下界
  var lower_limit=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(lower_limit)){return lower_limit;}if(!luckysheet.func_methods.isRealNum(lower_limit)){return luckysheet.formula.error.v;}lower_limit=parseFloat(lower_limit);//要计算其概率的数值上界
  var upper_limit=lower_limit;if(arguments.length==4){upper_limit=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(upper_limit)){return upper_limit;}if(!luckysheet.func_methods.isRealNum(upper_limit)){return luckysheet.formula.error.v;}upper_limit=parseFloat(upper_limit);}//计算
  var result=0;for(var i=0;i<x_range.length;i++){if(x_range[i]>=lower_limit&&x_range[i]<=upper_limit){result+=prob_range[i];}}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"QUARTILE_EXC":function QUARTILE_EXC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要求得四分位数值的数组或数字型单元格区域
  var data_array=[];if(luckysheet.getObjType(arguments[0])=="array"){if(luckysheet.getObjType(arguments[0][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[0])){return luckysheet.formula.error.v;}data_array=data_array.concat(luckysheet.func_methods.getDataArr(arguments[0],true));}else if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){data_array=data_array.concat(luckysheet.func_methods.getCellDataArr(arguments[0],"text",true));}else {if(!luckysheet.func_methods.isRealNum(arguments[0])){return luckysheet.formula.error.v;}data_array.push(arguments[0]);}var array=[];for(var i=0;i<data_array.length;i++){var number=data_array[i];if(luckysheet.func_methods.isRealNum(number)){array.push(parseFloat(number));}}//要返回第几个四分位值
  var quart=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(quart)){return quart;}if(!luckysheet.func_methods.isRealNum(quart)){return luckysheet.formula.error.v;}quart=parseInt(quart);if(array.length==0){return luckysheet.formula.error.nm;}if(quart<=0||quart>=4){return luckysheet.formula.error.nm;}//计算
  switch(quart){case 1:return window.luckysheet_function.PERCENTILE_EXC.f(array,0.25);case 2:return window.luckysheet_function.PERCENTILE_EXC.f(array,0.5);case 3:return window.luckysheet_function.PERCENTILE_EXC.f(array,0.75);}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"QUARTILE_INC":function QUARTILE_INC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要求得四分位数值的数组或数字型单元格区域
  var data_array=[];if(luckysheet.getObjType(arguments[0])=="array"){if(luckysheet.getObjType(arguments[0][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[0])){return luckysheet.formula.error.v;}data_array=data_array.concat(luckysheet.func_methods.getDataArr(arguments[0],true));}else if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){data_array=data_array.concat(luckysheet.func_methods.getCellDataArr(arguments[0],"text",true));}else {if(!luckysheet.func_methods.isRealNum(arguments[0])){return luckysheet.formula.error.v;}data_array.push(arguments[0]);}var array=[];for(var i=0;i<data_array.length;i++){var number=data_array[i];if(luckysheet.func_methods.isRealNum(number)){array.push(parseFloat(number));}}//要返回第几个四分位值
  var quart=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(quart)){return quart;}if(!luckysheet.func_methods.isRealNum(quart)){return luckysheet.formula.error.v;}quart=parseInt(quart);if(array.length==0){return luckysheet.formula.error.nm;}if(quart<0||quart>4){return luckysheet.formula.error.nm;}//计算
  switch(quart){case 0:return Math.min.apply(Math,array);case 1:return window.luckysheet_function.PERCENTILE_INC.f(array,0.25);case 2:return window.luckysheet_function.PERCENTILE_INC.f(array,0.5);case 3:return window.luckysheet_function.PERCENTILE_INC.f(array,0.75);case 4:return Math.max.apply(Math,array);}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"POISSON_DIST":function POISSON_DIST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//事件数
  var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseInt(x);//期望值
  var mean=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(mean)){return mean;}if(!luckysheet.func_methods.isRealNum(mean)){return luckysheet.formula.error.v;}mean=parseFloat(mean);//决定函数形式的逻辑值
  var cumulative=luckysheet.func_methods.getCellBoolen(arguments[2]);if(luckysheet.func_methods.valueIsError(cumulative)){return cumulative;}if(x<0||mean<0){return luckysheet.formula.error.nm;}return cumulative?jStat.poisson.cdf(x,mean):jStat.poisson.pdf(x,mean);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"RSQ":function RSQ(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//代表因变量数据数组或矩阵的范围
  var data_known_y=arguments[0];var known_y=[];if(luckysheet.getObjType(data_known_y)=="array"){if(luckysheet.getObjType(data_known_y[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_y)){return luckysheet.formula.error.v;}known_y=known_y.concat(luckysheet.func_methods.getDataArr(data_known_y,false));}else if(luckysheet.getObjType(data_known_y)=="object"&&data_known_y.startCell!=null){known_y=known_y.concat(luckysheet.func_methods.getCellDataArr(data_known_y,"text",false));}else {if(!luckysheet.func_methods.isRealNum(data_known_y)){return luckysheet.formula.error.v;}known_y.push(data_known_y);}//代表自变量数据数组或矩阵的范围
  var data_known_x=arguments[1];var known_x=[];if(luckysheet.getObjType(data_known_x)=="array"){if(luckysheet.getObjType(data_known_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_x)){return luckysheet.formula.error.v;}known_x=known_x.concat(luckysheet.func_methods.getDataArr(data_known_x,false));}else if(luckysheet.getObjType(data_known_x)=="object"&&data_known_x.startCell!=null){known_x=known_x.concat(luckysheet.func_methods.getCellDataArr(data_known_x,"text",false));}else {if(!luckysheet.func_methods.isRealNum(data_known_x)){return luckysheet.formula.error.v;}known_x.push(data_known_x);}if(known_y.length!=known_x.length){return luckysheet.formula.error.na;}//known_y 和 known_x 只取数值
  var data_y=[],data_x=[];for(var i=0;i<known_y.length;i++){var num_y=known_y[i];var num_x=known_x[i];if(luckysheet.func_methods.isRealNum(num_y)&&luckysheet.func_methods.isRealNum(num_x)){data_y.push(parseFloat(num_y));data_x.push(parseFloat(num_x));}}if(data_y.length==0||data_x.length==0){return luckysheet.formula.error.d;}return Math.pow(window.luckysheet_function.PEARSON.f(data_y,data_x),2);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"T_DIST":function T_DIST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//T-分布函数的输入
  var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);//自由度数值
  var degrees_freedom=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(degrees_freedom)){return degrees_freedom;}if(!luckysheet.func_methods.isRealNum(degrees_freedom)){return luckysheet.formula.error.v;}degrees_freedom=parseInt(degrees_freedom);//决定函数形式的逻辑值
  var cumulative=luckysheet.func_methods.getCellBoolen(arguments[2]);if(luckysheet.func_methods.valueIsError(cumulative)){return cumulative;}if(degrees_freedom<1){return luckysheet.formula.error.nm;}return cumulative?jStat.studentt.cdf(x,degrees_freedom):jStat.studentt.pdf(x,degrees_freedom);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"T_DIST_2T":function T_DIST_2T(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//T-分布函数的输入
  var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);//自由度数值
  var degrees_freedom=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(degrees_freedom)){return degrees_freedom;}if(!luckysheet.func_methods.isRealNum(degrees_freedom)){return luckysheet.formula.error.v;}degrees_freedom=parseInt(degrees_freedom);if(x<0||degrees_freedom<1){return luckysheet.formula.error.nm;}return (1-jStat.studentt.cdf(x,degrees_freedom))*2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"T_DIST_RT":function T_DIST_RT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//T-分布函数的输入
  var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);//自由度数值
  var degrees_freedom=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(degrees_freedom)){return degrees_freedom;}if(!luckysheet.func_methods.isRealNum(degrees_freedom)){return luckysheet.formula.error.v;}degrees_freedom=parseInt(degrees_freedom);if(degrees_freedom<1){return luckysheet.formula.error.nm;}return 1-jStat.studentt.cdf(x,degrees_freedom);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"T_INV":function T_INV(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//与学生的 t 分布相关的概率
  var probability=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(probability)){return probability;}if(!luckysheet.func_methods.isRealNum(probability)){return luckysheet.formula.error.v;}probability=parseFloat(probability);//自由度数值
  var deg_freedom=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(deg_freedom)){return deg_freedom;}if(!luckysheet.func_methods.isRealNum(deg_freedom)){return luckysheet.formula.error.v;}deg_freedom=parseInt(deg_freedom);if(probability<=0||probability>1){return luckysheet.formula.error.nm;}if(deg_freedom<1){return luckysheet.formula.error.nm;}return jStat.studentt.inv(probability,deg_freedom);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"T_INV_2T":function T_INV_2T(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//与学生的 t 分布相关的概率
  var probability=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(probability)){return probability;}if(!luckysheet.func_methods.isRealNum(probability)){return luckysheet.formula.error.v;}probability=parseFloat(probability);//自由度数值
  var deg_freedom=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(deg_freedom)){return deg_freedom;}if(!luckysheet.func_methods.isRealNum(deg_freedom)){return luckysheet.formula.error.v;}deg_freedom=parseInt(deg_freedom);if(probability<=0||probability>1){return luckysheet.formula.error.nm;}if(deg_freedom<1){return luckysheet.formula.error.nm;}return Math.abs(jStat.studentt.inv(probability/2,deg_freedom));}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"T_TEST":function T_TEST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//第一个数据集
  var known_x=[];if(luckysheet.getObjType(arguments[0])=="array"){if(luckysheet.getObjType(arguments[0][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[0])){return luckysheet.formula.error.v;}known_x=known_x.concat(luckysheet.func_methods.getDataArr(arguments[0],false));}else if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){known_x=known_x.concat(luckysheet.func_methods.getCellDataArr(arguments[0],"text",false));}else {if(!luckysheet.func_methods.isRealNum(arguments[0])){return luckysheet.formula.error.v;}known_x.push(arguments[0]);}// var data_x = [];
  var data_x=known_x;//第二个数据集
  var known_y=[];if(luckysheet.getObjType(arguments[1])=="array"){if(luckysheet.getObjType(arguments[1][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[1])){return luckysheet.formula.error.v;}known_y=known_y.concat(luckysheet.func_methods.getDataArr(arguments[1],false));}else if(luckysheet.getObjType(arguments[1])=="object"&&arguments[1].startCell!=null){known_y=known_y.concat(luckysheet.func_methods.getCellDataArr(arguments[1],"text",false));}else {if(!luckysheet.func_methods.isRealNum(arguments[1])){return luckysheet.formula.error.v;}known_y.push(arguments[1]);}// var data_y = [];
  var data_y=known_y;//指定分布的尾数
  var tails=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(tails)){return tails;}if(!luckysheet.func_methods.isRealNum(tails)){return luckysheet.formula.error.v;}tails=parseInt(tails);//指定 t 检验的类型
  var type=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(type)){return type;}if(!luckysheet.func_methods.isRealNum(type)){return luckysheet.formula.error.v;}type=parseInt(type);if([1,2].indexOf(tails)==-1){return luckysheet.formula.error.nm;}if([1,2,3].indexOf(type)==-1){return luckysheet.formula.error.nm;}//计算
  var t=null,df=null;if(type==1){var diff_arr=[];for(i=0;i<data_x.length;i++){diff_arr.push(data_x[i]-data_y[i]);}var diff_mean=Math.abs(jStat.mean(diff_arr));var diff_sd=luckysheet.func_methods.standardDeviation_s(diff_arr);t=diff_mean/(diff_sd/Math.sqrt(data_x.length));df=data_x.length-1;}else {var mean_x=jStat.mean(data_x);var mean_y=jStat.mean(data_y);var s_x=luckysheet.func_methods.variance_s(data_x);var s_y=luckysheet.func_methods.variance_s(data_y);t=Math.abs(mean_x-mean_y)/Math.sqrt(s_x/data_x.length+s_y/data_y.length);switch(type){case 2:df=data_x.length+data_y.length-2;break;case 3:df=Math.pow(s_x/data_x.length+s_y/data_y.length,2)/(Math.pow(s_x/data_x.length,2)/(data_x.length-1)+Math.pow(s_y/data_y.length,2)/(data_y.length-1));break;}}if(tails==1){var result=window.luckysheet_function.T_DIST_RT.f(t,df);}else if(tails==2){var result=window.luckysheet_function.T_DIST_2T.f(t,df);}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"F_DIST":function F_DIST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//用来计算函数的值
  var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);//分子自由度
  var degrees_freedom1=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(degrees_freedom1)){return degrees_freedom1;}if(!luckysheet.func_methods.isRealNum(degrees_freedom1)){return luckysheet.formula.error.v;}degrees_freedom1=parseInt(degrees_freedom1);//分母自由度
  var degrees_freedom2=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(degrees_freedom2)){return degrees_freedom2;}if(!luckysheet.func_methods.isRealNum(degrees_freedom2)){return luckysheet.formula.error.v;}degrees_freedom2=parseInt(degrees_freedom2);//用于确定函数形式的逻辑值
  var cumulative=luckysheet.func_methods.getCellBoolen(arguments[3]);if(luckysheet.func_methods.valueIsError(cumulative)){return cumulative;}if(x<0){return luckysheet.formula.error.nm;}if(degrees_freedom1<1){return luckysheet.formula.error.nm;}if(degrees_freedom2<1){return luckysheet.formula.error.nm;}return cumulative?jStat.centralF.cdf(x,degrees_freedom1,degrees_freedom2):jStat.centralF.pdf(x,degrees_freedom1,degrees_freedom2);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"F_DIST_RT":function F_DIST_RT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//用来计算函数的值
  var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);//分子自由度
  var degrees_freedom1=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(degrees_freedom1)){return degrees_freedom1;}if(!luckysheet.func_methods.isRealNum(degrees_freedom1)){return luckysheet.formula.error.v;}degrees_freedom1=parseInt(degrees_freedom1);//分母自由度
  var degrees_freedom2=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(degrees_freedom2)){return degrees_freedom2;}if(!luckysheet.func_methods.isRealNum(degrees_freedom2)){return luckysheet.formula.error.v;}degrees_freedom2=parseInt(degrees_freedom2);if(x<0){return luckysheet.formula.error.nm;}if(degrees_freedom1<1){return luckysheet.formula.error.nm;}if(degrees_freedom2<1){return luckysheet.formula.error.nm;}return 1-jStat.centralF.cdf(x,degrees_freedom1,degrees_freedom2);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"VAR_P":function VAR_P(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(!luckysheet.func_methods.isRealNum(data)){return luckysheet.formula.error.v;}dataArr.push(data);}}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}}if(dataArr_n.length==0){return luckysheet.formula.error.d;}var n=dataArr_n.length;var sigma=0;var mean=window.luckysheet_function.AVERAGE.f.apply(window.luckysheet_function.AVERAGE,dataArr_n);for(var i=0;i<n;i++){sigma+=Math.pow(dataArr_n[i]-mean,2);}return sigma/n;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"VAR_S":function VAR_S(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(!luckysheet.func_methods.isRealNum(data)){return luckysheet.formula.error.v;}dataArr.push(data);}}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}}if(dataArr_n.length==0){return luckysheet.formula.error.d;}var n=dataArr_n.length;var sigma=0;var mean=window.luckysheet_function.AVERAGE.f.apply(window.luckysheet_function.AVERAGE,dataArr_n);for(var i=0;i<n;i++){sigma+=Math.pow(dataArr_n[i]-mean,2);}return sigma/(n-1);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"VARA":function VARA(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,false));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(number.toString.toLowerCase()=="true"){dataArr.push(1);}else if(number.toString.toLowerCase()=="false"){dataArr.push(0);}else if(luckysheet.func_methods.isRealNum(data)){dataArr.push(data);}else {return luckysheet.formula.error.v;}}}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}else {if(number.toString().toLowerCase()=="true"){dataArr_n.push(1);}else {dataArr_n.push(0);}}}var n=dataArr_n.length;var sigma=0;var mean=window.luckysheet_function.AVERAGE.f.apply(window.luckysheet_function.AVERAGE,dataArr_n);for(var i=0;i<n;i++){sigma+=Math.pow(dataArr_n[i]-mean,2);}return sigma/(n-1);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"VARPA":function VARPA(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,false));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(number.toString.toLowerCase()=="true"){dataArr.push(1);}else if(number.toString.toLowerCase()=="false"){dataArr.push(0);}else if(luckysheet.func_methods.isRealNum(data)){dataArr.push(data);}else {return luckysheet.formula.error.v;}}}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}else {if(number.toString().toLowerCase()=="true"){dataArr_n.push(1);}else {dataArr_n.push(0);}}}var n=dataArr_n.length;var sigma=0;var mean=window.luckysheet_function.AVERAGE.f.apply(window.luckysheet_function.AVERAGE,dataArr_n);for(var i=0;i<n;i++){sigma+=Math.pow(dataArr_n[i]-mean,2);}return sigma/n;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"STEYX":function STEYX(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//代表因变量数据数组或矩阵的范围
  var known_y=[];if(luckysheet.getObjType(arguments[0])=="array"){if(luckysheet.getObjType(arguments[0][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[0])){return luckysheet.formula.error.v;}known_y=known_y.concat(luckysheet.func_methods.getDataArr(arguments[0],false));}else if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){known_y=known_y.concat(luckysheet.func_methods.getCellDataArr(arguments[0],"text",false));}else {if(!luckysheet.func_methods.isRealNum(arguments[0])){return luckysheet.formula.error.v;}known_y.push(arguments[0]);}//代表自变量数据数组或矩阵的范围
  var known_x=[];if(luckysheet.getObjType(arguments[1])=="array"){if(luckysheet.getObjType(arguments[1][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[1])){return luckysheet.formula.error.v;}known_x=known_x.concat(luckysheet.func_methods.getDataArr(arguments[1],false));}else if(luckysheet.getObjType(arguments[1])=="object"&&arguments[1].startCell!=null){known_x=known_x.concat(luckysheet.func_methods.getCellDataArr(arguments[1],"text",false));}else {if(!luckysheet.func_methods.isRealNum(arguments[1])){return luckysheet.formula.error.v;}known_x.push(arguments[1]);}if(known_y.length!=known_x.length){return luckysheet.formula.error.na;}//known_y 和 known_x 只取数值
  var data_y=[],data_x=[];for(var i=0;i<known_y.length;i++){var num_y=known_y[i];var num_x=known_x[i];if(luckysheet.func_methods.isRealNum(num_y)&&luckysheet.func_methods.isRealNum(num_x)){data_y.push(parseFloat(num_y));data_x.push(parseFloat(num_x));}}if(data_y.length<3||data_x.length<3){return luckysheet.formula.error.d;}//计算
  var xmean=jStat.mean(data_x);var ymean=jStat.mean(data_y);var n=data_x.length;var lft=0;var num=0;var den=0;for(var i=0;i<n;i++){lft+=Math.pow(data_y[i]-ymean,2);num+=(data_x[i]-xmean)*(data_y[i]-ymean);den+=Math.pow(data_x[i]-xmean,2);}return Math.sqrt((lft-num*num/den)/(n-2));}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"STANDARDIZE":function STANDARDIZE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要正态化的随机变量值
  var x=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}if(!luckysheet.func_methods.isRealNum(x)){return luckysheet.formula.error.v;}x=parseFloat(x);//分布的均值
  var mean=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(mean)){return mean;}if(!luckysheet.func_methods.isRealNum(mean)){return luckysheet.formula.error.v;}mean=parseFloat(mean);//分布的标准偏差
  var standard_dev=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(standard_dev)){return standard_dev;}if(!luckysheet.func_methods.isRealNum(standard_dev)){return luckysheet.formula.error.v;}standard_dev=parseFloat(standard_dev);if(standard_dev<=0){return luckysheet.formula.error.nm;}return (x-mean)/standard_dev;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SMALL":function SMALL(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要正态化的随机变量值
  var dataArr=[];if(luckysheet.getObjType(arguments[0])=="array"){if(luckysheet.getObjType(arguments[0][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[0])){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(arguments[0],true));}else if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(arguments[0],"number",true));}else {if(!luckysheet.func_methods.isRealNum(arguments[0])){return luckysheet.formula.error.v;}dataArr.push(arguments[0]);}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}}//要返回的数据在数组或数据区域里的位置（从小到大）
  var k=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(k)){return k;}if(!luckysheet.func_methods.isRealNum(k)){return luckysheet.formula.error.v;}k=parseInt(k);if(dataArr_n.length==0){return luckysheet.formula.error.nm;}if(k<=0||k>dataArr_n.length){return luckysheet.formula.error.nm;}//计算
  return dataArr_n.sort(function(a,b){return a-b;})[k-1];}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SLOPE":function SLOPE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//代表因变量数据数组或矩阵的范围
  var known_y=[];if(luckysheet.getObjType(arguments[0])=="array"){if(luckysheet.getObjType(arguments[0][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[0])){return luckysheet.formula.error.v;}known_y=known_y.concat(luckysheet.func_methods.getDataArr(arguments[0],false));}else if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){known_y=known_y.concat(luckysheet.func_methods.getCellDataArr(arguments[0],"text",false));}else {if(!luckysheet.func_methods.isRealNum(arguments[0])){return luckysheet.formula.error.v;}known_y.push(arguments[0]);}//代表自变量数据数组或矩阵的范围
  var known_x=[];if(luckysheet.getObjType(arguments[1])=="array"){if(luckysheet.getObjType(arguments[1][0])=="array"&&!luckysheet.func_methods.isDyadicArr(arguments[1])){return luckysheet.formula.error.v;}known_x=known_x.concat(luckysheet.func_methods.getDataArr(arguments[1],false));}else if(luckysheet.getObjType(arguments[1])=="object"&&arguments[1].startCell!=null){known_x=known_x.concat(luckysheet.func_methods.getCellDataArr(arguments[1],"text",false));}else {if(!luckysheet.func_methods.isRealNum(arguments[1])){return luckysheet.formula.error.v;}known_x.push(arguments[1]);}if(known_y.length!=known_x.length){return luckysheet.formula.error.na;}//known_y 和 known_x 只取数值
  var data_y=[],data_x=[];for(var i=0;i<known_y.length;i++){var num_y=known_y[i];var num_x=known_x[i];if(luckysheet.func_methods.isRealNum(num_y)&&luckysheet.func_methods.isRealNum(num_x)){data_y.push(parseFloat(num_y));data_x.push(parseFloat(num_x));}}if(data_y.length<3||data_x.length<3){return luckysheet.formula.error.d;}//计算
  var xmean=jStat.mean(data_x);var ymean=jStat.mean(data_y);var n=data_x.length;var num=0;var den=0;for(var i=0;i<n;i++){num+=(data_x[i]-xmean)*(data_y[i]-ymean);den+=Math.pow(data_x[i]-xmean,2);}return num/den;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SKEW":function SKEW(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(!luckysheet.func_methods.isRealNum(data)){return luckysheet.formula.error.v;}dataArr.push(data);}}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}}if(dataArr_n.length<3||luckysheet.func_methods.standardDeviation_s(dataArr_n)==0){return luckysheet.formula.error.d;}//计算
  var mean=jStat.mean(dataArr_n);var n=dataArr_n.length;var sigma=0;for(var i=0;i<n;i++){sigma+=Math.pow(dataArr_n[i]-mean,3);}return n*sigma/((n-1)*(n-2)*Math.pow(jStat.stdev(dataArr_n,true),3));}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SKEW_P":function SKEW_P(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var dataArr=[];for(var i=0;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {if(!luckysheet.func_methods.isRealNum(data)){return luckysheet.formula.error.v;}dataArr.push(data);}}var dataArr_n=[];for(var i=0;i<dataArr.length;i++){var number=dataArr[i];if(luckysheet.func_methods.isRealNum(number)){dataArr_n.push(parseFloat(number));}}if(dataArr_n.length<3||luckysheet.func_methods.standardDeviation_s(dataArr_n)==0){return luckysheet.formula.error.d;}//计算
  var mean=jStat.mean(dataArr_n);var n=dataArr_n.length;var m2=0;var m3=0;for(var i=0;i<n;i++){m3+=Math.pow(dataArr_n[i]-mean,3);m2+=Math.pow(dataArr_n[i]-mean,2);}m3=m3/n;m2=m2/n;return m3/Math.pow(m2,3/2);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ADDRESS":function ADDRESS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//行号
  var row_num=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(row_num)){return row_num;}if(!luckysheet.func_methods.isRealNum(row_num)){return luckysheet.formula.error.v;}row_num=parseInt(row_num);//列标
  var column_num=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(column_num)){return column_num;}if(!luckysheet.func_methods.isRealNum(column_num)){return luckysheet.formula.error.v;}column_num=parseInt(column_num);//引用类型
  var abs_num=1;if(arguments.length>=3){abs_num=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(abs_num)){return abs_num;}if(!luckysheet.func_methods.isRealNum(abs_num)){return luckysheet.formula.error.v;}abs_num=parseInt(abs_num);}//A1标记形式 -- R1C1标记形式
  var A1=true;if(arguments.length>=4){A1=luckysheet.func_methods.getCellBoolen(arguments[3]);if(luckysheet.func_methods.valueIsError(A1)){return A1;}}if(row_num<=0||column_num<=0){return luckysheet.formula.error.v;}if([1,2,3,4].indexOf(abs_num)==-1){return luckysheet.formula.error.v;}//计算
  var str;if(A1){column_num=luckysheet.luckysheetchatatABC(column_num-1);switch(abs_num){case 1:str="$"+column_num+"$"+row_num;break;case 2:str=column_num+"$"+row_num;break;case 3:str="$"+column_num+row_num;break;case 4:str=column_num+row_num;break;}}else {switch(abs_num){case 1:str="R"+row_num+"C"+column_num;break;case 2:str="R"+row_num+"C["+column_num+"]";break;case 3:str="R["+row_num+"]"+"C"+column_num;break;case 4:str="R["+row_num+"]"+"C["+column_num+"]";break;}}if(arguments.length==5){//工作表名称
  var sheet_text=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(sheet_text)){return sheet_text;}return sheet_text+"!"+str;}else {return str;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"INDIRECT":function INDIRECT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//以带引号的字符串形式提供的单元格引用
  var ref_text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(ref_text)){return ref_text;}//A1标记形式 -- R1C1标记形式
  var A1=true;if(arguments.length==2){A1=luckysheet.func_methods.getCellBoolen(arguments[1]);if(luckysheet.func_methods.valueIsError(A1)){return A1;}}//计算
  if(A1){var reg=/^(([a-zA-Z]+)|([$][a-zA-Z]+))(([0-9]+)|([$][0-9]+))$/g;if(reg.test(ref_text)){var row=parseInt(ref_text.replace(/[^0-9]/g,""))-1;var col=luckysheet.luckysheetABCatNum(ref_text.replace(/[^A-Za-z]/g,""));if(row<0||row>=luckysheet.flowdata.length||col<0||col>=luckysheet.flowdata[0].length){return luckysheet.formula.error.r;}if(luckysheet.flowdata[row][col]==null||luckysheet.func_methods.isRealNull(luckysheet.flowdata[row][col].v)){return 0;}return luckysheet.flowdata[row][col].v;}else {return luckysheet.formula.error.r;}}else {var reg=/^[R][0-9]+[C][0-9]+$/g;if(reg.test(ref_text)){var row=parseInt(ref_text.split("R")[1].split("C")[0]);var col=parseInt(ref_text.split("R")[1].split("C")[1]);if(row<0||row>=luckysheet.flowdata.length||col<0||col>=luckysheet.flowdata[0].length){return luckysheet.formula.error.r;}if(luckysheet.flowdata[row][col]==null||luckysheet.func_methods.isRealNull(luckysheet.flowdata[row][col].v)){return 0;}return luckysheet.flowdata[row][col].v;}else {return luckysheet.formula.error.r;}}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ROW":function ROW(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{if(arguments.length==1){//要返回其行号的单元格
  var reference;if(luckysheet.getObjType(arguments[0])=="array"){return luckysheet.formula.error.v;}else if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){reference=arguments[0].startCell;}else {reference=arguments[0];}if(luckysheet.formula.iscelldata(reference)){var cellrange=luckysheet.formula.getcellrange(reference);return cellrange["row"][0]+1;}else {return luckysheet.formula.error.v;}}else {return window.luckysheetCurrentRow+1;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ROWS":function ROWS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要返回其行数的范围
  if(luckysheet.getObjType(arguments[0])=="array"){if(luckysheet.getObjType(arguments[0][0])=="array"){return arguments[0].length;}else {return 1;}}else if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){return arguments[0].rowl;}else {return 1;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COLUMN":function COLUMN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{if(arguments.length==1){//要返回其列号的单元格
  var reference;if(luckysheet.getObjType(arguments[0])=="array"){return luckysheet.formula.error.v;}else if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){reference=arguments[0].startCell;}else {reference=arguments[0];}if(luckysheet.formula.iscelldata(reference)){var cellrange=luckysheet.formula.getcellrange(reference);return cellrange["column"][0]+1;}else {return luckysheet.formula.error.v;}}else {return window.luckysheetCurrentColumn+1;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COLUMNS":function COLUMNS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//返回指定数组或范围中的列数
  if(luckysheet.getObjType(arguments[0])=="array"){if(luckysheet.getObjType(arguments[0][0])=="array"){return arguments[0][0].length;}else {return arguments[0].length;}}else if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){return arguments[0].coll;}else {return 1;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"OFFSET":function OFFSET(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//用于计算行列偏移量的起点
  if(!(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null)){return luckysheet.formula.error.v;}var reference=arguments[0].startCell;//要偏移的行数
  var rows=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(rows)){return rows;}if(!luckysheet.func_methods.isRealNum(rows)){return luckysheet.formula.error.v;}rows=parseInt(rows);//要偏移的列数
  var cols=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(cols)){return cols;}if(!luckysheet.func_methods.isRealNum(cols)){return luckysheet.formula.error.v;}cols=parseInt(cols);//要从偏移目标开始返回的范围的高度
  var height=arguments[0].rowl;if(arguments.length>=4){height=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(height)){return height;}if(!luckysheet.func_methods.isRealNum(height)){return luckysheet.formula.error.v;}height=parseInt(height);}//要从偏移目标开始返回的范围的宽度
  var width=arguments[0].coll;if(arguments.length==5){width=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(width)){return width;}if(!luckysheet.func_methods.isRealNum(width)){return luckysheet.formula.error.v;}width=parseInt(width);}if(height<1||width<1){return luckysheet.formula.error.r;}//计算
  var cellrange=luckysheet.formula.getcellrange(reference);var cellRow0=cellrange["row"][0];var cellCol0=cellrange["column"][0];cellRow0+=rows;cellCol0+=cols;var cellRow1=cellRow0+height-1;var cellCol1=cellCol0+width-1;if(cellRow0<0||cellRow1>=luckysheet.flowdata.length||cellCol0<0||cellCol1>=luckysheet.flowdata[0].length){return luckysheet.formula.error.r;}var result=[];for(var r=cellRow0;r<=cellRow1;r++){var rowArr=[];for(var c=cellCol0;c<=cellCol1;c++){if(luckysheet.flowdata[r][c]!=null&&!luckysheet.func_methods.isRealNull(luckysheet.flowdata[r][c].v)){rowArr.push(luckysheet.flowdata[r][c].v);}else {rowArr.push(0);}}result.push(rowArr);}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MATCH":function MATCH(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//lookup_value
  var lookup_value=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(lookup_value)){return lookup_value;}//lookup_array
  var data_lookup_array=arguments[1];var lookup_array=[];if(luckysheet.getObjType(data_lookup_array)=="array"){if(luckysheet.getObjType(data_lookup_array[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_lookup_array)){return luckysheet.formula.error.v;}return luckysheet.formula.error.na;}else {for(var i=0;i<data_lookup_array.length;i++){lookup_array.push(data_lookup_array[i]);}}}else if(luckysheet.getObjType(data_lookup_array)=="object"&&data_lookup_array.startCell!=null){if(data_lookup_array.rowl>1&&data_lookup_array.coll>1){return luckysheet.formula.error.na;}if(data_lookup_array.data!=null){if(luckysheet.getObjType(data_lookup_array.data)=="array"){for(var i=0;i<data_lookup_array.data.length;i++){for(var j=0;j<data_lookup_array.data[i].length;j++){if(data_lookup_array.data[i][j]!=null&&!luckysheet.func_methods.isRealNull(data_lookup_array.data[i][j].v)){lookup_array.push(data_lookup_array.data[i][j].v);}}}}else {lookup_array.push(data_lookup_array.data.v);}}}//match_type
  var match_type=1;if(arguments.length==3){match_type=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(match_type)){return match_type;}if(!luckysheet.func_methods.isRealNum(match_type)){return luckysheet.formula.error.v;}match_type=Math.ceil(parseFloat(match_type));}if([-1,0,1].indexOf(match_type)==-1){return luckysheet.formula.error.na;}//计算
  var index;var indexValue;for(var idx=0;idx<lookup_array.length;idx++){if(match_type===1){if(lookup_array[idx]===lookup_value){return idx+1;}else if(lookup_array[idx]<lookup_value){if(!indexValue){index=idx+1;indexValue=lookup_array[idx];}else if(lookup_array[idx]>indexValue){index=idx+1;indexValue=lookup_array[idx];}}}else if(match_type===0){if(typeof lookup_value==='string'){lookup_value=lookup_value.replace(/\?/g,'.');if(lookup_array[idx].toLowerCase().match(lookup_value.toLowerCase())){return idx+1;}}else {if(lookup_array[idx]===lookup_value){return idx+1;}}}else if(match_type===-1){if(lookup_array[idx]===lookup_value){return idx+1;}else if(lookup_array[idx]>lookup_value){if(!indexValue){index=idx+1;indexValue=lookup_array[idx];}else if(lookup_array[idx]<indexValue){index=idx+1;indexValue=lookup_array[idx];}}}}return index?index:luckysheet.formula.error.na;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"VLOOKUP":function VLOOKUP(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//lookup_value
  var lookup_value=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(lookup_value)){return lookup_value;}if(lookup_value.toString().replace(/\s/g,"")==""){return luckysheet.formula.error.na;}//table_array
  var data_table_array=arguments[1];var table_array=[];if(luckysheet.getObjType(data_table_array)=="array"){if(luckysheet.getObjType(data_table_array[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_table_array)){return luckysheet.formula.error.v;}for(var i=0;i<data_table_array.length;i++){var rowArr=[];for(var j=0;j<data_table_array[i].length;j++){rowArr.push(data_table_array[i][j]);}table_array.push(rowArr);}}else {var rowArr=[];for(var i=0;i<data_table_array.length;i++){rowArr.push(data_table_array[i]);}table_array.push(rowArr);}}else if(luckysheet.getObjType(data_table_array)=="object"&&data_table_array.startCell!=null){table_array=luckysheet.func_methods.getCellDataDyadicArr(data_table_array,"text");}else {return luckysheet.formula.error.v;}//col_index_num
  var col_index_num=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(col_index_num)){return col_index_num;}if(!luckysheet.func_methods.isRealNum(col_index_num)){return luckysheet.formula.error.v;}col_index_num=parseInt(col_index_num);//range_lookup
  var range_lookup=true;if(arguments.length==4){range_lookup=luckysheet.func_methods.getCellBoolen(arguments[3]);if(luckysheet.func_methods.valueIsError(range_lookup)){return range_lookup;}}//判断
  if(col_index_num<1){return luckysheet.formula.error.v;}else if(col_index_num>table_array[0].length){return luckysheet.formula.error.r;}//计算
  if(range_lookup){table_array=luckysheet.orderbydata(table_array,0,true);for(var r=0;r<table_array.length;r++){var v=table_array[r][0];var result;if(luckysheet.datecontroll.isdatetime(lookup_value)&&luckysheet.datecontroll.isdatetime(v)){result=luckysheet.datecontroll.diff(lookup_value,v);}else if(luckysheet.func_methods.isRealNum(lookup_value)&&luckysheet.func_methods.isRealNum(v)){result=numeral(lookup_value).value()-numeral(v).value();}else if(!luckysheet.func_methods.isRealNum(lookup_value)&&!luckysheet.func_methods.isRealNum(v)){result=lookup_value.localeCompare(v,"zh");}else if(!luckysheet.func_methods.isRealNum(lookup_value)){result=1;}else if(!luckysheet.func_methods.isRealNum(v)){result=-1;}if(result<0){if(r==0){return luckysheet.formula.error.na;}else {return table_array[r-1][col_index_num-1];}}else {if(r==table_array.length-1){return table_array[r][col_index_num-1];}}}}else {var index=null;for(var r=0;r<table_array.length;r++){if(lookup_value.toString()==table_array[r][0].toString()){index=r;break;}}if(index==null){return luckysheet.formula.error.na;}return table_array[index][col_index_num-1];}}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"HLOOKUP":function HLOOKUP(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var searchkey=arguments[0];if(_typeof(searchkey)=="object"){searchkey=arguments[0].data;if(luckysheet.getObjType(searchkey)=="array"){searchkey=searchkey[r];if(luckysheet.getObjType(searchkey)=="array"){searchkey=searchkey[c];}}else {searchkey=searchkey.v;}}var range=arguments[1].data;var index=arguments[2];var isaccurate=false;if(arguments.length>3){isaccurate=!!arguments[3];}if(index>range.rowl){return [luckysheet.formula.error.v,"索引超过了范围的长度，"+range[0].length];}if(index<1){return [luckysheet.formula.error.v,"索引必须大于1"];}var result=luckysheet.formula.error.na;for(var c=0;c<range[0].length;c++){var matchv=luckysheet.getcellvalue(0,c,range);var showv=luckysheet.getcellvalue(index-1,c,range);if(isaccurate){if(matchv.indexOf(searchkey)>-1){result=showv;}}else {if(luckysheet.formula.acompareb(matchv,searchkey)){result=showv;return result;}}}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LOOKUP":function LOOKUP(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var sortNum=function sortNum(a,b){//用于排序
  return b-a;};//获得两个范围的数组
  //完成矢量形式（数组形式不推荐，未做）
  //=LOOKUP(4.19, A2:A6, B2:B6)
  //=LOOKUP(0, A2:A6, B2:B6) 
  var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var searchkey=arguments[0];if(_typeof(searchkey)=="object"){searchkey=arguments[0].data;if(luckysheet.getObjType(searchkey)=="array"){searchkey=searchkey[r];if(luckysheet.getObjType(searchkey)=="array"){searchkey=searchkey[c];}}else {searchkey=searchkey.v;}}//必须为一维数组
  var range=arguments[1].data;var range2;var result=luckysheet.formula.error.na;range=luckysheet.formula.getRangeArray(range)[0];if(arguments[2]){range2=arguments[2].data;range2=luckysheet.formula.getRangeArray(range2)[0];}if(typeof searchkey=="string"){//字符串直接判断是否相等
  for(var i=0;i<range.length;i++){var matchv=range[i];var showv;if(arguments[2]){showv=range2[i];if(matchv==searchkey){result=showv;}}else {if(luckysheet.formula.acompareb(matchv,searchkey)){result=matchv;}}}}else if(luckysheet.isdatatype(searchkey)=="num"){//数字判断1.是否相等2.不等，去找接近值
  var rangeNow=[];for(var i=0;i<range.length;i++){var matchv=range[i];var showv;if(arguments[2]){showv=range2[i];if(matchv==searchkey){result=showv;return result;}else if(matchv!=searchkey&&luckysheet.isdatatype(matchv)=="num"){rangeNow.push(matchv);}}else {if(matchv==searchkey){result=matchv;return result;}else if(matchv!=searchkey&&luckysheet.isdatatype(matchv)=="num"){rangeNow.push(matchv);}}}if(rangeNow.length!=0){rangeNow.push(searchkey);rangeNow.sort(sortNum);var index=rangeNow.indexOf(searchkey);if(index==rangeNow.length-1){return [luckysheet.formula.error.na,"找不到对应参数"];}else {var mat=rangeNow[index+1];if(arguments[2]){var i=range.indexOf(mat);//改成数组
  result=range2[i];}else {result=mat;}}}}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"INDEX":function INDEX(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//单元格区域或数组常量
  var data_array=arguments[0];var array=[];if(luckysheet.getObjType(data_array)=="array"){if(luckysheet.getObjType(data_array[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array)){return luckysheet.formula.error.v;}array=luckysheet.func_methods.getDataDyadicArr(data_array);}else if(luckysheet.getObjType(data_array)=="object"&&data_array.startCell!=null){array=luckysheet.func_methods.getCellDataDyadicArr(data_array,"number");}var rowlen=array.length,collen=array[0].length;//选择数组中的某行，函数从该行返回数值
  var row_num=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(row_num)){return row_num;}if(!luckysheet.func_methods.isRealNum(row_num)){return luckysheet.formula.error.v;}row_num=parseInt(row_num);//选择数组中的某列，函数从该列返回数值
  var column_num=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(column_num)){return column_num;}if(!luckysheet.func_methods.isRealNum(column_num)){return luckysheet.formula.error.v;}column_num=parseInt(column_num);if(row_num<=0||column_num<=0){return luckysheet.formula.error.v;}if(row_num>rowlen||column_num>collen){return luckysheet.formula.error.r;}//计算
  return array[row_num-1][column_num-1];}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"GETPIVOTDATA":function GETPIVOTDATA(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{return luckysheet.formula.error.v;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CHOOSE":function CHOOSE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//指定要返回哪一项
  var index_num=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(index_num)){return index_num;}if(!luckysheet.func_methods.isRealNum(index_num)){return luckysheet.formula.error.v;}index_num=parseInt(index_num);if(index_num<1||index_num>arguments.length-1){return luckysheet.formula.error.v;}var data_result=arguments[index_num];if(luckysheet.getObjType(data_result)=="array"){if(luckysheet.getObjType(data_result[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_result)){return luckysheet.formula.error.v;}return data_result;}else if(luckysheet.getObjType(data_result)=="object"&&data_result.startCell!=null){if(data_result.data==null){return 0;}if(luckysheet.getObjType(data_result.data)=="array"){var result=luckysheet.func_methods.getCellDataDyadicArr(data_result.data,"number");return result;}else {if(luckysheet.func_methods.isRealNull(data_result.data.v)){return 0;}return data_result.data.v;}}else {return data_result;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"HYPERLINK":function HYPERLINK(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{return luckysheet.formula.error.v;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TIME":function TIME(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//时
  var hour=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(hour)){return hour;}if(!luckysheet.func_methods.isRealNum(hour)){return luckysheet.formula.error.v;}hour=parseInt(hour);//分
  var minute=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(minute)){return minute;}if(!luckysheet.func_methods.isRealNum(minute)){return luckysheet.formula.error.v;}minute=parseInt(minute);//秒
  var second=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(second)){return second;}if(!luckysheet.func_methods.isRealNum(second)){return luckysheet.formula.error.v;}second=parseInt(second);if(hour<0||hour>32767){return luckysheet.formula.error.nm;}else if(hour>24){hour=hour%24;}if(minute<0||minute>32767){return luckysheet.formula.error.nm;}if(second<0||second>32767){return luckysheet.formula.error.nm;}//计算
  var time=moment().set({'hour':hour,'minute':minute,'second':second});return moment(time).format("h:mm:ss a");}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TIMEVALUE":function TIMEVALUE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//用于表示时间的字符串
  var time_text=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(time_text)){return time_text;}//计算
  if(!moment(time_text).isValid()){return luckysheet.formula.error.v;}return (3600*moment(time_text).get('hour')+60*moment(time_text).get('minute')+moment(time_text).get('second'))/86400;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"EOMONTH":function EOMONTH(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//用于计算结果的参照日期
  var start_date=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(start_date)){return start_date;}//月数
  var months=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(months)){return months;}if(!luckysheet.func_methods.isRealNum(months)){return luckysheet.formula.error.v;}months=parseInt(months);if(!moment(start_date).isValid()){return luckysheet.formula.error.v;}//计算
  var date=moment(start_date).add(months+1,'months').set('date',1).subtract(1,'days');var mask=luckysheet.mask.genarate(moment(date).format("YYYY-MM-DD H:mm:ss"));var result=mask[2];return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"EDATE":function EDATE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//用于计算结果的参照日期
  var start_date=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(start_date)){return start_date;}//月数
  var months=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(months)){return months;}if(!luckysheet.func_methods.isRealNum(months)){return luckysheet.formula.error.v;}months=parseInt(months);if(!moment(start_date).isValid()){return luckysheet.formula.error.v;}//计算
  var date=moment(start_date).add(months,'months');var mask=luckysheet.mask.genarate(moment(date).format("YYYY-MM-DD h:mm:ss"));var result=mask[2];return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SECOND":function SECOND(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//时间值
  var time_text=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(time_text)){return time_text;}if(!moment(time_text).isValid()){return luckysheet.formula.error.v;}var result=moment(time_text).seconds();return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MINUTE":function MINUTE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//时间值
  var time_text=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(time_text)){return time_text;}if(!moment(time_text).isValid()){return luckysheet.formula.error.v;}var result=moment(time_text).minutes();return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"HOUR":function HOUR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//时间值
  var time_text=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(time_text)){return time_text;}if(!moment(time_text).isValid()){return luckysheet.formula.error.v;}var result=moment(time_text).hours();return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NOW":function NOW(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{return moment().format("YYYY-M-D HH:mm");}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NETWORKDAYS":function NETWORKDAYS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{if(arguments.length==3){var result=window.luckysheet_function.NETWORKDAYS_INTL.f(arguments[0],arguments[1],1,arguments[2]);}else {var result=window.luckysheet_function.NETWORKDAYS_INTL.f(arguments[0],arguments[1],1);}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NETWORKDAYS_INTL":function NETWORKDAYS_INTL(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var WEEKEND_TYPES=[[],[6,0],[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],undefined,undefined,undefined,[0,0],[1,1],[2,2],[3,3],[4,4],[5,5],[6,6]];//用于计算净工作日天数的时间段开始日期
  var start_date=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(start_date)){return start_date;}if(!moment(start_date).isValid()){return luckysheet.formula.error.v;}//用于计算净工作日天数的时间段结束日期
  var end_date=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(end_date)){return end_date;}if(!moment(end_date).isValid()){return luckysheet.formula.error.v;}//用于表示哪些天为周末的数字或字符串
  var weekend=WEEKEND_TYPES[1];if(arguments.length>=3){weekend=arguments[2];if(typeof weekend=="string"&&weekend.length=="7"&&/^[0-1]{7}$/g.test(weekend)){}else {weekend=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(weekend)){return weekend;}if(!luckysheet.func_methods.isRealNum(weekend)){return luckysheet.formula.error.v;}weekend=parseInt(weekend);if(weekend<1||weekend>7&&weekend<11||weekend>17){return luckysheet.formula.error.nm;}weekend=WEEKEND_TYPES[weekend];}}//这是一个范围或数组常量，其中包含作为节假日的日期
  var holidays=[];if(arguments.length==4){holidays=luckysheet.func_methods.getCellrangeDate(arguments[3]);if(luckysheet.func_methods.valueIsError(holidays)){return holidays;}}for(var i=0;i<holidays.length;i++){if(!moment(holidays[i]).isValid()){return luckysheet.formula.error.v;}}//计算 
  var days=moment(end_date).diff(moment(start_date),'days')+1;var total=days;var day=moment(start_date);for(i=0;i<days;i++){var d=moment(day).weekday();var dec=false;if(luckysheet.getObjType(weekend)=="array"){if(d===weekend[0]||d===weekend[1]){dec=true;}}else {if(d==0){d=7;}if(weekend.charAt(d-1)=="0"){dec=true;}}for(var j=0;j<holidays.length;j++){if(moment(day).diff(moment(holidays[j]),'days')===0){dec=true;break;}}if(dec){total--;}day=moment(day).add(1,'days');}return total;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISOWEEKNUM":function ISOWEEKNUM(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//用于日期和时间计算的日期
  var date=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(date)){return date;}if(!moment(date).isValid()){return luckysheet.formula.error.v;}//计算 
  return moment(date).isoWeeks();}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"WEEKNUM":function WEEKNUM(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var WEEK_STARTS=[undefined,7,1,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,1,2,3,4,5,6,7];//用于计算净工作日天数的时间段开始日期
  var serial_number=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(serial_number)){return serial_number;}if(!moment(serial_number).isValid()){return luckysheet.formula.error.v;}//用于表示哪些天为周末的数字或字符串
  var return_type=1;if(arguments.length==2){return_type=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(return_type)){return return_type;}if(!luckysheet.func_methods.isRealNum(return_type)){return luckysheet.formula.error.v;}return_type=parseInt(return_type);}if(return_type==21){return window.luckysheet_function.ISOWEEKNUM.f(arguments[0]);}if([1,2,11,12,13,14,15,16,17].indexOf(return_type)==-1){return luckysheet.formula.error.nm;}//计算 
  var week_start=WEEK_STARTS[return_type];var inc=moment(serial_number).isoWeekday()>=week_start?1:0;var result=moment(serial_number).isoWeeks()+inc;return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"WEEKDAY":function WEEKDAY(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var WEEK_TYPES=[[],[1,2,3,4,5,6,7],[7,1,2,3,4,5,6],[6,0,1,2,3,4,5],[],[],[],[],[],[],[],[7,1,2,3,4,5,6],[6,7,1,2,3,4,5],[5,6,7,1,2,3,4],[4,5,6,7,1,2,3],[3,4,5,6,7,1,2],[2,3,4,5,6,7,1],[1,2,3,4,5,6,7]];//用于计算净工作日天数的时间段开始日期
  var serial_number=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(serial_number)){return serial_number;}if(!moment(serial_number).isValid()){return luckysheet.formula.error.v;}//以数字指示使用哪种编号顺序来表示星期几
  var return_type=1;if(arguments.length==2){return_type=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(return_type)){return return_type;}if(!luckysheet.func_methods.isRealNum(return_type)){return luckysheet.formula.error.v;}return_type=parseInt(return_type);}if([1,2,3,11,12,13,14,15,16,17].indexOf(return_type)==-1){return luckysheet.formula.error.nm;}//计算 
  var result=WEEK_TYPES[return_type][moment(serial_number).day()];return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DAY":function DAY(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//用于计算净工作日天数的时间段开始日期
  var serial_number=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(serial_number)){return serial_number;}if(!moment(serial_number).isValid()){return luckysheet.formula.error.v;}//计算 
  return moment(serial_number).date();}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DAYS":function DAYS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结束日期
  var end_date=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(end_date)){return end_date;}if(!moment(end_date).isValid()){return luckysheet.formula.error.v;}//开始日期
  var start_date=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(start_date)){return start_date;}if(!moment(start_date).isValid()){return luckysheet.formula.error.v;}//计算 
  var result=moment(end_date).diff(moment(start_date),'days');return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DAYS360":function DAYS360(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//开始日期
  var start_date=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(start_date)){return start_date;}if(!moment(start_date).isValid()){return luckysheet.formula.error.v;}//结束日期
  var end_date=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(end_date)){return end_date;}if(!moment(end_date).isValid()){return luckysheet.formula.error.v;}//天数计算方法
  var method=false;if(arguments.length==3){method=luckysheet.func_methods.getCellBoolen(arguments[2]);if(luckysheet.func_methods.valueIsError(method)){return method;}}//计算 
  var sm=moment(start_date).month();var em=moment(end_date).month();var sd,ed;if(method){sd=moment(start_date).date()===31?30:moment(start_date).date();ed=moment(end_date).date()===31?30:moment(end_date).date();}else {var smd=moment().set({'year':moment(start_date).year(),'month':sm+1,'date':0}).date();var emd=moment().set({'year':moment(end_date).year(),'month':em+1,'date':0}).date();sd=moment(start_date).date()===smd?30:moment(start_date).date();if(moment(end_date).date()===emd){if(sd<30){em++;ed=1;}else {ed=30;}}else {ed=moment(end_date).date();}}var result=360*moment(end_date).diff(moment(start_date),'years')+30*(em-sm)+(ed-sd);return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DATE":function DATE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//年
  var year=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(year)){return year;}if(!luckysheet.func_methods.isRealNum(year)){return luckysheet.formula.error.v;}year=parseInt(year);//月
  var month=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(month)){return month;}if(!luckysheet.func_methods.isRealNum(month)){return luckysheet.formula.error.v;}month=parseInt(month);//日
  var day=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(day)){return day;}if(!luckysheet.func_methods.isRealNum(day)){return luckysheet.formula.error.v;}day=parseInt(day);if(year<0||year>=10000){return luckysheet.formula.error.nm;}else if(year>=0&&year<=1899){year=year+1900;}var date=moment().set({'year':year,'month':month-1,"date":day});if(moment(date).year()<1900){return luckysheet.formula.error.nm;}return moment(date).format("YYYY-MM-DD");}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DATEVALUE":function DATEVALUE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//开始日期
  var date_text=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(date_text)){return date_text;}if(!moment(date_text).isValid()){return luckysheet.formula.error.v;}//计算
  date_text=moment(date_text).format("YYYY-MM-DD");var result=luckysheet.mask.genarate(date_text)[2];return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DATEDIF":function DATEDIF(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{luckysheet_getValue(arguments);for(var i=0;i<arguments.length-1;i++){arguments[i]=moment.fromOADate(arguments[i]).format("l");if(!luckysheet.datecontroll.isdatetime(arguments[i])){return luckysheet.formula.error.v;}}var startDate=moment(arguments[0]);var endDate=moment(arguments[1]);var unit=arguments[2];var result=luckysheet.formula.error.v;if(luckysheet_function.DAYS.f(endDate,startDate)<0){return luckysheet.formula.error.v;}switch(unit){case"Y":case"y":result=endDate.diff(startDate,"years",false);break;case"M":case"m":result=endDate.diff(startDate,"months",false);break;case"D":case"d":result=endDate.diff(startDate,"days",false);break;case"MD":case"md":result=endDate.format('DD')-startDate.format('DD');break;case"YM":case"ym":var startM=parseInt(startDate.format('M'));//注意字符串转化为数字
  var endM=parseInt(endDate.format('M'));result=startM<=endM?endM-startM:endM+12-startM;break;case"YD":case"yd":var startM=luckysheet.mask.genarate(startDate.format('MM-DD'))[2];var endM=luckysheet.mask.genarate(endDate.format('MM-DD'))[2];result=startM<=endM?endM-startM:endM+365-startM;break;default:result=luckysheet.formula.error.v;}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"WORKDAY":function WORKDAY(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{if(arguments.length==3){var result=window.luckysheet_function.WORKDAY_INTL.f(arguments[0],arguments[1],1,arguments[2]);}else {var result=window.luckysheet_function.WORKDAY_INTL.f(arguments[0],arguments[1],1);}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"WORKDAY_INTL":function WORKDAY_INTL(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var WEEKEND_TYPES=[[],[6,0],[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],undefined,undefined,undefined,[0,0],[1,1],[2,2],[3,3],[4,4],[5,5],[6,6]];//计算的开始日期
  var start_date=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(start_date)){return start_date;}if(!moment(start_date).isValid()){return luckysheet.formula.error.v;}//工作日的天数
  var days=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(days)){return days;}if(!luckysheet.func_methods.isRealNum(days)){return luckysheet.formula.error.v;}days=parseInt(days);//用于表示哪些天为周末的数字或字符串
  var weekend=WEEKEND_TYPES[1];if(arguments.length>=3){weekend=arguments[2];if(typeof weekend=="string"&&weekend.length=="7"&&/^[0-1]{7}$/g.test(weekend)){}else {weekend=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(weekend)){return weekend;}if(!luckysheet.func_methods.isRealNum(weekend)){return luckysheet.formula.error.v;}weekend=parseInt(weekend);if(weekend<1||weekend>7&&weekend<11||weekend>17){return luckysheet.formula.error.nm;}weekend=WEEKEND_TYPES[weekend];}}//这是一个范围或数组常量，其中包含作为节假日的日期
  var holidays=[];if(arguments.length==4){holidays=luckysheet.func_methods.getCellrangeDate(arguments[3]);if(luckysheet.func_methods.valueIsError(holidays)){return holidays;}}for(var i=0;i<holidays.length;i++){if(!moment(holidays[i]).isValid()){return luckysheet.formula.error.v;}}//计算 
  var d=0;while(d<days){start_date=moment(start_date).add(1,'days');var day=moment(start_date).weekday();if(luckysheet.getObjType(weekend)){if(day===weekend[0]||day===weekend[1]){continue;}}else {if(day==0){day=7;}if(weekend.charAt(day-1)=="0"){continue;}}for(var j=0;j<holidays.length;j++){if(moment(start_date).diff(moment(holidays[j]),'days')===0){d--;break;}}d++;}return moment(start_date).format("YYYY-MM-DD");}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"YEAR":function YEAR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//开始日期
  var serial_number=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(serial_number)){return serial_number;}if(!moment(serial_number).isValid()){return luckysheet.formula.error.v;}//计算
  return moment(serial_number).year();}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"YEARFRAC":function YEARFRAC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//开始日期
  var start_date=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(start_date)){return start_date;}if(!moment(start_date).isValid()){return luckysheet.formula.error.v;}//结束日期
  var end_date=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(end_date)){return end_date;}if(!moment(end_date).isValid()){return luckysheet.formula.error.v;}//日计数基准类型
  var basis=0;if(arguments.length==3){basis=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(basis<0||basis>4){return luckysheet.formula.error.nm;}//计算
  var sd=moment(start_date).date();var sm=moment(start_date).month()+1;var sy=moment(start_date).year();var ed=moment(end_date).date();var em=moment(end_date).month()+1;var ey=moment(end_date).year();var result;switch(basis){case 0:// US (NASD) 30/360
  if(sd===31&&ed===31){sd=30;ed=30;}else if(sd===31){sd=30;}else if(sd===30&&ed===31){ed=30;}result=(ed+em*30+ey*360-(sd+sm*30+sy*360))/360;break;case 1:// Actual/actual
  var ylength=365;if(sy===ey||sy+1===ey&&(sm>em||sm===em&&sd>=ed)){if(sy===ey&&luckysheet.func_methods.isLeapYear(sy)||luckysheet.func_methods.feb29Between(start_date,end_date)||em===1&&ed===29){ylength=366;}return moment(end_date).diff(moment(start_date),'days')/ylength;}var years=ey-sy+1;var days=(moment().set({'year':ey+1,'month':0,'date':1})-moment().set({'year':sy,'month':0,'date':1}))/1000/60/60/24;var average=days/years;result=moment(end_date).diff(moment(start_date),'days')/average;break;case 2:// Actual/360
  result=moment(end_date).diff(moment(start_date),'days')/360;break;case 3:// Actual/365
  result=moment(end_date).diff(moment(start_date),'days')/365;break;case 4:// European 30/360
  result=(ed+em*30+ey*360-(sd+sm*30+sy*360))/360;break;}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TODAY":function TODAY(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{return moment().format("YYYY-MM-DD");}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MONTH":function MONTH(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//开始日期
  var serial_number=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(serial_number)){return serial_number;}if(!moment(serial_number).isValid()){return luckysheet.formula.error.v;}//计算
  return moment(serial_number).month()+1;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"EFFECT":function EFFECT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//每年的名义利率
  var nominal_rate=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(nominal_rate)){return nominal_rate;}if(!luckysheet.func_methods.isRealNum(nominal_rate)){return luckysheet.formula.error.v;}nominal_rate=parseFloat(nominal_rate);//每年的复利计算期数
  var npery=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(npery)){return npery;}if(!luckysheet.func_methods.isRealNum(npery)){return luckysheet.formula.error.v;}npery=parseInt(npery);if(nominal_rate<=0||npery<1){return luckysheet.formula.error.nm;}return Math.pow(1+nominal_rate/npery,npery)-1;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DOLLAR":function DOLLAR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要设置格式的值
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//显示的小数位数
  var decimals=2;if(arguments.length==2){decimals=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(decimals)){return decimals;}if(!luckysheet.func_methods.isRealNum(decimals)){return luckysheet.formula.error.v;}decimals=parseInt(decimals);}if(decimals>9){decimals=9;}var foucsStatus="0.";for(var i=1;i<=decimals;i++){foucsStatus+="0";}//计算 
  var sign=number>0?1:-1;return sign*Math.floor(Math.abs(number)*Math.pow(10,decimals))/Math.pow(10,decimals);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DOLLARDE":function DOLLARDE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//分数
  var fractional_dollar=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(fractional_dollar)){return fractional_dollar;}if(!luckysheet.func_methods.isRealNum(fractional_dollar)){return luckysheet.formula.error.v;}fractional_dollar=parseFloat(fractional_dollar);//用作分数中的分母的整数
  var fraction=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(fraction)){return fraction;}if(!luckysheet.func_methods.isRealNum(fraction)){return luckysheet.formula.error.v;}fraction=parseInt(fraction);if(fraction<0){return luckysheet.formula.error.nm;}else if(fraction==0){return luckysheet.formula.error.d;}//计算   
  var result=parseInt(fractional_dollar,10);result+=fractional_dollar%1*Math.pow(10,Math.ceil(Math.log(fraction)/Math.LN10))/fraction;var power=Math.pow(10,Math.ceil(Math.log(fraction)/Math.LN2)+1);result=Math.round(result*power)/power;return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DOLLARFR":function DOLLARFR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//小数
  var decimal_dollar=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(decimal_dollar)){return decimal_dollar;}if(!luckysheet.func_methods.isRealNum(decimal_dollar)){return luckysheet.formula.error.v;}decimal_dollar=parseFloat(decimal_dollar);//用作分数中的分母的整数
  var fraction=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(fraction)){return fraction;}if(!luckysheet.func_methods.isRealNum(fraction)){return luckysheet.formula.error.v;}fraction=parseInt(fraction);if(fraction<0){return luckysheet.formula.error.nm;}else if(fraction==0){return luckysheet.formula.error.d;}//计算        
  var result=parseInt(decimal_dollar,10);result+=decimal_dollar%1*Math.pow(10,-Math.ceil(Math.log(fraction)/Math.LN10))*fraction;return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DB":function DB(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//资产原值
  var cost=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(cost)){return cost;}if(!luckysheet.func_methods.isRealNum(cost)){return luckysheet.formula.error.v;}cost=parseFloat(cost);//资产残值
  var salvage=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(salvage)){return salvage;}if(!luckysheet.func_methods.isRealNum(salvage)){return luckysheet.formula.error.v;}salvage=parseFloat(salvage);//资产的折旧期数
  var life=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(life)){return life;}if(!luckysheet.func_methods.isRealNum(life)){return luckysheet.formula.error.v;}life=parseFloat(life);//在使用期限内要计算折旧的折旧期
  var period=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(period)){return period;}if(!luckysheet.func_methods.isRealNum(period)){return luckysheet.formula.error.v;}period=parseInt(period);//折旧第一年中的月数
  var month=12;if(arguments.length==5){month=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(month)){return month;}if(!luckysheet.func_methods.isRealNum(month)){return luckysheet.formula.error.v;}month=parseInt(month);}if(cost<0||salvage<0||life<0||period<0){return luckysheet.formula.error.nm;}if(month<1||month>12){return luckysheet.formula.error.nm;}if(period>life){return luckysheet.formula.error.nm;}if(salvage>=cost){return 0;}//计算        
  var rate=(1-Math.pow(salvage/cost,1/life)).toFixed(3);var initial=cost*rate*month/12;var total=initial;var current=0;var ceiling=period===life?life-1:period;for(var i=2;i<=ceiling;i++){current=(cost-total)*rate;total+=current;}if(period===1){var result=initial;}else if(period===life){var result=(cost-total)*rate;}else {var result=current;}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DDB":function DDB(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//资产原值
  var cost=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(cost)){return cost;}if(!luckysheet.func_methods.isRealNum(cost)){return luckysheet.formula.error.v;}cost=parseFloat(cost);//资产残值
  var salvage=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(salvage)){return salvage;}if(!luckysheet.func_methods.isRealNum(salvage)){return luckysheet.formula.error.v;}salvage=parseFloat(salvage);//资产的折旧期数
  var life=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(life)){return life;}if(!luckysheet.func_methods.isRealNum(life)){return luckysheet.formula.error.v;}life=parseFloat(life);//在使用期限内要计算折旧的折旧期
  var period=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(period)){return period;}if(!luckysheet.func_methods.isRealNum(period)){return luckysheet.formula.error.v;}period=parseInt(period);//折旧的递减系数
  var factor=2;if(arguments.length==5){factor=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(factor)){return factor;}if(!luckysheet.func_methods.isRealNum(factor)){return luckysheet.formula.error.v;}factor=parseFloat(factor);}if(cost<0||salvage<0||life<0||period<0||factor<=0){return luckysheet.formula.error.nm;}if(period>life){return luckysheet.formula.error.nm;}if(salvage>=cost){return 0;}//计算        
  var total=0;var current=0;for(var i=1;i<=period;i++){current=Math.min((cost-total)*(factor/life),cost-salvage-total);total+=current;}return current;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"RATE":function RATE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//年金的付款总期数。
  var nper=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(nper)){return nper;}if(!luckysheet.func_methods.isRealNum(nper)){return luckysheet.formula.error.v;}nper=parseFloat(nper);//每期的付款金额
  var pmt=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(pmt)){return pmt;}if(!luckysheet.func_methods.isRealNum(pmt)){return luckysheet.formula.error.v;}pmt=parseFloat(pmt);//现值
  var pv=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(pv)){return pv;}if(!luckysheet.func_methods.isRealNum(pv)){return luckysheet.formula.error.v;}pv=parseFloat(pv);//最后一次付款后希望得到的现金余额
  var fv=0;if(arguments.length>=4){fv=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(fv)){return fv;}if(!luckysheet.func_methods.isRealNum(fv)){return luckysheet.formula.error.v;}fv=parseFloat(fv);}//指定各期的付款时间是在期初还是期末
  var type=0;if(arguments.length>=5){type=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(type)){return type;}if(!luckysheet.func_methods.isRealNum(type)){return luckysheet.formula.error.v;}type=parseFloat(type);}//预期利率
  var guess=0.1;if(arguments.length==6){guess=luckysheet.func_methods.getFirstValue(arguments[5]);if(luckysheet.func_methods.valueIsError(guess)){return guess;}if(!luckysheet.func_methods.isRealNum(guess)){return luckysheet.formula.error.v;}guess=parseFloat(guess);}if(type!=0&&type!=1){return luckysheet.formula.error.nm;}//计算
  var epsMax=1e-6;var iterMax=100;var iter=0;var close=false;var rate=guess;while(iter<iterMax&&!close){var t1=Math.pow(rate+1,nper);var t2=Math.pow(rate+1,nper-1);var f1=fv+t1*pv+pmt*(t1-1)*(rate*type+1)/rate;var f2=nper*t2*pv-pmt*(t1-1)*(rate*type+1)/Math.pow(rate,2);var f3=nper*pmt*t2*(rate*type+1)/rate+pmt*(t1-1)*type/rate;var newRate=rate-f1/(f2+f3);if(Math.abs(newRate-rate)<epsMax)close=true;iter++;rate=newRate;}if(!close)return luckysheet.formula.error.nm;return rate;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CUMPRINC":function CUMPRINC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//利率
  var rate=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//总付款期数
  var nper=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(nper)){return nper;}if(!luckysheet.func_methods.isRealNum(nper)){return luckysheet.formula.error.v;}nper=parseFloat(nper);//年金的现值
  var pv=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(pv)){return pv;}if(!luckysheet.func_methods.isRealNum(pv)){return luckysheet.formula.error.v;}pv=parseFloat(pv);//首期
  var start_period=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(start_period)){return start_period;}if(!luckysheet.func_methods.isRealNum(start_period)){return luckysheet.formula.error.v;}start_period=parseInt(start_period);//末期
  var end_period=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(end_period)){return end_period;}if(!luckysheet.func_methods.isRealNum(end_period)){return luckysheet.formula.error.v;}end_period=parseInt(end_period);//指定各期的付款时间是在期初还是期末
  var type=luckysheet.func_methods.getFirstValue(arguments[5]);if(luckysheet.func_methods.valueIsError(type)){return type;}if(!luckysheet.func_methods.isRealNum(type)){return luckysheet.formula.error.v;}type=parseFloat(type);if(rate<=0||nper<=0||pv<=0){return luckysheet.formula.error.nm;}if(start_period<1||end_period<1||start_period>end_period){return luckysheet.formula.error.nm;}if(type!=0&&type!=1){return luckysheet.formula.error.nm;}//计算
  var payment=window.luckysheet_function.PMT.f(rate,nper,pv,0,type);var principal=0;if(start_period===1){if(type===0){principal=payment+pv*rate;}else {principal=payment;}start_period++;}for(var i=start_period;i<=end_period;i++){if(type>0){principal+=payment-(window.luckysheet_function.FV.f(rate,i-2,payment,pv,1)-payment)*rate;}else {principal+=payment-window.luckysheet_function.FV.f(rate,i-1,payment,pv,0)*rate;}}return principal;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COUPNUM":function COUPNUM(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//年付息次数
  var frequency=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(frequency)){return frequency;}if(!luckysheet.func_methods.isRealNum(frequency)){return luckysheet.formula.error.v;}frequency=parseInt(frequency);//日计数基准类型
  var basis=0;if(arguments.length==4){var basis=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(frequency!=1&&frequency!=2&&frequency!=4){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}//计算
  var sd=moment(settlement).date();var sm=moment(settlement).month()+1;var sy=moment(settlement).year();var ed=moment(maturity).date();var em=moment(maturity).month()+1;var ey=moment(maturity).year();var result;switch(basis){case 0:// US (NASD) 30/360
  if(sd===31&&ed===31){sd=30;ed=30;}else if(sd===31){sd=30;}else if(sd===30&&ed===31){ed=30;}result=(ed+em*30+ey*360-(sd+sm*30+sy*360))/(360/frequency);break;case 1:// Actual/actual
  var ylength=365;if(sy===ey||sy+1===ey&&(sm>em||sm===em&&sd>=ed)){if(sy===ey&&luckysheet.func_methods.isLeapYear(sy)||luckysheet.func_methods.feb29Between(settlement,maturity)||em===1&&ed===29){ylength=366;}return moment(maturity).diff(moment(settlement),'days')/(ylength/frequency);}var years=ey-sy+1;var days=(moment().set({'year':ey+1,'month':0,'date':1})-moment().set({'year':sy,'month':0,'date':1}))/1000/60/60/24;var average=days/years;result=moment(maturity).diff(moment(settlement),'days')/(average/frequency);break;case 2:// Actual/360
  result=moment(maturity).diff(moment(settlement),'days')/(360/frequency);break;case 3:// Actual/365
  result=moment(maturity).diff(moment(settlement),'days')/(365/frequency);break;case 4:// European 30/360
  result=(ed+em*30+ey*360-(sd+sm*30+sy*360))/(360/frequency);break;}return Math.round(result);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SYD":function SYD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//资产原值
  var cost=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(cost)){return cost;}if(!luckysheet.func_methods.isRealNum(cost)){return luckysheet.formula.error.v;}cost=parseFloat(cost);//资产残值
  var salvage=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(salvage)){return salvage;}if(!luckysheet.func_methods.isRealNum(salvage)){return luckysheet.formula.error.v;}salvage=parseFloat(salvage);//资产的折旧期数
  var life=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(life)){return life;}if(!luckysheet.func_methods.isRealNum(life)){return luckysheet.formula.error.v;}life=parseFloat(life);//在使用期限内要计算折旧的折旧期
  var period=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(period)){return period;}if(!luckysheet.func_methods.isRealNum(period)){return luckysheet.formula.error.v;}period=parseInt(period);if(life==0){return luckysheet.formula.error.nm;}if(period<1||period>life){return luckysheet.formula.error.nm;}return (cost-salvage)*(life-period+1)*2/(life*(life+1));}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TBILLEQ":function TBILLEQ(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//债券购买时的贴现率
  var discount=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(discount)){return discount;}if(!luckysheet.func_methods.isRealNum(discount)){return luckysheet.formula.error.v;}discount=parseFloat(discount);if(discount<=0){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>0){return luckysheet.formula.error.nm;}if(moment(maturity)-moment(settlement)>365*24*60*60*1000){return luckysheet.formula.error.nm;}return 365*discount/(360-discount*moment(maturity).diff(moment(settlement),'days'));}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TBILLYIELD":function TBILLYIELD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//有价证券的价格
  var pr=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(pr)){return pr;}if(!luckysheet.func_methods.isRealNum(pr)){return luckysheet.formula.error.v;}pr=parseFloat(pr);if(pr<=0){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}if(moment(maturity)-moment(settlement)>365*24*60*60*1000){return luckysheet.formula.error.nm;}return (100-pr)/pr*(360/moment(maturity).diff(moment(settlement),'days'));}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TBILLPRICE":function TBILLPRICE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//有价证券的价格
  var discount=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(discount)){return discount;}if(!luckysheet.func_methods.isRealNum(discount)){return luckysheet.formula.error.v;}discount=parseFloat(discount);if(discount<=0){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>0){return luckysheet.formula.error.nm;}if(moment(maturity)-moment(settlement)>365*24*60*60*1000){return luckysheet.formula.error.nm;}return 100*(1-discount*moment(maturity).diff(moment(settlement),'days')/360);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PV":function PV(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//利率
  var rate=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//总付款期数
  var nper=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(nper)){return nper;}if(!luckysheet.func_methods.isRealNum(nper)){return luckysheet.formula.error.v;}nper=parseFloat(nper);//每期的付款金额
  var pmt=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(pmt)){return pmt;}if(!luckysheet.func_methods.isRealNum(pmt)){return luckysheet.formula.error.v;}pmt=parseFloat(pmt);//最后一次付款后希望得到的现金余额
  var fv=0;if(arguments.length>=4){fv=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(fv)){return fv;}if(!luckysheet.func_methods.isRealNum(fv)){return luckysheet.formula.error.v;}fv=parseFloat(fv);}//指定各期的付款时间是在期初还是期末
  var type=0;if(arguments.length>=5){type=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(type)){return type;}if(!luckysheet.func_methods.isRealNum(type)){return luckysheet.formula.error.v;}type=parseFloat(type);}if(type!=0&&type!=1){return luckysheet.formula.error.nm;}//计算
  if(rate===0){var result=-pmt*nper-fv;}else {var result=((1-Math.pow(1+rate,nper))/rate*pmt*(1+rate*type)-fv)/Math.pow(1+rate,nper);}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ACCRINT":function ACCRINT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//有价证券的发行日
  var issue=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(issue)){return issue;}if(!moment(issue).isValid()){return luckysheet.formula.error.v;}//有价证券的首次计息日
  var first_interest=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(first_interest)){return first_interest;}if(!moment(first_interest).isValid()){return luckysheet.formula.error.v;}//有价证券的结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[2]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//有价证券的年息票利率
  var rate=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//证券的票面值
  var par=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(par)){return par;}if(!luckysheet.func_methods.isRealNum(par)){return luckysheet.formula.error.v;}par=parseFloat(par);//年付息次数
  var frequency=luckysheet.func_methods.getFirstValue(arguments[5]);if(luckysheet.func_methods.valueIsError(frequency)){return frequency;}if(!luckysheet.func_methods.isRealNum(frequency)){return luckysheet.formula.error.v;}frequency=parseInt(frequency);//日计数基准类型
  var basis=0;if(arguments.length>=7){basis=luckysheet.func_methods.getFirstValue(arguments[6]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}//当结算日期晚于首次计息日期时用于计算总应计利息的方法
  var calc_method=true;if(arguments.length==8){calc_method=luckysheet.func_methods.getCellBoolen(arguments[7]);if(luckysheet.func_methods.valueIsError(calc_method)){return calc_method;}}if(rate<=0||par<=0){return luckysheet.formula.error.nm;}if(frequency!=1&&frequency!=2&&frequency!=4){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(issue)-moment(settlement)>=0){return luckysheet.formula.error.nm;}//计算
  var result;if(moment(settlement)-moment(first_interest)>=0&&!calc_method){var sd=moment(first_interest).date();var sm=moment(first_interest).month()+1;var sy=moment(first_interest).year();var ed=moment(settlement).date();var em=moment(settlement).month()+1;var ey=moment(settlement).year();switch(basis){case 0:// US (NASD) 30/360
  if(sd===31&&ed===31){sd=30;ed=30;}else if(sd===31){sd=30;}else if(sd===30&&ed===31){ed=30;}result=(ed+em*30+ey*360-(sd+sm*30+sy*360))/360;break;case 1:// Actual/actual
  var ylength=365;if(sy===ey||sy+1===ey&&(sm>em||sm===em&&sd>=ed)){if(sy===ey&&luckysheet.func_methods.isLeapYear(sy)||luckysheet.func_methods.feb29Between(first_interest,settlement)||em===1&&ed===29){ylength=366;}return moment(settlement).diff(moment(first_interest),'days')/ylength;}var years=ey-sy+1;var days=(moment().set({'year':ey+1,'month':0,'date':1})-moment().set({'year':sy,'month':0,'date':1}))/1000/60/60/24;var average=days/years;result=moment(settlement).diff(moment(first_interest),'days')/average;break;case 2:// Actual/360
  result=moment(settlement).diff(moment(first_interest),'days')/360;break;case 3:// Actual/365
  result=moment(settlement).diff(moment(first_interest),'days')/365;break;case 4:// European 30/360
  result=(ed+em*30+ey*360-(sd+sm*30+sy*360))/360;break;}}else {var sd=moment(issue).date();var sm=moment(issue).month()+1;var sy=moment(issue).year();var ed=moment(settlement).date();var em=moment(settlement).month()+1;var ey=moment(settlement).year();switch(basis){case 0:// US (NASD) 30/360
  if(sd===31&&ed===31){sd=30;ed=30;}else if(sd===31){sd=30;}else if(sd===30&&ed===31){ed=30;}result=(ed+em*30+ey*360-(sd+sm*30+sy*360))/360;break;case 1:// Actual/actual
  var ylength=365;if(sy===ey||sy+1===ey&&(sm>em||sm===em&&sd>=ed)){if(sy===ey&&luckysheet.func_methods.isLeapYear(sy)||luckysheet.func_methods.feb29Between(issue,settlement)||em===1&&ed===29){ylength=366;}return moment(settlement).diff(moment(issue),'days')/ylength;}var years=ey-sy+1;var days=(moment().set({'year':ey+1,'month':0,'date':1})-moment().set({'year':sy,'month':0,'date':1}))/1000/60/60/24;var average=days/years;result=moment(settlement).diff(moment(issue),'days')/average;break;case 2:// Actual/360
  result=moment(settlement).diff(moment(issue),'days')/360;break;case 3:// Actual/365
  result=moment(settlement).diff(moment(issue),'days')/365;break;case 4:// European 30/360
  result=(ed+em*30+ey*360-(sd+sm*30+sy*360))/360;break;}}return par*rate*result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ACCRINTM":function ACCRINTM(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//有价证券的发行日
  var issue=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(issue)){return issue;}if(!moment(issue).isValid()){return luckysheet.formula.error.v;}//有价证券的到期日
  var settlement=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//有价证券的年息票利率
  var rate=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//证券的票面值
  var par=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(par)){return par;}if(!luckysheet.func_methods.isRealNum(par)){return luckysheet.formula.error.v;}par=parseFloat(par);//日计数基准类型
  var basis=0;if(arguments.length==5){basis=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(rate<=0||par<=0){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(issue)-moment(settlement)>=0){return luckysheet.formula.error.nm;}//计算
  var sd=moment(issue).date();var sm=moment(issue).month()+1;var sy=moment(issue).year();var ed=moment(settlement).date();var em=moment(settlement).month()+1;var ey=moment(settlement).year();var result;switch(basis){case 0:// US (NASD) 30/360
  if(sd===31&&ed===31){sd=30;ed=30;}else if(sd===31){sd=30;}else if(sd===30&&ed===31){ed=30;}result=(ed+em*30+ey*360-(sd+sm*30+sy*360))/360;break;case 1:// Actual/actual
  var ylength=365;if(sy===ey||sy+1===ey&&(sm>em||sm===em&&sd>=ed)){if(sy===ey&&luckysheet.func_methods.isLeapYear(sy)||luckysheet.func_methods.feb29Between(issue,settlement)||em===1&&ed===29){ylength=366;}return moment(settlement).diff(moment(issue),'days')/ylength;}var years=ey-sy+1;var days=(moment().set({'year':ey+1,'month':0,'date':1})-moment().set({'year':sy,'month':0,'date':1}))/1000/60/60/24;var average=days/years;result=moment(settlement).diff(moment(issue),'days')/average;break;case 2:// Actual/360
  result=moment(settlement).diff(moment(issue),'days')/360;break;case 3:// Actual/365
  result=moment(settlement).diff(moment(issue),'days')/365;break;case 4:// European 30/360
  result=(ed+em*30+ey*360-(sd+sm*30+sy*360))/360;break;}return par*rate*result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COUPDAYBS":function COUPDAYBS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//年付息次数
  var frequency=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(frequency)){return frequency;}if(!luckysheet.func_methods.isRealNum(frequency)){return luckysheet.formula.error.v;}frequency=parseInt(frequency);//日计数基准类型
  var basis=0;if(arguments.length==4){basis=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(frequency!=1&&frequency!=2&&frequency!=4){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}//计算
  var interest;//结算日之前的上一个付息日
  var maxCount=Math.ceil(moment(maturity).diff(moment(settlement),'months')/(12/frequency))+1;for(var i=1;i<=maxCount;i++){var di=moment(maturity).subtract(12/frequency*i,'months');if(di<=moment(settlement)){interest=di;break;}}var result;switch(basis){case 0:// US (NASD) 30/360
  var sd=moment(interest).date();var sm=moment(interest).month()+1;var sy=moment(interest).year();var ed=moment(settlement).date();var em=moment(settlement).month()+1;var ey=moment(settlement).year();if(sd===31&&ed===31){sd=30;ed=30;}else if(sd===31){sd=30;}else if(sd===30&&ed===31){ed=30;}result=ed+em*30+ey*360-(sd+sm*30+sy*360);break;case 1:// Actual/actual
  case 2:// Actual/360
  case 3:// Actual/365
  result=moment(settlement).diff(moment(interest),'days');break;case 4:// European 30/360
  var sd=moment(interest).date();var sm=moment(interest).month()+1;var sy=moment(interest).year();var ed=moment(settlement).date();var em=moment(settlement).month()+1;var ey=moment(settlement).year();result=ed+em*30+ey*360-(sd+sm*30+sy*360);break;}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COUPDAYS":function COUPDAYS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//年付息次数
  var frequency=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(frequency)){return frequency;}if(!luckysheet.func_methods.isRealNum(frequency)){return luckysheet.formula.error.v;}frequency=parseInt(frequency);//日计数基准类型
  var basis=0;if(arguments.length==4){basis=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(frequency!=1&&frequency!=2&&frequency!=4){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}//计算
  var result;switch(basis){case 0:// US (NASD) 30/360
  result=360/frequency;break;case 1:// Actual/actual
  var maxCount=Math.ceil(moment(maturity).diff(moment(settlement),'months')/(12/frequency))+1;for(var i=1;i<=maxCount;i++){var d1=moment(maturity).subtract(12/frequency*i,'months');if(d1<=moment(settlement)){var d2=moment(maturity).subtract(12/frequency*(i-1),'months');result=moment(d2).diff(moment(d1),'days');break;}}break;case 2:// Actual/360
  result=360/frequency;break;case 3:// Actual/365
  result=365/frequency;break;case 4:// European 30/360
  result=360/frequency;break;}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COUPDAYSNC":function COUPDAYSNC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//年付息次数
  var frequency=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(frequency)){return frequency;}if(!luckysheet.func_methods.isRealNum(frequency)){return luckysheet.formula.error.v;}frequency=parseInt(frequency);//日计数基准类型
  var basis=0;if(arguments.length==4){basis=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(frequency!=1&&frequency!=2&&frequency!=4){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}//计算
  var interest;//结算日之后的下一个付息日
  var maxCount=Math.ceil(moment(maturity).diff(moment(settlement),'months')/(12/frequency))+1;for(var i=1;i<=maxCount;i++){var di=moment(maturity).subtract(12/frequency*i,'months');if(di<=moment(settlement)){interest=moment(maturity).subtract(12/frequency*(i-1),'months');break;}}var result;switch(basis){case 0:// US (NASD) 30/360
  var sd=moment(settlement).date();var sm=moment(settlement).month()+1;var sy=moment(settlement).year();var ed=moment(interest).date();var em=moment(interest).month()+1;var ey=moment(interest).year();if(sd===31&&ed===31){sd=30;ed=30;}else if(sd===31){sd=30;}else if(sd===30&&ed===31){ed=30;}result=ed+em*30+ey*360-(sd+sm*30+sy*360);break;case 1:// Actual/actual
  case 2:// Actual/360
  case 3:// Actual/365
  result=moment(interest).diff(moment(settlement),'days');break;case 4:// European 30/360
  var sd=moment(settlement).date();var sm=moment(settlement).month()+1;var sy=moment(settlement).year();var ed=moment(interest).date();var em=moment(interest).month()+1;var ey=moment(interest).year();result=ed+em*30+ey*360-(sd+sm*30+sy*360);break;}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COUPNCD":function COUPNCD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//年付息次数
  var frequency=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(frequency)){return frequency;}if(!luckysheet.func_methods.isRealNum(frequency)){return luckysheet.formula.error.v;}frequency=parseInt(frequency);//日计数基准类型
  var basis=0;if(arguments.length==4){basis=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(frequency!=1&&frequency!=2&&frequency!=4){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}//计算
  var interest;//结算日之后的下一个付息日
  var maxCount=Math.ceil(moment(maturity).diff(moment(settlement),'months')/(12/frequency))+1;for(var i=1;i<=maxCount;i++){var di=moment(maturity).subtract(12/frequency*i,'months');if(di<=moment(settlement)){interest=moment(maturity).subtract(12/frequency*(i-1),'months');break;}}return moment(interest).format("YYYY-MM-DD");}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COUPPCD":function COUPPCD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//年付息次数
  var frequency=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(frequency)){return frequency;}if(!luckysheet.func_methods.isRealNum(frequency)){return luckysheet.formula.error.v;}frequency=parseInt(frequency);//日计数基准类型
  var basis=0;if(arguments.length==4){basis=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(frequency!=1&&frequency!=2&&frequency!=4){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}//计算
  var interest;//结算日之前的上一个付息日
  var maxCount=Math.ceil(moment(maturity).diff(moment(settlement),'months')/(12/frequency))+1;for(var i=1;i<=maxCount;i++){var di=moment(maturity).subtract(12/frequency*i,'months');if(di<=moment(settlement)){interest=di;break;}}return moment(interest).format("YYYY-MM-DD");}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FV":function FV(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//利率
  var rate=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//总付款期数
  var nper=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(nper)){return nper;}if(!luckysheet.func_methods.isRealNum(nper)){return luckysheet.formula.error.v;}nper=parseFloat(nper);//每期的付款金额
  var pmt=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(pmt)){return pmt;}if(!luckysheet.func_methods.isRealNum(pmt)){return luckysheet.formula.error.v;}pmt=parseFloat(pmt);//现值，或一系列未来付款的当前值的累积和
  var pv=0;if(arguments.length>=4){pv=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(pv)){return pv;}if(!luckysheet.func_methods.isRealNum(pv)){return luckysheet.formula.error.v;}pv=parseFloat(pv);}//指定各期的付款时间是在期初还是期末
  var type=0;if(arguments.length>=5){type=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(type)){return type;}if(!luckysheet.func_methods.isRealNum(type)){return luckysheet.formula.error.v;}type=parseFloat(type);}if(type!=0&&type!=1){return luckysheet.formula.error.nm;}//计算
  var result;if(rate===0){result=pv+pmt*nper;}else {var term=Math.pow(1+rate,nper);if(type===1){result=pv*term+pmt*(1+rate)*(term-1)/rate;}else {result=pv*term+pmt*(term-1)/rate;}}return -result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FVSCHEDULE":function FVSCHEDULE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//现值
  var principal=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(principal)){return principal;}if(!luckysheet.func_methods.isRealNum(principal)){return luckysheet.formula.error.v;}principal=parseFloat(principal);//一组利率
  var data_schedule=arguments[1];var schedule=[];if(luckysheet.getObjType(data_schedule)=="array"){if(luckysheet.getObjType(data_schedule[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_schedule)){return luckysheet.formula.error.v;}schedule=schedule.concat(luckysheet.func_methods.getDataArr(data_schedule,false));}else if(luckysheet.getObjType(data_schedule)=="object"&&data_schedule.startCell!=null){schedule=schedule.concat(luckysheet.func_methods.getCellDataArr(data_schedule,"number",false));}else {schedule.push(data_schedule);}var schedule_n=[];for(var i=0;i<schedule.length;i++){var number=schedule[i];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}schedule_n.push(parseFloat(number));}//计算
  var n=schedule_n.length;var future=principal;for(var i=0;i<n;i++){future*=1+schedule_n[i];}return future;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"YIELD":function YIELD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//有价证券的年息票利率
  var rate=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//有价证券的价格
  var pr=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(pr)){return pr;}if(!luckysheet.func_methods.isRealNum(pr)){return luckysheet.formula.error.v;}pr=parseFloat(pr);//有价证券的清偿价值
  var redemption=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(redemption)){return redemption;}if(!luckysheet.func_methods.isRealNum(redemption)){return luckysheet.formula.error.v;}redemption=parseFloat(redemption);//年付息次数
  var frequency=luckysheet.func_methods.getFirstValue(arguments[5]);if(luckysheet.func_methods.valueIsError(frequency)){return frequency;}if(!luckysheet.func_methods.isRealNum(frequency)){return luckysheet.formula.error.v;}frequency=parseInt(frequency);//日计数基准类型
  var basis=0;if(arguments.length==7){basis=luckysheet.func_methods.getFirstValue(arguments[6]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(rate<0){return luckysheet.formula.error.nm;}if(pr<=0||redemption<=0){return luckysheet.formula.error.nm;}if(frequency!=1&&frequency!=2&&frequency!=4){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}//计算
  var num=window.luckysheet_function.COUPNUM.f(settlement,maturity,frequency,basis);if(num>1){var a=1;var b=0;var yld=a;for(var i=1;i<=100;i++){var price=window.luckysheet_function.PRICE.f(settlement,maturity,rate,yld,redemption,frequency,basis);if(Math.abs(price-pr)<0.000001){break;}if(price>pr){b=yld;}else {a=yld;}yld=(a+b)/2;}var result=yld;}else {var DSR=window.luckysheet_function.COUPDAYSNC.f(settlement,maturity,frequency,basis);var E=window.luckysheet_function.COUPDAYS.f(settlement,maturity,frequency,basis);var A=window.luckysheet_function.COUPDAYBS.f(settlement,maturity,frequency,basis);var T1=redemption/100+rate/frequency;var T2=pr/100+A/E*(rate/frequency);var T3=frequency*E/DSR;var result=(T1-T2)/T2*T3;}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"YIELDDISC":function YIELDDISC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//有价证券的价格
  var pr=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(pr)){return pr;}if(!luckysheet.func_methods.isRealNum(pr)){return luckysheet.formula.error.v;}pr=parseFloat(pr);//有价证券的清偿价值
  var redemption=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(redemption)){return redemption;}if(!luckysheet.func_methods.isRealNum(redemption)){return luckysheet.formula.error.v;}redemption=parseFloat(redemption);//日计数基准类型
  var basis=0;if(arguments.length==5){basis=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(pr<=0||redemption<=0){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}var yearfrac=window.luckysheet_function.YEARFRAC.f(settlement,maturity,basis);return (redemption/pr-1)/yearfrac;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NOMINAL":function NOMINAL(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//每年的实际利率
  var effect_rate=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(effect_rate)){return effect_rate;}if(!luckysheet.func_methods.isRealNum(effect_rate)){return luckysheet.formula.error.v;}effect_rate=parseFloat(effect_rate);//每年的复利期数
  var npery=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(npery)){return npery;}if(!luckysheet.func_methods.isRealNum(npery)){return luckysheet.formula.error.v;}npery=parseInt(npery);if(effect_rate<=0||npery<1){return luckysheet.formula.error.nm;}return (Math.pow(effect_rate+1,1/npery)-1)*npery;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"XIRR":function XIRR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//投资相关收益或支出的数组或范围
  var data_values=arguments[0];var values=[];if(luckysheet.getObjType(data_values)=="array"){if(luckysheet.getObjType(data_values[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_values)){return luckysheet.formula.error.v;}values=values.concat(luckysheet.func_methods.getDataArr(data_values,false));}else if(luckysheet.getObjType(data_values)=="object"&&data_values.startCell!=null){values=values.concat(luckysheet.func_methods.getCellDataArr(data_values,"number",false));}else {values.push(data_values);}var values_n=[];for(var i=0;i<values.length;i++){var number=values[i];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}values_n.push(parseFloat(number));}//与现金流数额参数中的现金流对应的日期数组或范围
  var dates=luckysheet.func_methods.getCellrangeDate(arguments[1]);if(luckysheet.func_methods.valueIsError(dates)){return dates;}for(var i=0;i<dates.length;i++){if(!moment(dates[i]).isValid()){return luckysheet.formula.error.v;}}//对内部回报率的估算值
  var guess=0.1;if(arguments.length==3){guess=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(guess)){return guess;}if(!luckysheet.func_methods.isRealNum(guess)){return luckysheet.formula.error.v;}guess=parseFloat(guess);}var positive=false;var negative=false;for(var i=0;i<values_n.length;i++){if(values_n[i]>0){positive=true;}if(values_n[i]<0){negative=true;}if(positive&&negative){break;}}if(!positive||!negative){return luckysheet.formula.error.nm;}if(values_n.length!=dates.length){return luckysheet.formula.error.nm;}//计算
  var irrResult=function irrResult(values,dates,rate){var r=rate+1;var result=values[0];for(var i=1;i<values.length;i++){result+=values[i]/Math.pow(r,window.luckysheet_function.DAYS.f(dates[i],dates[0])/365);}return result;};var irrResultDeriv=function irrResultDeriv(values,dates,rate){var r=rate+1;var result=0;for(var i=1;i<values.length;i++){var frac=window.luckysheet_function.DAYS.f(dates[i],dates[0])/365;result-=frac*values[i]/Math.pow(r,frac+1);}return result;};var resultRate=guess;var epsMax=1e-10;var newRate,epsRate,resultValue;var contLoop=true;do{resultValue=irrResult(values_n,dates,resultRate);newRate=resultRate-resultValue/irrResultDeriv(values_n,dates,resultRate);epsRate=Math.abs(newRate-resultRate);resultRate=newRate;contLoop=epsRate>epsMax&&Math.abs(resultValue)>epsMax;}while(contLoop);return resultRate;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MIRR":function MIRR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//投资相关收益或支出的数组或范围
  var data_values=arguments[0];var values=[];if(luckysheet.getObjType(data_values)=="array"){if(luckysheet.getObjType(data_values[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_values)){return luckysheet.formula.error.v;}values=values.concat(luckysheet.func_methods.getDataArr(data_values,false));}else if(luckysheet.getObjType(data_values)=="object"&&data_values.startCell!=null){values=values.concat(luckysheet.func_methods.getCellDataArr(data_values,"number",false));}else {values.push(data_values);}var values_n=[];for(var i=0;i<values.length;i++){var number=values[i];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}values_n.push(parseFloat(number));}//现金流中使用的资金支付的利率
  var finance_rate=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(finance_rate)){return finance_rate;}if(!luckysheet.func_methods.isRealNum(finance_rate)){return luckysheet.formula.error.v;}finance_rate=parseFloat(finance_rate);//将现金流再投资的收益率
  var reinvest_rate=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(reinvest_rate)){return reinvest_rate;}if(!luckysheet.func_methods.isRealNum(reinvest_rate)){return luckysheet.formula.error.v;}reinvest_rate=parseFloat(reinvest_rate);//计算
  var n=values_n.length;var payments=[];var incomes=[];for(var i=0;i<n;i++){if(values_n[i]<0){payments.push(values_n[i]);}else {incomes.push(values_n[i]);}}if(payments.length==0||incomes.length==0){return luckysheet.formula.error.d;}var num=-window.luckysheet_function.NPV.f(reinvest_rate,incomes)*Math.pow(1+reinvest_rate,n-1);var den=window.luckysheet_function.NPV.f(finance_rate,payments)*(1+finance_rate);return Math.pow(num/den,1/(n-1))-1;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"IRR":function IRR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//投资相关收益或支出的数组或范围
  var data_values=arguments[0];var values=[];if(luckysheet.getObjType(data_values)=="array"){if(luckysheet.getObjType(data_values[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_values)){return luckysheet.formula.error.v;}values=values.concat(luckysheet.func_methods.getDataArr(data_values,false));}else if(luckysheet.getObjType(data_values)=="object"&&data_values.startCell!=null){values=values.concat(luckysheet.func_methods.getCellDataArr(data_values,"number",false));}else {values.push(data_values);}var values_n=[];for(var i=0;i<values.length;i++){var number=values[i];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}values_n.push(parseFloat(number));}//对内部回报率的估算值
  var guess=0.1;if(arguments.length==2){guess=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(guess)){return guess;}if(!luckysheet.func_methods.isRealNum(guess)){return luckysheet.formula.error.v;}guess=parseFloat(guess);}var dates=[];var positive=false;var negative=false;for(var i=0;i<values.length;i++){dates[i]=i===0?0:dates[i-1]+365;if(values[i]>0){positive=true;}if(values[i]<0){negative=true;}}if(!positive||!negative){return luckysheet.formula.error.nm;}//计算
  var irrResult=function irrResult(values,dates,rate){var r=rate+1;var result=values[0];for(var i=1;i<values.length;i++){// result += values[i] / Math.pow(r, window.luckysheet_function.DAYS.f(dates[i], dates[0]) / 365);
  result+=values[i]/Math.pow(r,(dates[i]-dates[0])/365);}return result;};var irrResultDeriv=function irrResultDeriv(values,dates,rate){var r=rate+1;var result=0;for(var i=1;i<values.length;i++){// var frac = window.luckysheet_function.DAYS.f(dates[i], dates[0]) / 365;
  var frac=(dates[i]-dates[0])/365;result-=frac*values[i]/Math.pow(r,frac+1);}return result;};var resultRate=guess;var epsMax=1e-10;var newRate,epsRate,resultValue;var contLoop=true;do{resultValue=irrResult(values_n,dates,resultRate);newRate=resultRate-resultValue/irrResultDeriv(values_n,dates,resultRate);epsRate=Math.abs(newRate-resultRate);resultRate=newRate;contLoop=epsRate>epsMax&&Math.abs(resultValue)>epsMax;}while(contLoop);return resultRate;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NPV":function NPV(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//某一期间的贴现率
  var rate=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//支出（负值）和收益（正值）
  var values=[];for(var i=1;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}values=values.concat(luckysheet.func_methods.getDataArr(data,true));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){values=values.concat(luckysheet.func_methods.getCellDataArr(data,"number",true));}else {values.push(data);}}var values_n=[];for(var i=0;i<values.length;i++){var number=values[i];if(luckysheet.func_methods.isRealNum(number)){values_n.push(parseFloat(number));}}//计算
  var result=0;if(values_n.length>0){for(var i=0;i<values_n.length;i++){result+=values_n[i]/Math.pow(1+rate,i+1);}}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"XNPV":function XNPV(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//应用于现金流的贴现率
  var rate=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//与 dates 中的支付时间相对应的一系列现金流
  var data_values=arguments[1];var values=[];if(luckysheet.getObjType(data_values)=="array"){if(luckysheet.getObjType(data_values[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_values)){return luckysheet.formula.error.v;}values=values.concat(luckysheet.func_methods.getDataArr(data_values,false));}else if(luckysheet.getObjType(data_values)=="object"&&data_values.startCell!=null){values=values.concat(luckysheet.func_methods.getCellDataArr(data_values,"number",false));}else {values.push(data_values);}var values_n=[];for(var i=0;i<values.length;i++){var number=values[i];if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}values_n.push(parseFloat(number));}//与现金流支付相对应的支付日期表
  var dates=luckysheet.func_methods.getCellrangeDate(arguments[2]);if(luckysheet.func_methods.valueIsError(dates)){return dates;}for(var i=0;i<dates.length;i++){if(!moment(dates[i]).isValid()){return luckysheet.formula.error.v;}}if(values_n.length!=dates.length){return luckysheet.formula.error.nm;}//计算
  var result=0;for(var i=0;i<values_n.length;i++){result+=values_n[i]/Math.pow(1+rate,window.luckysheet_function.DAYS.f(dates[i],dates[0])/365);}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CUMIPMT":function CUMIPMT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//利率
  var rate=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//总付款期数
  var nper=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(nper)){return nper;}if(!luckysheet.func_methods.isRealNum(nper)){return luckysheet.formula.error.v;}nper=parseFloat(nper);//年金的现值
  var pv=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(pv)){return pv;}if(!luckysheet.func_methods.isRealNum(pv)){return luckysheet.formula.error.v;}pv=parseFloat(pv);//首期
  var start_period=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(start_period)){return start_period;}if(!luckysheet.func_methods.isRealNum(start_period)){return luckysheet.formula.error.v;}start_period=parseInt(start_period);//末期
  var end_period=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(end_period)){return end_period;}if(!luckysheet.func_methods.isRealNum(end_period)){return luckysheet.formula.error.v;}end_period=parseInt(end_period);//指定各期的付款时间是在期初还是期末
  var type=luckysheet.func_methods.getFirstValue(arguments[5]);if(luckysheet.func_methods.valueIsError(type)){return type;}if(!luckysheet.func_methods.isRealNum(type)){return luckysheet.formula.error.v;}type=parseFloat(type);if(rate<=0||nper<=0||pv<=0){return luckysheet.formula.error.nm;}if(start_period<1||end_period<1||start_period>end_period){return luckysheet.formula.error.nm;}if(type!=0&&type!=1){return luckysheet.formula.error.nm;}//计算
  var payment=window.luckysheet_function.PMT.f(rate,nper,pv,0,type);var interest=0;if(start_period===1){if(type===0){interest=-pv;start_period++;}}for(var i=start_period;i<=end_period;i++){if(type===1){interest+=window.luckysheet_function.FV.f(rate,i-2,payment,pv,1)-payment;}else {interest+=window.luckysheet_function.FV.f(rate,i-1,payment,pv,0);}}interest*=rate;return interest;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PMT":function PMT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//贷款利率
  var rate=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//该项贷款的付款总数
  var nper=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(nper)){return nper;}if(!luckysheet.func_methods.isRealNum(nper)){return luckysheet.formula.error.v;}nper=parseFloat(nper);//现值
  var pv=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(pv)){return pv;}if(!luckysheet.func_methods.isRealNum(pv)){return luckysheet.formula.error.v;}pv=parseFloat(pv);//最后一次付款后希望得到的现金余额
  var fv=0;if(arguments.length>=4){fv=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(fv)){return fv;}if(!luckysheet.func_methods.isRealNum(fv)){return luckysheet.formula.error.v;}fv=parseFloat(fv);}//指定各期的付款时间是在期初还是期末
  var type=0;if(arguments.length==5){type=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(type)){return type;}if(!luckysheet.func_methods.isRealNum(type)){return luckysheet.formula.error.v;}type=parseFloat(type);}if(type!=0&&type!=1){return luckysheet.formula.error.nm;}//计算
  var result;if(rate===0){result=(pv+fv)/nper;}else {var term=Math.pow(1+rate,nper);if(type===1){result=(fv*rate/(term-1)+pv*rate/(1-1/term))/(1+rate);}else {result=fv*rate/(term-1)+pv*rate/(1-1/term);}}return -result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"IPMT":function IPMT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//利率
  var rate=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//用于计算其利息数额的期数
  var per=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(per)){return per;}if(!luckysheet.func_methods.isRealNum(per)){return luckysheet.formula.error.v;}per=parseFloat(per);//总付款期数
  var nper=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(nper)){return nper;}if(!luckysheet.func_methods.isRealNum(nper)){return luckysheet.formula.error.v;}nper=parseFloat(nper);//现值
  var pv=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(pv)){return pv;}if(!luckysheet.func_methods.isRealNum(pv)){return luckysheet.formula.error.v;}pv=parseFloat(pv);//最后一次付款后希望得到的现金余额
  var fv=0;if(arguments.length>=5){fv=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(fv)){return fv;}if(!luckysheet.func_methods.isRealNum(fv)){return luckysheet.formula.error.v;}fv=parseFloat(fv);}//指定各期的付款时间是在期初还是期末
  var type=0;if(arguments.length>=6){type=luckysheet.func_methods.getFirstValue(arguments[5]);if(luckysheet.func_methods.valueIsError(type)){return type;}if(!luckysheet.func_methods.isRealNum(type)){return luckysheet.formula.error.v;}type=parseFloat(type);}if(per<1||per>nper){return luckysheet.formula.error.nm;}if(type!=0&&type!=1){return luckysheet.formula.error.nm;}//计算
  var payment=window.luckysheet_function.PMT.f(rate,nper,pv,fv,type);var interest;if(per===1){if(type===1){interest=0;}else {interest=-pv;}}else {if(type===1){interest=window.luckysheet_function.FV.f(rate,per-2,payment,pv,1)-payment;}else {interest=window.luckysheet_function.FV.f(rate,per-1,payment,pv,0);}}var result=interest*rate;return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PPMT":function PPMT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//利率
  var rate=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//用于计算其利息数额的期数
  var per=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(per)){return per;}if(!luckysheet.func_methods.isRealNum(per)){return luckysheet.formula.error.v;}per=parseFloat(per);//总付款期数
  var nper=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(nper)){return nper;}if(!luckysheet.func_methods.isRealNum(nper)){return luckysheet.formula.error.v;}nper=parseFloat(nper);//现值
  var pv=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(pv)){return pv;}if(!luckysheet.func_methods.isRealNum(pv)){return luckysheet.formula.error.v;}pv=parseFloat(pv);//最后一次付款后希望得到的现金余额
  var fv=0;if(arguments.length>=5){fv=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(fv)){return fv;}if(!luckysheet.func_methods.isRealNum(fv)){return luckysheet.formula.error.v;}fv=parseFloat(fv);}//指定各期的付款时间是在期初还是期末
  var type=0;if(arguments.length>=6){type=luckysheet.func_methods.getFirstValue(arguments[5]);if(luckysheet.func_methods.valueIsError(type)){return type;}if(!luckysheet.func_methods.isRealNum(type)){return luckysheet.formula.error.v;}type=parseFloat(type);}if(per<1||per>nper){return luckysheet.formula.error.nm;}if(type!=0&&type!=1){return luckysheet.formula.error.nm;}//计算
  var payment=window.luckysheet_function.PMT.f(rate,nper,pv,fv,type);var payment2=window.luckysheet_function.IPMT.f(rate,per,nper,pv,fv,type);return payment-payment2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"INTRATE":function INTRATE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//有价证券的投资额
  var investment=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(investment)){return investment;}if(!luckysheet.func_methods.isRealNum(investment)){return luckysheet.formula.error.v;}investment=parseFloat(investment);//有价证券到期时的兑换值
  var redemption=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(redemption)){return redemption;}if(!luckysheet.func_methods.isRealNum(redemption)){return luckysheet.formula.error.v;}redemption=parseFloat(redemption);//日计数基准类型
  var basis=0;if(arguments.length==5){basis=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(investment<=0||redemption<=0){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}//计算
  var sd=moment(settlement).date();var sm=moment(settlement).month()+1;var sy=moment(settlement).year();var ed=moment(maturity).date();var em=moment(maturity).month()+1;var ey=moment(maturity).year();var result;switch(basis){case 0:// US (NASD) 30/360
  if(sd===31&&ed===31){sd=30;ed=30;}else if(sd===31){sd=30;}else if(sd===30&&ed===31){ed=30;}result=360/(ed+em*30+ey*360-(sd+sm*30+sy*360));break;case 1:// Actual/actual
  var ylength=365;if(sy===ey||sy+1===ey&&(sm>em||sm===em&&sd>=ed)){if(sy===ey&&luckysheet.func_methods.isLeapYear(sy)||luckysheet.func_methods.feb29Between(settlement,maturity)||em===1&&ed===29){ylength=366;}result=ylength/moment(maturity).diff(moment(settlement),'days');result=(redemption-investment)/investment*result;return result;}var years=ey-sy+1;var days=(moment().set({'year':ey+1,'month':0,'date':1})-moment().set({'year':sy,'month':0,'date':1}))/1000/60/60/24;var average=days/years;result=average/moment(maturity).diff(moment(settlement),'days');break;case 2:// Actual/360
  result=360/moment(maturity).diff(moment(settlement),'days');break;case 3:// Actual/365
  result=365/moment(maturity).diff(moment(settlement),'days');break;case 4:// European 30/360
  result=360/(ed+em*30+ey*360-(sd+sm*30+sy*360));break;}result=(redemption-investment)/investment*result;return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PRICE":function PRICE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//有价证券的年息票利率
  var rate=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//有价证券的年收益率
  var yld=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(yld)){return yld;}if(!luckysheet.func_methods.isRealNum(yld)){return luckysheet.formula.error.v;}yld=parseFloat(yld);//有价证券的清偿价值
  var redemption=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(redemption)){return redemption;}if(!luckysheet.func_methods.isRealNum(redemption)){return luckysheet.formula.error.v;}redemption=parseFloat(redemption);//年付息次数
  var frequency=luckysheet.func_methods.getFirstValue(arguments[5]);if(luckysheet.func_methods.valueIsError(frequency)){return frequency;}if(!luckysheet.func_methods.isRealNum(frequency)){return luckysheet.formula.error.v;}frequency=parseInt(frequency);//日计数基准类型
  var basis=0;if(arguments.length==7){basis=luckysheet.func_methods.getFirstValue(arguments[6]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(rate<0||yld<0){return luckysheet.formula.error.nm;}if(redemption<=0){return luckysheet.formula.error.nm;}if(frequency!=1&&frequency!=2&&frequency!=4){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}//计算
  var DSC=window.luckysheet_function.COUPDAYSNC.f(settlement,maturity,frequency,basis);var E=window.luckysheet_function.COUPDAYS.f(settlement,maturity,frequency,basis);var A=window.luckysheet_function.COUPDAYBS.f(settlement,maturity,frequency,basis);var num=window.luckysheet_function.COUPNUM.f(settlement,maturity,frequency,basis);if(num>1){var T1=redemption/Math.pow(1+yld/frequency,num-1+DSC/E);var T2=0;for(var i=1;i<=num;i++){T2+=100*rate/frequency/Math.pow(1+yld/frequency,i-1+DSC/E);}var T3=100*(rate/frequency)*(A/E);var result=T1+T2-T3;}else {var DSR=E-A;var T1=100*(rate/frequency)+redemption;var T2=yld/frequency*(DSR/E)+1;var T3=100*(rate/frequency)*(A/E);var result=T1/T2-T3;}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PRICEDISC":function PRICEDISC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//有价证券的贴现率
  var discount=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(discount)){return discount;}if(!luckysheet.func_methods.isRealNum(discount)){return luckysheet.formula.error.v;}discount=parseFloat(discount);//有价证券的清偿价值
  var redemption=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(redemption)){return redemption;}if(!luckysheet.func_methods.isRealNum(redemption)){return luckysheet.formula.error.v;}redemption=parseFloat(redemption);//日计数基准类型
  var basis=0;if(arguments.length==5){basis=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(discount<=0||redemption<=0){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}//计算
  var sd=moment(settlement).date();var sm=moment(settlement).month()+1;var sy=moment(settlement).year();var ed=moment(maturity).date();var em=moment(maturity).month()+1;var ey=moment(maturity).year();var result;switch(basis){case 0:// US (NASD) 30/360
  if(sd===31&&ed===31){sd=30;ed=30;}else if(sd===31){sd=30;}else if(sd===30&&ed===31){ed=30;}result=(ed+em*30+ey*360-(sd+sm*30+sy*360))/360;break;case 1:// Actual/actual
  var ylength=365;if(sy===ey||sy+1===ey&&(sm>em||sm===em&&sd>=ed)){if(sy===ey&&luckysheet.func_methods.isLeapYear(sy)||luckysheet.func_methods.feb29Between(settlement,maturity)||em===1&&ed===29){ylength=366;}result=moment(maturity).diff(moment(settlement),'days')/ylength;result=redemption-discount*redemption*result;return result;}var years=ey-sy+1;var days=(moment().set({'year':ey+1,'month':0,'date':1})-moment().set({'year':sy,'month':0,'date':1}))/1000/60/60/24;var average=days/years;result=moment(maturity).diff(moment(settlement),'days')/average;break;case 2:// Actual/360
  result=moment(maturity).diff(moment(settlement),'days')/360;break;case 3:// Actual/365
  result=moment(maturity).diff(moment(settlement),'days')/365;break;case 4:// European 30/360
  result=(ed+em*30+ey*360-(sd+sm*30+sy*360))/360;break;}result=redemption-discount*redemption*result;return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PRICEMAT":function PRICEMAT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//发行日
  var issue=luckysheet.func_methods.getCellDate(arguments[2]);if(luckysheet.func_methods.valueIsError(issue)){return issue;}if(!moment(issue).isValid()){return luckysheet.formula.error.v;}//有价证券在发行日的利率
  var rate=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//有价证券的年收益率
  var yld=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(yld)){return yld;}if(!luckysheet.func_methods.isRealNum(yld)){return luckysheet.formula.error.v;}yld=parseFloat(yld);//日计数基准类型
  var basis=0;if(arguments.length==6){basis=luckysheet.func_methods.getFirstValue(arguments[5]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(rate<0||yld<0){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}//计算
  var sd=moment(settlement).date();var sm=moment(settlement).month()+1;var sy=moment(settlement).year();var ed=moment(maturity).date();var em=moment(maturity).month()+1;var ey=moment(maturity).year();var td=moment(issue).date();var tm=moment(issue).month()+1;var ty=moment(issue).year();var result;switch(basis){case 0:// US (NASD) 30/360
  if(sd==31){sd=30;}if(ed==31){ed=30;}if(td==31){td=30;}var B=360;var DSM=ed+em*30+ey*360-(sd+sm*30+sy*360);var DIM=ed+em*30+ey*360-(td+tm*30+ty*360);var A=sd+sm*30+sy*360-(td+tm*30+ty*360);break;case 1:// Actual/actual
  var ylength=365;if(sy===ey||sy+1===ey&&(sm>em||sm===em&&sd>=ed)){if(sy===ey&&luckysheet.func_methods.isLeapYear(sy)||luckysheet.func_methods.feb29Between(settlement,maturity)||em===1&&ed===29){ylength=366;}var B=ylength;var DSM=moment(maturity).diff(moment(settlement),'days');var DIM=moment(settlement).diff(moment(issue),'days');var A=moment(maturity).diff(moment(issue),'days');result=(100+DIM/B*rate*100)/(1+DSM/B*yld)-A/B*rate*100;return result;}var years=ey-sy+1;var days=(moment().set({'year':ey+1,'month':0,'date':1})-moment().set({'year':sy,'month':0,'date':1}))/1000/60/60/24;var average=days/years;var B=average;var DSM=moment(maturity).diff(moment(settlement),'days');var DIM=moment(settlement).diff(moment(issue),'days');var A=moment(maturity).diff(moment(issue),'days');break;case 2:// Actual/360
  var B=360;var DSM=moment(maturity).diff(moment(settlement),'days');var DIM=moment(settlement).diff(moment(issue),'days');var A=moment(maturity).diff(moment(issue),'days');break;case 3:// Actual/365
  var B=365;var DSM=moment(maturity).diff(moment(settlement),'days');var DIM=moment(settlement).diff(moment(issue),'days');var A=moment(maturity).diff(moment(issue),'days');break;case 4:// European 30/360
  var B=360;var DSM=ed+em*30+ey*360-(sd+sm*30+sy*360);var DIM=ed+em*30+ey*360-(td+tm*30+ty*360);var A=sd+sm*30+sy*360-(td+tm*30+ty*360);break;}result=(100+DIM/B*rate*100)/(1+DSM/B*yld)-A/B*rate*100;return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"RECEIVED":function RECEIVED(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//有价证券的投资额
  var investment=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(investment)){return investment;}if(!luckysheet.func_methods.isRealNum(investment)){return luckysheet.formula.error.v;}investment=parseFloat(investment);//有价证券的贴现率
  var discount=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(discount)){return discount;}if(!luckysheet.func_methods.isRealNum(discount)){return luckysheet.formula.error.v;}discount=parseFloat(discount);//日计数基准类型
  var basis=0;if(arguments.length==5){basis=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseFloat(basis);}if(investment<=0||discount<=0){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}//计算
  var sd=moment(settlement).date();var sm=moment(settlement).month()+1;var sy=moment(settlement).year();var ed=moment(maturity).date();var em=moment(maturity).month()+1;var ey=moment(maturity).year();var result;switch(basis){case 0:// US (NASD) 30/360
  if(sd==31){sd=30;}if(ed==31){ed=30;}var B=360;var DIM=ed+em*30+ey*360-(sd+sm*30+sy*360);break;case 1:// Actual/actual
  var ylength=365;if(sy===ey||sy+1===ey&&(sm>em||sm===em&&sd>=ed)){if(sy===ey&&luckysheet.func_methods.isLeapYear(sy)||luckysheet.func_methods.feb29Between(settlement,maturity)||em===1&&ed===29){ylength=366;}var B=ylength;var DIM=moment(maturity).diff(moment(settlement),'days');result=investment/(1-discount*DIM/B);return result;}var years=ey-sy+1;var days=(moment().set({'year':ey+1,'month':0,'date':1})-moment().set({'year':sy,'month':0,'date':1}))/1000/60/60/24;var average=days/years;var B=average;var DIM=moment(maturity).diff(moment(settlement),'days');break;case 2:// Actual/360
  var B=360;var DIM=moment(maturity).diff(moment(settlement),'days');break;case 3:// Actual/365
  var B=365;var DIM=moment(maturity).diff(moment(settlement),'days');break;case 4:// European 30/360
  var B=360;var DIM=ed+em*30+ey*360-(sd+sm*30+sy*360);break;}result=investment/(1-discount*DIM/B);return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DISC":function DISC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//有价证券的价格
  var pr=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(pr)){return pr;}if(!luckysheet.func_methods.isRealNum(pr)){return luckysheet.formula.error.v;}pr=parseFloat(pr);//有价证券的清偿价值
  var redemption=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(redemption)){return redemption;}if(!luckysheet.func_methods.isRealNum(redemption)){return luckysheet.formula.error.v;}redemption=parseFloat(redemption);//日计数基准类型
  var basis=0;if(arguments.length==5){basis=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseFloat(basis);}if(pr<=0||redemption<=0){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}//计算
  var sd=moment(settlement).date();var sm=moment(settlement).month()+1;var sy=moment(settlement).year();var ed=moment(maturity).date();var em=moment(maturity).month()+1;var ey=moment(maturity).year();var result;switch(basis){case 0:// US (NASD) 30/360
  if(sd==31){sd=30;}if(ed==31){ed=30;}var B=360;var DSM=ed+em*30+ey*360-(sd+sm*30+sy*360);break;case 1:// Actual/actual
  var ylength=365;if(sy===ey||sy+1===ey&&(sm>em||sm===em&&sd>=ed)){if(sy===ey&&luckysheet.func_methods.isLeapYear(sy)||luckysheet.func_methods.feb29Between(settlement,maturity)||em===1&&ed===29){ylength=366;}var B=ylength;var DSM=moment(maturity).diff(moment(settlement),'days');result=(redemption-pr)/redemption*(B/DSM);return result;}var years=ey-sy+1;var days=(moment().set({'year':ey+1,'month':0,'date':1})-moment().set({'year':sy,'month':0,"date":1}))/1000/60/60/24;var average=days/years;var B=average;var DSM=moment(maturity).diff(moment(settlement),'days');break;case 2:// Actual/360
  var B=360;var DSM=moment(maturity).diff(moment(settlement),'days');break;case 3:// Actual/365
  var B=365;var DSM=moment(maturity).diff(moment(settlement),'days');break;case 4:// European 30/360
  var B=360;var DSM=ed+em*30+ey*360-(sd+sm*30+sy*360);break;}result=(redemption-pr)/redemption*(B/DSM);return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NPER":function NPER(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//利率
  var rate=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(rate)){return rate;}if(!luckysheet.func_methods.isRealNum(rate)){return luckysheet.formula.error.v;}rate=parseFloat(rate);//各期所应支付的金额
  var pmt=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(pmt)){return pmt;}if(!luckysheet.func_methods.isRealNum(pmt)){return luckysheet.formula.error.v;}pmt=parseFloat(pmt);//现值
  var pv=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(pv)){return pv;}if(!luckysheet.func_methods.isRealNum(pv)){return luckysheet.formula.error.v;}pv=parseFloat(pv);//最后一次付款后希望得到的现金余额
  var fv=0;if(arguments.length>=4){fv=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(fv)){return fv;}if(!luckysheet.func_methods.isRealNum(fv)){return luckysheet.formula.error.v;}fv=parseFloat(fv);}//指定各期的付款时间是在期初还是期末
  var type=0;if(arguments.length>=5){type=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(type)){return type;}if(!luckysheet.func_methods.isRealNum(type)){return luckysheet.formula.error.v;}type=parseFloat(type);}if(type!=0&&type!=1){return luckysheet.formula.error.nm;}//计算
  var num=pmt*(1+rate*type)-fv*rate;var den=pv*rate+pmt*(1+rate*type);return Math.log(num/den)/Math.log(1+rate);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SLN":function SLN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//资产原值
  var cost=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(cost)){return cost;}if(!luckysheet.func_methods.isRealNum(cost)){return luckysheet.formula.error.v;}cost=parseFloat(cost);//资产残值
  var salvage=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(salvage)){return salvage;}if(!luckysheet.func_methods.isRealNum(salvage)){return luckysheet.formula.error.v;}salvage=parseFloat(salvage);//资产的折旧期数
  var life=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(life)){return life;}if(!luckysheet.func_methods.isRealNum(life)){return luckysheet.formula.error.v;}life=parseFloat(life);if(life==0){return luckysheet.formula.error.d;}return (cost-salvage)/life;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DURATION":function DURATION(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//有价证券的年息票利率
  var coupon=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(coupon)){return coupon;}if(!luckysheet.func_methods.isRealNum(coupon)){return luckysheet.formula.error.v;}coupon=parseFloat(coupon);//有价证券的年收益率
  var yld=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(yld)){return yld;}if(!luckysheet.func_methods.isRealNum(yld)){return luckysheet.formula.error.v;}yld=parseFloat(yld);//年付息次数
  var frequency=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(frequency)){return frequency;}if(!luckysheet.func_methods.isRealNum(frequency)){return luckysheet.formula.error.v;}frequency=parseInt(frequency);//日计数基准类型
  var basis=0;if(arguments.length==6){basis=luckysheet.func_methods.getFirstValue(arguments[5]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(coupon<0||yld<0){return luckysheet.formula.error.nm;}if(frequency!=1&&frequency!=2&&frequency!=4){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}var nper=window.luckysheet_function.COUPNUM.f(settlement,maturity,frequency,basis);var sum1=0;var sum2=0;for(var i=1;i<=nper;i++){sum1+=100*(coupon/frequency)*i/Math.pow(1+yld/frequency,i);sum2+=100*(coupon/frequency)/Math.pow(1+yld/frequency,i);}var result=(sum1+100*nper/Math.pow(1+yld/frequency,nper))/(sum2+100/Math.pow(1+yld/frequency,nper));result=result/frequency;return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MDURATION":function MDURATION(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//结算日
  var settlement=luckysheet.func_methods.getCellDate(arguments[0]);if(luckysheet.func_methods.valueIsError(settlement)){return settlement;}if(!moment(settlement).isValid()){return luckysheet.formula.error.v;}//到期日
  var maturity=luckysheet.func_methods.getCellDate(arguments[1]);if(luckysheet.func_methods.valueIsError(maturity)){return maturity;}if(!moment(maturity).isValid()){return luckysheet.formula.error.v;}//有价证券的年息票利率
  var coupon=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(coupon)){return coupon;}if(!luckysheet.func_methods.isRealNum(coupon)){return luckysheet.formula.error.v;}coupon=parseFloat(coupon);//有价证券的年收益率
  var yld=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(yld)){return yld;}if(!luckysheet.func_methods.isRealNum(yld)){return luckysheet.formula.error.v;}yld=parseFloat(yld);//年付息次数
  var frequency=luckysheet.func_methods.getFirstValue(arguments[4]);if(luckysheet.func_methods.valueIsError(frequency)){return frequency;}if(!luckysheet.func_methods.isRealNum(frequency)){return luckysheet.formula.error.v;}frequency=parseInt(frequency);//日计数基准类型
  var basis=0;if(arguments.length==6){basis=luckysheet.func_methods.getFirstValue(arguments[5]);if(luckysheet.func_methods.valueIsError(basis)){return basis;}if(!luckysheet.func_methods.isRealNum(basis)){return luckysheet.formula.error.v;}basis=parseInt(basis);}if(coupon<0||yld<0){return luckysheet.formula.error.nm;}if(frequency!=1&&frequency!=2&&frequency!=4){return luckysheet.formula.error.nm;}if(basis<0||basis>4){return luckysheet.formula.error.nm;}if(moment(settlement)-moment(maturity)>=0){return luckysheet.formula.error.nm;}var duration=window.luckysheet_function.DURATION.f(settlement,maturity,coupon,yld,frequency,basis);return duration/(1+yld/frequency);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"BIN2DEC":function BIN2DEC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//二进制数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!/^[01]{1,10}$/g.test(number)){return luckysheet.formula.error.nm;}//计算
  var result=parseInt(number,2);var stringified=number.toString();if(stringified.length===10&&stringified.substring(0,1)==='1'){return parseInt(stringified.substring(1),2)-512;}else {return result;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"BIN2HEX":function BIN2HEX(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//二进制数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}//有效位数
  var places=null;if(arguments.length==2){places=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(places)){return places;}if(!luckysheet.func_methods.isRealNum(places)){return luckysheet.formula.error.v;}places=parseInt(places);}if(!/^[01]{1,10}$/g.test(number)){return luckysheet.formula.error.nm;}//计算
  var result=parseInt(number,2).toString(16).toUpperCase();if(places==null){return result;}else {if(places<0||places<result.length){return luckysheet.formula.error.nm;}return new Array(places-result.length+1).join('0')+result;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"BIN2OCT":function BIN2OCT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//二进制数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}//有效位数
  var places=null;if(arguments.length==2){places=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(places)){return places;}if(!luckysheet.func_methods.isRealNum(places)){return luckysheet.formula.error.v;}places=parseInt(places);}if(!/^[01]{1,10}$/g.test(number)){return luckysheet.formula.error.nm;}//计算
  var stringified=number.toString();if(stringified.length===10&&stringified.substring(0,1)==='1'){return (1073741312+parseInt(stringified.substring(1),2)).toString(8);}var result=parseInt(number,2).toString(8);if(places==null){return result;}else {if(places<0||places<result.length){return luckysheet.formula.error.nm;}return new Array(places-result.length+1).join('0')+result;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DEC2BIN":function DEC2BIN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//十进制数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//有效位数
  var places=null;if(arguments.length==2){places=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(places)){return places;}if(!luckysheet.func_methods.isRealNum(places)){return luckysheet.formula.error.v;}places=parseInt(places);}if(!/^-?[0-9]{1,3}$/.test(number)||number<-512||number>511){return luckysheet.formula.error.nm;}//计算
  if(number<0){return '1'+new Array(9-(512+number).toString(2).length).join('0')+(512+number).toString(2);}var result=parseInt(number,10).toString(2);if(places==null){return result;}else {if(places<0||places<result.length){return luckysheet.formula.error.nm;}return new Array(places-result.length+1).join('0')+result;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DEC2HEX":function DEC2HEX(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//十进制数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//有效位数
  var places=null;if(arguments.length==2){places=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(places)){return places;}if(!luckysheet.func_methods.isRealNum(places)){return luckysheet.formula.error.v;}places=parseInt(places);}if(!/^-?[0-9]{1,12}$/.test(number)||number<-549755813888||number>549755813887){return luckysheet.formula.error.nm;}//计算
  if(number<0){return (1099511627776+number).toString(16).toUpperCase();}var result=parseInt(number,10).toString(16).toUpperCase();if(places==null){return result;}else {if(places<0||places<result.length){return luckysheet.formula.error.nm;}return new Array(places-result.length+1).join('0')+result;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DEC2OCT":function DEC2OCT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//十进制数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//有效位数
  var places=null;if(arguments.length==2){places=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(places)){return places;}if(!luckysheet.func_methods.isRealNum(places)){return luckysheet.formula.error.v;}places=parseInt(places);}if(!/^-?[0-9]{1,9}$/.test(number)||number<-536870912||number>536870911){return luckysheet.formula.error.nm;}//计算
  if(number<0){return (1073741824+number).toString(8);}var result=parseInt(number,10).toString(8);if(places==null){return result;}else {if(places<0||places<result.length){return luckysheet.formula.error.nm;}return new Array(places-result.length+1).join('0')+result;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"HEX2BIN":function HEX2BIN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//十六进制数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}//有效位数
  var places=null;if(arguments.length==2){places=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(places)){return places;}if(!luckysheet.func_methods.isRealNum(places)){return luckysheet.formula.error.v;}places=parseInt(places);}if(!/^[0-9A-Fa-f]{1,10}$/.test(number)){return luckysheet.formula.error.nm;}//计算
  var negative=number.length===10&&number.substring(0,1).toLowerCase()==='f'?true:false;var decimal=negative?parseInt(number,16)-1099511627776:parseInt(number,16);if(decimal<-512||decimal>511){return luckysheet.formula.error.nm;}if(negative){return '1'+new Array(9-(512+decimal).toString(2).length).join('0')+(512+decimal).toString(2);}var result=decimal.toString(2);if(places==null){return result;}else {if(places<0||places<result.length){return luckysheet.formula.error.nm;}return new Array(places-result.length+1).join('0')+result;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"HEX2DEC":function HEX2DEC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//十六进制数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!/^[0-9A-Fa-f]{1,10}$/.test(number)){return luckysheet.formula.error.nm;}//计算
  var decimal=parseInt(number,16);return decimal>=549755813888?decimal-1099511627776:decimal;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"HEX2OCT":function HEX2OCT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//十六进制数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}//有效位数
  var places=null;if(arguments.length==2){places=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(places)){return places;}if(!luckysheet.func_methods.isRealNum(places)){return luckysheet.formula.error.v;}places=parseInt(places);}if(!/^[0-9A-Fa-f]{1,10}$/.test(number)){return luckysheet.formula.error.nm;}//计算
  var decimal=parseInt(number,16);if(decimal>536870911&&decimal<1098974756864){return luckysheet.formula.error.nm;}if(decimal>=1098974756864){return (decimal-1098437885952).toString(8);}var result=decimal.toString(8);if(places==null){return result;}else {if(places<0||places<result.length){return luckysheet.formula.error.nm;}return new Array(places-result.length+1).join('0')+result;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"OCT2BIN":function OCT2BIN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//八进制数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}//有效位数
  var places=null;if(arguments.length==2){places=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(places)){return places;}if(!luckysheet.func_methods.isRealNum(places)){return luckysheet.formula.error.v;}places=parseInt(places);}if(!/^[0-7]{1,10}$/.test(number)){return luckysheet.formula.error.nm;}//计算
  number=number.toString();var negative=number.length===10&&number.substring(0,1)==='7'?true:false;var decimal=negative?parseInt(number,8)-1073741824:parseInt(number,8);if(decimal<-512||decimal>511){return error.num;}if(negative){return '1'+new Array(9-(512+decimal).toString(2).length).join('0')+(512+decimal).toString(2);}var result=decimal.toString(2);if(places==null){return result;}else {if(places<0||places<result.length){return luckysheet.formula.error.nm;}return new Array(places-result.length+1).join('0')+result;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"OCT2DEC":function OCT2DEC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//八进制数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!/^[0-7]{1,10}$/.test(number)){return luckysheet.formula.error.nm;}//计算
  var decimal=parseInt(number,8);return decimal>=536870912?decimal-1073741824:decimal;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"OCT2HEX":function OCT2HEX(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//八进制数
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}//有效位数
  var places=null;if(arguments.length==2){places=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(places)){return places;}if(!luckysheet.func_methods.isRealNum(places)){return luckysheet.formula.error.v;}places=parseInt(places);}if(!/^[0-7]{1,10}$/.test(number)){return luckysheet.formula.error.nm;}//计算
  var decimal=parseInt(number,8);if(decimal>=536870912){return 'FF'+(decimal+3221225472).toString(16).toUpperCase();}var result=decimal.toString(16).toUpperCase();if(places==null){return result;}else {if(places<0||places<result.length){return luckysheet.formula.error.nm;}return new Array(places-result.length+1).join('0')+result;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COMPLEX":function COMPLEX(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//复数的实系数
  var real_num=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(real_num)){return real_num;}if(!luckysheet.func_methods.isRealNum(real_num)){return luckysheet.formula.error.v;}real_num=parseFloat(real_num);//复数的虚系数
  var i_num=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(i_num)){return i_num;}if(!luckysheet.func_methods.isRealNum(i_num)){return luckysheet.formula.error.v;}i_num=parseFloat(i_num);//复数中虚系数的后缀
  var suffix="i";if(arguments.length==3){suffix=arguments[2].toString();}if(suffix!="i"&&suffix!="j"){return luckysheet.formula.error.v;}//计算
  if(real_num===0&&i_num===0){return 0;}else if(real_num===0){return i_num===1?suffix:i_num.toString()+suffix;}else if(i_num===0){return real_num.toString();}else {var sign=i_num>0?'+':'';return real_num.toString()+sign+(i_num===1?suffix:i_num.toString()+suffix);}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"IMREAL":function IMREAL(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//复数
  var inumber=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(inumber)){return inumber;}inumber=inumber.toString();if(inumber.toLowerCase()=="true"||inumber.toLowerCase()=="false"){return luckysheet.formula.error.v;}//计算
  if(inumber=="0"){return 0;}if(['i','+i','1i','+1i','-i','-1i','j','+j','1j','+1j','-j','-1j'].indexOf(inumber)>=0){return 0;}var plus=inumber.indexOf('+');var minus=inumber.indexOf('-');if(plus===0){plus=inumber.indexOf('+',1);}if(minus===0){minus=inumber.indexOf('-',1);}var last=inumber.substring(inumber.length-1,inumber.length);var unit=last==='i'||last==='j';if(plus>=0||minus>=0){if(!unit){return luckysheet.formula.error.nm;}if(plus>=0){return isNaN(inumber.substring(0,plus))||isNaN(inumber.substring(plus+1,inumber.length-1))?luckysheet.formula.error.nm:Number(inumber.substring(0,plus));}else {return isNaN(inumber.substring(0,minus))||isNaN(inumber.substring(minus+1,inumber.length-1))?luckysheet.formula.error.nm:Number(inumber.substring(0,minus));}}else {if(unit){return isNaN(inumber.substring(0,inumber.length-1))?luckysheet.formula.error.nm:0;}else {return isNaN(inumber)?luckysheet.formula.error.nm:inumber;}}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"IMAGINARY":function IMAGINARY(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//复数
  var inumber=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(inumber)){return inumber;}inumber=inumber.toString();if(inumber.toLowerCase()=="true"||inumber.toLowerCase()=="false"){return luckysheet.formula.error.v;}//计算
  if(inumber=="0"){return 0;}if(['i','j'].indexOf(inumber)>=0){return 1;}inumber=inumber.replace('+i','+1i').replace('-i','-1i').replace('+j','+1j').replace('-j','-1j');var plus=inumber.indexOf('+');var minus=inumber.indexOf('-');if(plus===0){plus=inumber.indexOf('+',1);}if(minus===0){minus=inumber.indexOf('-',1);}var last=inumber.substring(inumber.length-1,inumber.length);var unit=last==='i'||last==='j';if(plus>=0||minus>=0){if(!unit){return luckysheet.formula.error.nm;}if(plus>=0){return isNaN(inumber.substring(0,plus))||isNaN(inumber.substring(plus+1,inumber.length-1))?luckysheet.formula.error.nm:Number(inumber.substring(plus+1,inumber.length-1));}else {return isNaN(inumber.substring(0,minus))||isNaN(inumber.substring(minus+1,inumber.length-1))?luckysheet.formula.error.nm:-Number(inumber.substring(minus+1,inumber.length-1));}}else {if(unit){return isNaN(inumber.substring(0,inumber.length-1))?luckysheet.formula.error.nm:inumber.substring(0,inumber.length-1);}else {return isNaN(inumber)?luckysheet.formula.error.nm:0;}}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"IMCONJUGATE":function IMCONJUGATE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//复数
  var inumber=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(inumber)){return inumber;}inumber=inumber.toString();var x=window.luckysheet_function.IMREAL.f(inumber);if(luckysheet.func_methods.valueIsError(x)){return x;}var y=window.luckysheet_function.IMAGINARY.f(inumber);if(luckysheet.func_methods.valueIsError(y)){return y;}var unit=inumber.substring(inumber.length-1);unit=unit==='i'||unit==='j'?unit:'i';return y!==0?window.luckysheet_function.COMPLEX.f(x,-y,unit):inumber;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"IMABS":function IMABS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var x=window.luckysheet_function.IMREAL.f(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}var y=window.luckysheet_function.IMAGINARY.f(arguments[0]);if(luckysheet.func_methods.valueIsError(y)){return y;}return Math.sqrt(Math.pow(x,2)+Math.pow(y,2));}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DELTA":function DELTA(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//第一个数字
  var number1=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number1)){return number1;}if(!luckysheet.func_methods.isRealNum(number1)){return luckysheet.formula.error.v;}number1=parseFloat(number1);//第二个数字
  var number2=0;if(arguments.length==2){number2=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(number2)){return number2;}if(!luckysheet.func_methods.isRealNum(number2)){return luckysheet.formula.error.v;}number2=parseFloat(number2);}return number1===number2?1:0;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"IMSUM":function IMSUM(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var x=window.luckysheet_function.IMREAL.f(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}var y=window.luckysheet_function.IMAGINARY.f(arguments[0]);if(luckysheet.func_methods.valueIsError(y)){return y;}var result=arguments[0];for(var i=1;i<arguments.length;i++){var a=window.luckysheet_function.IMREAL.f(result);if(luckysheet.func_methods.valueIsError(a)){return a;}var b=window.luckysheet_function.IMAGINARY.f(result);if(luckysheet.func_methods.valueIsError(b)){return b;}var c=window.luckysheet_function.IMREAL.f(arguments[i]);if(luckysheet.func_methods.valueIsError(c)){return c;}var d=window.luckysheet_function.IMAGINARY.f(arguments[i]);if(luckysheet.func_methods.valueIsError(d)){return d;}result=window.luckysheet_function.COMPLEX.f(a+c,b+d);}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"IMSUB":function IMSUB(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//inumber1
  var inumber1=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(inumber1)){return inumber1;}inumber1=inumber1.toString();if(inumber1.toLowerCase()=="true"||inumber1.toLowerCase()=="false"){return luckysheet.formula.error.v;}var a=window.luckysheet_function.IMREAL.f(inumber1);if(luckysheet.func_methods.valueIsError(a)){return a;}var b=window.luckysheet_function.IMAGINARY.f(inumber1);if(luckysheet.func_methods.valueIsError(b)){return b;}//inumber2
  var inumber2=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(inumber2)){return inumber2;}inumber2=inumber2.toString();if(inumber2.toLowerCase()=="true"||inumber2.toLowerCase()=="false"){return luckysheet.formula.error.v;}var c=window.luckysheet_function.IMREAL.f(inumber2);if(luckysheet.func_methods.valueIsError(c)){return c;}var d=window.luckysheet_function.IMAGINARY.f(inumber2);if(luckysheet.func_methods.valueIsError(d)){return d;}//计算
  var unit1=inumber1.substring(inumber1.length-1);var unit2=inumber2.substring(inumber2.length-1);var unit='i';if(unit1==='j'){unit='j';}else if(unit2==='j'){unit='j';}return window.luckysheet_function.COMPLEX.f(a-c,b-d,unit);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"IMPRODUCT":function IMPRODUCT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var x=window.luckysheet_function.IMREAL.f(arguments[0]);if(luckysheet.func_methods.valueIsError(x)){return x;}var y=window.luckysheet_function.IMAGINARY.f(arguments[0]);if(luckysheet.func_methods.valueIsError(y)){return y;}var result=arguments[0];for(var i=1;i<arguments.length;i++){var a=window.luckysheet_function.IMREAL.f(result);if(luckysheet.func_methods.valueIsError(a)){return a;}var b=window.luckysheet_function.IMAGINARY.f(result);if(luckysheet.func_methods.valueIsError(b)){return b;}var c=window.luckysheet_function.IMREAL.f(arguments[i]);if(luckysheet.func_methods.valueIsError(c)){return c;}var d=window.luckysheet_function.IMAGINARY.f(arguments[i]);if(luckysheet.func_methods.valueIsError(d)){return d;}result=window.luckysheet_function.COMPLEX.f(a*c-b*d,a*d+b*c);}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"IMDIV":function IMDIV(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//inumber1
  var inumber1=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(inumber1)){return inumber1;}inumber1=inumber1.toString();if(inumber1.toLowerCase()=="true"||inumber1.toLowerCase()=="false"){return luckysheet.formula.error.v;}var a=window.luckysheet_function.IMREAL.f(inumber1);if(luckysheet.func_methods.valueIsError(a)){return a;}var b=window.luckysheet_function.IMAGINARY.f(inumber1);if(luckysheet.func_methods.valueIsError(b)){return b;}//inumber2
  var inumber2=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(inumber2)){return inumber2;}inumber2=inumber2.toString();if(inumber2.toLowerCase()=="true"||inumber2.toLowerCase()=="false"){return luckysheet.formula.error.v;}var c=window.luckysheet_function.IMREAL.f(inumber2);if(luckysheet.func_methods.valueIsError(c)){return c;}var d=window.luckysheet_function.IMAGINARY.f(inumber2);if(luckysheet.func_methods.valueIsError(d)){return d;}//计算
  var unit1=inumber1.substring(inumber1.length-1);var unit2=inumber2.substring(inumber2.length-1);var unit='i';if(unit1==='j'){unit='j';}else if(unit2==='j'){unit='j';}if(c===0&&d===0){return luckysheet.formula.error.nm;}var den=c*c+d*d;return window.luckysheet_function.COMPLEX.f((a*c+b*d)/den,(b*c-a*d)/den,unit);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NOT":function NOT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//logical
  var logical=luckysheet.func_methods.getCellBoolen(arguments[0]);if(luckysheet.func_methods.valueIsError(logical)){return logical;}return !logical;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TRUE":function TRUE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{return true;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FALSE":function FALSE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{return false;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"AND":function AND(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var result=true;for(var i=0;i<arguments.length;i++){var logical=luckysheet.func_methods.getCellBoolen(arguments[i]);if(luckysheet.func_methods.valueIsError(logical)){return logical;}if(!logical){result=false;break;}}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"IFERROR":function IFERROR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var value_if_error=luckysheet.func_methods.getFirstValue(arguments[1],"text");var value=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(value)){return value_if_error;}return value;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"IF":function IF(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要测试的条件
  var logical_test=luckysheet.func_methods.getCellBoolen(arguments[0]);if(luckysheet.func_methods.valueIsError(logical_test)){return logical_test;}//结果为 TRUE 
  var value_if_true=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(value_if_true)){return value_if_true;}//结果为 FALSE 
  var value_if_false="";if(arguments.length==3){value_if_false=luckysheet.func_methods.getFirstValue(arguments[2],"text");if(luckysheet.func_methods.valueIsError(value_if_false)){return value_if_false;}}if(logical_test){return value_if_true;}else {return value_if_false;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"OR":function OR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var result=false;for(var i=0;i<arguments.length;i++){var logical=luckysheet.func_methods.getCellBoolen(arguments[i]);if(luckysheet.func_methods.valueIsError(logical)){return logical;}if(logical){result=true;break;}}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NE":function NE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//value1
  var value1=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value1)){return value1;}//value2
  var value2=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(value2)){return value2;}return value1!=value2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"EQ":function EQ(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//value1
  var value1=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value1)){return value1;}//value2
  var value2=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(value2)){return value2;}return value1==value2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"GT":function GT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//value1
  var value1=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value1)){return value1;}if(!luckysheet.func_methods.isRealNum(value1)){return luckysheet.formula.error.v;}value1=parseFloat(value1);//value2
  var value2=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(value2)){return value2;}if(!luckysheet.func_methods.isRealNum(value2)){return luckysheet.formula.error.v;}value2=parseFloat(value2);return value1>value2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"GTE":function GTE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//value1
  var value1=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value1)){return value1;}if(!luckysheet.func_methods.isRealNum(value1)){return luckysheet.formula.error.v;}value1=parseFloat(value1);//value2
  var value2=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(value2)){return value2;}if(!luckysheet.func_methods.isRealNum(value2)){return luckysheet.formula.error.v;}value2=parseFloat(value2);return value1>=value2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LT":function LT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//value1
  var value1=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value1)){return value1;}if(!luckysheet.func_methods.isRealNum(value1)){return luckysheet.formula.error.v;}value1=parseFloat(value1);//value2
  var value2=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(value2)){return value2;}if(!luckysheet.func_methods.isRealNum(value2)){return luckysheet.formula.error.v;}value2=parseFloat(value2);return value1<value2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LTE":function LTE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//value1
  var value1=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value1)){return value1;}if(!luckysheet.func_methods.isRealNum(value1)){return luckysheet.formula.error.v;}value1=parseFloat(value1);//value2
  var value2=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(value2)){return value2;}if(!luckysheet.func_methods.isRealNum(value2)){return luckysheet.formula.error.v;}value2=parseFloat(value2);return value1<=value2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ADD":function ADD(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//value1
  var value1=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value1)){return value1;}if(!luckysheet.func_methods.isRealNum(value1)){return luckysheet.formula.error.v;}value1=parseFloat(value1);//value2
  var value2=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(value2)){return value2;}if(!luckysheet.func_methods.isRealNum(value2)){return luckysheet.formula.error.v;}value2=parseFloat(value2);return value1+value2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MINUS":function MINUS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//value1
  var value1=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value1)){return value1;}if(!luckysheet.func_methods.isRealNum(value1)){return luckysheet.formula.error.v;}value1=parseFloat(value1);//value2
  var value2=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(value2)){return value2;}if(!luckysheet.func_methods.isRealNum(value2)){return luckysheet.formula.error.v;}value2=parseFloat(value2);return value1-value2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MULTIPLY":function MULTIPLY(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//value1
  var value1=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value1)){return value1;}if(!luckysheet.func_methods.isRealNum(value1)){return luckysheet.formula.error.v;}value1=parseFloat(value1);//value2
  var value2=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(value2)){return value2;}if(!luckysheet.func_methods.isRealNum(value2)){return luckysheet.formula.error.v;}value2=parseFloat(value2);return value1*value2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DIVIDE":function DIVIDE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//value1
  var value1=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value1)){return value1;}if(!luckysheet.func_methods.isRealNum(value1)){return luckysheet.formula.error.v;}value1=parseFloat(value1);//value2
  var value2=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(value2)){return value2;}if(!luckysheet.func_methods.isRealNum(value2)){return luckysheet.formula.error.v;}value2=parseFloat(value2);if(value2==0){return luckysheet.formula.error.d;}return value1/value2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CONCAT":function CONCAT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//value1
  var value1=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(value1)){return value1;}//value2
  var value2=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(value2)){return value2;}return value1+""+value2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"UNARY_PERCENT":function UNARY_PERCENT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要作为百分比解释的数值
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);var result=number/100;return Math.round(result*100)/100;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CONCATENATE":function CONCATENATE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var result="";for(var i=0;i<arguments.length;i++){var text=luckysheet.func_methods.getFirstValue(arguments[i],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}result=result+""+text;}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CODE":function CODE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}if(text==""){return luckysheet.formula.error.v;}return text.charCodeAt(0);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CHAR":function CHAR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数字
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseInt(number);if(number<1||number>255){return luckysheet.formula.error.v;}return String.fromCharCode(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ARABIC":function ARABIC(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString().toUpperCase();if(!/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/.test(text)){return luckysheet.formula.error.v;}var r=0;text.replace(/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g,function(i){r+={M:1000,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1}[i];});return r;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ROMAN":function ROMAN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//计算
  var convert=function convert(num){var a=[["","I","II","III","IV","V","VI","VII","VIII","IX"],["","X","XX","XXX","XL","L","LX","LXX","LXXX","XC"],["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM"],["","M","MM","MMM"]];var i=a[3][Math.floor(num/1000)];var j=a[2][Math.floor(num%1000/100)];var k=a[1][Math.floor(num%100/10)];var l=a[0][num%10];return i+j+k+l;};//数字
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseInt(number);if(number==0){return "";}else if(number<1||number>3999){return luckysheet.formula.error.v;}return convert(number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"REGEXEXTRACT":function REGEXEXTRACT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//输入文本
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}//表达式
  var regular_expression=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(regular_expression)){return regular_expression;}var match=text.match(new RegExp(regular_expression));return match?match[match.length>1?match.length-1:0]:null;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"REGEXMATCH":function REGEXMATCH(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//输入文本
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}//表达式
  var regular_expression=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(regular_expression)){return regular_expression;}var match=text.match(new RegExp(regular_expression));return match?true:false;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"REGEXREPLACE":function REGEXREPLACE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//输入文本
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}//表达式
  var regular_expression=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(regular_expression)){return regular_expression;}//插入文本
  var replacement=luckysheet.func_methods.getFirstValue(arguments[2],"text");if(luckysheet.func_methods.valueIsError(replacement)){return replacement;}return text.replace(new RegExp(regular_expression),replacement);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"T":function T(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//文本
  var value=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(value)){return value;}return luckysheet.getObjType(value)=="string"?value:'';}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FIXED":function FIXED(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要进行舍入并转换为文本的数字
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//小数位数
  var decimals=2;if(arguments.length>=2){decimals=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(decimals)){return decimals;}if(!luckysheet.func_methods.isRealNum(decimals)){return luckysheet.formula.error.v;}decimals=parseInt(decimals);}//逻辑值
  var no_commas=false;if(arguments.length==3){no_commas=luckysheet.func_methods.getCellBoolen(arguments[2]);if(luckysheet.func_methods.valueIsError(no_commas)){return no_commas;}}if(decimals>127){return luckysheet.formula.error.v;}//计算
  var format=no_commas?'0':'#,##0';if(decimals<=0){number=Math.round(number*Math.pow(10,decimals))/Math.pow(10,decimals);}else if(decimals>0){format+='.'+new Array(decimals+1).join('0');}return luckysheet.mask.update(format,number);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FIND":function FIND(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要查找的文本
  var find_text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(find_text)){return find_text;}find_text=find_text.toString();//包含要查找文本的文本
  var within_text=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(within_text)){return within_text;}within_text=within_text.toString();//指定开始进行查找的字符
  var start_num=1;if(arguments.length==3){start_num=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(start_num)){return start_num;}if(!luckysheet.func_methods.isRealNum(start_num)){return luckysheet.formula.error.v;}start_num=parseFloat(start_num);}if(start_num<0||start_num>within_text.length){return luckysheet.formula.error.v;}if(find_text==""){return start_num;}if(within_text.indexOf(find_text)==-1){return luckysheet.formula.error.v;}var result=within_text.indexOf(find_text,start_num-1)+1;return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FINDB":function FINDB(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要查找的文本
  var find_text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(find_text)){return find_text;}find_text=find_text.toString();//包含要查找文本的文本
  var within_text=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(within_text)){return within_text;}within_text=within_text.toString();//指定开始进行查找的字符
  var start_num=1;if(arguments.length==3){start_num=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(start_num)){return start_num;}if(!luckysheet.func_methods.isRealNum(start_num)){return luckysheet.formula.error.v;}start_num=parseFloat(start_num);}if(start_num<0||start_num>within_text.length){return luckysheet.formula.error.v;}if(find_text==""){return start_num;}if(within_text.indexOf(find_text)==-1){return luckysheet.formula.error.v;}var strArr=within_text.split("");var index=within_text.indexOf(find_text,start_num-1);var result=0;for(var i=0;i<index;i++){if(/[^\x00-\xff]/g.test(strArr[i])){result+=2;}else {result+=1;}}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"JOIN":function JOIN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//定界符
  var separator=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(separator)){return separator;}//值或数组
  var dataArr=[];for(var i=1;i<arguments.length;i++){var data=arguments[i];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}dataArr=dataArr.concat(luckysheet.func_methods.getDataArr(data,false));}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){dataArr=dataArr.concat(luckysheet.func_methods.getCellDataArr(data,"text",false));}else {dataArr.push(data);}}return dataArr.join(separator);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LEFT":function LEFT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//包含要提取的字符的文本字符串
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString();//提取的字符的数量
  var num_chars=1;if(arguments.length==2){num_chars=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(num_chars)){return num_chars;}if(!luckysheet.func_methods.isRealNum(num_chars)){return luckysheet.formula.error.v;}num_chars=parseInt(num_chars);}if(num_chars<0){return luckysheet.formula.error.v;}//计算
  if(num_chars>=text.length){return text;}else if(num_chars==0){return "";}else {return text.substr(0,num_chars);}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"RIGHT":function RIGHT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//包含要提取的字符的文本字符串
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString();//提取的字符的数量
  var num_chars=1;if(arguments.length==2){num_chars=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(num_chars)){return num_chars;}if(!luckysheet.func_methods.isRealNum(num_chars)){return luckysheet.formula.error.v;}num_chars=parseInt(num_chars);}if(num_chars<0){return luckysheet.formula.error.v;}//计算
  if(num_chars>=text.length){return text;}else if(num_chars==0){return "";}else {return text.substr(-num_chars,num_chars);}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MID":function MID(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//包含要提取的字符的文本字符串
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString();//开始提取的位置
  var start_num=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(start_num)){return start_num;}if(!luckysheet.func_methods.isRealNum(start_num)){return luckysheet.formula.error.v;}start_num=parseInt(start_num);//提取的字符的数量
  var num_chars=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(num_chars)){return num_chars;}if(!luckysheet.func_methods.isRealNum(num_chars)){return luckysheet.formula.error.v;}num_chars=parseInt(num_chars);if(start_num<1||num_chars<0){return luckysheet.formula.error.v;}//计算
  if(start_num>text.length){return "";}if(start_num+num_chars>text.length){return text.substr(start_num-1,text.length-start_num+1);}return text.substr(start_num-1,num_chars);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LEN":function LEN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString();return text.length;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LENB":function LENB(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString();return text.replace(/[^\x00-\xff]/g,"aa").length;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LOWER":function LOWER(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString();return text?text.toLowerCase():text;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"UPPER":function UPPER(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString();return text?text.toUpperCase():text;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"EXACT":function EXACT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串1
  var text1=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text1)){return text1;}text1=text1.toString();//字符串2
  var text2=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(text2)){return text2;}text2=text2.toString();return text1===text2;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"REPLACE":function REPLACE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串1
  var old_text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(old_text)){return old_text;}old_text=old_text.toString();//进行替换操作的位置
  var start_num=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(start_num)){return start_num;}if(!luckysheet.func_methods.isRealNum(start_num)){return luckysheet.formula.error.v;}start_num=parseInt(start_num);//要在文本中替换的字符个数
  var num_chars=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(num_chars)){return num_chars;}if(!luckysheet.func_methods.isRealNum(num_chars)){return luckysheet.formula.error.v;}num_chars=parseInt(num_chars);//字符串2
  var new_text=luckysheet.func_methods.getFirstValue(arguments[3],"text");if(luckysheet.func_methods.valueIsError(new_text)){return new_text;}new_text=new_text.toString();return old_text.substr(0,start_num-1)+new_text+old_text.substr(start_num-1+num_chars);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"REPT":function REPT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串1
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString();//重复次数
  var number_times=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(number_times)){return number_times;}if(!luckysheet.func_methods.isRealNum(number_times)){return luckysheet.formula.error.v;}number_times=parseInt(number_times);if(number_times<0){return luckysheet.formula.error.v;}if(number_times>100){number_times=100;}return new Array(number_times+1).join(text);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SEARCH":function SEARCH(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串1
  var find_text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(find_text)){return find_text;}find_text=find_text.toString();//字符串2
  var within_text=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(within_text)){return within_text;}within_text=within_text.toString();//开始位置
  var start_num=1;if(arguments.length==3){start_num=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(start_num)){return start_num;}if(!luckysheet.func_methods.isRealNum(start_num)){return luckysheet.formula.error.v;}start_num=parseInt(start_num);}if(start_num<=0||start_num>within_text.length){return luckysheet.formula.error.v;}var foundAt=within_text.toLowerCase().indexOf(find_text.toLowerCase(),start_num-1)+1;return foundAt===0?luckysheet.formula.error.v:foundAt;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SUBSTITUTE":function SUBSTITUTE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//需要替换其中字符的文本
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString();//需要替换的文本
  var old_text=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(old_text)){return old_text;}old_text=old_text.toString();//用于替换 old_text 的文本
  var new_text=luckysheet.func_methods.getFirstValue(arguments[2],"text");if(luckysheet.func_methods.valueIsError(new_text)){return new_text;}new_text=new_text.toString();//instance_num
  var instance_num=null;if(arguments.length==4){instance_num=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(instance_num)){return instance_num;}if(!luckysheet.func_methods.isRealNum(instance_num)){return luckysheet.formula.error.v;}instance_num=parseInt(instance_num);}//计算
  var reg=new RegExp(old_text,"g");var result;if(instance_num==null){result=text.replace(reg,new_text);}else {if(instance_num<=0){return luckysheet.formula.error.v;}var match=text.match(reg);if(match==null||instance_num>match.length){return text;}else {var len=old_text.length;var index=0;for(var i=1;i<=instance_num;i++){index=text.indexOf(old_text,index)+1;}result=text.substring(0,index-1)+new_text+text.substring(index-1+len);}}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CLEAN":function CLEAN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString();var textArr=[];for(var i=0;i<text.length;i++){var code=text.charCodeAt(i);if(/[\u4e00-\u9fa5]/g.test(text.charAt(i))||code>31&&code<127){textArr.push(text.charAt(i));}}return textArr.join("");}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TEXT":function TEXT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数字
  var value=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value)){return value;}if(!luckysheet.func_methods.isRealNum(value)){return luckysheet.formula.error.v;}value=parseFloat(value);//格式
  var format_text=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(format_text)){return format_text;}format_text=format_text.toString();return luckysheet.mask.update(format_text,value);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TRIM":function TRIM(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString();return text.replace(/ +/g,' ').trim();}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"VALUE":function VALUE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString();return luckysheet.mask.genarate(text)[2];}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PROPER":function PROPER(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//字符串
  var text=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(text)){return text;}text=text.toString().toLowerCase();return text.replace(/[a-zA-Z]+/g,function(word){return word.substring(0,1).toUpperCase()+word.substring(1);});}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CONVERT":function CONVERT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数字
  var number=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(number)){return number;}if(!luckysheet.func_methods.isRealNum(number)){return luckysheet.formula.error.v;}number=parseFloat(number);//数值的单位
  var from_unit=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(from_unit)){return from_unit;}from_unit=from_unit.toString();//结果的单位
  var to_unit=luckysheet.func_methods.getFirstValue(arguments[2],"text");if(luckysheet.func_methods.valueIsError(to_unit)){return to_unit;}to_unit=to_unit.toString();//计算
  var units=[["a.u. of action","?",null,"action",false,false,1.05457168181818e-34],["a.u. of charge","e",null,"electric_charge",false,false,1.60217653141414e-19],["a.u. of energy","Eh",null,"energy",false,false,4.35974417757576e-18],["a.u. of length","a?",null,"length",false,false,5.29177210818182e-11],["a.u. of mass","m?",null,"mass",false,false,9.10938261616162e-31],["a.u. of time","?/Eh",null,"time",false,false,2.41888432650516e-17],["admiralty knot","admkn",null,"speed",false,true,0.514773333],["ampere","A",null,"electric_current",true,false,1],["ampere per meter","A/m",null,"magnetic_field_intensity",true,false,1],["ångström","Å",["ang"],"length",false,true,1e-10],["are","ar",null,"area",false,true,100],["astronomical unit","ua",null,"length",false,false,1.49597870691667e-11],["bar","bar",null,"pressure",false,false,100000],["barn","b",null,"area",false,false,1e-28],["becquerel","Bq",null,"radioactivity",true,false,1],["bit","bit",["b"],"information",false,true,1],["btu","BTU",["btu"],"energy",false,true,1055.05585262],["byte","byte",null,"information",false,true,8],["candela","cd",null,"luminous_intensity",true,false,1],["candela per square metre","cd/m?",null,"luminance",true,false,1],["coulomb","C",null,"electric_charge",true,false,1],["cubic ångström","ang3",["ang^3"],"volume",false,true,1e-30],["cubic foot","ft3",["ft^3"],"volume",false,true,0.028316846592],["cubic inch","in3",["in^3"],"volume",false,true,0.000016387064],["cubic light-year","ly3",["ly^3"],"volume",false,true,8.46786664623715e-47],["cubic metre","m?",null,"volume",true,true,1],["cubic mile","mi3",["mi^3"],"volume",false,true,4168181825.44058],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",false,true,6352182208],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",false,true,7.58660370370369e-8],["cubic yard","yd3",["yd^3"],"volume",false,true,0.764554857984],["cup","cup",null,"volume",false,true,0.0002365882365],["dalton","Da",["u"],"mass",false,false,1.66053886282828e-27],["day","d",["day"],"time",false,true,86400],["degree","°",null,"angle",false,false,0.0174532925199433],["degrees Rankine","Rank",null,"temperature",false,true,0.555555555555556],["dyne","dyn",["dy"],"force",false,true,0.00001],["electronvolt","eV",["ev"],"energy",false,true,1.60217656514141],["ell","ell",null,"length",false,true,1.143],["erg","erg",["e"],"energy",false,true,1e-7],["farad","F",null,"electric_capacitance",true,false,1],["fluid ounce","oz",null,"volume",false,true,0.0000295735295625],["foot","ft",null,"length",false,true,0.3048],["foot-pound","flb",null,"energy",false,true,1.3558179483314],["gal","Gal",null,"acceleration",false,false,0.01],["gallon","gal",null,"volume",false,true,0.003785411784],["gauss","G",["ga"],"magnetic_flux_density",false,true,1],["grain","grain",null,"mass",false,true,0.0000647989],["gram","g",null,"mass",false,true,0.001],["gray","Gy",null,"absorbed_dose",true,false,1],["gross registered ton","GRT",["regton"],"volume",false,true,2.8316846592],["hectare","ha",null,"area",false,true,10000],["henry","H",null,"inductance",true,false,1],["hertz","Hz",null,"frequency",true,false,1],["horsepower","HP",["h"],"power",false,true,745.69987158227],["horsepower-hour","HPh",["hh","hph"],"energy",false,true,2684519.538],["hour","h",["hr"],"time",false,true,3600],["imperial gallon (U.K.)","uk_gal",null,"volume",false,true,0.00454609],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",false,true,50.802345],["imperial quart (U.K)","uk_qt",null,"volume",false,true,0.0011365225],["imperial ton","brton",["uk_ton","LTON"],"mass",false,true,1016.046909],["inch","in",null,"length",false,true,0.0254],["international acre","uk_acre",null,"area",false,true,4046.8564224],["IT calorie","cal",null,"energy",false,true,4.1868],["joule","J",null,"energy",true,true,1],["katal","kat",null,"catalytic_activity",true,false,1],["kelvin","K",["kel"],"temperature",true,true,1],["kilogram","kg",null,"mass",true,true,1],["knot","kn",null,"speed",false,true,0.514444444444444],["light-year","ly",null,"length",false,true,9460730472580800],["litre","L",["l","lt"],"volume",false,true,0.001],["lumen","lm",null,"luminous_flux",true,false,1],["lux","lx",null,"illuminance",true,false,1],["maxwell","Mx",null,"magnetic_flux",false,false,1e-18],["measurement ton","MTON",null,"volume",false,true,1.13267386368],["meter per hour","m/h",["m/hr"],"speed",false,true,0.00027777777777778],["meter per second","m/s",["m/sec"],"speed",true,true,1],["meter per second squared","m?s??",null,"acceleration",true,false,1],["parsec","pc",["parsec"],"length",false,true,30856775814671900],["meter squared per second","m?/s",null,"kinematic_viscosity",true,false,1],["metre","m",null,"length",true,true,1],["miles per hour","mph",null,"speed",false,true,0.44704],["millimetre of mercury","mmHg",null,"pressure",false,false,133.322],["minute","?",null,"angle",false,false,0.000290888208665722],["minute","min",["mn"],"time",false,true,60],["modern teaspoon","tspm",null,"volume",false,true,0.000005],["mole","mol",null,"amount_of_substance",true,false,1],["morgen","Morgen",null,"area",false,true,2500],["n.u. of action","?",null,"action",false,false,1.05457168181818e-34],["n.u. of mass","m?",null,"mass",false,false,9.10938261616162e-31],["n.u. of speed","c?",null,"speed",false,false,299792458],["n.u. of time","?/(me?c??)",null,"time",false,false,1.28808866778687e-21],["nautical mile","M",["Nmi"],"length",false,true,1852],["newton","N",null,"force",true,true,1],["œrsted","Oe ",null,"magnetic_field_intensity",false,false,79.5774715459477],["ohm","Ω",null,"electric_resistance",true,false,1],["ounce mass","ozm",null,"mass",false,true,0.028349523125],["pascal","Pa",null,"pressure",true,false,1],["pascal second","Pa?s",null,"dynamic_viscosity",true,false,1],["pferdestärke","PS",null,"power",false,true,735.49875],["phot","ph",null,"illuminance",false,false,0.0001],["pica (1/6 inch)","pica",null,"length",false,true,0.00035277777777778],["pica (1/72 inch)","Pica",["Picapt"],"length",false,true,0.00423333333333333],["poise","P",null,"dynamic_viscosity",false,false,0.1],["pond","pond",null,"force",false,true,0.00980665],["pound force","lbf",null,"force",false,true,4.4482216152605],["pound mass","lbm",null,"mass",false,true,0.45359237],["quart","qt",null,"volume",false,true,0.000946352946],["radian","rad",null,"angle",true,false,1],["second","?",null,"angle",false,false,0.00000484813681109536],["second","s",["sec"],"time",true,true,1],["short hundredweight","cwt",["shweight"],"mass",false,true,45.359237],["siemens","S",null,"electrical_conductance",true,false,1],["sievert","Sv",null,"equivalent_dose",true,false,1],["slug","sg",null,"mass",false,true,14.59390294],["square ångström","ang2",["ang^2"],"area",false,true,1e-20],["square foot","ft2",["ft^2"],"area",false,true,0.09290304],["square inch","in2",["in^2"],"area",false,true,0.00064516],["square light-year","ly2",["ly^2"],"area",false,true,8.95054210748189e+31],["square meter","m?",null,"area",true,true,1],["square mile","mi2",["mi^2"],"area",false,true,2589988.110336],["square nautical mile","Nmi2",["Nmi^2"],"area",false,true,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",false,true,0.00001792111111111],["square yard","yd2",["yd^2"],"area",false,true,0.83612736],["statute mile","mi",null,"length",false,true,1609.344],["steradian","sr",null,"solid_angle",true,false,1],["stilb","sb",null,"luminance",false,false,0.0001],["stokes","St",null,"kinematic_viscosity",false,false,0.0001],["stone","stone",null,"mass",false,true,6.35029318],["tablespoon","tbs",null,"volume",false,true,0.0000147868],["teaspoon","tsp",null,"volume",false,true,0.00000492892],["tesla","T",null,"magnetic_flux_density",true,true,1],["thermodynamic calorie","c",null,"energy",false,true,4.184],["ton","ton",null,"mass",false,true,907.18474],["tonne","t",null,"mass",false,false,1000],["U.K. pint","uk_pt",null,"volume",false,true,0.00056826125],["U.S. bushel","bushel",null,"volume",false,true,0.03523907],["U.S. oil barrel","barrel",null,"volume",false,true,0.158987295],["U.S. pint","pt",["us_pt"],"volume",false,true,0.000473176473],["U.S. survey mile","survey_mi",null,"length",false,true,1609.347219],["U.S. survey/statute acre","us_acre",null,"area",false,true,4046.87261],["volt","V",null,"voltage",true,false,1],["watt","W",null,"power",true,true,1],["watt-hour","Wh",["wh"],"energy",false,true,3600],["weber","Wb",null,"magnetic_flux",true,false,1],["yard","yd",null,"length",false,true,0.9144],["year","yr",null,"time",false,true,31557600]];var binary_prefixes={Yi:["yobi",80,1208925819614629174706176,"Yi","yotta"],Zi:["zebi",70,1180591620717411303424,"Zi","zetta"],Ei:["exbi",60,1152921504606846976,"Ei","exa"],Pi:["pebi",50,1125899906842624,"Pi","peta"],Ti:["tebi",40,1099511627776,"Ti","tera"],Gi:["gibi",30,1073741824,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]};var unit_prefixes={Y:["yotta",1e+24,"Y"],Z:["zetta",1e+21,"Z"],E:["exa",1e+18,"E"],P:["peta",1e+15,"P"],T:["tera",1e+12,"T"],G:["giga",1e+09,"G"],M:["mega",1e+06,"M"],k:["kilo",1e+03,"k"],h:["hecto",1e+02,"h"],e:["dekao",1e+01,"e"],d:["deci",1e-01,"d"],c:["centi",1e-02,"c"],m:["milli",1e-03,"m"],u:["micro",1e-06,"u"],n:["nano",1e-09,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]};var from=null;var to=null;var base_from_unit=from_unit;var base_to_unit=to_unit;var from_multiplier=1;var to_multiplier=1;var alt;for(var i=0;i<units.length;i++){alt=units[i][2]===null?[]:units[i][2];if(units[i][1]===base_from_unit||alt.indexOf(base_from_unit)>=0){from=units[i];}if(units[i][1]===base_to_unit||alt.indexOf(base_to_unit)>=0){to=units[i];}}if(from===null){var from_binary_prefix=binary_prefixes[from_unit.substring(0,2)];var from_unit_prefix=unit_prefixes[from_unit.substring(0,1)];if(from_unit.substring(0,2)==='da'){from_unit_prefix=["dekao",1e+01,"da"];}if(from_binary_prefix){from_multiplier=from_binary_prefix[2];base_from_unit=from_unit.substring(2);}else if(from_unit_prefix){from_multiplier=from_unit_prefix[1];base_from_unit=from_unit.substring(from_unit_prefix[2].length);}for(var j=0;j<units.length;j++){alt=units[j][2]===null?[]:units[j][2];if(units[j][1]===base_from_unit||alt.indexOf(base_from_unit)>=0){from=units[j];}}}if(to===null){var to_binary_prefix=binary_prefixes[to_unit.substring(0,2)];var to_unit_prefix=unit_prefixes[to_unit.substring(0,1)];if(to_unit.substring(0,2)==='da'){to_unit_prefix=["dekao",1e+01,"da"];}if(to_binary_prefix){to_multiplier=to_binary_prefix[2];base_to_unit=to_unit.substring(2);}else if(to_unit_prefix){to_multiplier=to_unit_prefix[1];base_to_unit=to_unit.substring(to_unit_prefix[2].length);}for(var k=0;k<units.length;k++){alt=units[k][2]===null?[]:units[k][2];if(units[k][1]===base_to_unit||alt.indexOf(base_to_unit)>=0){to=units[k];}}}if(from===null||to===null){return luckysheet.formula.error.na;}if(from[3]!==to[3]){return luckysheet.formula.error.na;}return number*from[6]*from_multiplier/(to[6]*to_multiplier);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SUMX2MY2":function SUMX2MY2(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//第一个数组或数值区域
  var data_array_x=arguments[0];var array_x=[];if(luckysheet.getObjType(data_array_x)=="array"){if(luckysheet.getObjType(data_array_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array_x)){return luckysheet.formula.error.v;}array_x=array_x.concat(luckysheet.func_methods.getDataArr(data_array_x,false));}else if(luckysheet.getObjType(data_array_x)=="object"&&data_array_x.startCell!=null){array_x=array_x.concat(luckysheet.func_methods.getCellDataArr(data_array_x,"text",false));}else {array_x.push(data_array_x);}//第二个数组或数值区域
  var data_array_y=arguments[1];var array_y=[];if(luckysheet.getObjType(data_array_y)=="array"){if(luckysheet.getObjType(data_array_y[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array_y)){return luckysheet.formula.error.v;}array_y=array_y.concat(luckysheet.func_methods.getDataArr(data_array_y,false));}else if(luckysheet.getObjType(data_array_y)=="object"&&data_array_y.startCell!=null){array_y=array_y.concat(luckysheet.func_methods.getCellDataArr(data_array_y,"text",false));}else {array_y.push(data_array_y);}if(array_x.length!=array_y.length){return luckysheet.formula.error.na;}//array_x 和 array_y 只取数值
  var data_x=[],data_y=[];for(var i=0;i<array_x.length;i++){var num_x=array_x[i];var num_y=array_y[i];if(luckysheet.func_methods.isRealNum(num_x)&&luckysheet.func_methods.isRealNum(num_y)){data_x.push(parseFloat(num_x));data_y.push(parseFloat(num_y));}}//计算
  var sum=0;for(var i=0;i<data_x.length;i++){sum+=Math.pow(data_x[i],2)-Math.pow(data_y[i],2);}return sum;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SUMX2PY2":function SUMX2PY2(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//第一个数组或数值区域
  var data_array_x=arguments[0];var array_x=[];if(luckysheet.getObjType(data_array_x)=="array"){if(luckysheet.getObjType(data_array_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array_x)){return luckysheet.formula.error.v;}array_x=array_x.concat(luckysheet.func_methods.getDataArr(data_array_x,false));}else if(luckysheet.getObjType(data_array_x)=="object"&&data_array_x.startCell!=null){array_x=array_x.concat(luckysheet.func_methods.getCellDataArr(data_array_x,"text",false));}else {array_x.push(data_array_x);}//第二个数组或数值区域
  var data_array_y=arguments[1];var array_y=[];if(luckysheet.getObjType(data_array_y)=="array"){if(luckysheet.getObjType(data_array_y[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array_y)){return luckysheet.formula.error.v;}array_y=array_y.concat(luckysheet.func_methods.getDataArr(data_array_y,false));}else if(luckysheet.getObjType(data_array_y)=="object"&&data_array_y.startCell!=null){array_y=array_y.concat(luckysheet.func_methods.getCellDataArr(data_array_y,"text",false));}else {array_y.push(data_array_y);}if(array_x.length!=array_y.length){return luckysheet.formula.error.na;}//array_x 和 array_y 只取数值
  var data_x=[],data_y=[];for(var i=0;i<array_x.length;i++){var num_x=array_x[i];var num_y=array_y[i];if(luckysheet.func_methods.isRealNum(num_x)&&luckysheet.func_methods.isRealNum(num_y)){data_x.push(parseFloat(num_x));data_y.push(parseFloat(num_y));}}//计算
  var sum=0;for(var i=0;i<data_x.length;i++){sum+=Math.pow(data_x[i],2)+Math.pow(data_y[i],2);}return sum;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SUMXMY2":function SUMXMY2(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//第一个数组或数值区域
  var data_array_x=arguments[0];var array_x=[];if(luckysheet.getObjType(data_array_x)=="array"){if(luckysheet.getObjType(data_array_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array_x)){return luckysheet.formula.error.v;}array_x=array_x.concat(luckysheet.func_methods.getDataArr(data_array_x,false));}else if(luckysheet.getObjType(data_array_x)=="object"&&data_array_x.startCell!=null){array_x=array_x.concat(luckysheet.func_methods.getCellDataArr(data_array_x,"text",false));}else {array_x.push(data_array_x);}//第二个数组或数值区域
  var data_array_y=arguments[1];var array_y=[];if(luckysheet.getObjType(data_array_y)=="array"){if(luckysheet.getObjType(data_array_y[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array_y)){return luckysheet.formula.error.v;}array_y=array_y.concat(luckysheet.func_methods.getDataArr(data_array_y,false));}else if(luckysheet.getObjType(data_array_y)=="object"&&data_array_y.startCell!=null){array_y=array_y.concat(luckysheet.func_methods.getCellDataArr(data_array_y,"text",false));}else {array_y.push(data_array_y);}if(array_x.length!=array_y.length){return luckysheet.formula.error.na;}//array_x 和 array_y 只取数值
  var data_x=[],data_y=[];for(var i=0;i<array_x.length;i++){var num_x=array_x[i];var num_y=array_y[i];if(luckysheet.func_methods.isRealNum(num_x)&&luckysheet.func_methods.isRealNum(num_y)){data_x.push(parseFloat(num_x));data_y.push(parseFloat(num_y));}}//计算
  var sum=0;for(var i=0;i<data_x.length;i++){sum+=Math.pow(data_x[i]-data_y[i],2);}return sum;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TRANSPOSE":function TRANSPOSE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//从其返回唯一值的数组或区域
  var data_array=arguments[0];var array=[];if(luckysheet.getObjType(data_array)=="array"){if(luckysheet.getObjType(data_array[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array)){return luckysheet.formula.error.v;}array=luckysheet.func_methods.getDataDyadicArr(data_array);}else if(luckysheet.getObjType(data_array)=="object"&&data_array.startCell!=null){array=luckysheet.func_methods.getCellDataDyadicArr(data_array,"number");}array=array[0].map(function(col,a){return array.map(function(row){return row[a];});});return array;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TREND":function TREND(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//计算
  var leastSquare=function leastSquare(arr_x,arr_y){var xSum=0,ySum=0,xySum=0,x2Sum=0;for(var i=0;i<arr_x.length;i++){for(var j=0;j<arr_x[i].length;j++){xSum+=arr_x[i][j];ySum+=arr_y[i][j];xySum+=arr_x[i][j]*arr_y[i][j];x2Sum+=arr_x[i][j]*arr_x[i][j];}}var n=arr_x.length*arr_x[0].length;var xMean=xSum/n;var yMean=ySum/n;var xyMean=xySum/n;var x2Mean=x2Sum/n;var m=(xyMean-xMean*yMean)/(x2Mean-xMean*xMean);var b=yMean-m*xMean;return [m,b];};//已知的 y 值集合
  var data_known_y=arguments[0];var known_y=[];if(luckysheet.getObjType(data_known_y)=="array"){if(luckysheet.getObjType(data_known_y[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_y)){return luckysheet.formula.error.v;}known_y=luckysheet.func_methods.getDataDyadicArr(data_known_y);}else if(luckysheet.getObjType(data_known_y)=="object"&&data_known_y.startCell!=null){known_y=luckysheet.func_methods.getCellDataDyadicArr(data_known_y,"text");}else {if(!luckysheet.func_methods.isRealNum(data_known_y)){return luckysheet.formula.error.v;}var rowArr=[];rowArr.push(parseFloat(data_known_y));known_y.push(rowArr);}var known_y_rowlen=known_y.length;var known_y_collen=known_y[0].length;for(var i=0;i<known_y_rowlen;i++){for(var j=0;j<known_y_collen;j++){if(!luckysheet.func_methods.isRealNum(known_y[i][j])){return luckysheet.formula.error.v;}known_y[i][j]=parseFloat(known_y[i][j]);}}//可选 x 值集合
  var known_x=[];for(var i=1;i<=known_y_rowlen;i++){for(var j=1;j<=known_y_collen;j++){var number=(i-1)*known_y_collen+j;known_x.push(number);}}if(arguments.length>=2){var data_known_x=arguments[1];known_x=[];if(luckysheet.getObjType(data_known_x)=="array"){if(luckysheet.getObjType(data_known_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_x)){return luckysheet.formula.error.v;}known_x=luckysheet.func_methods.getDataDyadicArr(data_known_x);}else if(luckysheet.getObjType(data_known_x)=="object"&&data_known_x.startCell!=null){known_x=luckysheet.func_methods.getCellDataDyadicArr(data_known_x,"text");}else {if(!luckysheet.func_methods.isRealNum(data_known_x)){return luckysheet.formula.error.v;}var rowArr=[];rowArr.push(parseFloat(data_known_x));known_x.push(rowArr);}for(var i=0;i<known_x.length;i++){for(var j=0;j<known_x[0].length;j++){if(!luckysheet.func_methods.isRealNum(known_x[i][j])){return luckysheet.formula.error.v;}known_x[i][j]=parseFloat(known_x[i][j]);}}}var known_x_rowlen=known_x.length;var known_x_collen=known_x[0].length;//新 x 值
  var new_x=known_x;if(arguments.length>=3){var data_new_x=arguments[2];new_x=[];if(luckysheet.getObjType(data_new_x)=="array"){if(luckysheet.getObjType(data_new_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_new_x)){return luckysheet.formula.error.v;}new_x=luckysheet.func_methods.getDataDyadicArr(data_new_x);}else if(luckysheet.getObjType(data_new_x)=="object"&&data_new_x.startCell!=null){new_x=luckysheet.func_methods.getCellDataDyadicArr(data_new_x,"text");}else {if(!luckysheet.func_methods.isRealNum(data_new_x)){return luckysheet.formula.error.v;}var rowArr=[];rowArr.push(parseFloat(data_new_x));new_x.push(rowArr);}for(var i=0;i<new_x.length;i++){for(var j=0;j<new_x[0].length;j++){if(!luckysheet.func_methods.isRealNum(new_x[i][j])){return luckysheet.formula.error.v;}new_x[i][j]=parseFloat(new_x[i][j]);}}}//逻辑值
  var const_b=true;if(arguments.length==4){const_b=luckysheet.func_methods.getCellBoolen(arguments[3]);if(luckysheet.func_methods.valueIsError(const_b)){return const_b;}}if(known_y_rowlen!=known_x_rowlen||known_y_collen!=known_x_collen){return luckysheet.formula.error.r;}var ls=leastSquare(known_x,known_y);var m=ls[0];if(const_b){var b=ls[1];}else {var b=0;}var result=[];for(var i=0;i<new_x.length;i++){for(var j=0;j<new_x[i].length;j++){var x=new_x[i][j];var y=m*x+b;result.push(Math.round(y*1000000000)/1000000000);}}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FREQUENCY":function FREQUENCY(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//频率数组
  var data_data_array=arguments[0];var data_array=[];if(luckysheet.getObjType(data_data_array)=="array"){if(luckysheet.getObjType(data_data_array[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_data_array)){return luckysheet.formula.error.v;}data_array=data_array.concat(luckysheet.func_methods.getDataArr(data_data_array,true));}else if(luckysheet.getObjType(data_data_array)=="object"&&data_data_array.startCell!=null){data_array=data_array.concat(luckysheet.func_methods.getCellDataArr(data_data_array,"number",true));}else {if(!luckysheet.func_methods.isRealNum(data_data_array)){return luckysheet.formula.error.v;}data_array.push(data_data_array);}var data_array_n=[];for(var i=0;i<data_array.length;i++){if(luckysheet.func_methods.isRealNum(data_array[i])){data_array_n.push(parseFloat(data_array[i]));}}//间隔数组
  var data_bins_array=arguments[1];var bins_array=[];if(luckysheet.getObjType(data_bins_array)=="array"){if(luckysheet.getObjType(data_bins_array[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_bins_array)){return luckysheet.formula.error.v;}bins_array=bins_array.concat(luckysheet.func_methods.getDataArr(data_bins_array,true));}else if(luckysheet.getObjType(data_bins_array)=="object"&&data_bins_array.startCell!=null){bins_array=bins_array.concat(luckysheet.func_methods.getCellDataArr(data_bins_array,"number",true));}else {if(!luckysheet.func_methods.isRealNum(data_bins_array)){return luckysheet.formula.error.v;}bins_array.push(data_bins_array);}var bins_array_n=[];for(var i=0;i<bins_array.length;i++){if(luckysheet.func_methods.isRealNum(bins_array[i])){bins_array_n.push(parseFloat(bins_array[i]));}}//计算
  if(data_array_n.length==0&&bins_array_n.length==0){return [[0],[0]];}else if(data_array_n.length==0){var result=[[0]];for(var i=0;i<bins_array_n.length;i++){result.push([0]);}return result;}else if(bins_array_n.length==0){return [[0],[data_array_n.length]];}else {bins_array_n.sort(function(a,b){return a-b;});var result=[];for(var i=0;i<bins_array_n.length;i++){if(i==0){var count=0;for(var j=0;j<data_array_n.length;j++){if(data_array_n[j]<=bins_array_n[0]){count++;}}result.push([count]);}else if(i==bins_array_n.length-1){var count1=0,count2=0;for(var j=0;j<data_array_n.length;j++){if(data_array_n[j]<=bins_array_n[i]&&data_array_n[j]>bins_array_n[i-1]){count1++;}if(data_array_n[j]>bins_array_n[i]){count2++;}}result.push([count1]);result.push([count2]);}else {var count=0;for(var j=0;j<data_array_n.length;j++){if(data_array_n[j]<=bins_array_n[i]&&data_array_n[j]>bins_array_n[i-1]){count++;}}result.push([count]);}}return result;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"GROWTH":function GROWTH(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//计算
  var leastSquare=function leastSquare(arr_x,arr_y){var xSum=0,ySum=0,xySum=0,x2Sum=0;for(var i=0;i<arr_x.length;i++){for(var j=0;j<arr_x[i].length;j++){xSum+=arr_x[i][j];// ySum += arr_y[i][j];
  ySum+=Math.log(arr_y[i][j]);// xySum += arr_x[i][j] * arr_y[i][j];
  xySum+=arr_x[i][j]*Math.log(arr_y[i][j]);x2Sum+=arr_x[i][j]*arr_x[i][j];}}var n=arr_x.length*arr_x[0].length;var xMean=xSum/n;var yMean=ySum/n;var xyMean=xySum/n;var x2Mean=x2Sum/n;var m=(xyMean-xMean*yMean)/(x2Mean-xMean*xMean);var b=yMean-m*xMean;return [Math.exp(m),Math.exp(b)];};//已知的 y 值集合
  var data_known_y=arguments[0];var known_y=[];if(luckysheet.getObjType(data_known_y)=="array"){if(luckysheet.getObjType(data_known_y[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_y)){return luckysheet.formula.error.v;}known_y=luckysheet.func_methods.getDataDyadicArr(data_known_y);}else if(luckysheet.getObjType(data_known_y)=="object"&&data_known_y.startCell!=null){known_y=luckysheet.func_methods.getCellDataDyadicArr(data_known_y,"text");}else {if(!luckysheet.func_methods.isRealNum(data_known_y)){return luckysheet.formula.error.v;}var rowArr=[];rowArr.push(parseFloat(data_known_y));known_y.push(rowArr);}var known_y_rowlen=known_y.length;var known_y_collen=known_y[0].length;for(var i=0;i<known_y_rowlen;i++){for(var j=0;j<known_y_collen;j++){if(!luckysheet.func_methods.isRealNum(known_y[i][j])){return luckysheet.formula.error.v;}known_y[i][j]=parseFloat(known_y[i][j]);}}//可选 x 值集合
  var known_x=[];for(var i=1;i<=known_y_rowlen;i++){for(var j=1;j<=known_y_collen;j++){var number=(i-1)*known_y_collen+j;known_x.push(number);}}if(arguments.length>=2){var data_known_x=arguments[1];known_x=[];if(luckysheet.getObjType(data_known_x)=="array"){if(luckysheet.getObjType(data_known_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_known_x)){return luckysheet.formula.error.v;}known_x=luckysheet.func_methods.getDataDyadicArr(data_known_x);}else if(luckysheet.getObjType(data_known_x)=="object"&&data_known_x.startCell!=null){known_x=luckysheet.func_methods.getCellDataDyadicArr(data_known_x,"text");}else {if(!luckysheet.func_methods.isRealNum(data_known_x)){return luckysheet.formula.error.v;}var rowArr=[];rowArr.push(parseFloat(data_known_x));known_x.push(rowArr);}for(var i=0;i<known_x.length;i++){for(var j=0;j<known_x[0].length;j++){if(!luckysheet.func_methods.isRealNum(known_x[i][j])){return luckysheet.formula.error.v;}known_x[i][j]=parseFloat(known_x[i][j]);}}}var known_x_rowlen=known_x.length;var known_x_collen=known_x[0].length;//新 x 值
  var new_x=known_x;if(arguments.length>=3){var data_new_x=arguments[2];new_x=[];if(luckysheet.getObjType(data_new_x)=="array"){if(luckysheet.getObjType(data_new_x[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_new_x)){return luckysheet.formula.error.v;}new_x=luckysheet.func_methods.getDataDyadicArr(data_new_x);}else if(luckysheet.getObjType(data_new_x)=="object"&&data_new_x.startCell!=null){new_x=luckysheet.func_methods.getCellDataDyadicArr(data_new_x,"text");}else {if(!luckysheet.func_methods.isRealNum(data_new_x)){return luckysheet.formula.error.v;}var rowArr=[];rowArr.push(parseFloat(data_new_x));new_x.push(rowArr);}for(var i=0;i<new_x.length;i++){for(var j=0;j<new_x[0].length;j++){if(!luckysheet.func_methods.isRealNum(new_x[i][j])){return luckysheet.formula.error.v;}new_x[i][j]=parseFloat(new_x[i][j]);}}}//逻辑值
  var const_b=true;if(arguments.length==4){const_b=luckysheet.func_methods.getCellBoolen(arguments[3]);if(luckysheet.func_methods.valueIsError(const_b)){return const_b;}}if(known_y_rowlen!=known_x_rowlen||known_y_collen!=known_x_collen){return luckysheet.formula.error.r;}var ls=leastSquare(known_x,known_y);var m=ls[0];if(const_b){var b=ls[1];}else {var b=1;}var result=[];for(var i=0;i<new_x.length;i++){for(var j=0;j<new_x[i].length;j++){var x=new_x[i][j];var y=b*Math.pow(m,x);// var y = Math.exp(b + m * x);
  result.push(Math.round(y*1000000000)/1000000000);}}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LINEST":function LINEST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{return luckysheet.formula.error.v;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LOGEST":function LOGEST(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{return luckysheet.formula.error.v;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MDETERM":function MDETERM(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//计算
  var Ma=function Ma(a,n){var A;var b=new Array();if(n==1){A=a[0][0];return A;}else if(n==2){A=a[0][0]*a[1][1]-a[0][1]*a[1][0];return A;}else if(n==3){A=a[0][0]*a[1][1]*a[2][2]+a[1][0]*a[2][1]*a[0][2]+a[2][0]*a[0][1]*a[1][2]-a[2][0]*a[1][1]*a[0][2]-a[0][0]*a[2][1]*a[1][2]-a[1][0]*a[0][1]*a[2][2];return A;}else {A=0;var c=new Array();var e=new Array();for(var i=0;i<n;i++){b[i]=a[i][0]*Math.pow(-1,i+1+1);}for(var i=0;i<n;i++){e[i]=new Array();for(var j=0;j<n-1;j++){e[i][j]=a[i][j+1];}}for(var i=0;i<n;i++){for(var j=0;j<n;j++){c[j]=new Array();for(var k=0;k<n-1;k++){if(i>j){c[j][k]=e[j][k];}else if(i<j){c[j-1][k]=e[j][k];}}}A+=b[i]*arguments.callee(c,n-1);}return A;}};//数组
  var data_array=arguments[0];var array=[];if(luckysheet.getObjType(data_array)=="array"){if(luckysheet.getObjType(data_array[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array)){return luckysheet.formula.error.v;}array=luckysheet.func_methods.getDataDyadicArr(data_array);}else if(luckysheet.getObjType(data_array)=="object"&&data_array.startCell!=null){array=luckysheet.func_methods.getCellDataDyadicArr(data_array,"text");}else {var rowArr=[];rowArr.push(data_array);array.push(rowArr);}for(var i=0;i<array.length;i++){for(var j=0;j<array[i].length;j++){if(!luckysheet.func_methods.isRealNum(array[i][j])){return luckysheet.formula.error.v;}array[i][j]=parseFloat(array[i][j]);}}if(array.length!=array[0].length){return luckysheet.formula.error.v;}return Ma(array,array.length);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MINVERSE":function MINVERSE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数组
  var data_array=arguments[0];var array=[];if(luckysheet.getObjType(data_array)=="array"){if(luckysheet.getObjType(data_array[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array)){return luckysheet.formula.error.v;}array=luckysheet.func_methods.getDataDyadicArr(data_array);}else if(luckysheet.getObjType(data_array)=="object"&&data_array.startCell!=null){array=luckysheet.func_methods.getCellDataDyadicArr(data_array,"text");}else {var rowArr=[];rowArr.push(data_array);array.push(rowArr);}for(var i=0;i<array.length;i++){for(var j=0;j<array[i].length;j++){if(!luckysheet.func_methods.isRealNum(array[i][j])){return luckysheet.formula.error.v;}array[i][j]=parseFloat(array[i][j]);}}if(array.length!=array[0].length){return luckysheet.formula.error.v;}//计算
  return luckysheet.matrix_methods.inverse(array);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"MMULT":function MMULT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数组1
  var data_array1=arguments[0];var array1=[];if(luckysheet.getObjType(data_array1)=="array"){if(luckysheet.getObjType(data_array1[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array1)){return luckysheet.formula.error.v;}array1=luckysheet.func_methods.getDataDyadicArr(data_array1);}else if(luckysheet.getObjType(data_array1)=="object"&&data_array1.startCell!=null){array1=luckysheet.func_methods.getCellDataDyadicArr(data_array1,"text");}else {var rowArr=[];rowArr.push(data_array1);array1.push(rowArr);}for(var i=0;i<array1.length;i++){for(var j=0;j<array1[i].length;j++){if(!luckysheet.func_methods.isRealNum(array1[i][j])){return luckysheet.formula.error.v;}array1[i][j]=parseFloat(array1[i][j]);}}//数组2
  var data_array2=arguments[1];var array2=[];if(luckysheet.getObjType(data_array2)=="array"){if(luckysheet.getObjType(data_array2[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array2)){return luckysheet.formula.error.v;}array2=luckysheet.func_methods.getDataDyadicArr(data_array2);}else if(luckysheet.getObjType(data_array2)=="object"&&data_array2.startCell!=null){array2=luckysheet.func_methods.getCellDataDyadicArr(data_array2,"text");}else {var rowArr=[];rowArr.push(data_array2);array2.push(rowArr);}for(var i=0;i<array2.length;i++){for(var j=0;j<array2[i].length;j++){if(!luckysheet.func_methods.isRealNum(array2[i][j])){return luckysheet.formula.error.v;}array2[i][j]=parseFloat(array2[i][j]);}}//计算
  if(array1[0].length!=array2.length){return luckysheet.formula.error.v;}var rowlen=array1.length;var collen=array2[0].length;var result=[];for(var m=0;m<rowlen;m++){var rowArr=[];for(var n=0;n<collen;n++){var value=0;for(var p=0;p<array1[0].length;p++){value+=array1[m][p]*array2[p][n];}rowArr.push(value);}result.push(rowArr);}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SUMPRODUCT":function SUMPRODUCT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//第一个数组
  //数组1
  var data_array1=arguments[0];var array1=[];if(luckysheet.getObjType(data_array1)=="array"){if(luckysheet.getObjType(data_array1[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array1)){return luckysheet.formula.error.v;}array1=luckysheet.func_methods.getDataDyadicArr(data_array1);}else if(luckysheet.getObjType(data_array1)=="object"&&data_array1.startCell!=null){array1=luckysheet.func_methods.getCellDataDyadicArr(data_array1,"text");}else {var rowArr=[];rowArr.push(data_array1);array1.push(rowArr);}for(var i=0;i<array1.length;i++){for(var j=0;j<array1[i].length;j++){if(!luckysheet.func_methods.isRealNum(array1[i][j])){array1[i][j]=0;}else {array1[i][j]=parseFloat(array1[i][j]);}}}var rowlen=array1.length;var collen=array1[0].length;if(arguments.length>=2){for(var i=1;i<arguments.length;i++){var data=arguments[i];var arr=[];if(luckysheet.getObjType(data)=="array"){if(luckysheet.getObjType(data[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data)){return luckysheet.formula.error.v;}arr=luckysheet.func_methods.getDataDyadicArr(data);}else if(luckysheet.getObjType(data)=="object"&&data.startCell!=null){arr=luckysheet.func_methods.getCellDataDyadicArr(data,"text");}else {var rowArr=[];rowArr.push(data);arr.push(rowArr);}if(arr.length!=rowlen||arr[0].length!=collen){return luckysheet.formula.error.v;}for(var m=0;m<rowlen;m++){for(var n=0;n<collen;n++){if(!luckysheet.func_methods.isRealNum(arr[m][n])){array1[m][n]=0;}else {array1[m][n]=array1[m][n]*parseFloat(arr[m][n]);}}}}}var sum=0;for(var m=0;m<rowlen;m++){for(var n=0;n<collen;n++){sum+=array1[m][n];}}return sum;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISFORMULA":function ISFORMULA(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var data_cell=arguments[0];var cell;if(luckysheet.getObjType(data_cell)=="object"&&data_cell.startCell!=null){if(data_cell.data==null){return false;}if(luckysheet.getObjType(data_cell.data)=="array"){cell=data_cell.data[0][0];}else {cell=data_cell.data;}if(cell!=null&&cell.f!=null){return true;}else {return false;}}else {return luckysheet.formula.error.v;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"CELL":function CELL(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//单元格信息的类型
  var data_info_type=arguments[0];var info_type;if(luckysheet.getObjType(data_info_type)=="array"){if(luckysheet.getObjType(data_info_type[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_info_type)){return luckysheet.formula.error.v;}info_type=data_info_type[0][0];}else {info_type=data_info_type[0];}}else if(luckysheet.getObjType(data_info_type)=="object"&&data_info_type.startCell!=null){if(data_info_type.data==null){return luckysheet.formula.error.v;}else {if(luckysheet.getObjType(data_info_type.data)=="array"){return luckysheet.formula.error.v;}info_type=data_info_type.data.v;if(luckysheet.func_methods.isRealNull(info_type)){return luckysheet.formula.error.v;}}}else {info_type=data_info_type;}//单元格
  var data_reference=arguments[1];var reference;if(luckysheet.getObjType(data_reference)=="object"&&data_reference.startCell!=null){reference=data_reference.startCell;}else {return luckysheet.formula.error.v;}if(["address","col","color","contents","filename","format","parentheses","prefix","protect","row","type","width"].indexOf(info_type)==-1){return luckysheet.formula.error.v;}var file=luckysheet.getluckysheetfile()[luckysheet.sheetmanage.getSheetIndex(luckysheet.currentSheetIndex)];var cellrange=luckysheet.formula.getcellrange(reference);var row_index=cellrange.row[0];var col_index=cellrange.column[0];switch(info_type){case"address":return reference;break;case"col":return col_index+1;break;case"color":return 0;break;case"contents":if(luckysheet.flowdata[row_index][col_index]==null||luckysheet.flowdata[row_index][col_index].v==null||luckysheet.flowdata[row_index][col_index].v==""){return 0;}return luckysheet.flowdata[row_index][col_index].v;break;case"filename":return file.name;break;case"format":if(luckysheet.flowdata[row_index][col_index]==null||luckysheet.flowdata[row_index][col_index].ct==null){return "G";}return luckysheet.flowdata[row_index][col_index].ct.fa;break;case"parentheses":if(luckysheet.flowdata[row_index][col_index]==null||luckysheet.flowdata[row_index][col_index].v==null||luckysheet.flowdata[row_index][col_index].v==""){return 0;}if(luckysheet.flowdata[row_index][col_index].v>0){return 1;}else {return 0;}break;case"prefix":if(luckysheet.flowdata[row_index][col_index]==null||luckysheet.flowdata[row_index][col_index].ht==null||luckysheet.flowdata[row_index][col_index].v==null||luckysheet.flowdata[row_index][col_index].v==""){return "";}if(luckysheet.flowdata[row_index][col_index].ht==0){//居中对齐
  return "^";}else if(luckysheet.flowdata[row_index][col_index].ht==1){//左对齐
  return "'";}else if(luckysheet.flowdata[row_index][col_index].ht==2){//右对齐
  return '"';}else {return "";}break;case"protect":return 0;break;case"row":return row_index+1;break;case"type":if(luckysheet.flowdata[row_index][col_index]==null||luckysheet.flowdata[row_index][col_index].v==null||luckysheet.flowdata[row_index][col_index].v==""){return "b";}return "l";break;case"width":var cfg=file.config;if(cfg["columlen"]!=null&&col_index in cfg["columlen"]){return cfg["columlen"][col_index];}return luckysheet.defaultcollen;break;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"NA":function NA(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{return luckysheet.formula.error.na;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ERROR_TYPE":function ERROR_TYPE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//单元格
  var data_error_val=arguments[0];var error_val;if(luckysheet.getObjType(data_error_val)=="array"){if(luckysheet.getObjType(data_error_val[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_error_val)){return luckysheet.formula.error.v;}error_val=data_error_val[0][0];}else {error_val=data_error_val[0];}}else if(luckysheet.getObjType(data_error_val)=="object"&&data_error_val.startCell!=null){if(data_error_val.data==null){return luckysheet.formula.error.na;}if(luckysheet.getObjType(data_error_val.data)=="array"){error_val=data_error_val.data[0][0];if(error_val==null||luckysheet.func_methods.isRealNull(error_val.v)){return luckysheet.formula.error.na;}error_val=error_val.v;}else {if(luckysheet.func_methods.isRealNull(data_error_val.data.v)){return luckysheet.formula.error.na;}error_val=data_error_val.data.v;}}else {error_val=data_error_val;}var error_obj={"#NULL!":1,"#DIV/0!":2,"#VALUE!":3,"#REF!":4,"#NAME?":5,"#NUM!":6,"#N/A":7,"#GETTING_DATA":8};if(error_val in error_obj){return error_obj[error_val];}else {return luckysheet.formula.error.na;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISBLANK":function ISBLANK(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//单元格
  var data_error_val=arguments[0];var error_val;if(luckysheet.getObjType(data_error_val)=="object"&&data_error_val.startCell!=null){if(data_error_val.data==null){return true;}else {return false;}}else {return false;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISERR":function ISERR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//单元格
  var data_value=arguments[0];var value;if(luckysheet.getObjType(data_value)=="array"){if(luckysheet.getObjType(data_value[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_value)){return luckysheet.formula.error.v;}value=data_value[0][0];}else {value=data_value[0];}}else if(luckysheet.getObjType(data_value)=="object"&&data_value.startCell!=null){if(luckysheet.getObjType(data_value.data)=="array"){return true;}if(data_value.data==null||luckysheet.func_methods.isRealNull(data_value.data.v)){return false;}value=data_value.data.v;}else {value=data_value;}if(["#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"].indexOf(value)>-1){return true;}else {return false;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISERROR":function ISERROR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//单元格
  var data_value=arguments[0];var value;if(luckysheet.getObjType(data_value)=="array"){if(luckysheet.getObjType(data_value[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_value)){return luckysheet.formula.error.v;}value=data_value[0][0];}else {value=data_value[0];}}else if(luckysheet.getObjType(data_value)=="object"&&data_value.startCell!=null){if(luckysheet.getObjType(data_value.data)=="array"){return true;}if(data_value.data==null||luckysheet.func_methods.isRealNull(data_value.data.v)){return false;}value=data_value.data.v;}else {value=data_value;}if(["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"].indexOf(value)>-1){return true;}else {return false;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISLOGICAL":function ISLOGICAL(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//单元格
  var data_value=arguments[0];var value;if(luckysheet.getObjType(data_value)=="array"){if(luckysheet.getObjType(data_value[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_value)){return luckysheet.formula.error.v;}value=data_value[0][0];}else {value=data_value[0];}}else if(luckysheet.getObjType(data_value)=="object"&&data_value.startCell!=null){if(luckysheet.getObjType(data_value.data)=="array"){return false;}if(data_value.data==null||luckysheet.func_methods.isRealNull(data_value.data.v)){return false;}value=data_value.data.v;}else {value=data_value;}if(value.toString().toLowerCase()=="true"||value.toString().toLowerCase()=="false"){return true;}else {return false;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISNA":function ISNA(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//单元格
  var data_value=arguments[0];var value;if(luckysheet.getObjType(data_value)=="array"){if(luckysheet.getObjType(data_value[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_value)){return luckysheet.formula.error.v;}value=data_value[0][0];}else {value=data_value[0];}}else if(luckysheet.getObjType(data_value)=="object"&&data_value.startCell!=null){if(luckysheet.getObjType(data_value.data)=="array"){return false;}if(data_value.data==null||luckysheet.func_methods.isRealNull(data_value.data.v)){return false;}value=data_value.data.v;}else {value=data_value;}if(value.toString()=="#N/A"){return true;}else {return false;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISNONTEXT":function ISNONTEXT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//单元格
  var data_value=arguments[0];var value;if(luckysheet.getObjType(data_value)=="array"){if(luckysheet.getObjType(data_value[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_value)){return luckysheet.formula.error.v;}value=data_value[0][0];}else {value=data_value[0];}}else if(luckysheet.getObjType(data_value)=="object"&&data_value.startCell!=null){if(luckysheet.getObjType(data_value.data)=="array"){return true;}if(data_value.data==null||luckysheet.func_methods.isRealNull(data_value.data.v)){return true;}value=data_value.data.v;}else {value=data_value;}if(["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"].indexOf(value)>-1){return true;}else if(value.toString().toLowerCase()=="true"||value.toString().toLowerCase()=="false"){return true;}else if(luckysheet.func_methods.isRealNum(value)){return true;}else {return false;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISNUMBER":function ISNUMBER(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//单元格
  var data_value=arguments[0];var value;if(luckysheet.getObjType(data_value)=="array"){if(luckysheet.getObjType(data_value[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_value)){return luckysheet.formula.error.v;}value=data_value[0][0];}else {value=data_value[0];}}else if(luckysheet.getObjType(data_value)=="object"&&data_value.startCell!=null){if(luckysheet.getObjType(data_value.data)=="array"){return false;}if(data_value.data==null||luckysheet.func_methods.isRealNull(data_value.data.v)){return false;}value=data_value.data.v;}else {value=data_value;}if(luckysheet.func_methods.isRealNum(value)){return true;}else {return false;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISREF":function ISREF(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{if(luckysheet.getObjType(arguments[0])=="object"&&arguments[0].startCell!=null){return true;}else {return false;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"ISTEXT":function ISTEXT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//单元格
  var data_value=arguments[0];var value;if(luckysheet.getObjType(data_value)=="array"){if(luckysheet.getObjType(data_value[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_value)){return luckysheet.formula.error.v;}value=data_value[0][0];}else {value=data_value[0];}}else if(luckysheet.getObjType(data_value)=="object"&&data_value.startCell!=null){if(luckysheet.getObjType(data_value.data)=="array"){return false;}if(data_value.data==null||luckysheet.func_methods.isRealNull(data_value.data.v)){return false;}value=data_value.data.v;}else {value=data_value;}if(["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"].indexOf(value)>-1){return false;}else if(value.toString().toLowerCase()=="true"||value.toString().toLowerCase()=="false"){return false;}else if(luckysheet.func_methods.isRealNum(value)){return false;}else {return true;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TYPE":function TYPE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//单元格
  var data_value=arguments[0];var value;if(luckysheet.getObjType(data_value)=="array"){return 64;}else if(luckysheet.getObjType(data_value)=="object"&&data_value.startCell!=null){if(luckysheet.getObjType(data_value.data)=="array"){return 16;}if(data_value.data==null||luckysheet.func_methods.isRealNull(data_value.data.v)){return 1;}value=data_value.data.v;}else {value=data_value;}if(["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"].indexOf(value)>-1){return 16;}else if(value.toString().toLowerCase()=="true"||value.toString().toLowerCase()=="false"){return 4;}else if(luckysheet.func_methods.isRealNum(value)){return 1;}else {return 2;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"N":function N(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//单元格
  var data_value=arguments[0];var value;if(luckysheet.getObjType(data_value)=="array"){if(luckysheet.getObjType(data_value[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_value)){return luckysheet.formula.error.v;}value=data_value[0][0];}else {value=data_value[0];}}else if(luckysheet.getObjType(data_value)=="object"&&data_value.startCell!=null){if(luckysheet.getObjType(data_value.data)=="array"){value=data_value.data[0][0];if(value==null||luckysheet.func_methods.isRealNull(value.v)){return 0;}value=value.v;}else {if(data_value.data==null||luckysheet.func_methods.isRealNull(data_value.data.v)){return 0;}value=data_value.data.v;}}else {value=data_value;}if(["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"].indexOf(value)>-1){return value;}else if(value.toString().toLowerCase()=="true"||value.toString().toLowerCase()=="false"){if(value.toString().toLowerCase()=="true"){return 1;}else {return 0;}}else if(luckysheet.func_methods.isRealNum(value)){return parseFloat(value);}else {return 0;}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TO_DATE":function TO_DATE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数字
  var value=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value)){return value;}if(!luckysheet.func_methods.isRealNum(value)){return luckysheet.formula.error.v;}value=parseFloat(value);return luckysheet.mask.update("yyyy-mm-dd",value);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TO_PURE_NUMBER":function TO_PURE_NUMBER(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var value=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(value)){return value;}if(moment(value).isValid()){return luckysheet.mask.genarate(value)[2];}else {return numeral(value).value()==null?value:numeral(value).value();}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TO_TEXT":function TO_TEXT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var value=luckysheet.func_methods.getFirstValue(arguments[0],"text");if(luckysheet.func_methods.valueIsError(value)){return value;}return luckysheet.mask.update("@",value);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TO_DOLLARS":function TO_DOLLARS(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数字
  var value=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value)){return value;}if(!luckysheet.func_methods.isRealNum(value)){return luckysheet.formula.error.v;}value=parseFloat(value);return luckysheet.mask.update("$ 0.00",value);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TO_PERCENT":function TO_PERCENT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数字
  var value=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(value)){return value;}if(!luckysheet.func_methods.isRealNum(value)){return luckysheet.formula.error.v;}value=parseFloat(value);return luckysheet.mask.update("0%",value);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DGET":function DGET(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数据库的单元格区域
  var data_database=arguments[0];var database=[];if(luckysheet.getObjType(data_database)=="object"&&data_database.startCell!=null){if(data_database.data==null){return luckysheet.formula.error.v;}database=luckysheet.func_methods.getCellDataDyadicArr(data_database,"text");}else {return luckysheet.formula.error.v;}//列
  var field=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(field)){return field;}if(luckysheet.func_methods.isRealNull(field)){return luckysheet.formula.error.v;}//条件的单元格区域
  var data_criteria=arguments[2];var criteria=[];if(luckysheet.getObjType(data_criteria)=="object"&&data_criteria.startCell!=null){if(data_criteria.data==null){return luckysheet.formula.error.v;}criteria=luckysheet.func_methods.getCellDataDyadicArr(data_criteria,"text");}else {return luckysheet.formula.error.v;}if(!luckysheet.func_methods.isRealNum(field)&&luckysheet.getObjType(field)!=="string"){return luckysheet.formula.error.v;}var resultIndexes=luckysheet.func_methods.findResultIndex(database,criteria);var targetFields=[];if(luckysheet.getObjType(field)==="string"){var index=luckysheet.func_methods.findField(database,field);targetFields=luckysheet.func_methods.rest(database[index]);}else {targetFields=luckysheet.func_methods.rest(database[field]);}if(resultIndexes.length===0){return luckysheet.formula.error.v;}if(resultIndexes.length>1){return luckysheet.formula.error.nm;}return targetFields[resultIndexes[0]];}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DMAX":function DMAX(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数据库的单元格区域
  var data_database=arguments[0];var database=[];if(luckysheet.getObjType(data_database)=="object"&&data_database.startCell!=null){if(data_database.data==null){return luckysheet.formula.error.v;}database=luckysheet.func_methods.getCellDataDyadicArr(data_database,"text");}else {return luckysheet.formula.error.v;}//列
  var field=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(field)){return field;}if(luckysheet.func_methods.isRealNull(field)){return luckysheet.formula.error.v;}//条件的单元格区域
  var data_criteria=arguments[2];var criteria=[];if(luckysheet.getObjType(data_criteria)=="object"&&data_criteria.startCell!=null){if(data_criteria.data==null){return luckysheet.formula.error.v;}criteria=luckysheet.func_methods.getCellDataDyadicArr(data_criteria,"text");}else {return luckysheet.formula.error.v;}if(!luckysheet.func_methods.isRealNum(field)&&luckysheet.getObjType(field)!=="string"){return luckysheet.formula.error.v;}var resultIndexes=luckysheet.func_methods.findResultIndex(database,criteria);var targetFields=[];if(luckysheet.getObjType(field)==="string"){var index=luckysheet.func_methods.findField(database,field);targetFields=luckysheet.func_methods.rest(database[index]);}else {targetFields=luckysheet.func_methods.rest(database[field]);}var maxValue=targetFields[resultIndexes[0]];for(var i=1;i<resultIndexes.length;i++){if(maxValue<targetFields[resultIndexes[i]]){maxValue=targetFields[resultIndexes[i]];}}return maxValue;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DMIN":function DMIN(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数据库的单元格区域
  var data_database=arguments[0];var database=[];if(luckysheet.getObjType(data_database)=="object"&&data_database.startCell!=null){if(data_database.data==null){return luckysheet.formula.error.v;}database=luckysheet.func_methods.getCellDataDyadicArr(data_database,"text");}else {return luckysheet.formula.error.v;}//列
  var field=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(field)){return field;}if(luckysheet.func_methods.isRealNull(field)){return luckysheet.formula.error.v;}//条件的单元格区域
  var data_criteria=arguments[2];var criteria=[];if(luckysheet.getObjType(data_criteria)=="object"&&data_criteria.startCell!=null){if(data_criteria.data==null){return luckysheet.formula.error.v;}criteria=luckysheet.func_methods.getCellDataDyadicArr(data_criteria,"text");}else {return luckysheet.formula.error.v;}if(!luckysheet.func_methods.isRealNum(field)&&luckysheet.getObjType(field)!=="string"){return luckysheet.formula.error.v;}var resultIndexes=findResultIndex(database,criteria);var targetFields=[];if(luckysheet.getObjType(field)==="string"){var index=findField(database,field);targetFields=rest(database[index]);}else {targetFields=rest(database[field]);}var minValue=targetFields[resultIndexes[0]];for(var i=1;i<resultIndexes.length;i++){if(minValue>targetFields[resultIndexes[i]]){minValue=targetFields[resultIndexes[i]];}}return minValue;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DAVERAGE":function DAVERAGE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数据库的单元格区域
  var data_database=arguments[0];var database=[];if(luckysheet.getObjType(data_database)=="object"&&data_database.startCell!=null){if(data_database.data==null){return luckysheet.formula.error.v;}database=luckysheet.func_methods.getCellDataDyadicArr(data_database,"text");}else {return luckysheet.formula.error.v;}//列
  var field=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(field)){return field;}if(luckysheet.func_methods.isRealNull(field)){return luckysheet.formula.error.v;}//条件的单元格区域
  var data_criteria=arguments[2];var criteria=[];if(luckysheet.getObjType(data_criteria)=="object"&&data_criteria.startCell!=null){if(data_criteria.data==null){return luckysheet.formula.error.v;}criteria=luckysheet.func_methods.getCellDataDyadicArr(data_criteria,"text");}else {return luckysheet.formula.error.v;}if(!luckysheet.func_methods.isRealNum(field)&&luckysheet.getObjType(field)!=="string"){return luckysheet.formula.error.v;}var resultIndexes=luckysheet.func_methods.findResultIndex(database,criteria);var targetFields=[];if(luckysheet.getObjType(field)==="string"){var index=luckysheet.func_methods.findField(database,field);targetFields=luckysheet.func_methods.rest(database[index]);}else {targetFields=luckysheet.func_methods.rest(database[field]);}var sum=0;for(var i=0;i<resultIndexes.length;i++){sum+=targetFields[resultIndexes[i]];}return resultIndexes.length===0?luckysheet.formula.error.d:sum/resultIndexes.length;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DCOUNT":function DCOUNT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数据库的单元格区域
  var data_database=arguments[0];var database=[];if(luckysheet.getObjType(data_database)=="object"&&data_database.startCell!=null){if(data_database.data==null){return luckysheet.formula.error.v;}database=luckysheet.func_methods.getCellDataDyadicArr(data_database,"text");}else {return luckysheet.formula.error.v;}//列
  var field=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(field)){return field;}if(luckysheet.func_methods.isRealNull(field)){return luckysheet.formula.error.v;}//条件的单元格区域
  var data_criteria=arguments[2];var criteria=[];if(luckysheet.getObjType(data_criteria)=="object"&&data_criteria.startCell!=null){if(data_criteria.data==null){return luckysheet.formula.error.v;}criteria=luckysheet.func_methods.getCellDataDyadicArr(data_criteria,"text");}else {return luckysheet.formula.error.v;}if(!luckysheet.func_methods.isRealNum(field)&&luckysheet.getObjType(field)!=="string"){return luckysheet.formula.error.v;}var resultIndexes=luckysheet.func_methods.findResultIndex(database,criteria);var targetFields=[];if(luckysheet.getObjType(field)==="string"){var index=luckysheet.func_methods.findField(database,field);targetFields=luckysheet.func_methods.rest(database[index]);}else {targetFields=luckysheet.func_methods.rest(database[field]);}var targetValues=[];for(var i=0;i<resultIndexes.length;i++){targetValues[i]=targetFields[resultIndexes[i]];}return window.luckysheet_function.COUNT.f.apply(window.luckysheet_function.COUNT,targetValues);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DCOUNTA":function DCOUNTA(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数据库的单元格区域
  var data_database=arguments[0];var database=[];if(luckysheet.getObjType(data_database)=="object"&&data_database.startCell!=null){if(data_database.data==null){return luckysheet.formula.error.v;}database=luckysheet.func_methods.getCellDataDyadicArr(data_database,"text");}else {return luckysheet.formula.error.v;}//列
  var field=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(field)){return field;}if(luckysheet.func_methods.isRealNull(field)){return luckysheet.formula.error.v;}//条件的单元格区域
  var data_criteria=arguments[2];var criteria=[];if(luckysheet.getObjType(data_criteria)=="object"&&data_criteria.startCell!=null){if(data_criteria.data==null){return luckysheet.formula.error.v;}criteria=luckysheet.func_methods.getCellDataDyadicArr(data_criteria,"text");}else {return luckysheet.formula.error.v;}if(!luckysheet.func_methods.isRealNum(field)&&luckysheet.getObjType(field)!=="string"){return luckysheet.formula.error.v;}var resultIndexes=luckysheet.func_methods.findResultIndex(database,criteria);var targetFields=[];if(luckysheet.getObjType(field)==="string"){var index=luckysheet.func_methods.findField(database,field);targetFields=luckysheet.func_methods.rest(database[index]);}else {targetFields=luckysheet.func_methods.rest(database[field]);}var targetValues=[];for(var i=0;i<resultIndexes.length;i++){targetValues[i]=targetFields[resultIndexes[i]];}return window.luckysheet_function.COUNTA.f.apply(window.luckysheet_function.COUNTA,targetValues);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DPRODUCT":function DPRODUCT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数据库的单元格区域
  var data_database=arguments[0];var database=[];if(luckysheet.getObjType(data_database)=="object"&&data_database.startCell!=null){if(data_database.data==null){return luckysheet.formula.error.v;}database=luckysheet.func_methods.getCellDataDyadicArr(data_database,"text");}else {return luckysheet.formula.error.v;}//列
  var field=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(field)){return field;}if(luckysheet.func_methods.isRealNull(field)){return luckysheet.formula.error.v;}//条件的单元格区域
  var data_criteria=arguments[2];var criteria=[];if(luckysheet.getObjType(data_criteria)=="object"&&data_criteria.startCell!=null){if(data_criteria.data==null){return luckysheet.formula.error.v;}criteria=luckysheet.func_methods.getCellDataDyadicArr(data_criteria,"text");}else {return luckysheet.formula.error.v;}if(!luckysheet.func_methods.isRealNum(field)&&luckysheet.getObjType(field)!=="string"){return luckysheet.formula.error.v;}var resultIndexes=luckysheet.func_methods.findResultIndex(database,criteria);var targetFields=[];if(luckysheet.getObjType(field)==="string"){var index=luckysheet.func_methods.findField(database,field);targetFields=luckysheet.func_methods.rest(database[index]);}else {targetFields=luckysheet.func_methods.rest(database[field]);}var targetValues=[];for(var i=0;i<resultIndexes.length;i++){targetValues[i]=targetFields[resultIndexes[i]];}targetValues=luckysheet.func_methods.compact(targetValues);var result=1;for(i=0;i<targetValues.length;i++){result*=targetValues[i];}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DSTDEV":function DSTDEV(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数据库的单元格区域
  var data_database=arguments[0];var database=[];if(luckysheet.getObjType(data_database)=="object"&&data_database.startCell!=null){if(data_database.data==null){return luckysheet.formula.error.v;}database=luckysheet.func_methods.getCellDataDyadicArr(data_database,"text");}else {return luckysheet.formula.error.v;}//列
  var field=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(field)){return field;}if(luckysheet.func_methods.isRealNull(field)){return luckysheet.formula.error.v;}//条件的单元格区域
  var data_criteria=arguments[2];var criteria=[];if(luckysheet.getObjType(data_criteria)=="object"&&data_criteria.startCell!=null){if(data_criteria.data==null){return luckysheet.formula.error.v;}criteria=luckysheet.func_methods.getCellDataDyadicArr(data_criteria,"text");}else {return luckysheet.formula.error.v;}if(!luckysheet.func_methods.isRealNum(field)&&luckysheet.getObjType(field)!=="string"){return luckysheet.formula.error.v;}var resultIndexes=luckysheet.func_methods.findResultIndex(database,criteria);var targetFields=[];if(luckysheet.getObjType(field)==="string"){var index=luckysheet.func_methods.findField(database,field);targetFields=luckysheet.func_methods.rest(database[index]);}else {targetFields=luckysheet.func_methods.rest(database[field]);}var targetValues=[];for(var i=0;i<resultIndexes.length;i++){targetValues[i]=targetFields[resultIndexes[i]];}targetValues=luckysheet.func_methods.compact(targetValues);return window.luckysheet_function.STDEVA.f.apply(window.luckysheet_function.STDEVA,targetValues);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DSTDEVP":function DSTDEVP(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数据库的单元格区域
  var data_database=arguments[0];var database=[];if(luckysheet.getObjType(data_database)=="object"&&data_database.startCell!=null){if(data_database.data==null){return luckysheet.formula.error.v;}database=luckysheet.func_methods.getCellDataDyadicArr(data_database,"text");}else {return luckysheet.formula.error.v;}//列
  var field=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(field)){return field;}if(luckysheet.func_methods.isRealNull(field)){return luckysheet.formula.error.v;}//条件的单元格区域
  var data_criteria=arguments[2];var criteria=[];if(luckysheet.getObjType(data_criteria)=="object"&&data_criteria.startCell!=null){if(data_criteria.data==null){return luckysheet.formula.error.v;}criteria=luckysheet.func_methods.getCellDataDyadicArr(data_criteria,"text");}else {return luckysheet.formula.error.v;}if(!luckysheet.func_methods.isRealNum(field)&&luckysheet.getObjType(field)!=="string"){return luckysheet.formula.error.v;}var resultIndexes=luckysheet.func_methods.findResultIndex(database,criteria);var targetFields=[];if(luckysheet.getObjType(field)==="string"){var index=luckysheet.func_methods.findField(database,field);targetFields=luckysheet.func_methods.rest(database[index]);}else {targetFields=luckysheet.func_methods.rest(database[field]);}var targetValues=[];for(var i=0;i<resultIndexes.length;i++){targetValues[i]=targetFields[resultIndexes[i]];}targetValues=luckysheet.func_methods.compact(targetValues);return window.luckysheet_function.STDEVP.f.apply(window.luckysheet_function.STDEVP,targetValues);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DSUM":function DSUM(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数据库的单元格区域
  var data_database=arguments[0];var database=[];if(luckysheet.getObjType(data_database)=="object"&&data_database.startCell!=null){if(data_database.data==null){return luckysheet.formula.error.v;}database=luckysheet.func_methods.getCellDataDyadicArr(data_database,"text");}else {return luckysheet.formula.error.v;}//列
  var field=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(field)){return field;}if(luckysheet.func_methods.isRealNull(field)){return luckysheet.formula.error.v;}//条件的单元格区域
  var data_criteria=arguments[2];var criteria=[];if(luckysheet.getObjType(data_criteria)=="object"&&data_criteria.startCell!=null){if(data_criteria.data==null){return luckysheet.formula.error.v;}criteria=luckysheet.func_methods.getCellDataDyadicArr(data_criteria,"text");}else {return luckysheet.formula.error.v;}if(!luckysheet.func_methods.isRealNum(field)&&luckysheet.getObjType(field)!=="string"){return luckysheet.formula.error.v;}var resultIndexes=luckysheet.func_methods.findResultIndex(database,criteria);var targetFields=[];if(luckysheet.getObjType(field)==="string"){var index=luckysheet.func_methods.findField(database,field);targetFields=luckysheet.func_methods.rest(database[index]);}else {targetFields=luckysheet.func_methods.rest(database[field]);}var targetValues=[];for(var i=0;i<resultIndexes.length;i++){targetValues[i]=targetFields[resultIndexes[i]];}targetValues=luckysheet.func_methods.compact(targetValues);var result=0;for(i=0;i<targetValues.length;i++){result+=targetValues[i];}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DVAR":function DVAR(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数据库的单元格区域
  var data_database=arguments[0];var database=[];if(luckysheet.getObjType(data_database)=="object"&&data_database.startCell!=null){if(data_database.data==null){return luckysheet.formula.error.v;}database=luckysheet.func_methods.getCellDataDyadicArr(data_database,"text");}else {return luckysheet.formula.error.v;}//列
  var field=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(field)){return field;}if(luckysheet.func_methods.isRealNull(field)){return luckysheet.formula.error.v;}//条件的单元格区域
  var data_criteria=arguments[2];var criteria=[];if(luckysheet.getObjType(data_criteria)=="object"&&data_criteria.startCell!=null){if(data_criteria.data==null){return luckysheet.formula.error.v;}criteria=luckysheet.func_methods.getCellDataDyadicArr(data_criteria,"text");}else {return luckysheet.formula.error.v;}if(!luckysheet.func_methods.isRealNum(field)&&luckysheet.getObjType(field)!=="string"){return luckysheet.formula.error.v;}var resultIndexes=luckysheet.func_methods.findResultIndex(database,criteria);var targetFields=[];if(luckysheet.getObjType(field)==="string"){var index=luckysheet.func_methods.findField(database,field);targetFields=luckysheet.func_methods.rest(database[index]);}else {targetFields=luckysheet.func_methods.rest(database[field]);}var targetValues=[];for(var i=0;i<resultIndexes.length;i++){targetValues[i]=targetFields[resultIndexes[i]];}targetValues=luckysheet.func_methods.compact(targetValues);return window.luckysheet_function.VAR_S.f.apply(window.luckysheet_function.VAR_S,targetValues);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DVARP":function DVARP(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//数据库的单元格区域
  var data_database=arguments[0];var database=[];if(luckysheet.getObjType(data_database)=="object"&&data_database.startCell!=null){if(data_database.data==null){return luckysheet.formula.error.v;}database=luckysheet.func_methods.getCellDataDyadicArr(data_database,"text");}else {return luckysheet.formula.error.v;}//列
  var field=luckysheet.func_methods.getFirstValue(arguments[1],"text");if(luckysheet.func_methods.valueIsError(field)){return field;}if(luckysheet.func_methods.isRealNull(field)){return luckysheet.formula.error.v;}//条件的单元格区域
  var data_criteria=arguments[2];var criteria=[];if(luckysheet.getObjType(data_criteria)=="object"&&data_criteria.startCell!=null){if(data_criteria.data==null){return luckysheet.formula.error.v;}criteria=luckysheet.func_methods.getCellDataDyadicArr(data_criteria,"text");}else {return luckysheet.formula.error.v;}if(!luckysheet.func_methods.isRealNum(field)&&luckysheet.getObjType(field)!=="string"){return luckysheet.formula.error.v;}var resultIndexes=luckysheet.func_methods.findResultIndex(database,criteria);var targetFields=[];if(luckysheet.getObjType(field)==="string"){var index=luckysheet.func_methods.findField(database,field);targetFields=luckysheet.func_methods.rest(database[index]);}else {targetFields=luckysheet.func_methods.rest(database[field]);}var targetValues=[];for(var i=0;i<resultIndexes.length;i++){targetValues[i]=targetFields[resultIndexes[i]];}targetValues=luckysheet.func_methods.compact(targetValues);return window.luckysheet_function.VAR_P.f.apply(window.luckysheet_function.VAR_P,targetValues);}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"LINESPLINES":function LINESPLINES(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//色表，接下来会用到
  var colorList=luckysheet.formula.colorList;var rangeValue=arguments[0];var lineColor=arguments[1];var lineWidth=arguments[2];var normalValue=arguments[3];var normalColor=arguments[4];var maxSpot=arguments[5];var minSpot=arguments[6];var spotRadius=arguments[7];//定义需要格式化data数据
  var dataformat=luckysheet.formula.readCellDataToOneArray(rangeValue);//在下面获得该单元格的长度和宽度,同时考虑了合并单元格问题
  var cellSize=luckysheet.menuButton.getCellRealSize(luckysheet.flowdata,cell_r,cell_c);var width=cellSize[0];var height=cellSize[1];//开始进行sparklines的详细设置，宽和高为单元格的宽高。
  var sparksetting={};if(lineWidth==null){lineWidth=1;}sparksetting["lineWidth"]=lineWidth;//设置sparklines图表的宽高，线图的高会随着粗细而超出单元格高度，所以减去一个量，设置offsetY或者offsetX为渲染偏移量，传给luckysheetDrawMain使用。默认为0。=LINESPLINES(D9:E24,3,5)
  sparksetting["offsetY"]=lineWidth+1;sparksetting.height=height-(lineWidth+1);sparksetting.width=width;//定义sparklines的通用色彩设置函数，可以设置 色表【colorList】索引数值 或者 具体颜色值
  var sparkColorSetting=function sparkColorSetting(attr,value){if(!!value){if(typeof value=="number"){if(value>19){value=value%20;}value=colorList[value];}sparksetting[attr]=value;}};if(lineColor==null){lineColor="#2ec7c9";}sparkColorSetting("lineColor",lineColor);//sparkColorSetting("fillColor", fillColor);
  sparksetting["fillColor"]=0;//设置辅助线，可以支持min、max、avg、median等几个字符变量，或者具体的数值。
  if(!!normalValue){if(typeof normalValue=="string"){normalValue=normalValue.toLowerCase();var nv=null;if(normalValue=="min"){nv=window.luckysheet_function.MIN.f({"data":dataformat});}else if(normalValue=="max"){nv=window.luckysheet_function.MAX.f({"data":dataformat});}else if(normalValue=="avg"||normalValue=="mean"){nv=window.luckysheet_function.AVERAGE.f({"data":dataformat});}else if(normalValue=="median"){nv=window.luckysheet_function.MEDIAN.f({"data":dataformat});}if(!!nv){sparksetting["normalRangeMin"]=nv;sparksetting["normalRangeMax"]=nv;}}else {sparksetting["normalRangeMin"]=normalValue;sparksetting["normalRangeMax"]=normalValue;}}if(normalColor==null){normalColor="#000";}sparkColorSetting("normalRangeColor",normalColor);sparkColorSetting("maxSpotColor",maxSpot);sparkColorSetting("minSpotColor",minSpot);if(spotRadius==null){spotRadius="1.5";}sparksetting["spotRadius"]=spotRadius;var temp1=luckysheet.sparkline.init(dataformat,sparksetting);return temp1;// { 
  //     height:rowlen,
  //     width:firstcolumlen,
  //     normalRangeMin:6,
  //     normalRangeMax:6,
  //     normalRangeColor:"#000" 
  // }
  //return "";
  }catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"AREASPLINES":function AREASPLINES(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//色表，接下来会用到
  var colorList=luckysheet.formula.colorList;var rangeValue=arguments[0];var lineColor=arguments[1];var fillColor=arguments[2];var lineWidth=arguments[3];var normalValue=arguments[4];var normalColor=arguments[5];// var maxSpot = arguments[5];
  // var minSpot = arguments[6];
  // var spotRadius = arguments[7];
  //定义需要格式化data数据
  var dataformat=luckysheet.formula.readCellDataToOneArray(rangeValue);//在下面获得该单元格的长度和宽度,同时考虑了合并单元格问题
  var cellSize=luckysheet.menuButton.getCellRealSize(luckysheet.flowdata,cell_r,cell_c);var width=cellSize[0];var height=cellSize[1];//开始进行sparklines的详细设置，宽和高为单元格的宽高。
  var sparksetting={};if(lineWidth==null){lineWidth=1;}sparksetting["lineWidth"]=lineWidth;//设置sparklines图表的宽高，线图的高会随着粗细而超出单元格高度，所以减去一个量，设置offsetY或者offsetX为渲染偏移量，传给luckysheetDrawMain使用。默认为0。=LINESPLINES(D9:E24,3,5)
  sparksetting["offsetY"]=lineWidth+1;sparksetting.height=height-(lineWidth+1);sparksetting.width=width;//定义sparklines的通用色彩设置函数，可以设置 色表【colorList】索引数值 或者 具体颜色值
  var sparkColorSetting=function sparkColorSetting(attr,value){if(!!value){if(typeof value=="number"){if(value>19){value=value%20;}value=colorList[value];}sparksetting[attr]=value;}};if(lineColor==null){lineColor="#2ec7c9";}sparkColorSetting("lineColor",lineColor);sparkColorSetting("fillColor",fillColor);// sparksetting["fillColor"] = 0;
  if(lineWidth==null){lineWidth="1";}sparksetting["lineWidth"]=lineWidth;//设置辅助线，可以支持min、max、avg、median等几个字符变量，或者具体的数值。
  if(!!normalValue){if(typeof normalValue=="string"){normalValue=normalValue.toLowerCase();var nv=null;if(normalValue=="min"){nv=window.luckysheet_function.MIN.f({"data":dataformat});}else if(normalValue=="max"){nv=window.luckysheet_function.MAX.f({"data":dataformat});}else if(normalValue=="avg"||normalValue=="mean"){nv=window.luckysheet_function.AVERAGE.f({"data":dataformat});}else if(normalValue=="median"){nv=window.luckysheet_function.MEDIAN.f({"data":dataformat});}if(!!nv){sparksetting["normalRangeMin"]=nv;sparksetting["normalRangeMax"]=nv;}}else {sparksetting["normalRangeMin"]=normalValue;sparksetting["normalRangeMax"]=normalValue;}}if(normalColor==null){normalColor="#000";}sparkColorSetting("normalRangeColor",normalColor);// sparkColorSetting("maxSpotColor", maxSpot);
  // sparkColorSetting("minSpotColor", minSpot);
  // if(spotRadius==null){
  //     spotRadius = "1.5";
  // }
  // sparksetting["spotRadius"] = spotRadius;
  var temp1=luckysheet.sparkline.init(dataformat,sparksetting);return temp1;// { 
  //     height:rowlen,
  //     width:firstcolumlen,
  //     normalRangeMin:6,
  //     normalRangeMax:6,
  //     normalRangeColor:"#000" 
  // }
  //return "";
  }catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"COLUMNSPLINES":function COLUMNSPLINES(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//色表，接下来会用到
  var colorList=luckysheet.formula.colorList;var rangeValue=arguments[0];//定义需要格式化data数据
  var dataformat=luckysheet.formula.readCellDataToOneArray(rangeValue);//在下面获得该单元格的长度和宽度,同时考虑了合并单元格问题
  var cellSize=luckysheet.menuButton.getCellRealSize(luckysheet.flowdata,cell_r,cell_c);var width=cellSize[0];var height=cellSize[1];//开始进行sparklines的详细设置，宽和高为单元格的宽高。
  var sparksetting={};//设置sparklines图表的宽高，线图的高会随着粗细而超出单元格高度，所以减去一个量，设置offsetY或者offsetX为渲染偏移量，传给luckysheetDrawMain使用。默认为0。=LINESPLINES(D9:E24,3,5)
  sparksetting.height=height;sparksetting.width=width;//定义sparklines的通用色彩设置函数，可以设置 色表【colorList】索引数值 或者 具体颜色值
  var sparkColorSetting=function sparkColorSetting(attr,value){if(!!value){if(typeof value=="number"){if(value>19){value=value%20;}value=colorList[value];}sparksetting[attr]=value;}};var barSpacing=arguments[1];var barColor=arguments[2];var negBarColor=arguments[3];var chartRangeMax=arguments[4];////具体实现
  sparksetting["type"]="column";if(barSpacing==null){barSpacing="1";}sparksetting["barSpacing"]=barSpacing;if(barColor==null){barColor="#fc5c5c";}sparkColorSetting("barColor",barColor);if(negBarColor==null){negBarColor="#97b552";}sparkColorSetting("negBarColor",negBarColor);if(chartRangeMax==null||chartRangeMax===false||typeof chartRangeMax!="number"){sparksetting["chartRangeMax"]=undefined;}else {sparksetting["chartRangeMax"]=chartRangeMax;}var colorLists=luckysheet.formula.sparklinesColorMap(arguments);if(!!colorLists){sparksetting["colorMap"]=colorLists;}////具体实现
  var temp1=luckysheet.sparkline.init(dataformat,sparksetting);return temp1;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"STACKCOLUMNSPLINES":function STACKCOLUMNSPLINES(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//色表，接下来会用到
  var colorList=luckysheet.formula.colorList;var rangeValue=arguments[0];//定义需要格式化data数据
  //var dataformat = luckysheet.formula.readCellDataToOneArray(rangeValue);
  var dataformat=[];var data=[];if(rangeValue!=null&&rangeValue.data!=null){data=rangeValue.data;}if(luckysheet.getObjType(data)=="array"){data=luckysheet.formula.getPureValueByData(data);}else if(luckysheet.getObjType(data)=="object"){data=data.v;return [data];}else {if(/\{.*?\}/.test(data)){data=data.replace(/\{/g,"[").replace(/\}/g,"]");}data=eval('('+data+')');}var stackconfig=arguments[1];var offsetY=data.length;if(stackconfig==null||!!stackconfig){for(var c=0;c<data[0].length;c++){var colstr="";for(var r=0;r<data.length;r++){colstr+=data[r][c]+":";}colstr=colstr.substr(0,colstr.length-1);dataformat.push(colstr);}}else {for(var r=0;r<data.length;r++){var rowstr="";for(var c=0;c<data[0].length;c++){rowstr+=data[r][c]+":";}rowstr=rowstr.substr(0,rowstr.length-1);dataformat.push(rowstr);}var offsetY=data[0].length;}//在下面获得该单元格的长度和宽度,同时考虑了合并单元格问题
  var cellSize=luckysheet.menuButton.getCellRealSize(luckysheet.flowdata,cell_r,cell_c);var width=cellSize[0];var height=cellSize[1];//开始进行sparklines的详细设置，宽和高为单元格的宽高。
  var sparksetting={};//设置sparklines图表的宽高，线图的高会随着粗细而超出单元格高度，所以减去一个量，设置offsetY或者offsetX为渲染偏移量，传给luckysheetDrawMain使用。默认为0。=LINESPLINES(D9:E24,3,5)
  sparksetting.height=height;sparksetting.width=width;//sparksetting.offsetY = offsetY;
  //定义sparklines的通用色彩设置函数，可以设置 色表【colorList】索引数值 或者 具体颜色值
  var sparkColorSetting=function sparkColorSetting(attr,value){if(!!value){if(typeof value=="number"){if(value>19){value=value%20;}value=colorList[value];}sparksetting[attr]=value;}};var barSpacing=arguments[2];var chartRangeMax=arguments[3];////具体实现
  sparksetting["type"]="column";if(barSpacing==null){barSpacing="1";}sparksetting["barSpacing"]=barSpacing;if(chartRangeMax==null||chartRangeMax===false||typeof chartRangeMax!="number"){sparksetting["chartRangeMax"]=undefined;}else {sparksetting["chartRangeMax"]=chartRangeMax;}var colorLists=luckysheet.formula.sparklinesColorMap(arguments,4);if(!!colorLists){sparksetting["colorMap"]=colorLists;}////具体实现
  var temp1=luckysheet.sparkline.init(dataformat,sparksetting);return temp1;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"BARSPLINES":function BARSPLINES(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//色表，接下来会用到
  var colorList=luckysheet.formula.colorList;var rangeValue=arguments[0];//定义需要格式化data数据
  var dataformat=luckysheet.formula.readCellDataToOneArray(rangeValue);//在下面获得该单元格的长度和宽度,同时考虑了合并单元格问题
  var cellSize=luckysheet.menuButton.getCellRealSize(luckysheet.flowdata,cell_r,cell_c);var width=cellSize[0];var height=cellSize[1];//开始进行sparklines的详细设置，宽和高为单元格的宽高。
  var sparksetting={};//设置sparklines图表的宽高，线图的高会随着粗细而超出单元格高度，所以减去一个量，设置offsetY或者offsetX为渲染偏移量，传给luckysheetDrawMain使用。默认为0。=LINESPLINES(D9:E24,3,5)
  sparksetting.height=height;sparksetting.width=width;//定义sparklines的通用色彩设置函数，可以设置 色表【colorList】索引数值 或者 具体颜色值
  var sparkColorSetting=function sparkColorSetting(attr,value){if(!!value){if(typeof value=="number"){if(value>19){value=value%20;}value=colorList[value];}sparksetting[attr]=value;}};var barSpacing=arguments[1];var barColor=arguments[2];var negBarColor=arguments[3];var chartRangeMax=arguments[4];////具体实现
  sparksetting["type"]="bar";if(barSpacing==null){barSpacing="1";}sparksetting["barSpacing"]=barSpacing;if(barColor==null){barColor="#fc5c5c";}sparkColorSetting("barColor",barColor);if(negBarColor==null){negBarColor="#97b552";}sparkColorSetting("negBarColor",negBarColor);if(chartRangeMax==null||chartRangeMax===false||typeof chartRangeMax!="number"){sparksetting["chartRangeMax"]=undefined;}else {sparksetting["chartRangeMax"]=chartRangeMax;}var colorLists=luckysheet.formula.sparklinesColorMap(arguments);if(!!colorLists){sparksetting["colorMap"]=colorLists;}////具体实现
  var temp1=luckysheet.sparkline.init(dataformat,sparksetting);return temp1;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"STACKBARSPLINES":function STACKBARSPLINES(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//色表，接下来会用到
  var colorList=luckysheet.formula.colorList;var rangeValue=arguments[0];//定义需要格式化data数据
  //var dataformat = luckysheet.formula.readCellDataToOneArray(rangeValue);
  var dataformat=[];var data=[];if(rangeValue!=null&&rangeValue.data!=null){data=rangeValue.data;}if(luckysheet.getObjType(data)=="array"){data=luckysheet.formula.getPureValueByData(data);}else if(luckysheet.getObjType(data)=="object"){data=data.v;return [data];}else {if(/\{.*?\}/.test(data)){data=data.replace(/\{/g,"[").replace(/\}/g,"]");}data=eval('('+data+')');}var stackconfig=arguments[1];var offsetY=data.length;if(stackconfig==null||!!stackconfig){for(var c=0;c<data[0].length;c++){var colstr="";for(var r=0;r<data.length;r++){colstr+=data[r][c]+":";}colstr=colstr.substr(0,colstr.length-1);dataformat.push(colstr);}}else {for(var r=0;r<data.length;r++){var rowstr="";for(var c=0;c<data[0].length;c++){rowstr+=data[r][c]+":";}rowstr=rowstr.substr(0,rowstr.length-1);dataformat.push(rowstr);}var offsetY=data[0].length;}//在下面获得该单元格的长度和宽度,同时考虑了合并单元格问题
  var cellSize=luckysheet.menuButton.getCellRealSize(luckysheet.flowdata,cell_r,cell_c);var width=cellSize[0];var height=cellSize[1];//开始进行sparklines的详细设置，宽和高为单元格的宽高。
  var sparksetting={};//设置sparklines图表的宽高，线图的高会随着粗细而超出单元格高度，所以减去一个量，设置offsetY或者offsetX为渲染偏移量，传给luckysheetDrawMain使用。默认为0。=LINESPLINES(D9:E24,3,5)
  sparksetting.height=height;sparksetting.width=width;//sparksetting.offsetY = offsetY;
  //定义sparklines的通用色彩设置函数，可以设置 色表【colorList】索引数值 或者 具体颜色值
  var sparkColorSetting=function sparkColorSetting(attr,value){if(!!value){if(typeof value=="number"){if(value>19){value=value%20;}value=colorList[value];}sparksetting[attr]=value;}};var barSpacing=arguments[2];var chartRangeMax=arguments[3];////具体实现
  sparksetting["type"]="bar";if(barSpacing==null){barSpacing="1";}sparksetting["barSpacing"]=barSpacing;if(chartRangeMax==null||chartRangeMax===false||typeof chartRangeMax!="number"){sparksetting["chartRangeMax"]=undefined;}else {sparksetting["chartRangeMax"]=chartRangeMax;}var colorLists=luckysheet.formula.sparklinesColorMap(arguments,4);if(!!colorLists){sparksetting["colorMap"]=colorLists;}////具体实现
  var temp1=luckysheet.sparkline.init(dataformat,sparksetting);return temp1;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"DISCRETESPLINES":function DISCRETESPLINES(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//色表，接下来会用到
  var colorList=luckysheet.formula.colorList;var rangeValue=arguments[0];//定义需要格式化data数据
  var dataformat=luckysheet.formula.readCellDataToOneArray(rangeValue);//在下面获得该单元格的长度和宽度,同时考虑了合并单元格问题
  var cellSize=luckysheet.menuButton.getCellRealSize(luckysheet.flowdata,cell_r,cell_c);var width=cellSize[0];var height=cellSize[1];//开始进行sparklines的详细设置，宽和高为单元格的宽高。
  var sparksetting={};//设置sparklines图表的宽高，线图的高会随着粗细而超出单元格高度，所以减去一个量，设置offsetY或者offsetX为渲染偏移量，传给luckysheetDrawMain使用。默认为0。=LINESPLINES(D9:E24,3,5)
  sparksetting.height=height;sparksetting.width=width;//定义sparklines的通用色彩设置函数，可以设置 色表【colorList】索引数值 或者 具体颜色值
  var sparkColorSetting=function sparkColorSetting(attr,value){if(!!value){if(typeof value=="number"){if(value>19){value=value%20;}value=colorList[value];}sparksetting[attr]=value;}};var thresholdValue=arguments[1];var barColor=arguments[2];var negBarColor=arguments[3];////具体实现
  sparksetting["type"]="discrete";if(thresholdValue==null){thresholdValue=0;}sparksetting["thresholdValue"]=thresholdValue;if(barColor==null){barColor="#2ec7c9";}sparkColorSetting("lineColor",barColor);if(negBarColor==null){negBarColor="#fc5c5c";}sparkColorSetting("thresholdColor",negBarColor);////具体实现
  var temp1=luckysheet.sparkline.init(dataformat,sparksetting);return temp1;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"TRISTATESPLINES":function TRISTATESPLINES(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//色表，接下来会用到
  var colorList=luckysheet.formula.colorList;var rangeValue=arguments[0];//定义需要格式化data数据
  var dataformat=luckysheet.formula.readCellDataToOneArray(rangeValue);//在下面获得该单元格的长度和宽度,同时考虑了合并单元格问题
  var cellSize=luckysheet.menuButton.getCellRealSize(luckysheet.flowdata,cell_r,cell_c);var width=cellSize[0];var height=cellSize[1];//开始进行sparklines的详细设置，宽和高为单元格的宽高。
  var sparksetting={};//设置sparklines图表的宽高，线图的高会随着粗细而超出单元格高度，所以减去一个量，设置offsetY或者offsetX为渲染偏移量，传给luckysheetDrawMain使用。默认为0。=LINESPLINES(D9:E24,3,5)
  sparksetting.height=height;sparksetting.width=width;//定义sparklines的通用色彩设置函数，可以设置 色表【colorList】索引数值 或者 具体颜色值
  var sparkColorSetting=function sparkColorSetting(attr,value){if(!!value){if(typeof value=="number"){if(value>19){value=value%20;}value=colorList[value];}sparksetting[attr]=value;}};var barSpacing=arguments[1];var barColor=arguments[2];var negBarColor=arguments[3];var zeroBarColor=arguments[4];////具体实现
  sparksetting["type"]="tristate";if(barSpacing==null){barSpacing="1";}sparksetting["barSpacing"]=barSpacing;if(barColor==null){barColor="#fc5c5c";}sparkColorSetting("barColor",barColor);if(negBarColor==null){negBarColor="#97b552";}sparkColorSetting("negBarColor",negBarColor);if(zeroBarColor==null){zeroBarColor="#999";}sparkColorSetting("zeroBarColor",zeroBarColor);var colorLists=luckysheet.formula.sparklinesColorMap(arguments);if(!!colorLists){sparksetting["colorMap"]=colorLists;}////具体实现
  var temp1=luckysheet.sparkline.init(dataformat,sparksetting);return temp1;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"PIESPLINES":function PIESPLINES(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//色表，接下来会用到
  var colorList=luckysheet.formula.colorList;var rangeValue=arguments[0];//定义需要格式化data数据
  var dataformat=luckysheet.formula.readCellDataToOneArray(rangeValue);//在下面获得该单元格的长度和宽度,同时考虑了合并单元格问题
  var cellSize=luckysheet.menuButton.getCellRealSize(luckysheet.flowdata,cell_r,cell_c);var width=cellSize[0];var height=cellSize[1];//开始进行sparklines的详细设置，宽和高为单元格的宽高。
  var sparksetting={};//设置sparklines图表的宽高，线图的高会随着粗细而超出单元格高度，所以减去一个量，设置offsetY或者offsetX为渲染偏移量，传给luckysheetDrawMain使用。默认为0。=LINESPLINES(D9:E24,3,5)
  sparksetting.height=height;sparksetting.width=width;//定义sparklines的通用色彩设置函数，可以设置 色表【colorList】索引数值 或者 具体颜色值
  var sparkColorSetting=function sparkColorSetting(attr,value){if(!!value){if(typeof value=="number"){if(value>19){value=value%20;}value=colorList[value];}sparksetting[attr]=value;}};var offset=arguments[1];var borderWidth=arguments[2];var borderColor=arguments[3];////具体实现
  sparksetting["type"]="pie";if(offset==null){offset=0;}sparksetting["offset"]=offset;if(borderWidth==null){borderWidth=0;}sparkColorSetting("borderWidth",borderWidth);if(borderColor==null){borderColor="#97b552";}sparkColorSetting("borderColor",borderColor);var colorLists=luckysheet.formula.sparklinesColorMap(arguments,4);if(!!colorLists){sparksetting["colorMap"]=colorLists;}////具体实现
  var temp1=luckysheet.sparkline.init(dataformat,sparksetting);return temp1;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"BOXSPLINES":function BOXSPLINES(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//色表，接下来会用到
  var colorList=luckysheet.formula.colorList;var rangeValue=arguments[0];//定义需要格式化data数据
  var dataformat=luckysheet.formula.readCellDataToOneArray(rangeValue);//在下面获得该单元格的长度和宽度,同时考虑了合并单元格问题
  var cellSize=luckysheet.menuButton.getCellRealSize(luckysheet.flowdata,cell_r,cell_c);var width=cellSize[0];var height=cellSize[1];//开始进行sparklines的详细设置，宽和高为单元格的宽高。
  var sparksetting={};//设置sparklines图表的宽高，线图的高会随着粗细而超出单元格高度，所以减去一个量，设置offsetY或者offsetX为渲染偏移量，传给luckysheetDrawMain使用。默认为0。=LINESPLINES(D9:E24,3,5)
  sparksetting.height=height;sparksetting.width=width;//定义sparklines的通用色彩设置函数，可以设置 色表【colorList】索引数值 或者 具体颜色值
  var sparkColorSetting=function sparkColorSetting(attr,value){if(!!value){if(typeof value=="number"){if(value>19){value=value%20;}value=colorList[value];}sparksetting[attr]=value;}};var outlierIQR=arguments[1];var target=arguments[2];var spotRadius=arguments[3];////具体实现
  sparksetting["type"]="box";if(outlierIQR==null){outlierIQR=1.5;}sparksetting["outlierIQR"]=outlierIQR;if(target==null){target=0;}else {sparkColorSetting("target",target);}if(spotRadius==null){spotRadius=1.5;}sparkColorSetting("spotRadius",spotRadius);////具体实现
  var temp1=luckysheet.sparkline.init(dataformat,sparksetting);return temp1;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"BULLETSPLINES":function BULLETSPLINES(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{var cell_r=window.luckysheetCurrentRow;var cell_c=window.luckysheetCurrentColumn;var cell_fp=window.luckysheetCurrentFunction;//色表，接下来会用到
  var colorList=luckysheet.formula.colorList;//var rangeValue = arguments[0];
  //定义需要格式化data数据
  //var dataformat = luckysheet.formula.readCellDataToOneArray(rangeValue);
  //在下面获得该单元格的长度和宽度,同时考虑了合并单元格问题
  var cellSize=luckysheet.menuButton.getCellRealSize(luckysheet.flowdata,cell_r,cell_c);var width=cellSize[0];var height=cellSize[1];//开始进行sparklines的详细设置，宽和高为单元格的宽高。
  var sparksetting={};//设置sparklines图表的宽高，线图的高会随着粗细而超出单元格高度，所以减去一个量，设置offsetY或者offsetX为渲染偏移量，传给luckysheetDrawMain使用。默认为0。=LINESPLINES(D9:E24,3,5)
  sparksetting.height=height;sparksetting.width=width;//定义sparklines的通用色彩设置函数，可以设置 色表【colorList】索引数值 或者 具体颜色值
  var sparkColorSetting=function sparkColorSetting(attr,value){if(!!value){if(typeof value=="number"){if(value>19){value=value%20;}value=colorList[value];}sparksetting[attr]=value;}};////具体实现
  var dataformat=[];luckysheet_getValue(arguments);var data1=luckysheet.formula.getValueByFuncData(arguments[0]);var data2=luckysheet.formula.getValueByFuncData(arguments[1]);dataformat.push(data1);dataformat.push(data2);for(var i=2;i<arguments.length;i++){dataformat.push(luckysheet.formula.getValueByFuncData(arguments[i]));}sparksetting["type"]="bullet";////具体实现
  var temp1=luckysheet.sparkline.init(dataformat,sparksetting);return temp1;}catch(e){var err=e;//计算错误检测
  err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},//动态数组公式
  "SORT":function SORT(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要排序的范围或数组
  var data_array=arguments[0];var array=[],rowlen=1,collen=1;if(luckysheet.getObjType(data_array)=="array"){if(luckysheet.getObjType(data_array[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_array)){return luckysheet.formula.error.v;}for(var i=0;i<data_array.length;i++){var rowArr=[];for(var j=0;j<data_array[i].length;j++){var number=data_array[i][j];rowArr.push(number);}array.push(rowArr);}rowlen=array.length;collen=array[0].length;}else {for(var i=0;i<data_array.length;i++){var number=data_array[i];array.push(number);}rowlen=array.length;}}else if(luckysheet.getObjType(data_array)=="object"&&data_array.startCell!=null){if(data_array.data!=null){if(luckysheet.getObjType(data_array.data)=="array"){for(var i=0;i<data_array.data.length;i++){var rowArr=[];for(var j=0;j<data_array.data[i].length;j++){if(data_array.data[i][j]!=null){var number=data_array.data[i][j].v;if(luckysheet.func_methods.isRealNull(number)){number=0;}rowArr.push(number);}else {rowArr.push(0);}}array.push(rowArr);}rowlen=array.length;collen=array[0].length;}else {var number=data_array.data.v;if(luckysheet.func_methods.isRealNull(number)){number=0;}array.push(number);}}else {array.push(0);}}else {var number=data_array;array.push(number);}//表示要排序的行或列的数字（默认row1/col1）
  var sort_index=1;if(arguments.length>=2){sort_index=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(sort_index)){return sort_index;}if(!luckysheet.func_methods.isRealNum(sort_index)){return luckysheet.formula.error.v;}sort_index=parseInt(sort_index);}//表示所需排序顺序的数字；1表示升序（默认），-1表示降序。
  var sort_order=1;if(arguments.length>=3){sort_order=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(sort_order)){return sort_order;}if(!luckysheet.func_methods.isRealNum(sort_order)){return luckysheet.formula.error.v;}sort_order=Math.floor(parseFloat(sort_order));}//表示所需排序方向的逻辑值；按行排序为FALSE（默认），按列排序为TRUE。
  var by_col=false;if(arguments.length==4){by_col=luckysheet.func_methods.getCellBoolen(arguments[3]);if(luckysheet.func_methods.valueIsError(by_col)){return by_col;}}if(by_col){if(sort_index<1||sort_index>rowlen){return luckysheet.formula.error.v;}}else {if(sort_index<1||sort_index>collen){return luckysheet.formula.error.v;}}if(sort_order!=1&&sort_order!=-1){return luckysheet.formula.error.v;}//计算
  var asc=function asc(x,y){if(luckysheet.getObjType(x)=="array"){x=x[sort_index-1];}if(luckysheet.getObjType(y)=="array"){y=y[sort_index-1];}if(!isNaN(x)&&!isNaN(y)){return x-y;}else if(!isNaN(x)){return -1;}else if(!isNaN(y)){return 1;}else {if(x>y){return 1;}else if(x<y){return -1;}}};var desc=function desc(x,y){if(luckysheet.getObjType(x)=="array"){x=x[sort_index-1];}if(luckysheet.getObjType(y)=="array"){y=y[sort_index-1];}if(!isNaN(x)&&!isNaN(y)){return y-x;}else if(!isNaN(x)){return 1;}else if(!isNaN(y)){return -1;}else {if(x>y){return -1;}else if(x<y){return 1;}}};if(by_col){array=array[0].map(function(col,a){return array.map(function(row){return row[a];});});if(sort_order==1){array.sort(asc);}if(sort_order==-1){array.sort(desc);}array=array[0].map(function(col,b){return array.map(function(row){return row[b];});});}else {if(sort_order==1){array.sort(asc);}if(sort_order==-1){array.sort(desc);}}return array;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"FILTER":function FILTER(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要筛选的数组或范围
  var data_array=arguments[0];var array=[];if(luckysheet.getObjType(data_array)=="array"){if(luckysheet.getObjType(data_array[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array)){return luckysheet.formula.error.v;}array=luckysheet.func_methods.getDataDyadicArr(data_array);}else if(luckysheet.getObjType(data_array)=="object"&&data_array.startCell!=null){array=luckysheet.func_methods.getCellDataDyadicArr(data_array,"number");}else {var rowArr=[];rowArr.push(parseFloat(data_array));array.push(rowArr);}var rowlen=array.length,collen=array[0].length;//布尔数组，其高度或宽度与数组相同
  var data_include=arguments[1];var include=[];var type="row";//筛选方式 row - 行，col - 列
  if(luckysheet.getObjType(data_include)=="array"){if(luckysheet.getObjType(data_include[0])=="array"){if(!luckysheet.func_methods.isDyadicArr(data_include)){return luckysheet.formula.error.v;}if(data_include.length>1&&data_include[0].length>1){return luckysheet.formula.error.v;}if(data_include.length>1){if(data_include.length!=array.length){return luckysheet.formula.error.v;}type="row";for(var i=0;i<data_include.length;i++){var txt=data_include[i][0];if(luckysheet.getObjType(txt)=="boolean"){}else if(luckysheet.getObjType(txt)=="string"&&(txt.toLowerCase()=="true"||txt.toLowerCase()=="false")){if(txt.toLowerCase()=="true"){txt=true;}else if(txt.toLowerCase()=="false"){txt=false;}}else if(luckysheet.func_methods.isRealNum(txt)){txt=parseFloat(txt);txt=txt==0?false:true;}else {return luckysheet.formula.error.v;}include.push(txt);}}if(data_include[0].length>1){if(data_include[0].length!=array[0].length){return luckysheet.formula.error.v;}type="col";for(var i=0;i<data_include[0].length;i++){var txt=data_include[0][i];if(luckysheet.getObjType(txt)=="boolean"){}else if(luckysheet.getObjType(txt)=="string"&&(txt.toLowerCase()=="true"||txt.toLowerCase()=="false")){if(txt.toLowerCase()=="true"){txt=true;}else if(txt.toLowerCase()=="false"){txt=false;}}else if(luckysheet.func_methods.isRealNum(txt)){txt=parseFloat(txt);txt=txt==0?false:true;}else {return luckysheet.formula.error.v;}include.push(txt);}}}else {if(data_include.length!=array[0].length){return luckysheet.formula.error.v;}type="col";for(var i=0;i<data_include.length;i++){var txt=data_include[i];if(luckysheet.getObjType(txt)=="boolean"){}else if(luckysheet.getObjType(txt)=="string"&&(txt.toLowerCase()=="true"||txt.toLowerCase()=="false")){if(txt.toLowerCase()=="true"){txt=true;}else if(txt.toLowerCase()=="false"){txt=false;}}else if(luckysheet.func_methods.isRealNum(txt)){txt=parseFloat(txt);txt=txt==0?false:true;}else {return luckysheet.formula.error.v;}include.push(txt);}}}else if(luckysheet.getObjType(data_include)=="object"&&data_include.data!=null&&luckysheet.getObjType(data_include.data)=="array"){if(data_include.data.length>1&&data_include.data[0].length>1){return luckysheet.formula.error.v;}if(data_include.data.length>1){if(data_include.data.length!=array.length){return luckysheet.formula.error.v;}type="row";for(var i=0;i<data_include.data.length;i++){var txt=data_include.data[i][0].v;if(luckysheet.func_methods.isRealNull(txt)){txt=0;}if(luckysheet.getObjType(txt)=="boolean"){}else if(luckysheet.getObjType(txt)=="string"&&(txt.toLowerCase()=="true"||txt.toLowerCase()=="false")){if(txt.toLowerCase()=="true"){txt=true;}else if(txt.toLowerCase()=="false"){txt=false;}}else if(luckysheet.func_methods.isRealNum(txt)){txt=parseFloat(txt);txt=txt==0?false:true;}else {return luckysheet.formula.error.v;}include.push(txt);}}if(data_include.data[0].length>1){if(data_include.data[0].length!=array[0].length){return luckysheet.formula.error.v;}type="col";for(var i=0;i<data_include.data[0].length;i++){var txt=data_include.data[0][i].v;if(luckysheet.func_methods.isRealNull(txt)){txt=0;}if(luckysheet.getObjType(txt)=="boolean"){}else if(luckysheet.getObjType(txt)=="string"&&(txt.toLowerCase()=="true"||txt.toLowerCase()=="false")){if(txt.toLowerCase()=="true"){txt=true;}else if(txt.toLowerCase()=="false"){txt=false;}}else if(luckysheet.func_methods.isRealNum(txt)){txt=parseFloat(txt);txt=txt==0?false:true;}else {return luckysheet.formula.error.v;}include.push(txt);}}}else {return luckysheet.formula.error.v;}//如果包含数组中的所有值都为空(filter不返回任何值)，则返回的值
  var if_empty="";if(arguments.length==3){if_empty=luckysheet.func_methods.getFirstValue(arguments[2],"text");if(luckysheet.func_methods.valueIsError(if_empty)){return if_empty;}}//计算
  var result=[];if(type=="row"){for(var i=0;i<array.length;i++){if(include[i]){result.push(array[i]);}}}else {for(var i=0;i<array.length;i++){var rowArr=[];for(var j=0;j<array[0].length;j++){if(include[j]){rowArr.push(array[i][j]);}}if(rowArr.length>0){result.push(rowArr);}}}if(result.length==0){return if_empty;}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"UNIQUE":function UNIQUE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//从其返回唯一值的数组或区域
  var data_array=arguments[0];var array=[];if(luckysheet.getObjType(data_array)=="array"){if(luckysheet.getObjType(data_array[0])=="array"&&!luckysheet.func_methods.isDyadicArr(data_array)){return luckysheet.formula.error.v;}array=luckysheet.func_methods.getDataDyadicArr(data_array);}else if(luckysheet.getObjType(data_array)=="object"&&data_array.startCell!=null){array=luckysheet.func_methods.getCellDataDyadicArr(data_array,"number");}else {var rowArr=[];rowArr.push(parseFloat(data_array));array.push(rowArr);}//逻辑值，指示如何比较；按行 = FALSE 或省略；按列 = TRUE
  var by_col=false;if(arguments.length>=2){by_col=luckysheet.func_methods.getCellBoolen(arguments[1]);if(luckysheet.func_methods.valueIsError(by_col)){return by_col;}}//逻辑值，仅返回唯一值中出现一次 = TRUE；包括所有唯一值 = FALSE 或省略
  var occurs_once=false;if(arguments.length==3){occurs_once=luckysheet.func_methods.getCellBoolen(arguments[2]);if(luckysheet.func_methods.valueIsError(occurs_once)){return occurs_once;}}//计算
  if(by_col){array=array[0].map(function(col,a){return array.map(function(row){return row[a];});});var strObj={},strArr=[];var allUnique=[];for(var i=0;i<array.length;i++){var str='';for(var j=0;j<array[i].length;j++){str+=array[i][j].toString()+"|||";}strArr.push(str);if(!(str in strObj)){strObj[str]=0;allUnique.push(array[i]);}}if(occurs_once){var oneUnique=[];for(var i=0;i<strArr.length;i++){if(strArr.indexOf(strArr[i])==strArr.lastIndexOf(strArr[i])){oneUnique.push(array[i]);}}oneUnique=oneUnique[0].map(function(col,a){return oneUnique.map(function(row){return row[a];});});return oneUnique;}else {allUnique=allUnique[0].map(function(col,a){return allUnique.map(function(row){return row[a];});});return allUnique;}}else {var strObj={},strArr=[];var allUnique=[];for(var i=0;i<array.length;i++){var str='';for(var j=0;j<array[i].length;j++){str+=array[i][j].toString()+"|||";}strArr.push(str);if(!(str in strObj)){strObj[str]=0;allUnique.push(array[i]);}}if(occurs_once){var oneUnique=[];for(var i=0;i<strArr.length;i++){if(strArr.indexOf(strArr[i])==strArr.lastIndexOf(strArr[i])){oneUnique.push(array[i]);}}return oneUnique;}else {return allUnique;}}}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"RANDARRAY":function RANDARRAY(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要返回的行数
  var rows=1;if(arguments.length>=1){rows=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(rows)){return rows;}if(!luckysheet.func_methods.isRealNum(rows)){return luckysheet.formula.error.v;}rows=parseInt(rows);}//要返回的列数
  var cols=1;if(arguments.length==2){cols=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(cols)){return cols;}if(!luckysheet.func_methods.isRealNum(cols)){return luckysheet.formula.error.v;}cols=parseInt(cols);}if(rows<=0||cols<=0){return luckysheet.formula.error.v;}//计算
  var result=[];for(var i=0;i<rows;i++){var result_row=[];for(var j=0;j<cols;j++){result_row.push(Math.random().toFixed(9));}result.push(result_row);}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}},"SEQUENCE":function SEQUENCE(){//必要参数个数错误检测
  if(arguments.length<this.m[0]||arguments.length>this.m[1]){return luckysheet.formula.error.na;}//参数类型错误检测
  for(var i=0;i<arguments.length;i++){var p=luckysheet.formula.errorParamCheck(this.p,arguments[i],i);if(!p[0]){return luckysheet.formula.error.v;}}try{//要返回的行数
  var rows=luckysheet.func_methods.getFirstValue(arguments[0]);if(luckysheet.func_methods.valueIsError(rows)){return rows;}if(!luckysheet.func_methods.isRealNum(rows)){return luckysheet.formula.error.v;}rows=parseInt(rows);//要返回的列数
  var cols=1;if(arguments.length>=2){cols=luckysheet.func_methods.getFirstValue(arguments[1]);if(luckysheet.func_methods.valueIsError(cols)){return cols;}if(!luckysheet.func_methods.isRealNum(cols)){return luckysheet.formula.error.v;}cols=parseInt(cols);}//序列中的第一个数字
  var start=1;if(arguments.length>=3){start=luckysheet.func_methods.getFirstValue(arguments[2]);if(luckysheet.func_methods.valueIsError(start)){return start;}if(!luckysheet.func_methods.isRealNum(start)){return luckysheet.formula.error.v;}start=parseFloat(start);}//序列中每个序列值的增量
  var step=1;if(arguments.length==4){step=luckysheet.func_methods.getFirstValue(arguments[3]);if(luckysheet.func_methods.valueIsError(step)){return step;}if(!luckysheet.func_methods.isRealNum(step)){return luckysheet.formula.error.v;}step=parseFloat(step);}if(rows<=0||cols<=0){return luckysheet.formula.error.v;}//计算
  var result=[];for(var i=0;i<rows;i++){var result_row=[];for(var j=0;j<cols;j++){var number=start+step*(j+cols*i);result_row.push(number);}result.push(result_row);}return result;}catch(e){var err=e;err=luckysheet.formula.errorInfo(err);return [luckysheet.formula.error.v,err];}}};for(var i$1=0;i$1<luckysheet.functionlist.length;i$1++){var func=luckysheet.functionlist[i$1];func.f=luckysheet.functionImplementation[func.n];}luckysheet.matrix_methods=function(){var matrix={};var init=function init(matrix){var sylvester_matrix=function sylvester_matrix(){};sylvester_matrix.precision=1e-6;sylvester_matrix.create=function(elements){var M=new sylvester_matrix();return M.setElements(elements);};sylvester_matrix.I=function(n){var els=[],i=n,j;while(i--){j=n;els[i]=[];while(j--){els[i][j]=i===j?1:0;}}return sylvester_matrix.create(els);};sylvester_matrix.prototype={e:function e(i,j){if(i<1||i>this.elements.length||j<1||j>this.elements[0].length){return null;}return this.elements[i-1][j-1];},dimensions:function dimensions(){var cols=this.elements.length===0?0:this.elements[0].length;return {rows:this.elements.length,cols:cols};},rows:function rows(){return this.elements.length;},cols:function cols(){if(this.elements.length===0){return 0;}return this.elements[0].length;},eql:function eql(matrix){var M=matrix.elements||matrix;if(!M[0]||typeof M[0][0]==='undefined'){M=sylvester_matrix.create(M).elements;}if(this.elements.length===0||M.length===0){return this.elements.length===M.length;}if(this.elements.length!==M.length){return false;}if(this.elements[0].length!==M[0].length){return false;}var i=this.elements.length,nj=this.elements[0].length,j;while(i--){j=nj;while(j--){if(Math.abs(this.elements[i][j]-M[i][j])>sylvester_matrix.precision){return false;}}}return true;},dup:function dup(){return sylvester_matrix.create(this.elements);},map:function map(fn,context){if(this.elements.length===0){return sylvester_matrix.create([]);}var els=[],i=this.elements.length,nj=this.elements[0].length,j;while(i--){j=nj;els[i]=[];while(j--){els[i][j]=fn.call(context,this.elements[i][j],i+1,j+1);}}return sylvester_matrix.create(els);},isSameSizeAs:function isSameSizeAs(matrix){var M=matrix.elements||matrix;if(typeof M[0][0]==='undefined'){M=sylvester_matrix.create(M).elements;}if(this.elements.length===0){return M.length===0;}return this.elements.length===M.length&&this.elements[0].length===M[0].length;},add:function add(matrix){if(this.elements.length===0)return this.map(function(x){return x;});var M=matrix.elements||matrix;if(typeof M[0][0]==='undefined'){M=sylvester_matrix.create(M).elements;}if(!this.isSameSizeAs(M)){return null;}return this.map(function(x,i,j){return x+M[i-1][j-1];});},subtract:function subtract(matrix){if(this.elements.length===0)return this.map(function(x){return x;});var M=matrix.elements||matrix;if(typeof M[0][0]==='undefined'){M=sylvester_matrix.create(M).elements;}if(!this.isSameSizeAs(M)){return null;}return this.map(function(x,i,j){return x-M[i-1][j-1];});},canMultiplyFromLeft:function canMultiplyFromLeft(matrix){if(this.elements.length===0){return false;}var M=matrix.elements||matrix;if(typeof M[0][0]==='undefined'){M=sylvester_matrix.create(M).elements;}// this.columns should equal matrix.rows
  return this.elements[0].length===M.length;},multiply:function multiply(matrix){if(this.elements.length===0){return null;}if(!matrix.elements){return this.map(function(x){return x*matrix;});}var returnVector=matrix.modulus?true:false;var M=matrix.elements||matrix;if(typeof M[0][0]==='undefined'){M=sylvester_matrix.create(M).elements;}if(!this.canMultiplyFromLeft(M)){return null;}var i=this.elements.length,nj=M[0].length,j;var cols=this.elements[0].length,c,elements=[],sum;while(i--){j=nj;elements[i]=[];while(j--){c=cols;sum=0;while(c--){sum+=this.elements[i][c]*M[c][j];}elements[i][j]=sum;}}var M=sylvester_matrix.create(elements);return returnVector?M.col(1):M;},minor:function minor(a,b,c,d){if(this.elements.length===0){return null;}var elements=[],ni=c,i,nj,j;var rows=this.elements.length,cols=this.elements[0].length;while(ni--){i=c-ni-1;elements[i]=[];nj=d;while(nj--){j=d-nj-1;elements[i][j]=this.elements[(a+i-1)%rows][(b+j-1)%cols];}}return sylvester_matrix.create(elements);},transpose:function transpose(){if(this.elements.length===0)return sylvester_matrix.create([]);var rows=this.elements.length,i,cols=this.elements[0].length,j;var elements=[],i=cols;while(i--){j=rows;elements[i]=[];while(j--){elements[i][j]=this.elements[j][i];}}return sylvester_matrix.create(elements);},isSquare:function isSquare(){var cols=this.elements.length===0?0:this.elements[0].length;return this.elements.length===cols;},max:function max(){if(this.elements.length===0){return null;}var m=0,i=this.elements.length,nj=this.elements[0].length,j;while(i--){j=nj;while(j--){if(Math.abs(this.elements[i][j])>Math.abs(m)){m=this.elements[i][j];}}}return m;},indexOf:function indexOf(x){if(this.elements.length===0){return null;}var ni=this.elements.length,i,nj=this.elements[0].length,j;for(i=0;i<ni;i++){for(j=0;j<nj;j++){if(this.elements[i][j]===x){return {i:i+1,j:j+1};}}}return null;},diagonal:function diagonal(){if(!this.isSquare){return null;}var els=[],n=this.elements.length;for(var i=0;i<n;i++){els.push(this.elements[i][i]);}return sylvester_matrix.create(els);},toRightTriangular:function toRightTriangular(){if(this.elements.length===0)return sylvester_matrix.create([]);var M=this.dup(),els;var n=this.elements.length,i,j,np=this.elements[0].length,p;for(i=0;i<n;i++){if(M.elements[i][i]===0){for(j=i+1;j<n;j++){if(M.elements[j][i]!==0){els=[];for(p=0;p<np;p++){els.push(M.elements[i][p]+M.elements[j][p]);}M.elements[i]=els;break;}}}if(M.elements[i][i]!==0){for(j=i+1;j<n;j++){var multiplier=M.elements[j][i]/M.elements[i][i];els=[];for(p=0;p<np;p++){// Elements with column numbers up to an including the number of the
  // row that we're subtracting can safely be set straight to zero,
  // since that's the point of this routine and it avoids having to
  // loop over and correct rounding errors later
  els.push(p<=i?0:M.elements[j][p]-M.elements[i][p]*multiplier);}M.elements[j]=els;}}}return M;},determinant:function determinant(){if(this.elements.length===0){return 1;}if(!this.isSquare()){return null;}var M=this.toRightTriangular();var det=M.elements[0][0],n=M.elements.length;for(var i=1;i<n;i++){det=det*M.elements[i][i];}return det;},isSingular:function isSingular(){return this.isSquare()&&this.determinant()===0;},trace:function trace(){if(this.elements.length===0){return 0;}if(!this.isSquare()){return null;}var tr=this.elements[0][0],n=this.elements.length;for(var i=1;i<n;i++){tr+=this.elements[i][i];}return tr;},rank:function rank(){if(this.elements.length===0){return 0;}var M=this.toRightTriangular(),rank=0;var i=this.elements.length,nj=this.elements[0].length,j;while(i--){j=nj;while(j--){if(Math.abs(M.elements[i][j])>sylvester_matrix.precision){rank++;break;}}}return rank;},augment:function augment(matrix){if(this.elements.length===0){return this.dup();}var M=matrix.elements||matrix;if(typeof M[0][0]==='undefined'){M=sylvester_matrix.create(M).elements;}var T=this.dup(),cols=T.elements[0].length;var i=T.elements.length,nj=M[0].length,j;if(i!==M.length){return null;}while(i--){j=nj;while(j--){T.elements[i][cols+j]=M[i][j];}}return T;},inverse:function inverse(){if(this.elements.length===0){return null;}if(!this.isSquare()||this.isSingular()){return null;}var n=this.elements.length,i=n,j;var M=this.augment(sylvester_matrix.I(n)).toRightTriangular();var np=M.elements[0].length,p,els,divisor;var inverse_elements=[],new_element;// Sylvester.Matrix is non-singular so there will be no zeros on the
  // diagonal. Cycle through rows from last to first.
  while(i--){// First, normalise diagonal elements to 1
  els=[];inverse_elements[i]=[];divisor=M.elements[i][i];for(p=0;p<np;p++){new_element=M.elements[i][p]/divisor;els.push(new_element);// Shuffle off the current row of the right hand side into the results
  // array as it will not be modified by later runs through this loop
  if(p>=n){inverse_elements[i].push(new_element);}}M.elements[i]=els;// Then, subtract this row from those above it to give the identity matrix
  // on the left hand side
  j=i;while(j--){els=[];for(p=0;p<np;p++){els.push(M.elements[j][p]-M.elements[i][p]*M.elements[j][i]);}M.elements[j]=els;}}return sylvester_matrix.create(inverse_elements);},round:function round(){return this.map(function(x){return Math.round(x);});},snapTo:function snapTo(x){return this.map(function(p){return Math.abs(p-x)<=sylvester_matrix.precision?x:p;});},setElements:function setElements(els){var i,j,elements=els.elements||els;if(elements[0]&&typeof elements[0][0]!=='undefined'){i=elements.length;this.elements=[];while(i--){j=elements[i].length;this.elements[i]=[];while(j--){this.elements[i][j]=elements[i][j];}}return this;}var n=elements.length;this.elements=[];for(i=0;i<n;i++){this.elements.push([elements[i]]);}return this;}};matrix.sylvester_matrix=sylvester_matrix;};init(matrix);return {inverse:function inverse(els){var M=matrix.sylvester_matrix.create(els);return M.inverse().elements;}};}();// })(luckysheet);

  // chart用到的各个变量

  luckysheet.chartparam = {
    luckysheet_chart_point_config: null,
    luckysheetCurrentChartMove: false,
    luckysheetCurrentChartMoveTimeout: null,
    luckysheetCurrentChartResize: null,
    luckysheet_chart_rangefocus_timeout: null,
    luckysheet_chart_rangefocus: false,
    luckysheet_chart_data_select_state: false,
    luckysheetCurrentChartMoveObj: null,
    luckysheetCurrentChartMoveXy: [],
    luckysheetCurrentChartMoveWinH: null,
    luckysheetCurrentChartMoveWinW: null,
    luckysheetInsertChartTosheetChange: true,
    jgridCurrentChartSelection: null,
    luckysheetCurrentChartResizeObj: null,
    luckysheetCurrentChartResizeXy: null,
    luckysheetCurrentChartResizeWinH: null,
    luckysheetCurrentChartResizeWinW: null,
    luckysheet_chartIns_index: -1,
    luckysheetCurrentChartActive: false,
    jgridCurrentChartData: null,
    luckysheetcurrentChart: null,
    luckysheet_chart_redo_click: false,
    jgridCurrentChartType: null,
    luckysheetCurrentChartStyle: null,
    luckysheetCurrentChartCurrentType: null,
    luckysheetPreviousChart: '' //最近最新的图表json

  }; // 初始化图表

  luckysheet.chartInitial = function () {
    $('#luckysheetdatavisual').click(function () {
      // 未加入chartMix插件时返回
      if (!window.generateChart) {
        luckysheet.tooltip.info('<i class="fa fa-exclamation-triangle"></i>提示', "图表插件暂未加入");
        return;
      } //防止watch生效
      // generator.isFirstEditor = true;


      generator.ini(chartMixConfig);
      setTimeout(function () {
        generator.showChartSettingComponent('notRefresh'); //此处不刷新，插入完图表再刷新
      }, 0);

      if (store.state.chartSetting.isqk) {
        setTimeout(function () {
          luckysheet.luckysheetsizeauto();
        }, 0);
      } // var chartAllType = 'highcharts|line|default'


      var chartAllType = 'echarts|line|default'; //如果只选中一个单元格，则自动填充选取

      var luckysheet_select_save = luckysheet.getluckysheet_select_save();

      if (luckysheet_select_save.length == 1 && luckysheet_select_save[0].row[0] == luckysheet_select_save[0].row[1] && luckysheet_select_save[0].column[0] == luckysheet_select_save[0].column[1]) {
        luckysheet.luckysheetMoveHighlightRange2('right', 'rangeOfSelect');
        luckysheet.luckysheetMoveHighlightRange2('down', 'rangeOfSelect');
        luckysheet_select_save = luckysheet.getluckysheet_select_save();
      } //处理右边的空白单元格，自动略过并修改选区 ---------------start


      var shiftpositon_row = -1;
      var row_ed = luckysheet_select_save[0]['row'][1] - luckysheet_select_save[0]['row'][0];

      for (var r = luckysheet_select_save[0]['row'][0]; r <= luckysheet_select_save[0]['row'][1]; r++) {
        for (var c = luckysheet_select_save[0]['column'][0]; c <= luckysheet_select_save[0]['column'][1]; c++) {
          var value = luckysheet.getcellvalue(r, c, luckysheet.flowdata); //console.log("value,r,c",value,r,c);

          if (value != null && value.toString().length > 0) {
            shiftpositon_row = r;
            break;
          }
        }

        if (shiftpositon_row !== -1) {
          break;
        }
      }

      if (shiftpositon_row == -1) {
        shiftpositon_row = 0;
      }

      luckysheet_select_save[0]['row'] = [shiftpositon_row, shiftpositon_row];
      luckysheet.setluckysheet_select_save(luckysheet_select_save);
      luckysheet.luckysheet_shiftpositon = $.extend(true, {}, luckysheet_select_save[0]);
      luckysheet.luckysheetMoveEndCell('down', 'range', false, row_ed);
      luckysheet_select_save = luckysheet.getluckysheet_select_save();
      var shiftpositon_col = -1;
      var column_ed = luckysheet_select_save[0]['column'][1] - luckysheet_select_save[0]['column'][0];

      for (var c = luckysheet_select_save[0]['column'][0]; c <= luckysheet_select_save[0]['column'][1]; c++) {
        for (var r = luckysheet_select_save[0]['row'][0]; r <= luckysheet_select_save[0]['row'][1]; r++) {
          var value = luckysheet.getcellvalue(r, c, luckysheet.flowdata);

          if (value != null && value.toString().length > 0) {
            shiftpositon_col = c;
            break;
          }
        }

        if (shiftpositon_col !== -1) {
          break;
        }
      }

      if (shiftpositon_col == -1) {
        shiftpositon_col = 0;
      }

      luckysheet_select_save[0]['column'] = [shiftpositon_col, shiftpositon_col];
      luckysheet.setluckysheet_select_save(luckysheet_select_save);
      luckysheet.luckysheet_shiftpositon = $.extend(true, {}, luckysheet_select_save[0]);
      luckysheet.luckysheetMoveEndCell('right', 'range', false, column_ed);
      luckysheet_select_save = luckysheet.getluckysheet_select_save();
      var dataSheetIndex = luckysheet.currentSheetIndex; //当前sheet的原始索引

      var rangeArray = $.extend(true, [], luckysheet_select_save); //处理右边的空白单元格，自动略过并修改选区 ---------------end
      //根据选区来获取数据，########需要支持多选区取得的数据##################

      var chartData = luckysheet.getdatabyselection(luckysheet_select_save[0], dataSheetIndex); // 获取原始数据

      generator.chartData = chartData;
      var rangeTxt = luckysheet.sheetmanage.getRangetxt(dataSheetIndex, rangeArray[0], dataSheetIndex);
      var chartTheme = 'default';
      var winw = $(window).width(),
          winh = $(window).height();
      var $cellmain = $('#luckysheet-cell-main');
      var scrollLeft = $cellmain.scrollLeft(),
          scrollTop = $cellmain.scrollTop();
      var myw = winw * 0.3,
          myh = winw * 0.3 * 0.618;
      var myLeft = (winw - myw) / 3 + scrollLeft + Math.round(Math.random() * 10),
          myTop = (winh - myh) / 4 + scrollTop + Math.round(Math.random() * 10); //先计算好位置

      console.dir(JSON.stringify(chartData));
      console.dir(JSON.stringify(rangeArray)); //luckysheet.insertChartTosheet放到insertNewChart中

      generator.insertNewChart(chartAllType, chartData, dataSheetIndex, rangeArray, rangeTxt, chartTheme, luckysheet.currentSheetIndex, myh, myw, myLeft, myTop); // setTimeout(function(){//暂时使用setTimeout解决watch第一次触发监听的问题
      // 	generator.isFirstEditor = false;
      // },1000);
    });
  }; // 图表数据区域拖动修改


  luckysheet.chart_selection = {
    create: function create(chart_id) {
      var chart_json = store.state.chartSetting.chartList[chart_id];

      if (chart_json.rangeArray.length > 1) {
        return;
      }

      $('#luckysheet-chart-rangeShow').empty();
      $('#luckysheet-cell-selected-boxs').hide();
      $('#luckysheet-cell-selected-focus').hide();
      $('#luckysheet-rows-h-selected').hide();
      $('#luckysheet-cols-h-selected').hide();
      $('#luckysheet-row-count-show').hide();
      $('#luckysheet-column-count-show').hide();
      var st_r = chart_json.rangeArray[0].row[0];
      var st_c = chart_json.rangeArray[0].column[0];
      var rangeSplitArray = chart_json.rangeSplitArray; //首行是否标题

      var rangeRowCheck = chart_json.rangeRowCheck;

      if (rangeRowCheck.exits) {
        var chart_rowtitle_html = getRangeShowHtml('rowtitle', rangeSplitArray.rowtitle.row[0] + st_r, rangeSplitArray.rowtitle.row[1] + st_r, rangeSplitArray.rowtitle.column[0] + st_c, rangeSplitArray.rowtitle.column[1] + st_c);
      } else {
        var chart_rowtitle_html = '';
      } //首列是否标题


      var rangeColCheck = chart_json.rangeColCheck;

      if (rangeColCheck.exits) {
        var chart_coltitle_html = getRangeShowHtml('coltitle', rangeSplitArray.coltitle.row[0] + st_r, rangeSplitArray.coltitle.row[1] + st_r, rangeSplitArray.coltitle.column[0] + st_c, rangeSplitArray.coltitle.column[1] + st_c);
      } else {
        var chart_coltitle_html = '';
      } //内容块


      var chart_content_html = getRangeShowHtml('content', rangeSplitArray.content.row[0] + st_r, rangeSplitArray.content.row[1] + st_r, rangeSplitArray.content.column[0] + st_c, rangeSplitArray.content.column[1] + st_c);
      $('#luckysheet-chart-rangeShow').append(chart_rowtitle_html + chart_coltitle_html + chart_content_html);

      function getRangeShowHtml(type, r1, r2, c1, c2) {
        var visibledatarow = luckysheet.getvisibledatarow();
        var visibledatacolumn = luckysheet.getvisibledatacolumn();
        var row = visibledatarow[r2],
            row_pre = r1 - 1 == -1 ? 0 : visibledatarow[r1 - 1];
        var col = visibledatacolumn[c2],
            col_pre = c1 - 1 == -1 ? 0 : visibledatacolumn[c1 - 1];

        if (type == 'rowtitle') {
          var color = '#C65151';
        }

        if (type == 'coltitle') {
          var color = '#9667C0';
        }

        if (type == 'content') {
          var color = '#4970D1';
        }

        var html = '<div id="luckysheet-chart-rangeShow-' + type + '" style="left: ' + col_pre + 'px;width: ' + (col - col_pre - 1) + 'px;top: ' + row_pre + 'px;height: ' + (row - row_pre - 1) + 'px;border: none;margin: 0;position: absolute;z-index: 14;">' + '<div class="luckysheet-chart-rangeShow-move" data-type="top" style="height: 2px;border-top: 2px solid #fff;border-bottom: 2px solid #fff;background: ' + color + ';position: absolute;left: 0;right: 0;top: -2px;z-index: 18;opacity: 0.9;cursor: move;"></div>' + '<div class="luckysheet-chart-rangeShow-move" data-type="right" style="width: 2px;border-left: 2px solid #fff;border-right: 2px solid #fff;background: ' + color + ';position: absolute;top: 0;bottom: 0;right: -2px;z-index: 18;opacity: 0.9;cursor: move;"></div>' + '<div class="luckysheet-chart-rangeShow-move" data-type="bottom" style="height: 2px;border-top: 2px solid #fff;border-bottom: 2px solid #fff;background: ' + color + ';position: absolute;left: 0;right: 0;bottom: -2px;z-index: 18;opacity: 0.9;cursor: move;"></div>' + '<div class="luckysheet-chart-rangeShow-move" data-type="left" style="width: 2px;border-left: 2px solid #fff;border-right: 2px solid #fff;background: ' + color + ';position: absolute;top: 0;bottom: 0;left: -2px;z-index: 18;opacity: 0.9;cursor: move;"></div>' + '<div style="border: 2px solid #FC6666;background: ' + color + ';position: absolute;top: 0;right: 0;bottom: 0;left: 0;z-index: 15;opacity: 0.1;"></div>' + '<div class="luckysheet-chart-rangeShow-resize" data-type="lt" style="width: 6px;height: 6px;border: 1px solid #fff;background: ' + color + ';position: absolute;left: -3px;top: -3px;z-index: 19;cursor: se-resize;"></div>' + '<div class="luckysheet-chart-rangeShow-resize" data-type="rt" style="width: 6px;height: 6px;border: 1px solid #fff;background: ' + color + ';position: absolute;right: -3px;top: -3px;z-index: 19;cursor: ne-resize;"></div>' + '<div class="luckysheet-chart-rangeShow-resize" data-type="lb" style="width: 6px;height: 6px;border: 1px solid #fff;background: ' + color + ';position: absolute;left: -3px;bottom: -3px;z-index: 19;cursor: ne-resize;"></div>' + '<div class="luckysheet-chart-rangeShow-resize" data-type="rb" style="width: 6px;height: 6px;border: 1px solid #fff;background: ' + color + ';position: absolute;right: -3px;bottom: -3px;z-index: 19;cursor: se-resize;"></div>' + '</div>';
        return html;
      }
    },
    rangeMove: false,
    rangeMovexy: null,
    rangeMoveIndex: null,
    rangeMoveObj: null,
    rangeMoveDraging: function rangeMoveDraging(event, sheetBarHeight, statisticBarHeight) {
      var chart_json = $.extend(true, {}, store.state.chartSetting.chartList[store.state.chartSetting.chartCurrent]);
      var st_r = chart_json.rangeArray[0].row[0];
      var st_c = chart_json.rangeArray[0].column[0];
      var rangeRowCheck = chart_json.rangeRowCheck;
      var rangeColCheck = chart_json.rangeColCheck;
      var rangeSplitArray = chart_json.rangeSplitArray;
      var mouse = luckysheet.mouseposition(event.pageX, event.pageY);
      var scrollLeft = $('#luckysheet-cell-main').scrollLeft();
      var scrollTop = $('#luckysheet-cell-main').scrollTop();
      var x = mouse[0] + scrollLeft;
      var y = mouse[1] + scrollTop;
      var winH = $(window).height() + scrollTop - sheetBarHeight - statisticBarHeight,
          winW = $(window).width() + scrollLeft;
      var rowLocation = luckysheet.rowLocation(y),
          row_index = rowLocation[2];
      var colLocation = luckysheet.colLocation(x),
          col_index = colLocation[2];
      var visibledatarow = luckysheet.getvisibledatarow();
      var visibledatacolumn = luckysheet.getvisibledatacolumn();
      var $id = luckysheet.chart_selection.rangeMoveObj.attr('id');

      if ($id == 'luckysheet-chart-rangeShow-content') {
        //行
        var row_s = luckysheet.chart_selection.rangeMoveIndex[0] - luckysheet.chart_selection.rangeMovexy[0] + row_index;

        if (rangeRowCheck.exits) {
          if (row_s < st_r + rangeRowCheck.range[1] + 1 || y < 0) {
            row_s = st_r + rangeRowCheck.range[1] + 1;
          }
        } else {
          if (row_s < 0 || y < 0) {
            row_s = 0;
          }
        }

        var row_e = rangeSplitArray.content.row[1] - rangeSplitArray.content.row[0] + row_s;

        if (row_e >= visibledatarow.length - 1 || y > winH) {
          row_s = visibledatarow.length - 1 - rangeSplitArray.content.row[1] + rangeSplitArray.content.row[0];
          row_e = visibledatarow.length - 1;
        } //列


        var col_s = luckysheet.chart_selection.rangeMoveIndex[1] - luckysheet.chart_selection.rangeMovexy[1] + col_index;

        if (rangeColCheck.exits) {
          if (col_s < st_c + rangeColCheck.range[1] + 1 || x < 0) {
            col_s = st_c + rangeColCheck.range[1] + 1;
          }
        } else {
          if (col_s < 0 || x < 0) {
            col_s = 0;
          }
        }

        var col_e = rangeSplitArray.content.column[1] - rangeSplitArray.content.column[0] + col_s;

        if (col_e >= visibledatacolumn.length - 1 || x > winW) {
          col_s = visibledatacolumn.length - 1 - rangeSplitArray.content.column[1] + rangeSplitArray.content.column[0];
          col_e = visibledatacolumn.length - 1;
        } //更新


        if (rangeRowCheck.exits && rangeColCheck.exits) {
          chart_json.rangeArray = [{
            row: [st_r, row_e],
            column: [st_c, col_e]
          }];
          chart_json.rangeSplitArray.range = {
            row: [st_r, row_e],
            column: [st_c, col_e]
          };
          chart_json.rangeSplitArray.content = {
            row: [row_s - st_r, row_e - st_r],
            column: [col_s - st_c, col_e - st_c]
          };
          chart_json.rangeSplitArray.rowtitle = {
            row: chart_json.rangeSplitArray.rowtitle.row,
            column: [col_s - st_c, col_e - st_c]
          };
          chart_json.rangeSplitArray.coltitle = {
            row: [row_s - st_r, row_e - st_r],
            column: chart_json.rangeSplitArray.coltitle.column
          };
        } else if (rangeRowCheck.exits) {
          chart_json.rangeArray = [{
            row: [st_r, row_e],
            column: [col_s, col_e]
          }];
          chart_json.rangeSplitArray.range = {
            row: [st_r, row_e],
            column: [col_s, col_e]
          };
          chart_json.rangeSplitArray.content = {
            row: [row_s - st_r, row_e - st_r],
            column: chart_json.rangeSplitArray.content.column
          };
        } else if (rangeColCheck.exits) {
          chart_json.rangeArray = [{
            row: [row_s, row_e],
            column: [st_c, col_e]
          }];
          chart_json.rangeSplitArray.range = {
            row: [row_s, row_e],
            column: [st_c, col_e]
          };
          chart_json.rangeSplitArray.content = {
            row: chart_json.rangeSplitArray.content.row,
            column: [col_s - st_c, col_e - st_c]
          };
        } else {
          chart_json.rangeArray = [{
            row: [row_s, row_e],
            column: [col_s, col_e]
          }];
          chart_json.rangeSplitArray.range = {
            row: [row_s, row_e],
            column: [col_s, col_e]
          };
        }
      } else if ($id == 'luckysheet-chart-rangeShow-rowtitle') {
        //列
        var col_s = luckysheet.chart_selection.rangeMoveIndex[1] - luckysheet.chart_selection.rangeMovexy[1] + col_index;

        if (rangeColCheck.exits) {
          if (col_s < st_c + rangeColCheck.range[1] + 1 || x < 0) {
            col_s = st_c + rangeColCheck.range[1] + 1;
          }
        } else {
          if (col_s < 0 || x < 0) {
            col_s = 0;
          }
        }

        var col_e = rangeSplitArray.rowtitle.column[1] - rangeSplitArray.rowtitle.column[0] + col_s;

        if (col_e >= visibledatacolumn.length - 1 || x > winW) {
          col_s = visibledatacolumn.length - 1 - rangeSplitArray.rowtitle.column[1] + rangeSplitArray.rowtitle.column[0];
          col_e = visibledatacolumn.length - 1;
        } //更新


        if (rangeColCheck.exits) {
          chart_json.rangeArray = [{
            row: chart_json.rangeArray[0].row,
            column: [st_c, col_e]
          }];
          chart_json.rangeSplitArray.range = {
            row: chart_json.rangeArray[0].row,
            column: [st_c, col_e]
          };
          chart_json.rangeSplitArray.rowtitle = {
            row: chart_json.rangeSplitArray.rowtitle.row,
            column: [col_s - st_c, col_e - st_c]
          };
          chart_json.rangeSplitArray.content = {
            row: chart_json.rangeSplitArray.content.row,
            column: [col_s - st_c, col_e - st_c]
          };
        } else {
          chart_json.rangeArray = [{
            row: chart_json.rangeArray[0].row,
            column: [col_s, col_e]
          }];
          chart_json.rangeSplitArray.range = {
            row: chart_json.rangeArray[0].row,
            column: [col_s, col_e]
          };
        }
      } else if ($id == 'luckysheet-chart-rangeShow-coltitle') {
        //行
        var row_s = luckysheet.chart_selection.rangeMoveIndex[0] - luckysheet.chart_selection.rangeMovexy[0] + row_index;

        if (rangeRowCheck.exits) {
          if (row_s < st_r + rangeRowCheck.range[1] + 1 || y < 0) {
            row_s = st_r + rangeRowCheck.range[1] + 1;
          }
        } else {
          if (row_s < 0 || y < 0) {
            row_s = 0;
          }
        } //更新


        var row_e = rangeSplitArray.coltitle.row[1] - rangeSplitArray.coltitle.row[0] + row_s;

        if (row_e >= visibledatarow.length - 1 || y > winH) {
          row_s = visibledatarow.length - 1 - rangeSplitArray.coltitle.row[1] + rangeSplitArray.coltitle.row[0];
          row_e = visibledatarow.length - 1;
        }

        if (rangeRowCheck.exits) {
          chart_json.rangeArray = [{
            row: [st_r, row_e],
            column: chart_json.rangeArray[0].column
          }];
          chart_json.rangeSplitArray.range = {
            row: [st_r, row_e],
            column: chart_json.rangeArray[0].column
          };
          chart_json.rangeSplitArray.coltitle = {
            row: [row_s - st_r, row_e - st_r],
            column: chart_json.rangeSplitArray.coltitle.column
          };
          chart_json.rangeSplitArray.content = {
            row: [row_s - st_r, row_e - st_r],
            column: chart_json.rangeSplitArray.content.column
          };
        } else {
          chart_json.rangeArray = [{
            row: [row_s, row_e],
            column: chart_json.rangeArray[0].column
          }];
          chart_json.rangeSplitArray.range = {
            row: [row_s, row_e],
            column: chart_json.rangeArray[0].column
          };
        }
      } //部分更新


      store.commit({
        type: 'updateChartItem',
        key: 'rangeArray',
        value: chart_json.rangeArray,
        chartId: chart_json.chart_id
      });
      store.commit({
        type: 'updateChartItem',
        key: 'rangeSplitArray',
        value: chart_json.rangeSplitArray,
        chartId: chart_json.chart_id
      });
      luckysheet.chart_selection.create(store.state.chartSetting.chartCurrent);
    },
    rangeMoveDragged: function rangeMoveDragged() {
      luckysheet.chart_selection.rangeMove = false;
      var chart_json = $.extend(true, {}, store.state.chartSetting.chartList[store.state.chartSetting.chartCurrent]);
      var updateJson = {};
      updateJson.chart_id = store.state.chartSetting.chartCurrent;
      updateJson.rangeTxt = luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex, chart_json.rangeArray[0], luckysheet.currentSheetIndex);
      updateJson.chartData = luckysheet.getdatabyselection(chart_json.rangeArray[0], luckysheet.currentSheetIndex);
      var $id = luckysheet.chart_selection.rangeMoveObj.attr('id');

      if ($id == 'luckysheet-chart-rangeShow-content' && !chart_json.rangeRowCheck.exits && !chart_json.rangeColCheck.exits) {
        //rangeMoveDraging中未更新chartData，在此使用新的chartData更新到updateJson
        updateJson.rangeSplitArray = generator.getRangeSplitArray(updateJson.chartData, chart_json.rangeArray, chart_json.rangeColCheck, chart_json.rangeRowCheck);
      } else {
        updateJson.rangeSplitArray = chart_json.rangeSplitArray;
      }

      var chartAllTypeArray = chart_json.chartAllType.split('|');
      var chartPro = chartAllTypeArray[0],
          chartType = chartAllTypeArray[1],
          chartStyle = chartAllTypeArray[2];
      updateJson.chartDataCache = generator.getChartDataCache(updateJson.chartData, updateJson.rangeSplitArray, chartPro, chartType, chartStyle);
      updateJson.chartDataSeriesOrder = generator.getChartDataSeriesOrder(updateJson.chartDataCache.series[0].length); // 是否是移动改变图形

      generator.drag = true; // 不增加点/线/区域

      generator.addPoint = false;
      generator.addLine = false;
      generator.addArea = false;

      if (chartType == 'funnel' || chartType == 'gauge') {
        updateJson.defaultOption = generator.addDataToOption1(chart_json.defaultOption, updateJson.chartDataCache, updateJson.chartDataSeriesOrder, chartPro, chartType, chartStyle);
      } else {
        updateJson.defaultOption = generator.addDataToOption(chart_json.defaultOption, updateJson.chartDataCache, updateJson.chartDataSeriesOrder, chartPro, chartType, chartStyle);
      } // console.dir(JSON.stringify(updateJson.defaultOption))


      generator.patchVueSet(updateJson);
      generator.generateChart(updateJson.defaultOption, chart_json.chartTheme, chart_json.chartAllType, $('#' + updateJson.chart_id).get(0));
    },
    rangeResize: false,
    rangeResizexy: null,
    rangeResizeIndex: null,
    rangeResizeObj: null,
    rangeResizeDraging: function rangeResizeDraging(event, sheetBarHeight, statisticBarHeight) {
      var chart_json = $.extend(true, {}, store.state.chartSetting.chartList[store.state.chartSetting.chartCurrent]);
      var st_r = chart_json.rangeArray[0].row[0];
      var st_c = chart_json.rangeArray[0].column[0];
      var rangeRowCheck = chart_json.rangeRowCheck;
      var rangeColCheck = chart_json.rangeColCheck;
      var rangeSplitArray = chart_json.rangeSplitArray;
      var mouse = luckysheet.mouseposition(event.pageX, event.pageY);
      var scrollLeft = $('#luckysheet-cell-main').scrollLeft();
      var scrollTop = $('#luckysheet-cell-main').scrollTop();
      var x = mouse[0] + scrollLeft;
      var y = mouse[1] + scrollTop;
      var winH = $(window).height() + scrollTop - sheetBarHeight - statisticBarHeight,
          winW = $(window).width() + scrollLeft;
      var rowLocation = luckysheet.rowLocation(y),
          row_index = rowLocation[2];
      var colLocation = luckysheet.colLocation(x),
          col_index = colLocation[2];
      var visibledatarow = luckysheet.getvisibledatarow();
      var visibledatacolumn = luckysheet.getvisibledatacolumn();
      var $id = luckysheet.chart_selection.rangeResizeObj.attr('id');

      if ($id == 'luckysheet-chart-rangeShow-content') {
        var r1, r2, c1, c2;

        if (luckysheet.chart_selection.rangeResize == 'lt') {
          r1 = luckysheet.chart_selection.rangeResizeIndex.row[0];
          c1 = luckysheet.chart_selection.rangeResizeIndex.column[0];
          r2 = luckysheet.chart_selection.rangeResizeIndex.row[1];
          c2 = luckysheet.chart_selection.rangeResizeIndex.column[1];
        } else if (luckysheet.chart_selection.rangeResize == 'lb') {
          r1 = luckysheet.chart_selection.rangeResizeIndex.row[1];
          c1 = luckysheet.chart_selection.rangeResizeIndex.column[0];
          r2 = luckysheet.chart_selection.rangeResizeIndex.row[0];
          c2 = luckysheet.chart_selection.rangeResizeIndex.column[1];
        } else if (luckysheet.chart_selection.rangeResize == 'rt') {
          r1 = luckysheet.chart_selection.rangeResizeIndex.row[0];
          c1 = luckysheet.chart_selection.rangeResizeIndex.column[1];
          r2 = luckysheet.chart_selection.rangeResizeIndex.row[1];
          c2 = luckysheet.chart_selection.rangeResizeIndex.column[0];
        } else if (luckysheet.chart_selection.rangeResize == 'rb') {
          r1 = luckysheet.chart_selection.rangeResizeIndex.row[1];
          c1 = luckysheet.chart_selection.rangeResizeIndex.column[1];
          r2 = luckysheet.chart_selection.rangeResizeIndex.row[0];
          c2 = luckysheet.chart_selection.rangeResizeIndex.column[0];
        } //行


        if (rangeRowCheck.exits) {
          var row_s = r1 - luckysheet.chart_selection.rangeResizexy[0] + row_index;

          if (row_s < st_r + rangeRowCheck.range[1] + 1 || y < 0) {
            row_s = st_r + rangeRowCheck.range[1] + 1;
          } else if (row_s >= visibledatarow.length - 1 || y > winH) {
            row_s = visibledatarow.length - 1;
          }
        } else {
          var row_s = st_r - luckysheet.chart_selection.rangeResizexy[0] + row_index;

          if (row_s < 0 || y < 0) {
            row_s = 0;
          } else if (row_s >= visibledatarow.length - 1 || y > winH) {
            row_s = visibledatarow.length - 1;
          }
        } //列


        if (rangeColCheck.exits) {
          var col_s = c1 - luckysheet.chart_selection.rangeResizexy[1] + col_index;

          if (col_s < st_c + rangeColCheck.range[1] + 1 || x < 0) {
            col_s = st_c + rangeColCheck.range[1] + 1;
          } else if (col_s >= visibledatacolumn.length - 1 || x > winW) {
            col_s = visibledatacolumn.length - 1;
          }
        } else {
          var col_s = st_c - luckysheet.chart_selection.rangeResizexy[1] + col_index;

          if (col_s < 0 || x < 0) {
            col_s = 0;
          } else if (col_s >= visibledatacolumn.length - 1 || x > winW) {
            col_s = visibledatacolumn.length - 1;
          }
        }

        var obj_r1, obj_r2, obj_c1, obj_c2;

        if (row_s > r2) {
          obj_r1 = r2;
          obj_r2 = row_s;
        } else {
          obj_r1 = row_s;
          obj_r2 = r2;
        }

        if (col_s > c2) {
          obj_c1 = c2;
          obj_c2 = col_s;
        } else {
          obj_c1 = col_s;
          obj_c2 = c2;
        }

        if (!rangeRowCheck.exits && !rangeColCheck.exits) {
          chart_json.rangeArray = [{
            row: [obj_r1, obj_r2],
            column: [obj_c1, obj_c2]
          }];
          chart_json.rangeSplitArray.range = {
            row: [obj_r1, obj_r2],
            column: [obj_c1, obj_c2]
          };
        } else {
          chart_json.rangeArray = [{
            row: [st_r, obj_r2],
            column: [st_c, obj_c2]
          }];
          chart_json.rangeSplitArray.range = {
            row: [st_r, obj_r2],
            column: [st_c, obj_c2]
          };
          chart_json.rangeSplitArray.content = {
            row: [obj_r1 - st_r, obj_r2 - st_r],
            column: [obj_c1 - st_c, obj_c2 - st_c]
          };

          if (rangeRowCheck.exits) {
            chart_json.rangeSplitArray.rowtitle = {
              row: chart_json.rangeSplitArray.rowtitle.row,
              column: [obj_c1 - st_c, obj_c2 - st_c]
            };
          }

          if (rangeColCheck.exits) {
            chart_json.rangeSplitArray.coltitle = {
              row: [obj_r1 - st_r, obj_r2 - st_r],
              column: chart_json.rangeSplitArray.coltitle.column
            };
          }
        }
      } else if ($id == 'luckysheet-chart-rangeShow-rowtitle') {
        var c1, c2;

        if (luckysheet.chart_selection.rangeResize == 'lt' || luckysheet.chart_selection.rangeResize == 'lb') {
          c1 = luckysheet.chart_selection.rangeResizeIndex.column[0];
          c2 = luckysheet.chart_selection.rangeResizeIndex.column[1];
        } else if (luckysheet.chart_selection.rangeResize == 'rt' || luckysheet.chart_selection.rangeResize == 'rb') {
          c1 = luckysheet.chart_selection.rangeResizeIndex.column[1];
          c2 = luckysheet.chart_selection.rangeResizeIndex.column[0];
        } //列


        if (rangeColCheck.exits) {
          var col_s = c1 - luckysheet.chart_selection.rangeResizexy[1] + col_index;

          if (col_s < st_c + rangeColCheck.range[1] + 1 || x < 0) {
            col_s = st_c + rangeColCheck.range[1] + 1;
          } else if (col_s >= visibledatacolumn.length - 1 || x > winW) {
            col_s = visibledatacolumn.length - 1;
          }
        } else {
          var col_s = st_c - luckysheet.chart_selection.rangeResizexy[1] + col_index;

          if (col_s < 0 || x < 0) {
            col_s = 0;
          } else if (col_s >= visibledatacolumn.length - 1 || x > winW) {
            col_s = visibledatacolumn.length - 1;
          }
        }

        var obj_c1, obj_c2;

        if (col_s > c2) {
          obj_c1 = c2;
          obj_c2 = col_s;
        } else {
          obj_c1 = col_s;
          obj_c2 = c2;
        } //更新


        if (!rangeColCheck.exits) {
          chart_json.rangeArray = [{
            row: chart_json.rangeArray[0].row,
            column: [obj_c1, obj_c2]
          }];
          chart_json.rangeSplitArray.range = {
            row: chart_json.rangeArray[0].row,
            column: [obj_c1, obj_c2]
          };
        } else {
          chart_json.rangeArray = [{
            row: chart_json.rangeArray[0].row,
            column: [st_c, obj_c2]
          }];
          chart_json.rangeSplitArray.range = {
            row: chart_json.rangeArray[0].row,
            column: [st_c, obj_c2]
          };
          chart_json.rangeSplitArray.rowtitle = {
            row: chart_json.rangeSplitArray.rowtitle.row,
            column: [obj_c1 - st_c, obj_c2 - st_c]
          };
          chart_json.rangeSplitArray.content = {
            row: chart_json.rangeSplitArray.content.row,
            column: [obj_c1 - st_c, obj_c2 - st_c]
          };
        }
      } else if ($id == 'luckysheet-chart-rangeShow-coltitle') {
        var r1, r2;

        if (luckysheet.chart_selection.rangeResize == 'lt' || luckysheet.chart_selection.rangeResize == 'rt') {
          r1 = luckysheet.chart_selection.rangeResizeIndex.row[0];
          r2 = luckysheet.chart_selection.rangeResizeIndex.row[1];
        } else if (luckysheet.chart_selection.rangeResize == 'lb' || luckysheet.chart_selection.rangeResize == 'rb') {
          r1 = luckysheet.chart_selection.rangeResizeIndex.row[1];
          r2 = luckysheet.chart_selection.rangeResizeIndex.row[0];
        } //行


        if (rangeRowCheck.exits) {
          var row_s = r1 - luckysheet.chart_selection.rangeResizexy[0] + row_index;

          if (row_s < st_r + rangeRowCheck.range[1] + 1 || y < 0) {
            row_s = st_r + rangeRowCheck.range[1] + 1;
          } else if (row_s >= visibledatarow.length - 1 || y > winH) {
            row_s = visibledatarow.length - 1;
          }
        } else {
          var row_s = st_r - luckysheet.chart_selection.rangeResizexy[0] + row_index;

          if (row_s < 0 || y < 0) {
            row_s = 0;
          } else if (row_s >= visibledatarow.length - 1 || y > winH) {
            row_s = visibledatarow.length - 1;
          }
        }

        var obj_r1, obj_r2;

        if (row_s > r2) {
          obj_r1 = r2;
          obj_r2 = row_s;
        } else {
          obj_r1 = row_s;
          obj_r2 = r2;
        } //更新


        if (!rangeRowCheck.exits) {
          chart_json.rangeArray = [{
            row: [obj_r1, obj_r2],
            column: chart_json.rangeArray[0].column
          }];
          chart_json.rangeSplitArray.range = {
            row: [obj_r1, obj_r2],
            column: chart_json.rangeArray[0].column
          };
        } else {
          chart_json.rangeArray = [{
            row: [st_r, obj_r2],
            column: chart_json.rangeArray[0].column
          }];
          chart_json.rangeSplitArray.range = {
            row: [st_r, obj_r2],
            column: chart_json.rangeArray[0].column
          };
          chart_json.rangeSplitArray.coltitle = {
            row: [obj_r1 - st_r, obj_r2 - st_r],
            column: chart_json.rangeSplitArray.coltitle.column
          };
          chart_json.rangeSplitArray.content = {
            row: [obj_r1 - st_r, obj_r2 - st_r],
            column: chart_json.rangeSplitArray.content.column
          };
        }
      } //部分更新


      store.commit({
        type: 'updateChartItem',
        key: 'rangeArray',
        value: chart_json.rangeArray,
        chartId: chart_json.chart_id
      });
      store.commit({
        type: 'updateChartItem',
        key: 'rangeSplitArray',
        value: chart_json.rangeSplitArray,
        chartId: chart_json.chart_id
      });
      luckysheet.chart_selection.create(store.state.chartSetting.chartCurrent);
    },
    rangeResizeDragged: function rangeResizeDragged() {
      luckysheet.chart_selection.rangeResize = null;
      var chart_json = $.extend(true, {}, store.state.chartSetting.chartList[store.state.chartSetting.chartCurrent]);
      var updateJson = {};
      updateJson.chart_id = store.state.chartSetting.chartCurrent;
      updateJson.rangeTxt = luckysheet.sheetmanage.getRangetxt(luckysheet.currentSheetIndex, chart_json.rangeArray[0], luckysheet.currentSheetIndex);
      updateJson.chartData = luckysheet.getdatabyselection(chart_json.rangeArray[0], luckysheet.currentSheetIndex);
      var $id = luckysheet.chart_selection.rangeResizeObj.attr('id');

      if ($id == 'luckysheet-chart-rangeShow-content' && !chart_json.rangeRowCheck.exits && !chart_json.rangeColCheck.exits) {
        //采用updateJson.chartData
        updateJson.rangeSplitArray = generator.getRangeSplitArray(updateJson.chartData, chart_json.rangeArray, chart_json.rangeColCheck, chart_json.rangeRowCheck);
      } else {
        updateJson.rangeSplitArray = chart_json.rangeSplitArray;
      }

      var chartAllTypeArray = chart_json.chartAllType.split('|');
      var chartPro = chartAllTypeArray[0],
          chartType = chartAllTypeArray[1],
          chartStyle = chartAllTypeArray[2];
      updateJson.chartDataCache = generator.getChartDataCache(updateJson.chartData, updateJson.rangeSplitArray, chartPro, chartType, chartStyle);
      updateJson.chartDataSeriesOrder = generator.getChartDataSeriesOrder(updateJson.chartDataCache.series[0].length);

      if (chartType == 'funnel' || chartType == 'gauge') {
        updateJson.defaultOption = generator.addDataToOption1(chart_json.defaultOption, updateJson.chartDataCache, updateJson.chartDataSeriesOrder, chartPro, chartType, chartStyle);
      } else {
        updateJson.defaultOption = generator.addDataToOption(chart_json.defaultOption, updateJson.chartDataCache, updateJson.chartDataSeriesOrder, chartPro, chartType, chartStyle);
      }

      generator.patchVueSet(updateJson);
      generator.generateChart(updateJson.defaultOption, chart_json.chartTheme, chart_json.chartAllType, $('#' + updateJson.chart_id).get(0));
    }
  };

  /**
   * polyfill event in firefox
   */
  function __firefox() {
    HTMLElement.prototype.__defineGetter__("runtimeStyle", __element_style);

    window.constructor.prototype.__defineGetter__("event", __window_event);

    Event.prototype.__defineGetter__("srcElement", __event_srcElement);
  }

  function __element_style() {
    return this.style;
  }

  function __window_event() {
    return __window_event_constructor();
  }

  function __event_srcElement() {
    return this.target;
  }

  function __window_event_constructor() {
    if (document.all) {
      return window.event;
    }

    var _caller = __window_event_constructor.caller;

    while (_caller != null) {
      var _argument = _caller.arguments[0];

      if (_argument) {
        var _temp = _argument.constructor;

        if (_temp.toString().indexOf("Event") != -1) {
          return _argument;
        }
      }

      _caller = _caller.caller;
    }

    return null;
  }

  /**
   * Determine whether a variable is a pure number, null/""/undefined/"34rt"/"34e" is not a number, 34/"34"/"34e10" is a number
   * @param {Number | String | } val 
   */


  function isRealNum(val) {
    if (val == null || val.toString().replace(/\s/g, "") === "") {
      return false;
    }

    if (!isNaN(val)) {
      return true;
    } else {
      return false;
    }
  }

  /*
   * 判断obj是否为一个整数
   */

  function isInteger(obj) {
    return Math.floor(obj) === obj;
  }
  /*
   * 将一个浮点数转成整数，返回整数和倍数。如 3.14 >> 314，倍数是 100
   * @param floatNum {number} 小数
   * @return {object}
   *   {times:100, num: 314}
   */


  function toInteger(floatNum) {
    var ret = {
      times: 1,
      num: 0
    };

    if (isInteger(floatNum)) {
      ret.num = floatNum;
      return ret;
    }

    var strfi = floatNum + '';
    var dotPos = strfi.indexOf('.');
    var len = strfi.substr(dotPos + 1).length;
    var times = Math.pow(10, len);
    var intNum = parseInt(floatNum * times + 0.5, 10);
    ret.times = times;
    ret.num = intNum;
    return ret;
  }
  /*
   * 核心方法，实现加减乘除运算，确保不丢失精度
   * 思路：把小数放大为整数（乘），进行算术运算，再缩小为小数（除）
   *
   * @param a {number} 运算数1
   * @param b {number} 运算数2
   * @param digits {number} 精度，保留的小数点数，比如 2, 即保留为两位小数
   * @param op {string} 运算类型，有加减乘除（add/subtract/multiply/divide）
   *
   */


  function operation(a, b, op) {
    var o1 = toInteger(a);
    var o2 = toInteger(b);
    var n1 = o1.num;
    var n2 = o2.num;
    var t1 = o1.times;
    var t2 = o2.times;
    var max = t1 > t2 ? t1 : t2;
    var result = null;

    switch (op) {
      case 'add':
        if (t1 === t2) {
          // 两个小数位数相同
          result = n1 + n2;
        } else if (t1 > t2) {
          // o1 小数位 大于 o2
          result = n1 + n2 * (t1 / t2);
        } else {
          // o1 小数位 小于 o2
          result = n1 * (t2 / t1) + n2;
        }

        return result / max;

      case 'subtract':
        if (t1 === t2) {
          result = n1 - n2;
        } else if (t1 > t2) {
          result = n1 - n2 * (t1 / t2);
        } else {
          result = n1 * (t2 / t1) - n2;
        }

        return result / max;

      case 'multiply':
        result = n1 * n2 / (t1 * t2);
        return result;

      case 'divide':
        return result = function () {
          var r1 = n1 / n2;
          var r2 = t2 / t1;
          return operation(r1, r2, 'multiply');
        }();
    }
  }
  /**
   * 做小数点的四舍五入计算
   * @param {*} num
   * @param {*} precision
   */


  function fixed(num, precision) {
    if (!precision) {
      precision = 2;
    }

    if (!isRealNum(num)) return num;
    var s = num.toFixed(precision);
    var index = s.indexOf('.');
    var prefix = s.substring(0, index);
    var suffix = s.substring(index + 1, s.length);

    if (suffix) {
      for (var i = suffix.length - 1; i != 0; i--) {
        //最末位不为0，直接break;
        if (suffix.charAt(i) != '0' && i == suffix.length - 1) {
          break;
        } else {
          suffix = suffix.substring(0, i);
        }
      }
    }

    return Number(prefix + '.' + suffix);
  }
  /**
   * Calculation +-/* Solve the problem of js accuracy
   */
  // export default class MathCalculate extends Number {
  //      constructor(){
  //         super();
  //         // this.num = num;
  //      }
  //      add(num){
  //         if (typeof this != 'number' || typeof num != 'number') {
  //             throw new Error('不是数字，不能计算!');
  //         }
  //         return operation(this, num, 'add');
  //      }
  //      subtract(num){
  //         if (typeof this != 'number' || typeof num != 'number') {
  //             throw new Error('不是数字，不能计算!');
  //         }
  //         return operation(this, num, 'subtract');
  //      }
  //      multiply(num){
  //         if (typeof this != 'number' || typeof num != 'number') {
  //             throw new Error('不是数字，不能计算!');
  //         }
  //         return operation(this, num, 'multiply');
  //      }
  //      divide(num){
  //         if (typeof this != 'number' || typeof num != 'number') {
  //             throw new Error('不是数字，不能计算!');
  //         }
  //         return operation(this, num, 'divide');
  //      }
  //      tofixed(num){
  //         if (typeof this != 'number') {
  //             throw new Error('不是数字，不能计算!');
  //         }
  //         return fixed(this, precision);
  //      }
  // }


  Number.prototype.add = function (value) {
    var number = parseFloat(value);

    if (typeof number !== 'number' || Number.isNaN(number)) {
      throw new Error('请输入数字或者数字字符串～');
    }
    return operation(this, number, 'add');
  };

  Number.prototype.subtract = function (value) {
    var number = parseFloat(value);

    if (typeof number !== 'number' || Number.isNaN(number)) {
      throw new Error('请输入数字或者数字字符串～');
    }

    return operation(this, number, 'subtract');
  };

  Number.prototype.multiply = function (value) {
    var number = parseFloat(value);

    if (typeof number !== 'number' || Number.isNaN(number)) {
      throw new Error('请输入数字或者数字字符串～');
    }

    return operation(this, number, 'multiply');
  };

  Number.prototype.divide = function (value) {
    var number = parseFloat(value);

    if (typeof number !== 'number' || Number.isNaN(number)) {
      throw new Error('请输入数字或者数字字符串～');
    }

    return operation(this, number, 'divide');
  };

  Number.prototype.tofixed = function (value) {
    var precision = parseFloat(value);

    if (typeof precision !== 'number' || Number.isNaN(precision)) {
      throw new Error('请输入数字或者数字字符串～');
    }

    return fixed(this, precision);
  };

  __firefox(); // calculate methods init

  return luckysheet;

})));
//# sourceMappingURL=luckysheet.js.map
